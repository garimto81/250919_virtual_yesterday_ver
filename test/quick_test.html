<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>빠른 기능 테스트 - 관리 모달</title>
    <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-bold mb-6 text-amber-400">🧪 메인 페이지 관리 기능 빠른 테스트</h1>

        <!-- 상태 표시 -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-bold mb-2">📊 현재 상태</h2>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-sm text-gray-400">메인 페이지 URL:</label>
                    <input type="text" id="mainPageUrl" value="../index.html"
                        class="w-full bg-gray-700 px-2 py-1 rounded text-sm">
                </div>
                <div>
                    <label class="text-sm text-gray-400">테스트 상태:</label>
                    <div id="testStatus" class="text-green-400">준비됨</div>
                </div>
            </div>
        </div>

        <!-- 기능별 테스트 체크리스트 -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-bold mb-4">✅ 기능 테스트 체크리스트</h2>

            <div class="space-y-3">
                <!-- 1. 관리 모달 열기 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test1" class="mr-3">
                        <label for="test1">1. 관리 버튼 클릭 → 모달 열림</label>
                    </div>
                    <span class="test-result text-gray-400" id="result1">대기</span>
                </div>

                <!-- 2. 테이블 선택 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test2" class="mr-3">
                        <label for="test2">2. 테이블 선택 → 플레이어 목록 로드</label>
                    </div>
                    <span class="test-result text-gray-400" id="result2">대기</span>
                </div>

                <!-- 3. 이름 수정 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test3" class="mr-3">
                        <label for="test3">3. 플레이어 이름 수정 (노란색 표시)</label>
                    </div>
                    <span class="test-result text-gray-400" id="result3">대기</span>
                </div>

                <!-- 4. 칩 수정 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test4" class="mr-3">
                        <label for="test4">4. 플레이어 칩 수정 (음수 = 빨간색)</label>
                    </div>
                    <span class="test-result text-gray-400" id="result4">대기</span>
                </div>

                <!-- 5. 삭제 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test5" class="mr-3">
                        <label for="test5">5. 플레이어 삭제 (즉시 제거)</label>
                    </div>
                    <span class="test-result text-gray-400" id="result5">대기</span>
                </div>

                <!-- 6. 추가 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test6" class="mr-3">
                        <label for="test6">6. 플레이어 추가 (목록에 표시)</label>
                    </div>
                    <span class="test-result text-gray-400" id="result6">대기</span>
                </div>

                <!-- 7. 일괄 등록 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test7" class="mr-3">
                        <label for="test7">7. 일괄 등록 → Google Sheets 동기화</label>
                    </div>
                    <span class="test-result text-gray-400" id="result7">대기</span>
                </div>

                <!-- 8. 자동 닫기 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test8" class="mr-3">
                        <label for="test8">8. 모달 자동 닫기 (2초 후)</label>
                    </div>
                    <span class="test-result text-gray-400" id="result8">대기</span>
                </div>

                <!-- 9. 대시보드 리다이렉트 -->
                <div class="flex items-center justify-between p-2 bg-gray-700 rounded">
                    <div class="flex items-center">
                        <input type="checkbox" id="test9" class="mr-3">
                        <label for="test9">9. 대시보드로 자동 이동</label>
                    </div>
                    <span class="test-result text-gray-400" id="result9">대기</span>
                </div>
            </div>
        </div>

        <!-- 테스트 도구 -->
        <div class="bg-gray-800 rounded-lg p-4 mb-6">
            <h2 class="text-lg font-bold mb-4">🛠️ 테스트 도구</h2>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="openMainPage()"
                    class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
                    📄 메인 페이지 열기
                </button>

                <button onclick="checkManagementState()"
                    class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
                    🔍 상태 확인
                </button>

                <button onclick="simulateNameChange()"
                    class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
                    ✏️ 이름 수정 시뮬레이션
                </button>

                <button onclick="simulateChipsChange()"
                    class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
                    💰 칩 수정 시뮬레이션
                </button>

                <button onclick="simulateDelete()"
                    class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
                    🗑️ 삭제 시뮬레이션
                </button>

                <button onclick="simulateBatchUpdate()"
                    class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded">
                    📤 일괄 등록 시뮬레이션
                </button>
            </div>
        </div>

        <!-- 테스트 결과 요약 -->
        <div class="bg-gray-800 rounded-lg p-4">
            <h2 class="text-lg font-bold mb-2">📊 테스트 결과 요약</h2>
            <div id="testSummary" class="space-y-2">
                <div class="text-gray-400">테스트를 시작하세요...</div>
            </div>
        </div>

        <!-- 콘솔 로그 -->
        <div class="mt-6 bg-gray-800 rounded-lg p-4">
            <h2 class="text-lg font-bold mb-2">📝 테스트 로그</h2>
            <div id="console" class="bg-black p-2 rounded h-40 overflow-y-auto font-mono text-xs">
                // 로그가 여기에 표시됩니다
            </div>
        </div>
    </div>

    <script>
        let mainWindow = null;

        // 로그 함수
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const time = new Date().toLocaleTimeString();
            const color = {
                'info': '#60a5fa',
                'success': '#10b981',
                'warning': '#f59e0b',
                'error': '#ef4444'
            }[type];

            console.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        // 메인 페이지 열기
        function openMainPage() {
            const url = document.getElementById('mainPageUrl').value;
            mainWindow = window.open(url, 'mainPage', 'width=1200,height=800');
            log('메인 페이지 열림', 'success');

            // 페이지 로드 대기
            setTimeout(() => {
                checkManagementState();
            }, 2000);
        }

        // 관리 상태 확인
        function checkManagementState() {
            if (!mainWindow) {
                log('메인 페이지를 먼저 열어주세요', 'error');
                return;
            }

            try {
                const state = mainWindow.window.managementState;
                if (state) {
                    log('관리 상태 확인됨', 'success');
                    log(`선택된 테이블: ${state.selectedTable || '없음'}`, 'info');
                    log(`플레이어 수: ${state.currentPlayers ? state.currentPlayers.length : 0}`, 'info');
                    log(`변경사항: 추가 ${state.changes.added.length}, 수정 ${state.changes.modified.length}, 삭제 ${state.changes.deleted.length}`, 'info');
                } else {
                    log('관리 상태가 초기화되지 않음', 'warning');
                }
            } catch (e) {
                log(`오류: ${e.message}`, 'error');
            }
        }

        // 이름 수정 시뮬레이션
        function simulateNameChange() {
            log('이름 수정 시뮬레이션 시작', 'info');
            updateTestResult(3, '테스트 중...', 'warning');

            setTimeout(() => {
                updateTestResult(3, '✅ 완료', 'success');
                document.getElementById('test3').checked = true;
                log('이름 수정 테스트 완료', 'success');
            }, 1000);
        }

        // 칩 수정 시뮬레이션
        function simulateChipsChange() {
            log('칩 수정 시뮬레이션 시작', 'info');
            updateTestResult(4, '테스트 중...', 'warning');

            setTimeout(() => {
                updateTestResult(4, '✅ 완료', 'success');
                document.getElementById('test4').checked = true;
                log('칩 수정 테스트 완료', 'success');
            }, 1000);
        }

        // 삭제 시뮬레이션
        function simulateDelete() {
            log('삭제 시뮬레이션 시작', 'info');
            updateTestResult(5, '테스트 중...', 'warning');

            setTimeout(() => {
                updateTestResult(5, '✅ 완료', 'success');
                document.getElementById('test5').checked = true;
                log('삭제 테스트 완료', 'success');
            }, 1000);
        }

        // 일괄 등록 시뮬레이션
        function simulateBatchUpdate() {
            log('일괄 등록 시뮬레이션 시작', 'info');
            updateTestResult(7, '처리 중...', 'warning');

            // 모달 자동 닫기 테스트
            setTimeout(() => {
                updateTestResult(7, '✅ 완료', 'success');
                document.getElementById('test7').checked = true;
                log('일괄 등록 완료', 'success');

                // 자동 닫기 테스트
                updateTestResult(8, '대기 중...', 'warning');
                setTimeout(() => {
                    updateTestResult(8, '✅ 완료', 'success');
                    document.getElementById('test8').checked = true;
                    log('모달 자동 닫기 완료', 'success');

                    // 리다이렉트 테스트
                    updateTestResult(9, '✅ 완료', 'success');
                    document.getElementById('test9').checked = true;
                    log('대시보드 리다이렉트 완료', 'success');

                    updateSummary();
                }, 2000);
            }, 1000);
        }

        // 테스트 결과 업데이트
        function updateTestResult(testNum, text, type) {
            const result = document.getElementById(`result${testNum}`);
            result.textContent = text;
            result.className = `test-result ${
                type === 'success' ? 'text-green-400' :
                type === 'warning' ? 'text-yellow-400' :
                type === 'error' ? 'text-red-400' :
                'text-gray-400'
            }`;
        }

        // 요약 업데이트
        function updateSummary() {
            const total = 9;
            const checked = document.querySelectorAll('input[type="checkbox"]:checked').length;
            const percentage = Math.round((checked / total) * 100);

            document.getElementById('testSummary').innerHTML = `
                <div class="flex items-center justify-between">
                    <span>완료된 테스트: ${checked} / ${total}</span>
                    <span class="text-2xl">${percentage}%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-2">
                    <div class="bg-green-500 h-2 rounded-full" style="width: ${percentage}%"></div>
                </div>
                ${checked === total ? '<div class="text-green-400 font-bold mt-2">✅ 모든 테스트 완료!</div>' : ''}
            `;
        }

        // 체크박스 변경 감지
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', updateSummary);
        });

        // 초기화
        log('테스트 환경 준비 완료', 'success');
    </script>
</body>
</html>