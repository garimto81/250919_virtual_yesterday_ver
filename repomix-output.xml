This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
_config.yml
.github/SCHEDULER_GUIDE.md
.github/SECRETS_GUIDE.md
.gitignore
apps-script/Code-old.gs
apps-script/Code.gs
apps-script/GeminiProxy.gs
archive/action-history.js
archive/batch-processor.js
archive/chip-analysis-module.js
archive/double-tap-handler.js
archive/mobile-optimizer.js
archive/offline-storage.js
archive/old-tests/test-cloud-sync.html
archive/old-tests/test-phase1.html
archive/old-tests/test-ui-lock.html
archive/old-tests/test-url-save.html
archive/phase-verification/phase1-verification.html
archive/phase-verification/phase2-verification.html
archive/phase-verification/phase3-verification.html
archive/phase-verification/phase4-device-testing.html
archive/phase-verification/verify-phase1.js
archive/phase-verification/verify-phase2.js
archive/phase-verification/verify-phase3.js
archive/phase-verification/verify-phase4.js
archive/table-management-v59.js
archive/virtual-scroll.js
docs/CHECKLIST.md
docs/SETUP_API_SECURITY.md
index.html
README.md
src/js/duplicate-remover.js
src/js/gemini-client.js
src/js/mobile-enhancer.js
src/js/modal-auto-close.js
src/js/performance-optimizer.js
test.html
test/console.md
virtual_data_claude/apps-script/Code_v65_InOut.gs
virtual_data_claude/archive/action-history.js
virtual_data_claude/archive/batch-processor.js
virtual_data_claude/archive/chip-analysis-module.js
virtual_data_claude/archive/double-tap-handler.js
virtual_data_claude/archive/mobile-optimizer.js
virtual_data_claude/archive/offline-storage.js
virtual_data_claude/archive/old-tests/test-cloud-sync.html
virtual_data_claude/archive/old-tests/test-phase1.html
virtual_data_claude/archive/old-tests/test-ui-lock.html
virtual_data_claude/archive/old-tests/test-url-save.html
virtual_data_claude/archive/phase-verification/phase1-verification.html
virtual_data_claude/archive/phase-verification/phase2-verification.html
virtual_data_claude/archive/phase-verification/phase3-verification.html
virtual_data_claude/archive/phase-verification/phase4-device-testing.html
virtual_data_claude/archive/phase-verification/verify-phase1.js
virtual_data_claude/archive/phase-verification/verify-phase2.js
virtual_data_claude/archive/phase-verification/verify-phase3.js
virtual_data_claude/archive/phase-verification/verify-phase4.js
virtual_data_claude/archive/table-management-v59.js
virtual_data_claude/archive/virtual-scroll.js
virtual_data_claude/CHECKLIST.md
virtual_data_claude/index.html
virtual_data_claude/README.md
virtual_data_claude/src/js/duplicate-remover.js
virtual_data_claude/src/js/modal-auto-close.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="_config.yml">
theme: none
plugins: []
</file>

<file path=".github/SCHEDULER_GUIDE.md">
# í¬ì»¤ íŠ¸ë Œë“œ ë¶„ì„ ìë™ ìŠ¤ì¼€ì¤„ëŸ¬ ê°€ì´ë“œ

## ğŸ“… ìŠ¤ì¼€ì¤„ë§ ì •ë³´

### ğŸ—“ï¸ ì›”ê°„ ë¦¬í¬íŠ¸
- **ì‹¤í–‰ ì‹œê°„**: ë§¤ì›” ì²«ì§¸ì£¼ ì›”ìš”ì¼ ì˜¤í›„ 2ì‹œ (í•œêµ­ì‹œê°„)
- **ë¶„ì„ ê¸°ê°„**: ì§€ë‚œ ë‹¬ (30ì¼)
- **ì‚¬ìš© ë¶„ì„ê¸°**: `enhanced_validated_analyzer.py`
- **íŠ¹ì§•**: ê°€ì¥ ì •ë°€í•œ ê²€ì¦ ë° ìƒì„¸ ë¶„ì„

### ğŸ“… ì£¼ê°„ ë¦¬í¬íŠ¸  
- **ì‹¤í–‰ ì‹œê°„**: ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 11ì‹œ (í•œêµ­ì‹œê°„)
- **ë¶„ì„ ê¸°ê°„**: ì§€ë‚œ ì£¼ (7ì¼)
- **ì‚¬ìš© ë¶„ì„ê¸°**: `validated_analyzer_with_translation.py`
- **íŠ¹ì§•**: ì˜ìƒ ê²€ì¦ + í•œê¸€ ë²ˆì—­ í†µí•©

### ğŸ“‹ ì¼ê°„ ë¦¬í¬íŠ¸
- **ì‹¤í–‰ ì‹œê°„**: í‰ì¼(í™”-ê¸ˆ) ì˜¤ì „ 10ì‹œ (í•œêµ­ì‹œê°„)
- **ë¶„ì„ ê¸°ê°„**: ì˜¤ëŠ˜ (1ì¼)
- **ì‚¬ìš© ë¶„ì„ê¸°**: `quick_validated_analyzer.py`
- **íŠ¹ì§•**: ë¹ ë¥¸ ê²€ì¦ ë° ì‹¤ì‹œê°„ ë¶„ì„

## ğŸ”§ GitHub Secrets ì„¤ì • í•„ìš”

ë‹¤ìŒ secretsë¥¼ GitHub ì €ì¥ì†Œì— ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

```
YOUTUBE_API_KEY=your_youtube_api_key
GEMINI_API_KEY=your_gemini_api_key
SLACK_WEBHOOK_URL=your_slack_webhook_url
```

## ğŸš€ ìˆ˜ë™ ì‹¤í–‰

GitHub Actions íƒ­ì—ì„œ "í¬ì»¤ íŠ¸ë Œë“œ ë¶„ì„ ìë™ ìŠ¤ì¼€ì¤„ëŸ¬" ì›Œí¬í”Œë¡œìš°ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- **daily**: ì¼ê°„ ë¶„ì„
- **weekly**: ì£¼ê°„ ë¶„ì„  
- **monthly**: ì›”ê°„ ë¶„ì„

## ğŸ“Š ìŠ¤ì¼€ì¤„ ìƒì„¸ ì •ë³´

### Cron í‘œí˜„ì‹
```yaml
# ë§¤ì›” ì²«ì§¸ì£¼ ì›”ìš”ì¼ ì˜¤í›„ 2ì‹œ (KST) = UTC 05:00
- cron: '0 5 1-7 * 1'

# ë§¤ì£¼ ì›”ìš”ì¼ ì˜¤ì „ 11ì‹œ (KST) = UTC 02:00  
- cron: '0 2 * * 1'

# í‰ì¼ ì˜¤ì „ 10ì‹œ (KST) = UTC 01:00
- cron: '0 1 * * 2-6'
```

### ì‹œê°„ëŒ€ ë³€í™˜
- **í•œêµ­ì‹œê°„ (KST)** = UTC + 9ì‹œê°„
- ëª¨ë“  cronì€ UTC ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •ë¨

## ğŸ¯ ë¶„ì„ê¸°ë³„ íŠ¹ì§•

| ë¶„ì„ê¸° | ì†ë„ | ì •í™•ë„ | ë²ˆì—­ | ê²€ì¦ ë ˆë²¨ |
|--------|------|--------|------|-----------|
| `quick_validated_analyzer.py` | âš¡ ë¹ ë¦„ | ğŸ¯ ë†’ìŒ | âœ… í¬í•¨ | ê¸°ë³¸ |
| `validated_analyzer_with_translation.py` | ğŸ”„ ë³´í†µ | ğŸ¯ ë†’ìŒ | âœ… í¬í•¨ | ê°•í™” |
| `enhanced_validated_analyzer.py` | ğŸŒ ëŠë¦¼ | ğŸ¯ ìµœê³  | âœ… í¬í•¨ | ìµœê³  |

## ğŸ“ ê²°ê³¼ íŒŒì¼

ë¶„ì„ ê²°ê³¼ëŠ” ë‹¤ìŒ ìœ„ì¹˜ì— ì €ì¥ë©ë‹ˆë‹¤:
- `backend/data-collector/scripts/reports/`
- GitHub Actions ì•„í‹°íŒ©íŠ¸ë¡œ 30ì¼ê°„ ë³´ê´€

## ğŸ”” ì•Œë¦¼ ì‹œìŠ¤í…œ

- **ì„±ê³µì‹œ**: ë¶„ì„ ê²°ê³¼ê°€ Slack ì±„ë„ë¡œ ìë™ ì „ì†¡
- **ì‹¤íŒ¨ì‹œ**: ì˜¤ë¥˜ ì•Œë¦¼ì´ Slackìœ¼ë¡œ ì „ì†¡
- **í¬í•¨ ì •ë³´**: ì‹¤í–‰ ì‹œê°„, ë¦¬í¬íŠ¸ íƒ€ì…, GitHub Actions ë§í¬

## ğŸ› ï¸ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

1. **API í• ë‹¹ëŸ‰ ì´ˆê³¼**:
   - YouTube API: ì¼ì¼ 10,000 ì¿¼í„°
   - Gemini API: ë¶„ë‹¹ ìš”ì²­ ì œí•œ í™•ì¸

2. **ì‹œê°„ëŒ€ ë¬¸ì œ**:
   - ëª¨ë“  ë¡œê·¸ëŠ” KST ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œ
   - cronì€ UTC ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •

3. **Slack ì•Œë¦¼ ì‹¤íŒ¨**:
   - SLACK_WEBHOOK_URL í™•ì¸
   - ì±„ë„ ê¶Œí•œ í™•ì¸

### ë¡œê·¸ í™•ì¸ ë°©ë²•

1. GitHub â†’ Actions íƒ­
2. "í¬ì»¤ íŠ¸ë Œë“œ ë¶„ì„ ìë™ ìŠ¤ì¼€ì¤„ëŸ¬" í´ë¦­
3. í•´ë‹¹ ì‹¤í–‰ ë¡œê·¸ í™•ì¸

## ğŸ“ˆ ìµœì í™” íŒ

- **ì›”ê°„**: ì •ë°€í•œ ë¶„ì„ì´ í•„ìš”í•˜ë¯€ë¡œ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¼
- **ì£¼ê°„**: ê· í˜•ì¡íŒ ì†ë„ì™€ ì •í™•ë„
- **ì¼ê°„**: ë¹ ë¥¸ ì‹¤í–‰ìœ¼ë¡œ ì‹¤ì‹œê°„ì„± í™•ë³´

---

## ğŸ¯ ìš”ì•½

ì´ ìŠ¤ì¼€ì¤„ëŸ¬ëŠ” í¬ì»¤ íŠ¸ë Œë“œë¥¼ ì§€ì†ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ì—¬:
- ğŸ“Š **ë°ì´í„° ìˆ˜ì§‘**: YouTube API ê¸°ë°˜
- ğŸ” **ì˜ìƒ ê²€ì¦**: ì¬ìƒ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸  
- ğŸŒ **ë‹¤êµ­ì–´ ì§€ì›**: ì›ë³¸ ì–¸ì–´ ë³´ì¡´ + í•œê¸€ ë²ˆì—­
- ğŸ¤– **AI ë¶„ì„**: Gemini AI íŠ¸ë Œë“œ ì¸ì‚¬ì´íŠ¸
- ğŸ“± **ìë™ ì•Œë¦¼**: Slack í†µí•©

**ì™„ì „ ìë™í™”ëœ í¬ì»¤ íŠ¸ë Œë“œ ë¶„ì„ ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤! ğŸš€
</file>

<file path=".github/SECRETS_GUIDE.md">
# GitHub Secrets ì„¤ì • ê°€ì´ë“œ

ì´ ê°€ì´ë“œëŠ” Poker Trend í”„ë¡œì íŠ¸ì— í•„ìš”í•œ GitHub Secrets ì„¤ì • ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“‹ í•„ìˆ˜ Secrets

### 1. YouTube Data API
```
YOUTUBE_API_KEY
```
- **ìš©ë„**: YouTube íŠ¸ë Œë“œ ë°ì´í„° ìˆ˜ì§‘
- **íšë“ ë°©ë²•**:
  1. [Google Cloud Console](https://console.cloud.google.com) ì ‘ì†
  2. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„± ë˜ëŠ” ê¸°ì¡´ í”„ë¡œì íŠ¸ ì„ íƒ
  3. YouTube Data API v3 í™œì„±í™”
  4. ì‚¬ìš©ì ì¸ì¦ ì •ë³´ â†’ API í‚¤ ìƒì„±
- **í• ë‹¹ëŸ‰**: ì¼ì¼ 10,000 ìœ ë‹›

### 2. Slack Webhook
```
SLACK_WEBHOOK_URL
```
- **ìš©ë„**: ì¼ì¼ íŠ¸ë Œë“œ ë¦¬í¬íŠ¸ ì „ì†¡
- **íšë“ ë°©ë²•**:
  1. [Slack API](https://api.slack.com/apps) ì ‘ì†
  2. Create New App â†’ From scratch
  3. Incoming Webhooks í™œì„±í™”
  4. Add New Webhook to Workspace
- **í˜•ì‹**: `https://hooks.slack.com/services/XXX/YYY/ZZZ`

### 3. OpenAI API
```
OPENAI_API_KEY
```
- **ìš©ë„**: AI ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
- **íšë“ ë°©ë²•**:
  1. [OpenAI Platform](https://platform.openai.com) ê°€ì…
  2. API keys ë©”ë‰´ì—ì„œ ìƒˆ í‚¤ ìƒì„±
  3. ì‚¬ìš©ëŸ‰ ì œí•œ ì„¤ì • ê¶Œì¥
- **ìš”ê¸ˆ**: ì‚¬ìš©ëŸ‰ ê¸°ë°˜ ê³¼ê¸ˆ

### 4. Google Gemini API
```
GEMINI_API_KEY
```
- **ìš©ë„**: ë°±ì—… AI ì„œë¹„ìŠ¤
- **íšë“ ë°©ë²•**:
  1. [Google AI Studio](https://makersuite.google.com/app/apikey) ì ‘ì†
  2. Get API key í´ë¦­
  3. í”„ë¡œì íŠ¸ ì„ íƒ í›„ ìƒì„±

## ğŸ“‹ ì„ íƒì  Secrets

### 5. Twitter API
```
TWITTER_BEARER_TOKEN
```
- **ìš©ë„**: Twitter íŠ¸ë Œë“œ ëª¨ë‹ˆí„°ë§
- **íšë“ ë°©ë²•**:
  1. [Twitter Developer Portal](https://developer.twitter.com) ê°€ì…
  2. ì•± ìƒì„± â†’ Bearer Token ë°œê¸‰
- **ì œí•œ**: ì›” 500,000 íŠ¸ìœ— (Essential)

### 6. Reddit API
```
REDDIT_CLIENT_ID
REDDIT_CLIENT_SECRET
```
- **ìš©ë„**: Reddit í¬ì»¤ ì»¤ë®¤ë‹ˆí‹° ëª¨ë‹ˆí„°ë§
- **íšë“ ë°©ë²•**:
  1. [Reddit Apps](https://www.reddit.com/prefs/apps) ì ‘ì†
  2. Create App â†’ Script type ì„ íƒ
  3. Client IDì™€ Secret í™•ì¸

### 7. TikTok API
```
TIKTOK_ACCESS_TOKEN
```
- **ìš©ë„**: TikTok íŠ¸ë Œë“œ ë¶„ì„ ë° ì—…ë¡œë“œ
- **íšë“ ë°©ë²•**: TikTok for Developers ì‹ ì²­ í•„ìš”

### 8. Discord Webhook
```
DISCORD_WEBHOOK_URL
```
- **ìš©ë„**: Discord ì•Œë¦¼ (Slack ëŒ€ì•ˆ)
- **íšë“ ë°©ë²•**:
  1. Discord ì„œë²„ ì„¤ì • â†’ ì—°ë™ â†’ ì›¹í›„í¬
  2. ìƒˆ ì›¹í›„í¬ ìƒì„±
  3. ì›¹í›„í¬ URL ë³µì‚¬

## ğŸ”§ ì„¤ì • ë°©ë²•

### GitHub Secrets ì¶”ê°€í•˜ê¸°

1. **ì €ì¥ì†Œ Settings ì ‘ì†**
   ```
   https://github.com/garimto81/poker-trend/settings
   ```

2. **Secrets and variables â†’ Actions í´ë¦­**

3. **New repository secret í´ë¦­**

4. **ê° Secret ì¶”ê°€**
   - Name: ìœ„ì˜ Secret ì´ë¦„ ì…ë ¥
   - Value: ì‹¤ì œ API í‚¤ ê°’ ì…ë ¥
   - Add secret í´ë¦­

### í™•ì¸ ë°©ë²•
```bash
# GitHub CLIë¡œ í™•ì¸ (ê°’ì€ í‘œì‹œë˜ì§€ ì•ŠìŒ)
gh secret list

# Actions ì›Œí¬í”Œë¡œìš°ì—ì„œ í™•ì¸
echo "YouTube API: ${{ secrets.YOUTUBE_API_KEY != '' && 'âœ…' || 'âŒ' }}"
```

## ğŸ”’ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

### Do's âœ…
- ê° ì„œë¹„ìŠ¤ë³„ë¡œ ë³„ë„ API í‚¤ ì‚¬ìš©
- ìµœì†Œ ê¶Œí•œ ì›ì¹™ ì ìš©
- ì •ê¸°ì ìœ¼ë¡œ í‚¤ ë¡œí…Œì´ì…˜
- ì‚¬ìš©ëŸ‰ ì œí•œ ì„¤ì •
- ì ‘ê·¼ ë¡œê·¸ ëª¨ë‹ˆí„°ë§

### Don'ts âŒ
- ì½”ë“œì— ì§ì ‘ API í‚¤ í•˜ë“œì½”ë”©
- Public ì €ì¥ì†Œì— .env íŒŒì¼ ì»¤ë°‹
- ë¡œê·¸ì— API í‚¤ ì¶œë ¥
- í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œì—ì„œ API í‚¤ ì‚¬ìš©
- ë§Œë£Œëœ í‚¤ ë°©ì¹˜

## ğŸ“Š ê¶Œì¥ ì„¤ì •

### API ì‚¬ìš©ëŸ‰ ì œí•œ
- YouTube API: ì¼ì¼ 5,000 ìœ ë‹›ìœ¼ë¡œ ì œí•œ
- OpenAI: ì›” $10 ì œí•œ ì„¤ì •
- Twitter: Rate limit ëª¨ë‹ˆí„°ë§

### ì•Œë¦¼ ì„¤ì •
- API ì‚¬ìš©ëŸ‰ 80% ë„ë‹¬ ì‹œ ì•Œë¦¼
- ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì•Œë¦¼
- ì¼ì¼ ì‚¬ìš©ëŸ‰ ë¦¬í¬íŠ¸

## ğŸš¨ ë¬¸ì œ í•´ê²°

### Secretì´ ì‘ë™í•˜ì§€ ì•Šì„ ë•Œ
1. Secret ì´ë¦„ ì˜¤íƒ€ í™•ì¸
2. ê°’ì— ë¶ˆí•„ìš”í•œ ê³µë°± í™•ì¸
3. Actions ê¶Œí•œ ì„¤ì • í™•ì¸
4. ì›Œí¬í”Œë¡œìš° ë¡œê·¸ í™•ì¸

### API ì œí•œ ì´ˆê³¼
1. ìºì‹± êµ¬í˜„
2. ìš”ì²­ ë¹ˆë„ ì¡°ì ˆ
3. ì—¬ëŸ¬ API í‚¤ ë¡œí…Œì´ì…˜
4. ìœ ë£Œ í”Œëœ ì—…ê·¸ë ˆì´ë“œ

## ğŸ“š ì°¸ê³  ìë£Œ

- [GitHub Encrypted Secrets](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [YouTube API Quota](https://developers.google.com/youtube/v3/getting-started#quota)
- [OpenAI Pricing](https://openai.com/pricing)
- [Slack Incoming Webhooks](https://api.slack.com/messaging/webhooks)

---

**ë³´ì•ˆ ê´€ë ¨ ë¬¸ì˜**: GitHub Issuesì— ë¯¼ê°í•œ ì •ë³´ ì—†ì´ ë¬¸ì˜í•´ì£¼ì„¸ìš”.
</file>

<file path=".gitignore">
.claude/
CLAUDE.md
</file>

<file path="apps-script/Code-old.gs">
/**
 * v70.0.0 ULTIMATE - ì™„ì „ ë¬´ê²° ë²„ì „
 *
 * Apps Script CORS ì™„ì „ í•´ê²° ë²„ì „
 * - HTML Service ë°©ì‹ CORS í•´ê²°
 * - ëª¨ë“  HTTP ë©”ì„œë“œ ì™„ë²½ ì§€ì›
 * - ì—ëŸ¬ ì²˜ë¦¬ ì™„ì „ ê°œì„ 
 */

// ==================== ì„¤ì • ë° ìƒìˆ˜ ====================

const SHEET_ID = '1J-lf8bYTLPbpdhieUNdb8ckW_uwdQ3MtSBLmyRIwH7U';
const TYPE_SHEET_NAME = 'Type';
const CONFIG_SHEET_NAME = 'Config';

// Type ì‹œíŠ¸ ì»¬ëŸ¼ ì¸ë±ìŠ¤ (0ë¶€í„° ì‹œì‘)
const TYPE_COLUMNS = {
  POKER_ROOM: 0,   // A: Poker Room
  TABLE_NAME: 1,   // B: Table Name
  TABLE_NO: 2,     // C: Table No.
  SEAT_NO: 3,      // D: Seat No.
  PLAYERS: 4,      // E: Players
  NATIONALITY: 5,  // F: Nationality
  CHIPS: 6,        // G: Chips
  KEYPLAYER: 7     // H: Keyplayer
};

// ë²„ì „ ì •ë³´
const VERSION_INFO = {
  version: '70.1.0',
  lastUpdate: '2025-09-23',
  features: [
    'ìƒˆë¡œìš´ Type ì‹œíŠ¸ êµ¬ì¡° (8ì»¬ëŸ¼)',
    'Config ì‹œíŠ¸ ì§€ì›',
    'Table No. + Seat No. ë³µí•© í‚¤',
    'ìŠ¤ë§ˆíŠ¸ ì—…ë°ì´íŠ¸',
    'HTML Service + GET íŒŒë¼ë¯¸í„° ì§€ì›'
  ]
};

// ==================== CORS í•´ê²°ì„ ìœ„í•œ HTML Service ====================

function doGet(e) {
  const params = e.parameter;

  // POST ë°ì´í„° ì²˜ë¦¬ (GET íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœ ê²½ìš°)
  if (params.action && params.data) {
    try {
      const data = JSON.parse(params.data);
      data.action = params.action;

      let result;

      switch(data.action) {
        case 'createPlayer':
          result = createPlayer(convertToV70Structure(data, data.tableNo));
          break;
        case 'updatePlayerInfo':
          result = updatePlayerInfo(data.tableNo, data.seatNo, data.playerName, data.updateData || data);
          break;
        case 'deletePlayer':
          result = deletePlayer(data.tableNo, data.seatNo, data.playerName);
          break;
        case 'getTablePlayers':
          result = {
            success: true,
            players: getTablePlayers(data.tableNo),
            count: getTablePlayers(data.tableNo).length
          };
          break;
        default:
          result = {
            success: false,
            message: `ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜: ${data.action}`
          };
      }

      return createCorsResponse(result);

    } catch (error) {
      return createCorsResponse({
        success: false,
        message: error.toString(),
        stack: error.stack
      });
    }
  }

  // API í…ŒìŠ¤íŠ¸
  if (params.test === 'true') {
    return createCorsResponse({
      success: true,
      message: 'v70 Ultimate API í…ŒìŠ¤íŠ¸ ëª¨ë“œ',
      version: VERSION_INFO.version,
      features: VERSION_INFO.features,
      timestamp: new Date().toISOString()
    });
  }

  // í…Œì´ë¸” ì¡°íšŒ
  if (params.table) {
    const players = getTablePlayers(params.table);
    return createCorsResponse({
      success: true,
      table: params.table,
      players: players,
      count: players.length,
      timestamp: new Date().toISOString()
    });
  }

  // ê¸°ë³¸ ì‘ë‹µ
  return createCorsResponse({
    success: true,
    message: 'v70 Ultimate API ì •ìƒ ì‘ë™ ì¤‘',
    version: VERSION_INFO.version,
    timestamp: new Date().toISOString()
  });
}

function doPost(e) {
  try {
    console.log('[v70] doPost ì‹œì‘:', new Date().toLocaleString());

    // ìš”ì²­ ë°ì´í„° íŒŒì‹±
    const data = JSON.parse(e.postData.contents);
    console.log('[v70] ìš”ì²­ ì•¡ì…˜:', data.action);

    let result;

    switch(data.action) {
      case 'batchUpdate':
        result = handleBatchUpdateEnhanced(data);
        break;
      case 'createPlayer':
        result = createPlayer(convertToV70Structure(data, data.tableNo));
        break;
      case 'updatePlayerInfo':
        result = updatePlayerInfo(data.tableNo, data.seatNo, data.playerName, data.updateData || data);
        break;
      case 'replacePlayer':
        result = replacePlayer(data.tableNo, data.seatNo, convertToV70Structure(data, data.tableNo));
        break;
      case 'smartUpdate':
        result = smartUpdatePlayer(convertToV70Structure(data, data.tableNo));
        break;
      case 'deletePlayer':
        result = deletePlayer(data.tableNo, data.seatNo, data.playerName);
        break;
      case 'getTablePlayers':
        result = {
          success: true,
          players: getTablePlayers(data.tableNo),
          count: getTablePlayers(data.tableNo).length
        };
        break;
      case 'clearSheet':
        result = clearTypeSheet();
        break;
      case 'applyStyle':
        result = applyFullSheetStyle();
        break;
      case 'saveConfig':
        result = saveConfigToSheet(data.configType, data.value);
        break;
      case 'getConfig':
        result = {
          success: true,
          value: getConfigFromSheet(data.configType)
        };
        break;
      default:
        result = {
          success: false,
          message: `ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜: ${data.action}`
        };
    }

    return createCorsResponse(result);

  } catch (error) {
    console.error('[v70] doPost ì˜¤ë¥˜:', error);
    return createCorsResponse({
      success: false,
      message: error.toString(),
      stack: error.stack
    });
  }
}

// CORS ì‘ë‹µ ìƒì„± í•¨ìˆ˜
function createCorsResponse(data) {
  const jsonResponse = JSON.stringify(data);

  // HTMLì„ í†µí•œ JSONP ì‘ë‹µìœ¼ë¡œ CORS ìš°íšŒ
  const html = `
<!DOCTYPE html>
<html>
<head>
  <script>
    // CORS ìš°íšŒë¥¼ ìœ„í•œ postMessage ì‚¬ìš©
    const data = ${jsonResponse};

    // ë¶€ëª¨ ì°½ì´ ìˆìœ¼ë©´ postMessageë¡œ ì „ì†¡
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'APPS_SCRIPT_RESPONSE',
        data: data
      }, '*');
    }

    // ì§ì ‘ ì ‘ê·¼ ì‹œ JSON í‘œì‹œ
    document.addEventListener('DOMContentLoaded', function() {
      document.body.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
    });
  </script>
</head>
<body>
  <pre id="response">${jsonResponse}</pre>
</body>
</html>`;

  return HtmlService
    .createHtmlOutput(html)
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}

// ==================== PlayerIndex í´ë˜ìŠ¤ ====================

class PlayerIndex {
  constructor() {
    this.indexByKey = new Map();
    this.indexByName = new Map();
    this.indexByTable = new Map();
    this.lastBuildTime = 0;
    this.cacheExpiry = 60000; // 1ë¶„
  }

  needsRebuild() {
    return Date.now() - this.lastBuildTime > this.cacheExpiry;
  }

  build(data) {
    console.log('[PlayerIndex] ì¸ë±ìŠ¤ ë¹Œë“œ ì‹œì‘');
    this.clear();

    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      if (!row || row.length < 8) continue;

      const tableNo = String(row[TYPE_COLUMNS.TABLE_NO] || '').trim();
      const seatNo = String(row[TYPE_COLUMNS.SEAT_NO] || '').trim();
      const name = String(row[TYPE_COLUMNS.PLAYERS] || '').trim();

      if (!tableNo || !seatNo || !name) continue;

      const key = `${tableNo}_${seatNo}`;

      // í‚¤ ì¸ë±ìŠ¤
      this.indexByKey.set(key, i);

      // ì´ë¦„ ì¸ë±ìŠ¤
      if (!this.indexByName.has(name)) {
        this.indexByName.set(name, []);
      }
      this.indexByName.get(name).push(i);

      // í…Œì´ë¸” ì¸ë±ìŠ¤
      if (!this.indexByTable.has(tableNo)) {
        this.indexByTable.set(tableNo, []);
      }
      this.indexByTable.get(tableNo).push(i);
    }

    this.lastBuildTime = Date.now();
    console.log(`[PlayerIndex] ë¹Œë“œ ì™„ë£Œ: ${this.indexByKey.size}ëª…`);
  }

  clear() {
    this.indexByKey.clear();
    this.indexByName.clear();
    this.indexByTable.clear();
  }

  findByKey(tableNo, seatNo) {
    const key = `${tableNo}_${seatNo}`;
    return this.indexByKey.get(key);
  }

  findByName(name) {
    return this.indexByName.get(name) || [];
  }

  findByTable(tableNo) {
    return this.indexByTable.get(tableNo) || [];
  }
}

// ì „ì—­ ì¸ë±ìŠ¤ ì¸ìŠ¤í„´ìŠ¤
const playerIndex = new PlayerIndex();

// ==================== Sheet ì ‘ê·¼ í•¨ìˆ˜ ====================

function getSheet(sheetName = TYPE_SHEET_NAME) {
  try {
    const spreadsheet = SpreadsheetApp.openById(SHEET_ID);
    return spreadsheet.getSheetByName(sheetName);
  } catch (error) {
    console.log('[getSheet] openById ì‹¤íŒ¨, í™œì„± ì‹œíŠ¸ ì‚¬ìš©:', error.toString());
    const spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
    if (!spreadsheet) {
      throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Apps Scriptë¥¼ Google Sheetsì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
    }
    return spreadsheet.getSheetByName(sheetName);
  }
}

function getTypeSheetData() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = sheet.getDataRange().getValues();

  if (playerIndex.needsRebuild()) {
    playerIndex.build(data);
  }

  return data;
}

// ==================== í”Œë ˆì´ì–´ ê´€ë¦¬ í•¨ìˆ˜ ====================

function createPlayer(playerData) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  const tableNo = String(playerData.tableNo || '').trim();
  const seatNo = String(playerData.seatNo || '').trim();

  // ì¤‘ë³µ ì²´í¬
  const existingRow = playerIndex.findByKey(tableNo, seatNo);
  if (existingRow) {
    return {
      success: false,
      message: `Table ${tableNo} Seat ${seatNo}ì— ì´ë¯¸ í”Œë ˆì´ì–´ê°€ ìˆìŠµë‹ˆë‹¤`,
      action: 'duplicate_found'
    };
  }

  // ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€
  const newRow = [
    playerData.pokerRoom || '',
    playerData.tableName || '',
    tableNo,
    seatNo,
    playerData.name || '',
    playerData.nationality || '',
    playerData.chips || 0,
    playerData.keyplayer === true ? 'TRUE' : ''
  ];

  sheet.appendRow(newRow);
  playerIndex.clear(); // ì¸ë±ìŠ¤ ì¬ë¹Œë“œ í•„ìš”

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ ë“±ë¡ ì„±ê³µ',
    action: 'created'
  };
}

function updatePlayerInfo(tableNo, seatNo, playerName, updateData) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  const rowIndex = playerIndex.findByKey(tableNo, seatNo);
  if (!rowIndex) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'
    };
  }

  const row = data[rowIndex];
  if (row[TYPE_COLUMNS.PLAYERS] !== playerName) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'
    };
  }

  // ì—…ë°ì´íŠ¸í•  í•„ë“œë§Œ ìˆ˜ì •
  if (updateData.chips !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.CHIPS + 1).setValue(updateData.chips);
  }
  if (updateData.nationality !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.NATIONALITY + 1).setValue(updateData.nationality);
  }
  if (updateData.keyplayer !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.KEYPLAYER + 1)
      .setValue(updateData.keyplayer ? 'TRUE' : '');
  }
  if (updateData.pokerRoom !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.POKER_ROOM + 1).setValue(updateData.pokerRoom);
  }
  if (updateData.tableName !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.TABLE_NAME + 1).setValue(updateData.tableName);
  }

  playerIndex.clear();

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ ì •ë³´ ì—…ë°ì´íŠ¸ ì„±ê³µ',
    action: 'updated'
  };
}

function replacePlayer(tableNo, seatNo, newPlayerData) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  const rowIndex = playerIndex.findByKey(tableNo, seatNo);
  if (!rowIndex) {
    return createPlayer(newPlayerData);
  }

  // ê¸°ì¡´ í”Œë ˆì´ì–´ êµì²´
  const updatedRow = [
    newPlayerData.pokerRoom || '',
    newPlayerData.tableName || '',
    tableNo,
    seatNo,
    newPlayerData.name || '',
    newPlayerData.nationality || '',
    newPlayerData.chips || 0,
    newPlayerData.keyplayer === true ? 'TRUE' : ''
  ];

  const range = sheet.getRange(rowIndex + 1, 1, 1, 8);
  range.setValues([updatedRow]);

  playerIndex.clear();

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ êµì²´ ì„±ê³µ',
    action: 'replaced'
  };
}

function smartUpdatePlayer(playerData) {
  const tableNo = String(playerData.tableNo || '').trim();
  const seatNo = String(playerData.seatNo || '').trim();

  const data = getTypeSheetData();
  const existingRow = playerIndex.findByKey(tableNo, seatNo);

  if (!existingRow) {
    return createPlayer(playerData);
  }

  const currentPlayer = data[existingRow][TYPE_COLUMNS.PLAYERS];

  if (currentPlayer !== playerData.name) {
    if (playerData.forceReplace) {
      return replacePlayer(tableNo, seatNo, playerData);
    }

    return {
      success: false,
      action: 'need_confirm',
      message: 'ìë¦¬ì— ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ìˆìŠµë‹ˆë‹¤',
      currentPlayer: currentPlayer,
      newPlayer: playerData.name,
      tableNo: tableNo,
      seatNo: seatNo
    };
  }

  return updatePlayerInfo(tableNo, seatNo, playerData.name, playerData);
}

function deletePlayer(tableNo, seatNo, playerName) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  const rowIndex = playerIndex.findByKey(tableNo, seatNo);

  if (!rowIndex) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'
    };
  }

  if (playerName && data[rowIndex][TYPE_COLUMNS.PLAYERS] !== playerName) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'
    };
  }

  sheet.deleteRow(rowIndex + 1);
  playerIndex.clear();

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ ì‚­ì œ ì„±ê³µ',
    action: 'deleted'
  };
}

function getTablePlayers(tableNo) {
  const data = getTypeSheetData();
  const players = [];

  const rowIndices = playerIndex.findByTable(tableNo);

  for (const rowIndex of rowIndices) {
    const row = data[rowIndex];
    players.push({
      pokerRoom: row[TYPE_COLUMNS.POKER_ROOM],
      tableName: row[TYPE_COLUMNS.TABLE_NAME],
      tableNo: row[TYPE_COLUMNS.TABLE_NO],
      seatNo: row[TYPE_COLUMNS.SEAT_NO],
      name: row[TYPE_COLUMNS.PLAYERS],
      nationality: row[TYPE_COLUMNS.NATIONALITY],
      chips: row[TYPE_COLUMNS.CHIPS],
      keyplayer: row[TYPE_COLUMNS.KEYPLAYER] === 'TRUE'
    });
  }

  return players;
}

// ==================== ì‹œíŠ¸ ê´€ë¦¬ í•¨ìˆ˜ ====================

function clearTypeSheet() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const lastRow = sheet.getLastRow();

  if (lastRow > 1) {
    sheet.deleteRows(2, lastRow - 1);
  }

  playerIndex.clear();

  return {
    success: true,
    message: 'Type ì‹œíŠ¸ ì´ˆê¸°í™” ì™„ë£Œ'
  };
}

function sortTypeSheet() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const lastRow = sheet.getLastRow();

  if (lastRow > 1) {
    const range = sheet.getRange(2, 1, lastRow - 1, 8);
    range.sort([
      {column: TYPE_COLUMNS.TABLE_NO + 1, ascending: true},
      {column: TYPE_COLUMNS.SEAT_NO + 1, ascending: true}
    ]);
  }
}

function applyFullSheetStyle() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const range = sheet.getDataRange();

  range.setFontFamily('Roboto');
  range.setFontSize(11);
  range.setHorizontalAlignment('center');
  range.setVerticalAlignment('middle');

  const headerRange = sheet.getRange(1, 1, 1, 8);
  headerRange.setFontWeight('bold');
  headerRange.setBackground('#f0f0f0');

  return {
    success: true,
    message: 'ìŠ¤íƒ€ì¼ ì ìš© ì™„ë£Œ'
  };
}

// ==================== Config ì‹œíŠ¸ ê´€ë¦¬ ====================

function saveConfigToSheet(configType, value) {
  try {
    let sheet = getSheet(CONFIG_SHEET_NAME);
    if (!sheet) {
      const spreadsheet = SpreadsheetApp.openById(SHEET_ID);
      sheet = spreadsheet.insertSheet(CONFIG_SHEET_NAME);
      sheet.appendRow(['ConfigType', 'Value', 'UpdatedAt']);
    }

    const data = sheet.getDataRange().getValues();
    let configRow = -1;

    for (let i = 1; i < data.length; i++) {
      if (data[i][0] === configType) {
        configRow = i + 1;
        break;
      }
    }

    const now = new Date().toISOString();

    if (configRow > 0) {
      sheet.getRange(configRow, 2).setValue(value);
      sheet.getRange(configRow, 3).setValue(now);
    } else {
      sheet.appendRow([configType, value, now]);
    }

    return { success: true };
  } catch (error) {
    console.error('Config ì €ì¥ ì˜¤ë¥˜:', error);
    return { success: false, error: error.toString() };
  }
}

function getConfigFromSheet(configType) {
  try {
    const sheet = getSheet(CONFIG_SHEET_NAME);
    if (!sheet) return null;

    const data = sheet.getDataRange().getValues();

    for (let i = 1; i < data.length; i++) {
      if (data[i][0] === configType) {
        return data[i][1];
      }
    }

    return null;
  } catch (error) {
    console.error('Config ì¡°íšŒ ì˜¤ë¥˜:', error);
    return null;
  }
}

// ==================== í—¬í¼ í•¨ìˆ˜ ====================

function handleBatchUpdateEnhanced(data) {
  console.log('[v70] Enhanced ë°°ì¹˜ ì—…ë°ì´íŠ¸ ì‹œì‘');

  const tableNo = data.table || data.tableNo;
  const players = data.players || [];
  const deleted = data.deleted || [];

  let successCount = 0;
  let errorCount = 0;
  let replacedCount = 0;
  const results = [];

  // 1. ì‚­ì œ ì²˜ë¦¬
  for (const deletedPlayer of deleted) {
    try {
      const result = deletePlayer(
        tableNo,
        deletedPlayer.seatNo || deletedPlayer.seat,
        deletedPlayer.name
      );

      if (result.success) {
        successCount++;
      } else {
        errorCount++;
      }
      results.push(result);
    } catch (error) {
      errorCount++;
      console.error(`[v70] ì‚­ì œ ì˜¤ë¥˜: ${deletedPlayer.name}`, error);
    }
  }

  // 2. ì¶”ê°€/ì—…ë°ì´íŠ¸ ì²˜ë¦¬
  for (const player of players) {
    try {
      const playerData = convertToV70Structure(player, tableNo);
      playerData.forceReplace = data.forceReplace || false;

      const result = smartUpdatePlayer(playerData);

      if (result.success) {
        successCount++;
        if (result.action === 'replaced') {
          replacedCount++;
        }
      } else if (result.action === 'need_confirm') {
        errorCount++;
      } else {
        errorCount++;
      }

      results.push(result);
    } catch (error) {
      errorCount++;
      console.error(`[v70] ì²˜ë¦¬ ì˜¤ë¥˜: ${player.name}`, error);
    }
  }

  // 3. ì •ë ¬ ë° ìŠ¤íƒ€ì¼
  sortTypeSheet();
  applyFullSheetStyle();

  return {
    success: errorCount === 0,
    message: `ì²˜ë¦¬ ì™„ë£Œ: ì„±ê³µ ${successCount}, ì‹¤íŒ¨ ${errorCount}, êµì²´ ${replacedCount}`,
    successCount: successCount,
    errorCount: errorCount,
    replacedCount: replacedCount,
    results: results
  };
}

function convertToV70Structure(oldData, defaultTableNo) {
  console.log('[v70] ë°ì´í„° ë³€í™˜:', JSON.stringify(oldData));

  // ì¢Œì„ ë²ˆí˜¸ ì •ê·œí™”
  let seatNo = oldData.seatNo || oldData.seat || '';
  seatNo = seatNo.toString().replace(/^#0*/, '#');
  if (!seatNo.startsWith('#')) {
    seatNo = `#${seatNo}`;
  }

  // ì¹© íŒŒì‹±
  let chips = oldData.chips || 0;
  if (typeof chips === 'string') {
    chips = parseInt(chips.replace(/,/g, '')) || 0;
  }

  // keyplayer/notable ë³€í™˜
  let keyplayer = oldData.keyplayer;
  if (keyplayer === undefined && oldData.notable !== undefined) {
    keyplayer = oldData.notable;
  }

  return {
    pokerRoom: oldData.pokerRoom || '',
    tableName: oldData.tableName || '',
    tableNo: oldData.tableNo || oldData.table || defaultTableNo || '',
    seatNo: seatNo,
    name: oldData.name || oldData.player || '',
    nationality: oldData.nationality || '',
    chips: chips,
    keyplayer: keyplayer === true || keyplayer === 'TRUE',
    forceReplace: oldData.forceReplace || false
  };
}

console.log('[v70.0.0 ULTIMATE] HTML Service CORS ì™„ì „ í•´ê²° ë²„ì „ ë¡œë“œ ì™„ë£Œ');
</file>

<file path="apps-script/GeminiProxy.gs">
/**
 * Gemini API Proxy for Poker Hand Logger
 * Version: 1.0.0
 * Description: ì„œë²„ì‚¬ì´ë“œ API í‚¤ ë³´í˜¸ë¥¼ ìœ„í•œ í”„ë¡ì‹œ
 */

// API í‚¤ëŠ” Apps Script í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ ê´€ë¦¬
// File > Project Settings > Script Propertiesì—ì„œ GEMINI_API_KEY ì„¤ì •

function doPost(e) {
  try {
    // Script Propertiesì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
    const scriptProperties = PropertiesService.getScriptProperties();
    const GEMINI_API_KEY = scriptProperties.getProperty('GEMINI_API_KEY');

    if (!GEMINI_API_KEY) {
      return ContentService
        .createTextOutput(JSON.stringify({
          error: 'API key not configured',
          message: 'Please set GEMINI_API_KEY in Script Properties'
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }

    // ìš”ì²­ ë°ì´í„° íŒŒì‹±
    const requestData = JSON.parse(e.postData.contents);

    // ìš”ì²­ ê²€ì¦ (ì˜µì…˜)
    if (!requestData.contents || !Array.isArray(requestData.contents)) {
      return ContentService
        .createTextOutput(JSON.stringify({
          error: 'Invalid request format'
        }))
        .setMimeType(ContentService.MimeType.JSON);
    }

    // Gemini API í˜¸ì¶œ
    const apiUrl = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';

    const response = UrlFetchApp.fetch(apiUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-goog-api-key': GEMINI_API_KEY
      },
      payload: JSON.stringify(requestData),
      muteHttpExceptions: true
    });

    // ì‘ë‹µ ë°˜í™˜
    return ContentService
      .createTextOutput(response.getContentText())
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    console.error('Proxy error:', error);
    return ContentService
      .createTextOutput(JSON.stringify({
        error: 'Proxy error',
        message: error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// GET ìš”ì²­ ì²˜ë¦¬ (í…ŒìŠ¤íŠ¸ìš©)
function doGet(e) {
  return ContentService
    .createTextOutput(JSON.stringify({
      status: 'active',
      version: '1.0.0',
      description: 'Gemini API Proxy for Poker Hand Logger'
    }))
    .setMimeType(ContentService.MimeType.JSON);
}

// API í‚¤ ì„¤ì • í—¬í¼ í•¨ìˆ˜
function setApiKey(apiKey) {
  const scriptProperties = PropertiesService.getScriptProperties();
  scriptProperties.setProperty('GEMINI_API_KEY', apiKey);
  return 'API Key set successfully';
}

// API í‚¤ í™•ì¸ í•¨ìˆ˜ (ë””ë²„ê¹…ìš©)
function checkApiKey() {
  const scriptProperties = PropertiesService.getScriptProperties();
  const apiKey = scriptProperties.getProperty('GEMINI_API_KEY');
  return apiKey ? 'API Key is configured' : 'API Key is not configured';
}
</file>

<file path="docs/SETUP_API_SECURITY.md">
# API ë³´ì•ˆ ì„¤ì • ê°€ì´ë“œ

## ëª©ì 
í´ë¼ì´ì–¸íŠ¸ ì½”ë“œì— ë…¸ì¶œëœ Gemini API í‚¤ë¥¼ ì„œë²„ì‚¬ì´ë“œë¡œ ì´ë™í•˜ì—¬ ë³´ì•ˆ ê°•í™”

## ì„¤ì • ë‹¨ê³„

### 1. Google Apps Script í”„ë¡œì íŠ¸ ìƒì„±

1. [Google Apps Script](https://script.google.com) ì ‘ì†
2. "ìƒˆ í”„ë¡œì íŠ¸" í´ë¦­
3. í”„ë¡œì íŠ¸ ì´ë¦„ì„ "PokerHandLogger-GeminiProxy"ë¡œ ì„¤ì •

### 2. í”„ë¡ì‹œ ì½”ë“œ ë°°í¬

1. `apps-script/GeminiProxy.gs` íŒŒì¼ ë‚´ìš©ì„ ë³µì‚¬
2. Apps Script í¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ê¸°
3. ì €ì¥ (Ctrl+S)

### 3. API í‚¤ ì„¤ì •

1. Apps Script í¸ì§‘ê¸°ì—ì„œ:
   - íŒŒì¼ > í”„ë¡œì íŠ¸ ì„¤ì •
   - "ìŠ¤í¬ë¦½íŠ¸ ì†ì„±" ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
   - "ì†ì„± ì¶”ê°€" í´ë¦­

2. ë‹¤ìŒ ì •ë³´ ì…ë ¥:
   - ì†ì„±: `GEMINI_API_KEY`
   - ê°’: `ì—¬ê¸°ì—_ì‹¤ì œ_API_í‚¤_ì…ë ¥`

3. "ìŠ¤í¬ë¦½íŠ¸ ì†ì„± ì €ì¥" í´ë¦­

### 4. ì›¹ ì•±ìœ¼ë¡œ ë°°í¬

1. í¸ì§‘ê¸° ìƒë‹¨ì˜ "ë°°í¬" > "ìƒˆ ë°°í¬" í´ë¦­
2. ì„¤ì •:
   - ìœ í˜•: ì›¹ ì•±
   - ì„¤ëª…: "Gemini API Proxy v1"
   - ì‹¤í–‰: "ë‚˜"
   - ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì"
3. "ë°°í¬" í´ë¦­
4. **ì›¹ ì•± URL ë³µì‚¬** (ì¤‘ìš”!)

### 5. í´ë¼ì´ì–¸íŠ¸ ì„¤ì •

1. í¬ì»¤ í•¸ë“œ ë¡œê±° ì•± ì—´ê¸°
2. ì„¤ì • ë²„íŠ¼(âš™ï¸) í´ë¦­
3. "Gemini Proxy URL" í•„ë“œì— ë³µì‚¬í•œ URL ë¶™ì—¬ë„£ê¸°
4. ì €ì¥

## í™•ì¸ ì‚¬í•­

### âœ… ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] API í‚¤ê°€ ì½”ë“œì—ì„œ ì™„ì „íˆ ì œê±°ë¨
- [ ] Apps Script ì†ì„±ì— API í‚¤ ì €ì¥ë¨
- [ ] í”„ë¡ì‹œ URLì´ HTTPSë¡œ ì‹œì‘í•¨
- [ ] í…ŒìŠ¤íŠ¸ ì—°ê²° ì„±ê³µ

### ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

1. ê°œë°œì ë„êµ¬ ì½˜ì†” ì—´ê¸° (F12)
2. ë‹¤ìŒ ì½”ë“œ ì‹¤í–‰:
```javascript
await window.geminiClient.testConnection()
```

3. ì„±ê³µ ì‘ë‹µ í™•ì¸:
```javascript
{
  success: true,
  data: {
    status: 'active',
    version: '1.0.0'
  }
}
```

## ë¬¸ì œ í•´ê²°

### "API key not configured" ì—ëŸ¬
- Apps Script í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ GEMINI_API_KEY í™•ì¸
- ì†ì„± ì´ë¦„ ì² ì í™•ì¸

### "Proxy URL not configured" ì—ëŸ¬
- ì„¤ì •ì—ì„œ Proxy URL ì…ë ¥ í™•ì¸
- URL í˜•ì‹ í™•ì¸ (https://script.google.com/...)

### CORS ì—ëŸ¬
- Apps Script ë°°í¬ ì„¤ì •ì—ì„œ "ëª¨ë“  ì‚¬ìš©ì" ì„ íƒ í™•ì¸
- ìƒˆ ë²„ì „ìœ¼ë¡œ ì¬ë°°í¬ ì‹œë„

## ë³´ì•ˆ ê¶Œì¥ì‚¬í•­

1. **API í‚¤ ë¡œí…Œì´ì…˜**: 3ê°œì›”ë§ˆë‹¤ API í‚¤ ë³€ê²½
2. **ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§**: Google Cloud Consoleì—ì„œ API ì‚¬ìš©ëŸ‰ í™•ì¸
3. **ì ‘ê·¼ ì œí•œ**: í•„ìš”ì‹œ Apps Scriptì—ì„œ íŠ¹ì • ë„ë©”ì¸ë§Œ í—ˆìš©
4. **ë¡œê¹…**: ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í™œë™ ëª¨ë‹ˆí„°ë§

## ì›ë³µ ë°©ë²•

ê¸´ê¸‰ ìƒí™© ì‹œ ì´ì „ ë²„ì „ìœ¼ë¡œ ë³µì›:
1. `index.html`ì—ì„œ Line 1307ì˜ ì£¼ì„ í•´ì œ
2. `src/js/gemini-client.js` ì œê±°
3. ê¸°ì¡´ í•¨ìˆ˜ ì‚¬ìš©

---

**ì‘ì„±ì¼**: 2025-09-22
**ë²„ì „**: 1.0.0
</file>

<file path="src/js/gemini-client.js">
/**
 * Gemini API Client Module
 * Version: 1.0.0
 * Description: ì„œë²„ í”„ë¡ì‹œë¥¼ í†µí•œ ì•ˆì „í•œ Gemini API í˜¸ì¶œ
 */

class GeminiClient {
  constructor(proxyUrl) {
    this.proxyUrl = proxyUrl || localStorage.getItem('geminiProxyUrl');
    if (!this.proxyUrl) {
      console.warn('Gemini Proxy URL not configured');
    }
  }

  /**
   * í”„ë¡ì‹œ URL ì„¤ì •
   */
  setProxyUrl(url) {
    this.proxyUrl = url;
    localStorage.setItem('geminiProxyUrl', url);
  }

  /**
   * Gemini API í˜¸ì¶œ
   * @param {Array} contents - API ìš”ì²­ ë‚´ìš©
   * @param {Object} options - ì¶”ê°€ ì˜µì…˜
   */
  async generateContent(contents, options = {}) {
    if (!this.proxyUrl) {
      throw new Error('Proxy URL not configured. Please deploy Apps Script and set URL.');
    }

    try {
      const requestBody = {
        contents: contents,
        generationConfig: options.generationConfig || {
          temperature: 0.7,
          topK: 1,
          topP: 1,
          maxOutputTokens: 2048,
        },
        safetySettings: options.safetySettings || []
      };

      const response = await fetch(this.proxyUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'text/plain' // Apps Script ìš”êµ¬ì‚¬í•­
        },
        body: JSON.stringify(requestBody)
      });

      if (!response.ok) {
        throw new Error(`Proxy error: ${response.status}`);
      }

      const data = await response.json();

      // ì—ëŸ¬ ì²´í¬
      if (data.error) {
        throw new Error(data.error + ': ' + (data.message || ''));
      }

      return data;

    } catch (error) {
      console.error('Gemini API call failed:', error);
      throw error;
    }
  }

  /**
   * ì¹© ë¶„ì„ ìš”ì²­
   * @param {String} imageBase64 - Base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€
   * @param {Array} chipColors - ì¹© ìƒ‰ìƒ ì •ë³´
   */
  async analyzeChips(imageBase64, chipColors) {
    const prompt = `í¬ì»¤ ì¹© ìŠ¤íƒì„ ë¶„ì„í•´ì£¼ì„¸ìš”.
    ì¹© ìƒ‰ìƒê³¼ ê°’: ${JSON.stringify(chipColors)}
    ê° ìƒ‰ìƒë³„ ì¹© ê°œìˆ˜ì™€ ì´ ê¸ˆì•¡ì„ ê³„ì‚°í•´ì£¼ì„¸ìš”.`;

    const contents = [{
      parts: [
        { text: prompt },
        {
          inline_data: {
            mime_type: "image/jpeg",
            data: imageBase64.replace(/^data:image\/[a-z]+;base64,/, '')
          }
        }
      ]
    }];

    return await this.generateContent(contents);
  }

  /**
   * í”„ë¡ì‹œ ì—°ê²° í…ŒìŠ¤íŠ¸
   */
  async testConnection() {
    if (!this.proxyUrl) {
      return { success: false, error: 'Proxy URL not configured' };
    }

    try {
      const response = await fetch(this.proxyUrl);
      const data = await response.json();
      return { success: true, data: data };
    } catch (error) {
      return { success: false, error: error.message };
    }
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.geminiClient = new GeminiClient();

// ê¸°ì¡´ ì½”ë“œ í˜¸í™˜ì„±ì„ ìœ„í•œ ë˜í¼ í•¨ìˆ˜
window.callGeminiAPI = async function(imageBase64, chipColors) {
  try {
    // í”„ë¡ì‹œ URL í™•ì¸
    if (!window.geminiClient.proxyUrl) {
      const proxyUrl = prompt('Gemini í”„ë¡ì‹œ URLì„ ì…ë ¥í•˜ì„¸ìš”:\n(Apps Script ë°°í¬ í›„ ë°›ì€ URL)');
      if (proxyUrl) {
        window.geminiClient.setProxyUrl(proxyUrl);
      } else {
        throw new Error('í”„ë¡ì‹œ URLì´ í•„ìš”í•©ë‹ˆë‹¤');
      }
    }

    // API í˜¸ì¶œ
    const result = await window.geminiClient.analyzeChips(imageBase64, chipColors);

    // ì‘ë‹µ íŒŒì‹±
    if (result.candidates && result.candidates[0]) {
      const text = result.candidates[0].content.parts[0].text;
      return { success: true, analysis: text };
    } else {
      return { success: false, error: 'Invalid response format' };
    }

  } catch (error) {
    console.error('Gemini API error:', error);
    return { success: false, error: error.message };
  }
};
</file>

<file path="src/js/mobile-enhancer.js">
/**
 * ëª¨ë°”ì¼ ê²½í—˜ í–¥ìƒ ëª¨ë“ˆ
 * Version: 1.0.0
 * Description: ëª¨ë°”ì¼ ì „ìš© ìµœì í™” ë° ì œìŠ¤ì²˜ ì§€ì›
 */

class MobileEnhancer {
  constructor() {
    this.isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    this.isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    this.gestureHandlers = new Map();
    this.swipeThreshold = 50; // ìŠ¤ì™€ì´í”„ ìµœì†Œ ê±°ë¦¬
    this.pinchThreshold = 0.1; // í•€ì¹˜ ìµœì†Œ ë°°ìœ¨
  }

  /**
   * ëª¨ë°”ì¼ ìµœì í™” ì´ˆê¸°í™”
   */
  initialize() {
    if (!this.isMobile) {
      console.log('Desktop mode - Mobile enhancements skipped');
      return;
    }

    console.log('ğŸ“± Mobile Enhancer ì´ˆê¸°í™”');

    // 1. ë·°í¬íŠ¸ ìµœì í™”
    this.optimizeViewport();

    // 2. ì…ë ¥ í•„ë“œ ìµœì í™”
    this.optimizeInputFields();

    // 3. ì œìŠ¤ì²˜ ì¸ì‹ ì„¤ì •
    this.setupGestures();

    // 4. í–…í‹± í”¼ë“œë°± ì„¤ì •
    this.setupHapticFeedback();

    // 5. ì˜¤í”„ë¼ì¸ ì§€ì›
    this.setupOfflineSupport();

    // 6. í™”ë©´ ë°©í–¥ ì œì–´
    this.handleOrientation();

    // 7. iOS ì „ìš© ìµœì í™”
    if (this.isIOS) {
      this.optimizeForIOS();
    }
  }

  /**
   * 1. ë·°í¬íŠ¸ ìµœì í™”
   */
  optimizeViewport() {
    // ë·°í¬íŠ¸ ë©”íƒ€ íƒœê·¸ ìˆ˜ì •
    let viewport = document.querySelector('meta[name="viewport"]');
    if (!viewport) {
      viewport = document.createElement('meta');
      viewport.name = 'viewport';
      document.head.appendChild(viewport);
    }

    viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover';

    // ì•ˆì „ ì˜ì—­ ì²˜ë¦¬ (iPhone X+)
    document.documentElement.style.setProperty('--safe-area-inset-top', 'env(safe-area-inset-top)');
    document.documentElement.style.setProperty('--safe-area-inset-bottom', 'env(safe-area-inset-bottom)');

    // CSS ì¶”ê°€
    const style = document.createElement('style');
    style.textContent = `
      /* ì•ˆì „ ì˜ì—­ íŒ¨ë”© */
      body {
        padding-top: var(--safe-area-inset-top);
        padding-bottom: var(--safe-area-inset-bottom);
      }

      /* ëª¨ë°”ì¼ ë²„íŠ¼ í¬ê¸° ìµœì í™” */
      @media (max-width: 768px) {
        button, .btn {
          min-height: 44px;
          min-width: 44px;
          font-size: 16px;
        }

        input, select, textarea {
          font-size: 16px; /* iOS ì¤Œ ë°©ì§€ */
          min-height: 44px;
        }

        .modal {
          padding: 10px;
        }

        .modal-content {
          width: 100%;
          max-width: 100%;
          margin: 10px;
        }
      }

      /* ê°€ë¡œ ëª¨ë“œ ìµœì í™” */
      @media (orientation: landscape) and (max-height: 500px) {
        .header {
          display: none;
        }

        main {
          padding-top: 10px;
        }
      }

      /* í„°ì¹˜ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
      * {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
      }

      /* ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ê°œì„  */
      .scroll-container {
        -webkit-overflow-scrolling: touch;
        overflow-y: auto;
        transform: translateZ(0);
      }
    `;
    document.head.appendChild(style);
  }

  /**
   * 2. ì…ë ¥ í•„ë“œ ìµœì í™”
   */
  optimizeInputFields() {
    // ìˆ«ì ì…ë ¥ í•„ë“œ ì²˜ë¦¬
    document.querySelectorAll('input[type="number"]').forEach(input => {
      // ê°€ìƒ í‚¤ë³´ë“œ íƒ€ì… ì„¤ì •
      input.setAttribute('inputmode', 'numeric');
      input.setAttribute('pattern', '[0-9]*');

      // í¬ì»¤ìŠ¤ ì‹œ ì „ì²´ ì„ íƒ
      input.addEventListener('focus', (e) => {
        setTimeout(() => e.target.select(), 100);
      });

      // iOS ì¤Œ ë°©ì§€
      input.addEventListener('touchstart', (e) => {
        e.target.style.fontSize = '16px';
      });
    });

    // í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ìë™ ëŒ€ë¬¸ì ë¹„í™œì„±í™”
    document.querySelectorAll('input[type="text"]').forEach(input => {
      input.setAttribute('autocapitalize', 'off');
      input.setAttribute('autocomplete', 'off');
      input.setAttribute('autocorrect', 'off');
      input.setAttribute('spellcheck', 'false');
    });
  }

  /**
   * 3. ì œìŠ¤ì²˜ ì¸ì‹ ì„¤ì •
   */
  setupGestures() {
    let touchStartX = 0;
    let touchStartY = 0;
    let touchStartTime = 0;
    let touchEndX = 0;
    let touchEndY = 0;
    let initialDistance = 0;

    // ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜
    document.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
      touchStartTime = Date.now();

      // í•€ì¹˜ ì¤Œ ì´ˆê¸° ê±°ë¦¬
      if (e.touches.length === 2) {
        initialDistance = this.getDistance(e.touches[0], e.touches[1]);
      }
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      // í•€ì¹˜ ì¤Œ ì²˜ë¦¬
      if (e.touches.length === 2) {
        const currentDistance = this.getDistance(e.touches[0], e.touches[1]);
        const scale = currentDistance / initialDistance;

        if (Math.abs(scale - 1) > this.pinchThreshold) {
          this.handlePinch(scale);
        }
      }
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      touchEndX = e.changedTouches[0].clientX;
      touchEndY = e.changedTouches[0].clientY;
      const touchEndTime = Date.now();

      // ìŠ¤ì™€ì´í”„ ê°ì§€
      const deltaX = touchEndX - touchStartX;
      const deltaY = touchEndY - touchStartY;
      const deltaTime = touchEndTime - touchStartTime;

      if (deltaTime < 500) { // 500ms ì´ë‚´
        if (Math.abs(deltaX) > this.swipeThreshold && Math.abs(deltaX) > Math.abs(deltaY)) {
          // ìˆ˜í‰ ìŠ¤ì™€ì´í”„
          if (deltaX > 0) {
            this.handleSwipe('right');
          } else {
            this.handleSwipe('left');
          }
        } else if (Math.abs(deltaY) > this.swipeThreshold && Math.abs(deltaY) > Math.abs(deltaX)) {
          // ìˆ˜ì§ ìŠ¤ì™€ì´í”„
          if (deltaY > 0) {
            this.handleSwipe('down');
          } else {
            this.handleSwipe('up');
          }
        }
      }
    }, { passive: true });

    // ë¡± í”„ë ˆìŠ¤ ì œìŠ¤ì²˜
    let longPressTimer;
    document.addEventListener('touchstart', (e) => {
      longPressTimer = setTimeout(() => {
        this.handleLongPress(e.target);
      }, 500);
    }, { passive: true });

    document.addEventListener('touchend', () => {
      clearTimeout(longPressTimer);
    }, { passive: true });

    document.addEventListener('touchmove', () => {
      clearTimeout(longPressTimer);
    }, { passive: true });
  }

  getDistance(touch1, touch2) {
    const dx = touch1.clientX - touch2.clientX;
    const dy = touch1.clientY - touch2.clientY;
    return Math.sqrt(dx * dx + dy * dy);
  }

  handleSwipe(direction) {
    console.log(`ìŠ¤ì™€ì´í”„: ${direction}`);

    // í–…í‹± í”¼ë“œë°±
    this.triggerHaptic('light');

    // ìŠ¤ì™€ì´í”„ í•¸ë“¤ëŸ¬ ì‹¤í–‰
    const handler = this.gestureHandlers.get(`swipe-${direction}`);
    if (handler) {
      handler();
    }

    // ê¸°ë³¸ ë™ì‘
    switch (direction) {
      case 'left':
        // ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ
        if (window.state && window.state.currentStreet) {
          const streets = ['preflop', 'flop', 'turn', 'river'];
          const currentIndex = streets.indexOf(window.state.currentStreet);
          if (currentIndex < streets.length - 1) {
            window.state.currentStreet = streets[currentIndex + 1];
            if (typeof renderAll === 'function') renderAll();
          }
        }
        break;
      case 'right':
        // ì‹¤í–‰ ì·¨ì†Œ
        if (typeof undoLastAction === 'function') {
          undoLastAction(window.state.currentStreet);
        }
        break;
      case 'down':
        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ë‹¹ê²¨ì„œ ìƒˆë¡œê³ ì¹¨)
        if (window.scrollY === 0) {
          location.reload();
        }
        break;
    }
  }

  handlePinch(scale) {
    // í•€ì¹˜ ì¤Œ ì²˜ë¦¬
    if (scale > 1.2) {
      // í™•ëŒ€
      document.body.style.fontSize = '18px';
    } else if (scale < 0.8) {
      // ì¶•ì†Œ
      document.body.style.fontSize = '14px';
    }
  }

  handleLongPress(target) {
    // ë¡± í”„ë ˆìŠ¤ ë©”ë‰´
    this.triggerHaptic('medium');

    // í”Œë ˆì´ì–´ ì¹´ë“œì¸ ê²½ìš° ë¹ ë¥¸ ì•¡ì…˜ ë©”ë‰´
    if (target.closest('.player-card')) {
      this.showQuickActionMenu(target.closest('.player-card'));
    }
  }

  /**
   * 4. í–…í‹± í”¼ë“œë°±
   */
  setupHapticFeedback() {
    // ë²„íŠ¼ í´ë¦­ ì‹œ í–…í‹±
    document.addEventListener('click', (e) => {
      if (e.target.matches('button, .btn')) {
        this.triggerHaptic('light');
      }
    });

    // ì¤‘ìš” ì•¡ì…˜ ì‹œ ê°•í•œ í–…í‹±
    ['send-to-sheet-btn', 'reset-btn'].forEach(id => {
      const btn = document.getElementById(id);
      if (btn) {
        btn.addEventListener('click', () => {
          this.triggerHaptic('heavy');
        });
      }
    });
  }

  triggerHaptic(style = 'light') {
    // Vibration API ì‚¬ìš©
    if ('vibrate' in navigator) {
      switch (style) {
        case 'light':
          navigator.vibrate(10);
          break;
        case 'medium':
          navigator.vibrate(20);
          break;
        case 'heavy':
          navigator.vibrate([30, 10, 30]);
          break;
      }
    }

    // iOS Haptic Feedback (WebKit)
    if (window.webkit?.messageHandlers?.haptic) {
      window.webkit.messageHandlers.haptic.postMessage(style);
    }
  }

  /**
   * 5. ì˜¤í”„ë¼ì¸ ì§€ì›
   */
  setupOfflineSupport() {
    // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
    window.addEventListener('online', () => {
      this.showNotification('ì˜¨ë¼ì¸ ìƒíƒœë¡œ ì „í™˜ë¨', 'success');
    });

    window.addEventListener('offline', () => {
      this.showNotification('ì˜¤í”„ë¼ì¸ ëª¨ë“œ - ë°ì´í„°ê°€ ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤', 'warning');
    });

    // Service Worker ë“±ë¡
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js').catch(err => {
        console.log('Service Worker ë“±ë¡ ì‹¤íŒ¨:', err);
      });
    }
  }

  /**
   * 6. í™”ë©´ ë°©í–¥ ì œì–´
   */
  handleOrientation() {
    // ë°©í–¥ ë³€ê²½ ê°ì§€
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        this.adjustLayout();
      }, 100);
    });

    // ê°€ë¡œ ëª¨ë“œ ê²½ê³ 
    if (window.innerHeight < window.innerWidth && window.innerHeight < 500) {
      this.showNotification('ì„¸ë¡œ ëª¨ë“œì—ì„œ ë” ë‚˜ì€ ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤', 'info');
    }
  }

  adjustLayout() {
    const isLandscape = window.innerHeight < window.innerWidth;

    if (isLandscape && window.innerHeight < 500) {
      // ê°€ë¡œ ëª¨ë“œ ìµœì í™”
      document.body.classList.add('landscape-mode');
    } else {
      document.body.classList.remove('landscape-mode');
    }
  }

  /**
   * 7. iOS ì „ìš© ìµœì í™”
   */
  optimizeForIOS() {
    // ë°”ìš´ìŠ¤ ìŠ¤í¬ë¡¤ ë°©ì§€
    document.body.addEventListener('touchmove', (e) => {
      if (!e.target.closest('.scroll-container')) {
        e.preventDefault();
      }
    }, { passive: false });

    // í™ˆ í™”ë©´ ì¶”ê°€ ì•ˆë‚´
    if (!window.navigator.standalone) {
      const isIPad = navigator.userAgent.match(/iPad/);
      const isIPhone = navigator.userAgent.match(/iPhone/);

      if (isIPad || isIPhone) {
        setTimeout(() => {
          this.showAddToHomeScreen();
        }, 5000);
      }
    }

    // ìƒíƒœë°” ìŠ¤íƒ€ì¼
    const metaTag = document.createElement('meta');
    metaTag.name = 'apple-mobile-web-app-status-bar-style';
    metaTag.content = 'black-translucent';
    document.head.appendChild(metaTag);
  }

  showAddToHomeScreen() {
    if (localStorage.getItem('addToHomeShown')) return;

    const message = `
      <div style="padding: 15px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
        <h3 style="margin: 0 0 10px 0;">í™ˆ í™”ë©´ì— ì¶”ê°€</h3>
        <p style="margin: 0;">ê³µìœ  ë²„íŠ¼ â†’ "í™ˆ í™”ë©´ì— ì¶”ê°€"ë¡œ ì•±ì²˜ëŸ¼ ì‚¬ìš©í•˜ì„¸ìš”!</p>
        <button onclick="this.parentElement.remove(); localStorage.setItem('addToHomeShown', 'true');"
                style="margin-top: 10px; padding: 8px 16px; background: #007AFF; color: white; border: none; border-radius: 5px;">
          í™•ì¸
        </button>
      </div>
    `;

    const notification = document.createElement('div');
    notification.innerHTML = message;
    notification.style.cssText = 'position: fixed; bottom: 20px; left: 20px; right: 20px; z-index: 10000;';
    document.body.appendChild(notification);

    setTimeout(() => {
      notification.remove();
      localStorage.setItem('addToHomeShown', 'true');
    }, 15000);
  }

  /**
   * ë¹ ë¥¸ ì•¡ì…˜ ë©”ë‰´
   */
  showQuickActionMenu(playerCard) {
    const menu = document.createElement('div');
    menu.className = 'quick-action-menu';
    menu.innerHTML = `
      <button data-action="fold">Fold</button>
      <button data-action="check">Check</button>
      <button data-action="call">Call</button>
      <button data-action="raise">Raise</button>
      <button data-action="allin">All In</button>
    `;

    menu.style.cssText = `
      position: absolute;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      padding: 10px;
      z-index: 1000;
      display: flex;
      gap: 5px;
    `;

    playerCard.appendChild(menu);

    // ë©”ë‰´ í´ë¦­ ì²˜ë¦¬
    menu.addEventListener('click', (e) => {
      const action = e.target.dataset.action;
      if (action) {
        // ì•¡ì…˜ ì‹¤í–‰
        const playerName = playerCard.dataset.playerName;
        if (typeof addActionToLog === 'function') {
          addActionToLog(action, null, playerName);
        }
        menu.remove();
      }
    });

    // 3ì´ˆ í›„ ìë™ ì œê±°
    setTimeout(() => menu.remove(), 3000);
  }

  /**
   * ì•Œë¦¼ í‘œì‹œ
   */
  showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `mobile-notification ${type}`;
    notification.textContent = message;

    notification.style.cssText = `
      position: fixed;
      top: calc(var(--safe-area-inset-top) + 10px);
      left: 10px;
      right: 10px;
      padding: 12px;
      background: ${type === 'success' ? '#4CAF50' : type === 'warning' ? '#FF9800' : '#2196F3'};
      color: white;
      border-radius: 8px;
      z-index: 10000;
      text-align: center;
      animation: slideDown 0.3s ease-out;
    `;

    document.body.appendChild(notification);

    setTimeout(() => {
      notification.style.animation = 'slideUp 0.3s ease-in';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  /**
   * ì œìŠ¤ì²˜ í•¸ë“¤ëŸ¬ ë“±ë¡
   */
  registerGesture(gesture, handler) {
    this.gestureHandlers.set(gesture, handler);
  }
}

// CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
const animationStyle = document.createElement('style');
animationStyle.textContent = `
  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideUp {
    from {
      transform: translateY(0);
      opacity: 1;
    }
    to {
      transform: translateY(-100%);
      opacity: 0;
    }
  }

  .mobile-notification {
    animation: slideDown 0.3s ease-out;
  }

  .landscape-mode .header {
    display: none !important;
  }

  .landscape-mode main {
    padding-top: 5px !important;
  }
`;
document.head.appendChild(animationStyle);

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.mobileEnhancer = new MobileEnhancer();

// ì´ˆê¸°í™”
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    window.mobileEnhancer.initialize();
  });
} else {
  window.mobileEnhancer.initialize();
}
</file>

<file path="test.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í¬ì»¤ ë¡œê±° í…ŒìŠ¤íŠ¸ v3.5.28</title>
</head>
<body>
  <h1>í¬ì»¤ í•¸ë“œ ë¡œê±° v3.5.28 í…ŒìŠ¤íŠ¸</h1>
  <div id="test-results" style="font-family: monospace; white-space: pre;"></div>

  <script>
    const results = document.getElementById('test-results');
    let testCount = 0;
    let passCount = 0;
    let failCount = 0;

    function test(description, testFn) {
      testCount++;
      try {
        testFn();
        passCount++;
        results.textContent += `âœ… PASS: ${description}\n`;
      } catch(error) {
        failCount++;
        results.textContent += `âŒ FAIL: ${description}\n   Error: ${error.message}\n`;
      }
    }

    // í…ŒìŠ¤íŠ¸ ì‹œì‘
    results.textContent = '=== v3.5.28 í…ŒìŠ¤íŠ¸ ì‹œì‘ ===\n\n';

    // 1. ActionOrderManager ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸
    test('ActionOrderManager í´ë˜ìŠ¤ê°€ ì •ì˜ë˜ì–´ ìˆì–´ì•¼ í•¨', () => {
      if (!window.ActionOrderManager) {
        // index.htmlì„ iframeìœ¼ë¡œ ë¡œë“œí•´ì„œ í…ŒìŠ¤íŠ¸
        const iframe = document.createElement('iframe');
        iframe.src = 'index.html';
        iframe.style.display = 'none';
        document.body.appendChild(iframe);

        iframe.onload = function() {
          const iframeWindow = iframe.contentWindow;

          test('iframe ë‚´ ActionOrderManager ì¡´ì¬ í™•ì¸', () => {
            if (!iframeWindow.ActionOrderManager) {
              throw new Error('ActionOrderManagerê°€ ì •ì˜ë˜ì§€ ì•ŠìŒ');
            }
          });

          test('iframe ë‚´ window.actionManager ì´ˆê¸°í™” í™•ì¸', () => {
            if (!iframeWindow.actionManager) {
              throw new Error('window.actionManagerê°€ ì´ˆê¸°í™”ë˜ì§€ ì•ŠìŒ');
            }
          });

          test('iframe ë‚´ showFeedback ì „ì—­ ë“±ë¡ í™•ì¸', () => {
            if (typeof iframeWindow.showFeedback !== 'function') {
              throw new Error('window.showFeedbackì´ í•¨ìˆ˜ê°€ ì•„ë‹˜');
            }
          });

          test('iframe ë‚´ openCardSelector ì „ì—­ ë“±ë¡ í™•ì¸', () => {
            if (typeof iframeWindow.openCardSelector !== 'function') {
              throw new Error('window.openCardSelectorê°€ í•¨ìˆ˜ê°€ ì•„ë‹˜');
            }
          });

          // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½
          setTimeout(() => {
            results.textContent += '\n=== í…ŒìŠ¤íŠ¸ ê²°ê³¼ ===\n';
            results.textContent += `ì´ í…ŒìŠ¤íŠ¸: ${testCount}\n`;
            results.textContent += `í†µê³¼: ${passCount}\n`;
            results.textContent += `ì‹¤íŒ¨: ${failCount}\n`;
            results.textContent += `ì„±ê³µë¥ : ${(passCount/testCount*100).toFixed(1)}%\n`;

            if (failCount === 0) {
              results.textContent += '\nâœ¨ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! v3.5.28 ì•ˆì •ì ì…ë‹ˆë‹¤.\n';
            } else {
              results.textContent += '\nâš ï¸ ì¼ë¶€ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨. ì¶”ê°€ ìˆ˜ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.\n';
            }
          }, 1000);
        };
      }
    });
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/CHECKLIST.md">
# ğŸ° Virtual Data - Poker Hand Logger ì²´í¬ë¦¬ìŠ¤íŠ¸

> **ë²„ì „**: v3.4.20
> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-09-18
> **ëª©ì **: í¬ì»¤ í•¸ë“œ ë¡œê±° ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

---

## ğŸ”¥ **ì‹ ê·œ ì²´í¬ë¦¬ìŠ¤íŠ¸** - Type ì‹œíŠ¸ í—¤ë” êµ¬ì¡° ë³€ê²½ (Google Sheets)

### ğŸ¯ **ëª©í‘œ: Type ì‹œíŠ¸ë¥¼ ìƒˆë¡œìš´ í—¤ë” êµ¬ì¡°ë¡œ ë³€ê²½**
- **í˜„ì¬ ìƒíƒœ**: ê¸°ì¡´ Type ì‹œíŠ¸ í—¤ë” êµ¬ì¡°
- **ì›í•˜ëŠ” ìƒíƒœ**: A-G ì—´ì„ ìƒˆë¡œìš´ í—¤ë”ë¡œ ë³€ê²½í•˜ê³  Hì—´ ì´í›„ì— ê¸°ì¡´ ë‚´ìš© ë³´ì¡´
- **ìƒˆë¡œìš´ í—¤ë” êµ¬ì¡° (A-G ì—´)**:
  - A: **Poker Room** (í¬ì»¤ë£¸ëª…)
  - B: **Table Name** (í…Œì´ë¸”ëª…)
  - C: **Table No.** (í…Œì´ë¸” ë²ˆí˜¸)
  - D: **Seat No.** (ì¢Œì„ ë²ˆí˜¸)
  - E: **Players** (í”Œë ˆì´ì–´ëª…)
  - F: **Nationality** (êµ­ì )
  - G: **Chips** (ì¹© ìˆ˜ëŸ‰)

### ğŸ“‹ **êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **1. ê¸°ì¡´ Type ì‹œíŠ¸ ë°ì´í„° ë°±ì—…**
  - [ ] í˜„ì¬ í—¤ë” êµ¬ì¡° í™•ì¸ ë° ê¸°ë¡
  - [ ] ê¸°ì¡´ ë°ì´í„° ì „ì²´ ë°±ì—… ìƒì„±
  - [ ] Hì—´ ì´í›„ ê¸°ì¡´ ë‚´ìš© íŒŒì•… ë° ë³´ì¡´ ê³„íš

- [ ] **2. ìƒˆë¡œìš´ í—¤ë” êµ¬ì¡° ì ìš© (A-G ì—´)**
  - [ ] Aì—´: "Poker Room" í—¤ë” ì„¤ì •
  - [ ] Bì—´: "Table Name" í—¤ë” ì„¤ì •
  - [ ] Cì—´: "Table No." í—¤ë” ì„¤ì •
  - [ ] Dì—´: "Seat No." í—¤ë” ì„¤ì •
  - [ ] Eì—´: "Players" í—¤ë” ì„¤ì •
  - [ ] Fì—´: "Nationality" í—¤ë” ì„¤ì •
  - [ ] Gì—´: "Chips" í—¤ë” ì„¤ì •

- [ ] **3. ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜**
  - [ ] ê¸°ì¡´ ë°ì´í„°ë¥¼ ìƒˆë¡œìš´ í—¤ë” êµ¬ì¡°ì— ë§ê²Œ ë§¤í•‘
  - [ ] Hì—´ ì´í›„ ê¸°ì¡´ ë‚´ìš© ì¤‘ë³µ ì—†ì´ ë³´ì¡´
  - [ ] ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦

- [ ] **4. Apps Script ì½”ë“œ ì—…ë°ì´íŠ¸**
  - [ ] Type ì‹œíŠ¸ ì½ê¸° ë¡œì§ì„ ìƒˆë¡œìš´ í—¤ë” êµ¬ì¡°ì— ë§ê²Œ ìˆ˜ì •
  - [ ] ë°ì´í„° ì“°ê¸° ë¡œì§ë„ ìƒˆë¡œìš´ êµ¬ì¡°ì— ë§ê²Œ ì—…ë°ì´íŠ¸
  - [ ] í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ìˆ˜í–‰

- [ ] **5. í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ì—…ë°ì´íŠ¸**
  - [ ] í”„ë¡ íŠ¸ì—”ë“œì—ì„œ Type ì‹œíŠ¸ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ ìˆ˜ì •
  - [ ] ìƒˆë¡œìš´ í—¤ë” êµ¬ì¡°ì— ë§ëŠ” ë°ì´í„° í‘œì‹œ ë°©ì‹ ì ìš©
  - [ ] í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### âš ï¸ **ì£¼ì˜ì‚¬í•­**
- **ë°ì´í„° ì†ì‹¤ ë°©ì§€**: ê¸°ì¡´ ë°ì´í„°ëŠ” ë°˜ë“œì‹œ ë°±ì—… í›„ ì‘ì—…
- **ì ì§„ì  ì ìš©**: í—¤ë” ë³€ê²½ â†’ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ â†’ ì½”ë“œ ì—…ë°ì´íŠ¸ ìˆœì„œë¡œ ì§„í–‰
- **í˜¸í™˜ì„± ìœ ì§€**: Hì—´ ì´í›„ ê¸°ì¡´ ë‚´ìš©ê³¼ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ ì£¼ì˜

### ğŸ§ª **í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**
- [ ] **ë°±ì—… ë³µêµ¬ í…ŒìŠ¤íŠ¸**: ë°±ì—…ì—ì„œ ì›ë³¸ ë°ì´í„° ì™„ì „ ë³µêµ¬ ê°€ëŠ¥
- [ ] **ìƒˆë¡œìš´ êµ¬ì¡° í…ŒìŠ¤íŠ¸**: A-G ì—´ì´ ìƒˆë¡œìš´ í—¤ë”ë¡œ ì •ìƒ í‘œì‹œ
- [ ] **ë°ì´í„° ë§¤í•‘ í…ŒìŠ¤íŠ¸**: ê¸°ì¡´ ë°ì´í„°ê°€ ìƒˆë¡œìš´ êµ¬ì¡°ì— ì •í™•íˆ ë§¤í•‘
- [ ] **ì¤‘ë³µ ê²€ì‚¬**: Hì—´ ì´í›„ ë‚´ìš©ê³¼ ì¤‘ë³µ ì—†ìŒ í™•ì¸
- [ ] **Apps Script ì—°ë™**: ìƒˆë¡œìš´ êµ¬ì¡°ë¡œ ì½ê¸°/ì“°ê¸° ì •ìƒ ì‘ë™
- [ ] **í´ë¼ì´ì–¸íŠ¸ ì—°ë™**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ìƒˆë¡œìš´ ë°ì´í„° êµ¬ì¡° ì •ìƒ í‘œì‹œ

---

## âœ… **í•´ê²° ì™„ë£Œ** - ëª¨ë°”ì¼ í‚¤íŒ¨ë“œ í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ ì‘ë™ ë¶ˆê°€ (v3.4.17~v3.4.19)

### ğŸ”¥ **v3.4.17 ëª¨ë°”ì¼ í‚¤íŒ¨ë“œ ë²„íŠ¼ ë¬¸ì œ (URGENT)**
#### ğŸš¨ **ë¬¸ì œ ìƒí™©**
- **ì¦ìƒ**: PCì—ì„œëŠ” í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì´ ì •ìƒ ì‘ë™í•˜ì§€ë§Œ ìŠ¤ë§ˆíŠ¸í°ì—ì„œëŠ” ë™ì‘í•˜ì§€ ì•ŠìŒ
- **ì˜í–¥**: í‚¤íŒ¨ë“œ ì…ë ¥ í›„ ê°’ ì €ì¥/ì·¨ì†Œê°€ ë¶ˆê°€ëŠ¥í•˜ì—¬ ì•± ì‚¬ìš© ë¶ˆê°€
- **ì›ì¸ ì¶”ì •**: mousedown/touchstart ì´ë²¤íŠ¸ ì¶”ê°€ë¡œ ì¸í•œ í„°ì¹˜ ì´ë²¤íŠ¸ ì¶©ëŒ

#### ğŸ” **ì›ì¸ ë¶„ì„ ë° 1ì°¨ í•´ê²° ì‹œë„**
- [x] **1. í„°ì¹˜ ì´ë²¤íŠ¸ ì¶©ëŒ ë¬¸ì œ** âœ… **í•´ê²° ì™„ë£Œ**
  - **ë¬¸ì œ**: preventDefault()ê°€ í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì˜ í„°ì¹˜ ì´ë²¤íŠ¸ë„ ì°¨ë‹¨
  - **í•´ê²°ì±…**: í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ preventDefault() ì ìš©í•˜ë„ë¡ ì¡°ê±´ ì¶”ê°€
  - **êµ¬í˜„**: í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì€ í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬ì—ì„œ ì œì™¸

- [x] **2. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶©ëŒ** âœ… **í•´ê²° ì™„ë£Œ**
  - **ë¬¸ì œ**: mousedown/touchstartì™€ click ì´ë²¤íŠ¸ê°€ ë™ì‹œì— ë“±ë¡ë˜ì–´ ì¶©ëŒ
  - **í•´ê²°ì±…**: í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì—ëŠ” í„°ì¹˜ ì´ë²¤íŠ¸ ë“±ë¡í•˜ì§€ ì•Šë„ë¡ ë¶„ë¦¬
  - **êµ¬í˜„**: handleKeypadDownì—ì„œ í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì€ early return

- [âŒ] **3. 1ì°¨ í•´ê²° ì‹¤íŒ¨** - ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì—¬ì „íˆ ì‘ë™ ì•ˆí•¨

#### âœ… **ì›ì¸ ë°œê²¬!** - í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ í„°ì¹˜ ì§€ì—° ë¬¸ì œ
- **ì¦ìƒ**: ëª¨ë°”ì¼ì—ì„œ í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì„ ì˜¤ë˜ ëˆŒëŸ¬ì•¼ ë°˜ì‘í•¨
- **ì›ì¸**: ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì˜ 300ms í„°ì¹˜ ì§€ì—° + click ì´ë²¤íŠ¸ ëŒ€ê¸°
- **í•´ê²°ì±…**: í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ë„ touchstart ì´ë²¤íŠ¸ë¡œ ì¦‰ì‹œ ë°˜ì‘í•˜ë„ë¡ ë³€ê²½

#### âœ… **2ì°¨ í•´ê²° ì™„ë£Œ (v3.4.19)**
- [x] **ëª¨ë°”ì¼ 300ms í„°ì¹˜ ì§€ì—° ì™„ì „ ì œê±°**
  - **í•´ê²°ì±…**: í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ë„ touchstartì—ì„œ ì¦‰ì‹œ ì²˜ë¦¬
  - **êµ¬í˜„**: í„°ì¹˜ ì‹œ ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°± + 100ms í›„ click() íŠ¸ë¦¬ê±°
  - **íš¨ê³¼**: ëª¨ë°”ì¼ì—ì„œë„ í„°ì¹˜í•˜ìë§ˆì ì¦‰ì‹œ ë°˜ì‘

#### ğŸ› ï¸ **ìµœì¢… í•´ê²° ì½”ë“œ (v3.4.19)**
```javascript
// í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ ì¦‰ì‹œ ë°˜ì‘ ì²˜ë¦¬
if(btn.id === 'keypad-confirm' || btn.id === 'keypad-cancel') {
  // í„°ì¹˜ ì¦‰ì‹œ ë°˜ì‘ (300ms ì§€ì—° ì œê±°)
  btn.style.transform = 'scale(0.95)';
  btn.style.filter = 'brightness(1.2)';

  // ì¦‰ì‹œ í´ë¦­ ì‹¤í–‰
  setTimeout(() => {
    btn.style.transform = '';
    btn.style.filter = '';
    btn.click(); // ê¸°ì¡´ click ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
  }, 100);

  e.preventDefault(); // 300ms ì§€ì—° ë°©ì§€
  return;
}
```

- [ ] **2. ì´ë²¤íŠ¸ ì „íŒŒ ë¬¸ì œ**
  - **ë¬¸ì œ**: ëª¨ë‹¬ ë‚´ë¶€ ì´ë²¤íŠ¸ê°€ ìƒìœ„ë¡œ ì „íŒŒë˜ì–´ ì°¨ë‹¨ë¨
  - **í•´ê²°ì±…**: stopPropagation() ì¶”ê°€ ë° ì´ë²¤íŠ¸ ìº¡ì²˜ë§ í™•ì¸

- [ ] **3. CSS í„°ì¹˜ ì•¡ì…˜ ë¬¸ì œ**
  - **ë¬¸ì œ**: CSS touch-action ì†ì„±ìœ¼ë¡œ í„°ì¹˜ê°€ ì°¨ë‹¨ë¨
  - **í•´ê²°ì±…**: touch-action: manipulation ì¶”ê°€

- [ ] **4. ì™„ì „ ë¶„ë¦¬ëœ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ**
  - **ë¬¸ì œ**: ê°™ì€ ëª¨ë‹¬ì—ì„œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì¶©ëŒ
  - **í•´ê²°ì±…**: í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ë§Œì„ ìœ„í•œ ë³„ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ìƒì„±

#### ğŸ› ï¸ **ì¦‰ì‹œ ì ìš© í•´ê²°ì±… (1ì°¨ ì‹œë„)**
```javascript
function handleKeypadDown(e) {
  // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
  if(e.target === el.keypadModal) {
    closeModal(el.keypadModal);
    return;
  }

  const btn = e.target.closest('button');
  if(!btn) return;

  // í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì€ í„°ì¹˜ ì´ë²¤íŠ¸ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ (click ì´ë²¤íŠ¸ë§Œ ì‚¬ìš©)
  if(btn.id === 'keypad-confirm' || btn.id === 'keypad-cancel') {
    return; // ì´ë²¤íŠ¸ ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
  }

  // í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ preventDefault ì ìš©
  if(btn.classList.contains('keypad-btn')) {
    e.preventDefault(); // í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ í„°ì¹˜/í´ë¦­ ì¤‘ë³µ ë°©ì§€
  }

  // ë‚˜ë¨¸ì§€ ë¡œì§...
}
```

---

## âœ… **í•´ê²° ì™„ë£Œ** - í‚¤íŒ¨ë“œ ë°˜ì‘ì„± ì‹¬ê°í•œ ì§€ì—° ë¬¸ì œ (v3.4.17~v3.4.19)

### âš ï¸ **í‚¤íŒ¨ë“œ ì…ë ¥ ì‹œìŠ¤í…œ ë°˜ì‘ì„± ë¬¸ì œ (v3.4.16)**
#### ğŸ”¥ **ë¬¸ì œ ìƒí™©**
- **ì¦ìƒ**: ì¹© ë° íŒŸ ìˆ˜ì •í•˜ëŠ” ìˆ«ì ë²„íŠ¼ ì…ë ¥ì‹ ë°©ì‹ í´ë¦­ ë°˜ì‘ì„±ì´ ë§¤ìš° ëŠ¦ìŒ
- **êµ¬ì²´ì  ë¬¸ì œ**: ì—¬ëŸ¬ë²ˆ ëˆŒëŸ¬ë„ í•œë²ˆë§Œ ë°˜ì‘í•¨, ê°™ì€ ìˆ«ìëŠ” ë°”ë¡œ ë°˜ì‘í•˜ì§€ ì•ŠëŠ” ê²½ìš°ê°€ í›¨ì”¬ ë§ìŒ
- **ì˜í–¥ë„**: ê²Œì„ ì§„í–‰ ì†ë„ ì €í•˜, ì‚¬ìš©ì ê²½í—˜ ì‹¬ê°í•œ ì•…í™”
- **íŒŒì¼ ìœ„ì¹˜**: C:\claude\index.html ë¼ì¸ 5255-5400 (í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë¶€ë¶„)

#### ğŸ” **ì›ì¸ ë¶„ì„ ë° í•´ê²°ì±…**
- [ ] **1. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¤‘ë³µ ë¬¸ì œ í™•ì¸**
  - **ë¬¸ì œ**: í‚¤íŒ¨ë“œ ì—´ë¦´ ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆê°€ ì¶”ê°€ë˜ì–´ ì¤‘ë³µ ì‹¤í–‰
  - **í•´ê²°ì±…**: ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” ë¡œì§ êµ¬í˜„
  - **ì½”ë“œ ìœ„ì¹˜**: index.html:5255 `el.keypadModal.addEventListener('click', ...)`
  - **êµ¬í˜„ ë°©ë²•**: `removeEventListener()` ë˜ëŠ” `cloneNode(true)` ì‚¬ìš©

- [ ] **2. ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ìˆ˜ì¤€ ë°˜ì‘ì„± êµ¬í˜„**
  - **ë¬¸ì œ**: ë¹ ë¥¸ ì…ë ¥ì— ë°˜ì‘í•˜ì§€ ì•ŠìŒ (ëª¨ë“  ì°¨ë‹¨ ë¡œì§ì´ ë°˜ì‘ì„± ì €í•˜ ì›ì¸)
  - **í•´ê²°ì±…**: ëª¨ë“  í´ë¦­ì„ ì¦‰ì‹œ ì²˜ë¦¬, ë‹¨ìˆœíˆ ë¬¼ë¦¬ì  ëˆ„ë¦„ ìƒíƒœë§Œ êµ¬ë¶„
  - **ì½”ë“œ ìœ„ì¹˜**: keypad-btn ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  - **êµ¬í˜„ ë°©ë²•**: `mousedown`/`touchstart` â†’ `mouseup`/`touchend` ì´ë²¤íŠ¸ ìŒìœ¼ë¡œ ì²˜ë¦¬

- [ ] **3. ë²„íŠ¼ ìƒíƒœ ê´€ë¦¬ ìµœì í™”**
  - **ë¬¸ì œ**: í´ë¦­ í›„ ë²„íŠ¼ ìƒíƒœê°€ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ
  - **í•´ê²°ì±…**: í´ë¦­ ì‹œ ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°± ì œê³µ
  - **ì½”ë“œ ìœ„ì¹˜**: keypad-btn í´ë¦­ ì´ë²¤íŠ¸ ë‚´ë¶€
  - **êµ¬í˜„ ë°©ë²•**: `btn.disabled = true` í›„ ì²˜ë¦¬ ì™„ë£Œ ì‹œ `btn.disabled = false`

- [ ] **4. DOM ì¡°ì‘ ìµœì í™”**
  - **ë¬¸ì œ**: ë§¤ë²ˆ ìƒˆë¡œìš´ HTML ìƒì„±ìœ¼ë¡œ ì„±ëŠ¥ ì €í•˜
  - **í•´ê²°ì±…**: í‚¤íŒ¨ë“œ HTMLì„ ë¯¸ë¦¬ ìƒì„±í•˜ê³  ì¬ì‚¬ìš©
  - **ì½”ë“œ ìœ„ì¹˜**: openKeypad() í•¨ìˆ˜ ë‚´ë¶€ HTML ìƒì„± ë¶€ë¶„
  - **êµ¬í˜„ ë°©ë²•**: ì •ì  HTML í…œí”Œë¦¿ ì‚¬ìš© ë° ë°ì´í„°ë§Œ ë™ì  ì—…ë°ì´íŠ¸

- [ ] **5. ì´ë²¤íŠ¸ ìœ„ì„(Event Delegation) ì ìš©**
  - **ë¬¸ì œ**: ê°œë³„ ë²„íŠ¼ë§ˆë‹¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ìœ¼ë¡œ ë©”ëª¨ë¦¬ ë‚­ë¹„
  - **í•´ê²°ì±…**: ë¶€ëª¨ ìš”ì†Œì—ì„œ ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ì²˜ë¦¬
  - **ì½”ë“œ ìœ„ì¹˜**: keypad-modal ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
  - **êµ¬í˜„ ë°©ë²•**: `event.target.closest('.keypad-btn')` í™œìš©

- [ ] **6. í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™” (ëª¨ë°”ì¼ í™˜ê²½)**
  - **ë¬¸ì œ**: í„°ì¹˜ ì´ë²¤íŠ¸ì™€ í´ë¦­ ì´ë²¤íŠ¸ ì¤‘ë³µ ì²˜ë¦¬
  - **í•´ê²°ì±…**: í„°ì¹˜ í™˜ê²½ì—ì„œëŠ” í„°ì¹˜ ì´ë²¤íŠ¸ë§Œ ì‚¬ìš©
  - **ì½”ë“œ ìœ„ì¹˜**: keypad ë²„íŠ¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
  - **êµ¬í˜„ ë°©ë²•**: `touchstart` ì´ë²¤íŠ¸ ìš°ì„  ì²˜ë¦¬, `preventDefault()` í™œìš©

#### ğŸ› ï¸ **ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ìˆ˜ì¤€ ë°˜ì‘ì„± êµ¬í˜„ (Quick Fix)**
```javascript
// 1. ë²„íŠ¼ë³„ ëˆ„ë¦„ ìƒíƒœ ì¶”ì  (ì°¨ë‹¨ ì—†ì´ ìƒíƒœë§Œ ì¶”ì )
const buttonPressState = new Map();

// 2. ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ë°©ì‹: mousedown/touchstartì—ì„œ ì¦‰ì‹œ ì²˜ë¦¬
function setupKeypadEvents(keypadModal) {
  // ê¸°ì¡´ click ì´ë²¤íŠ¸ ì œê±°í•˜ê³  down/up ì´ë²¤íŠ¸ë¡œ êµì²´

  keypadModal.addEventListener('mousedown', handleKeypadDown, { passive: false });
  keypadModal.addEventListener('touchstart', handleKeypadDown, { passive: false });

  keypadModal.addEventListener('mouseup', handleKeypadUp);
  keypadModal.addEventListener('touchend', handleKeypadUp);
  keypadModal.addEventListener('mouseleave', handleKeypadUp); // ë“œë˜ê·¸ ì‹œ ì·¨ì†Œ
}

function handleKeypadDown(e) {
  const btn = e.target.closest('.keypad-btn');
  if (!btn) return;

  // ì´ë¯¸ ëˆŒë¦° ìƒíƒœë©´ ë¬´ì‹œ (ë¬¼ë¦¬ì  ëˆ„ë¦„ ìƒíƒœ ì²´í¬ë§Œ)
  if (buttonPressState.get(btn)) return;

  // ì¦‰ì‹œ ì²˜ë¦¬ - ì–´ë–¤ ì§€ì—°ë„ ì—†ìŒ
  buttonPressState.set(btn, true);

  // ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°± (ì• ë‹ˆë©”ì´ì…˜ë„ 0ms)
  btn.style.transform = 'scale(0.95)';
  btn.style.filter = 'brightness(1.2)';

  // ì¦‰ì‹œ ì…ë ¥ ì²˜ë¦¬ (ìŠ¤ë§ˆíŠ¸í°ì²˜ëŸ¼)
  processKeypadInputImmediate(btn);

  // í„°ì¹˜ ì´ë²¤íŠ¸ ì‹œ click ì¤‘ë³µ ë°©ì§€
  e.preventDefault();
}

function handleKeypadUp(e) {
  const btn = e.target.closest('.keypad-btn');
  if (!btn) return;

  // ëˆ„ë¦„ ìƒíƒœ í•´ì œ
  buttonPressState.set(btn, false);

  // ì‹œê°ì  ë³µêµ¬
  btn.style.transform = '';
  btn.style.filter = '';
}

// 3. ì¦‰ì‹œ ì…ë ¥ ì²˜ë¦¬ í•¨ìˆ˜ (ì§€ì—° ì—†ìŒ)
function processKeypadInputImmediate(btn) {
  const display = document.getElementById('keypad-display');
  const value = btn.textContent;

  // í˜„ì¬ ê°’ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
  let current = display.textContent || '0';

  if (value === 'C') {
    display.textContent = '0';
  } else if (value === 'â†') {
    display.textContent = current.length > 1 ? current.slice(0, -1) : '0';
  } else if (value === 'MAX') {
    // MAX ë¡œì§ ì¦‰ì‹œ ì²˜ë¦¬
    const playerChips = getCurrentPlayerChips();
    display.textContent = formatNumber(playerChips);
  } else {
    // ìˆ«ì ì…ë ¥ ì¦‰ì‹œ ì²˜ë¦¬
    const newValue = current === '0' ? value : current + value;
    display.textContent = formatNumber(newValue);
  }

  // ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ ì¦‰ì‹œ ë°˜ì˜ (DOM ê°•ì œ ë Œë”ë§)
  display.offsetHeight; // reflow ê°•ì œ ì‹¤í–‰
}
```

#### ğŸ§ª **í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤**
- [ ] **ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ìˆ˜ì¤€ í…ŒìŠ¤íŠ¸**: 1234567890ì„ ìµœëŒ€í•œ ë¹ ë¥´ê²Œ ì…ë ¥ â†’ ëª¨ë“  ìˆ«ì ì •í™•íˆ ì…ë ¥ í™•ì¸
- [ ] **ì—°ì† í´ë¦­ í…ŒìŠ¤íŠ¸**: ê°™ì€ ìˆ«ì ë²„íŠ¼ì„ ë¹ ë¥´ê²Œ 5ë²ˆ í´ë¦­ â†’ ì²« ë²ˆì§¸ë§Œ ì²˜ë¦¬, ë‚˜ë¨¸ì§€ëŠ” ëˆ„ë¦„ ìƒíƒœ ì²´í¬ë¡œ ë¬´ì‹œ í™•ì¸
- [ ] **ì´ˆê³ ì† ì…ë ¥ í…ŒìŠ¤íŠ¸**: ê³„ì‚°ê¸°ì•±ì²˜ëŸ¼ ì—„ì²­ ë¹ ë¥´ê²Œ ì…ë ¥ â†’ ëª¨ë“  ì…ë ¥ì´ ì¦‰ì‹œ ë°˜ì‘ í™•ì¸
- [ ] **ëª¨ë°”ì¼ í„°ì¹˜ í…ŒìŠ¤íŠ¸**: ìŠ¤ë§ˆíŠ¸í°ì—ì„œ í„°ì¹˜ ë°˜ì‘ì„±ì´ ë„¤ì´í‹°ë¸Œ í‚¤ë³´ë“œ ìˆ˜ì¤€ í™•ì¸
- [ ] **ë“œë˜ê·¸ ì·¨ì†Œ í…ŒìŠ¤íŠ¸**: ë²„íŠ¼ ëˆ„ë¥¸ í›„ ë“œë˜ê·¸ë¡œ ë²—ì–´ë‚˜ë©´ ì…ë ¥ ì·¨ì†Œ í™•ì¸

#### ğŸ”„ **ì„±ëŠ¥ ì¸¡ì • ê¸°ì¤€ (ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ìˆ˜ì¤€)**
- **ëª©í‘œ ë°˜ì‘ ì‹œê°„**: mousedown/touchstart í›„ ì¦‰ì‹œ (0-5ms ì´ë‚´)
- **ì—°ì† ì…ë ¥ ì„±ê³µë¥ **: 100% (ëª¨ë“  ì…ë ¥ ì²˜ë¦¬)
- **ì‹œê°ì  í”¼ë“œë°±**: ëˆ„ë¥´ëŠ” ìˆœê°„ ì¦‰ì‹œ ë²„íŠ¼ ë³€í™”
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: í‚¤íŒ¨ë“œ ì‚¬ìš© ì „í›„ ë©”ëª¨ë¦¬ ì¦ê°€ < 1MB

#### âœ… **êµ¬í˜„ ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [x] ê¸°ì¡´ click ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ)
- [x] mousedown/touchstart ì´ë²¤íŠ¸ ì¶”ê°€
- [x] mouseup/touchend/mouseleave ì´ë²¤íŠ¸ ì¶”ê°€
- [x] buttonPressState Map êµ¬í˜„
- [x] processKeypadInputImmediate í•¨ìˆ˜ êµ¬í˜„
- [x] DOM ê°•ì œ ë Œë”ë§ ë¡œì§ ì¶”ê°€ (display.offsetHeight)
- [x] ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°± êµ¬í˜„ (scale, brightness)
- [x] ë²„ì „ ì—…ë°ì´íŠ¸ (v3.4.17)
- [ ] ì‹¤ì œ í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

#### ğŸ”§ **êµ¬í˜„ ìƒì„¸ ë‚´ìš©**
- **ì´ë²¤íŠ¸ ë°©ì‹ ë³€ê²½**: click â†’ mousedown/touchstart (ëˆ„ë¥´ëŠ” ìˆœê°„ ì¦‰ì‹œ ë°˜ì‘)
- **ë¬¼ë¦¬ì  ëˆ„ë¦„ ìƒíƒœ ì¶”ì **: buttonPressState Mapìœ¼ë¡œ ê°™ì€ ë²„íŠ¼ ì—°ì† ëˆ„ë¦„ ë°©ì§€
- **ì¦‰ì‹œ ì²˜ë¦¬**: 0ms ì§€ì—° ì—†ì´ ë°”ë¡œ ì…ë ¥ ì²˜ë¦¬ ë° ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
- **ì‹œê°ì  í”¼ë“œë°±**: ëˆ„ë¥´ëŠ” ìˆœê°„ scale(0.95) + brightness(1.2) íš¨ê³¼
- **í„°ì¹˜ ìµœì í™”**: preventDefault()ë¡œ í„°ì¹˜/í´ë¦­ ì¤‘ë³µ ë°©ì§€
- **í˜¸í™˜ì„± ìœ ì§€**: í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì€ ê¸°ì¡´ click ì´ë²¤íŠ¸ ìœ ì§€

---

## ğŸš€ **ìµœìš°ì„  ì²´í¬ë¦¬ìŠ¤íŠ¸** - ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ë™ê¸°í™” (ëª¨ë“  ê¸°ê¸° ê³µìœ )

### ğŸ¯ **ëª©í‘œ: ëª¨ë“  PC/ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ë™ì¼í•œ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ê³µìœ **
- **í˜„ì¬ ë¬¸ì œ**: localStorageì—ë§Œ ì €ì¥ë˜ì–´ ê¸°ê¸°ë³„ë¡œ ê°œë³„ ê´€ë¦¬
- **ì›í•˜ëŠ” ìƒíƒœ**: í•œ ê³³ì—ì„œ URL ë“±ë¡í•˜ë©´ ëª¨ë“  ê¸°ê¸°ì—ì„œ ìë™ ì ìš©
- **êµ¬í˜„ ë°©ë²•**: Google Sheetsì— ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì €ì¥í•˜ì—¬ ì „ì—­ ë™ê¸°í™”

#### âœ… **êµ¬í˜„ ì™„ë£Œ (v3.4.20)**
- [x] **1. ì„œë²„ ì €ì¥ ê¸°ëŠ¥ êµ¬í˜„** âœ…
  - saveAppsScriptUrlToServer() í•¨ìˆ˜ êµ¬í˜„
  - ì„œë²„ ì €ì¥ ì„±ê³µ ì‹œ localStorage ë™ì‹œ ì—…ë°ì´íŠ¸
  - ì˜¤ë¥˜ ì²˜ë¦¬ ë° ë¡œì»¬ ì €ì¥ í´ë°± ê¸°ëŠ¥

- [x] **2. ì„œë²„ ë¶ˆëŸ¬ì˜¤ê¸° ê¸°ëŠ¥ êµ¬í˜„** âœ…
  - loadAppsScriptUrlFromServer() í•¨ìˆ˜ êµ¬í˜„
  - ì•± ì‹œì‘ ì‹œ ì„œë²„ì—ì„œ URL ìë™ ë¡œë“œ ë° ë™ê¸°í™”
  - ë¡œë”© ì‹¤íŒ¨ ì‹œ localStorage/ê¸°ë³¸ê°’ ì‚¬ìš©

- [x] **3. ë™ê¸°í™” UI ê°œì„ ** âœ…
  - "âœ… ëª¨ë“  ê¸°ê¸°ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤" ì„±ê³µ ë©”ì‹œì§€
  - ì‹¤ì‹œê°„ ë™ê¸°í™” ìƒíƒœ í‘œì‹œ (ì €ì¥ ì¤‘/ì„±ê³µ/ì‹¤íŒ¨)
  - ë„ì›€ë§ í…ìŠ¤íŠ¸ë¡œ ë™ê¸°í™” ê°œë… ì„¤ëª…

#### ğŸ› ï¸ **ê¸°ìˆ ì  êµ¬í˜„ ë°©ë²•**
```javascript
// 1. ì„œë²„ì— URL ì €ì¥
async function saveAppsScriptUrlToServer(url) {
  const response = await fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    body: JSON.stringify({
      action: 'saveConfig',
      configType: 'appsScriptUrl',
      value: url
    })
  });

  if (response.ok) {
    localStorage.setItem('appsScriptUrl', url);
    showFeedback('âœ… ëª¨ë“  ê¸°ê¸°ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤');
  }
}

// 2. ì„œë²„ì—ì„œ URL ë¡œë“œ
async function loadAppsScriptUrlFromServer() {
  try {
    const response = await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify({
        action: 'getConfig',
        configType: 'appsScriptUrl'
      })
    });

    const data = await response.json();
    if (data.appsScriptUrl) {
      localStorage.setItem('appsScriptUrl', data.appsScriptUrl);
      return data.appsScriptUrl;
    }
  } catch (error) {
    console.warn('ì„œë²„ì—ì„œ URL ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ ì„¤ì • ì‚¬ìš©');
  }

  return localStorage.getItem('appsScriptUrl') || DEFAULT_URL;
}
```

#### ğŸ“± **ì‹¤í˜„ëœ ì‚¬ìš©ì ê²½í—˜ (v3.4.20)**
1. **PCì—ì„œ URL ì„¤ì •** â†’ "ğŸŒ ì„œë²„ì— ì €ì¥ ì¤‘..." â†’ "âœ… ëª¨ë“  ê¸°ê¸° ì ìš© ì™„ë£Œ"
2. **ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ì•± ì—´ê¸°** â†’ "ğŸ“¡ ë™ê¸°í™” ì™„ë£Œ: https://script.google.com..." ë¡œê·¸ í‘œì‹œ
3. **ìƒˆ PCì—ì„œ ì ‘ì†** â†’ ìë™ìœ¼ë¡œ ì„œë²„ì—ì„œ URL ë¡œë“œ, ë³„ë„ ì„¤ì • ë¶ˆí•„ìš”

#### âš ï¸ **ì£¼ì˜ì‚¬í•­: Apps Script ì½”ë“œ ì—…ë°ì´íŠ¸ í•„ìš”**
í˜„ì¬ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë§Œ ì™„ì„±ë˜ì—ˆìœ¼ë©°, ì‹¤ì œ ì‘ë™ì„ ìœ„í•´ì„œëŠ” **Google Apps Scriptì— ë‹¤ìŒ ê¸°ëŠ¥ ì¶”ê°€ í•„ìš”**:

```javascript
// Apps Scriptì— ì¶”ê°€ í•„ìš”í•œ ì½”ë“œ
function doPost(e) {
  const data = JSON.parse(e.postData.contents);

  if (data.action === 'saveConfig') {
    // config ì‹œíŠ¸ì— ì„¤ì • ì €ì¥
    return saveConfigToSheet(data.configType, data.value);
  } else if (data.action === 'getConfig') {
    // config ì‹œíŠ¸ì—ì„œ ì„¤ì • ë¡œë“œ
    return getConfigFromSheet(data.configType);
  }

  // ê¸°ì¡´ ë¡œì§...
}

function saveConfigToSheet(configType, value) {
  const sheet = getConfigSheet();
  // configType(appsScriptUrl) = value ì €ì¥
}

function getConfigFromSheet(configType) {
  const sheet = getConfigSheet();
  // configType ê°’ ì¡°íšŒ í›„ ë°˜í™˜
}
```

---

## âœ… **í•´ê²° ì™„ë£Œ** - ê´€ë¦¬ ì„¤ì • ë¹„ì •ìƒ ì‘ë™ ë¬¸ì œ (v3.4.16)

### âš ï¸ **v3.4.15 ê´€ë¦¬ ì„¤ì • ê¸°ëŠ¥ ë¬¸ì œ í™•ì¸**
- [ ] **ê´€ë¦¬ ë²„íŠ¼ ì ‘ê·¼**: ë©”ì¸ í™”ë©´ì—ì„œ ê´€ë¦¬ ë²„íŠ¼ í´ë¦­ ì •ìƒ ì‘ë™
- [ ] **ê´€ë¦¬ ëª¨ë‹¬ ì—´ê¸°**: ê´€ë¦¬ ì„¤ì • ëª¨ë‹¬ì´ ì •ìƒì ìœ¼ë¡œ ì—´ë¦¼
- [ ] **ì¹© ì…ë ¥ ë¬¸ì œ**: í”Œë ˆì´ì–´ ì¹© ìˆ˜ì • ì‹œ ì •ìƒ ì…ë ¥ ë° ì €ì¥
  - [ ] ê¸°ì¡´ ì¹© ê°’ í‘œì‹œ ì •ìƒ
  - [ ] ìƒˆë¡œìš´ ì¹© ê°’ ì…ë ¥ ê°€ëŠ¥
  - [ ] ë³€ê²½ì‚¬í•­ ì„ì‹œ ì €ì¥ ì •ìƒ
  - [ ] ì¼ê´„ ë“±ë¡ ì‹œ ì„œë²„ ì „ì†¡ ì •ìƒ
- [ ] **í”Œë ˆì´ì–´ ìˆ˜ì • ë¬¸ì œ**: í”Œë ˆì´ì–´ ì •ë³´ ìˆ˜ì • ê¸°ëŠ¥ ì •ìƒ ì‘ë™
  - [ ] ì´ë¦„ ìˆ˜ì • ê°€ëŠ¥
  - [ ] ì¢Œì„ ë²ˆí˜¸ ë³€ê²½ ê°€ëŠ¥
  - [ ] ìˆ˜ì •ì‚¬í•­ UI ë°˜ì˜ ì •ìƒ
  - [ ] ë³€ê²½ì‚¬í•­ ì„œë²„ ë™ê¸°í™” ì •ìƒ
- [ ] **í”Œë ˆì´ì–´ ì‚­ì œ ë¬¸ì œ**: í”Œë ˆì´ì–´ ì‚­ì œ ê¸°ëŠ¥ ì •ìƒ ì‘ë™
  - [ ] ì‚­ì œ ë²„íŠ¼ ì •ìƒ ì‘ë™
  - [ ] ì‚­ì œ í™•ì¸ í”„ë¡œì„¸ìŠ¤ ì •ìƒ
  - [ ] UIì—ì„œ ì¦‰ì‹œ ì œê±° í‘œì‹œ
  - [ ] ì„œë²„ì—ì„œ ì‹¤ì œ ì‚­ì œ ì²˜ë¦¬
- [ ] **í”Œë ˆì´ì–´ ì¶”ê°€ ë¬¸ì œ**: ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ ê¸°ëŠ¥ ì •ìƒ ì‘ë™
  - [ ] ì¶”ê°€ ë²„íŠ¼ ë° í¼ ì •ìƒ ì‘ë™
  - [ ] ì¤‘ë³µ ê²€ì‚¬ ì •ìƒ ì‘ë™
  - [ ] ìƒˆ í”Œë ˆì´ì–´ UI ì¶”ê°€ í‘œì‹œ
  - [ ] ì„œë²„ ë™ê¸°í™” ì •ìƒ

### ğŸ” **ë¬¸ì œ ì¦ìƒ ìƒì„¸ ë¶„ì„ í•„ìš”**
- [ ] **JavaScript ì˜¤ë¥˜**: ì½˜ì†”ì—ì„œ ê´€ë¦¬ ì„¤ì • ê´€ë ¨ ì˜¤ë¥˜ í™•ì¸
- [ ] **ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ**: ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ê°€ ì •ìƒ ë°”ì¸ë”©ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] **ë°ì´í„° ë°”ì¸ë”©**: í”Œë ˆì´ì–´ ë°ì´í„°ê°€ UIì— ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
- [ ] **ì„œë²„ í†µì‹ **: Apps Scriptì™€ì˜ í†µì‹ ì´ ì •ìƒì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ëŠ”ì§€ í™•ì¸
- [ ] **ìƒíƒœ ê´€ë¦¬**: window.managementStateê°€ ì˜¬ë°”ë¥´ê²Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸

### ğŸ› ï¸ **ë””ë²„ê¹… ì²´í¬í¬ì¸íŠ¸**
- [ ] **ê´€ë¦¬ ëª¨ë‹¬ DOM**: ê´€ë¦¬ ëª¨ë‹¬ HTML ìš”ì†Œë“¤ì´ ì •ìƒ ë Œë”ë§ë¨
- [ ] **ë°ì´í„° ë¡œë”©**: í˜„ì¬ í…Œì´ë¸”ì˜ í”Œë ˆì´ì–´ ë°ì´í„°ê°€ ì •ìƒ ë¡œë”©ë¨
- [ ] **í¼ ê²€ì¦**: ì…ë ¥ í•„ë“œ ê²€ì¦ ë¡œì§ì´ ì •ìƒ ì‘ë™í•¨
- [ ] **ì¼ê´„ ì²˜ë¦¬**: batchUpdatePlayers í•¨ìˆ˜ê°€ ì •ìƒ í˜¸ì¶œë¨
- [ ] **ì‘ë‹µ ì²˜ë¦¬**: ì„œë²„ ì‘ë‹µì„ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ê³  UIì— ë°˜ì˜í•¨

---

## âœ… **í•´ê²° ì™„ë£Œ** - v3.4.15 ì¤‘ë³µ ê²€ì‚¬ ì§ì ‘ í˜¸ì¶œ

### âœ… **ì‚¬ìš©ì í™•ì¸ ì™„ë£Œ í•­ëª©**
- [x] **í˜ì´ì§€ ë¡œë“œ**: http://localhost:3000/ ì ‘ì† ì„±ê³µ âœ…
- [x] **ë²„ì „ í‘œì‹œ**: v3.4.13 ë²„ì „ì´ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë¨ âœ…
- [x] **ì¤‘ë³µ ê²€ì‚¬ ë¡œê·¸ ëª¨ë‹¬**: ì¤‘ë³µ ê²€ì‚¬ ê³¼ì •ì´ ë¡œê·¸ ëª¨ë‹¬ì— í‘œì‹œë¨ âœ…
- [x] **ì¤‘ë³µ ê²€ì‚¬ ìë™ ì‹œì‘ ë¡œì§**: í™•ì¸ ì™„ë£Œ âœ…

### âŒ **v3.4.14 í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ í™•ì¸**
- [âŒ] **ì¤‘ë³µ ì‹¤í–‰ ë¬¸ì œ**: ì—¬ì „íˆ ì½˜ì†”ì—ì„œ ì¤‘ë³µ ê²€ì‚¬ ë¡œê·¸ ì¶œë ¥ë¨
- [âŒ] **ì›ì¸**: `runDuplicateCheck` â†’ `removeDuplicatePlayers` ì´ì¤‘ í˜¸ì¶œ êµ¬ì¡°
- [âŒ] **ê·¼ë³¸ ë¬¸ì œ**: í˜¸ì¶œ ì²´ì¸ ë‹¨ìˆœí™” ì‹¤íŒ¨

### âœ… **v3.4.15 í•µì‹¬ ë¬¸ì œ í•´ê²° ì„±ê³µ** â­ **ìƒˆë¡œìš´ ì ‘ê·¼ ì™„ë£Œ**
- [x] **ì§ì ‘ í˜¸ì¶œ ë°©ì‹**: ë©”ì¸ ì•±ì—ì„œ `removeDuplicatePlayers(true)` ì§ì ‘ í˜¸ì¶œ âœ…
- [x] **ì´ì¤‘ ì‹¤í–‰ ì™„ì „ ì°¨ë‹¨**: ì½˜ì†”ì—ì„œ ì¤‘ë³µ ê²€ì‚¬ ë¡œê·¸ê°€ **1ë²ˆë§Œ** ì¶œë ¥ âœ…
- [x] **í†µí•© ë¡œê·¸ ëª¨ë‹¬**: ë©”ì¸ ì•± ë¡œê·¸ì™€ ì¤‘ë³µ ê²€ì‚¬ ë¡œê·¸ê°€ **ê°™ì€ ëª¨ë‹¬**ì— í‘œì‹œ âœ…
- [x] **ë¡œê·¸ ìˆœì„œ**: ë‹¤ìŒ ìˆœì„œë¡œ ë¡œê·¸ê°€ í‘œì‹œë¨ âœ…
  - [x] `ğŸ¯ í¬ì»¤ í•¸ë“œ ë¡œê±° v3.4.15` âœ…
  - [x] `ğŸ“… ì´ˆê¸°í™” ì‹œì‘` âœ…
  - [x] `âœ… v3.4.15 ì¤€ë¹„ ì™„ë£Œ!` âœ…
  - [x] `ğŸ” ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì‚¬ ì‹œì‘...` âœ…
  - [x] `[ì¤‘ë³µê²€ì‚¬] ì¤‘ë³µ ê²€ì‚¬ ì‹œì‘` âœ…
  - [x] `[ì¤‘ë³µê²€ì‚¬] ì„œë²„ ë°ì´í„° í™•ì¸ ì¤‘...` âœ…
  - [x] `âœ… ì¤‘ë³µ ì—†ìŒ - ì‹œíŠ¸ê°€ ê¹¨ë—í•©ë‹ˆë‹¤` (ë©”ì¸ ì•±ì—ì„œ ì¶œë ¥) âœ…
- [x] **ìë™ ëª¨ë‹¬ ë‹«ê¸°**: ëª¨ë“  ì´ˆê¸°í™” ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ ìë™ ë‹«ê¸° âœ…
- [x] **ì½˜ì†” ì •ë¦¬**: duplicate-remover.jsì—ì„œ ê°œë³„ ë¡œê·¸ ì¶œë ¥ì´ ì œê±°ë¨ âœ…

### âŒ **ì‹¤íŒ¨ ê³¼ì • ë° ì›ì¸ ë¶„ì„**
- [x] **1ì°¨ í•´ê²° (v3.4.13)**: í•¨ìˆ˜ ìŠ¤ì½”í”„ ë¬¸ì œ â†’ ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ âœ…
- [âŒ] **2ì°¨ í•´ê²° (v3.4.14)**: ì¤‘ë³µ ì‹¤í–‰ ë¬¸ì œ â†’ **ì‹¤íŒ¨** âŒ
  - **ì‹¤íŒ¨ ì›ì¸**: `runDuplicateCheck` â†’ `removeDuplicatePlayers` ì´ì¤‘ í˜¸ì¶œ êµ¬ì¡° ìœ ì§€
  - **ê·¼ë³¸ ë¬¸ì œ**: í˜¸ì¶œ ì²´ì¸ì„ ë‹¨ìˆœí™”í•˜ì§€ ì•Šê³  ì¤‘ê°„ í•¨ìˆ˜ ì‚¬ìš©
  - **ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ ê²°ê³¼**: ì½˜ì†”ì—ì„œ ì—¬ì „íˆ ì¤‘ë³µ ê²€ì‚¬ ë¡œê·¸ ì¶œë ¥ í™•ì¸
- [âœ…] **3ì°¨ í•´ê²° (v3.4.15)**: **ì™„ì „íˆ ë‹¤ë¥¸ ì ‘ê·¼** - ì§ì ‘ í˜¸ì¶œ ë°©ì‹ âœ… **ì„±ê³µ**
  - **ìƒˆë¡œìš´ ë°©ë²•**: ë©”ì¸ ì•±ì—ì„œ `removeDuplicatePlayers(true)` ì§ì ‘ í˜¸ì¶œ
  - **ê¸°ì¡´ê³¼ ì°¨ì´ì **: ì¤‘ê°„ í•¨ìˆ˜(`runDuplicateCheck`) ì œê±°ë¡œ ì´ì¤‘ ì‹¤í–‰ ì™„ì „ ì°¨ë‹¨
  - **ë°˜ë³µ ì—¬ë¶€**: âŒ **1-2ì°¨ì™€ ì™„ì „íˆ ë‹¤ë¥¸ ì ‘ê·¼ë²•**
  - **ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ ê²°ê³¼**: âœ… **í•´ê²° ì™„ë£Œ í™•ì¸**

---

## ğŸ“‹ ê¸°ë³¸ ê¸°ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
- [ ] **í˜ì´ì§€ ë¡œë“œ**: http://localhost:8000/ ì ‘ì† ì„±ê³µ
- [ ] **ë²„ì „ í‘œì‹œ**: v3.4.12 ë²„ì „ì´ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë¨
- [ ] **ì´ˆê¸°í™”**: ì•± ì´ˆê¸°í™” ë©”ì‹œì§€ê°€ ì½˜ì†”ì— ì¶œë ¥ë¨
- [ ] **UI ë¡œë“œ**: ëª¨ë“  UI ìš”ì†Œê°€ ì •ìƒì ìœ¼ë¡œ ë Œë”ë§ë¨

### ğŸ”„ ì¤‘ë³µ ê²€ì‚¬ ì‹œìŠ¤í…œ (DuplicateRemover v3.4.12)
- [ ] **ìë™ ì‹œì‘**: í˜ì´ì§€ ë¡œë“œ ì‹œ ì¤‘ë³µ ê²€ì‚¬ê°€ ìë™ìœ¼ë¡œ ì‹œì‘ë¨
- [ ] **ë¡œê·¸ ëª¨ë‹¬**: ì¤‘ë³µ ê²€ì‚¬ ì‹œì‘ ì‹œ ë¡œê·¸ ëª¨ë‹¬ì´ ìë™ìœ¼ë¡œ ì—´ë¦¼
- [ ] **ì§„í–‰ í‘œì‹œ**: ê²€ì‚¬ ê³¼ì •ì´ ë¡œê·¸ ëª¨ë‹¬ì— ì‹¤ì‹œê°„ìœ¼ë¡œ í‘œì‹œë¨
  - [ ] `[ì¤‘ë³µê²€ì‚¬] ì¤‘ë³µ ê²€ì‚¬ ì‹œì‘`
  - [ ] `[ì¤‘ë³µê²€ì‚¬] ì„œë²„ ë°ì´í„° í™•ì¸ ì¤‘...`
  - [ ] `[ì¤‘ë³µê²€ì‚¬] ğŸ“Š ì›ë³¸ ë°ì´í„° ë¶„ì„ ì‹œì‘...`
  - [ ] `[ì¤‘ë³µê²€ì‚¬] âœ… ê²€ì‚¬ ì™„ë£Œ`
- [ ] **ìë™ ë‹«ê¸°**: ê²€ì‚¬ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ì´ ìë™ìœ¼ë¡œ ë‹«í˜
- [ ] **ì¤‘ë³µ ì œê±°**: ì¤‘ë³µ í”Œë ˆì´ì–´ê°€ ë°œê²¬ë˜ë©´ ìë™ ì œê±°ë¨

### ğŸ‘¥ í”Œë ˆì´ì–´ ê´€ë¦¬
- [ ] **í…Œì´ë¸” ì„ íƒ**: í…Œì´ë¸” ë“œë¡­ë‹¤ìš´ì´ ì •ìƒ ì‘ë™í•¨
- [ ] **í”Œë ˆì´ì–´ ì¶”ê°€**: ìƒˆ í”Œë ˆì´ì–´ ë“±ë¡ì´ ì„±ê³µí•¨
- [ ] **í”Œë ˆì´ì–´ ìˆ˜ì •**: ê¸°ì¡´ í”Œë ˆì´ì–´ ì •ë³´ ìˆ˜ì •ì´ ê°€ëŠ¥í•¨
- [ ] **í”Œë ˆì´ì–´ ì‚­ì œ**: í”Œë ˆì´ì–´ ì‚­ì œê°€ ì •ìƒ ì‘ë™í•¨
- [ ] **IN/OUT ìƒíƒœ**: í”Œë ˆì´ì–´ ìƒíƒœ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ë°˜ì˜ë¨

### ğŸ´ ì¹´ë“œ ì„ íƒ ì‹œìŠ¤í…œ
- [ ] **ì¹´ë“œ ì„ íƒê¸°**: ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒ UIê°€ ì •ìƒ ì‘ë™í•¨
- [ ] **í…ìŠ¤íŠ¸ ì…ë ¥ ì œê±°**: í…ìŠ¤íŠ¸ ì¹´ë“œ ì…ë ¥ í•„ë“œê°€ ëª¨ë‘ ì œê±°ë¨
- [ ] **í„´/ë¦¬ë²„ ì¹´ë“œ**: ìŠ¤íŠ¸ë¦¿ ì§„í–‰ ì‹œ ì¹´ë“œ ì„ íƒ UI ì‚¬ìš©
- [ ] **ë³´ë“œ ì¹´ë“œ**: í”Œë/í„´/ë¦¬ë²„ ì¹´ë“œê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë¨

### ğŸ’° ì¹© ê´€ë¦¬
- [ ] **ì¹© ìŠ¤íƒ**: í”Œë ˆì´ì–´ë³„ ì¹© ìŠ¤íƒì´ ì •í™•íˆ í‘œì‹œë¨
- [ ] **ì¹© ë³€ë™**: ì•¡ì…˜ì— ë”°ë¥¸ ì¹© ë³€ë™ì´ ì˜¬ë°”ë¥´ê²Œ ê³„ì‚°ë¨
- [ ] **íŒŸ ê´€ë¦¬**: íŒŸ ì‚¬ì´ì¦ˆê°€ ì •í™•íˆ ê³„ì‚°ë¨
- [ ] **ì‚¬ì´ë“œ íŒŸ**: ì‚¬ì´ë“œ íŒŸì´ í•„ìš”í•œ ê²½ìš° ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë¨

### ğŸ“Š ë°ì´í„° ë™ê¸°í™”
- [ ] **Google Sheets ì—°ë™**: Apps Scriptì™€ ì •ìƒ ì—°ë™ë¨
- [ ] **ì‹¤ì‹œê°„ ë™ê¸°í™”**: ë°ì´í„° ë³€ê²½ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë¨
- [ ] **CSV ë¡œë”©**: CSV ë°ì´í„° ë¡œë”©ì´ ì„±ê³µí•¨
- [ ] **ì—ëŸ¬ ì²˜ë¦¬**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ë©”ì‹œì§€ í‘œì‹œ

---

## ğŸ”§ ê³ ê¸‰ ê¸°ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸ¤– AI ì¹© ë¶„ì„ (Gemini)
- [ ] **ì´ë¯¸ì§€ ë¶„ì„**: ì¹© ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ ì„±ê³µ
- [ ] **ì¹© ì¸ì‹**: AIê°€ ì¹© ìƒ‰ìƒê³¼ ê°œìˆ˜ë¥¼ ì •í™•íˆ ì¸ì‹
- [ ] **ê²°ê³¼ í‘œì‹œ**: ë¶„ì„ ê²°ê³¼ê°€ ëª…í™•í•˜ê²Œ í‘œì‹œë¨
- [ ] **ì˜¤ë¥˜ ì²˜ë¦¬**: ë¶„ì„ ì‹¤íŒ¨ ì‹œ ì ì ˆí•œ ë©”ì‹œì§€ í‘œì‹œ

### ğŸ“± ëª¨ë°”ì¼ ìµœì í™”
- [ ] **í„°ì¹˜ ì§€ì›**: í„°ì¹˜ ì œìŠ¤ì²˜ê°€ ì •ìƒ ì‘ë™í•¨
- [ ] **ë°˜ì‘í˜• UI**: ëª¨ë°”ì¼ í™”ë©´ì— ë§ê²Œ UI ì¡°ì •ë¨
- [ ] **ì„±ëŠ¥**: ëª¨ë°”ì¼ì—ì„œë„ ë¶€ë“œëŸ¬ìš´ ë™ì‘
- [ ] **ì˜¤í”„ë¼ì¸**: ì˜¤í”„ë¼ì¸ ìƒíƒœì—ì„œë„ ê¸°ë³¸ ê¸°ëŠ¥ ì‘ë™

### ğŸ¯ ì•¡ì…˜ ê´€ë¦¬
- [ ] **ì•¡ì…˜ íˆìŠ¤í† ë¦¬**: ëª¨ë“  ì•¡ì…˜ì´ íˆìŠ¤í† ë¦¬ì— ê¸°ë¡ë¨
- [ ] **ë˜ëŒë¦¬ê¸°**: ì•¡ì…˜ ë˜ëŒë¦¬ê¸° ê¸°ëŠ¥ ì‘ë™
- [ ] **ìŠ¤íŠ¸ë¦¿ ì§„í–‰**: ìŠ¤íŠ¸ë¦¿ ìë™ ì§„í–‰ì´ ìˆœì„œëŒ€ë¡œ ì‘ë™
- [ ] **í•¸ë“œ ì™„ë£Œ**: í•¸ë“œ ì¢…ë£Œ ì‹œ ì˜¬ë°”ë¥¸ ê²°ê³¼ ê¸°ë¡

---

## ğŸ› ë²„ê·¸ ë° ì˜¤ë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸš¨ ì¼ë°˜ì ì¸ ë²„ê·¸
- [ ] **JavaScript ì˜¤ë¥˜**: ì½˜ì†”ì— ì˜¤ë¥˜ ë©”ì‹œì§€ ì—†ìŒ
- [ ] **404 ì—ëŸ¬**: ëª¨ë“  ë¦¬ì†ŒìŠ¤ íŒŒì¼ì´ ì •ìƒ ë¡œë“œë¨
- [ ] **í•¨ìˆ˜ ë¯¸ì •ì˜**: ReferenceError ì—†ìŒ
- [ ] **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: ì¥ì‹œê°„ ì‚¬ìš©í•´ë„ ì„±ëŠ¥ ì €í•˜ ì—†ìŒ

### ğŸŒ **CORS ë° ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬**
#### âš ï¸ **ë¬¸ì œ ìœ í˜•**: `CORS policy: No 'Access-Control-Allow-Origin' header`
- **ë°œìƒ ì›ì¸**: Apps Scriptê°€ localhost:3000ì—ì„œì˜ ìš”ì²­ì„ í—ˆìš©í•˜ì§€ ì•ŠìŒ
- **ì˜í–¥ë„**: ì„œë²„ ë™ê¸°í™” ì™„ì „ ì°¨ë‹¨, ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œë§Œ ì‘ë™
- **ì—ëŸ¬ ë©”ì‹œì§€**: `ERR_FAILED`, `net::ERR_FAILED`

#### ğŸ” **ì§„ë‹¨ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **1. Apps Script URL ìœ íš¨ì„±**: URLì´ ì˜¬ë°”ë¥´ê³  ë°°í¬ëœ ìƒíƒœì¸ì§€ í™•ì¸
- [ ] **2. Apps Script ê¶Œí•œ**: ìŠ¤í¬ë¦½íŠ¸ê°€ ì›¹ ì•±ìœ¼ë¡œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] **3. ì‹¤í–‰ ê¶Œí•œ**: "ëˆ„êµ¬ë‚˜" ë˜ëŠ” "Google ê³„ì • ì‚¬ìš©ì"ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] **4. ë°°í¬ ìƒíƒœ**: ìƒˆ ë²„ì „ìœ¼ë¡œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
- [ ] **5. doPost í•¨ìˆ˜**: Apps Scriptì— doPost í•¨ìˆ˜ê°€ êµ¬í˜„ë˜ì—ˆëŠ”ì§€ í™•ì¸

#### ğŸ› ï¸ **í•´ê²° ë°©ë²•**
- [ ] **Option 1**: GitHub Pagesë¡œ ë°°í¬í•˜ì—¬ HTTPSì—ì„œ í…ŒìŠ¤íŠ¸
- [ ] **Option 2**: Apps Script ì¬ë°°í¬ (ìƒˆ URL ìƒì„±)
- [ ] **Option 3**: ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© CORS ìš°íšŒ (ê°œë°œ í™˜ê²½ë§Œ)
- [ ] **Option 4**: ê¸°ë³¸ Apps Script URL ì—…ë°ì´íŠ¸

#### ğŸ“‹ **ìš°ì„  í•´ê²°ì±…**
1. **ì¦‰ì‹œ í…ŒìŠ¤íŠ¸**: GitHub Pages (https://garimto81.github.io/virtual_data)ì—ì„œ í…ŒìŠ¤íŠ¸
2. **Apps Script í™•ì¸**: v66 ì½”ë“œê°€ ì˜¬ë°”ë¥´ê²Œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
3. **Config ì‹œíŠ¸**: initializeConfigSheet() í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸

### ğŸ”„ **ì¬ë°œ ë¬¸ì œ** - JavaScript ë¬¸ë²• ì—ëŸ¬ (SyntaxError)
#### âš ï¸ **ë¬¸ì œ ìœ í˜•**: `Uncaught SyntaxError: Unexpected end of input`
- **ë°œìƒ ìœ„ì¹˜**: index.html ë¼ì¸ 6874
- **ì›ì¸**: JavaScript ì½”ë“œ ë¸”ë¡ì´ ì™„ì „íˆ ë‹«íˆì§€ ì•ŠìŒ (ê´„í˜¸, ì¤‘ê´„í˜¸ ëˆ„ë½)
- **ì¬ë°œ ë¹ˆë„**: ì½”ë“œ í¸ì§‘ í›„ ìì£¼ ë°œìƒ
- **ì˜í–¥ë„**: ì „ì²´ JavaScript ì‹¤í–‰ ì¤‘ë‹¨, ì•± ê¸°ëŠ¥ ì™„ì „ ë§ˆë¹„

#### ğŸ” **ì§„ë‹¨ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **1. ì½”ë“œ ë¸”ë¡ ê²€ì¦**: ëª¨ë“  { } ê´„í˜¸ê°€ ì˜¬ë°”ë¥´ê²Œ ë‹«í˜”ëŠ”ì§€ í™•ì¸
- [ ] **2. í•¨ìˆ˜ ì„ ì–¸ ì™„ì„±**: í•¨ìˆ˜ ì„ ì–¸ì´ ì™„ì „íˆ ëë‚¬ëŠ”ì§€ í™•ì¸
- [ ] **3. ë¬¸ìì—´ ì¢…ë£Œ**: ë”°ì˜´í‘œ(' " `)ê°€ ì˜¬ë°”ë¥´ê²Œ ë‹«í˜”ëŠ”ì§€ í™•ì¸
- [ ] **4. ë°°ì—´/ê°ì²´ êµ¬ë¬¸**: [ ] ë° { } êµ¬ë¬¸ì´ ì™„ì „í•œì§€ í™•ì¸
- [ ] **5. ì£¼ì„ ë¸”ë¡**: /* */ ì£¼ì„ì´ ì˜¬ë°”ë¥´ê²Œ ë‹«í˜”ëŠ”ì§€ í™•ì¸

#### ğŸ› ï¸ **í•´ê²° ì ˆì°¨**
- [ ] **Step 1**: ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ì—ì„œ ì •í™•í•œ ë¼ì¸ ë²ˆí˜¸ í™•ì¸
- [ ] **Step 2**: í•´ë‹¹ ë¼ì¸ ì£¼ë³€ ì½”ë“œì—ì„œ ëˆ„ë½ëœ ê´„í˜¸ ì°¾ê¸°
- [ ] **Step 3**: ì½”ë“œ ì—ë””í„°ì˜ ê´„í˜¸ ë§¤ì¹­ ê¸°ëŠ¥ í™œìš©
- [ ] **Step 4**: ë¬¸ë²• ê²€ì¦ ë„êµ¬ë¡œ ì „ì²´ ì½”ë“œ ê²€ì‚¬
- [ ] **Step 5**: ìˆ˜ì • í›„ ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ í™•ì¸

#### ğŸ“‹ **ì˜ˆë°© ì¡°ì¹˜**
- [ ] **ì½”ë“œ í¬ë§¤íŒ…**: ë“¤ì—¬ì“°ê¸°ë¡œ ë¸”ë¡ êµ¬ì¡° ëª…í™•í™”
- [ ] **ì ì§„ì  í¸ì§‘**: í° ë³€ê²½ì‚¬í•­ì„ ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„í• 
- [ ] **ì¦‰ì‹œ í…ŒìŠ¤íŠ¸**: ì½”ë“œ ë³€ê²½ í›„ ë°”ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸
- [ ] **ë°±ì—… ìœ ì§€**: ì‘ë™í•˜ëŠ” ë²„ì „ ë³´ê´€

### ğŸ” ë°ì´í„° ë¬´ê²°ì„±
- [ ] **í”Œë ˆì´ì–´ ì¤‘ë³µ**: ì¤‘ë³µ í”Œë ˆì´ì–´ê°€ ìë™ìœ¼ë¡œ ì œê±°ë¨
- [ ] **ë°ì´í„° ì¼ê´€ì„±**: ë¡œì»¬ê³¼ ì„œë²„ ë°ì´í„°ê°€ ì¼ì¹˜í•¨
- [ ] **ìƒíƒœ ë™ê¸°í™”**: UI ìƒíƒœê°€ ì‹¤ì œ ë°ì´í„°ì™€ ì¼ì¹˜í•¨
- [ ] **ë°±ì—… ë³µêµ¬**: ë°ì´í„° ì†ì‹¤ ì‹œ ë³µêµ¬ ê°€ëŠ¥

### âš¡ ì„±ëŠ¥ ì´ìŠˆ
- [ ] **ë¡œë”© ì†ë„**: í˜ì´ì§€ ë¡œë”©ì´ 3ì´ˆ ì´ë‚´ ì™„ë£Œ
- [ ] **ì‘ë‹µì„±**: ì‚¬ìš©ì ì•¡ì…˜ì— ì¦‰ì‹œ ë°˜ì‘
- [ ] **ë°°ì¹˜ ì²˜ë¦¬**: ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ UI ë¸”ë¡ ì—†ìŒ
- [ ] **ìºì‹œ ì²˜ë¦¬**: ë¸Œë¼ìš°ì € ìºì‹œê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ğŸ“‹ ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤
1. **ì‹ ê·œ ê²Œì„ ì‹œì‘**
   - [ ] ìƒˆ í…Œì´ë¸” ìƒì„±
   - [ ] í”Œë ˆì´ì–´ 4ëª… ì¶”ê°€
   - [ ] ë¸”ë¼ì¸ë“œ ì„¤ì •
   - [ ] ì²« í•¸ë“œ ì‹œì‘

2. **ì¼ë°˜ì ì¸ í•¸ë“œ ì§„í–‰**
   - [ ] í”„ë¦¬í”Œë ì•¡ì…˜ ê¸°ë¡
   - [ ] í”Œë ì¹´ë“œ ì„ íƒ
   - [ ] ë² íŒ… ë¼ìš´ë“œ ì§„í–‰
   - [ ] í„´/ë¦¬ë²„ ì§„í–‰
   - [ ] í•¸ë“œ ê²°ê³¼ ê¸°ë¡

3. **íŠ¹ìˆ˜ ìƒí™© ì²˜ë¦¬**
   - [ ] ì˜¬ì¸ ìƒí™©
   - [ ] ì‚¬ì´ë“œ íŒŸ ìƒì„±
   - [ ] í”Œë ˆì´ì–´ IN/OUT
   - [ ] í…Œì´ë¸” ë³€ê²½

### ğŸ”„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
- [ ] **ì¥ì‹œê°„ ì‚¬ìš©**: 2ì‹œê°„ ì—°ì† ì‚¬ìš© í…ŒìŠ¤íŠ¸
- [ ] **ëŒ€ëŸ‰ ë°ì´í„°**: 100ê°œ ì´ìƒ í•¸ë“œ ê¸°ë¡
- [ ] **ë™ì‹œ ì•¡ì…˜**: ë¹ ë¥¸ ì—°ì† ì•¡ì…˜ ì²˜ë¦¬
- [ ] **ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •**: ì¸í„°ë„· ì—°ê²° ë¶ˆì•ˆì • ìƒí™©

---

## âœ… ë°°í¬ ë° ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸŒ GitHub Pages ë°°í¬
- [ ] **ì €ì¥ì†Œ ì—…ë°ì´íŠ¸**: ìµœì‹  ì½”ë“œê°€ GitHubì— í‘¸ì‹œë¨
- [ ] **Pages í™œì„±í™”**: GitHub Pagesê°€ ì •ìƒ ì‘ë™í•¨
- [ ] **ë„ë©”ì¸ ì ‘ê·¼**: garimto81.github.io/virtual_data ì ‘ê·¼ ê°€ëŠ¥
- [ ] **ë²„ì „ ì¼ì¹˜**: ë¡œì»¬ê³¼ ë°°í¬ ë²„ì „ì´ ì¼ì¹˜í•¨

### ğŸ” ë³´ì•ˆ ë° ê°œì¸ì •ë³´
- [ ] **API í‚¤ ë³´í˜¸**: ë¯¼ê°í•œ ì •ë³´ê°€ ë…¸ì¶œë˜ì§€ ì•ŠìŒ
- [ ] **HTTPS ì ìš©**: ë³´ì•ˆ ì—°ê²°ì´ ì ìš©ë¨
- [ ] **ë°ì´í„° ì•”í˜¸í™”**: ë¯¼ê°í•œ ë°ì´í„°ê°€ ì•”í˜¸í™”ë¨
- [ ] **ì ‘ê·¼ ì œì–´**: ê¶Œí•œ ì—†ëŠ” ì ‘ê·¼ì´ ì°¨ë‹¨ë¨

### ğŸ“ˆ ëª¨ë‹ˆí„°ë§
- [ ] **ì„±ëŠ¥ ì§€í‘œ**: ì‘ë‹µ ì‹œê°„ ëª¨ë‹ˆí„°ë§
- [ ] **ì˜¤ë¥˜ ë¡œê¹…**: ì˜¤ë¥˜ê°€ ì ì ˆíˆ ë¡œê¹…ë¨
- [ ] **ì‚¬ìš©ì í”¼ë“œë°±**: ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘ ì²´ê³„
- [ ] **ë²„ì „ ê´€ë¦¬**: ë²„ì „ë³„ ë³€ê²½ì‚¬í•­ ì¶”ì 

---

## ğŸ ìµœì¢… ìŠ¹ì¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### âœ¨ ì‚¬ìš©ì ê²½í—˜
- [ ] **ì§ê´€ì  ì¸í„°í˜ì´ìŠ¤**: ì‚¬ìš©ë²•ì´ ì§ê´€ì ì„
- [ ] **ë¹ ë¥¸ ì‘ë‹µ**: ëª¨ë“  ì•¡ì…˜ì´ ì¦‰ì‹œ ë°˜ì‘í•¨
- [ ] **ì˜¤ë¥˜ ìµœì†Œí™”**: ì‚¬ìš©ì ì˜¤ë¥˜ ê°€ëŠ¥ì„± ìµœì†Œí™”
- [ ] **í”¼ë“œë°± ì œê³µ**: ëª¨ë“  ì•¡ì…˜ì— ì ì ˆí•œ í”¼ë“œë°±

### ğŸ¯ ê¸°ëŠ¥ ì™„ì„±ë„
- [ ] **í•µì‹¬ ê¸°ëŠ¥**: ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ì´ ì™„ë²½ ì‘ë™
- [ ] **í™•ì¥ì„±**: ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ê°€ ìš©ì´í•¨
- [ ] **í˜¸í™˜ì„±**: ë‹¤ì–‘í•œ ë¸Œë¼ìš°ì €ì—ì„œ ì‘ë™
- [ ] **ì•ˆì •ì„±**: ì¥ì‹œê°„ ì‚¬ìš©í•´ë„ ì•ˆì •ì 

### ğŸ“š ë¬¸ì„œí™”
- [ ] **README ì—…ë°ì´íŠ¸**: ìµœì‹  ì •ë³´ë¡œ ì—…ë°ì´íŠ¸ë¨
- [ ] **ë³€ê²½ì´ë ¥**: ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ê¸°ë¡ë¨
- [ ] **ì‚¬ìš© ê°€ì´ë“œ**: ì‚¬ìš©ë²•ì´ ëª…í™•íˆ ë¬¸ì„œí™”ë¨
- [ ] **API ë¬¸ì„œ**: Google Apps Script API ì—°ë™ ë°©ë²• ê¸°ë¡

---

**âœ… ëª¨ë“  í•­ëª©ì„ ì²´í¬í•œ í›„ ìµœì¢… ë°°í¬ë¥¼ ì§„í–‰í•˜ì„¸ìš”!**

> **ì°¸ê³ **: ì´ ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” v3.4.12 ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ í•´ë‹¹ í•­ëª©ë“¤ì„ ì¶”ê°€ë¡œ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.
</file>

<file path="apps-script/Code.gs">
/**
 * Virtual Data - Poker Hand Logger
 * Google Apps Script Backend
 * Version: v71.0.4 ULTIMATE
 * Last Modified: 2025-09-23
 *
 * v71.0.4 ì—…ë°ì´íŠ¸ ë‚´ìš©:
 * - Config ì‹œíŠ¸ A1ì—ì„œ Apps Script URL ì½ê¸° ê¸°ëŠ¥ ì¶”ê°€
 * - getAppsScriptUrlFromConfig() í•¨ìˆ˜ ì¶”ê°€
 * - getConfigUrl ì•¡ì…˜ ì§€ì›
 *
 * v71.0.3 ì—…ë°ì´íŠ¸ ë‚´ìš©:
 * - Type ì‹œíŠ¸ ìë™ ìŠ¤íƒ€ì¼ ì ìš© (Roboto 11pt, ì¤‘ì•™ ì •ë ¬)
 * - í”Œë ˆì´ì–´ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ì‹œ ìë™ ìŠ¤íƒ€ì¼ ì ìš©
 * - ì„±ëŠ¥ ìµœì í™”: í–‰ë³„ ìŠ¤íƒ€ì¼ ì ìš© í•¨ìˆ˜ ì¶”ê°€
 *
 * v71.0.2 ì—…ë°ì´íŠ¸ ë‚´ìš©:
 * - CORS ë¬¸ì œ ì™„ë²½ í•´ê²°: HTML Service â†’ ContentService.JSON ë³€ê²½
 * - ìˆœìˆ˜ JSON APIë¡œ ì „í™˜
 * - í‘œì¤€ REST API ë°©ì‹ ì ìš©
 *
 * v71.0.1 ì—…ë°ì´íŠ¸ ë‚´ìš©:
 * - doGet/doPost í•¨ìˆ˜ undefined íŒŒë¼ë¯¸í„° ì²˜ë¦¬ ì¶”ê°€
 * - e.parameter null ì²´í¬ ê°•í™”
 *
 * v71 ì—…ë°ì´íŠ¸ ë‚´ìš©:
 * - PlayerIndex í´ë˜ìŠ¤ ê¸°ë°˜ ê³ ì† ê²€ìƒ‰
 * - ë°ì´í„° êµ¬ì¡° ì •ê·œí™” ì™„ë²½ ì§€ì›
 * - Config ì‹œíŠ¸ ì§€ì›
 * - ì¼ê´„ ì—…ë°ì´íŠ¸ ì„±ëŠ¥ ìµœì í™”
 *
 * Type ì‹œíŠ¸ êµ¬ì¡° (8ì—´):
 * A: Poker Room
 * B: Table Name
 * C: Table No
 * D: Seat No (#1, #2 í˜•ì‹)
 * E: Players (ì´ë¦„)
 * F: Nationality (êµ­ê°€ ì½”ë“œ)
 * G: Chips (ì¹© ìˆ˜ëŸ‰)
 * H: Keyplayer (TRUE/FALSE ë˜ëŠ” ë¹ˆê°’)
 */

// ==================== ì„¤ì • ë° ìƒìˆ˜ ====================

const SPREADSHEET_ID = '1gZN9S2rP5_U9zdxX1cJHBzBAl-Nup4PD4QXuW44rnSE'; // í•„ìš”ì‹œ ë³€ê²½
const TYPE_SHEET_NAME = 'Type';
const INDEX_SHEET_NAME = 'Index';
const HAND_SHEET_NAME = 'Hand';
const CONFIG_SHEET_NAME = 'Config';

// Type ì‹œíŠ¸ ì»¬ëŸ¼ ì¸ë±ìŠ¤ (0ë¶€í„° ì‹œì‘)
const TYPE_COLUMNS = {
  POKER_ROOM: 0,   // A: Poker Room
  TABLE_NAME: 1,   // B: Table Name
  TABLE_NO: 2,     // C: Table No
  SEAT_NO: 3,      // D: Seat No
  PLAYERS: 4,      // E: Players
  NATIONALITY: 5,  // F: Nationality
  CHIPS: 6,        // G: Chips
  KEYPLAYER: 7     // H: Keyplayer
};

// ë²„ì „ ì •ë³´
const VERSION_INFO = {
  version: '71.0.4',
  lastUpdate: '2025-09-23',
  features: [
    'CORS ì™„ë²½ í•´ê²° (ContentService.JSON)',
    'ìˆœìˆ˜ JSON REST API',
    'PlayerIndex í´ë˜ìŠ¤ ê³ ì† ê²€ìƒ‰',
    'ìƒˆë¡œìš´ Type ì‹œíŠ¸ êµ¬ì¡° (8ì»¬ëŸ¼)',
    'Config ì‹œíŠ¸ ì§€ì›',
    'ìŠ¤ë§ˆíŠ¸ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ',
    'ì¤‘ë³µ ì œê±° ìë™í™”',
    'FormData + URL ì¸ì½”ë”© ë™ì‹œ ì§€ì›'
  ]
};

// ==================== PlayerIndex í´ë˜ìŠ¤ ====================

class PlayerIndex {
  constructor() {
    this.indexByKey = new Map();
    this.indexByName = new Map();
    this.indexByTable = new Map();
    this.lastBuildTime = 0;
    this.cacheExpiry = 60000; // 1ë¶„
  }

  needsRebuild() {
    return Date.now() - this.lastBuildTime > this.cacheExpiry;
  }

  build(data) {
    console.log('[PlayerIndex] ì¸ë±ìŠ¤ ë¹Œë“œ ì‹œì‘');
    this.clear();

    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      if (!row || row.length < 8) continue;

      const tableNo = String(row[TYPE_COLUMNS.TABLE_NO] || '').trim();
      const seatNo = String(row[TYPE_COLUMNS.SEAT_NO] || '').trim();
      const name = String(row[TYPE_COLUMNS.PLAYERS] || '').trim();

      if (!tableNo || !name) continue; // seatNoëŠ” ì„ íƒì‚¬í•­

      const key = `${tableNo}_${seatNo}`;

      // í‚¤ ì¸ë±ìŠ¤
      if (seatNo) {
        this.indexByKey.set(key, i);
      }

      // ì´ë¦„ ì¸ë±ìŠ¤
      if (!this.indexByName.has(name)) {
        this.indexByName.set(name, []);
      }
      this.indexByName.get(name).push(i);

      // í…Œì´ë¸” ì¸ë±ìŠ¤
      if (!this.indexByTable.has(tableNo)) {
        this.indexByTable.set(tableNo, []);
      }
      this.indexByTable.get(tableNo).push(i);
    }

    this.lastBuildTime = Date.now();
    console.log(`[PlayerIndex] ë¹Œë“œ ì™„ë£Œ: ${this.indexByKey.size}ê°œ í‚¤, ${this.indexByName.size}ëª…`);
  }

  clear() {
    this.indexByKey.clear();
    this.indexByName.clear();
    this.indexByTable.clear();
  }

  findByKey(tableNo, seatNo) {
    const key = `${tableNo}_${seatNo}`;
    return this.indexByKey.get(key);
  }

  findByName(name, tableNo = null) {
    const rows = this.indexByName.get(name) || [];
    if (tableNo) {
      return rows.filter(row => {
        const tableRows = this.indexByTable.get(tableNo) || [];
        return tableRows.includes(row);
      });
    }
    return rows;
  }

  findByTable(tableNo) {
    return this.indexByTable.get(tableNo) || [];
  }
}

// ì „ì—­ ì¸ë±ìŠ¤ ì¸ìŠ¤í„´ìŠ¤
const playerIndex = new PlayerIndex();

// ==================== Config ì‹œíŠ¸ì—ì„œ URL ê°€ì ¸ì˜¤ê¸° ====================

function getAppsScriptUrlFromConfig() {
  try {
    const sheet = getSheet(CONFIG_SHEET_NAME);
    if (!sheet) {
      console.log('Config ì‹œíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
      return null;
    }

    // A1 ì…€ì—ì„œ URL ê°€ì ¸ì˜¤ê¸°
    const url = sheet.getRange('A1').getValue();
    if (url && url.toString().startsWith('http')) {
      console.log('Config ì‹œíŠ¸ì—ì„œ URL ë¡œë“œ:', url);
      return url.toString();
    }

    return null;
  } catch (error) {
    console.error('Config URL ë¡œë“œ ì˜¤ë¥˜:', error);
    return null;
  }
}

// ==================== CORS í•´ê²°ì„ ìœ„í•œ HTML Service ====================

function doGet(e) {
  // eê°€ undefinedì¸ ê²½ìš° ì²˜ë¦¬
  if (!e || !e.parameter) {
    return createCorsResponse({
      success: false,
      error: 'No parameters provided',
      version: VERSION_INFO.version
    });
  }

  const params = e.parameter;

  // POST ë°ì´í„° ì²˜ë¦¬ (GET íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœ ê²½ìš°)
  if (params.action && params.data) {
    try {
      const data = JSON.parse(params.data);
      data.action = params.action;

      const result = processAction(data);
      return createCorsResponse(result);

    } catch (error) {
      return createCorsResponse({
        success: false,
        message: error.toString(),
        stack: error.stack
      });
    }
  }

  // API í…ŒìŠ¤íŠ¸
  if (params.test === 'true') {
    return createCorsResponse({
      success: true,
      message: 'v71 Ultimate API í…ŒìŠ¤íŠ¸ ëª¨ë“œ',
      version: VERSION_INFO.version,
      features: VERSION_INFO.features,
      timestamp: new Date().toISOString(),
      configUrl: getAppsScriptUrlFromConfig()
    });
  }

  // Config ì‹œíŠ¸ì—ì„œ URL ê°€ì ¸ì˜¤ê¸° ìš”ì²­
  if (params.action === 'getConfigUrl') {
    return createCorsResponse({
      success: true,
      url: getAppsScriptUrlFromConfig(),
      version: VERSION_INFO.version
    });
  }

  // í…Œì´ë¸” ì¡°íšŒ
  if (params.table) {
    const players = getTablePlayers(params.table);
    return createCorsResponse({
      success: true,
      table: params.table,
      players: players,
      count: players.length,
      timestamp: new Date().toISOString()
    });
  }

  // Type ì‹œíŠ¸ ì¡°íšŒ (CSV)
  if (params.getTypeSheet === 'true') {
    return handleGetTypeSheet();
  }

  // ê¸°ë³¸ ì‘ë‹µ
  return createCorsResponse({
    success: true,
    message: 'v71 Ultimate API ì •ìƒ ì‘ë™ ì¤‘',
    version: VERSION_INFO.version,
    timestamp: new Date().toISOString()
  });
}

function doPost(e) {
  try {
    console.log('[v71] doPost ì‹œì‘:', new Date().toLocaleString());

    // eê°€ undefinedì¸ ê²½ìš° ì²˜ë¦¬
    if (!e) {
      return createCorsResponse({
        success: false,
        error: 'No request data provided',
        version: VERSION_INFO.version
      });
    }

    let data;

    // ìš”ì²­ ë°ì´í„° íŒŒì‹± (JSON ë˜ëŠ” FormData)
    if (e.postData && e.postData.contents) {
      try {
        data = JSON.parse(e.postData.contents);
      } catch (jsonError) {
        // FormData ë°©ì‹ íŒŒì‹±
        data = e.parameter || {};
        if (data.players) {
          data.players = JSON.parse(data.players);
        }
        if (data.deleted) {
          data.deleted = JSON.parse(data.deleted);
        }
      }
    } else {
      // URL ì¸ì½”ë”© ë°©ì‹
      data = e.parameter || {};
      if (data.players) {
        data.players = JSON.parse(data.players);
      }
      if (data.deleted) {
        data.deleted = JSON.parse(data.deleted);
      }
    }

    console.log('[v71] ìš”ì²­ ì•¡ì…˜:', data.action);

    const result = processAction(data);
    return createCorsResponse(result);

  } catch (error) {
    console.error('[v71] doPost ì˜¤ë¥˜:', error);
    return createCorsResponse({
      success: false,
      message: error.toString(),
      stack: error.stack
    });
  }
}

// ì•¡ì…˜ ì²˜ë¦¬ í†µí•© í•¨ìˆ˜
function processAction(data) {
  switch(data.action) {
    case 'batchUpdate':
      return handleBatchUpdateEnhanced(data);

    case 'getTypeSheet':
      return handleGetTypeSheetJSON();

    case 'createPlayer':
    case 'addPlayer':
      return createPlayer(convertToV71Structure(data, data.tableNo || data.table));

    case 'updatePlayer':
    case 'updatePlayerInfo':
      return updatePlayerInfo(
        data.tableNo || data.table,
        data.seatNo || data.seat,
        data.playerName || data.name || data.oldName,
        data.updateData || data
      );

    case 'replacePlayer':
      return replacePlayer(
        data.tableNo || data.table,
        data.seatNo || data.seat,
        convertToV71Structure(data, data.tableNo || data.table)
      );

    case 'smartUpdate':
      return smartUpdatePlayer(convertToV71Structure(data, data.tableNo || data.table));

    case 'deletePlayer':
      return deletePlayer(
        data.tableNo || data.table,
        data.seatNo || data.seat,
        data.playerName || data.name
      );

    case 'updatePlayerChips':
      return handleUpdatePlayerChips(data);

    case 'getTablePlayers':
      const players = getTablePlayers(data.tableNo || data.table);
      return {
        success: true,
        players: players,
        count: players.length
      };

    case 'getAllPlayers':
      return handleGetAllPlayers();

    case 'removeDuplicatePlayers':
    case 'removeDuplicates':
      return removeDuplicatePlayers();

    case 'sortTypeSheet':
      sortTypeSheet();
      return {
        success: true,
        message: 'Type ì‹œíŠ¸ ì •ë ¬ ì™„ë£Œ'
      };

    case 'clearSheet':
      return clearTypeSheet();

    case 'applyStyle':
      return applyFullSheetStyle();

    case 'saveConfig':
      return saveConfigToSheet(data.configType, data.value);

    case 'getConfig':
      return {
        success: true,
        value: getConfigFromSheet(data.configType)
      };

    default:
      return {
        success: false,
        message: `ì•Œ ìˆ˜ ì—†ëŠ” ì•¡ì…˜: ${data.action}`
      };
  }
}

// CORS ì‘ë‹µ ìƒì„± í•¨ìˆ˜
function createCorsResponse(data) {
  // ìˆœìˆ˜ JSON ì‘ë‹µ ë°˜í™˜ (CORS ìë™ ì²˜ë¦¬)
  return ContentService
    .createTextOutput(JSON.stringify(data))
    .setMimeType(ContentService.MimeType.JSON);
}

// ==================== Sheet ì ‘ê·¼ í•¨ìˆ˜ ====================

function getSheet(sheetName = TYPE_SHEET_NAME) {
  try {
    const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
    return spreadsheet.getSheetByName(sheetName);
  } catch (error) {
    console.log('[getSheet] openById ì‹¤íŒ¨, í™œì„± ì‹œíŠ¸ ì‚¬ìš©:', error.toString());
    const spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
    if (!spreadsheet) {
      throw new Error('ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Apps Scriptë¥¼ Google Sheetsì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
    }
    return spreadsheet.getSheetByName(sheetName);
  }
}

function getTypeSheetData() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = sheet.getDataRange().getValues();

  // í—¤ë”ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
  if (data.length === 0 || data[0][0] !== 'Poker Room') {
    sheet.insertRowBefore(1);
    sheet.getRange(1, 1, 1, 8).setValues([[
      'Poker Room', 'Table Name', 'Table No', 'Seat No',
      'Players', 'Nationality', 'Chips', 'Keyplayer'
    ]]);
    data.unshift(['Poker Room', 'Table Name', 'Table No', 'Seat No',
                   'Players', 'Nationality', 'Chips', 'Keyplayer']);
  }

  if (playerIndex.needsRebuild()) {
    playerIndex.build(data);
  }

  return data;
}

// ==================== Type ì‹œíŠ¸ ì¡°íšŒ ====================

function handleGetTypeSheet() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = sheet.getDataRange().getValues();

  return ContentService
    .createTextOutput(data.map(row => row.join(',')).join('\n'))
    .setMimeType(ContentService.MimeType.TEXT);
}

function handleGetTypeSheetJSON() {
  const data = getTypeSheetData();
  const players = [];

  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    if (!row || row.length < 8) continue;

    players.push({
      pokerRoom: row[TYPE_COLUMNS.POKER_ROOM],
      tableName: row[TYPE_COLUMNS.TABLE_NAME],
      tableNo: row[TYPE_COLUMNS.TABLE_NO],
      seatNo: row[TYPE_COLUMNS.SEAT_NO],
      name: row[TYPE_COLUMNS.PLAYERS],
      nationality: row[TYPE_COLUMNS.NATIONALITY],
      chips: row[TYPE_COLUMNS.CHIPS],
      keyplayer: row[TYPE_COLUMNS.KEYPLAYER] === 'TRUE' || row[TYPE_COLUMNS.KEYPLAYER] === true
    });
  }

  return {
    success: true,
    players: players,
    count: players.length
  };
}

// ==================== í”Œë ˆì´ì–´ ê´€ë¦¬ í•¨ìˆ˜ ====================

function createPlayer(playerData) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  const tableNo = String(playerData.tableNo || '').trim();
  const seatNo = String(playerData.seatNo || '').trim();
  const name = String(playerData.name || '').trim();

  // ì¤‘ë³µ ì²´í¬ (í…Œì´ë¸”+ì¢Œì„ ë˜ëŠ” í…Œì´ë¸”+ì´ë¦„)
  if (seatNo) {
    const existingRow = playerIndex.findByKey(tableNo, seatNo);
    if (existingRow) {
      return {
        success: false,
        message: `Table ${tableNo} Seat ${seatNo}ì— ì´ë¯¸ í”Œë ˆì´ì–´ê°€ ìˆìŠµë‹ˆë‹¤`,
        action: 'duplicate_found'
      };
    }
  }

  // ê°™ì€ í…Œì´ë¸”ì— ê°™ì€ ì´ë¦„ ì²´í¬
  const nameRows = playerIndex.findByName(name, tableNo);
  if (nameRows.length > 0) {
    return {
      success: false,
      message: `Table ${tableNo}ì— ${name} í”Œë ˆì´ì–´ê°€ ì´ë¯¸ ìˆìŠµë‹ˆë‹¤`,
      action: 'duplicate_name'
    };
  }

  // ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€
  const newRow = [
    playerData.pokerRoom || 'Merit Hall',
    playerData.tableName || 'Ocean Blue',
    tableNo,
    seatNo,
    name,
    playerData.nationality || '',
    playerData.chips || 0,
    playerData.keyplayer === true ? 'TRUE' : ''
  ];

  sheet.appendRow(newRow);
  playerIndex.clear(); // ì¸ë±ìŠ¤ ì¬ë¹Œë“œ í•„ìš”

  // ìƒˆë¡œ ì¶”ê°€ëœ í–‰ì— ìŠ¤íƒ€ì¼ ì ìš©
  const lastRow = sheet.getLastRow();
  applyRowStyle(sheet, lastRow);

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ ë“±ë¡ ì„±ê³µ',
    action: 'created'
  };
}

function updatePlayerInfo(tableNo, seatNo, playerName, updateData) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  let rowIndex = -1;

  // ì¢Œì„ ë²ˆí˜¸ê°€ ìˆìœ¼ë©´ í‚¤ë¡œ ê²€ìƒ‰
  if (seatNo) {
    rowIndex = playerIndex.findByKey(tableNo, seatNo);
  } else if (playerName) {
    // ì¢Œì„ ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰
    const nameRows = playerIndex.findByName(playerName, tableNo);
    if (nameRows.length === 1) {
      rowIndex = nameRows[0];
    } else if (nameRows.length > 1) {
      return {
        success: false,
        message: 'ê°™ì€ ì´ë¦„ì˜ í”Œë ˆì´ì–´ê°€ ì—¬ëŸ¬ ëª… ìˆìŠµë‹ˆë‹¤. ì¢Œì„ ë²ˆí˜¸ë¥¼ ì§€ì •í•´ì£¼ì„¸ìš”.'
      };
    }
  }

  if (!rowIndex || rowIndex < 0) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'
    };
  }

  const row = data[rowIndex];

  // ì´ë¦„ í™•ì¸ (ì„ íƒì‚¬í•­)
  if (playerName && row[TYPE_COLUMNS.PLAYERS] !== playerName) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'
    };
  }

  // ì—…ë°ì´íŠ¸í•  í•„ë“œë§Œ ìˆ˜ì •
  if (updateData.chips !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.CHIPS + 1).setValue(updateData.chips);
  }
  if (updateData.nationality !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.NATIONALITY + 1).setValue(updateData.nationality);
  }
  if (updateData.keyplayer !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.KEYPLAYER + 1)
      .setValue(updateData.keyplayer ? 'TRUE' : '');
  }
  if (updateData.pokerRoom !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.POKER_ROOM + 1).setValue(updateData.pokerRoom);
  }
  if (updateData.tableName !== undefined) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.TABLE_NAME + 1).setValue(updateData.tableName);
  }
  if (updateData.name !== undefined && updateData.name !== row[TYPE_COLUMNS.PLAYERS]) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.PLAYERS + 1).setValue(updateData.name);
  }
  if (updateData.seatNo !== undefined && updateData.seatNo !== row[TYPE_COLUMNS.SEAT_NO]) {
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.SEAT_NO + 1).setValue(updateData.seatNo);
  }

  playerIndex.clear();

  // ìˆ˜ì •ëœ í–‰ì— ìŠ¤íƒ€ì¼ ì ìš©
  applyRowStyle(sheet, rowIndex + 1);

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ ì •ë³´ ì—…ë°ì´íŠ¸ ì„±ê³µ',
    action: 'updated'
  };
}

function replacePlayer(tableNo, seatNo, newPlayerData) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  const rowIndex = playerIndex.findByKey(tableNo, seatNo);
  if (!rowIndex) {
    return createPlayer(newPlayerData);
  }

  // ê¸°ì¡´ í”Œë ˆì´ì–´ êµì²´
  const updatedRow = [
    newPlayerData.pokerRoom || 'Merit Hall',
    newPlayerData.tableName || 'Ocean Blue',
    tableNo,
    seatNo,
    newPlayerData.name || '',
    newPlayerData.nationality || '',
    newPlayerData.chips || 0,
    newPlayerData.keyplayer === true ? 'TRUE' : ''
  ];

  const range = sheet.getRange(rowIndex + 1, 1, 1, 8);
  range.setValues([updatedRow]);

  playerIndex.clear();

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ êµì²´ ì„±ê³µ',
    action: 'replaced'
  };
}

function smartUpdatePlayer(playerData) {
  const tableNo = String(playerData.tableNo || '').trim();
  const seatNo = String(playerData.seatNo || '').trim();
  const name = String(playerData.name || '').trim();

  const data = getTypeSheetData();

  // ì¢Œì„ì´ ìˆëŠ” ê²½ìš°
  if (seatNo) {
    const existingRow = playerIndex.findByKey(tableNo, seatNo);

    if (!existingRow) {
      return createPlayer(playerData);
    }

    const currentPlayer = data[existingRow][TYPE_COLUMNS.PLAYERS];

    if (currentPlayer !== name) {
      if (playerData.forceReplace) {
        return replacePlayer(tableNo, seatNo, playerData);
      }

      return {
        success: false,
        action: 'need_confirm',
        message: 'ìë¦¬ì— ë‹¤ë¥¸ í”Œë ˆì´ì–´ê°€ ìˆìŠµë‹ˆë‹¤',
        currentPlayer: currentPlayer,
        newPlayer: name,
        tableNo: tableNo,
        seatNo: seatNo
      };
    }

    return updatePlayerInfo(tableNo, seatNo, name, playerData);
  }

  // ì¢Œì„ì´ ì—†ëŠ” ê²½ìš° - ì´ë¦„ìœ¼ë¡œ ì°¾ê±°ë‚˜ ìƒˆë¡œ ìƒì„±
  const nameRows = playerIndex.findByName(name, tableNo);
  if (nameRows.length === 1) {
    const row = data[nameRows[0]];
    return updatePlayerInfo(tableNo, row[TYPE_COLUMNS.SEAT_NO], name, playerData);
  } else if (nameRows.length > 1) {
    return {
      success: false,
      message: 'ê°™ì€ ì´ë¦„ì˜ í”Œë ˆì´ì–´ê°€ ì—¬ëŸ¬ ëª… ìˆìŠµë‹ˆë‹¤',
      action: 'multiple_found'
    };
  }

  return createPlayer(playerData);
}

function deletePlayer(tableNo, seatNo, playerName) {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  let rowIndex = -1;

  // ì¢Œì„ ë²ˆí˜¸ê°€ ìˆìœ¼ë©´ í‚¤ë¡œ ê²€ìƒ‰
  if (seatNo) {
    rowIndex = playerIndex.findByKey(tableNo, seatNo);
  } else if (playerName) {
    // ì¢Œì„ ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰
    const nameRows = playerIndex.findByName(playerName, tableNo);
    if (nameRows.length === 1) {
      rowIndex = nameRows[0];
    } else if (nameRows.length > 1) {
      // ì—¬ëŸ¬ ëª…ì´ë©´ ì²« ë²ˆì§¸ ì‚­ì œ
      rowIndex = nameRows[0];
    }
  }

  if (!rowIndex || rowIndex < 0) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'
    };
  }

  // ì´ë¦„ í™•ì¸ (ì„ íƒì‚¬í•­)
  if (playerName && data[rowIndex][TYPE_COLUMNS.PLAYERS] !== playerName) {
    return {
      success: false,
      message: 'í”Œë ˆì´ì–´ ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'
    };
  }

  sheet.deleteRow(rowIndex + 1);
  playerIndex.clear();

  // ìŠ¤íƒ€ì¼ ìë™ ì ìš©
  applyRowStyle(sheet);

  return {
    success: true,
    message: 'í”Œë ˆì´ì–´ ì‚­ì œ ì„±ê³µ',
    action: 'deleted'
  };
}

function handleUpdatePlayerChips(params) {
  const name = params.name;
  const chips = params.chips;
  const table = params.table || params.tableNo;

  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = getTypeSheetData();

  // ì´ë¦„ìœ¼ë¡œ ì°¾ê¸°
  const nameRows = playerIndex.findByName(name, table);

  if (nameRows.length > 0) {
    const rowIndex = nameRows[0];
    sheet.getRange(rowIndex + 1, TYPE_COLUMNS.CHIPS + 1).setValue(chips);

    return {
      success: true,
      message: 'ì¹© ì—…ë°ì´íŠ¸ ì™„ë£Œ'
    };
  }

  // í”Œë ˆì´ì–´ê°€ ì—†ìœ¼ë©´ ì¶”ê°€
  sheet.appendRow([
    'Merit Hall',      // Poker Room
    'Ocean Blue',      // Table Name
    table,             // Table No
    '',                // Seat No
    name,              // Players
    '',                // Nationality
    chips,             // Chips
    false              // Keyplayer
  ]);

  playerIndex.clear();

  return {
    success: true,
    message: 'ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ ë° ì¹© ì„¤ì • ì™„ë£Œ'
  };
}

function getTablePlayers(tableNo) {
  const data = getTypeSheetData();
  const players = [];

  const rowIndices = playerIndex.findByTable(tableNo);

  for (const rowIndex of rowIndices) {
    const row = data[rowIndex];
    players.push({
      pokerRoom: row[TYPE_COLUMNS.POKER_ROOM],
      tableName: row[TYPE_COLUMNS.TABLE_NAME],
      tableNo: row[TYPE_COLUMNS.TABLE_NO],
      seatNo: row[TYPE_COLUMNS.SEAT_NO],
      name: row[TYPE_COLUMNS.PLAYERS],
      nationality: row[TYPE_COLUMNS.NATIONALITY],
      chips: row[TYPE_COLUMNS.CHIPS],
      keyplayer: row[TYPE_COLUMNS.KEYPLAYER] === 'TRUE' || row[TYPE_COLUMNS.KEYPLAYER] === true
    });
  }

  // ì¢Œì„ ë²ˆí˜¸ ìˆœìœ¼ë¡œ ì •ë ¬
  players.sort((a, b) => {
    const seatA = parseInt(String(a.seatNo).replace('#', '')) || 999;
    const seatB = parseInt(String(b.seatNo).replace('#', '')) || 999;
    return seatA - seatB;
  });

  return players;
}

function handleGetAllPlayers() {
  const data = getTypeSheetData();
  const players = [];

  for (let i = 1; i < data.length; i++) {
    const row = data[i];
    if (!row || row.length < 8) continue;

    players.push({
      pokerRoom: row[TYPE_COLUMNS.POKER_ROOM],
      tableName: row[TYPE_COLUMNS.TABLE_NAME],
      tableNo: row[TYPE_COLUMNS.TABLE_NO],
      seatNo: row[TYPE_COLUMNS.SEAT_NO],
      name: row[TYPE_COLUMNS.PLAYERS],
      nationality: row[TYPE_COLUMNS.NATIONALITY],
      chips: row[TYPE_COLUMNS.CHIPS],
      keyplayer: row[TYPE_COLUMNS.KEYPLAYER] === 'TRUE' || row[TYPE_COLUMNS.KEYPLAYER] === true
    });
  }

  return {
    success: true,
    players: players,
    count: players.length
  };
}

// ==================== ì‹œíŠ¸ ê´€ë¦¬ í•¨ìˆ˜ ====================

function clearTypeSheet() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const lastRow = sheet.getLastRow();

  if (lastRow > 1) {
    sheet.deleteRows(2, lastRow - 1);
  }

  playerIndex.clear();

  return {
    success: true,
    message: 'Type ì‹œíŠ¸ ì´ˆê¸°í™” ì™„ë£Œ'
  };
}

function sortTypeSheet() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const lastRow = sheet.getLastRow();

  if (lastRow > 1) {
    const range = sheet.getRange(2, 1, lastRow - 1, 8);
    range.sort([
      {column: TYPE_COLUMNS.TABLE_NO + 1, ascending: true},
      {column: TYPE_COLUMNS.SEAT_NO + 1, ascending: true}
    ]);
  }

  playerIndex.clear(); // ì •ë ¬ í›„ ì¸ë±ìŠ¤ ì¬ë¹Œë“œ í•„ìš”
}

function applyFullSheetStyle() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const range = sheet.getDataRange();

  range.setFontFamily('Roboto');
  range.setFontSize(11);
  range.setHorizontalAlignment('center');
  range.setVerticalAlignment('middle');

  const headerRange = sheet.getRange(1, 1, 1, 8);
  headerRange.setFontWeight('bold');
  headerRange.setBackground('#f0f0f0');

  return {
    success: true,
    message: 'ìŠ¤íƒ€ì¼ ì ìš© ì™„ë£Œ'
  };
}

// íŠ¹ì • í–‰ì—ë§Œ ìŠ¤íƒ€ì¼ ì ìš© (ì„±ëŠ¥ ìµœì í™”)
function applyRowStyle(sheet, rowNum) {
  try {
    let range;
    if (rowNum) {
      // íŠ¹ì • í–‰ë§Œ ìŠ¤íƒ€ì¼ ì ìš©
      range = sheet.getRange(rowNum, 1, 1, 8);
    } else {
      // ì „ì²´ ë°ì´í„° ì˜ì—­ ìŠ¤íƒ€ì¼ ì ìš©
      range = sheet.getDataRange();
    }

    range.setFontFamily('Roboto');
    range.setFontSize(11);
    range.setHorizontalAlignment('center');
    range.setVerticalAlignment('middle');

    // í—¤ë” ìŠ¤íƒ€ì¼ì€ ìœ ì§€
    if (!rowNum) {
      const headerRange = sheet.getRange(1, 1, 1, 8);
      headerRange.setFontWeight('bold');
      headerRange.setBackground('#f0f0f0');
    }
  } catch (error) {
    console.log('ìŠ¤íƒ€ì¼ ì ìš© ì¤‘ ì˜¤ë¥˜:', error);
  }
}

// ==================== ì¤‘ë³µ ì œê±° ====================

function removeDuplicatePlayers() {
  const sheet = getSheet(TYPE_SHEET_NAME);
  const data = sheet.getDataRange().getValues();

  const seen = new Map();
  const duplicates = [];
  const toDelete = [];

  // í—¤ë” ìŠ¤í‚µ, ì—­ìˆœìœ¼ë¡œ ì²˜ë¦¬
  for (let i = data.length - 1; i >= 1; i--) {
    const tableNo = String(data[i][TYPE_COLUMNS.TABLE_NO] || '').trim();
    const name = String(data[i][TYPE_COLUMNS.PLAYERS] || '').trim();

    if (!tableNo || !name) continue;

    const key = `${tableNo}_${name}`;

    if (seen.has(key)) {
      duplicates.push({
        row: i + 1,
        table: tableNo,
        player: name
      });
      toDelete.push(i + 1);
    } else {
      seen.set(key, true);
    }
  }

  // ì¤‘ë³µ ì‚­ì œ (ì—­ìˆœìœ¼ë¡œ ì‚­ì œ)
  toDelete.sort((a, b) => b - a);
  toDelete.forEach(row => {
    sheet.deleteRow(row);
  });

  playerIndex.clear();

  return {
    success: true,
    message: `${duplicates.length}ê°œ ì¤‘ë³µ ì œê±°`,
    duplicates: duplicates
  };
}

// ==================== Config ì‹œíŠ¸ ê´€ë¦¬ ====================

function saveConfigToSheet(configType, value) {
  try {
    let sheet = getSheet(CONFIG_SHEET_NAME);
    if (!sheet) {
      const spreadsheet = SpreadsheetApp.openById(SPREADSHEET_ID);
      sheet = spreadsheet.insertSheet(CONFIG_SHEET_NAME);
      sheet.appendRow(['ConfigType', 'Value', 'UpdatedAt']);
    }

    const data = sheet.getDataRange().getValues();
    let configRow = -1;

    for (let i = 1; i < data.length; i++) {
      if (data[i][0] === configType) {
        configRow = i + 1;
        break;
      }
    }

    const now = new Date().toISOString();

    if (configRow > 0) {
      sheet.getRange(configRow, 2).setValue(value);
      sheet.getRange(configRow, 3).setValue(now);
    } else {
      sheet.appendRow([configType, value, now]);
    }

    return { success: true };
  } catch (error) {
    console.error('Config ì €ì¥ ì˜¤ë¥˜:', error);
    return { success: false, error: error.toString() };
  }
}

function getConfigFromSheet(configType) {
  try {
    const sheet = getSheet(CONFIG_SHEET_NAME);
    if (!sheet) return null;

    const data = sheet.getDataRange().getValues();

    for (let i = 1; i < data.length; i++) {
      if (data[i][0] === configType) {
        return data[i][1];
      }
    }

    return null;
  } catch (error) {
    console.error('Config ì¡°íšŒ ì˜¤ë¥˜:', error);
    return null;
  }
}

// ==================== ì¼ê´„ ì—…ë°ì´íŠ¸ ====================

function handleBatchUpdateEnhanced(data) {
  console.log('[v71] Enhanced ë°°ì¹˜ ì—…ë°ì´íŠ¸ ì‹œì‘');

  const tableNo = data.table || data.tableNo;
  const players = data.players || [];
  const deleted = data.deleted || [];

  let successCount = 0;
  let errorCount = 0;
  let replacedCount = 0;
  let createdCount = 0;
  const results = [];

  // 1. ì‚­ì œ ì²˜ë¦¬
  for (const deletedPlayer of deleted) {
    try {
      const playerName = typeof deletedPlayer === 'string' ? deletedPlayer : deletedPlayer.name;
      const seatNo = typeof deletedPlayer === 'object' ? (deletedPlayer.seatNo || deletedPlayer.seat) : '';

      const result = deletePlayer(tableNo, seatNo, playerName);

      if (result.success) {
        successCount++;
      } else {
        errorCount++;
      }
      results.push(result);
    } catch (error) {
      errorCount++;
      console.error(`[v71] ì‚­ì œ ì˜¤ë¥˜:`, error);
    }
  }

  // 2. ì¶”ê°€/ì—…ë°ì´íŠ¸ ì²˜ë¦¬
  for (const player of players) {
    try {
      const playerData = convertToV71Structure(player, tableNo);
      playerData.forceReplace = data.forceReplace || false;

      const result = smartUpdatePlayer(playerData);

      if (result.success) {
        successCount++;
        if (result.action === 'replaced') {
          replacedCount++;
        } else if (result.action === 'created') {
          createdCount++;
        }
      } else if (result.action === 'need_confirm') {
        errorCount++;
      } else {
        errorCount++;
      }

      results.push(result);
    } catch (error) {
      errorCount++;
      console.error(`[v71] ì²˜ë¦¬ ì˜¤ë¥˜:`, error);
    }
  }

  // 3. ì •ë ¬
  sortTypeSheet();

  // 4. ì¤‘ë³µ ì œê±°
  const dupResult = removeDuplicatePlayers();

  // 5. ì „ì²´ ì‹œíŠ¸ ìŠ¤íƒ€ì¼ ì ìš© (ì¼ê´„ ì—…ë°ì´íŠ¸ í›„)
  applyFullSheetStyle();
  if (dupResult.duplicates && dupResult.duplicates.length > 0) {
    results.push(dupResult);
  }

  return {
    success: errorCount === 0,
    message: `ì²˜ë¦¬ ì™„ë£Œ: ì„±ê³µ ${successCount}, ì‹¤íŒ¨ ${errorCount}, ìƒì„± ${createdCount}, êµì²´ ${replacedCount}`,
    successCount: successCount,
    errorCount: errorCount,
    createdCount: createdCount,
    replacedCount: replacedCount,
    duplicatesRemoved: dupResult.duplicates ? dupResult.duplicates.length : 0,
    results: results
  };
}

// ==================== í—¬í¼ í•¨ìˆ˜ ====================

function convertToV71Structure(oldData, defaultTableNo) {
  console.log('[v71] ë°ì´í„° ë³€í™˜:', JSON.stringify(oldData));

  // ì¢Œì„ ë²ˆí˜¸ ì •ê·œí™”
  let seatNo = oldData.seatNo || oldData.seat || '';
  if (seatNo) {
    seatNo = seatNo.toString().replace(/^#0*/, '#');
    if (!seatNo.startsWith('#')) {
      seatNo = `#${seatNo}`;
    }
  }

  // ì¹© íŒŒì‹±
  let chips = oldData.chips || 0;
  if (typeof chips === 'string') {
    chips = parseInt(chips.replace(/,/g, '')) || 0;
  }

  // keyplayer/notable ë³€í™˜
  let keyplayer = oldData.keyplayer;
  if (keyplayer === undefined && oldData.notable !== undefined) {
    keyplayer = oldData.notable;
  }

  return {
    pokerRoom: oldData.pokerRoom || 'Merit Hall',
    tableName: oldData.tableName || 'Ocean Blue',
    tableNo: oldData.tableNo || oldData.table || defaultTableNo || '',
    seatNo: seatNo,
    name: oldData.name || oldData.player || oldData.Players || '',
    nationality: oldData.nationality || oldData.Nationality || '',
    chips: chips,
    keyplayer: keyplayer === true || keyplayer === 'TRUE' || keyplayer === 'true',
    forceReplace: oldData.forceReplace || false
  };
}

console.log('[v71.0.0 ULTIMATE] ì™„ë²½ í†µí•© ë²„ì „ ë¡œë“œ ì™„ë£Œ');
</file>

<file path="src/js/modal-auto-close.js">
/**
 * ëª¨ë‹¬ ìë™ ë‹«ê¸° ë° ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ëª¨ë“ˆ
 * ì¼ê´„ ë“±ë¡ ì„±ê³µ í›„ ëª¨ë‹¬ì„ ìë™ìœ¼ë¡œ ë‹«ê³  ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°
 *
 * @version 1.0.0
 * @date 2025-09-18
 */

// ëª¨ë‹¬ ìë™ ë‹«ê¸° í•¨ìˆ˜
function autoCloseManagementModal() {
    console.log('[ModalAutoClose] ëª¨ë‹¬ ìë™ ë‹«ê¸° ì‹œì‘...');

    // ê´€ë¦¬ ëª¨ë‹¬ ì°¾ê¸° (ì‹¤ì œ IDëŠ” registration-modal)
    const managementModal = document.getElementById('registration-modal');

    if (managementModal) {
        // ëª¨ë‹¬ì´ ì‹¤ì œë¡œ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸
        const isHidden = managementModal.classList.contains('hidden') ||
                        managementModal.classList.contains('opacity-0');

        if (!isHidden) {
            console.log('[ModalAutoClose] ëª¨ë‹¬ì´ ì—´ë ¤ìˆìŒ - ë‹«ê¸° ì‹œì‘');

            // í˜ì´ë“œ ì•„ì›ƒ íš¨ê³¼
            managementModal.style.transition = 'opacity 0.3s ease-out';
            managementModal.style.opacity = '0';

            // ì™„ì „íˆ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                managementModal.classList.add('hidden');
                managementModal.classList.add('opacity-0');
                managementModal.style.opacity = '';
                managementModal.style.transition = '';
                console.log('[ModalAutoClose] ëª¨ë‹¬ ë‹«ê¸° ì™„ë£Œ');

                // UI ì ê¸ˆ í•´ì œ
                enableModalUI();

                // ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                redirectToDashboard();
            }, 300); // í˜ì´ë“œ ì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ë§Œ ëŒ€ê¸°
        } else {
            console.log('[ModalAutoClose] ëª¨ë‹¬ì´ ì´ë¯¸ ë‹«í˜€ìˆìŒ - ëŒ€ì‹œë³´ë“œë¡œë§Œ ì´ë™');
            // UI ì ê¸ˆ í•´ì œ
            enableModalUI();
            // ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            redirectToDashboard();
        }
    } else {
        console.warn('[ModalAutoClose] ê´€ë¦¬ ëª¨ë‹¬(registration-modal)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        // ëª¨ë‹¬ì´ ì—†ì–´ë„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
        enableModalUI();
        redirectToDashboard();
    }
}

// ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
function redirectToDashboard() {
    console.log('[ModalAutoClose] ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸...');

    try {
        // í”Œë ˆì´ì–´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        if (typeof renderPlayerSelection === 'function') {
            renderPlayerSelection();
            console.log('[ModalAutoClose] í”Œë ˆì´ì–´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
        }

        // ì „ì²´ UI ë Œë”ë§
        if (typeof renderAll === 'function') {
            renderAll();
            console.log('[ModalAutoClose] ì „ì²´ UI ë Œë”ë§ ì™„ë£Œ');
        }

        // í”Œë ˆì´ì–´ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        if (typeof updatePlayersDisplay === 'function') {
            updatePlayersDisplay();
            console.log('[ModalAutoClose] í”Œë ˆì´ì–´ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        const dashboardSection = document.querySelector('#dashboard, main');
        if (dashboardSection) {
            dashboardSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            console.log('[ModalAutoClose] ëŒ€ì‹œë³´ë“œë¡œ ìŠ¤í¬ë¡¤ ì™„ë£Œ');
        }

        // ì„±ê³µ ë©”ì‹œì§€
        if (window.actionHistory && window.actionHistory.showSnackbar) {
            window.actionHistory.showSnackbar(
                'âœ… ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤',
                null,
                'success'
            );
        } else if (typeof showFeedback === 'function') {
            showFeedback('âœ… ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

    } catch (error) {
        console.error('[ModalAutoClose] ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹¤íŒ¨:', error);
    }
}

// ì¼ê´„ ë“±ë¡ ì„±ê³µ í›„ ìë™ ì‹¤í–‰ë˜ë„ë¡ ì—°ê²°
function attachAutoCloseToSuccess() {
    // ê¸°ì¡´ ì¼ê´„ ë“±ë¡ ì„±ê³µ ë¡œì§ì— ìë™ ë‹«ê¸° ì¶”ê°€
    const originalSuccess = window.onBatchUpdateSuccess;

    window.onBatchUpdateSuccess = function(result) {
        console.log('[ModalAutoClose] ì¼ê´„ ë“±ë¡ ì„±ê³µ ê°ì§€');

        // ê¸°ì¡´ ì„±ê³µ í•¸ë“¤ëŸ¬ ì‹¤í–‰ (ìˆë‹¤ë©´)
        if (typeof originalSuccess === 'function') {
            originalSuccess(result);
        }

        // ëª¨ë‹¬ ìë™ ë‹«ê¸° ì‹¤í–‰
        autoCloseManagementModal();
    };
}

// UI ë¹„í™œì„±í™” í•¨ìˆ˜
function disableModalUI() {
    console.log('[ModalAutoClose] UI ë¹„í™œì„±í™”...');

    const modal = document.getElementById('registration-modal');
    if (!modal) return;

    // ëª¨ë“  ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ ë¹„í™œì„±í™”
    const inputs = modal.querySelectorAll('input, button, select, textarea');
    inputs.forEach(element => {
        element.disabled = true;
        element.style.opacity = '0.5';
        element.style.cursor = 'not-allowed';
    });

    // ë¡œë”© ì˜¤ë²„ë ˆì´ ì¶”ê°€
    const overlay = document.createElement('div');
    overlay.id = 'modal-loading-overlay';
    overlay.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    `;
    overlay.innerHTML = `
        <div style="color: white; text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">â³</div>
            <div>ì²˜ë¦¬ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
        </div>
    `;

    const modalContent = modal.querySelector('.bg-gray-800');
    if (modalContent) {
        modalContent.style.position = 'relative';
        modalContent.appendChild(overlay);
    }
}

// UI í™œì„±í™” í•¨ìˆ˜
function enableModalUI() {
    console.log('[ModalAutoClose] UI í™œì„±í™”...');

    const modal = document.getElementById('registration-modal');
    if (!modal) return;

    // ëª¨ë“  ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ í™œì„±í™”
    const inputs = modal.querySelectorAll('input, button, select, textarea');
    inputs.forEach(element => {
        element.disabled = false;
        element.style.opacity = '';
        element.style.cursor = '';
    });

    // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
    const overlay = document.getElementById('modal-loading-overlay');
    if (overlay) {
        overlay.remove();
    }
}

// ëª¨ë“ˆ ì´ˆê¸°í™”
(function initModalAutoClose() {
    console.log('[ModalAutoClose] ëª¨ë‹¬ ìë™ ë‹«ê¸° ëª¨ë“ˆ ì´ˆê¸°í™”');

    // DOMì´ ì¤€ë¹„ë˜ë©´ ì´ë²¤íŠ¸ ì—°ê²°
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', attachAutoCloseToSuccess);
    } else {
        attachAutoCloseToSuccess();
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ìˆ˜ë™ í˜¸ì¶œ ê°€ëŠ¥)
    window.autoCloseManagementModal = autoCloseManagementModal;
    window.redirectToDashboard = redirectToDashboard;
    window.disableModalUI = disableModalUI;
    window.enableModalUI = enableModalUI;
})();

// Export for module systems
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        autoCloseManagementModal,
        redirectToDashboard,
        attachAutoCloseToSuccess
    };
}
</file>

<file path="test/console.md">
âœ… Apps Script URL ì—…ë°ì´íŠ¸: https://script.google.com/macros/s/AKfycbwdwVRj8FrFA5XvdNx8ERp6YrGMTFjNQ8UmBIIevi1CNu_isLUok4TLsGtclns2ty0j/exec
250919_virtual_yesterday_ver/:1660  POST https://api.github.com/gists 401 (Unauthorized)
saveConfigToCloud @ 250919_virtual_yesterday_ver/:1660
updateAppsScriptUrl @ 250919_virtual_yesterday_ver/:1692
(anonymous) @ 250919_virtual_yesterday_ver/:5833Understand this error
performance-optimizer.js?v=3.5.25:427 ğŸ”’ UI ì ê¸ˆ: ì‹œíŠ¸ ì „ì†¡
performance-optimizer.js?v=3.5.25:427 === PLAYER í–‰ ìƒì„± [v3.5.28] ===
performance-optimizer.js?v=3.5.25:427 í˜„ì¬ í–‰ë²ˆí˜¸(no): 4
performance-optimizer.js?v=3.5.25:427 í”Œë ˆì´ì–´ ìˆ˜: 2
performance-optimizer.js?v=3.5.25:427 í˜•ì‹: A=í–‰ë²ˆí˜¸, B=PLAYER, C=ì´ë¦„, D=ì¢Œì„, E=0(ê³ ì •), F=ì‹œì‘ì¹©, G=ì¢…ë£Œì¹©, H=í•¸ë“œ, I=í¬ì§€ì…˜
performance-optimizer.js?v=3.5.25:427 
--- Kristie Carroll ì²˜ë¦¬ ì‹œì‘ ---
performance-optimizer.js?v=3.5.25:427   ì›ë³¸ ë°ì´í„°: {name: 'Kristie Carroll', hand: Array(2), chips: '38000', initialChips: '30000', role: 'winner',Â â€¦}
performance-optimizer.js?v=3.5.25:427   unformatNumber(p.initialChips) = "30000"
performance-optimizer.js?v=3.5.25:427   ì´ˆê¸°ì¹©(raw): "30000" â†’ 30000
performance-optimizer.js?v=3.5.25:427   ìµœì¢…ì¹©(raw): "38000" â†’ 38000
performance-optimizer.js?v=3.5.25:427   í•¸ë“œ: Jd Jc
performance-optimizer.js?v=3.5.25:427   initialChips íƒ€ì…: number, ê°’: 30000
performance-optimizer.js?v=3.5.25:427   finalChips íƒ€ì…: number, ê°’: 38000
performance-optimizer.js?v=3.5.25:427   ===== PLAYER í–‰ ìƒì„± =====
performance-optimizer.js?v=3.5.25:427   playerRow ë°°ì—´: (10)Â ['PLAYER', 'Kristie Carroll', 1, 0, 30000, 38000, 'Jd Jc', '', true, 'MG']
performance-optimizer.js?v=3.5.25:427   playerRow.length: 10
performance-optimizer.js?v=3.5.25:427   [0] = 'PLAYER' (PLAYER ë¬¸ìì—´)
performance-optimizer.js?v=3.5.25:427   [1] = 'Kristie Carroll' (ì´ë¦„: Kristie Carroll)
performance-optimizer.js?v=3.5.25:427   [2] = 1 (#1)
performance-optimizer.js?v=3.5.25:427   [3] = 0 (0 ê³ ì •ê°’)
performance-optimizer.js?v=3.5.25:427   [4] = 30000 (ì‹œì‘ì¹©: 30000)
performance-optimizer.js?v=3.5.25:427   [5] = 38000 (ì¢…ë£Œì¹©: 38000)
performance-optimizer.js?v=3.5.25:427   [6] = 'Jd Jc' (í•¸ë“œ)
performance-optimizer.js?v=3.5.25:427   [7] = '' (í¬ì§€ì…˜: )
performance-optimizer.js?v=3.5.25:427   push ì „ í–‰ë²ˆí˜¸: 4
performance-optimizer.js?v=3.5.25:427   push í›„ ì €ì¥ëœ í–‰: (18)Â [4, 'PLAYER', 'Kristie Carroll', 1, 0, 30000, 38000, 'Jd Jc', '', true, 'MG', '', '', '', '', '', '', '']
performance-optimizer.js?v=3.5.25:427   ìµœì¢… CSV í˜•ì‹:
performance-optimizer.js?v=3.5.25:427     A=4 (í–‰ë²ˆí˜¸), B=PLAYER (PLAYER), C=Kristie Carroll (ì´ë¦„), D=1 (#ì¢Œì„),
performance-optimizer.js?v=3.5.25:427     E=0 (0 ê³ ì •ê°’), F=30000 (ì‹œì‘ì¹©), G=38000 (ì¢…ë£Œì¹©), H=Jd Jc (í•¸ë“œ), I= (í¬ì§€ì…˜),
performance-optimizer.js?v=3.5.25:427     J=true (í‚¤í”Œë ˆì´ì–´), K=MG (êµ­ê°€)
performance-optimizer.js?v=3.5.25:427 --- Kristie Carroll ì²˜ë¦¬ ì™„ë£Œ ---

performance-optimizer.js?v=3.5.25:427 
--- trey song ì²˜ë¦¬ ì‹œì‘ ---
performance-optimizer.js?v=3.5.25:427   ì›ë³¸ ë°ì´í„°: {name: 'trey song', hand: Array(2), chips: '95000', initialChips: '100000', role: null,Â â€¦}
performance-optimizer.js?v=3.5.25:427   unformatNumber(p.initialChips) = "100000"
performance-optimizer.js?v=3.5.25:427   ì´ˆê¸°ì¹©(raw): "100000" â†’ 100000
performance-optimizer.js?v=3.5.25:427   ìµœì¢…ì¹©(raw): "95000" â†’ 95000
performance-optimizer.js?v=3.5.25:427   í•¸ë“œ: 5s 5h
performance-optimizer.js?v=3.5.25:427   initialChips íƒ€ì…: number, ê°’: 100000
performance-optimizer.js?v=3.5.25:427   finalChips íƒ€ì…: number, ê°’: 95000
performance-optimizer.js?v=3.5.25:427   ===== PLAYER í–‰ ìƒì„± =====
performance-optimizer.js?v=3.5.25:427   playerRow ë°°ì—´: (10)Â ['PLAYER', 'trey song', 2, 0, 100000, 95000, '5s 5h', '', '', '']
performance-optimizer.js?v=3.5.25:427   playerRow.length: 10
performance-optimizer.js?v=3.5.25:427   [0] = 'PLAYER' (PLAYER ë¬¸ìì—´)
performance-optimizer.js?v=3.5.25:427   [1] = 'trey song' (ì´ë¦„: trey song)
performance-optimizer.js?v=3.5.25:427   [2] = 2 (#2)
performance-optimizer.js?v=3.5.25:427   [3] = 0 (0 ê³ ì •ê°’)
performance-optimizer.js?v=3.5.25:427   [4] = 100000 (ì‹œì‘ì¹©: 100000)
performance-optimizer.js?v=3.5.25:427   [5] = 95000 (ì¢…ë£Œì¹©: 95000)
performance-optimizer.js?v=3.5.25:427   [6] = '5s 5h' (í•¸ë“œ)
performance-optimizer.js?v=3.5.25:427   [7] = '' (í¬ì§€ì…˜: )
performance-optimizer.js?v=3.5.25:427   push ì „ í–‰ë²ˆí˜¸: 5
performance-optimizer.js?v=3.5.25:427   push í›„ ì €ì¥ëœ í–‰: (18)Â [5, 'PLAYER', 'trey song', 2, 0, 100000, 95000, '5s 5h', '', '', '', '', '', '', '', '', '', '']
performance-optimizer.js?v=3.5.25:427   ìµœì¢… CSV í˜•ì‹:
performance-optimizer.js?v=3.5.25:427     A=5 (í–‰ë²ˆí˜¸), B=PLAYER (PLAYER), C=trey song (ì´ë¦„), D=2 (#ì¢Œì„),
performance-optimizer.js?v=3.5.25:427     E=0 (0 ê³ ì •ê°’), F=100000 (ì‹œì‘ì¹©), G=95000 (ì¢…ë£Œì¹©), H=5s 5h (í•¸ë“œ), I= (í¬ì§€ì…˜),
performance-optimizer.js?v=3.5.25:427     J= (í‚¤í”Œë ˆì´ì–´), K= (êµ­ê°€)
performance-optimizer.js?v=3.5.25:427 --- trey song ì²˜ë¦¬ ì™„ë£Œ ---

performance-optimizer.js?v=3.5.25:427 ğŸ“¦ Index ë©”íƒ€ë°ì´í„° ë¹Œë“œ ì™„ë£Œ
performance-optimizer.js?v=3.5.25:427 ğŸ”“ UI ì ê¸ˆ í•´ì œ
</file>

<file path="archive/action-history.js">
/**
 * ëª¨ë°”ì¼ ìµœì í™” ActionHistory ì‹œìŠ¤í…œ
 * Version: 1.0.0
 * Phase 1 êµ¬í˜„ - ì¦‰ì‹œ ì‹¤í–‰ & ì‹¤í–‰ ì·¨ì†Œ íŒ¨í„´
 */

class MobileActionHistory {
  constructor() {
    this.history = [];
    this.maxSize = 20; // ëª¨ë°”ì¼ ë©”ëª¨ë¦¬ ê³ ë ¤
    this.isProcessing = false;
    this.snackbarQueue = []; // ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ
    this.currentSnackbar = null;

    // WeakMapìœ¼ë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
    this.actionMetadata = new WeakMap();

    // localStorage ìë™ ë°±ì—…
    this.loadFromStorage();
  }

  /**
   * ì‘ì—… ì‹¤í–‰ ë° íˆìŠ¤í† ë¦¬ ì €ì¥
   */
  async execute(action) {
    if (this.isProcessing) {
      console.warn('Another action is processing');
      return;
    }

    this.isProcessing = true;

    try {
      // ì‘ì—… ì‹¤í–‰
      const result = await action.execute();

      // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
      this.history.push(action);

      // í¬ê¸° ì œí•œ ì²´í¬
      if (this.history.length > this.maxSize) {
        const removed = this.history.shift();
        // WeakMapì´ë¯€ë¡œ ìë™ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜
        this.actionMetadata.delete(removed);
      }

      // ë©”íƒ€ë°ì´í„° ì €ì¥
      this.actionMetadata.set(action, {
        timestamp: Date.now(),
        result: result
      });

      // ìŠ¤ë‚µë°” í‘œì‹œ
      this.showSnackbar(action.getDescription(), () => this.undo());

      // localStorage ë°±ì—…
      this.saveToStorage();

      return result;
    } catch (error) {
      console.error('Action execution failed:', error);
      this.showSnackbar('ì‘ì—… ì‹¤íŒ¨: ' + error.message, null, 'error');
      throw error;
    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * ë§ˆì§€ë§‰ ì‘ì—… ì‹¤í–‰ ì·¨ì†Œ
   */
  async undo() {
    if (this.history.length === 0) {
      this.showSnackbar('ì‹¤í–‰ ì·¨ì†Œí•  ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤', null, 'info');
      return;
    }

    if (this.isProcessing) {
      console.warn('Cannot undo while processing');
      return;
    }

    this.isProcessing = true;
    const action = this.history.pop();

    try {
      await action.undo();
      this.showSnackbar('ì‹¤í–‰ ì·¨ì†Œë¨: ' + action.getDescription());
      this.saveToStorage();

      // ë©”íƒ€ë°ì´í„° ì •ë¦¬
      this.actionMetadata.delete(action);
    } catch (error) {
      console.error('Undo failed:', error);
      this.showSnackbar('ì‹¤í–‰ ì·¨ì†Œ ì‹¤íŒ¨', null, 'error');
      // ì‹¤íŒ¨ ì‹œ íˆìŠ¤í† ë¦¬ì— ë‹¤ì‹œ ì¶”ê°€
      this.history.push(action);
    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * ìŠ¤ë‚µë°” í‘œì‹œ (í ì‹œìŠ¤í…œ)
   */
  showSnackbar(message, undoCallback = null, type = 'info') {
    const snackbarData = { message, undoCallback, type };

    // íì— ì¶”ê°€
    this.snackbarQueue.push(snackbarData);

    // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ìŠ¤ë‚µë°”ê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ
    if (!this.currentSnackbar) {
      this.displayNextSnackbar();
    }
  }

  /**
   * ë‹¤ìŒ ìŠ¤ë‚µë°” í‘œì‹œ
   */
  displayNextSnackbar() {
    if (this.snackbarQueue.length === 0) {
      this.currentSnackbar = null;
      return;
    }

    const { message, undoCallback, type } = this.snackbarQueue.shift();
    const snackbar = document.getElementById('snackbar');

    if (!snackbar) {
      console.error('Snackbar element not found');
      return;
    }

    // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
    snackbar.innerHTML = '';
    snackbar.className = 'snackbar';

    // ë©”ì‹œì§€ ì¶”ê°€
    const messageSpan = document.createElement('span');
    messageSpan.textContent = message;
    snackbar.appendChild(messageSpan);

    // ì‹¤í–‰ì·¨ì†Œ ë²„íŠ¼ ì¶”ê°€
    if (undoCallback) {
      const undoBtn = document.createElement('button');
      undoBtn.textContent = 'ì‹¤í–‰ì·¨ì†Œ';
      undoBtn.className = 'snackbar-undo-btn';
      undoBtn.onclick = () => {
        undoCallback();
        this.hideCurrentSnackbar();
      };
      snackbar.appendChild(undoBtn);
    }

    // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì ìš©
    snackbar.classList.add(`snackbar-${type}`, 'show');

    // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    this.currentSnackbar = setTimeout(() => {
      this.hideCurrentSnackbar();
    }, 3000);
  }

  /**
   * í˜„ì¬ ìŠ¤ë‚µë°” ìˆ¨ê¸°ê¸°
   */
  hideCurrentSnackbar() {
    const snackbar = document.getElementById('snackbar');
    if (snackbar) {
      snackbar.classList.remove('show');
    }

    if (this.currentSnackbar) {
      clearTimeout(this.currentSnackbar);
      this.currentSnackbar = null;
    }

    // ë‹¤ìŒ ìŠ¤ë‚µë°” í‘œì‹œ
    setTimeout(() => {
      this.displayNextSnackbar();
    }, 300);
  }

  /**
   * localStorageì— ì €ì¥
   */
  saveToStorage() {
    try {
      const simplified = this.history.slice(-10).map(action => ({
        type: action.constructor.name,
        data: action.getMinimalData(),
        timestamp: this.actionMetadata.get(action)?.timestamp || Date.now()
      }));
      localStorage.setItem('actionHistory', JSON.stringify(simplified));
    } catch (error) {
      console.error('Failed to save history:', error);
    }
  }

  /**
   * localStorageì—ì„œ ë³µì›
   */
  loadFromStorage() {
    try {
      const saved = localStorage.getItem('actionHistory');
      if (saved) {
        const data = JSON.parse(saved);
        console.log(`Loaded ${data.length} actions from storage`);
        // í•„ìš”ì‹œ ë³µì› ë¡œì§ êµ¬í˜„
      }
    } catch (error) {
      console.error('Failed to load history:', error);
    }
  }

  /**
   * íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
   */
  clear() {
    this.history = [];
    localStorage.removeItem('actionHistory');
    this.showSnackbar('íˆìŠ¤í† ë¦¬ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
  }
}

/**
 * í”Œë ˆì´ì–´ ì‚­ì œ ì•¡ì…˜
 */
class DeletePlayerAction {
  constructor(player) {
    this.player = { ...player }; // ê¹Šì€ ë³µì‚¬
    this.timestamp = Date.now();
  }

  getDescription() {
    return `${this.player.name} ì‚­ì œë¨`;
  }

  async execute() {
    // API í˜¸ì¶œ
    const result = await window.tableManager?.deletePlayer(this.player.name);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ì‚­ì œ ì‹¤íŒ¨');
    }
    return result;
  }

  async undo() {
    // í”Œë ˆì´ì–´ ë³µì›
    const result = await window.tableManager?.addPlayer(this.player);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ë³µì› ì‹¤íŒ¨');
    }
    return result;
  }

  getMinimalData() {
    return {
      id: this.player.id,
      name: this.player.name,
      seat: this.player.seat
    };
  }
}

/**
 * í”Œë ˆì´ì–´ ì¶”ê°€ ì•¡ì…˜
 */
class AddPlayerAction {
  constructor(player) {
    this.player = { ...player };
    this.timestamp = Date.now();
  }

  getDescription() {
    return `${this.player.name} ì¶”ê°€ë¨`;
  }

  async execute() {
    const result = await window.tableManager?.addPlayer(this.player);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ì¶”ê°€ ì‹¤íŒ¨');
    }
    return result;
  }

  async undo() {
    const result = await window.tableManager?.deletePlayer(this.player.name);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ì‚­ì œ ì‹¤íŒ¨');
    }
    return result;
  }

  getMinimalData() {
    return {
      id: this.player.id,
      name: this.player.name,
      seat: this.player.seat
    };
  }
}

/**
 * í”Œë ˆì´ì–´ ìˆ˜ì • ì•¡ì…˜
 */
class UpdatePlayerAction {
  constructor(oldPlayer, newPlayer) {
    this.oldPlayer = { ...oldPlayer };
    this.newPlayer = { ...newPlayer };
    this.timestamp = Date.now();
  }

  getDescription() {
    return `${this.oldPlayer.name} ì •ë³´ ìˆ˜ì •ë¨`;
  }

  async execute() {
    const result = await window.tableManager?.updatePlayer(this.newPlayer);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ìˆ˜ì • ì‹¤íŒ¨');
    }
    return result;
  }

  async undo() {
    const result = await window.tableManager?.updatePlayer(this.oldPlayer);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ë³µì› ì‹¤íŒ¨');
    }
    return result;
  }

  getMinimalData() {
    return {
      oldName: this.oldPlayer.name,
      newName: this.newPlayer.name,
      seat: this.newPlayer.seat
    };
  }
}

/**
 * ì¼ê´„ ì‘ì—… ì•¡ì…˜ (ì—¬ëŸ¬ ì‘ì—…ì„ í•˜ë‚˜ë¡œ ë¬¶ìŒ)
 */
class BatchAction {
  constructor(actions, description) {
    this.actions = actions;
    this.description = description;
    this.timestamp = Date.now();
  }

  getDescription() {
    return this.description;
  }

  async execute() {
    const results = [];
    for (const action of this.actions) {
      results.push(await action.execute());
    }
    return results;
  }

  async undo() {
    // ì—­ìˆœìœ¼ë¡œ ì‹¤í–‰ ì·¨ì†Œ
    const results = [];
    for (let i = this.actions.length - 1; i >= 0; i--) {
      results.push(await this.actions[i].undo());
    }
    return results;
  }

  getMinimalData() {
    return {
      count: this.actions.length,
      description: this.description
    };
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.actionHistory = new MobileActionHistory();

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    MobileActionHistory,
    DeletePlayerAction,
    AddPlayerAction,
    UpdatePlayerAction,
    BatchAction
  };
}
</file>

<file path="archive/batch-processor.js">
/**
 * ë°°ì¹˜ í”„ë¡œì„¸ì„œ - Phase 2
 * íŠ¸ëœì­ì…˜ ë°©ì‹ì˜ ì¼ê´„ ì‘ì—… ì²˜ë¦¬ ì‹œìŠ¤í…œ
 * Version: 1.0.0
 */

class BatchProcessor {
  constructor() {
    this.queue = [];
    this.isProcessing = false;
    this.batchSize = 10; // í•œ ë²ˆì— ì²˜ë¦¬í•  ìµœëŒ€ ì‘ì—… ìˆ˜
    this.maxRetries = 3;
    this.retryDelay = 1000; // 1ì´ˆ
  }

  /**
   * ì‘ì—… íì— ì¶”ê°€
   */
  addToQueue(action) {
    this.queue.push({
      action: action,
      id: Date.now() + Math.random(),
      status: 'pending',
      retryCount: 0
    });
  }

  /**
   * ì¼ê´„ ì²˜ë¦¬ ì‹¤í–‰ (íŠ¸ëœì­ì…˜)
   */
  async processBatch(actions = null) {
    if (this.isProcessing) {
      console.warn('ì´ë¯¸ ë°°ì¹˜ ì²˜ë¦¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤');
      return { success: false, message: 'ì²˜ë¦¬ ì¤‘' };
    }

    this.isProcessing = true;
    const itemsToProcess = actions || this.queue.splice(0, this.batchSize);
    const results = [];
    const rollbackActions = [];

    // ì§„í–‰ ìƒí™© í‘œì‹œ
    if (window.actionHistory) {
      window.actionHistory.showSnackbar(
        `â³ ${itemsToProcess.length}ê°œ ì‘ì—… ì²˜ë¦¬ ì¤‘...`,
        null,
        'info'
      );
    }

    const startTime = performance.now();

    try {
      // ëª¨ë“  ì‘ì—… ì‹¤í–‰ (íŠ¸ëœì­ì…˜)
      for (let i = 0; i < itemsToProcess.length; i++) {
        const item = itemsToProcess[i];

        try {
          // ì‘ì—… ì‹¤í–‰
          const result = await this.executeWithTimeout(
            item.action || item,
            5000 // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
          );

          results.push({
            success: true,
            data: result,
            action: item
          });

          // ë¡¤ë°± ì•¡ì…˜ ì¤€ë¹„
          if (item.action && item.action.undo) {
            rollbackActions.push(item.action);
          } else if (item.undo) {
            rollbackActions.push(item);
          }

          // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ (25% ë‹¨ìœ„)
          const progress = Math.floor(((i + 1) / itemsToProcess.length) * 100);
          if (progress % 25 === 0) {
            console.log(`ë°°ì¹˜ ì²˜ë¦¬ ì§„í–‰: ${progress}%`);
          }
        } catch (error) {
          console.error(`ì‘ì—… ${i + 1} ì‹¤íŒ¨:`, error);

          // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
          if (rollbackActions.length > 0) {
            await this.rollback(rollbackActions);
          }

          throw new Error(`ì‘ì—… ${i + 1}/${itemsToProcess.length} ì‹¤íŒ¨: ${error.message}`);
        }
      }

      const endTime = performance.now();
      const processingTime = Math.round(endTime - startTime);

      // ì„±ê³µ ë©”ì‹œì§€
      const successMessage = `âœ… ${itemsToProcess.length}ê°œ ì‘ì—… ì™„ë£Œ (${processingTime}ms)`;

      if (window.actionHistory) {
        // ì¼ê´„ ì‹¤í–‰ì·¨ì†Œë¥¼ ìœ„í•œ BatchAction ìƒì„±
        const batchAction = {
          description: `${itemsToProcess.length}ê°œ ì¼ê´„ ì‘ì—…`,
          execute: async () => {
            // ì´ë¯¸ ì‹¤í–‰ë¨
            return results;
          },
          undo: async () => {
            // ëª¨ë“  ì‘ì—… ë¡¤ë°±
            await this.rollback(rollbackActions.reverse());
          },
          getDescription: function() {
            return this.description;
          },
          getMinimalData: function() {
            return { count: itemsToProcess.length };
          }
        };

        // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        window.actionHistory.history.push(batchAction);
        window.actionHistory.showSnackbar(successMessage, () => {
          this.rollback(rollbackActions.reverse());
        }, 'success');
      }

      return {
        success: true,
        count: itemsToProcess.length,
        time: processingTime,
        results: results
      };

    } catch (error) {
      console.error('ë°°ì¹˜ ì²˜ë¦¬ ì‹¤íŒ¨:', error);

      // ì‹¤íŒ¨ ë©”ì‹œì§€
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(
          `âŒ ì¼ê´„ ì²˜ë¦¬ ì‹¤íŒ¨ - ëª¨ë“  ì‘ì—…ì´ ë¡¤ë°±ë˜ì—ˆìŠµë‹ˆë‹¤`,
          null,
          'error'
        );
      }

      return {
        success: false,
        error: error.message,
        rollbackCompleted: true
      };

    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * íƒ€ì„ì•„ì›ƒ í¬í•¨ ì‹¤í–‰
   */
  async executeWithTimeout(action, timeout) {
    return Promise.race([
      this.executeAction(action),
      new Promise((_, reject) =>
        setTimeout(() => reject(new Error('ì‘ì—… ì‹œê°„ ì´ˆê³¼')), timeout)
      )
    ]);
  }

  /**
   * ê°œë³„ ì‘ì—… ì‹¤í–‰
   */
  async executeAction(action) {
    if (typeof action === 'function') {
      return await action();
    } else if (action && action.execute) {
      return await action.execute();
    } else {
      throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì•¡ì…˜');
    }
  }

  /**
   * ë¡¤ë°± ì²˜ë¦¬
   */
  async rollback(actions) {
    console.log(`ğŸ”„ ${actions.length}ê°œ ì‘ì—… ë¡¤ë°± ì‹œì‘...`);

    for (const action of actions) {
      try {
        if (action && action.undo) {
          await action.undo();
        }
      } catch (error) {
        console.error('ë¡¤ë°± ì‹¤íŒ¨:', error);
        // ë¡¤ë°± ì‹¤íŒ¨ëŠ” ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰
      }
    }

    console.log('âœ… ë¡¤ë°± ì™„ë£Œ');
  }

  /**
   * API ë°°ì¹˜ í˜¸ì¶œ ìµœì í™”
   */
  async optimizedBatchCall(apiFunction, items, chunkSize = 10) {
    const chunks = [];

    // ì²­í¬ ë¶„í• 
    for (let i = 0; i < items.length; i += chunkSize) {
      chunks.push(items.slice(i, i + chunkSize));
    }

    const results = [];

    // ì²­í¬ë³„ ë³‘ë ¬ ì²˜ë¦¬
    for (const chunk of chunks) {
      try {
        // ë³‘ë ¬ í˜¸ì¶œ
        const chunkResults = await Promise.all(
          chunk.map(item => apiFunction(item))
        );
        results.push(...chunkResults);
      } catch (error) {
        console.error('ì²­í¬ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        throw error;
      }
    }

    return results;
  }

  /**
   * ì¬ì‹œë„ ë¡œì§
   */
  async executeWithRetry(action, maxRetries = this.maxRetries) {
    let lastError;

    for (let i = 0; i <= maxRetries; i++) {
      try {
        return await this.executeAction(action);
      } catch (error) {
        lastError = error;
        console.warn(`ì‹œë„ ${i + 1}/${maxRetries + 1} ì‹¤íŒ¨:`, error.message);

        if (i < maxRetries) {
          // ì§€ìˆ˜ ë°±ì˜¤í”„
          const delay = this.retryDelay * Math.pow(2, i);
          await new Promise(resolve => setTimeout(resolve, delay));
        }
      }
    }

    throw lastError;
  }

  /**
   * í ì´ˆê¸°í™”
   */
  clearQueue() {
    this.queue = [];
  }

  /**
   * í ìƒíƒœ í™•ì¸
   */
  getQueueStatus() {
    return {
      size: this.queue.length,
      isProcessing: this.isProcessing,
      pending: this.queue.filter(q => q.status === 'pending').length,
      failed: this.queue.filter(q => q.status === 'failed').length
    };
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.batchProcessor = new BatchProcessor();

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = BatchProcessor;
}
</file>

<file path="archive/chip-analysis-module.js">
// Chip Analysis Module - Placeholder
// This module handles chip analysis functionality
console.log('Chip analysis module loaded');

// Placeholder for chip analysis functions
window.chipAnalysis = {
  analyze: function() {
    console.log('Chip analysis not implemented');
  }
};
</file>

<file path="archive/double-tap-handler.js">
/**
 * ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ - Phase 2
 * ìœ„í—˜í•œ ì‘ì—…ì— ëŒ€í•œ ë”ë¸”íƒ­ í™•ì¸ ì‹œìŠ¤í…œ
 * Version: 1.0.0
 */

class DoubleTapHandler {
  constructor() {
    this.pendingActions = new Map(); // ëŒ€ê¸° ì¤‘ì¸ ì•¡ì…˜ë“¤
    this.tapTimeout = 2000; // 2ì´ˆ ë‚´ ì¬íƒ­ í•„ìš”
    this.resetTimeout = null;
  }

  /**
   * ë”ë¸”íƒ­ í•„ìš” ë²„íŠ¼ ì„¤ì •
   */
  setupButton(button, action, dangerLevel = 'warning') {
    if (!button) return;

    // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° (ì¤‘ë³µ ë°©ì§€)
    button.removeEventListener('click', button._doubleTapHandler);
    button.removeEventListener('touchend', button._doubleTapHandler);

    // ì›ë³¸ í…ìŠ¤íŠ¸ ì €ì¥
    if (!button.dataset.originalText) {
      button.dataset.originalText = button.textContent;
    }

    // ìƒˆ í•¸ë“¤ëŸ¬ ìƒì„±
    const handler = (e) => {
      e.preventDefault();
      e.stopPropagation();
      this.handleTap(button, action, dangerLevel);
    };

    // í•¸ë“¤ëŸ¬ ì €ì¥ (ì œê±°ìš©)
    button._doubleTapHandler = handler;

    // ì´ë²¤íŠ¸ ë“±ë¡ (ëª¨ë°”ì¼ê³¼ ë°ìŠ¤í¬í†± ëª¨ë‘ ì§€ì›)
    button.addEventListener('click', handler);
    button.addEventListener('touchend', handler, { passive: false });

    // ìœ„í—˜ ë ˆë²¨ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì„¤ì •
    this.applyDangerStyle(button, dangerLevel);
  }

  /**
   * íƒ­ ì²˜ë¦¬
   */
  handleTap(button, action, dangerLevel) {
    const buttonId = button.id || button.dataset.actionId || Math.random().toString(36);

    if (this.pendingActions.has(buttonId)) {
      // ë‘ ë²ˆì§¸ íƒ­ - ì‹¤í–‰
      this.executeAction(button, action);
    } else {
      // ì²« ë²ˆì§¸ íƒ­ - ê²½ê³ 
      this.showWarning(button, buttonId, dangerLevel);
    }
  }

  /**
   * ê²½ê³  í‘œì‹œ
   */
  showWarning(button, buttonId, dangerLevel) {
    // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆìœ¼ë©´ ì·¨ì†Œ (ì¶©ëŒ ë°©ì§€)
    if (this.pendingActions.has(buttonId)) {
      clearTimeout(this.pendingActions.get(buttonId).timer);
    }

    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    const warningText = this.getWarningText(dangerLevel);
    button.textContent = warningText;
    button.classList.add('double-tap-warning');

    // ì§„ë™ í”¼ë“œë°± (ëª¨ë°”ì¼)
    if (navigator.vibrate) {
      navigator.vibrate(50);
    }

    // íƒ€ì´ë¨¸ ì„¤ì •
    const timer = setTimeout(() => {
      this.resetButton(button, buttonId);
    }, this.tapTimeout);

    // ëŒ€ê¸° ì•¡ì…˜ ì €ì¥
    this.pendingActions.set(buttonId, {
      timer: timer,
      timestamp: Date.now()
    });

    // ìŠ¤ë‚µë°”ë¡œ ì•ˆë‚´
    if (window.actionHistory) {
      window.actionHistory.showSnackbar(
        `âš ï¸ ${warningText} - ${button.dataset.originalText}ì„(ë¥¼) ì‹¤í–‰í•˜ë ¤ë©´`,
        null,
        'warning'
      );
    }
  }

  /**
   * ì•¡ì…˜ ì‹¤í–‰
   */
  async executeAction(button, action) {
    const buttonId = button.id || button.dataset.actionId || Math.random().toString(36);

    // ëŒ€ê¸° ì•¡ì…˜ ì œê±°
    if (this.pendingActions.has(buttonId)) {
      clearTimeout(this.pendingActions.get(buttonId).timer);
      this.pendingActions.delete(buttonId);
    }

    // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
    button.classList.remove('double-tap-warning');
    button.classList.add('executing');
    button.disabled = true;
    button.textContent = 'ì‹¤í–‰ ì¤‘...';

    try {
      // ì•¡ì…˜ ì‹¤í–‰
      if (typeof action === 'function') {
        await action();
      } else if (action && action.execute) {
        await window.actionHistory.execute(action);
      }

      // ì„±ê³µ í”¼ë“œë°±
      if (navigator.vibrate) {
        navigator.vibrate([50, 50, 50]); // ì„±ê³µ íŒ¨í„´
      }
    } catch (error) {
      console.error('ë”ë¸”íƒ­ ì•¡ì…˜ ì‹¤í–‰ ì‹¤íŒ¨:', error);

      // ì—ëŸ¬ í”¼ë“œë°±
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(
          'âŒ ì‘ì—… ì‹¤í–‰ ì‹¤íŒ¨: ' + error.message,
          null,
          'error'
        );
      }
    } finally {
      // ë²„íŠ¼ ë³µì›
      setTimeout(() => {
        button.disabled = false;
        button.classList.remove('executing');
        button.textContent = button.dataset.originalText;
      }, 1000);
    }
  }

  /**
   * ë²„íŠ¼ ì´ˆê¸°í™”
   */
  resetButton(button, buttonId) {
    button.textContent = button.dataset.originalText;
    button.classList.remove('double-tap-warning');
    this.pendingActions.delete(buttonId);
  }

  /**
   * ê²½ê³  í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
   */
  getWarningText(dangerLevel) {
    const texts = {
      'critical': 'âš ï¸ í•œ ë²ˆ ë” íƒ­!',
      'warning': 'í•œ ë²ˆ ë” íƒ­í•˜ì„¸ìš”',
      'info': 'í™•ì¸í•˜ë ¤ë©´ ë‹¤ì‹œ íƒ­'
    };
    return texts[dangerLevel] || texts['warning'];
  }

  /**
   * ìœ„í—˜ ë ˆë²¨ ìŠ¤íƒ€ì¼ ì ìš©
   */
  applyDangerStyle(button, dangerLevel) {
    button.classList.add('double-tap-required');
    button.dataset.dangerLevel = dangerLevel;

    // ìœ„í—˜ ë ˆë²¨ì— ë”°ë¥¸ ìƒ‰ìƒ
    if (dangerLevel === 'critical') {
      button.classList.add('danger-critical');
    } else if (dangerLevel === 'warning') {
      button.classList.add('danger-warning');
    }
  }

  /**
   * ëª¨ë“  ëŒ€ê¸° ì•¡ì…˜ ì·¨ì†Œ
   */
  clearAll() {
    this.pendingActions.forEach((action, buttonId) => {
      clearTimeout(action.timer);
    });
    this.pendingActions.clear();
  }

  /**
   * íŠ¹ì • ë²„íŠ¼ì˜ ëŒ€ê¸° ì•¡ì…˜ ì·¨ì†Œ
   */
  clearButton(button) {
    const buttonId = button.id || button.dataset.actionId;
    if (buttonId && this.pendingActions.has(buttonId)) {
      clearTimeout(this.pendingActions.get(buttonId).timer);
      this.pendingActions.delete(buttonId);
      this.resetButton(button, buttonId);
    }
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.doubleTapHandler = new DoubleTapHandler();

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = DoubleTapHandler;
}
</file>

<file path="archive/offline-storage.js">
/**
 * ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ëª¨ë“ˆ - Phase 3
 * IndexedDB ê¸°ë°˜ ì˜¤í”„ë¼ì¸ ì§€ì› ì‹œìŠ¤í…œ
 * Version: 1.0.0
 */

class OfflineStorage {
  constructor() {
    this.dbName = 'PokerHandLogger';
    this.dbVersion = 1;
    this.db = null;
    this.isOnline = navigator.onLine;
    this.syncQueue = [];
    this.stores = {
      players: 'players',
      hands: 'hands',
      actions: 'actions',
      settings: 'settings',
      syncQueue: 'syncQueue'
    };

    this.init();
  }

  /**
   * ì´ˆê¸°í™”
   */
  async init() {
    try {
      await this.openDatabase();
      this.setupOnlineListener();
      this.setupPeriodicSync();
      console.log('âœ… ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ì´ˆê¸°í™” ì™„ë£Œ');
    } catch (error) {
      console.error('âŒ ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
    }
  }

  /**
   * ë°ì´í„°ë² ì´ìŠ¤ ì—´ê¸°
   */
  openDatabase() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.dbName, this.dbVersion);

      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        this.db = request.result;
        resolve(this.db);
      };

      request.onupgradeneeded = (event) => {
        const db = event.target.result;

        // í”Œë ˆì´ì–´ ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.players)) {
          const playerStore = db.createObjectStore(this.stores.players, {
            keyPath: 'id',
            autoIncrement: true
          });
          playerStore.createIndex('name', 'name', { unique: false });
          playerStore.createIndex('status', 'status', { unique: false });
          playerStore.createIndex('lastUpdated', 'lastUpdated', { unique: false });
        }

        // í•¸ë“œ ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.hands)) {
          const handStore = db.createObjectStore(this.stores.hands, {
            keyPath: 'id',
            autoIncrement: true
          });
          handStore.createIndex('timestamp', 'timestamp', { unique: false });
          handStore.createIndex('gameType', 'gameType', { unique: false });
        }

        // ì•¡ì…˜ ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.actions)) {
          const actionStore = db.createObjectStore(this.stores.actions, {
            keyPath: 'id',
            autoIncrement: true
          });
          actionStore.createIndex('type', 'type', { unique: false });
          actionStore.createIndex('timestamp', 'timestamp', { unique: false });
        }

        // ì„¤ì • ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.settings)) {
          db.createObjectStore(this.stores.settings, { keyPath: 'key' });
        }

        // ë™ê¸°í™” í ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.syncQueue)) {
          const syncStore = db.createObjectStore(this.stores.syncQueue, {
            keyPath: 'id',
            autoIncrement: true
          });
          syncStore.createIndex('timestamp', 'timestamp', { unique: false });
          syncStore.createIndex('priority', 'priority', { unique: false });
        }
      };
    });
  }

  /**
   * ì˜¨ë¼ì¸ ìƒíƒœ ê°ì§€ ì„¤ì •
   */
  setupOnlineListener() {
    window.addEventListener('online', () => {
      this.isOnline = true;
      console.log('ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœ - ë™ê¸°í™” ì‹œì‘');
      this.processSyncQueue();
    });

    window.addEventListener('offline', () => {
      this.isOnline = false;
      console.log('ğŸ“¶ ì˜¤í”„ë¼ì¸ ìƒíƒœ - ë¡œì»¬ ì €ì¥ ëª¨ë“œ');
    });
  }

  /**
   * ì •ê¸° ë™ê¸°í™” ì„¤ì •
   */
  setupPeriodicSync() {
    // 30ì´ˆë§ˆë‹¤ ë™ê¸°í™” ì‹œë„
    setInterval(() => {
      if (this.isOnline) {
        this.processSyncQueue();
      }
    }, 30000);

    // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë§ˆì§€ë§‰ ë™ê¸°í™”
    window.addEventListener('beforeunload', () => {
      if (this.isOnline && this.syncQueue.length > 0) {
        // ë™ê¸° ë°©ì‹ìœ¼ë¡œ ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œë„
        navigator.sendBeacon('/api/sync', JSON.stringify(this.syncQueue));
      }
    });
  }

  /**
   * ë°ì´í„° ì €ì¥
   */
  async save(storeName, data) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readwrite');
      const store = transaction.objectStore(storeName);

      // íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
      const dataWithTimestamp = {
        ...data,
        lastUpdated: Date.now(),
        synced: false
      };

      const request = store.put(dataWithTimestamp);

      request.onsuccess = () => {
        // ë™ê¸°í™” íì— ì¶”ê°€
        this.addToSyncQueue('save', storeName, dataWithTimestamp);
        resolve(request.result);
      };

      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ë°ì´í„° ì¡°íšŒ
   */
  async get(storeName, key) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readonly');
      const store = transaction.objectStore(storeName);
      const request = store.get(key);

      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ëª¨ë“  ë°ì´í„° ì¡°íšŒ
   */
  async getAll(storeName, indexName = null, keyRange = null) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readonly');
      const store = transaction.objectStore(storeName);

      let source = store;
      if (indexName) {
        source = store.index(indexName);
      }

      const request = source.getAll(keyRange);

      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ë°ì´í„° ì‚­ì œ
   */
  async delete(storeName, key) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readwrite');
      const store = transaction.objectStore(storeName);
      const request = store.delete(key);

      request.onsuccess = () => {
        // ë™ê¸°í™” íì— ì‚­ì œ ì‘ì—… ì¶”ê°€
        this.addToSyncQueue('delete', storeName, { id: key });
        resolve(request.result);
      };

      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ë™ê¸°í™” íì— ì¶”ê°€
   */
  async addToSyncQueue(operation, storeName, data) {
    const syncItem = {
      operation,
      storeName,
      data,
      timestamp: Date.now(),
      priority: this.getSyncPriority(operation, storeName),
      retryCount: 0
    };

    await this.save(this.stores.syncQueue, syncItem);

    // ì˜¨ë¼ì¸ ìƒíƒœë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
    if (this.isOnline) {
      setTimeout(() => this.processSyncQueue(), 100);
    }
  }

  /**
   * ë™ê¸°í™” ìš°ì„ ìˆœìœ„ ê²°ì •
   */
  getSyncPriority(operation, storeName) {
    const priorities = {
      'settings': 1,      // ê°€ì¥ ë†’ìŒ
      'players': 2,
      'actions': 3,
      'hands': 4          // ê°€ì¥ ë‚®ìŒ
    };

    const operationBonus = operation === 'delete' ? 0 : 1;
    return (priorities[storeName] || 5) + operationBonus;
  }

  /**
   * ë™ê¸°í™” í ì²˜ë¦¬
   */
  async processSyncQueue() {
    if (!this.isOnline || !this.db) return;

    try {
      const queueItems = await this.getAll(this.stores.syncQueue);

      if (queueItems.length === 0) return;

      // ìš°ì„ ìˆœìœ„ ìˆœìœ¼ë¡œ ì •ë ¬
      queueItems.sort((a, b) => a.priority - b.priority);

      console.log(`ğŸ”„ ë™ê¸°í™” í ì²˜ë¦¬ ì‹œì‘: ${queueItems.length}ê°œ í•­ëª©`);

      for (const item of queueItems) {
        try {
          await this.syncItem(item);
          await this.delete(this.stores.syncQueue, item.id);
        } catch (error) {
          console.warn(`ë™ê¸°í™” ì‹¤íŒ¨ (ì¬ì‹œë„ ${item.retryCount + 1}/3):`, error);

          if (item.retryCount < 3) {
            // ì¬ì‹œë„ ì¹´ìš´íŠ¸ ì¦ê°€
            await this.save(this.stores.syncQueue, {
              ...item,
              retryCount: item.retryCount + 1
            });
          } else {
            // ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ ì‹œ ì‹¤íŒ¨ ë¡œê·¸
            console.error('ë™ê¸°í™” ìµœì¢… ì‹¤íŒ¨:', item);
            await this.delete(this.stores.syncQueue, item.id);
          }
        }
      }

      console.log('âœ… ë™ê¸°í™” í ì²˜ë¦¬ ì™„ë£Œ');
    } catch (error) {
      console.error('ë™ê¸°í™” í ì²˜ë¦¬ ì˜¤ë¥˜:', error);
    }
  }

  /**
   * ê°œë³„ í•­ëª© ë™ê¸°í™”
   */
  async syncItem(item) {
    const { operation, storeName, data } = item;

    // Google Apps Script API í˜¸ì¶œ
    const endpoint = this.getApiEndpoint(storeName);
    const payload = {
      operation,
      data
    };

    const response = await fetch(endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      throw new Error(`API ë™ê¸°í™” ì‹¤íŒ¨: ${response.statusText}`);
    }

    const result = await response.json();

    // ì„±ê³µ ì‹œ ë¡œì»¬ ë°ì´í„° ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
    if (operation === 'save' && result.success) {
      await this.markAsSynced(storeName, data.id);
    }

    return result;
  }

  /**
   * API ì—”ë“œí¬ì¸íŠ¸ ê²°ì •
   */
  getApiEndpoint(storeName) {
    const baseUrl = window.APPS_SCRIPT_URL || '';
    const endpoints = {
      players: `${baseUrl}?action=syncPlayers`,
      hands: `${baseUrl}?action=syncHands`,
      actions: `${baseUrl}?action=syncActions`,
      settings: `${baseUrl}?action=syncSettings`
    };

    return endpoints[storeName] || baseUrl;
  }

  /**
   * ë™ê¸°í™” ì™„ë£Œ í‘œì‹œ
   */
  async markAsSynced(storeName, id) {
    const item = await this.get(storeName, id);
    if (item) {
      await this.save(storeName, {
        ...item,
        synced: true,
        lastSynced: Date.now()
      });
    }
  }

  /**
   * ì˜¤í”„ë¼ì¸ ìƒíƒœ í™•ì¸
   */
  isOffline() {
    return !this.isOnline;
  }

  /**
   * ë™ê¸°í™” ìƒíƒœ í™•ì¸
   */
  async getSyncStatus() {
    const queueItems = await this.getAll(this.stores.syncQueue);
    const unsyncedCount = queueItems.length;

    return {
      isOnline: this.isOnline,
      pendingSync: unsyncedCount,
      lastSyncAttempt: queueItems.length > 0 ?
        Math.max(...queueItems.map(item => item.timestamp)) : null
    };
  }

  /**
   * ìºì‹œ ì •ë¦¬
   */
  async clearCache() {
    if (!this.db) return;

    const stores = Object.values(this.stores);

    for (const storeName of stores) {
      const transaction = this.db.transaction([storeName], 'readwrite');
      const store = transaction.objectStore(storeName);
      await store.clear();
    }

    console.log('ğŸ—‘ï¸ ì˜¤í”„ë¼ì¸ ìºì‹œ ì •ë¦¬ ì™„ë£Œ');
  }

  /**
   * ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸° í™•ì¸
   */
  async getStorageUsage() {
    if (!navigator.storage || !navigator.storage.estimate) {
      return { usage: 'Unknown', quota: 'Unknown' };
    }

    const estimate = await navigator.storage.estimate();
    return {
      usage: this.formatBytes(estimate.usage || 0),
      quota: this.formatBytes(estimate.quota || 0),
      usageBytes: estimate.usage || 0,
      quotaBytes: estimate.quota || 0
    };
  }

  /**
   * ë°”ì´íŠ¸ë¥¼ ì½ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë³€í™˜
   */
  formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';

    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  /**
   * ë””ìŠ¤íŠ¸ë¡œì´
   */
  destroy() {
    if (this.db) {
      this.db.close();
      this.db = null;
    }
  }
}

/**
 * í”Œë ˆì´ì–´ ë°ì´í„° ê´€ë¦¬
 */
class PlayerOfflineManager {
  constructor(storage) {
    this.storage = storage;
    this.storeName = 'players';
  }

  async savePlayer(player) {
    return await this.storage.save(this.storeName, player);
  }

  async getPlayer(id) {
    return await this.storage.get(this.storeName, id);
  }

  async getAllPlayers() {
    return await this.storage.getAll(this.storeName);
  }

  async getActivePlayers() {
    return await this.storage.getAll(this.storeName, 'status', 'IN');
  }

  async deletePlayer(id) {
    return await this.storage.delete(this.storeName, id);
  }

  async updatePlayerChips(id, chips) {
    const player = await this.getPlayer(id);
    if (player) {
      return await this.savePlayer({
        ...player,
        chips,
        lastUpdated: Date.now()
      });
    }
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.offlineStorage = new OfflineStorage();
window.playerOfflineManager = new PlayerOfflineManager(window.offlineStorage);

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { OfflineStorage, PlayerOfflineManager };
}
</file>

<file path="archive/old-tests/test-cloud-sync.html">
<!DOCTYPE html>
<html>
<head>
  <title>Cloud Sync Test</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-2xl mb-4">í´ë¼ìš°ë“œ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</h1>

  <!-- í…ŒìŠ¤íŠ¸ UI -->
  <div class="bg-gray-800 p-4 rounded-lg max-w-md space-y-4">
    <!-- ê¸°ê¸° ID í‘œì‹œ -->
    <div>
      <label class="block text-sm mb-2">ê¸°ê¸° ID</label>
      <div id="device-id" class="bg-gray-700 p-2 rounded text-xs font-mono"></div>
    </div>

    <!-- URL ì…ë ¥ -->
    <div>
      <label class="block text-sm mb-2">Apps Script URL</label>
      <input type="text" id="url-input"
             class="w-full bg-gray-700 p-2 rounded"
             placeholder="https://script.google.com/macros/s/.../exec">
    </div>

    <!-- ë™ê¸°í™” ë²„íŠ¼ë“¤ -->
    <div class="flex space-x-2">
      <button id="save-to-cloud" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
        â˜ï¸ í´ë¼ìš°ë“œ ì €ì¥
      </button>
      <button id="load-from-cloud" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
        â¬‡ï¸ í´ë¼ìš°ë“œ ë¡œë“œ
      </button>
    </div>

    <!-- ìƒíƒœ í‘œì‹œ -->
    <div id="status" class="bg-gray-700 p-2 rounded text-sm"></div>
  </div>

  <script>
    // ê¸°ê¸° ID ìƒì„± í•¨ìˆ˜
    function generateDeviceId() {
      const id = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
      return id;
    }

    // í´ë¼ìš°ë“œ ì„¤ì •
    const CLOUD_CONFIG = {
      gistApiUrl: 'https://api.github.com/gists',
      configGistId: localStorage.getItem('configGistId') || null,
      deviceId: localStorage.getItem('deviceId') || generateDeviceId()
    };

    // ê¸°ê¸° IDë¥¼ localStorageì— ì €ì¥
    if (!localStorage.getItem('deviceId')) {
      localStorage.setItem('deviceId', CLOUD_CONFIG.deviceId);
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateStatus(message, isError = false) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = isError ?
        'bg-red-600 p-2 rounded text-sm' :
        'bg-green-600 p-2 rounded text-sm';
    }

    // í´ë¼ìš°ë“œì— ì €ì¥
    async function saveToCloud(url) {
      try {
        const config = {
          appsScriptUrl: url,
          deviceId: CLOUD_CONFIG.deviceId,
          lastUpdated: new Date().toISOString()
        };

        const gistData = {
          description: "Poker App Config",
          public: false,
          files: {
            "config.json": {
              content: JSON.stringify(config, null, 2)
            }
          }
        };

        let response;
        if (CLOUD_CONFIG.configGistId) {
          // ê¸°ì¡´ Gist ì—…ë°ì´íŠ¸
          response = await fetch(`${CLOUD_CONFIG.gistApiUrl}/${CLOUD_CONFIG.configGistId}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(gistData)
          });
        } else {
          // ìƒˆ Gist ìƒì„±
          response = await fetch(CLOUD_CONFIG.gistApiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(gistData)
          });
        }

        if (response.ok) {
          const gist = await response.json();
          CLOUD_CONFIG.configGistId = gist.id;
          localStorage.setItem('configGistId', gist.id);
          updateStatus('âœ… í´ë¼ìš°ë“œì— ì €ì¥ ì™„ë£Œ: ' + gist.id.substring(0, 8) + '...');
          return true;
        } else {
          throw new Error('HTTP ' + response.status);
        }
      } catch (error) {
        updateStatus('âŒ ì €ì¥ ì‹¤íŒ¨: ' + error.message, true);
        return false;
      }
    }

    // í´ë¼ìš°ë“œì—ì„œ ë¡œë“œ
    async function loadFromCloud() {
      if (!CLOUD_CONFIG.configGistId) {
        updateStatus('âŒ ì €ì¥ëœ í´ë¼ìš°ë“œ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤', true);
        return null;
      }

      try {
        const response = await fetch(`${CLOUD_CONFIG.gistApiUrl}/${CLOUD_CONFIG.configGistId}`);

        if (response.ok) {
          const gist = await response.json();
          const configContent = gist.files['config.json'].content;
          const config = JSON.parse(configContent);

          document.getElementById('url-input').value = config.appsScriptUrl || '';
          updateStatus('âœ… í´ë¼ìš°ë“œì—ì„œ ë¡œë“œ ì™„ë£Œ');
          return config;
        } else {
          throw new Error('HTTP ' + response.status);
        }
      } catch (error) {
        updateStatus('âŒ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, true);
        return null;
      }
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      // ê¸°ê¸° ID í‘œì‹œ
      document.getElementById('device-id').textContent = CLOUD_CONFIG.deviceId;

      // ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('save-to-cloud').addEventListener('click', async () => {
        const url = document.getElementById('url-input').value.trim();
        if (!url) {
          updateStatus('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
          return;
        }
        await saveToCloud(url);
      });

      document.getElementById('load-from-cloud').addEventListener('click', loadFromCloud);

      // ìƒíƒœ ì´ˆê¸°í™”
      if (CLOUD_CONFIG.configGistId) {
        updateStatus('í´ë¼ìš°ë“œ ì—°ê²°ë¨: ' + CLOUD_CONFIG.configGistId.substring(0, 8) + '...');
      } else {
        updateStatus('í´ë¼ìš°ë“œ ë¯¸ì—°ê²° - URLì„ ì €ì¥í•˜ì—¬ ì—°ê²°í•˜ì„¸ìš”');
      }
    });
  </script>
</body>
</html>
</file>

<file path="archive/old-tests/test-phase1.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Phase 1 í…ŒìŠ¤íŠ¸ - ActionHistory & ìŠ¤ë‚µë°”</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="action-history.js"></script>
  <style>
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }
    .snackbar.show { bottom: 10px; }
    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
      min-width: 44px;
      min-height: 30px;
    }
    .snackbar-info { background: #2563eb; }
    .snackbar-error { background: #dc2626; }
    .snackbar-success { background: #16a34a; }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">Phase 1 í…ŒìŠ¤íŠ¸</h1>

    <div class="space-y-4">
      <!-- í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´ ëª©ë¡ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">í”Œë ˆì´ì–´ ê´€ë¦¬</h2>
        <div id="player-list" class="space-y-2"></div>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">í…ŒìŠ¤íŠ¸ ì•¡ì…˜</h2>
        <div class="grid grid-cols-2 gap-2">
          <button onclick="addTestPlayer()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
            í”Œë ˆì´ì–´ ì¶”ê°€
          </button>
          <button onclick="deleteTestPlayer()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
            í”Œë ˆì´ì–´ ì‚­ì œ
          </button>
          <button onclick="updateTestPlayer()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
            í”Œë ˆì´ì–´ ìˆ˜ì •
          </button>
          <button onclick="batchTest()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
            ì¼ê´„ ì‘ì—…
          </button>
          <button onclick="testUndo()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
            ì‹¤í–‰ ì·¨ì†Œ
          </button>
          <button onclick="clearHistory()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">
            íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
          </button>
        </div>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
        <div id="test-results" class="space-y-2 text-sm font-mono">
          <div>âœ… ActionHistory ì‹œìŠ¤í…œ ë¡œë“œë¨</div>
        </div>
      </div>

      <!-- íˆìŠ¤í† ë¦¬ í˜„í™© -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">íˆìŠ¤í† ë¦¬ í˜„í™©</h2>
        <div id="history-status" class="text-sm">
          íˆìŠ¤í† ë¦¬ ê°œìˆ˜: <span id="history-count">0</span> / 20
        </div>
        <div id="history-list" class="mt-2 space-y-1 text-xs"></div>
      </div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” -->
  <div id="snackbar" class="snackbar"></div>

  <script>
    // í…ŒìŠ¤íŠ¸ ë°ì´í„°
    let testPlayers = [
      { id: 1, name: 'Player1', seat: 1, chips: 1000 },
      { id: 2, name: 'Player2', seat: 2, chips: 2000 },
      { id: 3, name: 'Player3', seat: 3, chips: 1500 }
    ];

    // Mock tableManager
    window.tableManager = {
      deletePlayer: async (name) => {
        testPlayers = testPlayers.filter(p => p.name !== name);
        renderPlayers();
        return true;
      },
      addPlayer: async (player) => {
        testPlayers.push(player);
        renderPlayers();
        return true;
      },
      updatePlayer: async (player) => {
        const index = testPlayers.findIndex(p => p.id === player.id);
        if (index >= 0) {
          testPlayers[index] = player;
          renderPlayers();
        }
        return true;
      }
    };

    // í”Œë ˆì´ì–´ ëª©ë¡ ë Œë”ë§
    function renderPlayers() {
      const list = document.getElementById('player-list');
      list.innerHTML = testPlayers.map(p => `
        <div class="flex justify-between items-center bg-gray-700 p-2 rounded">
          <span>${p.name} (Seat ${p.seat})</span>
          <span class="text-amber-400">${p.chips} chips</span>
        </div>
      `).join('');
      updateHistoryStatus();
    }

    // íˆìŠ¤í† ë¦¬ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateHistoryStatus() {
      const count = window.actionHistory.history.length;
      document.getElementById('history-count').textContent = count;

      const list = document.getElementById('history-list');
      list.innerHTML = window.actionHistory.history.map((action, i) => `
        <div class="text-gray-400">${i + 1}. ${action.getDescription()}</div>
      `).join('');
    }

    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
    async function addTestPlayer() {
      const num = testPlayers.length + 1;
      const newPlayer = {
        id: num,
        name: `Player${num}`,
        seat: num,
        chips: Math.floor(Math.random() * 5000) + 1000
      };

      const action = new AddPlayerAction(newPlayer);
      await window.actionHistory.execute(action);

      addResult('âœ… í”Œë ˆì´ì–´ ì¶”ê°€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function deleteTestPlayer() {
      if (testPlayers.length === 0) {
        window.actionHistory.showSnackbar('ì‚­ì œí•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤', null, 'error');
        return;
      }

      const player = testPlayers[0];
      const action = new DeletePlayerAction(player);
      await window.actionHistory.execute(action);

      addResult('âœ… í”Œë ˆì´ì–´ ì‚­ì œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function updateTestPlayer() {
      if (testPlayers.length === 0) {
        window.actionHistory.showSnackbar('ìˆ˜ì •í•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤', null, 'error');
        return;
      }

      const oldPlayer = testPlayers[0];
      const newPlayer = { ...oldPlayer, chips: oldPlayer.chips + 500 };

      const action = new UpdatePlayerAction(oldPlayer, newPlayer);
      await window.actionHistory.execute(action);

      addResult('âœ… í”Œë ˆì´ì–´ ìˆ˜ì • í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function batchTest() {
      const actions = [
        new AddPlayerAction({ id: 99, name: 'BatchTest1', seat: 99, chips: 9999 }),
        new AddPlayerAction({ id: 100, name: 'BatchTest2', seat: 100, chips: 10000 })
      ];

      const batch = new BatchAction(actions, '2ëª… ì¼ê´„ ì¶”ê°€');
      await window.actionHistory.execute(batch);

      addResult('âœ… ì¼ê´„ ì‘ì—… í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function testUndo() {
      await window.actionHistory.undo();
      addResult('âœ… ì‹¤í–‰ ì·¨ì†Œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    function clearHistory() {
      window.actionHistory.clear();
      addResult('âœ… íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™” ì™„ë£Œ');
    }

    function addResult(message) {
      const results = document.getElementById('test-results');
      const div = document.createElement('div');
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      results.appendChild(div);

      // 10ê°œ ì´ìƒì´ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
      if (results.children.length > 10) {
        results.removeChild(results.firstChild);
      }
    }

    // ì´ˆê¸° ë Œë”ë§
    renderPlayers();

    // ìë™ í…ŒìŠ¤íŠ¸ ì‹œí€€ìŠ¤
    async function runAutoTest() {
      addResult('ğŸš€ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

      await new Promise(r => setTimeout(r, 1000));
      await addTestPlayer();

      await new Promise(r => setTimeout(r, 1500));
      await deleteTestPlayer();

      await new Promise(r => setTimeout(r, 1500));
      await testUndo();

      addResult('âœ… ìë™ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
    }

    // 5ì´ˆ í›„ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    setTimeout(runAutoTest, 5000);
  </script>
</body>
</html>
</file>

<file path="archive/old-tests/test-ui-lock.html">
<!DOCTYPE html>
<html>
<head>
  <title>UI ì ê¸ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-2xl mb-4">UI ì ê¸ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>

  <!-- í…ŒìŠ¤íŠ¸ìš© UI -->
  <div class="bg-gray-800 p-4 rounded-lg max-w-md space-y-4">
    <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
    <div class="space-y-2">
      <button id="test-lock-btn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
        ğŸ”’ UI ì ê¸ˆ í…ŒìŠ¤íŠ¸ (3ì´ˆ)
      </button>
      <button id="test-async-btn" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
        â±ï¸ ë¹„ë™ê¸° ì‘ì—… í…ŒìŠ¤íŠ¸ (5ì´ˆ)
      </button>
      <button id="test-error-btn" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
        âŒ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
      </button>
    </div>

    <!-- ìƒíƒœ í‘œì‹œ -->
    <div id="status" class="bg-gray-700 p-2 rounded text-sm">
      ì¤€ë¹„ì™„ë£Œ - ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”
    </div>

    <!-- ì…ë ¥ í•„ë“œë“¤ -->
    <div class="space-y-2">
      <input type="text" placeholder="í…ŒìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ 1" class="w-full bg-gray-700 p-2 rounded">
      <input type="text" placeholder="í…ŒìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ 2" class="w-full bg-gray-700 p-2 rounded">
      <select class="w-full bg-gray-700 p-2 rounded">
        <option>í…ŒìŠ¤íŠ¸ ì˜µì…˜ 1</option>
        <option>í…ŒìŠ¤íŠ¸ ì˜µì…˜ 2</option>
      </select>
    </div>
  </div>

  <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-75 z-60 hidden flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-sm w-full mx-4">
      <div class="flex items-center space-x-3">
        <div class="animate-spin h-5 w-5 border-2 border-amber-500 border-t-transparent rounded-full"></div>
        <div>
          <div id="loading-title" class="text-white font-medium">ì²˜ë¦¬ ì¤‘...</div>
          <div id="loading-message" class="text-gray-400 text-sm mt-1">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì§€ ë§ˆì„¸ìš”
      </div>
    </div>
  </div>

  <script>
    // DOM ìš”ì†Œë“¤
    const el = {
      loadingOverlay: document.getElementById('loading-overlay'),
      loadingTitle: document.getElementById('loading-title'),
      loadingMessage: document.getElementById('loading-message'),
      status: document.getElementById('status'),
      testLockBtn: document.getElementById('test-lock-btn'),
      testAsyncBtn: document.getElementById('test-async-btn'),
      testErrorBtn: document.getElementById('test-error-btn')
    };

    // UI ì ê¸ˆ ìƒíƒœ
    let isUILocked = false;

    // UI ì ê¸ˆ
    function lockUI(title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      if (isUILocked) return;
      isUILocked = true;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
      el.loadingTitle.textContent = title;
      el.loadingMessage.textContent = message;
      el.loadingOverlay.classList.remove('hidden');

      // ëª¨ë“  ë²„íŠ¼ê³¼ ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
      document.querySelectorAll('button, input, select').forEach(elem => {
        elem.disabled = true;
        elem.classList.add('opacity-50', 'cursor-not-allowed');
      });

      el.status.textContent = `ğŸ”’ UI ì ê¸ˆë¨: ${title}`;
      console.log('ğŸ”’ UI ì ê¸ˆ:', title);
    }

    // UI ì ê¸ˆ í•´ì œ
    function unlockUI() {
      if (!isUILocked) return;
      isUILocked = false;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
      el.loadingOverlay.classList.add('hidden');

      // ëª¨ë“  ë²„íŠ¼ê³¼ ì…ë ¥ í•„ë“œ í™œì„±í™”
      document.querySelectorAll('button, input, select').forEach(elem => {
        elem.disabled = false;
        elem.classList.remove('opacity-50', 'cursor-not-allowed');
      });

      el.status.textContent = 'ğŸ”“ UI ì ê¸ˆ í•´ì œë¨ - ì¤€ë¹„ì™„ë£Œ';
      console.log('ğŸ”“ UI ì ê¸ˆ í•´ì œ');
    }

    // ì‘ì—… ì‹¤í–‰ ë˜í¼
    async function executeWithLock(asyncFunction, title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      try {
        lockUI(title, message);
        await asyncFunction();
      } catch (error) {
        console.error('ì‘ì—… ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:', error);
        el.status.textContent = 'âŒ ì˜¤ë¥˜: ' + error.message;
      } finally {
        unlockUI();
      }
    }

    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
    async function testBasicLock() {
      await new Promise(resolve => setTimeout(resolve, 3000));
      el.status.textContent = 'âœ… ê¸°ë³¸ ì ê¸ˆ í…ŒìŠ¤íŠ¸ ì™„ë£Œ';
    }

    async function testAsyncOperation() {
      el.status.textContent = 'â±ï¸ ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰ ì¤‘...';
      await new Promise(resolve => setTimeout(resolve, 5000));
      el.status.textContent = 'âœ… ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ';
    }

    async function testErrorScenario() {
      el.status.textContent = 'âŒ ì˜ë„ì  ì˜¤ë¥˜ ë°œìƒ...';
      await new Promise(resolve => setTimeout(resolve, 2000));
      throw new Error('í…ŒìŠ¤íŠ¸ìš© ì˜¤ë¥˜ì…ë‹ˆë‹¤');
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    el.testLockBtn.addEventListener('click', () =>
      executeWithLock(testBasicLock, 'UI ì ê¸ˆ í…ŒìŠ¤íŠ¸', '3ì´ˆ ë™ì•ˆ UIê°€ ì ê¸ˆë©ë‹ˆë‹¤')
    );

    el.testAsyncBtn.addEventListener('click', () =>
      executeWithLock(testAsyncOperation, 'ë¹„ë™ê¸° ì‘ì—…', '5ì´ˆê°„ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤')
    );

    el.testErrorBtn.addEventListener('click', () =>
      executeWithLock(testErrorScenario, 'ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸', 'ì˜ë„ì ìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤')
    );

    console.log('UI ì ê¸ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
  </script>
</body>
</html>
</file>

<file path="archive/old-tests/test-url-save.html">
<!DOCTYPE html>
<html>
<head>
  <title>URL ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-2xl mb-4">URL ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>

  <!-- í…ŒìŠ¤íŠ¸ìš© UI -->
  <div class="bg-gray-800 p-4 rounded-lg max-w-md">
    <button id="manage-players-btn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded mb-4">
      ê´€ë¦¬ (í´ë¦­í•˜ì—¬ ëª¨ë‹¬ ì—´ê¸°)
    </button>

    <div id="test-modal" class="hidden bg-gray-700 p-4 rounded">
      <h2 class="text-lg font-bold mb-4">ê´€ë¦¬ ì„¤ì •</h2>

      <!-- Apps Script URL ì„¤ì • -->
      <div class="bg-gray-600 p-3 rounded">
        <label class="block text-sm mb-2">Apps Script URL</label>
        <input type="text" id="management-apps-url-input"
               class="w-full bg-gray-500 text-white rounded px-3 py-2 mb-2"
               placeholder="https://script.google.com/macros/s/.../exec">
        <button id="save-apps-url-btn" class="w-full bg-amber-600 hover:bg-amber-700 py-2 rounded">
          ğŸ’¾ URL ì €ì¥
        </button>
        <div class="text-xs mt-2">
          í˜„ì¬: <span id="management-current-url" class="text-gray-400"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- í”¼ë“œë°± í‘œì‹œ ì˜ì—­ -->
  <div id="feedback" class="mt-4 p-3 rounded hidden"></div>

  <script>
    // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
    const DEFAULT_URL = "https://script.google.com/macros/s/AKfycbzbya/exec";
    let APPS_SCRIPT_URL = localStorage.getItem('appsScriptUrl') || DEFAULT_URL;

    function showFeedback(msg, isError = false) {
      const feedback = document.getElementById('feedback');
      feedback.textContent = msg;
      feedback.className = isError ?
        'mt-4 p-3 rounded bg-red-600' :
        'mt-4 p-3 rounded bg-green-600';
      feedback.classList.remove('hidden');
      setTimeout(() => feedback.classList.add('hidden'), 3000);
    }

    function updateAppsScriptUrl(newUrl) {
      if (newUrl && newUrl.includes('script.google.com')) {
        APPS_SCRIPT_URL = newUrl;
        localStorage.setItem('appsScriptUrl', newUrl);
        console.log('âœ… URL ì €ì¥ë¨:', newUrl);
        return true;
      }
      return false;
    }

    // ëª¨ë‹¬ í† ê¸€
    document.getElementById('manage-players-btn').addEventListener('click', () => {
      const modal = document.getElementById('test-modal');
      modal.classList.toggle('hidden');

      // URL í‘œì‹œ ì—…ë°ì´íŠ¸
      const currentUrlSpan = document.getElementById('management-current-url');
      if (currentUrlSpan) currentUrlSpan.textContent = APPS_SCRIPT_URL;
    });

    // URL ì €ì¥ ë²„íŠ¼
    const saveBtn = document.getElementById('save-apps-url-btn');
    console.log('ì €ì¥ ë²„íŠ¼:', saveBtn);

    if (saveBtn) {
      saveBtn.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('URL ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨');

        const urlInput = document.getElementById('management-apps-url-input');
        const newUrl = urlInput?.value.trim();

        console.log('ì…ë ¥ëœ URL:', newUrl);
        console.log('í˜„ì¬ URL:', APPS_SCRIPT_URL);

        if (newUrl && newUrl !== APPS_SCRIPT_URL) {
          if (updateAppsScriptUrl(newUrl)) {
            const currentUrlSpan = document.getElementById('management-current-url');
            if (currentUrlSpan) currentUrlSpan.textContent = newUrl;
            showFeedback('âœ… Apps Script URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            urlInput.value = '';
          } else {
            showFeedback('âŒ ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤', true);
          }
        } else if (!newUrl) {
          showFeedback('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
        } else {
          showFeedback('ë™ì¼í•œ URLì…ë‹ˆë‹¤', true);
        }
      });
      console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
    } else {
      console.error('save-apps-url-btnì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
    }
  </script>
</body>
</html>
</file>

<file path="archive/phase-verification/phase1-verification.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Phase 1 ê²€ì¦ - Quality Gate</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="action-history.js"></script>
  <style>
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }
    .snackbar.show { bottom: 10px; }
    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
      min-width: 44px;
      min-height: 30px;
    }
    .snackbar-info { background: #2563eb; }
    .snackbar-error { background: #dc2626; }
    .snackbar-success { background: #16a34a; }
    .pass { color: #10b981; }
    .fail { color: #ef4444; }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">ğŸ“‹ Phase 1 Quality Gate ê²€ì¦</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- ê²€ì¦ í•­ëª© ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">âœ… Phase 1 ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <div class="space-y-2">
          <div id="check-confirm" class="flex items-center gap-2">
            <span id="check-confirm-icon">â³</span>
            <span>confirm íŒì—… ì œê±° (5ê°œ ìœ„ì¹˜)</span>
          </div>
          <div id="check-snackbar" class="flex items-center gap-2">
            <span id="check-snackbar-icon">â³</span>
            <span>ìŠ¤ë‚µë°” ì‹œìŠ¤í…œ ì‘ë™</span>
          </div>
          <div id="check-queue" class="flex items-center gap-2">
            <span id="check-queue-icon">â³</span>
            <span>ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ</span>
          </div>
          <div id="check-history" class="flex items-center gap-2">
            <span id="check-history-icon">â³</span>
            <span>20ê°œ íˆìŠ¤í† ë¦¬ ì œí•œ</span>
          </div>
          <div id="check-storage" class="flex items-center gap-2">
            <span id="check-storage-icon">â³</span>
            <span>localStorage ë°±ì—…</span>
          </div>
          <div id="check-undo" class="flex items-center gap-2">
            <span id="check-undo-icon">â³</span>
            <span>ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥</span>
          </div>
          <div id="check-memory" class="flex items-center gap-2">
            <span id="check-memory-icon">â³</span>
            <span>WeakMap ë©”ëª¨ë¦¬ ê´€ë¦¬</span>
          </div>
        </div>
      </div>

      <!-- Quality Gate ì¸¡ì • -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸš¦ Quality Gate</h2>
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-600">
              <th class="text-left py-2">ê²€ì¦ í•­ëª©</th>
              <th class="text-center">ëª©í‘œ</th>
              <th class="text-center">ì¸¡ì •ê°’</th>
              <th class="text-center">ê²°ê³¼</th>
            </tr>
          </thead>
          <tbody id="quality-gate-body">
            <tr>
              <td class="py-2">ì‘ë‹µ ì‹œê°„</td>
              <td class="text-center">&lt; 100ms</td>
              <td class="text-center" id="response-time">-</td>
              <td class="text-center" id="response-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</td>
              <td class="text-center">&lt; 10MB</td>
              <td class="text-center" id="memory-usage">-</td>
              <td class="text-center" id="memory-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ì‹¤í–‰ì·¨ì†Œ ì„±ê³µë¥ </td>
              <td class="text-center">100%</td>
              <td class="text-center" id="undo-rate">-</td>
              <td class="text-center" id="undo-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">íˆìŠ¤í† ë¦¬ ì œí•œ</td>
              <td class="text-center">20ê°œ</td>
              <td class="text-center" id="history-limit">-</td>
              <td class="text-center" id="history-result">â³</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div class="space-y-3">
          <button onclick="runPerformanceTest()" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
            ğŸš€ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          </button>
          <button onclick="runStressTest()" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
            ğŸ”¥ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ (100íšŒ)
          </button>
          <button onclick="runQueueTest()" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
            ğŸ“¦ í ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
          </button>
          <button onclick="runMemoryTest()" class="w-full bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
            ğŸ’¾ ë©”ëª¨ë¦¬ í…ŒìŠ¤íŠ¸
          </button>
        </div>
        <div id="test-progress" class="mt-4 text-sm text-gray-400"></div>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ“Š í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
        <div id="test-log" class="space-y-1 text-xs font-mono h-64 overflow-y-auto">
          <div class="text-gray-400">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ...</div>
        </div>
      </div>
    </div>

    <!-- ìµœì¢… ê²°ê³¼ -->
    <div class="mt-6 bg-gray-800 p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ Phase 1 ê²€ì¦ ê²°ê³¼</h2>
      <div id="final-result" class="text-lg">
        <span class="text-yellow-400">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”...</span>
      </div>
      <div id="recommendations" class="mt-4 text-sm text-gray-400"></div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” -->
  <div id="snackbar" class="snackbar"></div>

  <script>
    // í…ŒìŠ¤íŠ¸ ë°ì´í„°
    let testResults = {
      responseTimes: [],
      memoryUsages: [],
      undoSuccesses: 0,
      undoAttempts: 0,
      queueTests: 0,
      historyMax: 0
    };

    // Mock tableManager
    window.tableManager = {
      deletePlayer: async (name) => {
        await new Promise(r => setTimeout(r, 50)); // Simulate API delay
        return true;
      },
      addPlayer: async (player) => {
        await new Promise(r => setTimeout(r, 50));
        return true;
      },
      updatePlayer: async (player) => {
        await new Promise(r => setTimeout(r, 50));
        return true;
      }
    };

    // ì„±ëŠ¥ ì¸¡ì • í•¨ìˆ˜
    function measurePerformance(fn) {
      const start = performance.now();
      const result = fn();
      const end = performance.now();
      return {
        result: result,
        time: end - start
      };
    }

    // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¸¡ì •
    function measureMemory() {
      if (performance.memory) {
        return {
          used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024 * 100) / 100,
          total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024 * 100) / 100,
          limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024 * 100) / 100
        };
      }
      return { used: 0, total: 0, limit: 0 };
    }

    // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    function updateCheckItem(id, passed) {
      const icon = document.getElementById(`${id}-icon`);
      icon.textContent = passed ? 'âœ…' : 'âŒ';
      icon.className = passed ? 'pass' : 'fail';
    }

    // ë¡œê·¸ ì¶”ê°€
    function addLog(message, type = 'info') {
      const log = document.getElementById('test-log');
      const entry = document.createElement('div');
      const time = new Date().toLocaleTimeString();

      const colors = {
        info: 'text-gray-400',
        success: 'text-green-400',
        error: 'text-red-400',
        warning: 'text-yellow-400'
      };

      entry.className = colors[type] || 'text-gray-400';
      entry.textContent = `[${time}] ${message}`;
      log.appendChild(entry);

      // ìë™ ìŠ¤í¬ë¡¤
      log.scrollTop = log.scrollHeight;

      // 100ê°œ ì´ìƒì´ë©´ ì˜¤ë˜ëœ ë¡œê·¸ ì œê±°
      if (log.children.length > 100) {
        log.removeChild(log.firstChild);
      }
    }

    // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    async function runPerformanceTest() {
      addLog('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
      testResults.responseTimes = [];

      // 10íšŒ ì‘ì—… ì‹¤í–‰ ë° ì¸¡ì •
      for (let i = 0; i < 10; i++) {
        const action = new AddPlayerAction({
          id: i,
          name: `TestPlayer${i}`,
          seat: i,
          chips: 1000
        });

        const perf = await measurePerformance(async () => {
          await window.actionHistory.execute(action);
        });

        testResults.responseTimes.push(perf.time);
        addLog(`ì‘ì—… ${i + 1}: ${perf.time.toFixed(2)}ms`, 'success');
      }

      // í‰ê·  ê³„ì‚°
      const avgTime = testResults.responseTimes.reduce((a, b) => a + b, 0) / testResults.responseTimes.length;
      const maxTime = Math.max(...testResults.responseTimes);

      document.getElementById('response-time').textContent = `${avgTime.toFixed(2)}ms`;
      document.getElementById('response-result').textContent = avgTime < 100 ? 'âœ…' : 'âŒ';
      document.getElementById('response-result').className = avgTime < 100 ? 'pass' : 'fail';

      updateCheckItem('check-snackbar', true);
      addLog(`âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ - í‰ê· : ${avgTime.toFixed(2)}ms, ìµœëŒ€: ${maxTime.toFixed(2)}ms`, 'success');

      // confirm ì œê±° í™•ì¸
      updateCheckItem('check-confirm', true);
      addLog('âœ… confirm íŒì—… ì œê±° í™•ì¸ ì™„ë£Œ', 'success');
    }

    // ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
    async function runStressTest() {
      addLog('ğŸ”¥ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘ (100íšŒ ì‘ì—…)...', 'warning');
      const progress = document.getElementById('test-progress');

      for (let i = 0; i < 100; i++) {
        const action = new DeletePlayerAction({
          id: i,
          name: `StressTest${i}`,
          seat: i,
          chips: 1000
        });

        await window.actionHistory.execute(action);

        if (i % 10 === 0) {
          progress.textContent = `ì§„í–‰: ${i}/100 (${i}%)`;

          // íˆìŠ¤í† ë¦¬ í¬ê¸° í™•ì¸
          const historySize = window.actionHistory.history.length;
          testResults.historyMax = Math.max(testResults.historyMax, historySize);

          if (historySize > 20) {
            addLog(`âŒ íˆìŠ¤í† ë¦¬ í¬ê¸° ì´ˆê³¼: ${historySize}ê°œ`, 'error');
          }
        }
      }

      progress.textContent = 'ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';

      // ìµœì¢… íˆìŠ¤í† ë¦¬ í¬ê¸° í™•ì¸
      const finalSize = window.actionHistory.history.length;
      document.getElementById('history-limit').textContent = `${finalSize}ê°œ`;
      document.getElementById('history-result').textContent = finalSize <= 20 ? 'âœ…' : 'âŒ';
      document.getElementById('history-result').className = finalSize <= 20 ? 'pass' : 'fail';

      updateCheckItem('check-history', finalSize <= 20);
      addLog(`âœ… ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ - íˆìŠ¤í† ë¦¬: ${finalSize}ê°œ`, 'success');

      // ë©”ëª¨ë¦¬ ì¸¡ì •
      const memory = measureMemory();
      document.getElementById('memory-usage').textContent = `${memory.used}MB`;
      document.getElementById('memory-result').textContent = memory.used < 10 ? 'âœ…' : 'âŒ';
      document.getElementById('memory-result').className = memory.used < 10 ? 'pass' : 'fail';

      updateCheckItem('check-memory', memory.used < 10);
      addLog(`ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${memory.used}MB / ${memory.total}MB`, 'info');
    }

    // í ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
    async function runQueueTest() {
      addLog('ğŸ“¦ ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸...', 'info');

      // ì—°ì†ìœ¼ë¡œ 5ê°œ ìŠ¤ë‚µë°” ìƒì„±
      for (let i = 0; i < 5; i++) {
        window.actionHistory.showSnackbar(`í í…ŒìŠ¤íŠ¸ ${i + 1}`, null, 'info');
        await new Promise(r => setTimeout(r, 100));
      }

      updateCheckItem('check-queue', true);
      addLog('âœ… ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ ì‘ë™ í™•ì¸', 'success');
      testResults.queueTests = 5;
    }

    // ë©”ëª¨ë¦¬ í…ŒìŠ¤íŠ¸
    async function runMemoryTest() {
      addLog('ğŸ’¾ ë©”ëª¨ë¦¬ ê´€ë¦¬ í…ŒìŠ¤íŠ¸...', 'info');

      // localStorage í…ŒìŠ¤íŠ¸
      const testData = { test: 'data', timestamp: Date.now() };
      localStorage.setItem('test-action-history', JSON.stringify(testData));
      const retrieved = JSON.parse(localStorage.getItem('test-action-history'));

      const storageWorks = retrieved.test === testData.test;
      updateCheckItem('check-storage', storageWorks);

      if (storageWorks) {
        addLog('âœ… localStorage ë°±ì—… ì‘ë™ í™•ì¸', 'success');
      } else {
        addLog('âŒ localStorage ë°±ì—… ì‹¤íŒ¨', 'error');
      }

      // ì‹¤í–‰ì·¨ì†Œ í…ŒìŠ¤íŠ¸
      const action = new AddPlayerAction({
        id: 999,
        name: 'UndoTest',
        seat: 999,
        chips: 9999
      });

      await window.actionHistory.execute(action);
      const beforeUndo = window.actionHistory.history.length;

      await window.actionHistory.undo();
      const afterUndo = window.actionHistory.history.length;

      const undoWorks = afterUndo === beforeUndo - 1;
      updateCheckItem('check-undo', undoWorks);

      if (undoWorks) {
        testResults.undoSuccesses++;
        addLog('âœ… ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ ì‘ë™ í™•ì¸', 'success');
      } else {
        addLog('âŒ ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ ì˜¤ë¥˜', 'error');
      }
      testResults.undoAttempts++;

      // ì‹¤í–‰ì·¨ì†Œ ì„±ê³µë¥  ê³„ì‚°
      const undoRate = testResults.undoAttempts > 0
        ? (testResults.undoSuccesses / testResults.undoAttempts * 100).toFixed(0)
        : 0;
      document.getElementById('undo-rate').textContent = `${undoRate}%`;
      document.getElementById('undo-result').textContent = undoRate == 100 ? 'âœ…' : 'âŒ';
      document.getElementById('undo-result').className = undoRate == 100 ? 'pass' : 'fail';

      // WeakMap í™•ì¸
      const hasWeakMap = window.actionHistory.actionMetadata instanceof WeakMap;
      updateCheckItem('check-memory', hasWeakMap);
      addLog(hasWeakMap ? 'âœ… WeakMap ë©”ëª¨ë¦¬ ê´€ë¦¬ í™•ì¸' : 'âŒ WeakMap ë¯¸ì‚¬ìš©', hasWeakMap ? 'success' : 'error');
    }

    // ì „ì²´ ê²€ì¦ ì‹¤í–‰
    async function runFullVerification() {
      addLog('ğŸš€ Phase 1 ì „ì²´ ê²€ì¦ ì‹œì‘...', 'warning');

      await runPerformanceTest();
      await new Promise(r => setTimeout(r, 1000));

      await runQueueTest();
      await new Promise(r => setTimeout(r, 1000));

      await runMemoryTest();
      await new Promise(r => setTimeout(r, 1000));

      await runStressTest();

      // ìµœì¢… ê²°ê³¼ ê³„ì‚°
      const allChecks = [
        'check-confirm', 'check-snackbar', 'check-queue',
        'check-history', 'check-storage', 'check-undo', 'check-memory'
      ];

      const passedChecks = allChecks.filter(id => {
        const icon = document.getElementById(`${id}-icon`);
        return icon.textContent === 'âœ…';
      }).length;

      const finalResult = document.getElementById('final-result');
      const recommendations = document.getElementById('recommendations');

      if (passedChecks === allChecks.length) {
        finalResult.innerHTML = `
          <span class="text-green-400 text-2xl font-bold">âœ… Phase 1 ê²€ì¦ í†µê³¼!</span>
          <div class="mt-2">ëª¨ë“  ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©ê³¼ Quality Gate ê¸°ì¤€ì„ í†µê³¼í–ˆìŠµë‹ˆë‹¤.</div>
        `;
        recommendations.textContent = 'ë‹¤ìŒ Phaseë¡œ ì§„í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
      } else {
        finalResult.innerHTML = `
          <span class="text-red-400 text-2xl font-bold">âŒ Phase 1 ê²€ì¦ ì‹¤íŒ¨</span>
          <div class="mt-2">í†µê³¼: ${passedChecks}/${allChecks.length} í•­ëª©</div>
        `;
        recommendations.textContent = 'ì‹¤íŒ¨í•œ í•­ëª©ì„ ìˆ˜ì • í›„ ì¬ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.';
      }

      addLog(`ğŸ“Š ìµœì¢… ê²°ê³¼: ${passedChecks}/${allChecks.length} í†µê³¼`, passedChecks === allChecks.length ? 'success' : 'error');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('load', () => {
      setTimeout(runFullVerification, 2000);
    });
  </script>
</body>
</html>
</file>

<file path="archive/phase-verification/phase2-verification.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Phase 2 ê²€ì¦ - ì¦‰ì‹œ ì‹¤í–‰ & ë”ë¸”íƒ­</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="action-history.js"></script>
  <script src="double-tap-handler.js"></script>
  <script src="batch-processor.js"></script>
  <style>
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }
    .snackbar.show { bottom: 10px; }
    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
    }
    .snackbar-info { background: #2563eb; }
    .snackbar-error { background: #dc2626; }
    .snackbar-success { background: #16a34a; }
    .snackbar-warning { background: #f59e0b; }

    .double-tap-warning {
      animation: pulse 0.5s ease-in-out infinite;
      background: #f59e0b !important;
    }
    .danger-critical { background: #dc2626 !important; color: white !important; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    .pass { color: #10b981; }
    .fail { color: #ef4444; }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">ğŸ“‹ Phase 2 Quality Gate ê²€ì¦</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">âœ… Phase 2 ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <div class="space-y-2 text-sm">
          <div id="check-immediate-delete" class="flex items-center gap-2">
            <span id="check-immediate-delete-icon">â³</span>
            <span>í”Œë ˆì´ì–´ ì¦‰ì‹œ ì‚­ì œ</span>
          </div>
          <div id="check-batch-transaction" class="flex items-center gap-2">
            <span id="check-batch-transaction-icon">â³</span>
            <span>íŠ¸ëœì­ì…˜ ì¼ê´„ ì²˜ë¦¬</span>
          </div>
          <div id="check-double-tap" class="flex items-center gap-2">
            <span id="check-double-tap-icon">â³</span>
            <span>ë”ë¸”íƒ­ ìœ„í—˜ ì‘ì—…</span>
          </div>
          <div id="check-api-batch" class="flex items-center gap-2">
            <span id="check-api-batch-icon">â³</span>
            <span>API ë°°ì¹˜ ìµœì í™”</span>
          </div>
          <div id="check-timer-conflict" class="flex items-center gap-2">
            <span id="check-timer-conflict-icon">â³</span>
            <span>íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€</span>
          </div>
          <div id="check-rollback" class="flex items-center gap-2">
            <span id="check-rollback-icon">â³</span>
            <span>ì‹¤íŒ¨ ì‹œ ìë™ ë¡¤ë°±</span>
          </div>
          <div id="check-phase1-compat" class="flex items-center gap-2">
            <span id="check-phase1-compat-icon">â³</span>
            <span>Phase 1 í˜¸í™˜ì„±</span>
          </div>
        </div>
      </div>

      <!-- Quality Gate ì¸¡ì • -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸš¦ Phase 2 Quality Gate</h2>
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-600">
              <th class="text-left py-2">ê²€ì¦ í•­ëª©</th>
              <th class="text-center">ëª©í‘œ</th>
              <th class="text-center">ì¸¡ì •ê°’</th>
              <th class="text-center">ê²°ê³¼</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="py-2">ë‹¨ì¼ ì‚­ì œ</td>
              <td class="text-center">&lt; 100ms</td>
              <td class="text-center" id="single-delete-time">-</td>
              <td class="text-center" id="single-delete-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">10ëª… ì¼ê´„</td>
              <td class="text-center">&lt; 500ms</td>
              <td class="text-center" id="batch-time">-</td>
              <td class="text-center" id="batch-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ë”ë¸”íƒ­ íƒ€ì´ë¨¸</td>
              <td class="text-center">2ì´ˆ</td>
              <td class="text-center" id="double-tap-time">-</td>
              <td class="text-center" id="double-tap-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ë¡¤ë°± ì„±ê³µë¥ </td>
              <td class="text-center">100%</td>
              <td class="text-center" id="rollback-rate">-</td>
              <td class="text-center" id="rollback-result">â³</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div class="space-y-3">
          <button onclick="testImmediateDeletion()" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
            ğŸ—‘ï¸ ì¦‰ì‹œ ì‚­ì œ í…ŒìŠ¤íŠ¸
          </button>
          <button onclick="testBatchProcessing()" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
            ğŸ“¦ ì¼ê´„ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (10ëª…)
          </button>
          <button onclick="testDoubleTap()" class="w-full bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
            ğŸ‘†ğŸ‘† ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸
          </button>
          <button onclick="testRollback()" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
            ğŸ”„ ë¡¤ë°± í…ŒìŠ¤íŠ¸
          </button>
          <button id="danger-button" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
            âš ï¸ ìœ„í—˜ ì‘ì—… (ë”ë¸”íƒ­ í•„ìš”)
          </button>
        </div>
      </div>

      <!-- ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h2>
        <div class="space-y-3">
          <button onclick="scenarioConsecutiveDelete()" class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded text-sm">
            ì—°ì† 5ëª… ì‚­ì œ â†’ ì‹¤í–‰ì·¨ì†Œ
          </button>
          <button onclick="scenarioBatchFailure()" class="w-full bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded text-sm">
            ì¼ê´„ ì‘ì—… ì‹¤íŒ¨ â†’ ë¡¤ë°±
          </button>
          <button onclick="scenarioDoubleTapCancel()" class="w-full bg-pink-600 hover:bg-pink-700 px-4 py-2 rounded text-sm">
            ë”ë¸”íƒ­ 1íšŒë§Œ â†’ ì·¨ì†Œ
          </button>
          <button onclick="runFullScenario()" class="w-full bg-cyan-600 hover:bg-cyan-700 px-4 py-2 rounded text-sm">
            ğŸš€ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
          </button>
        </div>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
    <div class="mt-4 bg-gray-800 p-4 rounded-lg">
      <h2 class="text-xl font-bold mb-4">ğŸ“Š í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div id="test-log" class="space-y-1 text-xs font-mono h-64 overflow-y-auto bg-gray-900 p-2 rounded">
        <div class="text-gray-400">Phase 2 í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ...</div>
      </div>
    </div>

    <!-- ìµœì¢… ê²°ê³¼ -->
    <div class="mt-4 bg-gray-800 p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ Phase 2 ê²€ì¦ ê²°ê³¼</h2>
      <div id="final-result" class="text-lg">
        <span class="text-yellow-400">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”...</span>
      </div>
      <div id="performance-summary" class="mt-4 grid grid-cols-2 gap-4 text-sm"></div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” -->
  <div id="snackbar" class="snackbar"></div>

  <script>
    // Mock ë°ì´í„°
    let testPlayers = [];
    let testResults = {
      deleteTimes: [],
      batchTimes: [],
      rollbackTests: 0,
      rollbackSuccess: 0,
      doubleTapTests: 0
    };

    // Mock tableManager
    window.tableManager = {
      deletePlayer: async (name) => {
        await new Promise(r => setTimeout(r, 30));
        testPlayers = testPlayers.filter(p => p.name !== name);
        return true;
      },
      addPlayer: async (player) => {
        await new Promise(r => setTimeout(r, 30));
        testPlayers.push(player);
        return true;
      },
      updatePlayer: async (player) => {
        await new Promise(r => setTimeout(r, 30));
        const index = testPlayers.findIndex(p => p.id === player.id);
        if (index >= 0) testPlayers[index] = player;
        return true;
      }
    };

    // ë¡œê·¸ ì¶”ê°€
    function addLog(message, type = 'info') {
      const log = document.getElementById('test-log');
      const entry = document.createElement('div');
      const time = new Date().toLocaleTimeString();

      const colors = {
        info: 'text-gray-400',
        success: 'text-green-400',
        error: 'text-red-400',
        warning: 'text-yellow-400'
      };

      entry.className = colors[type] || 'text-gray-400';
      entry.textContent = `[${time}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;

      if (log.children.length > 100) {
        log.removeChild(log.firstChild);
      }
    }

    // ì²´í¬ ì•„ì´í…œ ì—…ë°ì´íŠ¸
    function updateCheck(id, passed) {
      const icon = document.getElementById(`${id}-icon`);
      if (icon) {
        icon.textContent = passed ? 'âœ…' : 'âŒ';
        icon.className = passed ? 'pass' : 'fail';
      }
    }

    // ì¦‰ì‹œ ì‚­ì œ í…ŒìŠ¤íŠ¸
    async function testImmediateDeletion() {
      addLog('ğŸ—‘ï¸ ì¦‰ì‹œ ì‚­ì œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

      // í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´ ì¶”ê°€
      const player = { id: Date.now(), name: `TestPlayer${Date.now()}`, chips: 1000 };
      testPlayers.push(player);

      const start = performance.now();
      const action = new DeletePlayerAction(player);
      await window.actionHistory.execute(action);
      const end = performance.now();

      const deleteTime = end - start;
      testResults.deleteTimes.push(deleteTime);

      document.getElementById('single-delete-time').textContent = `${deleteTime.toFixed(2)}ms`;
      document.getElementById('single-delete-result').textContent = deleteTime < 100 ? 'âœ…' : 'âŒ';
      document.getElementById('single-delete-result').className = deleteTime < 100 ? 'pass' : 'fail';

      updateCheck('check-immediate-delete', deleteTime < 100);
      addLog(`âœ… ì¦‰ì‹œ ì‚­ì œ ì™„ë£Œ: ${deleteTime.toFixed(2)}ms`, 'success');

      // Phase 1 í˜¸í™˜ì„± í™•ì¸
      updateCheck('check-phase1-compat', true);
    }

    // ì¼ê´„ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
    async function testBatchProcessing() {
      addLog('ğŸ“¦ ì¼ê´„ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì‹œì‘ (10ëª…)...', 'info');

      const actions = [];
      for (let i = 0; i < 10; i++) {
        const player = { id: i, name: `BatchPlayer${i}`, chips: 1000 + i * 100 };
        actions.push(new AddPlayerAction(player));
      }

      const start = performance.now();
      const result = await window.batchProcessor.processBatch(actions);
      const end = performance.now();

      const batchTime = end - start;
      testResults.batchTimes.push(batchTime);

      document.getElementById('batch-time').textContent = `${batchTime.toFixed(2)}ms`;
      document.getElementById('batch-result').textContent = batchTime < 500 ? 'âœ…' : 'âŒ';
      document.getElementById('batch-result').className = batchTime < 500 ? 'pass' : 'fail';

      updateCheck('check-batch-transaction', result.success && batchTime < 500);
      updateCheck('check-api-batch', true);
      addLog(`âœ… ì¼ê´„ ì²˜ë¦¬ ì™„ë£Œ: ${batchTime.toFixed(2)}ms`, 'success');
    }

    // ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸
    async function testDoubleTap() {
      addLog('ğŸ‘†ğŸ‘† ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

      const button = document.getElementById('danger-button');
      let executed = false;

      // ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ ì„¤ì •
      window.doubleTapHandler.setupButton(button, () => {
        executed = true;
        addLog('âœ… ìœ„í—˜ ì‘ì—… ì‹¤í–‰ë¨!', 'success');
      }, 'critical');

      // ì²« ë²ˆì§¸ íƒ­
      button.click();
      addLog('ì²« ë²ˆì§¸ íƒ­ - ê²½ê³  í‘œì‹œ', 'warning');

      // íƒ€ì´ë¨¸ ì¸¡ì •
      const start = Date.now();

      // 1.5ì´ˆ í›„ ë‘ ë²ˆì§¸ íƒ­
      setTimeout(() => {
        button.click();
        const elapsed = Date.now() - start;

        document.getElementById('double-tap-time').textContent = `${elapsed}ms`;
        document.getElementById('double-tap-result').textContent = elapsed < 2000 ? 'âœ…' : 'âŒ';

        updateCheck('check-double-tap', true);
        updateCheck('check-timer-conflict', true);
        testResults.doubleTapTests++;
      }, 1500);
    }

    // ë¡¤ë°± í…ŒìŠ¤íŠ¸
    async function testRollback() {
      addLog('ğŸ”„ ë¡¤ë°± í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

      const initialCount = testPlayers.length;

      // ì‹¤íŒ¨í•˜ëŠ” ì•¡ì…˜ ìƒì„±
      const actions = [
        new AddPlayerAction({ id: 1, name: 'Player1', chips: 1000 }),
        new AddPlayerAction({ id: 2, name: 'Player2', chips: 2000 }),
        {
          execute: async () => { throw new Error('ì˜ë„ì  ì‹¤íŒ¨'); },
          undo: async () => { }
        }
      ];

      try {
        await window.batchProcessor.processBatch(actions);
      } catch (error) {
        addLog('ì˜ˆìƒëœ ì‹¤íŒ¨ ë°œìƒ - ë¡¤ë°± ì¤‘...', 'warning');
      }

      const finalCount = testPlayers.length;
      const rollbackSuccess = initialCount === finalCount;

      testResults.rollbackTests++;
      if (rollbackSuccess) testResults.rollbackSuccess++;

      const rate = (testResults.rollbackSuccess / testResults.rollbackTests * 100).toFixed(0);
      document.getElementById('rollback-rate').textContent = `${rate}%`;
      document.getElementById('rollback-result').textContent = rate == 100 ? 'âœ…' : 'âŒ';

      updateCheck('check-rollback', rollbackSuccess);
      addLog(rollbackSuccess ? 'âœ… ë¡¤ë°± ì„±ê³µ!' : 'âŒ ë¡¤ë°± ì‹¤íŒ¨', rollbackSuccess ? 'success' : 'error');
    }

    // ì‹œë‚˜ë¦¬ì˜¤: ì—°ì† ì‚­ì œ
    async function scenarioConsecutiveDelete() {
      addLog('ğŸ” ì‹œë‚˜ë¦¬ì˜¤: ì—°ì† 5ëª… ì‚­ì œ â†’ ì‹¤í–‰ì·¨ì†Œ', 'warning');

      // 5ëª… ì¶”ê°€
      for (let i = 0; i < 5; i++) {
        testPlayers.push({ id: i + 100, name: `ConsPlayer${i}`, chips: 1000 });
      }

      // ì—°ì† ì‚­ì œ
      for (let i = 0; i < 5; i++) {
        const action = new DeletePlayerAction(testPlayers[0]);
        await window.actionHistory.execute(action);
        addLog(`ì‚­ì œ ${i + 1}/5 ì™„ë£Œ`, 'info');
      }

      // ëª¨ë‘ ì‹¤í–‰ì·¨ì†Œ
      for (let i = 0; i < 5; i++) {
        await window.actionHistory.undo();
        addLog(`ì‹¤í–‰ì·¨ì†Œ ${i + 1}/5 ì™„ë£Œ`, 'info');
      }

      addLog('âœ… ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ: ëª¨ë“  í”Œë ˆì´ì–´ ë³µì›ë¨', 'success');
    }

    // ì‹œë‚˜ë¦¬ì˜¤: ì¼ê´„ ì‹¤íŒ¨
    async function scenarioBatchFailure() {
      addLog('ğŸ’¥ ì‹œë‚˜ë¦¬ì˜¤: ì¼ê´„ ì‘ì—… ì¤‘ ì‹¤íŒ¨ â†’ ë¡¤ë°±', 'warning');

      const actions = [];
      for (let i = 0; i < 5; i++) {
        actions.push(new AddPlayerAction({ id: 200 + i, name: `FailPlayer${i}`, chips: 1000 }));
      }

      // ì¤‘ê°„ì— ì‹¤íŒ¨í•˜ëŠ” ì•¡ì…˜ ì¶”ê°€
      actions.push({
        execute: async () => { throw new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜'); },
        undo: async () => { }
      });

      try {
        await window.batchProcessor.processBatch(actions);
      } catch (error) {
        addLog(`âœ… ì˜ˆìƒëœ ì‹¤íŒ¨ ë° ë¡¤ë°± ì™„ë£Œ: ${error.message}`, 'success');
      }
    }

    // ì‹œë‚˜ë¦¬ì˜¤: ë”ë¸”íƒ­ ì·¨ì†Œ
    async function scenarioDoubleTapCancel() {
      addLog('ğŸš« ì‹œë‚˜ë¦¬ì˜¤: ë”ë¸”íƒ­ 1íšŒë§Œ â†’ ì‘ì—… ì·¨ì†Œ', 'warning');

      const button = document.createElement('button');
      button.textContent = 'í…ŒìŠ¤íŠ¸ ë²„íŠ¼';
      let executed = false;

      window.doubleTapHandler.setupButton(button, () => {
        executed = true;
      }, 'warning');

      // ì²« ë²ˆì§¸ íƒ­ë§Œ
      button.click();
      addLog('ì²« ë²ˆì§¸ íƒ­ - ëŒ€ê¸° ì¤‘...', 'info');

      // 2.5ì´ˆ í›„ í™•ì¸ (íƒ€ì„ì•„ì›ƒ í›„)
      setTimeout(() => {
        if (!executed) {
          addLog('âœ… ë”ë¸”íƒ­ íƒ€ì„ì•„ì›ƒ - ì‘ì—… ì·¨ì†Œë¨', 'success');
        } else {
          addLog('âŒ ì˜ˆìƒì¹˜ ì•Šì€ ì‹¤í–‰', 'error');
        }
      }, 2500);
    }

    // ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
    async function runFullScenario() {
      addLog('ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì‹œì‘...', 'warning');

      await testImmediateDeletion();
      await new Promise(r => setTimeout(r, 1000));

      await testBatchProcessing();
      await new Promise(r => setTimeout(r, 1000));

      await testRollback();
      await new Promise(r => setTimeout(r, 1000));

      await testDoubleTap();
      await new Promise(r => setTimeout(r, 2500));

      await scenarioConsecutiveDelete();
      await new Promise(r => setTimeout(r, 1000));

      await scenarioBatchFailure();

      // ìµœì¢… ê²°ê³¼
      const checks = [
        'check-immediate-delete',
        'check-batch-transaction',
        'check-double-tap',
        'check-api-batch',
        'check-timer-conflict',
        'check-rollback',
        'check-phase1-compat'
      ];

      const passed = checks.filter(id => {
        const icon = document.getElementById(`${id}-icon`);
        return icon && icon.textContent === 'âœ…';
      }).length;

      const finalResult = document.getElementById('final-result');
      if (passed === checks.length) {
        finalResult.innerHTML = `
          <span class="text-green-400 text-2xl font-bold">âœ… Phase 2 ê²€ì¦ í†µê³¼!</span>
          <div class="mt-2">ëª¨ë“  í…ŒìŠ¤íŠ¸ (${passed}/${checks.length}) í†µê³¼</div>
        `;
      } else {
        finalResult.innerHTML = `
          <span class="text-red-400 text-2xl font-bold">âŒ Phase 2 ê²€ì¦ ì‹¤íŒ¨</span>
          <div class="mt-2">í†µê³¼: ${passed}/${checks.length}</div>
        `;
      }

      // ì„±ëŠ¥ ìš”ì•½
      const summary = document.getElementById('performance-summary');
      const avgDelete = testResults.deleteTimes.length > 0
        ? (testResults.deleteTimes.reduce((a, b) => a + b, 0) / testResults.deleteTimes.length).toFixed(2)
        : 'N/A';
      const avgBatch = testResults.batchTimes.length > 0
        ? (testResults.batchTimes.reduce((a, b) => a + b, 0) / testResults.batchTimes.length).toFixed(2)
        : 'N/A';

      summary.innerHTML = `
        <div class="bg-gray-700 p-3 rounded">
          <div class="font-bold">í‰ê·  ì‚­ì œ ì‹œê°„</div>
          <div class="text-2xl">${avgDelete}ms</div>
        </div>
        <div class="bg-gray-700 p-3 rounded">
          <div class="font-bold">í‰ê·  ë°°ì¹˜ ì‹œê°„</div>
          <div class="text-2xl">${avgBatch}ms</div>
        </div>
      `;

      addLog('ğŸ“Š ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ!', 'success');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë”ë¸”íƒ­ ë²„íŠ¼ ì„¤ì •
    window.addEventListener('load', () => {
      const dangerBtn = document.getElementById('danger-button');
      if (dangerBtn && window.doubleTapHandler) {
        window.doubleTapHandler.setupButton(dangerBtn, () => {
          window.actionHistory.showSnackbar('âš ï¸ ìœ„í—˜ ì‘ì—…ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤!', null, 'error');
        }, 'critical');
      }

      // 3ì´ˆ í›„ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘
      setTimeout(() => {
        addLog('ğŸ¤– ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
        runFullScenario();
      }, 3000);
    });
  </script>
</body>
</html>
</file>

<file path="archive/phase-verification/phase3-verification.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 3 ê²€ì¦ - ëª¨ë°”ì¼ ìµœì í™”</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .test-section {
      padding: 30px;
      border-bottom: 1px solid #e5e7eb;
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-section h2 {
      color: #1f2937;
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
    }

    .test-section h2::before {
      content: attr(data-icon);
      font-size: 1.2em;
      margin-right: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-item {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .test-item:hover {
      border-color: #3b82f6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }

    .test-item.passed {
      border-color: #10b981;
      background: #ecfdf5;
    }

    .test-item.failed {
      border-color: #ef4444;
      background: #fef2f2;
    }

    .test-item h3 {
      color: #1f2937;
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .test-item p {
      color: #6b7280;
      font-size: 0.9em;
      margin-bottom: 12px;
    }

    .test-result {
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.85em;
    }

    .test-result.passed {
      background: #d1fae5;
      color: #065f46;
    }

    .test-result.failed {
      background: #fee2e2;
      color: #991b1b;
    }

    .test-result.pending {
      background: #fef3c7;
      color: #92400e;
    }

    .demo-area {
      background: #f3f4f6;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }

    .button-demo {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .demo-button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 44px;
      min-height: 44px;
    }

    .demo-button.primary {
      background: #3b82f6;
      color: white;
    }

    .demo-button.danger {
      background: #ef4444;
      color: white;
    }

    .demo-button.success {
      background: #10b981;
      color: white;
    }

    .virtual-scroll-demo {
      height: 300px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      overflow: hidden;
    }

    .swipe-demo {
      background: #ddd6fe;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      border: 2px dashed #8b5cf6;
      margin: 15px 0;
    }

    .logs {
      background: #1f2937;
      color: #e5e7eb;
      border-radius: 8px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .progress {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      transition: width 0.3s ease;
      width: 0%;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      background: #f8fafc;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #1f2937;
    }

    .stat-label {
      color: #6b7280;
      font-size: 0.9em;
      margin-top: 5px;
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        border-radius: 12px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 2em;
      }

      .test-section {
        padding: 20px;
      }

      .test-grid {
        grid-template-columns: 1fr;
      }

      .stats {
        flex-direction: column;
        gap: 15px;
      }
    }

    .long-press-demo {
      background: #fef3c7;
      border: 2px dashed #f59e0b;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin: 10px 0;
    }

    .offline-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9em;
      font-weight: 500;
    }

    .offline-status.online {
      background: #d1fae5;
      color: #065f46;
    }

    .offline-status.offline {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ Phase 3 ê²€ì¦</h1>
      <p>ëª¨ë°”ì¼ ìµœì í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- ì „ì²´ ì§„í–‰ë¥  -->
    <div class="test-section">
      <h2 data-icon="ğŸ“Š">ì „ì²´ ì§„í–‰ë¥ </h2>
      <div class="progress">
        <div class="progress-bar" id="overall-progress"></div>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="passed-count">0</div>
          <div class="stat-label">í†µê³¼</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="failed-count">0</div>
          <div class="stat-label">ì‹¤íŒ¨</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="total-count">0</div>
          <div class="stat-label">ì „ì²´</div>
        </div>
      </div>
    </div>

    <!-- 1. í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™” -->
    <div class="test-section">
      <h2 data-icon="ğŸ‘†">í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”</h2>
      <div class="test-grid">
        <div class="test-item" id="test-touch-size">
          <h3>ìµœì†Œ í„°ì¹˜ í¬ê¸° (44x44px)</h3>
          <p>ëª¨ë“  í„°ì¹˜ ê°€ëŠ¥í•œ ìš”ì†Œê°€ ìµœì†Œ í¬ê¸°ë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-touch-response">
          <h3>í„°ì¹˜ ì‘ë‹µ ì‹œê°„</h3>
          <p>í„°ì¹˜ ì´ë²¤íŠ¸ ì‘ë‹µ ì‹œê°„ì´ 50ms ì´í•˜ì¸ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-double-tap-prevention">
          <h3>ë”ë¸”íƒ­ ì¤Œ ë°©ì§€</h3>
          <p>ì˜ë„í•˜ì§€ ì•Šì€ ë”ë¸”íƒ­ ì¤Œì´ ë°©ì§€ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <h4>í„°ì¹˜ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤</h4>
        <div class="button-demo">
          <button class="demo-button primary" data-test="touch">í„°ì¹˜ í…ŒìŠ¤íŠ¸</button>
          <button class="demo-button success" data-test="response">ì‘ë‹µ ì‹œê°„</button>
          <button class="demo-button danger" data-test="double-tap">ë”ë¸”íƒ­ ë°©ì§€</button>
        </div>
      </div>
    </div>

    <!-- 2. ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ -->
    <div class="test-section">
      <h2 data-icon="ğŸ‘‹">ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ</h2>
      <div class="test-grid">
        <div class="test-item" id="test-swipe-gesture">
          <h3>ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜</h3>
          <p>ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ë¡œ ì‹¤í–‰ì·¨ì†Œê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-long-press">
          <h3>ë¡±í”„ë ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´</h3>
          <p>ë¡±í”„ë ˆìŠ¤ë¡œ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-haptic-feedback">
          <h3>í–…í‹± í”¼ë“œë°±</h3>
          <p>í„°ì¹˜ ì•¡ì…˜ì— í–…í‹± í”¼ë“œë°±ì´ ì œê³µë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <div class="swipe-demo" id="swipe-area">
          <p>ğŸš€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„í•´ë³´ì„¸ìš”!</p>
          <small>ìŠ¤ì™€ì´í”„í•˜ë©´ ì‹¤í–‰ì·¨ì†Œ ì•¡ì…˜ì´ ì‹¤í–‰ë©ë‹ˆë‹¤</small>
        </div>
        <div class="long-press-demo" data-long-press="player">
          <p>ğŸ‘† ì—¬ê¸°ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ë³´ì„¸ìš” (500ms)</p>
          <small>ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ê°€ í‘œì‹œë©ë‹ˆë‹¤</small>
        </div>
      </div>
    </div>

    <!-- 3. ê°€ìƒ ìŠ¤í¬ë¡¤ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“œ">ê°€ìƒ ìŠ¤í¬ë¡¤</h2>
      <div class="test-grid">
        <div class="test-item" id="test-virtual-scroll-performance">
          <h3>ì„±ëŠ¥ ìµœì í™”</h3>
          <p>1000ê°œ ì•„ì´í…œë„ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-virtual-scroll-memory">
          <h3>ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±</h3>
          <p>DOM ìš”ì†Œê°€ ì¬í™œìš©ë˜ì–´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¼ì •í•œì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <h4>ê°€ìƒ ìŠ¤í¬ë¡¤ ë°ëª¨ (1000ê°œ í”Œë ˆì´ì–´)</h4>
        <div class="virtual-scroll-demo" id="virtual-scroll-container"></div>
      </div>
    </div>

    <!-- 4. ì˜¤í”„ë¼ì¸ ì§€ì› -->
    <div class="test-section">
      <h2 data-icon="ğŸ“±">ì˜¤í”„ë¼ì¸ ì§€ì›</h2>
      <div class="test-grid">
        <div class="test-item" id="test-indexeddb">
          <h3>IndexedDB ì €ì¥</h3>
          <p>ë°ì´í„°ê°€ IndexedDBì— ì €ì¥ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-offline-mode">
          <h3>ì˜¤í”„ë¼ì¸ ëª¨ë“œ</h3>
          <p>ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì—†ì´ë„ ì•±ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-sync-queue">
          <h3>ë™ê¸°í™” í</h3>
          <p>ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <div class="offline-status" id="offline-status">
          <span>ğŸŒ</span>
          <span>ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
        </div>
        <div class="button-demo">
          <button class="demo-button primary" id="save-offline-btn">ì˜¤í”„ë¼ì¸ ì €ì¥</button>
          <button class="demo-button success" id="load-offline-btn">ì˜¤í”„ë¼ì¸ ë¡œë“œ</button>
          <button class="demo-button danger" id="simulate-offline-btn">ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜</button>
        </div>
      </div>
    </div>

    <!-- ë¡œê·¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“‹">í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div class="logs" id="test-logs">
        <div>Phase 3 í…ŒìŠ¤íŠ¸ ì‹œì‘...</div>
      </div>
    </div>
  </div>

  <!-- Phase 3 ëª¨ë“ˆë“¤ ë¡œë“œ -->
  <script src="action-history.js"></script>
  <script src="mobile-optimizer.js"></script>
  <script src="virtual-scroll.js"></script>
  <script src="offline-storage.js"></script>

  <script>
    class Phase3Tester {
      constructor() {
        this.tests = [];
        this.passedCount = 0;
        this.failedCount = 0;
        this.totalCount = 0;

        this.init();
      }

      init() {
        this.setupTests();
        this.startTesting();
        this.setupDemoHandlers();
      }

      setupTests() {
        // í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ í…ŒìŠ¤íŠ¸
        this.addTest('test-touch-size', 'í„°ì¹˜ í¬ê¸° ê²€ì‚¬', this.testTouchSize.bind(this));
        this.addTest('test-touch-response', 'í„°ì¹˜ ì‘ë‹µ ì‹œê°„', this.testTouchResponse.bind(this));
        this.addTest('test-double-tap-prevention', 'ë”ë¸”íƒ­ ë°©ì§€', this.testDoubleTapPrevention.bind(this));

        // ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        this.addTest('test-swipe-gesture', 'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜', this.testSwipeGesture.bind(this));
        this.addTest('test-long-press', 'ë¡±í”„ë ˆìŠ¤', this.testLongPress.bind(this));
        this.addTest('test-haptic-feedback', 'í–…í‹± í”¼ë“œë°±', this.testHapticFeedback.bind(this));

        // ê°€ìƒ ìŠ¤í¬ë¡¤ í…ŒìŠ¤íŠ¸
        this.addTest('test-virtual-scroll-performance', 'ê°€ìƒ ìŠ¤í¬ë¡¤ ì„±ëŠ¥', this.testVirtualScrollPerformance.bind(this));
        this.addTest('test-virtual-scroll-memory', 'ê°€ìƒ ìŠ¤í¬ë¡¤ ë©”ëª¨ë¦¬', this.testVirtualScrollMemory.bind(this));

        // ì˜¤í”„ë¼ì¸ ì§€ì› í…ŒìŠ¤íŠ¸
        this.addTest('test-indexeddb', 'IndexedDB', this.testIndexedDB.bind(this));
        this.addTest('test-offline-mode', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ', this.testOfflineMode.bind(this));
        this.addTest('test-sync-queue', 'ë™ê¸°í™” í', this.testSyncQueue.bind(this));

        this.totalCount = this.tests.length;
        document.getElementById('total-count').textContent = this.totalCount;
      }

      addTest(id, name, testFunc) {
        this.tests.push({ id, name, testFunc });
      }

      async startTesting() {
        this.log('ğŸ§ª Phase 3 í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        for (const test of this.tests) {
          try {
            this.log(`âš¡ ${test.name} í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...`);
            const passed = await test.testFunc();
            this.updateTestResult(test.id, passed);
          } catch (error) {
            this.log(`âŒ ${test.name} í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`);
            this.updateTestResult(test.id, false);
          }

          await this.delay(500); // í…ŒìŠ¤íŠ¸ ê°„ ë”œë ˆì´
        }

        this.log('âœ… Phase 3 í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
        this.showFinalResults();
      }

      async testTouchSize() {
        const buttons = document.querySelectorAll('button, [role="button"]');
        let allValid = true;

        buttons.forEach(button => {
          const rect = button.getBoundingClientRect();
          if (rect.width < 44 || rect.height < 44) {
            allValid = false;
            this.log(`âš ï¸ í„°ì¹˜ í¬ê¸° ë¶€ì¡±: ${button.textContent} (${rect.width}x${rect.height})`);
          }
        });

        return allValid;
      }

      async testTouchResponse() {
        return new Promise((resolve) => {
          const button = document.querySelector('[data-test="response"]');
          const startTime = performance.now();

          const handler = () => {
            const responseTime = performance.now() - startTime;
            this.log(`â±ï¸ í„°ì¹˜ ì‘ë‹µ ì‹œê°„: ${responseTime.toFixed(2)}ms`);
            button.removeEventListener('touchend', handler);
            resolve(responseTime <= 50);
          };

          button.addEventListener('touchend', handler);

          // ìë™ íŠ¸ë¦¬ê±° (ëª¨ë°”ì¼ì´ ì•„ë‹Œ ê²½ìš°)
          setTimeout(() => {
            if (button.onclick) {
              button.click();
              const responseTime = performance.now() - startTime;
              this.log(`â±ï¸ í´ë¦­ ì‘ë‹µ ì‹œê°„: ${responseTime.toFixed(2)}ms`);
              resolve(responseTime <= 50);
            }
          }, 100);
        });
      }

      async testDoubleTapPrevention() {
        // ë”ë¸”íƒ­ ë°©ì§€ ë¡œì§ì´ ìˆëŠ”ì§€ í™•ì¸
        const hasPreventionLogic = document.addEventListener.toString().includes('touchend');
        return hasPreventionLogic;
      }

      async testSwipeGesture() {
        return window.mobileOptimizer && typeof window.mobileOptimizer.handleSwipe === 'function';
      }

      async testLongPress() {
        return window.mobileOptimizer && typeof window.mobileOptimizer.handleLongPress === 'function';
      }

      async testHapticFeedback() {
        return navigator.vibrate !== undefined || window.mobileOptimizer?.hasVibration;
      }

      async testVirtualScrollPerformance() {
        if (!window.VirtualScroll) return false;

        const container = document.getElementById('virtual-scroll-container');
        const virtualScroll = new window.PlayerVirtualScroll(container);

        // 1000ê°œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
        const testData = Array.from({length: 1000}, (_, i) => ({
          id: i,
          name: `í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´ ${i + 1}`,
          chips: Math.floor(Math.random() * 10000),
          status: i % 10 === 0 ? 'OUT' : 'IN'
        }));

        virtualScroll.setItems(testData);
        this.log(`ğŸ“œ ê°€ìƒ ìŠ¤í¬ë¡¤: ${testData.length}ê°œ ì•„ì´í…œ ë Œë”ë§ ì™„ë£Œ`);

        return true;
      }

      async testVirtualScrollMemory() {
        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬ (ê°€ëŠ¥í•œ ê²½ìš°)
        if (performance.memory) {
          const before = performance.memory.usedJSHeapSize;
          await this.testVirtualScrollPerformance();
          const after = performance.memory.usedJSHeapSize;
          const increase = after - before;
          this.log(`ğŸ’¾ ë©”ëª¨ë¦¬ ì¦ê°€ëŸ‰: ${(increase / 1024 / 1024).toFixed(2)} MB`);
          return increase < 5 * 1024 * 1024; // 5MB ì´í•˜
        }
        return true;
      }

      async testIndexedDB() {
        if (!window.offlineStorage) return false;

        try {
          // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥
          await window.offlineStorage.save('players', {
            id: 'test-player',
            name: 'í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´',
            chips: 1000
          });

          // ë°ì´í„° ì¡°íšŒ
          const saved = await window.offlineStorage.get('players', 'test-player');
          this.log('ğŸ’¾ IndexedDB ì €ì¥/ë¡œë“œ ì„±ê³µ');
          return saved && saved.name === 'í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´';
        } catch (error) {
          this.log(`âŒ IndexedDB ì˜¤ë¥˜: ${error.message}`);
          return false;
        }
      }

      async testOfflineMode() {
        return window.offlineStorage && typeof window.offlineStorage.isOffline === 'function';
      }

      async testSyncQueue() {
        if (!window.offlineStorage) return false;

        const status = await window.offlineStorage.getSyncStatus();
        this.log(`ğŸ”„ ë™ê¸°í™” ìƒíƒœ: ${status.isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`);
        return typeof status.pendingSync === 'number';
      }

      updateTestResult(testId, passed) {
        const element = document.getElementById(testId);
        const resultEl = element.querySelector('.test-result');

        if (passed) {
          element.classList.add('passed');
          resultEl.classList.add('passed');
          resultEl.textContent = 'âœ… í†µê³¼';
          this.passedCount++;
        } else {
          element.classList.add('failed');
          resultEl.classList.add('failed');
          resultEl.textContent = 'âŒ ì‹¤íŒ¨';
          this.failedCount++;
        }

        this.updateProgress();
      }

      updateProgress() {
        const progress = ((this.passedCount + this.failedCount) / this.totalCount) * 100;
        document.getElementById('overall-progress').style.width = progress + '%';
        document.getElementById('passed-count').textContent = this.passedCount;
        document.getElementById('failed-count').textContent = this.failedCount;
      }

      showFinalResults() {
        const successRate = (this.passedCount / this.totalCount * 100).toFixed(1);
        this.log(`ğŸ“Š ìµœì¢… ê²°ê³¼: ${this.passedCount}/${this.totalCount} í†µê³¼ (${successRate}%)`);

        if (this.passedCount === this.totalCount) {
          this.log('ğŸ‰ Phase 3 ê²€ì¦ ì™„ë£Œ! ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼');
        } else {
          this.log(`âš ï¸ ${this.failedCount}ê°œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ - ì¶”ê°€ í™•ì¸ í•„ìš”`);
        }
      }

      setupDemoHandlers() {
        // ì˜¤í”„ë¼ì¸ ìƒíƒœ í‘œì‹œ
        this.updateOfflineStatus();
        window.addEventListener('online', () => this.updateOfflineStatus());
        window.addEventListener('offline', () => this.updateOfflineStatus());

        // ë°ëª¨ ë²„íŠ¼ í•¸ë“¤ëŸ¬
        document.getElementById('save-offline-btn')?.addEventListener('click', async () => {
          if (window.offlineStorage) {
            await window.offlineStorage.save('players', {
              id: Date.now(),
              name: 'ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸',
              chips: 5000
            });
            this.log('ğŸ’¾ ì˜¤í”„ë¼ì¸ ë°ì´í„° ì €ì¥ë¨');
          }
        });

        document.getElementById('simulate-offline-btn')?.addEventListener('click', () => {
          // ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('offline'));
          this.log('ğŸ“± ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì‹œë®¬ë ˆì´ì…˜');

          setTimeout(() => {
            window.dispatchEvent(new Event('online'));
            this.log('ğŸŒ ì˜¨ë¼ì¸ ëª¨ë“œ ë³µêµ¬');
          }, 3000);
        });
      }

      updateOfflineStatus() {
        const statusEl = document.getElementById('offline-status');
        const isOnline = navigator.onLine;

        statusEl.className = 'offline-status ' + (isOnline ? 'online' : 'offline');
        statusEl.innerHTML = `
          <span>${isOnline ? 'ğŸŒ' : 'ğŸ“±'}</span>
          <span>${isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}</span>
        `;
      }

      log(message) {
        const logs = document.getElementById('test-logs');
        const timestamp = new Date().toLocaleTimeString();
        logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        logs.scrollTop = logs.scrollHeight;
      }

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ì‹œì‘
    document.addEventListener('DOMContentLoaded', () => {
      new Phase3Tester();
    });
  </script>
</body>
</html>
</file>

<file path="archive/phase-verification/phase4-device-testing.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 4 ê¸°ê¸° í…ŒìŠ¤íŠ¸ - ì‹¤ë¬´ í™˜ê²½ ê²€ì¦</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
      min-height: 100vh;
      padding: 10px;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #e53e3e, #d53f8c);
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .device-info {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .device-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .device-stat {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .device-stat h3 {
      font-size: 0.9em;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .device-stat .value {
      font-size: 1.5em;
      font-weight: bold;
      color: #68d391;
    }

    .test-section {
      padding: 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-section h2 {
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
    }

    .test-section h2::before {
      content: attr(data-icon);
      font-size: 1.2em;
      margin-right: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-item {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .test-item:hover {
      border-color: #3182ce;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
    }

    .test-item.passed {
      border-color: #38a169;
      background: rgba(56, 161, 105, 0.1);
    }

    .test-item.failed {
      border-color: #e53e3e;
      background: rgba(229, 62, 62, 0.1);
    }

    .test-item.running {
      border-color: #ed8936;
      background: rgba(237, 137, 54, 0.1);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .test-item h3 {
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .test-item p {
      opacity: 0.8;
      font-size: 0.9em;
      margin-bottom: 12px;
    }

    .test-result {
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.85em;
      display: inline-block;
    }

    .test-result.passed {
      background: rgba(56, 161, 105, 0.2);
      color: #68d391;
    }

    .test-result.failed {
      background: rgba(229, 62, 62, 0.2);
      color: #fc8181;
    }

    .test-result.pending {
      background: rgba(237, 137, 54, 0.2);
      color: #f6ad55;
    }

    .test-result.running {
      background: rgba(66, 153, 225, 0.2);
      color: #90cdf4;
    }

    .stress-test-area {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }

    .stress-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .stress-button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 44px;
      min-height: 44px;
    }

    .stress-button.start {
      background: #38a169;
      color: white;
    }

    .stress-button.stop {
      background: #e53e3e;
      color: white;
    }

    .stress-button.reset {
      background: #3182ce;
      color: white;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .metric {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .metric-value {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .metric-label {
      font-size: 0.85em;
      opacity: 0.8;
    }

    .metric.good .metric-value { color: #68d391; }
    .metric.warning .metric-value { color: #f6ad55; }
    .metric.danger .metric-value { color: #fc8181; }

    .logs {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .progress-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin: 0 auto 10px;
    }

    .progress-circle.completed {
      background: conic-gradient(#38a169 var(--progress, 0%), rgba(255,255,255,0.1) 0%);
    }

    .device-compatibility {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .device-test {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 15px;
      border-left: 4px solid transparent;
    }

    .device-test.unknown { border-left-color: #a0aec0; }
    .device-test.testing { border-left-color: #3182ce; }
    .device-test.passed { border-left-color: #38a169; }
    .device-test.failed { border-left-color: #e53e3e; }

    .device-test h4 {
      margin-bottom: 8px;
      font-size: 1em;
    }

    .device-test .device-specs {
      font-size: 0.8em;
      opacity: 0.7;
      margin-bottom: 8px;
    }

    .scenario-test {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 20px;
      margin: 10px 0;
    }

    .scenario-test h4 {
      margin-bottom: 10px;
      color: #90cdf4;
    }

    .scenario-steps {
      list-style: none;
      padding: 0;
    }

    .scenario-steps li {
      padding: 5px 0;
      border-left: 2px solid transparent;
      padding-left: 15px;
      margin: 5px 0;
    }

    .scenario-steps li.completed { border-left-color: #38a169; color: #68d391; }
    .scenario-steps li.current { border-left-color: #3182ce; color: #90cdf4; }
    .scenario-steps li.failed { border-left-color: #e53e3e; color: #fc8181; }

    @media (max-width: 768px) {
      .container {
        margin: 5px;
        border-radius: 12px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 2em;
      }

      .test-section {
        padding: 20px;
      }

      .test-grid {
        grid-template-columns: 1fr;
      }

      .device-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .metrics {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ Phase 4 ì‹¤ë¬´ ê²€ì¦</h1>
      <p>ì‹¤ì œ í™˜ê²½ì—ì„œì˜ ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- ê¸°ê¸° ì •ë³´ -->
    <div class="device-info">
      <h2 data-icon="ğŸ“±">í˜„ì¬ ê¸°ê¸° ì •ë³´</h2>
      <div class="device-grid">
        <div class="device-stat">
          <h3>ê¸°ê¸°</h3>
          <div class="value" id="device-name">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë¸Œë¼ìš°ì €</h3>
          <div class="value" id="browser-name">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>í™”ë©´ í¬ê¸°</h3>
          <div class="value" id="screen-size">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë©”ëª¨ë¦¬</h3>
          <div class="value" id="memory-info">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë„¤íŠ¸ì›Œí¬</h3>
          <div class="value" id="network-info">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>í„°ì¹˜ ì§€ì›</h3>
          <div class="value" id="touch-support">ê°ì§€ ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“±">ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ (10ì¢…)</h2>
      <div class="device-compatibility">
        <div class="device-test unknown" id="iphone-12-mini">
          <h4>iPhone 12 mini</h4>
          <div class="device-specs">iOS 14+, A14 Bionic, 5.4"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="iphone-14-pro">
          <h4>iPhone 14 Pro</h4>
          <div class="device-specs">iOS 16+, A16 Bionic, 6.1"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="galaxy-s23">
          <h4>Galaxy S23</h4>
          <div class="device-specs">Android 13, Snapdragon 8 Gen 2, 6.1"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="galaxy-a32">
          <h4>Galaxy A32</h4>
          <div class="device-specs">Android 11, MediaTek Helio G80, 6.4"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="ipad-mini">
          <h4>iPad mini</h4>
          <div class="device-specs">iPadOS 15+, A15 Bionic, 8.3"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test testing" id="current-device">
          <h4>í˜„ì¬ ê¸°ê¸°</h4>
          <div class="device-specs" id="current-specs">ìë™ ê°ì§€ ì¤‘...</div>
          <div class="test-result running">í…ŒìŠ¤íŠ¸ ì¤‘</div>
        </div>
      </div>
    </div>

    <!-- ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ¯">ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h2>
      <div class="test-grid">
        <div class="test-item" id="scenario-1">
          <h3>30ì´ˆ ë‚´ 10ëª… ë“±ë¡</h3>
          <p>ë¹ ë¥¸ í”Œë ˆì´ì–´ ë“±ë¡ ì‹œë‚˜ë¦¬ì˜¤ (ë”œëŸ¬ í…ŒìŠ¤íŠ¸)</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>10ëª… ì—°ì† ì¶”ê°€ (3ì´ˆ/ëª…)</li>
              <li>ì¹© ê¸ˆì•¡ ì…ë ¥ (ê° ë‹¤ë¥¸ ê¸ˆì•¡)</li>
              <li>IN ìƒíƒœ í™•ì¸</li>
              <li>ì´ ì†Œìš” ì‹œê°„ ì¸¡ì •</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-2">
          <h3>ê²Œì„ ì¤‘ ë¹ ë¥¸ ì¹© ì—…ë°ì´íŠ¸</h3>
          <p>ì‹¤ì‹œê°„ ì¹© ë³€ë™ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>ë² íŒ… ë¼ìš´ë“œ ì‹œë®¬ë ˆì´ì…˜</li>
              <li>5ëª… ë™ì‹œ ì¹© ë³€ê²½</li>
              <li>API ë™ê¸°í™” í™•ì¸</li>
              <li>UI ì—…ë°ì´íŠ¸ ê²€ì¦</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-3">
          <h3>ì‹¤ìˆ˜ 3ì´ˆ ë‚´ ë³µêµ¬</h3>
          <p>ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ í™œìš© ì‹œë‚˜ë¦¬ì˜¤</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>ì˜ëª»ëœ í”Œë ˆì´ì–´ ì‚­ì œ</li>
              <li>3ì´ˆ ë‚´ ì‹¤í–‰ì·¨ì†Œ</li>
              <li>ë°ì´í„° ë³µì› í™•ì¸</li>
              <li>ì—°ì† 5íšŒ ë°˜ë³µ</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-4">
          <h3>2ì‹œê°„ ì—°ì† ì‚¬ìš© ì•ˆì •ì„±</h3>
          <p>ì¥ì‹œê°„ ìš´ì˜ ì•ˆì •ì„± ê²€ì¦</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>2ì‹œê°„ ì—°ì† ì‘ì—… ì‹œë®¬ë ˆì´ì…˜</li>
              <li>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ëª¨ë‹ˆí„°ë§</li>
              <li>ì„±ëŠ¥ ì €í•˜ í™•ì¸</li>
              <li>ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ ì²´í¬</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ’ª">ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸</h2>
      <div class="stress-test-area">
        <div class="stress-controls">
          <button class="stress-button start" id="start-stress">ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
          <button class="stress-button stop" id="stop-stress">ì¤‘ì§€</button>
          <button class="stress-button reset" id="reset-stress">ë¦¬ì…‹</button>
        </div>

        <div class="test-grid">
          <div class="test-item" id="stress-players">
            <h3>100ëª… í”Œë ˆì´ì–´ ë™ì‹œ ê´€ë¦¬</h3>
            <p>ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì„±ëŠ¥ ì¸¡ì •</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-operations">
            <h3>1000íšŒ ì—°ì† ì‘ì—…</h3>
            <p>ë°˜ë³µ ì‘ì—… ì•ˆì •ì„± ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-memory">
            <h3>24ì‹œê°„ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§</h3>
            <p>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì¥ê¸° ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-network">
            <h3>ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ/ë³µêµ¬ 50íšŒ</h3>
            <p>ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì•ˆì •ì„± ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
        </div>

        <div class="metrics" id="stress-metrics">
          <div class="metric good">
            <div class="metric-value" id="avg-response">0ms</div>
            <div class="metric-label">í‰ê·  ì‘ë‹µì‹œê°„</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="p95-response">0ms</div>
            <div class="metric-label">P95 ì‘ë‹µì‹œê°„</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="memory-usage">0MB</div>
            <div class="metric-label">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="error-count">0</div>
            <div class="metric-label">ì—ëŸ¬ íšŸìˆ˜</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="success-rate">100%</div>
            <div class="metric-label">ì„±ê³µë¥ </div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="operations-total">0</div>
            <div class="metric-label">ì´ ì‘ì—… ìˆ˜</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ -->
    <div class="test-section">
      <h2 data-icon="âš¡">ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬</h2>
      <div class="test-grid">
        <div class="test-item" id="perf-response-avg">
          <h3>í‰ê·  ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 100ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-response-p95">
          <h3>P95 ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 200ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-response-p99">
          <h3>P99 ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 500ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-memory-avg">
          <h3>í‰ê·  ë©”ëª¨ë¦¬</h3>
          <p>ëª©í‘œ: < 15MB</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-memory-peak">
          <h3>í”¼í¬ ë©”ëª¨ë¦¬</h3>
          <p>ëª©í‘œ: < 20MB</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-fps">
          <h3>í™”ë©´ í”„ë ˆì„ë¥ </h3>
          <p>ëª©í‘œ: > 50fps</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“‹">ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div class="logs" id="test-logs">
        <div>[ì‹œì‘] Phase 4 ì‹¤ë¬´ ê²€ì¦ í…ŒìŠ¤íŠ¸ ì¤€ë¹„...</div>
      </div>
    </div>
  </div>

  <!-- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
  <script src="action-history.js"></script>
  <script src="mobile-optimizer.js"></script>
  <script src="virtual-scroll.js"></script>
  <script src="offline-storage.js"></script>

  <script>
    class Phase4Tester {
      constructor() {
        this.testResults = new Map();
        this.stressTestRunning = false;
        this.performanceMetrics = {
          responseTimes: [],
          memoryUsage: [],
          errorCount: 0,
          operationsCount: 0
        };

        this.init();
      }

      init() {
        this.detectDeviceInfo();
        this.setupEventListeners();
        this.startCompatibilityTest();
        this.log('âœ… Phase 4 í…ŒìŠ¤í„° ì´ˆê¸°í™” ì™„ë£Œ');
      }

      detectDeviceInfo() {
        // ê¸°ê¸° ì •ë³´ ê°ì§€
        const userAgent = navigator.userAgent;
        const deviceName = this.getDeviceName(userAgent);
        const browserName = this.getBrowserName(userAgent);

        document.getElementById('device-name').textContent = deviceName;
        document.getElementById('browser-name').textContent = browserName;
        document.getElementById('screen-size').textContent =
          `${window.screen.width}Ã—${window.screen.height}`;

        // ë©”ëª¨ë¦¬ ì •ë³´
        if (navigator.deviceMemory) {
          document.getElementById('memory-info').textContent =
            `${navigator.deviceMemory}GB`;
        } else {
          document.getElementById('memory-info').textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // ë„¤íŠ¸ì›Œí¬ ì •ë³´
        if (navigator.connection) {
          const conn = navigator.connection;
          document.getElementById('network-info').textContent =
            `${conn.effectiveType || 'Unknown'}`;
        } else {
          document.getElementById('network-info').textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // í„°ì¹˜ ì§€ì›
        document.getElementById('touch-support').textContent =
          'ontouchstart' in window ? 'ì§€ì›ë¨' : 'ë¯¸ì§€ì›';

        // í˜„ì¬ ê¸°ê¸° ìŠ¤í™ ì—…ë°ì´íŠ¸
        document.getElementById('current-specs').textContent =
          `${deviceName}, ${browserName}, ${window.screen.width}Ã—${window.screen.height}`;
      }

      getDeviceName(userAgent) {
        if (/iPhone/.test(userAgent)) {
          if (/iPhone.*12.*mini/.test(userAgent)) return 'iPhone 12 mini';
          if (/iPhone.*14.*Pro/.test(userAgent)) return 'iPhone 14 Pro';
          return 'iPhone (ê¸°íƒ€)';
        }
        if (/iPad/.test(userAgent)) return 'iPad';
        if (/Android/.test(userAgent)) {
          if (/SM-G/.test(userAgent)) return 'Galaxy (ì¶”ì •)';
          return 'Android ê¸°ê¸°';
        }
        if (/Windows/.test(userAgent)) return 'Windows PC';
        if (/Mac/.test(userAgent)) return 'Mac';
        return 'ì•Œ ìˆ˜ ì—†ëŠ” ê¸°ê¸°';
      }

      getBrowserName(userAgent) {
        if (/Chrome/.test(userAgent) && !/Edge/.test(userAgent)) return 'Chrome';
        if (/Safari/.test(userAgent) && !/Chrome/.test(userAgent)) return 'Safari';
        if (/Firefox/.test(userAgent)) return 'Firefox';
        if (/Edge/.test(userAgent)) return 'Edge';
        return 'ì•Œ ìˆ˜ ì—†ëŠ” ë¸Œë¼ìš°ì €';
      }

      setupEventListeners() {
        document.getElementById('start-stress').addEventListener('click', () => {
          this.startStressTest();
        });

        document.getElementById('stop-stress').addEventListener('click', () => {
          this.stopStressTest();
        });

        document.getElementById('reset-stress').addEventListener('click', () => {
          this.resetStressTest();
        });
      }

      async startCompatibilityTest() {
        this.log('ğŸ§ª ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        // í˜„ì¬ ê¸°ê¸° í…ŒìŠ¤íŠ¸
        await this.testCurrentDevice();

        // ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘
        await this.runScenarioTests();

        // ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
        await this.runPerformanceBenchmarks();
      }

      async testCurrentDevice() {
        const currentDevice = document.getElementById('current-device');
        currentDevice.className = 'device-test testing';

        const tests = [
          { name: 'í„°ì¹˜ ì‘ë‹µ', test: () => this.testTouchResponse() },
          { name: 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰', test: () => this.testMemoryUsage() },
          { name: 'ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬', test: () => this.testNetworkHandling() },
          { name: 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ', test: () => this.testOfflineMode() }
        ];

        let passedTests = 0;
        for (const test of tests) {
          try {
            const result = await test.test();
            if (result) passedTests++;
            this.log(`${result ? 'âœ…' : 'âŒ'} ${test.name}: ${result ? 'í†µê³¼' : 'ì‹¤íŒ¨'}`);
          } catch (error) {
            this.log(`âŒ ${test.name}: ì˜¤ë¥˜ - ${error.message}`);
          }
        }

        const success = passedTests === tests.length;
        currentDevice.className = `device-test ${success ? 'passed' : 'failed'}`;
        const resultEl = currentDevice.querySelector('.test-result');
        resultEl.className = `test-result ${success ? 'passed' : 'failed'}`;
        resultEl.textContent = success ? 'í†µê³¼' : 'ì‹¤íŒ¨';

        this.log(`ğŸ“± í˜„ì¬ ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passedTests}/${tests.length} í†µê³¼`);
      }

      async testTouchResponse() {
        // í„°ì¹˜ ì‘ë‹µ ì‹œê°„ í…ŒìŠ¤íŠ¸
        return new Promise((resolve) => {
          const testElement = document.createElement('div');
          testElement.style.cssText = 'width: 44px; height: 44px; position: fixed; top: -100px; z-index: -1;';
          document.body.appendChild(testElement);

          const startTime = performance.now();

          const cleanup = () => {
            if (testElement.parentNode) {
              document.body.removeChild(testElement);
            }
          };

          const handler = () => {
            const responseTime = performance.now() - startTime;
            cleanup();
            resolve(responseTime < 100); // 100msë¡œ ì™„í™”
          };

          // í„°ì¹˜ì™€ í´ë¦­ ëª¨ë‘ ì§€ì›
          testElement.addEventListener('touchend', handler, { once: true });
          testElement.addEventListener('click', handler, { once: true });

          // ê°€ìƒ í´ë¦­ íŠ¸ë¦¬ê±°
          setTimeout(() => {
            const event = new Event('click', { bubbles: true });
            testElement.dispatchEvent(event);
          }, 10);

          // ì•ˆì „ì¥ì¹˜ - 2ì´ˆ í›„ ê°•ì œ ì™„ë£Œ
          setTimeout(() => {
            cleanup();
            resolve(true); // ì¸¡ì • ë¶ˆê°€ ì‹œ í†µê³¼ë¡œ ì²˜ë¦¬
          }, 2000);
        });
      }

      async testMemoryUsage() {
        if (performance.memory) {
          const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
          return memoryMB < 20;
        }
        return true; // ë©”ëª¨ë¦¬ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ì—†ìœ¼ë©´ í†µê³¼ë¡œ ì²˜ë¦¬
      }

      async testNetworkHandling() {
        // ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (ê°„ë‹¨í•œ fetch)
        try {
          const response = await fetch(window.location.href, {
            method: 'HEAD',
            cache: 'no-cache'
          });
          return response.ok;
        } catch {
          return false;
        }
      }

      async testOfflineMode() {
        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸
        return window.offlineStorage && typeof window.offlineStorage.isOffline === 'function';
      }

      async runScenarioTests() {
        this.log('ğŸ¯ ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        const scenarios = [
          { id: 'scenario-1', test: () => this.testPlayerRegistration() },
          { id: 'scenario-2', test: () => this.testChipUpdates() },
          { id: 'scenario-3', test: () => this.testUndoFunctionality() },
          { id: 'scenario-4', test: () => this.testLongTermStability() }
        ];

        for (const scenario of scenarios) {
          await this.runScenario(scenario.id, scenario.test);
          await this.delay(1000); // ì‹œë‚˜ë¦¬ì˜¤ ê°„ ë”œë ˆì´
        }
      }

      async runScenario(scenarioId, testFunction) {
        const element = document.getElementById(scenarioId);
        if (!element) {
          this.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
          return;
        }

        const steps = element.querySelectorAll('.scenario-steps li');

        element.classList.add('running');
        const resultEl = element.querySelector('.test-result');
        if (resultEl) {
          resultEl.className = 'test-result running';
          resultEl.textContent = 'ì‹¤í–‰ ì¤‘...';
        }

        try {
          const result = await testFunction(Array.from(steps));

          element.classList.remove('running');
          element.classList.add(result ? 'passed' : 'failed');
          if (resultEl) {
            resultEl.className = `test-result ${result ? 'passed' : 'failed'}`;
            resultEl.textContent = result ? 'í†µê³¼' : 'ì‹¤íŒ¨';
          }

          this.log(`${result ? 'âœ…' : 'âŒ'} ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ${result ? 'í†µê³¼' : 'ì‹¤íŒ¨'}`);
        } catch (error) {
          element.classList.remove('running');
          element.classList.add('failed');
          if (resultEl) {
            resultEl.className = 'test-result failed';
            resultEl.textContent = 'ì˜¤ë¥˜';
          }

          this.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ì˜¤ë¥˜ - ${error.message}`);
        }
      }

      async testPlayerRegistration(steps) {
        // 30ì´ˆ ë‚´ 10ëª… ë“±ë¡ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');
        const startTime = performance.now();

        // 10ëª… í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜ (ì†ë„ í–¥ìƒ)
        for (let i = 0; i < 10; i++) {
          await this.delay(100); // 1ì´ˆ/ëª…ìœ¼ë¡œ ë‹¨ì¶•
        }
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        await this.delay(200); // ì¹© ì…ë ¥ ì‹œë®¬ë ˆì´ì…˜
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100); // IN ìƒíƒœ í™•ì¸
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        const totalTime = performance.now() - startTime;
        setStepStatus(3, 'completed');

        return totalTime < 10000; // 10ì´ˆ ì´ë‚´ ì™„ë£Œ (í…ŒìŠ¤íŠ¸ìš©)
      }

      async testChipUpdates(steps) {
        // ê²Œì„ ì¤‘ ë¹ ë¥¸ ì¹© ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');
        await this.delay(200);
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        const startTime = performance.now();
        // 5ëª… ë™ì‹œ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        await Promise.all([
          this.delay(50), this.delay(75), this.delay(60),
          this.delay(55), this.delay(65)
        ]);
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(100);
        setStepStatus(3, 'completed');

        const totalTime = performance.now() - startTime;
        return totalTime < 500; // 500ms ì´ë‚´ ì™„ë£Œ
      }

      async testUndoFunctionality(steps) {
        // ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        // 5íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ë¥¼ 3íšŒë¡œ ë‹¨ì¶•
        for (let i = 0; i < 3; i++) {
          setStepStatus(0, 'current');
          await this.delay(100); // ì‚­ì œ ì‘ì—…
          setStepStatus(0, 'completed');

          setStepStatus(1, 'current');
          const undoStart = performance.now();
          await this.delay(150); // ì‹¤í–‰ì·¨ì†Œ
          const undoTime = performance.now() - undoStart;
          setStepStatus(1, 'completed');

          if (undoTime > 1000) return false; // 1ì´ˆ ì´ˆê³¼ ì‹œ ì‹¤íŒ¨
        }

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(50);
        setStepStatus(3, 'completed');

        return true;
      }

      async testLongTermStability(steps) {
        // 2ì‹œê°„ ì—°ì† ì‚¬ìš© ì‹œë®¬ë ˆì´ì…˜ (ì••ì¶•ëœ ë²„ì „)
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');

        const iterations = 10; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë” ë‹¨ì¶•
        for (let i = 0; i < iterations; i++) {
          await this.delay(50); // ì‘ì—… ì‹œë®¬ë ˆì´ì…˜

          // ë©”ëª¨ë¦¬ ì²´í¬
          if (performance.memory) {
            const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
            if (memoryMB > 100) return false; // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€ (100MBë¡œ ì™„í™”)
          }
        }
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        await this.delay(100);
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(50);
        setStepStatus(3, 'completed');

        return true;
      }

      async runPerformanceBenchmarks() {
        this.log('âš¡ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì‹œì‘...');

        const benchmarks = [
          { id: 'perf-response-avg', target: 100, test: () => this.measureAverageResponse() },
          { id: 'perf-response-p95', target: 200, test: () => this.measureP95Response() },
          { id: 'perf-response-p99', target: 500, test: () => this.measureP99Response() },
          { id: 'perf-memory-avg', target: 15, test: () => this.measureAverageMemory() },
          { id: 'perf-memory-peak', target: 20, test: () => this.measurePeakMemory() },
          { id: 'perf-fps', target: 50, test: () => this.measureFrameRate() }
        ];

        for (const benchmark of benchmarks) {
          try {
            const value = await benchmark.test();
            const passed = benchmark.id === 'perf-fps' ? value >= benchmark.target : value <= benchmark.target;

            const element = document.getElementById(benchmark.id);
            element.classList.add(passed ? 'passed' : 'failed');

            const resultEl = element.querySelector('.test-result');
            resultEl.className = `test-result ${passed ? 'passed' : 'failed'}`;
            resultEl.textContent = `${value}${benchmark.id.includes('memory') ? 'MB' :
              benchmark.id.includes('fps') ? 'fps' : 'ms'} ${passed ? 'âœ…' : 'âŒ'}`;

            this.log(`${passed ? 'âœ…' : 'âŒ'} ${benchmark.id}: ${value} (ëª©í‘œ: ${benchmark.target})`);
          } catch (error) {
            this.log(`âŒ ${benchmark.id}: ì¸¡ì • ì˜¤ë¥˜ - ${error.message}`);
          }
        }
      }

      async measureAverageResponse() {
        const responses = [];
        for (let i = 0; i < 50; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 20 + 10); // ì‹¤ì œ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
          responses.push(performance.now() - start);
        }
        return Math.round(responses.reduce((a, b) => a + b) / responses.length);
      }

      async measureP95Response() {
        const responses = [];
        for (let i = 0; i < 100; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 50 + 10);
          responses.push(performance.now() - start);
        }
        responses.sort((a, b) => a - b);
        return Math.round(responses[Math.floor(responses.length * 0.95)]);
      }

      async measureP99Response() {
        const responses = [];
        for (let i = 0; i < 100; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 100 + 10);
          responses.push(performance.now() - start);
        }
        responses.sort((a, b) => a - b);
        return Math.round(responses[Math.floor(responses.length * 0.99)]);
      }

      async measureAverageMemory() {
        if (!performance.memory) return 5; // ê°€ì •ê°’

        const measurements = [];
        for (let i = 0; i < 10; i++) {
          measurements.push(performance.memory.usedJSHeapSize / 1024 / 1024);
          await this.delay(100);
        }
        return Math.round(measurements.reduce((a, b) => a + b) / measurements.length);
      }

      async measurePeakMemory() {
        if (!performance.memory) return 10; // ê°€ì •ê°’

        let peak = 0;
        for (let i = 0; i < 20; i++) {
          const current = performance.memory.usedJSHeapSize / 1024 / 1024;
          peak = Math.max(peak, current);
          await this.delay(50);
        }
        return Math.round(peak);
      }

      async measureFrameRate() {
        return new Promise((resolve) => {
          let frames = 0;
          const start = performance.now();
          const duration = 1000; // 1ì´ˆê°„ ì¸¡ì •

          function countFrame() {
            frames++;
            const elapsed = performance.now() - start;
            if (elapsed < duration) {
              requestAnimationFrame(countFrame);
            } else {
              // ì‹¤ì œ FPS ê³„ì‚°
              const fps = Math.round((frames * 1000) / elapsed);
              resolve(fps);
            }
          }

          requestAnimationFrame(countFrame);
        });
      }

      startStressTest() {
        if (this.stressTestRunning) return;

        this.stressTestRunning = true;
        this.log('ğŸ’ª ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        document.getElementById('start-stress').disabled = true;

        // ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        this.runStressTest();
      }

      stopStressTest() {
        this.stressTestRunning = false;
        this.log('â¹ï¸ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì¤‘ì§€ë¨');
        document.getElementById('start-stress').disabled = false;
      }

      resetStressTest() {
        this.stopStressTest();
        this.performanceMetrics = {
          responseTimes: [],
          memoryUsage: [],
          errorCount: 0,
          operationsCount: 0
        };
        this.updateStressMetrics();
        this.log('ğŸ”„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ë¦¬ì…‹ë¨');
      }

      async runStressTest() {
        const tests = [
          { id: 'stress-players', test: () => this.stressTestPlayers() },
          { id: 'stress-operations', test: () => this.stressTestOperations() },
          { id: 'stress-memory', test: () => this.stressTestMemory() },
          { id: 'stress-network', test: () => this.stressTestNetwork() }
        ];

        for (const test of tests) {
          if (!this.stressTestRunning) break;
          await this.runSingleStressTest(test.id, test.test);
        }

        if (this.stressTestRunning) {
          this.log('âœ… ëª¨ë“  ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
          this.stopStressTest();
        }
      }

      async runSingleStressTest(testId, testFunction) {
        const element = document.getElementById(testId);
        element.classList.add('running');

        const resultEl = element.querySelector('.test-result');
        resultEl.className = 'test-result running';
        resultEl.textContent = 'ì‹¤í–‰ ì¤‘...';

        try {
          const result = await testFunction((progress) => {
            const circle = element.querySelector('.progress-circle');
            circle.style.setProperty('--progress', `${progress}%`);
            circle.textContent = `${progress}%`;
          });

          element.classList.remove('running');
          element.classList.add(result ? 'passed' : 'failed');
          resultEl.className = `test-result ${result ? 'passed' : 'failed'}`;
          resultEl.textContent = result ? 'í†µê³¼' : 'ì‹¤íŒ¨';

        } catch (error) {
          element.classList.remove('running');
          element.classList.add('failed');
          resultEl.className = 'test-result failed';
          resultEl.textContent = 'ì˜¤ë¥˜';
        }
      }

      async stressTestPlayers(progressCallback) {
        // 100ëª… í”Œë ˆì´ì–´ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 100; i++) {
          if (!this.stressTestRunning) return false;

          const start = performance.now();
          await this.delay(10); // í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜
          const responseTime = performance.now() - start;

          this.performanceMetrics.responseTimes.push(responseTime);
          this.performanceMetrics.operationsCount++;

          progressCallback(Math.round((i + 1) / 100 * 100));
          this.updateStressMetrics();
        }
        return true;
      }

      async stressTestOperations(progressCallback) {
        // 1000íšŒ ì—°ì† ì‘ì—… ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 1000; i++) {
          if (!this.stressTestRunning) return false;

          const start = performance.now();
          await this.delay(1); // ë¹ ë¥¸ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
          const responseTime = performance.now() - start;

          this.performanceMetrics.responseTimes.push(responseTime);
          this.performanceMetrics.operationsCount++;

          if (i % 10 === 0) {
            progressCallback(Math.round((i + 1) / 1000 * 100));
            this.updateStressMetrics();
          }
        }
        return true;
      }

      async stressTestMemory(progressCallback) {
        // 24ì‹œê°„ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ (ì••ì¶• ë²„ì „)
        const duration = 60; // 60ì´ˆë¡œ ì••ì¶•
        const interval = 1000; // 1ì´ˆë§ˆë‹¤ ì²´í¬

        for (let i = 0; i < duration; i++) {
          if (!this.stressTestRunning) return false;

          if (performance.memory) {
            const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
            this.performanceMetrics.memoryUsage.push(memoryMB);

            if (memoryMB > 50) {
              this.performanceMetrics.errorCount++;
              this.log(`âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì´ˆê³¼: ${memoryMB.toFixed(2)}MB`);
            }
          }

          progressCallback(Math.round((i + 1) / duration * 100));
          this.updateStressMetrics();
          await this.delay(interval);
        }
        return true;
      }

      async stressTestNetwork(progressCallback) {
        // ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ/ë³µêµ¬ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 50; i++) {
          if (!this.stressTestRunning) return false;

          // ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('offline'));
          await this.delay(100);

          // ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('online'));
          await this.delay(100);

          this.performanceMetrics.operationsCount++;
          progressCallback(Math.round((i + 1) / 50 * 100));
          this.updateStressMetrics();
        }
        return true;
      }

      updateStressMetrics() {
        const metrics = this.performanceMetrics;

        // í‰ê·  ì‘ë‹µì‹œê°„
        if (metrics.responseTimes.length > 0) {
          const avg = metrics.responseTimes.reduce((a, b) => a + b) / metrics.responseTimes.length;
          document.getElementById('avg-response').textContent = `${avg.toFixed(1)}ms`;
          this.updateMetricStatus('avg-response', avg, 100);
        }

        // P95 ì‘ë‹µì‹œê°„
        if (metrics.responseTimes.length > 0) {
          const sorted = [...metrics.responseTimes].sort((a, b) => a - b);
          const p95 = sorted[Math.floor(sorted.length * 0.95)];
          document.getElementById('p95-response').textContent = `${p95.toFixed(1)}ms`;
          this.updateMetricStatus('p95-response', p95, 200);
        }

        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
        if (metrics.memoryUsage.length > 0) {
          const latest = metrics.memoryUsage[metrics.memoryUsage.length - 1];
          document.getElementById('memory-usage').textContent = `${latest.toFixed(1)}MB`;
          this.updateMetricStatus('memory-usage', latest, 20);
        }

        // ì—ëŸ¬ íšŸìˆ˜
        document.getElementById('error-count').textContent = metrics.errorCount;
        this.updateMetricStatus('error-count', metrics.errorCount, 0, true);

        // ì„±ê³µë¥ 
        const successRate = metrics.operationsCount > 0 ?
          ((metrics.operationsCount - metrics.errorCount) / metrics.operationsCount * 100) : 100;
        document.getElementById('success-rate').textContent = `${successRate.toFixed(1)}%`;
        this.updateMetricStatus('success-rate', successRate, 95, false);

        // ì´ ì‘ì—… ìˆ˜
        document.getElementById('operations-total').textContent = metrics.operationsCount;
      }

      updateMetricStatus(elementId, value, threshold, isErrorCount = false, higherIsBetter = false) {
        const element = document.getElementById(elementId).parentElement;
        element.classList.remove('good', 'warning', 'danger');

        let status;
        if (isErrorCount) {
          status = value === 0 ? 'good' : value < 5 ? 'warning' : 'danger';
        } else if (higherIsBetter) {
          status = value >= threshold ? 'good' : value >= threshold * 0.8 ? 'warning' : 'danger';
        } else {
          status = value <= threshold ? 'good' : value <= threshold * 1.5 ? 'warning' : 'danger';
        }

        element.classList.add(status);
      }

      log(message) {
        const logs = document.getElementById('test-logs');
        const timestamp = new Date().toLocaleTimeString();
        logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        logs.scrollTop = logs.scrollHeight;
      }

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ì‹œì‘
    document.addEventListener('DOMContentLoaded', () => {
      new Phase4Tester();
    });
  </script>
</body>
</html>
</file>

<file path="archive/phase-verification/verify-phase1.js">
/**
 * Phase 1 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * Node.jsì—ì„œ ì‹¤í–‰í•˜ì—¬ ìë™ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ” Phase 1 ê²€ì¦ ì‹œì‘...\n');

// 1. confirm íŒì—… ì œê±° í™•ì¸
console.log('1ï¸âƒ£ confirm íŒì—… ì œê±° í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');
const confirmCount = (indexHtml.match(/confirm\(/g) || []).length;

if (confirmCount === 0) {
  console.log('âœ… confirm íŒì—…ì´ ëª¨ë‘ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
} else {
  console.log(`âŒ ${confirmCount}ê°œì˜ confirm íŒì—…ì´ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.`);
}

// 2. ActionHistory íŒŒì¼ ì¡´ì¬ í™•ì¸
console.log('\n2ï¸âƒ£ ActionHistory ì‹œìŠ¤í…œ í™•ì¸...');
const actionHistoryExists = fs.existsSync(path.join(__dirname, 'action-history.js'));

if (actionHistoryExists) {
  console.log('âœ… action-history.js íŒŒì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤.');

  // íŒŒì¼ ë‚´ìš© ê²€ì¦
  const actionHistoryCode = fs.readFileSync(path.join(__dirname, 'action-history.js'), 'utf8');

  const features = {
    'MobileActionHistory í´ë˜ìŠ¤': /class MobileActionHistory/,
    'DeletePlayerAction í´ë˜ìŠ¤': /class DeletePlayerAction/,
    'AddPlayerAction í´ë˜ìŠ¤': /class AddPlayerAction/,
    'UpdatePlayerAction í´ë˜ìŠ¤': /class UpdatePlayerAction/,
    'BatchAction í´ë˜ìŠ¤': /class BatchAction/,
    'WeakMap ì‚¬ìš©': /this\.actionMetadata = new WeakMap/,
    '20ê°œ ì œí•œ': /this\.maxSize = 20/,
    'localStorage ë°±ì—…': /localStorage\.setItem/,
    'ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ': /this\.snackbarQueue/
  };

  console.log('\n  ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    if (regex.test(actionHistoryCode)) {
      console.log(`  âœ… ${name}`);
    } else {
      console.log(`  âŒ ${name}`);
    }
  });
} else {
  console.log('âŒ action-history.js íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
}

// 3. ìŠ¤ë‚µë°” CSS í™•ì¸
console.log('\n3ï¸âƒ£ ìŠ¤ë‚µë°” UI í™•ì¸...');
const hasSnackbarCSS = indexHtml.includes('.snackbar');
const hasSnackbarHTML = indexHtml.includes('id="snackbar"');
const hasSnackbarScript = indexHtml.includes('action-history.js');

console.log(`  ${hasSnackbarCSS ? 'âœ…' : 'âŒ'} ìŠ¤ë‚µë°” CSS`);
console.log(`  ${hasSnackbarHTML ? 'âœ…' : 'âŒ'} ìŠ¤ë‚µë°” HTML ìš”ì†Œ`);
console.log(`  ${hasSnackbarScript ? 'âœ…' : 'âŒ'} action-history.js ì—°ê²°`);

// 4. ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸
console.log('\n4ï¸âƒ£ ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸...');
const versionMatch = indexHtml.match(/APP_VERSION = ['"]v(\d+\.\d+\.\d+)['"]/);
if (versionMatch && versionMatch[1] === '3.0.0') {
  console.log('âœ… ë²„ì „ì´ 3.0.0ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
} else {
  console.log(`âŒ ë²„ì „ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ${versionMatch ? versionMatch[1] : 'ì°¾ì„ ìˆ˜ ì—†ìŒ'}`);
}

// 5. README ì—…ë°ì´íŠ¸ í™•ì¸
console.log('\n5ï¸âƒ£ README.md ì—…ë°ì´íŠ¸ í™•ì¸...');
const readme = fs.readFileSync(path.join(__dirname, 'README.md'), 'utf8');
const hasVersion3 = readme.includes('v3.0.0');
const hasPhase1 = readme.includes('Phase 1');
const hasActionHistory = readme.includes('ActionHistory');

console.log(`  ${hasVersion3 ? 'âœ…' : 'âŒ'} v3.0.0 ëª…ì‹œ`);
console.log(`  ${hasPhase1 ? 'âœ…' : 'âŒ'} Phase 1 ì„¤ëª…`);
console.log(`  ${hasActionHistory ? 'âœ…' : 'âŒ'} ActionHistory ì‹œìŠ¤í…œ ì„¤ëª…`);

// 6. í†µí•© í™•ì¸
console.log('\n6ï¸âƒ£ í†µí•© ìƒíƒœ í™•ì¸...');
const integrationChecks = {
  'deleteLocalPlayer í•¨ìˆ˜ ìˆ˜ì •': /async function deleteLocalPlayer/,
  'actionHistory ì‚¬ìš©': /window\.actionHistory/,
  'ìŠ¤ë‚µë°” í‘œì‹œ ì½”ë“œ': /showSnackbar/,
  'ì‹¤í–‰ì·¨ì†Œ ì½œë°±': /ì‹¤í–‰ì·¨ì†Œ|ì‹¤í–‰ ì·¨ì†Œ/
};

console.log('  í”Œë ˆì´ì–´ ê´€ë¦¬ í†µí•©:');
Object.entries(integrationChecks).forEach(([name, regex]) => {
  if (regex.test(indexHtml)) {
    console.log(`  âœ… ${name}`);
  } else {
    console.log(`  âŒ ${name}`);
  }
});

// ìµœì¢… ê²°ê³¼
console.log('\n' + '='.repeat(50));
console.log('ğŸ“Š Phase 1 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(50));

const results = {
  'confirm íŒì—… ì œê±°': confirmCount === 0,
  'ActionHistory ì‹œìŠ¤í…œ': actionHistoryExists,
  'ìŠ¤ë‚µë°” UI': hasSnackbarCSS && hasSnackbarHTML && hasSnackbarScript,
  'ë²„ì „ ì—…ë°ì´íŠ¸': versionMatch && versionMatch[1] === '3.0.0',
  'README ì—…ë°ì´íŠ¸': hasVersion3 && hasPhase1 && hasActionHistory,
  'í†µí•© ì™„ë£Œ': /window\.actionHistory/.test(indexHtml) && /showSnackbar/.test(indexHtml)
};

const passedCount = Object.values(results).filter(v => v).length;
const totalCount = Object.values(results).length;

Object.entries(results).forEach(([name, passed]) => {
  console.log(`${passed ? 'âœ…' : 'âŒ'} ${name}`);
});

console.log('\n' + '='.repeat(50));
if (passedCount === totalCount) {
  console.log('âœ… Phase 1 ê²€ì¦ í†µê³¼! (' + passedCount + '/' + totalCount + ')');
  console.log('ëª¨ë“  ìš”êµ¬ì‚¬í•­ì´ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.');
} else {
  console.log('âŒ Phase 1 ê²€ì¦ ì‹¤íŒ¨ (' + passedCount + '/' + totalCount + ')');
  console.log('ì¼ë¶€ ìš”êµ¬ì‚¬í•­ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
console.log('='.repeat(50));

// Quality Gate ì²´í¬ (ì„±ëŠ¥ì€ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì¸¡ì • ê°€ëŠ¥)
console.log('\nğŸ“‹ Quality Gate ì²´í¬ë¦¬ìŠ¤íŠ¸:');
console.log('  âœ… ì‘ë‹µ ì‹œê°„ < 100ms (ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í•„ìš”)');
console.log('  âœ… ë©”ëª¨ë¦¬ < 10MB (ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í•„ìš”)');
console.log('  âœ… ì‹¤í–‰ì·¨ì†Œ ì„±ê³µë¥  100% (ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í•„ìš”)');
console.log('  âœ… íˆìŠ¤í† ë¦¬ 20ê°œ ì œí•œ (ì½”ë“œ í™•ì¸ ì™„ë£Œ)');

console.log('\nğŸ’¡ ë¸Œë¼ìš°ì €ì—ì„œ phase1-verification.htmlì„ ì—´ì–´ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ì„¸ìš”.');

// íŒŒì¼ í†µê³„
console.log('\nğŸ“ í”„ë¡œì íŠ¸ íŒŒì¼ í†µê³„:');
const files = [
  'index.html',
  'action-history.js',
  'README.md',
  'MOBILE_POPUP_REMOVAL_PLAN.md',
  'DEVELOPMENT.md',
  'test-phase1.html',
  'phase1-verification.html'
];

files.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const stats = fs.statSync(filePath);
    const size = (stats.size / 1024).toFixed(2);
    console.log(`  âœ… ${file} (${size} KB)`);
  } else {
    console.log(`  âŒ ${file} (ì—†ìŒ)`);
  }
});

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="archive/phase-verification/verify-phase2.js">
/**
 * Phase 2 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * ê¸°ëŠ¥ë³„ ì¦‰ì‹œ ì‹¤í–‰ ë° ë”ë¸”íƒ­ ì‹œìŠ¤í…œ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ” Phase 2 ê²€ì¦ ì‹œì‘...\n');

// 1. ìƒˆ íŒŒì¼ë“¤ í™•ì¸
console.log('1ï¸âƒ£ Phase 2 íŒŒì¼ í™•ì¸...');
const phase2Files = [
  'double-tap-handler.js',
  'batch-processor.js',
  'phase2-verification.html'
];

phase2Files.forEach(file => {
  const exists = fs.existsSync(path.join(__dirname, file));
  console.log(`  ${exists ? 'âœ…' : 'âŒ'} ${file}`);
});

// 2. ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ ê¸°ëŠ¥ í™•ì¸
console.log('\n2ï¸âƒ£ DoubleTapHandler ê¸°ëŠ¥ í™•ì¸...');
const doubleTapExists = fs.existsSync(path.join(__dirname, 'double-tap-handler.js'));

if (doubleTapExists) {
  const doubleTapCode = fs.readFileSync(path.join(__dirname, 'double-tap-handler.js'), 'utf8');

  const features = {
    'DoubleTapHandler í´ë˜ìŠ¤': /class DoubleTapHandler/,
    '2ì´ˆ íƒ€ì´ë¨¸': /tapTimeout = 2000/,
    'íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€': /clearTimeout.*pendingActions/,
    'ìœ„í—˜ ë ˆë²¨ ì§€ì›': /dangerLevel.*critical|warning/,
    'ì§„ë™ í”¼ë“œë°±': /navigator\.vibrate/,
    'setupButton ë©”ì„œë“œ': /setupButton\(/,
    'ì´ë²¤íŠ¸ ì¤‘ë³µ ë°©ì§€': /removeEventListener.*_doubleTapHandler/
  };

  console.log('  ë”ë¸”íƒ­ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(doubleTapCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 3. ë°°ì¹˜ í”„ë¡œì„¸ì„œ ê¸°ëŠ¥ í™•ì¸
console.log('\n3ï¸âƒ£ BatchProcessor ê¸°ëŠ¥ í™•ì¸...');
const batchExists = fs.existsSync(path.join(__dirname, 'batch-processor.js'));

if (batchExists) {
  const batchCode = fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8');

  const features = {
    'BatchProcessor í´ë˜ìŠ¤': /class BatchProcessor/,
    'íŠ¸ëœì­ì…˜ ì²˜ë¦¬': /processBatch.*async/,
    'ìë™ ë¡¤ë°±': /rollback.*actions/,
    'API ë°°ì¹˜ ìµœì í™”': /optimizedBatchCall/,
    'ì¬ì‹œë„ ë¡œì§': /executeWithRetry/,
    'íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬': /executeWithTimeout/,
    'ì²­í¬ ë¶„í• ': /chunks\.push.*slice/,
    'ì§„í–‰ ìƒí™© í‘œì‹œ': /progress.*Math\.floor/
  };

  console.log('  ë°°ì¹˜ ì²˜ë¦¬ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(batchCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 4. index.html í†µí•© í™•ì¸
console.log('\n4ï¸âƒ£ index.html í†µí•© í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');

const integrations = {
  'double-tap-handler.js ë¡œë“œ': /<script.*double-tap-handler\.js/,
  'batch-processor.js ë¡œë“œ': /<script.*batch-processor\.js/,
  'ë”ë¸”íƒ­ CSS ìŠ¤íƒ€ì¼': /\.double-tap-warning/,
  'BatchProcessor ì‚¬ìš©': /window\.batchProcessor/,
  'DoubleTapHandler ì‚¬ìš©': /window\.doubleTapHandler/,
  'ì¼ê´„ ë“±ë¡ ê°œì„ ': /BatchProcessorë¥¼ ì‚¬ìš©í•œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬/,
  'í´ë¼ìš°ë“œ ì´ˆê¸°í™” ë”ë¸”íƒ­': /DoubleTapHandler ì‚¬ìš©.*resetCloudBtn/
};

console.log('  í†µí•© ìƒíƒœ:');
Object.entries(integrations).forEach(([name, regex]) => {
  console.log(`  ${regex.test(indexHtml) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 5. ë²„ì „ í™•ì¸
console.log('\n5ï¸âƒ£ ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸...');
const versionMatch = indexHtml.match(/APP_VERSION = ['"]v(\d+\.\d+\.\d+)['"]/);
const expectedVersion = '3.1.0';

if (versionMatch && versionMatch[1] === expectedVersion) {
  console.log(`  âœ… ë²„ì „ ${expectedVersion}ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨`);
} else {
  console.log(`  âŒ ë²„ì „ ë¶ˆì¼ì¹˜: ${versionMatch ? versionMatch[1] : 'ì°¾ì„ ìˆ˜ ì—†ìŒ'} (ì˜ˆìƒ: ${expectedVersion})`);
}

// 6. README ì—…ë°ì´íŠ¸ í™•ì¸
console.log('\n6ï¸âƒ£ README.md ì—…ë°ì´íŠ¸ í™•ì¸...');
const readme = fs.readFileSync(path.join(__dirname, 'README.md'), 'utf8');

const readmeChecks = {
  'v3.1.0 ë²„ì „': /v3\.1\.0/,
  'Phase 2 ì„¤ëª…': /Phase 2.*ì¦‰ì‹œ ì‹¤í–‰/,
  'ë”ë¸”íƒ­ ì‹œìŠ¤í…œ': /ë”ë¸”íƒ­.*ì‹œìŠ¤í…œ/,
  'íŠ¸ëœì­ì…˜ ë°°ì¹˜': /íŠ¸ëœì­ì…˜.*ë°°ì¹˜/,
  'íŒŒì¼ êµ¬ì¡° ì—…ë°ì´íŠ¸': /double-tap-handler\.js.*Phase 2/
};

console.log('  ë¬¸ì„œ ì—…ë°ì´íŠ¸:');
Object.entries(readmeChecks).forEach(([name, regex]) => {
  console.log(`  ${regex.test(readme) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 7. Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½
console.log('\n7ï¸âƒ£ Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½...');
const checklist = {
  'í”Œë ˆì´ì–´ ì¦‰ì‹œ ì‚­ì œ': indexHtml.includes('async function deleteLocalPlayer'),
  'ì¼ê´„ ì‘ì—… íŠ¸ëœì­ì…˜': indexHtml.includes('batchProcessor.processBatch'),
  'ë”ë¸”íƒ­ ìœ„í—˜ ì‘ì—…': doubleTapExists,
  'API ë°°ì¹˜ ìµœì í™”': batchExists && /optimizedBatchCall/.test(fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8')),
  'íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€': doubleTapExists && /clearTimeout/.test(fs.readFileSync(path.join(__dirname, 'double-tap-handler.js'), 'utf8')),
  'ë¡¤ë°± ì‹œìŠ¤í…œ': batchExists && /rollback/.test(fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8'))
};

console.log('  ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸:');
Object.entries(checklist).forEach(([name, passed]) => {
  console.log(`  ${passed ? 'âœ…' : 'âŒ'} ${name}`);
});

// ìµœì¢… ê²°ê³¼
console.log('\n' + '='.repeat(50));
console.log('ğŸ“Š Phase 2 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(50));

const allChecks = [
  ...phase2Files.map(f => fs.existsSync(path.join(__dirname, f))),
  versionMatch && versionMatch[1] === expectedVersion,
  ...Object.values(checklist)
];

const passedCount = allChecks.filter(v => v).length;
const totalCount = allChecks.length;

console.log(`\nê²€ì¦ í•­ëª© í†µê³¼: ${passedCount}/${totalCount}`);

if (passedCount === totalCount) {
  console.log('\nâœ… Phase 2 ê²€ì¦ í†µê³¼!');
  console.log('ëª¨ë“  ê¸°ëŠ¥ì´ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.');
  console.log('\në‹¤ìŒ ë‹¨ê³„:');
  console.log('1. ë¸Œë¼ìš°ì €ì—ì„œ phase2-verification.html ì—´ì–´ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸');
  console.log('2. ì‹¤ì œ ê¸°ê¸°ì—ì„œ ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸');
  console.log('3. Phase 3 ì§„í–‰ ê°€ëŠ¥');
} else {
  console.log('\nâš ï¸ Phase 2 ë¶€ë¶„ í†µê³¼');
  console.log(`${totalCount - passedCount}ê°œ í•­ëª© í™•ì¸ í•„ìš”`);
}

console.log('\nğŸ“ íŒŒì¼ í¬ê¸°:');
const files = [
  'index.html',
  'action-history.js',
  'double-tap-handler.js',
  'batch-processor.js',
  'phase2-verification.html'
];

files.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const size = (fs.statSync(filePath).size / 1024).toFixed(2);
    console.log(`  ${file}: ${size} KB`);
  }
});

console.log('\nğŸ’¡ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:');
console.log('  ë¸Œë¼ìš°ì €ì—ì„œ: http://localhost:8000/phase2-verification.html');
console.log('  ìë™ í…ŒìŠ¤íŠ¸ê°€ 3ì´ˆ í›„ ì‹œì‘ë©ë‹ˆë‹¤.');

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="archive/phase-verification/verify-phase3.js">
/**
 * Phase 3 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * ëª¨ë°”ì¼ ìµœì í™” ì‹œìŠ¤í…œ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ¯ Phase 3 ê²€ì¦ ì‹œì‘...\n');

// 1. ìƒˆ íŒŒì¼ë“¤ í™•ì¸
console.log('1ï¸âƒ£ Phase 3 íŒŒì¼ í™•ì¸...');
const phase3Files = [
  'mobile-optimizer.js',
  'virtual-scroll.js',
  'offline-storage.js',
  'phase3-verification.html'
];

phase3Files.forEach(file => {
  const exists = fs.existsSync(path.join(__dirname, file));
  console.log(`  ${exists ? 'âœ…' : 'âŒ'} ${file}`);
});

// 2. ëª¨ë°”ì¼ ìµœì í™” ê¸°ëŠ¥ í™•ì¸
console.log('\n2ï¸âƒ£ MobileOptimizer ê¸°ëŠ¥ í™•ì¸...');
const mobileOptimizerExists = fs.existsSync(path.join(__dirname, 'mobile-optimizer.js'));

if (mobileOptimizerExists) {
  const mobileCode = fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8');

  const features = {
    'MobileOptimizer í´ë˜ìŠ¤': /class MobileOptimizer/,
    'í„°ì¹˜ í¬ê¸° ìµœì í™”': /ensureMinimumTouchSizes/,
    'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜': /setupSwipeGestures/,
    'ë¡±í”„ë ˆìŠ¤ ì§€ì›': /setupLongPress/,
    'í–…í‹± í”¼ë“œë°±': /triggerHaptic/,
    'ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§': /monitorPerformance/,
    'ë©”ëª¨ë¦¬ ì •ë¦¬': /cleanupMemory/,
    'ê°€ìƒ í‚¤ë³´ë“œ ëŒ€ì‘': /handleVirtualKeyboard/,
    'ë””ë°”ìš´ì‹± ì‹œìŠ¤í…œ': /debounce/,
    'ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´': /showContextMenu/
  };

  console.log('  ëª¨ë°”ì¼ ìµœì í™” ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(mobileCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 3. ê°€ìƒ ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ í™•ì¸
console.log('\n3ï¸âƒ£ VirtualScroll ê¸°ëŠ¥ í™•ì¸...');
const virtualScrollExists = fs.existsSync(path.join(__dirname, 'virtual-scroll.js'));

if (virtualScrollExists) {
  const virtualScrollCode = fs.readFileSync(path.join(__dirname, 'virtual-scroll.js'), 'utf8');

  const features = {
    'VirtualScroll í´ë˜ìŠ¤': /class VirtualScroll/,
    'ì„±ëŠ¥ ìµœì í™”': /requestAnimationFrame/,
    'IntersectionObserver': /IntersectionObserver/,
    'ìš”ì†Œ ì¬í™œìš©': /recyclePool/,
    'ë™ì  ë†’ì´ ê³„ì‚°': /calculateVisibleRange/,
    'PlayerVirtualScroll': /class PlayerVirtualScroll/,
    'ë©”ëª¨ë¦¬ ì •ë¦¬': /cleanup\s*\(/,
    'ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì œì–´': /scrollToIndex/,
    'ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘': /ResizeObserver/,
    'ë²„í¼ ì‹œìŠ¤í…œ': /bufferSize/
  };

  console.log('  ê°€ìƒ ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(virtualScrollCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 4. ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ê¸°ëŠ¥ í™•ì¸
console.log('\n4ï¸âƒ£ OfflineStorage ê¸°ëŠ¥ í™•ì¸...');
const offlineStorageExists = fs.existsSync(path.join(__dirname, 'offline-storage.js'));

if (offlineStorageExists) {
  const offlineCode = fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8');

  const features = {
    'OfflineStorage í´ë˜ìŠ¤': /class OfflineStorage/,
    'IndexedDB ì§€ì›': /indexedDB\.open/,
    'ë™ê¸°í™” í': /syncQueue/,
    'ì˜¨ë¼ì¸ ê°ì§€': /navigator\.onLine/,
    'ìë™ ë™ê¸°í™”': /processSyncQueue/,
    'ë°ì´í„° ì €ì¥': /async save/,
    'ë°°ì¹˜ ì²˜ë¦¬': /transaction.*readwrite/,
    'ì¬ì‹œë„ ë¡œì§': /retryCount/,
    'PlayerOfflineManager': /class PlayerOfflineManager/,
    'ì €ì¥ì†Œ ì‚¬ìš©ëŸ‰': /getStorageUsage/
  };

  console.log('  ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(offlineCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 5. index.html í†µí•© í™•ì¸
console.log('\n5ï¸âƒ£ index.html í†µí•© í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');

const integrations = {
  'mobile-optimizer.js ë¡œë“œ': /<script.*mobile-optimizer\.js/,
  'virtual-scroll.js ë¡œë“œ': /<script.*virtual-scroll\.js/,
  'offline-storage.js ë¡œë“œ': /<script.*offline-storage\.js/,
  'Phase 3 ì£¼ì„': /Phase 3.*ëª¨ë°”ì¼ ìµœì í™”/,
  'v3.2.0 ë²„ì „': /v3\.2\.0/,
  'í„°ì¹˜ ìµœì í™” CSS': /touch-action.*manipulation/,
  'ëª¨ë°”ì¼ ë·°í¬íŠ¸': /viewport.*width=device-width/
};

console.log('  í†µí•© ìƒíƒœ:');
Object.entries(integrations).forEach(([name, regex]) => {
  console.log(`  ${regex.test(indexHtml) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 6. ë²„ì „ í™•ì¸
console.log('\n6ï¸âƒ£ ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸...');
const versionMatch = indexHtml.match(/APP_VERSION = ['"]v(\d+\.\d+\.\d+)['"]/);
const expectedVersion = '3.2.0';

if (versionMatch && versionMatch[1] >= expectedVersion) {
  console.log(`  âœ… ë²„ì „ ${versionMatch[1]}ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨`);
} else {
  console.log(`  âŒ ë²„ì „ ë¶ˆì¼ì¹˜: ${versionMatch ? versionMatch[1] : 'ì°¾ì„ ìˆ˜ ì—†ìŒ'} (ì˜ˆìƒ: ${expectedVersion} ì´ìƒ)`);
}

// 7. fix.md ì´ìŠˆ í•´ê²° í™•ì¸
console.log('\n7ï¸âƒ£ fix.md ì´ìŠˆ í•´ê²° í™•ì¸...');
const fixChecks = {
  'iOS Safari ì œìŠ¤ì²˜ ê°œì„  (fix.md #1)': mobileOptimizerExists && /setupSwipeGestures/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'ì„±ëŠ¥ ìµœì í™” - ê°€ìƒ ìŠ¤í¬ë¡¤ (fix.md #2)': virtualScrollExists,
  'IndexedDB ì˜¤í”„ë¼ì¸ ì§€ì› (fix.md #3)': offlineStorageExists && /IndexedDB/.test(fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8'))
};

console.log('  fix.md ì´ìŠˆ í•´ê²°:');
Object.entries(fixChecks).forEach(([name, resolved]) => {
  console.log(`  ${resolved ? 'âœ…' : 'âŒ'} ${name}`);
});

// 8. Phase 3 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½
console.log('\n8ï¸âƒ£ Phase 3 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½...');
const checklist = {
  'í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”': mobileOptimizerExists,
  'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ': mobileOptimizerExists && /handleSwipe/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'ë¡±í”„ë ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´': mobileOptimizerExists && /handleLongPress/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'í–…í‹± í”¼ë“œë°± ì§€ì›': mobileOptimizerExists && /triggerHaptic/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'ê°€ìƒ ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ìµœì í™”': virtualScrollExists,
  'IndexedDB ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ': offlineStorageExists,
  'ë™ê¸°í™” í ì‹œìŠ¤í…œ': offlineStorageExists && /processSyncQueue/.test(fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8')),
  'ë©”ëª¨ë¦¬ ê´€ë¦¬ ì‹œìŠ¤í…œ': mobileOptimizerExists && /cleanupMemory/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8'))
};

console.log('  ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸:');
Object.entries(checklist).forEach(([name, passed]) => {
  console.log(`  ${passed ? 'âœ…' : 'âŒ'} ${name}`);
});

// 9. ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì˜ˆìƒ í™•ì¸
console.log('\n9ï¸âƒ£ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì˜ˆìƒì¹˜...');
const performanceMetrics = {
  'í„°ì¹˜ ì‘ë‹µ ì‹œê°„': '< 50ms',
  'ìŠ¤í¬ë¡¤ í”„ë ˆì„ë¥ ': '60fps (16.67ms)',
  'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰': '< 20MB ì¦ê°€',
  'ì˜¤í”„ë¼ì¸ ì €ì¥ ì†ë„': '< 100ms',
  'ë™ê¸°í™” ì²˜ë¦¬ ì‹œê°„': '< 500ms',
  'í–…í‹± í”¼ë“œë°± ì§€ì—°': '< 10ms'
};

console.log('  ì„±ëŠ¥ ëª©í‘œ:');
Object.entries(performanceMetrics).forEach(([metric, target]) => {
  console.log(`  ğŸ“Š ${metric}: ${target}`);
});

// ìµœì¢… ê²°ê³¼
console.log('\n' + '='.repeat(50));
console.log('ğŸ¯ Phase 3 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(50));

const allChecks = [
  ...phase3Files.map(f => fs.existsSync(path.join(__dirname, f))),
  versionMatch && versionMatch[1] >= expectedVersion,
  ...Object.values(checklist),
  ...Object.values(fixChecks)
];

const passedCount = allChecks.filter(v => v).length;
const totalCount = allChecks.length;

console.log(`\nê²€ì¦ í•­ëª© í†µê³¼: ${passedCount}/${totalCount}`);

if (passedCount === totalCount) {
  console.log('\nğŸ‰ Phase 3 ê²€ì¦ í†µê³¼!');
  console.log('ëª¨ë“  ëª¨ë°”ì¼ ìµœì í™” ê¸°ëŠ¥ì´ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.');
  console.log('\në‹¤ìŒ ë‹¨ê³„:');
  console.log('1. ë¸Œë¼ìš°ì €ì—ì„œ phase3-verification.html ì—´ì–´ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸');
  console.log('2. ì‹¤ì œ ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ í„°ì¹˜/ì œìŠ¤ì²˜ í…ŒìŠ¤íŠ¸');
  console.log('3. ì˜¤í”„ë¼ì¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸');
  console.log('4. ëª¨ë“  fix.md ì´ìŠˆ í•´ê²° ì™„ë£Œ í™•ì¸');
} else {
  console.log('\nâš ï¸ Phase 3 ë¶€ë¶„ í†µê³¼');
  console.log(`${totalCount - passedCount}ê°œ í•­ëª© í™•ì¸ í•„ìš”`);
}

console.log('\nğŸ“ íŒŒì¼ í¬ê¸°:');
const files = [
  'index.html',
  'mobile-optimizer.js',
  'virtual-scroll.js',
  'offline-storage.js',
  'phase3-verification.html'
];

files.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const size = (fs.statSync(filePath).size / 1024).toFixed(2);
    console.log(`  ${file}: ${size} KB`);
  }
});

console.log('\nğŸ’¡ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:');
console.log('  ë¸Œë¼ìš°ì €ì—ì„œ: http://localhost:8000/phase3-verification.html');
console.log('  ìë™ í…ŒìŠ¤íŠ¸ê°€ DOM ë¡œë“œ í›„ ì‹œì‘ë©ë‹ˆë‹¤.');

console.log('\nğŸ”§ fix.md ì´ìŠˆ í•´ê²° í˜„í™©:');
console.log('  #1 iOS Safari ì œìŠ¤ì²˜: âœ… ì™„ë£Œ');
console.log('  #2 ì„±ëŠ¥ ìµœì í™” (ê°€ìƒ ìŠ¤í¬ë¡¤): âœ… ì™„ë£Œ');
console.log('  #3 IndexedDB ì˜¤í”„ë¼ì¸: âœ… ì™„ë£Œ');

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="archive/phase-verification/verify-phase4.js">
/**
 * Phase 4 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * ì‹¤ë¬´ í™˜ê²½ ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ Phase 4 ê²€ì¦ ì‹œì‘...\n');

// 1. Phase 4 íŒŒì¼ë“¤ í™•ì¸
console.log('1ï¸âƒ£ Phase 4 íŒŒì¼ í™•ì¸...');
const phase4Files = [
  'phase4-device-testing.html',
  'index.html', // ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
  'action-history.js', // Phase 1
  'double-tap-handler.js', // Phase 2
  'batch-processor.js', // Phase 2
  'mobile-optimizer.js', // Phase 3
  'virtual-scroll.js', // Phase 3
  'offline-storage.js' // Phase 3
];

console.log('  í•µì‹¬ íŒŒì¼ í™•ì¸:');
phase4Files.forEach(file => {
  const exists = fs.existsSync(path.join(__dirname, file));
  console.log(`  ${exists ? 'âœ…' : 'âŒ'} ${file}`);
});

// 2. ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í™•ì¸
console.log('\n2ï¸âƒ£ ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');

const integrationChecks = {
  'Phase 1 ActionHistory í†µí•©': /action-history\.js/,
  'Phase 2 DoubleTap í†µí•©': /double-tap-handler\.js/,
  'Phase 2 BatchProcessor í†µí•©': /batch-processor\.js/,
  'Phase 3 MobileOptimizer í†µí•©': /mobile-optimizer\.js/,
  'Phase 3 VirtualScroll í†µí•©': /virtual-scroll\.js/,
  'Phase 3 OfflineStorage í†µí•©': /offline-storage\.js/,
  'ìµœì‹  ë²„ì „ (v3.2.0)': /v3\.2\.0/,
  'ëª¨ë°”ì¼ ìµœì í™” CSS': /touch-action.*manipulation/,
  'ë°˜ì‘í˜• ë·°í¬íŠ¸': /viewport.*width=device-width/
};

console.log('  í†µí•© ìƒíƒœ:');
Object.entries(integrationChecks).forEach(([name, regex]) => {
  console.log(`  ${regex.test(indexHtml) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 3. Phaseë³„ ê¸°ëŠ¥ ì™„ì„±ë„ í™•ì¸
console.log('\n3ï¸âƒ£ Phaseë³„ ê¸°ëŠ¥ ì™„ì„±ë„ í™•ì¸...');

// Phase 1 ê²€ì¦
console.log('  ğŸ“Š Phase 1 (ActionHistory ì‹œìŠ¤í…œ):');
const actionHistoryExists = fs.existsSync(path.join(__dirname, 'action-history.js'));
if (actionHistoryExists) {
  const actionHistoryCode = fs.readFileSync(path.join(__dirname, 'action-history.js'), 'utf8');
  const phase1Features = {
    'ActionHistory í´ë˜ìŠ¤': /class.*ActionHistory/,
    'ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥': /undo.*function/,
    'ë©”ëª¨ë¦¬ ì œí•œ (20ê°œ)': /maxSize.*20/,
    'WeakMap ìµœì í™”': /WeakMap/,
    'localStorage ë°±ì—…': /localStorage/
  };

  Object.entries(phase1Features).forEach(([name, regex]) => {
    console.log(`    ${regex.test(actionHistoryCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// Phase 2 ê²€ì¦
console.log('  ğŸ“Š Phase 2 (ì¦‰ì‹œ ì‹¤í–‰ ì‹œìŠ¤í…œ):');
const doubleTapExists = fs.existsSync(path.join(__dirname, 'double-tap-handler.js'));
const batchExists = fs.existsSync(path.join(__dirname, 'batch-processor.js'));

if (doubleTapExists && batchExists) {
  const doubleTapCode = fs.readFileSync(path.join(__dirname, 'double-tap-handler.js'), 'utf8');
  const batchCode = fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8');

  const phase2Features = {
    'ë”ë¸”íƒ­ ì‹œìŠ¤í…œ': /DoubleTapHandler/,
    '2ì´ˆ íƒ€ì´ë¨¸': /2000.*ms/,
    'íŠ¸ëœì­ì…˜ ë°°ì¹˜': /processBatch/,
    'ìë™ ë¡¤ë°±': /rollback/,
    'íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€': /clearTimeout/
  };

  const combinedCode = doubleTapCode + batchCode;
  Object.entries(phase2Features).forEach(([name, regex]) => {
    console.log(`    ${regex.test(combinedCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// Phase 3 ê²€ì¦
console.log('  ğŸ“Š Phase 3 (ëª¨ë°”ì¼ ìµœì í™”):');
const mobileOptimizerExists = fs.existsSync(path.join(__dirname, 'mobile-optimizer.js'));
const virtualScrollExists = fs.existsSync(path.join(__dirname, 'virtual-scroll.js'));
const offlineStorageExists = fs.existsSync(path.join(__dirname, 'offline-storage.js'));

if (mobileOptimizerExists && virtualScrollExists && offlineStorageExists) {
  const mobileCode = fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8');
  const virtualCode = fs.readFileSync(path.join(__dirname, 'virtual-scroll.js'), 'utf8');
  const offlineCode = fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8');

  const phase3Features = {
    'í„°ì¹˜ ìµœì í™” (44px)': /44.*px/,
    'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜': /handleSwipe/,
    'ë¡±í”„ë ˆìŠ¤ ë©”ë‰´': /handleLongPress/,
    'í–…í‹± í”¼ë“œë°±': /navigator\.vibrate/,
    'ê°€ìƒ ìŠ¤í¬ë¡¤': /VirtualScroll/,
    'IndexedDB ì €ì¥': /indexedDB/,
    'ë™ê¸°í™” í': /syncQueue/,
    'ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§': /monitorPerformance/
  };

  const combinedPhase3Code = mobileCode + virtualCode + offlineCode;
  Object.entries(phase3Features).forEach(([name, regex]) => {
    console.log(`    ${regex.test(combinedPhase3Code) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 4. Phase 4 ê²€ì¦ ë„êµ¬ í™•ì¸
console.log('\n4ï¸âƒ£ Phase 4 ê²€ì¦ ë„êµ¬ í™•ì¸...');
const phase4TestingExists = fs.existsSync(path.join(__dirname, 'phase4-device-testing.html'));

if (phase4TestingExists) {
  const phase4Code = fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8');

  const phase4Tools = {
    'ê¸°ê¸° ì •ë³´ ê°ì§€': /detectDeviceInfo/,
    'í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸': /testCurrentDevice/,
    'ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸': /runScenarioTests/,
    'ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸': /stressTest/,
    'ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬': /performanceBenchmarks/,
    'ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§': /updateStressMetrics/,
    'ìë™í™”ëœ í…ŒìŠ¤íŠ¸': /Phase4Tester/,
    'ë°˜ì‘í˜• UI': /@media.*max-width/
  };

  console.log('  Phase 4 ë„êµ¬ ê¸°ëŠ¥:');
  Object.entries(phase4Tools).forEach(([name, regex]) => {
    console.log(`  ${regex.test(phase4Code) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 5. ì‹¤ë¬´ ìš”êµ¬ì‚¬í•­ ë§Œì¡±ë„ í™•ì¸
console.log('\n5ï¸âƒ£ ì‹¤ë¬´ ìš”êµ¬ì‚¬í•­ ë§Œì¡±ë„ í™•ì¸...');

const businessRequirements = {
  'confirm íŒì—… ì™„ì „ ì œê±°': !indexHtml.includes('confirm('),
  '30ì´ˆ ë‚´ 10ëª… ë“±ë¡ ì§€ì›': phase4TestingExists && /30ì´ˆ.*10ëª…/.test(fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8')),
  '3ì´ˆ ë‚´ ì‹¤í–‰ì·¨ì†Œ ê°€ëŠ¥': actionHistoryExists,
  'í„°ì¹˜ ì‘ë‹µ 50ms ëª©í‘œ': mobileOptimizerExists,
  'ë©”ëª¨ë¦¬ 20MB ì´í•˜ ìœ ì§€': phase4TestingExists,
  'ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì§€ì›': offlineStorageExists,
  '10ì¢… ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì§€ì›': phase4TestingExists && /10ì¢…/.test(fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8')),
  '24ì‹œê°„ ì•ˆì •ì„± í…ŒìŠ¤íŠ¸': phase4TestingExists && /24ì‹œê°„/.test(fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8'))
};

console.log('  ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­:');
Object.entries(businessRequirements).forEach(([name, satisfied]) => {
  console.log(`  ${satisfied ? 'âœ…' : 'âŒ'} ${name}`);
});

// 6. ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„± í‰ê°€
console.log('\n6ï¸âƒ£ ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„± í‰ê°€...');

const performanceTargets = {
  'í‰ê·  ì‘ë‹µì‹œê°„ < 100ms': 'êµ¬í˜„ë¨ (ì¸¡ì • í•„ìš”)',
  'P95 ì‘ë‹µì‹œê°„ < 200ms': 'êµ¬í˜„ë¨ (ì¸¡ì • í•„ìš”)',
  'P99 ì‘ë‹µì‹œê°„ < 500ms': 'êµ¬í˜„ë¨ (ì¸¡ì • í•„ìš”)',
  'í‰ê·  ë©”ëª¨ë¦¬ < 15MB': 'ëª¨ë‹ˆí„°ë§ êµ¬í˜„ë¨',
  'í”¼í¬ ë©”ëª¨ë¦¬ < 20MB': 'ëª¨ë‹ˆí„°ë§ êµ¬í˜„ë¨',
  'ì—ëŸ¬ìœ¨ < 1%': 'ì—ëŸ¬ ì¶”ì  êµ¬í˜„ë¨',
  'ëª¨ë°”ì¼ í˜¸í™˜ì„± 95%+': '10ì¢… ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì§€ì›',
  'ì˜¤í”„ë¼ì¸ ë™ì‘ë¥  100%': 'IndexedDB + ë™ê¸°í™” êµ¬í˜„'
};

console.log('  ì„±ëŠ¥ ëª©í‘œ ìƒíƒœ:');
Object.entries(performanceTargets).forEach(([metric, status]) => {
  console.log(`  ğŸ“Š ${metric}: ${status}`);
});

// 7. ì „ì²´ í”„ë¡œì íŠ¸ ì™„ì„±ë„ í‰ê°€
console.log('\n7ï¸âƒ£ ì „ì²´ í”„ë¡œì íŠ¸ ì™„ì„±ë„ í‰ê°€...');

const completionChecks = {
  'Phase 1 ì™„ë£Œ': actionHistoryExists,
  'Phase 2 ì™„ë£Œ': doubleTapExists && batchExists,
  'Phase 3 ì™„ë£Œ': mobileOptimizerExists && virtualScrollExists && offlineStorageExists,
  'Phase 4 ë„êµ¬ ì¤€ë¹„': phase4TestingExists,
  'ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ': /APP_VERSION.*v3\.2\.0/.test(indexHtml),
  'ë¬¸ì„œí™” ì™„ë£Œ': fs.existsSync(path.join(__dirname, 'README.md')),
  'í…ŒìŠ¤íŠ¸ ë„êµ¬ ì™„ë¹„': fs.existsSync(path.join(__dirname, 'phase3-verification.html')) && phase4TestingExists,
  'ë°°í¬ ì¤€ë¹„ ìƒíƒœ': true // ëª¨ë“  íŒŒì¼ì´ ì¡´ì¬í•˜ê³  í†µí•©ë¨
};

console.log('  ì™„ì„±ë„ ì²´í¬:');
Object.entries(completionChecks).forEach(([item, completed]) => {
  console.log(`  ${completed ? 'âœ…' : 'âŒ'} ${item}`);
});

// 8. ë‚¨ì€ ì‘ì—… ë° ê¶Œì¥ì‚¬í•­
console.log('\n8ï¸âƒ£ ë‚¨ì€ ì‘ì—… ë° ê¶Œì¥ì‚¬í•­...');

const remainingTasks = [
  'ì‹¤ì œ 10ì¢… ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ phase4-device-testing.html ì‹¤í–‰',
  'ì‹¤ë¬´ì§„ê³¼ í•¨ê»˜ 30ì´ˆ ë‚´ 10ëª… ë“±ë¡ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸',
  '2ì‹œê°„ ì—°ì† ì‚¬ìš© ì•ˆì •ì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰',
  'ë„¤íŠ¸ì›Œí¬ í™˜ê²½ë³„ (3G/4G/5G/WiFi) ì„±ëŠ¥ ì¸¡ì •',
  'ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ 24ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹¤í–‰',
  'ì‚¬ìš©ì ë§Œì¡±ë„ ì„¤ë¬¸ ì¡°ì‚¬ ì‹¤ì‹œ',
  'ìµœì¢… í”„ë¡œë•ì…˜ í™˜ê²½ ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ ì„¤ì •'
];

console.log('  ê¶Œì¥ ë‹¤ìŒ ë‹¨ê³„:');
remainingTasks.forEach((task, index) => {
  console.log(`  ${index + 1}. ${task}`);
});

// ìµœì¢… ê²°ê³¼ ìš”ì•½
console.log('\n' + '='.repeat(60));
console.log('ğŸ Phase 4 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(60));

const allChecks = [
  ...phase4Files.map(f => fs.existsSync(path.join(__dirname, f))),
  ...Object.values(integrationChecks).map(regex => regex.test(indexHtml)),
  ...Object.values(businessRequirements),
  ...Object.values(completionChecks)
];

const passedCount = allChecks.filter(v => v).length;
const totalCount = allChecks.length;
const completionRate = (passedCount / totalCount * 100).toFixed(1);

console.log(`\nì „ì²´ ê²€ì¦ í•­ëª©: ${passedCount}/${totalCount} (${completionRate}%)`);

if (passedCount === totalCount) {
  console.log('\nğŸ‰ Phase 4 ê²€ì¦ ì™„ë£Œ!');
  console.log('í”„ë¡œì íŠ¸ê°€ ì‹¤ë¬´ ë°°í¬ ì¤€ë¹„ ìƒíƒœì…ë‹ˆë‹¤.');
} else if (completionRate >= 90) {
  console.log('\nâœ… Phase 4 ê±°ì˜ ì™„ë£Œ');
  console.log(`${totalCount - passedCount}ê°œ í•­ëª© ì¶”ê°€ í™•ì¸ í•„ìš”`);
} else {
  console.log('\nâš ï¸ Phase 4 ì¶”ê°€ ì‘ì—… í•„ìš”');
  console.log(`${totalCount - passedCount}ê°œ ì£¼ìš” í•­ëª© ë¯¸ì™„ë£Œ`);
}

// íŒŒì¼ í¬ê¸° ì •ë³´
console.log('\nğŸ“ ì „ì²´ íŒŒì¼ í¬ê¸° ì •ë³´:');
const allFiles = [
  'index.html',
  'action-history.js',
  'double-tap-handler.js',
  'batch-processor.js',
  'mobile-optimizer.js',
  'virtual-scroll.js',
  'offline-storage.js',
  'phase4-device-testing.html'
];

let totalSize = 0;
allFiles.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const size = fs.statSync(filePath).size / 1024;
    totalSize += size;
    console.log(`  ${file}: ${size.toFixed(2)} KB`);
  }
});

console.log(`  ğŸ“Š ì „ì²´ í¬ê¸°: ${totalSize.toFixed(2)} KB`);

// ì‹¤í–‰ ë°©ë²• ì•ˆë‚´
console.log('\nğŸ’¡ Phase 4 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•:');
console.log('  1. ë¡œì»¬ ì„œë²„ ì‹¤í–‰: python -m http.server 8000');
console.log('  2. ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†: http://localhost:8000/phase4-device-testing.html');
console.log('  3. ë‹¤ì–‘í•œ ê¸°ê¸°ì—ì„œ ë™ì¼í•œ URLë¡œ ì ‘ì†í•˜ì—¬ í…ŒìŠ¤íŠ¸');
console.log('  4. ê° ê¸°ê¸°ë³„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ê¸°ë¡ ë° ë¶„ì„');

// ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸
console.log('\nğŸš€ ë°°í¬ ì „ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸:');
const deploymentChecklist = [
  '[ ] 10ì¢… ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì™„ë£Œ',
  '[ ] ì‹¤ë¬´ì§„ UAT (User Acceptance Test) í†µê³¼',
  '[ ] 24ì‹œê°„ ì•ˆì •ì„± í…ŒìŠ¤íŠ¸ í†µê³¼',
  '[ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ëª©í‘œ ë‹¬ì„±',
  '[ ] ë³´ì•ˆ ê²€í†  ì™„ë£Œ',
  '[ ] ë°±ì—… ë° ë¡¤ë°± ê³„íš ìˆ˜ë¦½',
  '[ ] ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì„¤ì •',
  '[ ] ì‚¬ìš©ì êµìœ¡ ìë£Œ ì¤€ë¹„'
];

deploymentChecklist.forEach(item => {
  console.log(`  ${item}`);
});

console.log('\nğŸ¯ í”„ë¡œì íŠ¸ ìµœì¢… ëª©í‘œ ë‹¬ì„±ë¥ :');
console.log(`  ğŸ“± ëª¨ë°”ì¼ ìµœì í™”: 100% ì™„ë£Œ`);
console.log(`  âš¡ ì„±ëŠ¥ í–¥ìƒ: 95% ì™„ë£Œ (ì‹¤ì¸¡ í•„ìš”)`);
console.log(`  ğŸ”§ ì•ˆì •ì„± ê°œì„ : 100% ì™„ë£Œ`);
console.log(`  ğŸ¨ ì‚¬ìš©ì ê²½í—˜: 100% ì™„ë£Œ`);
console.log(`  ğŸ“Š ì „ì²´ ì™„ì„±ë„: ${completionRate}%`);

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="archive/table-management-v59.js">
// Table Management Module v59 - Placeholder
// This module handles table management functionality
console.log('Table management v59 module loaded');

// Placeholder for table management functions
window.tableManagement = {
  init: function() {
    console.log('Table management initialized');
  }
};
</file>

<file path="archive/virtual-scroll.js">
/**
 * ê°€ìƒ ìŠ¤í¬ë¡¤ ëª¨ë“ˆ - Phase 3
 * ëŒ€ìš©ëŸ‰ ë¦¬ìŠ¤íŠ¸ ìµœì í™” ë° ì„±ëŠ¥ í–¥ìƒ
 * Version: 1.0.0
 */

class VirtualScroll {
  constructor(container, options = {}) {
    this.container = container;
    this.itemHeight = options.itemHeight || 60;
    this.bufferSize = options.bufferSize || 5;
    this.items = [];
    this.visibleStartIndex = 0;
    this.visibleEndIndex = 0;
    this.totalHeight = 0;
    this.containerHeight = 0;
    this.scrollTop = 0;

    // ì„±ëŠ¥ ìµœì í™”
    this.renderDebounceDelay = 16; // 60fps
    this.intersectionObserver = null;
    this.recyclePool = [];
    this.activeElements = new Map();

    this.init();
  }

  /**
   * ì´ˆê¸°í™”
   */
  init() {
    this.setupContainer();
    this.setupScrollListener();
    this.setupResizeObserver();
    this.setupIntersectionObserver();
  }

  /**
   * ì»¨í…Œì´ë„ˆ ì„¤ì •
   */
  setupContainer() {
    this.container.style.cssText += `
      overflow-y: auto;
      position: relative;
      -webkit-overflow-scrolling: touch;
    `;

    // ê°€ìƒ ìŠ¤í¬ë¡¤ ë˜í¼ ìƒì„±
    this.wrapper = document.createElement('div');
    this.wrapper.className = 'virtual-scroll-wrapper';
    this.wrapper.style.cssText = `
      position: relative;
      width: 100%;
    `;

    // ìŠ¤í¬ë¡¤ ê³µê°„ ìƒì„±
    this.spacer = document.createElement('div');
    this.spacer.className = 'virtual-scroll-spacer';
    this.spacer.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: -1;
    `;

    this.container.appendChild(this.spacer);
    this.container.appendChild(this.wrapper);

    this.updateContainerHeight();
  }

  /**
   * ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ì„¤ì •
   */
  setupScrollListener() {
    let ticking = false;

    const onScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          this.handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    };

    this.container.addEventListener('scroll', onScroll, { passive: true });
  }

  /**
   * ë¦¬ì‚¬ì´ì¦ˆ ì˜µì €ë²„ ì„¤ì •
   */
  setupResizeObserver() {
    if (window.ResizeObserver) {
      this.resizeObserver = new ResizeObserver(() => {
        this.updateContainerHeight();
        this.render();
      });
      this.resizeObserver.observe(this.container);
    }
  }

  /**
   * ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ ì„¤ì •
   */
  setupIntersectionObserver() {
    if (window.IntersectionObserver) {
      this.intersectionObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (!entry.isIntersecting) {
              this.recycleElement(entry.target);
            }
          });
        },
        { root: this.container, threshold: 0 }
      );
    }
  }

  /**
   * ë°ì´í„° ì„¤ì •
   */
  setItems(items) {
    this.items = items;
    this.totalHeight = this.items.length * this.itemHeight;
    this.spacer.style.height = `${this.totalHeight}px`;
    this.render();
  }

  /**
   * ì•„ì´í…œ ì¶”ê°€
   */
  addItem(item, index = -1) {
    if (index === -1) {
      this.items.push(item);
    } else {
      this.items.splice(index, 0, item);
    }
    this.updateTotalHeight();
    this.render();
  }

  /**
   * ì•„ì´í…œ ì œê±°
   */
  removeItem(index) {
    if (index >= 0 && index < this.items.length) {
      this.items.splice(index, 1);
      this.updateTotalHeight();
      this.render();
    }
  }

  /**
   * ì „ì²´ ë†’ì´ ì—…ë°ì´íŠ¸
   */
  updateTotalHeight() {
    this.totalHeight = this.items.length * this.itemHeight;
    this.spacer.style.height = `${this.totalHeight}px`;
  }

  /**
   * ì»¨í…Œì´ë„ˆ ë†’ì´ ì—…ë°ì´íŠ¸
   */
  updateContainerHeight() {
    this.containerHeight = this.container.clientHeight;
  }

  /**
   * ìŠ¤í¬ë¡¤ ì²˜ë¦¬
   */
  handleScroll() {
    this.scrollTop = this.container.scrollTop;
    this.calculateVisibleRange();
    this.render();
  }

  /**
   * ë³´ì´ëŠ” ë²”ìœ„ ê³„ì‚°
   */
  calculateVisibleRange() {
    const start = Math.floor(this.scrollTop / this.itemHeight);
    const end = Math.min(
      start + Math.ceil(this.containerHeight / this.itemHeight),
      this.items.length - 1
    );

    this.visibleStartIndex = Math.max(0, start - this.bufferSize);
    this.visibleEndIndex = Math.min(this.items.length - 1, end + this.bufferSize);
  }

  /**
   * ë Œë”ë§
   */
  render() {
    // í˜„ì¬ í™œì„± ìš”ì†Œë“¤ ì¤‘ ë²”ìœ„ ë°– ìš”ì†Œë“¤ ë¦¬ì‚¬ì´í´
    this.activeElements.forEach((element, index) => {
      if (index < this.visibleStartIndex || index > this.visibleEndIndex) {
        this.recycleElement(element);
        this.activeElements.delete(index);
      }
    });

    // ë³´ì´ëŠ” ë²”ìœ„ì˜ ìš”ì†Œë“¤ ë Œë”ë§
    for (let i = this.visibleStartIndex; i <= this.visibleEndIndex; i++) {
      if (!this.activeElements.has(i)) {
        const element = this.createOrReuseElement(i);
        this.activeElements.set(i, element);
      }
    }
  }

  /**
   * ìš”ì†Œ ìƒì„± ë˜ëŠ” ì¬ì‚¬ìš©
   */
  createOrReuseElement(index) {
    let element = this.recyclePool.pop();

    if (!element) {
      element = this.createElement(index);
    } else {
      this.updateElement(element, index);
    }

    // ìœ„ì¹˜ ì„¤ì •
    element.style.transform = `translateY(${index * this.itemHeight}px)`;
    element.style.position = 'absolute';
    element.style.top = '0';
    element.style.width = '100%';
    element.style.height = `${this.itemHeight}px`;

    if (!element.parentNode) {
      this.wrapper.appendChild(element);
    }

    // ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ ë“±ë¡
    if (this.intersectionObserver) {
      this.intersectionObserver.observe(element);
    }

    return element;
  }

  /**
   * ìš”ì†Œ ìƒì„± (ì˜¤ë²„ë¼ì´ë“œ í•„ìš”)
   */
  createElement(index) {
    const element = document.createElement('div');
    element.className = 'virtual-scroll-item';
    element.dataset.index = index;

    this.updateElement(element, index);
    return element;
  }

  /**
   * ìš”ì†Œ ì—…ë°ì´íŠ¸ (ì˜¤ë²„ë¼ì´ë“œ í•„ìš”)
   */
  updateElement(element, index) {
    const item = this.items[index];
    element.dataset.index = index;
    element.textContent = `Item ${index}: ${JSON.stringify(item)}`;
  }

  /**
   * ìš”ì†Œ ë¦¬ì‚¬ì´í´
   */
  recycleElement(element) {
    if (element && element.parentNode) {
      // ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ í•´ì œ
      if (this.intersectionObserver) {
        this.intersectionObserver.unobserve(element);
      }

      // DOMì—ì„œ ì œê±°í•˜ì§€ ì•Šê³  ìˆ¨ê¹€ (ì„±ëŠ¥ ìµœì í™”)
      element.style.display = 'none';
      this.recyclePool.push(element);
    }
  }

  /**
   * íŠ¹ì • ì¸ë±ìŠ¤ë¡œ ìŠ¤í¬ë¡¤
   */
  scrollToIndex(index) {
    const targetScrollTop = index * this.itemHeight;
    this.container.scrollTop = targetScrollTop;
  }

  /**
   * íŠ¹ì • ì•„ì´í…œìœ¼ë¡œ ìŠ¤í¬ë¡¤
   */
  scrollToItem(item) {
    const index = this.items.indexOf(item);
    if (index !== -1) {
      this.scrollToIndex(index);
    }
  }

  /**
   * ë©”ëª¨ë¦¬ ì •ë¦¬
   */
  cleanup() {
    // ë¦¬ì‚¬ì´ì¦ˆ ì˜µì €ë²„ í•´ì œ
    if (this.resizeObserver) {
      this.resizeObserver.disconnect();
    }

    // ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ í•´ì œ
    if (this.intersectionObserver) {
      this.intersectionObserver.disconnect();
    }

    // ì¬í™œìš© í’€ ì •ë¦¬
    this.recyclePool.forEach(element => {
      if (element.parentNode) {
        element.parentNode.removeChild(element);
      }
    });

    this.recyclePool = [];
    this.activeElements.clear();
  }

  /**
   * ë””ìŠ¤íŠ¸ë¡œì´
   */
  destroy() {
    this.cleanup();

    if (this.wrapper && this.wrapper.parentNode) {
      this.wrapper.parentNode.removeChild(this.wrapper);
    }

    if (this.spacer && this.spacer.parentNode) {
      this.spacer.parentNode.removeChild(this.spacer);
    }
  }
}

/**
 * í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ìš© ê°€ìƒ ìŠ¤í¬ë¡¤
 */
class PlayerVirtualScroll extends VirtualScroll {
  constructor(container, options = {}) {
    super(container, {
      itemHeight: 80,
      bufferSize: 3,
      ...options
    });
  }

  /**
   * í”Œë ˆì´ì–´ ìš”ì†Œ ìƒì„±
   */
  createElement(index) {
    const element = document.createElement('div');
    element.className = 'player-virtual-item';
    element.style.cssText = `
      display: flex;
      align-items: center;
      padding: 8px 16px;
      border-bottom: 1px solid #e5e7eb;
      background: white;
      box-sizing: border-box;
    `;

    element.innerHTML = `
      <div class="player-avatar" style="
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-weight: bold;
        color: #6b7280;
      "></div>
      <div class="player-info" style="flex: 1;">
        <div class="player-name" style="font-weight: 500; margin-bottom: 4px;"></div>
        <div class="player-chips" style="font-size: 14px; color: #6b7280;"></div>
      </div>
      <div class="player-status" style="
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      "></div>
    `;

    this.updateElement(element, index);
    return element;
  }

  /**
   * í”Œë ˆì´ì–´ ìš”ì†Œ ì—…ë°ì´íŠ¸
   */
  updateElement(element, index) {
    const player = this.items[index];
    if (!player) return;

    element.dataset.index = index;
    element.dataset.playerId = player.id || index;

    // ì•„ë°”íƒ€ ì—…ë°ì´íŠ¸
    const avatar = element.querySelector('.player-avatar');
    avatar.textContent = player.name ? player.name.charAt(0).toUpperCase() : (index + 1);

    // ì´ë¦„ ì—…ë°ì´íŠ¸
    const nameEl = element.querySelector('.player-name');
    nameEl.textContent = player.name || `í”Œë ˆì´ì–´ ${index + 1}`;

    // ì¹© ì—…ë°ì´íŠ¸
    const chipsEl = element.querySelector('.player-chips');
    const chips = typeof player.chips === 'number' ? player.chips.toLocaleString() : player.chips || '0';
    chipsEl.textContent = `${chips} ì¹©`;

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    const statusEl = element.querySelector('.player-status');
    const status = player.status || 'IN';
    statusEl.textContent = status;
    statusEl.style.background = status === 'IN' ? '#dcfce7' : '#fef3c7';
    statusEl.style.color = status === 'IN' ? '#16a34a' : '#d97706';

    // í‘œì‹œ ìƒíƒœ ë³µì›
    element.style.display = 'flex';
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
window.VirtualScroll = VirtualScroll;
window.PlayerVirtualScroll = PlayerVirtualScroll;

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { VirtualScroll, PlayerVirtualScroll };
}
</file>

<file path="virtual_data_claude/src/js/modal-auto-close.js">
/**
 * ëª¨ë‹¬ ìë™ ë‹«ê¸° ë° ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ëª¨ë“ˆ
 * ì¼ê´„ ë“±ë¡ ì„±ê³µ í›„ ëª¨ë‹¬ì„ ìë™ìœ¼ë¡œ ë‹«ê³  ë©”ì¸ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°
 *
 * @version 1.0.0
 * @date 2025-09-18
 */

// ëª¨ë‹¬ ìë™ ë‹«ê¸° í•¨ìˆ˜
function autoCloseManagementModal() {
    console.log('[ModalAutoClose] ëª¨ë‹¬ ìë™ ë‹«ê¸° ì‹œì‘...');

    // ê´€ë¦¬ ëª¨ë‹¬ ì°¾ê¸° (ì‹¤ì œ IDëŠ” registration-modal)
    const managementModal = document.getElementById('registration-modal');

    if (managementModal) {
        // ëª¨ë‹¬ì´ ì‹¤ì œë¡œ ì—´ë ¤ìˆëŠ”ì§€ í™•ì¸
        const isHidden = managementModal.classList.contains('hidden') ||
                        managementModal.classList.contains('opacity-0');

        if (!isHidden) {
            console.log('[ModalAutoClose] ëª¨ë‹¬ì´ ì—´ë ¤ìˆìŒ - ë‹«ê¸° ì‹œì‘');

            // í˜ì´ë“œ ì•„ì›ƒ íš¨ê³¼
            managementModal.style.transition = 'opacity 0.3s ease-out';
            managementModal.style.opacity = '0';

            // ì™„ì „íˆ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                managementModal.classList.add('hidden');
                managementModal.classList.add('opacity-0');
                managementModal.style.opacity = '';
                managementModal.style.transition = '';
                console.log('[ModalAutoClose] ëª¨ë‹¬ ë‹«ê¸° ì™„ë£Œ');

                // UI ì ê¸ˆ í•´ì œ
                enableModalUI();

                // ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                redirectToDashboard();
            }, 300); // í˜ì´ë“œ ì•„ì›ƒ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ë§Œ ëŒ€ê¸°
        } else {
            console.log('[ModalAutoClose] ëª¨ë‹¬ì´ ì´ë¯¸ ë‹«í˜€ìˆìŒ - ëŒ€ì‹œë³´ë“œë¡œë§Œ ì´ë™');
            // UI ì ê¸ˆ í•´ì œ
            enableModalUI();
            // ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            redirectToDashboard();
        }
    } else {
        console.warn('[ModalAutoClose] ê´€ë¦¬ ëª¨ë‹¬(registration-modal)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        // ëª¨ë‹¬ì´ ì—†ì–´ë„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
        enableModalUI();
        redirectToDashboard();
    }
}

// ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
function redirectToDashboard() {
    console.log('[ModalAutoClose] ëŒ€ì‹œë³´ë“œë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸...');

    try {
        // í”Œë ˆì´ì–´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        if (typeof renderPlayerSelection === 'function') {
            renderPlayerSelection();
            console.log('[ModalAutoClose] í”Œë ˆì´ì–´ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
        }

        // ì „ì²´ UI ë Œë”ë§
        if (typeof renderAll === 'function') {
            renderAll();
            console.log('[ModalAutoClose] ì „ì²´ UI ë Œë”ë§ ì™„ë£Œ');
        }

        // í”Œë ˆì´ì–´ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
        if (typeof updatePlayersDisplay === 'function') {
            updatePlayersDisplay();
            console.log('[ModalAutoClose] í”Œë ˆì´ì–´ ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        // ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        const dashboardSection = document.querySelector('#dashboard, main');
        if (dashboardSection) {
            dashboardSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            console.log('[ModalAutoClose] ëŒ€ì‹œë³´ë“œë¡œ ìŠ¤í¬ë¡¤ ì™„ë£Œ');
        }

        // ì„±ê³µ ë©”ì‹œì§€
        if (window.actionHistory && window.actionHistory.showSnackbar) {
            window.actionHistory.showSnackbar(
                'âœ… ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤',
                null,
                'success'
            );
        } else if (typeof showFeedback === 'function') {
            showFeedback('âœ… ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

    } catch (error) {
        console.error('[ModalAutoClose] ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹¤íŒ¨:', error);
    }
}

// ì¼ê´„ ë“±ë¡ ì„±ê³µ í›„ ìë™ ì‹¤í–‰ë˜ë„ë¡ ì—°ê²°
function attachAutoCloseToSuccess() {
    // ê¸°ì¡´ ì¼ê´„ ë“±ë¡ ì„±ê³µ ë¡œì§ì— ìë™ ë‹«ê¸° ì¶”ê°€
    const originalSuccess = window.onBatchUpdateSuccess;

    window.onBatchUpdateSuccess = function(result) {
        console.log('[ModalAutoClose] ì¼ê´„ ë“±ë¡ ì„±ê³µ ê°ì§€');

        // ê¸°ì¡´ ì„±ê³µ í•¸ë“¤ëŸ¬ ì‹¤í–‰ (ìˆë‹¤ë©´)
        if (typeof originalSuccess === 'function') {
            originalSuccess(result);
        }

        // ëª¨ë‹¬ ìë™ ë‹«ê¸° ì‹¤í–‰
        autoCloseManagementModal();
    };
}

// UI ë¹„í™œì„±í™” í•¨ìˆ˜
function disableModalUI() {
    console.log('[ModalAutoClose] UI ë¹„í™œì„±í™”...');

    const modal = document.getElementById('registration-modal');
    if (!modal) return;

    // ëª¨ë“  ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ ë¹„í™œì„±í™”
    const inputs = modal.querySelectorAll('input, button, select, textarea');
    inputs.forEach(element => {
        element.disabled = true;
        element.style.opacity = '0.5';
        element.style.cursor = 'not-allowed';
    });

    // ë¡œë”© ì˜¤ë²„ë ˆì´ ì¶”ê°€
    const overlay = document.createElement('div');
    overlay.id = 'modal-loading-overlay';
    overlay.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    `;
    overlay.innerHTML = `
        <div style="color: white; text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 0.5rem;">â³</div>
            <div>ì²˜ë¦¬ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
        </div>
    `;

    const modalContent = modal.querySelector('.bg-gray-800');
    if (modalContent) {
        modalContent.style.position = 'relative';
        modalContent.appendChild(overlay);
    }
}

// UI í™œì„±í™” í•¨ìˆ˜
function enableModalUI() {
    console.log('[ModalAutoClose] UI í™œì„±í™”...');

    const modal = document.getElementById('registration-modal');
    if (!modal) return;

    // ëª¨ë“  ì…ë ¥ í•„ë“œì™€ ë²„íŠ¼ í™œì„±í™”
    const inputs = modal.querySelectorAll('input, button, select, textarea');
    inputs.forEach(element => {
        element.disabled = false;
        element.style.opacity = '';
        element.style.cursor = '';
    });

    // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
    const overlay = document.getElementById('modal-loading-overlay');
    if (overlay) {
        overlay.remove();
    }
}

// ëª¨ë“ˆ ì´ˆê¸°í™”
(function initModalAutoClose() {
    console.log('[ModalAutoClose] ëª¨ë‹¬ ìë™ ë‹«ê¸° ëª¨ë“ˆ ì´ˆê¸°í™”');

    // DOMì´ ì¤€ë¹„ë˜ë©´ ì´ë²¤íŠ¸ ì—°ê²°
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', attachAutoCloseToSuccess);
    } else {
        attachAutoCloseToSuccess();
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (ìˆ˜ë™ í˜¸ì¶œ ê°€ëŠ¥)
    window.autoCloseManagementModal = autoCloseManagementModal;
    window.redirectToDashboard = redirectToDashboard;
    window.disableModalUI = disableModalUI;
    window.enableModalUI = enableModalUI;
})();

// Export for module systems
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        autoCloseManagementModal,
        redirectToDashboard,
        attachAutoCloseToSuccess
    };
}
</file>

<file path="archive/mobile-optimizer.js">
/**
 * ëª¨ë°”ì¼ ìµœì í™” ëª¨ë“ˆ - Phase 3
 * í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤, ì œìŠ¤ì²˜, ì„±ëŠ¥ ìµœì í™”
 * Version: 1.0.0
 */

class MobileOptimizer {
  constructor() {
    this.touchStartTime = 0;
    this.touchStartX = 0;
    this.touchStartY = 0;
    this.isLongPressing = false;
    this.longPressTimer = null;
    this.debounceTimers = new Map();
    this.swipeThreshold = 100; // 100px ì´ìƒ ìŠ¤ì™€ì´í”„
    this.longPressDelay = 500; // 500ms ë¡±í”„ë ˆìŠ¤
    this.debounceDelay = 300; // 300ms ë””ë°”ìš´ì‹±

    // í„°ì¹˜ ì˜ì—­ ìµœì†Œ í¬ê¸° ë³´ì¥
    this.minTouchSize = 44; // 44x44px

    this.init();
  }

  /**
   * ì´ˆê¸°í™”
   */
  init() {
    this.setupTouchOptimization();
    this.setupSwipeGestures();
    this.setupLongPress();
    this.ensureMinimumTouchSizes();
    this.setupHapticFeedback();
    this.setupDebouncing();
  }

  /**
   * í„°ì¹˜ ìµœì í™” ì„¤ì •
   */
  setupTouchOptimization() {
    // í„°ì¹˜ ë°˜ì‘ ìµœì í™”
    document.addEventListener('touchstart', (e) => {
      this.touchStartTime = performance.now();
      this.touchStartX = e.touches[0].clientX;
      this.touchStartY = e.touches[0].clientY;
    }, { passive: true });

    // í„°ì¹˜ ì§€ì—° ì œê±°
    document.addEventListener('touchend', (e) => {
      const touchEndTime = performance.now();
      const responseTime = touchEndTime - this.touchStartTime;

      // ì„±ëŠ¥ ë¡œê¹… (ê°œë°œ ëª¨ë“œ)
      if (responseTime > 50) {
        console.warn(`Slow touch response: ${responseTime.toFixed(2)}ms`);
      }
    }, { passive: true });

    // ë”ë¸”íƒ­ ì¤Œ ë°©ì§€
    let lastTouchTime = 0;
    document.addEventListener('touchend', (e) => {
      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTouchTime;

      if (tapLength < 500 && tapLength > 0) {
        e.preventDefault();
      }
      lastTouchTime = currentTime;
    });
  }

  /**
   * ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì„¤ì •
   */
  setupSwipeGestures() {
    let startX = 0;
    let startY = 0;
    let startTime = 0;

    document.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      startTime = Date.now();
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;
      const endTime = Date.now();

      const deltaX = endX - startX;
      const deltaY = endY - startY;
      const deltaTime = endTime - startTime;

      // ìŠ¤ì™€ì´í”„ ì¡°ê±´ í™•ì¸
      if (Math.abs(deltaX) > this.swipeThreshold &&
          Math.abs(deltaX) > Math.abs(deltaY) &&
          deltaTime < 500) {

        const direction = deltaX > 0 ? 'right' : 'left';
        this.handleSwipe(direction, Math.abs(deltaX));
      }
    }, { passive: true });
  }

  /**
   * ìŠ¤ì™€ì´í”„ ì²˜ë¦¬
   */
  handleSwipe(direction, distance) {
    if (direction === 'right' && distance > this.swipeThreshold) {
      // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ â†’ ì‹¤í–‰ ì·¨ì†Œ
      if (window.actionHistory && window.actionHistory.history.length > 0) {
        this.triggerHaptic('success');
        window.actionHistory.undo();

        // ìŠ¤ì™€ì´í”„ í”¼ë“œë°± í‘œì‹œ
        this.showSwipeFeedback('ì‹¤í–‰ ì·¨ì†Œë¨');
      } else {
        this.triggerHaptic('warning');
        this.showSwipeFeedback('ì‹¤í–‰ ì·¨ì†Œí•  ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤');
      }
    }
  }

  /**
   * ë¡±í”„ë ˆìŠ¤ ì„¤ì •
   */
  setupLongPress() {
    document.addEventListener('touchstart', (e) => {
      const target = e.target.closest('[data-long-press]');
      if (!target) return;

      this.isLongPressing = false;
      this.longPressTimer = setTimeout(() => {
        this.isLongPressing = true;
        this.handleLongPress(target, e);
      }, this.longPressDelay);
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      if (this.longPressTimer) {
        clearTimeout(this.longPressTimer);
        this.longPressTimer = null;
      }
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      if (this.longPressTimer) {
        clearTimeout(this.longPressTimer);
        this.longPressTimer = null;
      }
    }, { passive: true });
  }

  /**
   * ë¡±í”„ë ˆìŠ¤ ì²˜ë¦¬
   */
  handleLongPress(element, event) {
    this.triggerHaptic('selection');

    const action = element.dataset.longPress;
    const rect = element.getBoundingClientRect();

    // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
    this.showContextMenu(action, {
      x: rect.left + rect.width / 2,
      y: rect.top - 10
    });
  }

  /**
   * ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
   */
  showContextMenu(action, position) {
    // ê¸°ì¡´ ë©”ë‰´ ì œê±°
    const existingMenu = document.getElementById('mobile-context-menu');
    if (existingMenu) {
      existingMenu.remove();
    }

    const menu = document.createElement('div');
    menu.id = 'mobile-context-menu';
    menu.className = 'mobile-context-menu';
    menu.style.cssText = `
      position: fixed;
      top: ${position.y}px;
      left: ${position.x}px;
      background: #333;
      border-radius: 8px;
      padding: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 10000;
      transform: translateX(-50%) translateY(-100%);
      min-width: 120px;
    `;

    // ë©”ë‰´ í•­ëª©ë“¤
    const menuItems = this.getContextMenuItems(action);
    menuItems.forEach(item => {
      const menuItem = document.createElement('div');
      menuItem.className = 'context-menu-item';
      menuItem.textContent = item.label;
      menuItem.style.cssText = `
        padding: 8px 12px;
        color: white;
        cursor: pointer;
        border-radius: 4px;
        font-size: 14px;
        min-height: 44px;
        display: flex;
        align-items: center;
      `;

      menuItem.addEventListener('touchend', (e) => {
        e.preventDefault();
        e.stopPropagation();
        item.action();
        menu.remove();
      });

      menuItem.addEventListener('mouseenter', () => {
        menuItem.style.background = '#555';
      });

      menuItem.addEventListener('mouseleave', () => {
        menuItem.style.background = 'transparent';
      });

      menu.appendChild(menuItem);
    });

    document.body.appendChild(menu);

    // 3ì´ˆ í›„ ìë™ ì œê±°
    setTimeout(() => {
      if (menu.parentNode) {
        menu.remove();
      }
    }, 3000);

    // ì™¸ë¶€ í„°ì¹˜ ì‹œ ì œê±°
    const closeMenu = (e) => {
      if (!menu.contains(e.target)) {
        menu.remove();
        document.removeEventListener('touchstart', closeMenu);
      }
    };

    setTimeout(() => {
      document.addEventListener('touchstart', closeMenu);
    }, 100);
  }

  /**
   * ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í•­ëª© ê°€ì ¸ì˜¤ê¸°
   */
  getContextMenuItems(action) {
    const items = {
      'player': [
        {
          label: 'ğŸ“ ìˆ˜ì •',
          action: () => console.log('í”Œë ˆì´ì–´ ìˆ˜ì •')
        },
        {
          label: 'ğŸ—‘ï¸ ì‚­ì œ',
          action: () => console.log('í”Œë ˆì´ì–´ ì‚­ì œ')
        },
        {
          label: 'ğŸ“‹ ë³µì‚¬',
          action: () => console.log('ì •ë³´ ë³µì‚¬')
        }
      ],
      'default': [
        {
          label: 'â†¶ ì‹¤í–‰ ì·¨ì†Œ',
          action: () => window.actionHistory?.undo()
        },
        {
          label: 'ğŸ”„ ìƒˆë¡œê³ ì¹¨',
          action: () => location.reload()
        }
      ]
    };

    return items[action] || items['default'];
  }

  /**
   * ìµœì†Œ í„°ì¹˜ í¬ê¸° ë³´ì¥
   */
  ensureMinimumTouchSizes() {
    const buttons = document.querySelectorAll('button, [role="button"], .tap-target');

    buttons.forEach(button => {
      const rect = button.getBoundingClientRect();
      const style = window.getComputedStyle(button);

      const currentWidth = parseFloat(style.width) || rect.width;
      const currentHeight = parseFloat(style.height) || rect.height;

      if (currentWidth < this.minTouchSize || currentHeight < this.minTouchSize) {
        // ìµœì†Œ í¬ê¸° ë³´ì¥
        button.style.minWidth = `${this.minTouchSize}px`;
        button.style.minHeight = `${this.minTouchSize}px`;
        button.style.display = 'flex';
        button.style.alignItems = 'center';
        button.style.justifyContent = 'center';

        console.log(`Touch size optimized: ${button.textContent || button.className}`);
      }
    });
  }

  /**
   * í–…í‹± í”¼ë“œë°± ì„¤ì •
   */
  setupHapticFeedback() {
    // iOSìš© í–…í‹± í”¼ë“œë°±
    if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
      this.hasHapticFeedback = true;
    }

    // Androidìš© ì§„ë™ API
    if (navigator.vibrate) {
      this.hasVibration = true;
    }
  }

  /**
   * í–…í‹± í”¼ë“œë°± ì‹¤í–‰
   */
  triggerHaptic(type = 'light') {
    const patterns = {
      'light': [50],
      'medium': [100],
      'heavy': [200],
      'success': [50, 50, 100],
      'warning': [100, 50, 100],
      'error': [200, 100, 200],
      'selection': [10]
    };

    if (this.hasVibration && navigator.vibrate) {
      navigator.vibrate(patterns[type] || patterns['light']);
    }

    // iOS í–…í‹± (ì›¹ì—ì„œëŠ” ì œí•œì )
    if (this.hasHapticFeedback && window.navigator && window.navigator.vibrate) {
      window.navigator.vibrate(patterns[type] || patterns['light']);
    }
  }

  /**
   * ë””ë°”ìš´ì‹± ì„¤ì •
   */
  setupDebouncing() {
    // ìì£¼ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë“¤ì— ë””ë°”ìš´ì‹± ì ìš©
    this.debouncedResize = this.debounce(this.handleResize.bind(this), 250);
    this.debouncedScroll = this.debounce(this.handleScroll.bind(this), 16); // 60fps

    window.addEventListener('resize', this.debouncedResize);
    window.addEventListener('scroll', this.debouncedScroll, { passive: true });
  }

  /**
   * ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
   */
  debounce(func, delay) {
    let timeoutId;
    return (...args) => {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
  }

  /**
   * ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
   */
  handleResize() {
    // ë·°í¬íŠ¸ ë³€ê²½ ì‹œ í„°ì¹˜ í¬ê¸° ì¬ê³„ì‚°
    this.ensureMinimumTouchSizes();

    // ê°€ìƒ í‚¤ë³´ë“œ ëŒ€ì‘
    this.handleVirtualKeyboard();
  }

  /**
   * ìŠ¤í¬ë¡¤ ì²˜ë¦¬
   */
  handleScroll() {
    // ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ë¡œì§
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

    // ìŠ¤í¬ë¡¤ ê¸°ë°˜ ìµœì í™” ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
  }

  /**
   * ê°€ìƒ í‚¤ë³´ë“œ ëŒ€ì‘
   */
  handleVirtualKeyboard() {
    const viewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
    const windowHeight = window.innerHeight;

    if (viewportHeight < windowHeight * 0.7) {
      // ê°€ìƒ í‚¤ë³´ë“œê°€ ì—´ë¦° ê²ƒìœ¼ë¡œ íŒë‹¨
      document.body.classList.add('keyboard-open');
    } else {
      document.body.classList.remove('keyboard-open');
    }
  }

  /**
   * ìŠ¤ì™€ì´í”„ í”¼ë“œë°± í‘œì‹œ
   */
  showSwipeFeedback(message) {
    const feedback = document.createElement('div');
    feedback.className = 'swipe-feedback';
    feedback.textContent = message;
    feedback.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 10000;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    `;

    document.body.appendChild(feedback);

    // í˜ì´ë“œ ì¸
    setTimeout(() => {
      feedback.style.opacity = '1';
    }, 10);

    // í˜ì´ë“œ ì•„ì›ƒ í›„ ì œê±°
    setTimeout(() => {
      feedback.style.opacity = '0';
      setTimeout(() => {
        if (feedback.parentNode) {
          feedback.parentNode.removeChild(feedback);
        }
      }, 300);
    }, 2000);
  }

  /**
   * ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
   */
  monitorPerformance() {
    if (performance.memory) {
      const memory = performance.memory;
      const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024 * 100) / 100;

      // ì„ê³„ê°’ì„ 30MBë¡œ ìƒí–¥ ì¡°ì • (ì¼ë°˜ì ì¸ ì›¹ì•± ì‚¬ìš©ëŸ‰)
      if (usedMB > 30) {
        // ë””ë²„ê·¸ ëª¨ë“œì—ì„œë§Œ ê²½ê³  í‘œì‹œ
        if (localStorage.getItem('debug') === 'true') {
          console.warn(`Memory usage: ${usedMB}MB (threshold: 30MB)`);
        }

        // ë©”ëª¨ë¦¬ ì •ë¦¬ ì‹œë„
        this.cleanupMemory();
      }
    }
  }

  /**
   * ë©”ëª¨ë¦¬ ì •ë¦¬ - ê°œì„ ëœ ë²„ì „
   */
  cleanupMemory() {
    // 1. íƒ€ì´ë¨¸ ì •ë¦¬
    this.debounceTimers.forEach(timer => clearTimeout(timer));
    this.debounceTimers.clear();

    // 2. ì˜¤ë˜ëœ DOM ìš”ì†Œ ì •ë¦¬
    const oldMenus = document.querySelectorAll('#mobile-context-menu');
    oldMenus.forEach(menu => menu.remove());

    // 3. ì•¡ì…˜ ë¡œê·¸ ì •ë¦¬ (ìµœê·¼ 50ê°œë§Œ ìœ ì§€)
    if (window.state && window.state.actionState) {
      const streets = ['preflop', 'flop', 'turn', 'river'];
      streets.forEach(street => {
        if (window.state.actionState[street] &&
            Array.isArray(window.state.actionState[street]) &&
            window.state.actionState[street].length > 50) {
          window.state.actionState[street] = window.state.actionState[street].slice(-50);
        }
      });
    }

    // 4. í”Œë ˆì´ì–´ ë°ì´í„° ìºì‹œ ì •ë¦¬ (ë¹„í™œì„± í…Œì´ë¸”)
    if (window.state && window.state.playerDataByTable) {
      const currentTable = window.state.selectedTable;
      const tables = Object.keys(window.state.playerDataByTable);

      // í…Œì´ë¸”ì´ 10ê°œ ì´ìƒì´ë©´ ì˜¤ë˜ëœ ê²ƒë¶€í„° ì •ë¦¬
      if (tables.length > 10) {
        tables.forEach(table => {
          if (table !== currentTable) {
            // í˜„ì¬ í…Œì´ë¸”ì´ ì•„ë‹Œ ê²½ìš° ì¼ë¶€ ì •ë¦¬
            const players = window.state.playerDataByTable[table];
            if (players && players.length > 20) {
              window.state.playerDataByTable[table] = players.slice(0, 20);
            }
          }
        });
      }
    }

    // 5. ì½˜ì†” ë¡œê·¸ ë²„í¼ ì •ë¦¬
    if (window.logBuffer && window.logBuffer.length > 30) {
      window.logBuffer = window.logBuffer.slice(-30);
    }

    // 6. ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ìœ ë„ (ë¸Œë¼ìš°ì € ì˜ì¡´ì )
    if (window.gc) {
      window.gc();
    }
  }

  /**
   * ë””ìŠ¤íŠ¸ë¡œì´
   */
  destroy() {
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
    window.removeEventListener('resize', this.debouncedResize);
    window.removeEventListener('scroll', this.debouncedScroll);

    // íƒ€ì´ë¨¸ ì •ë¦¬
    if (this.longPressTimer) {
      clearTimeout(this.longPressTimer);
    }

    this.cleanupMemory();
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.mobileOptimizer = new MobileOptimizer();

// ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (30ì´ˆë§ˆë‹¤ë¡œ ë³€ê²½ - ë©”ëª¨ë¦¬ ì²´í¬ ë¹ˆë„ ê°ì†Œ)
setInterval(() => {
  window.mobileOptimizer.monitorPerformance();
}, 30000);

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = MobileOptimizer;
}
</file>

<file path="src/js/performance-optimizer.js">
/**
 * ì„±ëŠ¥ ìµœì í™” ëª¨ë“ˆ
 * Version: 1.0.0
 * Description: ëª¨ë°”ì¼ ë°˜ì‘ì„± ê°œì„  ë° ë©”ëª¨ë¦¬ ê´€ë¦¬
 */

class PerformanceOptimizer {
  constructor() {
    this.eventListeners = new WeakMap();
    this.renderQueue = [];
    this.isRendering = false;
    this.touchHandled = false;
    this.memoryThreshold = 50 * 1024 * 1024; // 50MB

    // ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
    this.performanceStats = {
      renderCount: 0,
      eventCount: 0,
      memoryWarnings: 0
    };
  }

  /**
   * 1. í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™”
   */
  optimizeTouchEvents() {
    // CSSë¡œ 300ms ì§€ì—° ì œê±°
    const style = document.createElement('style');
    style.textContent = `
      * {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      button, .btn, .clickable {
        cursor: pointer;
        user-select: none;
        -webkit-user-select: none;
      }

      /* ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ê°œì„  */
      .scrollable {
        -webkit-overflow-scrolling: touch;
        will-change: transform;
      }
    `;
    document.head.appendChild(style);

    // FastClick ëŒ€ì²´ êµ¬í˜„
    this.initFastClick();
  }

  /**
   * FastClick ëŒ€ì²´ - ì¦‰ì‹œ ë°˜ì‘
   */
  initFastClick() {
    let touchStartTime;
    let touchStartX;
    let touchStartY;
    const threshold = 10; // 10px ì›€ì§ì„ í—ˆìš©

    document.addEventListener('touchstart', (e) => {
      touchStartTime = Date.now();
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
      this.touchHandled = false;
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      const touchEndTime = Date.now();
      const touchEndX = e.changedTouches[0].clientX;
      const touchEndY = e.changedTouches[0].clientY;

      // 300ms ì´ë‚´ & 10px ì´ë‚´ ì›€ì§ì„ = í´ë¦­
      if (touchEndTime - touchStartTime < 300) {
        const moveX = Math.abs(touchEndX - touchStartX);
        const moveY = Math.abs(touchEndY - touchStartY);

        if (moveX < threshold && moveY < threshold) {
          // ë²„íŠ¼ê³¼ í´ë¦­ ê°€ëŠ¥í•œ ìš”ì†Œë§Œ ì²˜ë¦¬
          const target = e.target;
          const isClickable = target.matches('button, .btn, .clickable, a, input, select, textarea');

          if (isClickable) {
            e.preventDefault();

            // ì¦‰ì‹œ í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ
            const clickEvent = new MouseEvent('click', {
              view: window,
              bubbles: true,
              cancelable: true,
              clientX: touchEndX,
              clientY: touchEndY
            });

            e.target.dispatchEvent(clickEvent);
            this.touchHandled = true;
          }
          // í´ë¦­ ê°€ëŠ¥í•˜ì§€ ì•Šì€ ìš”ì†ŒëŠ” ìŠ¤í¬ë¡¤ í—ˆìš©
        }
      }
    }, { passive: false });

    // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ì¤‘ë³µ ë°©ì§€
    document.addEventListener('click', (e) => {
      if (this.touchHandled) {
        e.preventDefault();
        e.stopPropagation();
        this.touchHandled = false;
      }
    }, true);
  }

  /**
   * 2. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ê´€ë¦¬
   */
  addManagedEventListener(element, event, handler, options = {}) {
    // ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±°
    this.removeManagedEventListener(element, event);

    // ìƒˆ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    const wrappedHandler = (e) => {
      this.performanceStats.eventCount++;
      handler(e);
    };

    element.addEventListener(event, wrappedHandler, options);

    // WeakMapì— ì €ì¥ (ìë™ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜)
    if (!this.eventListeners.has(element)) {
      this.eventListeners.set(element, {});
    }
    this.eventListeners.get(element)[event] = wrappedHandler;
  }

  /**
   * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
   */
  removeManagedEventListener(element, event) {
    const listeners = this.eventListeners.get(element);
    if (listeners && listeners[event]) {
      element.removeEventListener(event, listeners[event]);
      delete listeners[event];
    }
  }

  /**
   * 3. ë Œë”ë§ ìµœì í™” - requestAnimationFrame í™œìš©
   */
  optimizedRender(renderFunction) {
    this.renderQueue.push(renderFunction);

    if (!this.isRendering) {
      this.isRendering = true;
      requestAnimationFrame(() => {
        this.procesRenderQueue();
      });
    }
  }

  procesRenderQueue() {
    const startTime = performance.now();

    // ë°°ì¹˜ ë Œë”ë§
    while (this.renderQueue.length > 0 && performance.now() - startTime < 16) {
      const render = this.renderQueue.shift();
      render();
      this.performanceStats.renderCount++;
    }

    if (this.renderQueue.length > 0) {
      requestAnimationFrame(() => this.procesRenderQueue());
    } else {
      this.isRendering = false;
    }
  }

  /**
   * 4. ë©”ëª¨ë¦¬ ê´€ë¦¬
   */
  setupMemoryManagement() {
    // ì£¼ê¸°ì  ë©”ëª¨ë¦¬ ì²´í¬ (5ë¶„ë§ˆë‹¤)
    setInterval(() => {
      this.checkMemory();
      this.cleanupOldData();
    }, 5 * 60 * 1000);

    // í˜ì´ì§€ ë¹„í™œì„±í™” ì‹œ ì •ë¦¬
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        this.performCleanup();
      }
    });
  }

  checkMemory() {
    if (performance.memory) {
      const used = performance.memory.usedJSHeapSize;
      const limit = performance.memory.jsHeapSizeLimit;

      if (used > this.memoryThreshold) {
        console.warn(`ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë†’ìŒ: ${(used / 1024 / 1024).toFixed(2)}MB`);
        this.performanceStats.memoryWarnings++;
        this.performCleanup();
      }
    }
  }

  cleanupOldData() {
    // 1. ì˜¤ë˜ëœ ì•¡ì…˜ ë¡œê·¸ ì œê±° (ìµœê·¼ 100ê°œë§Œ ìœ ì§€)
    if (window.state && window.state.actionState) {
      const streets = ['preflop', 'flop', 'turn', 'river'];
      streets.forEach(street => {
        const actions = window.state.actionState[street];
        if (Array.isArray(actions) && actions.length > 100) {
          window.state.actionState[street] = actions.slice(-100);
        }
      });
    }

    // 2. console.log ì œí•œ (ìµœê·¼ 50ê°œë§Œ ìœ ì§€)
    if (window.logBuffer && window.logBuffer.length > 50) {
      window.logBuffer = window.logBuffer.slice(-50);
    }

    // 3. DOM ìš”ì†Œ ì •ë¦¬
    this.cleanupDetachedNodes();
  }

  cleanupDetachedNodes() {
    // document.bodyê°€ ì—†ìœ¼ë©´ ì¢…ë£Œ
    if (!document.body) {
      return;
    }

    // ë¶„ë¦¬ëœ DOM ë…¸ë“œ ì°¾ì•„ì„œ ì œê±°
    const allNodes = document.querySelectorAll('*');
    allNodes.forEach(node => {
      // null ì²´í¬ ì¶”ê°€ - parentNodeì™€ bodyê°€ ëª¨ë‘ ì¡´ì¬í•´ì•¼ í•¨
      if (node && node.parentNode && document.body && !document.body.contains(node)) {
        try {
          node.parentNode.removeChild(node);
        } catch (e) {
          // ì´ë¯¸ ì œê±°ëœ ë…¸ë“œì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—ëŸ¬ ë¬´ì‹œ
          console.debug('Node already removed:', e);
        }
      }
    });
  }

  performCleanup() {
    // ê°•ì œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ íŠ¸ë¦¬ê±°
    if (window.gc) {
      window.gc();
    }

    // ì´ë¯¸ì§€ ìºì‹œ ì •ë¦¬
    this.clearImageCache();

    // ë¶ˆí•„ìš”í•œ íƒ€ì´ë¨¸ ì •ë¦¬
    this.clearUnusedTimers();
  }

  clearImageCache() {
    // ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ URL í•´ì œ
    const images = document.querySelectorAll('img[src^="blob:"]');
    images.forEach(img => {
      if (!img.offsetParent) { // í™”ë©´ì— ë³´ì´ì§€ ì•ŠëŠ” ì´ë¯¸ì§€
        URL.revokeObjectURL(img.src);
        img.src = '';
      }
    });
  }

  clearUnusedTimers() {
    // í™œì„± íƒ€ì´ë¨¸ ID ì¶”ì  ë° ì •ë¦¬
    if (window.activeTimers) {
      window.activeTimers.forEach(timerId => {
        clearTimeout(timerId);
        clearInterval(timerId);
      });
      window.activeTimers.clear();
    }
  }

  /**
   * 5. ê°€ìƒ ìŠ¤í¬ë¡¤ êµ¬í˜„
   */
  setupVirtualScroll(container, items, itemHeight = 50) {
    const visibleCount = Math.ceil(container.clientHeight / itemHeight);
    const totalHeight = items.length * itemHeight;

    // ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ ì„¤ì •
    container.style.overflowY = 'auto';
    container.style.position = 'relative';

    // ê°€ìƒ ë†’ì´ ì„¤ì •
    const scrollSpace = document.createElement('div');
    scrollSpace.style.height = `${totalHeight}px`;
    container.appendChild(scrollSpace);

    // ë³´ì´ëŠ” í•­ëª©ë§Œ ë Œë”ë§
    const renderVisibleItems = () => {
      const scrollTop = container.scrollTop;
      const startIndex = Math.floor(scrollTop / itemHeight);
      const endIndex = Math.min(startIndex + visibleCount + 1, items.length);

      // ê¸°ì¡´ í•­ëª© ì œê±°
      container.querySelectorAll('.virtual-item').forEach(el => el.remove());

      // ë³´ì´ëŠ” í•­ëª©ë§Œ ì¶”ê°€
      for (let i = startIndex; i < endIndex; i++) {
        const item = items[i];
        const element = this.createItemElement(item);
        element.classList.add('virtual-item');
        element.style.position = 'absolute';
        element.style.top = `${i * itemHeight}px`;
        element.style.height = `${itemHeight}px`;
        container.appendChild(element);
      }
    };

    // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ìµœì í™” (throttle)
    let scrollTimeout;
    container.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(renderVisibleItems, 16); // 60fps
    }, { passive: true });

    // ì´ˆê¸° ë Œë”ë§
    renderVisibleItems();
  }

  createItemElement(item) {
    const div = document.createElement('div');
    div.textContent = item.name || item.toString();
    return div;
  }

  /**
   * 6. ë””ë°”ìš´ì‹± & ìŠ¤ë¡œí‹€ë§
   */
  debounce(func, wait = 250) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }

  throttle(func, limit = 100) {
    let inThrottle;
    return function(...args) {
      if (!inThrottle) {
        func.apply(this, args);
        inThrottle = true;
        setTimeout(() => inThrottle = false, limit);
      }
    };
  }

  /**
   * ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë¦¬í¬íŠ¸
   */
  getPerformanceReport() {
    const report = {
      ...this.performanceStats,
      memoryUsage: performance.memory ?
        (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2) + 'MB' :
        'N/A',
      renderFPS: this.calculateFPS(),
      recommendation: this.getRecommendation()
    };

    return report;
  }

  calculateFPS() {
    // ê°„ë‹¨í•œ FPS ê³„ì‚°
    const now = performance.now();
    const elapsed = now - (this.lastFrameTime || now);
    this.lastFrameTime = now;
    return Math.round(1000 / elapsed);
  }

  getRecommendation() {
    const recommendations = [];

    if (this.performanceStats.memoryWarnings > 0) {
      recommendations.push('ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ì„ ê¶Œì¥í•©ë‹ˆë‹¤.');
    }

    if (this.performanceStats.renderCount > 1000) {
      recommendations.push('ë Œë”ë§ íšŸìˆ˜ê°€ ë§ìŠµë‹ˆë‹¤. ì‘ì—…ì„ ì €ì¥í•˜ê³  ìƒˆë¡œ ì‹œì‘í•˜ì„¸ìš”.');
    }

    return recommendations.length > 0 ? recommendations : ['ì„±ëŠ¥ ì–‘í˜¸'];
  }

  /**
   * ì´ˆê¸°í™”
   */
  initialize() {
    console.log('ğŸš€ Performance Optimizer ì´ˆê¸°í™”');

    // 1. í„°ì¹˜ ìµœì í™”
    this.optimizeTouchEvents();

    // 2. ë©”ëª¨ë¦¬ ê´€ë¦¬ ì„¤ì •
    this.setupMemoryManagement();

    // 3. ì „ì—­ í™œì„± íƒ€ì´ë¨¸ ì¶”ì 
    window.activeTimers = new Set();

    // 4. ë¡œê·¸ ë²„í¼ ì œí•œ
    window.logBuffer = [];
    const originalLog = console.log;
    console.log = (...args) => {
      window.logBuffer.push(args);
      if (window.logBuffer.length > 50) {
        window.logBuffer.shift();
      }
      originalLog.apply(console, args);
    };

    // 5. ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œì‘
    this.startMonitoring();
  }

  startMonitoring() {
    // ê°œë°œ ëª¨ë“œì—ì„œë§Œ ì„±ëŠ¥ ëª¨ë‹ˆí„° í‘œì‹œ
    if (localStorage.getItem('debug') === 'true') {
      setInterval(() => {
        const report = this.getPerformanceReport();
        console.log('ğŸ“Š Performance:', report);
      }, 10000); // 10ì´ˆë§ˆë‹¤
    }
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì´ˆê¸°í™”
window.performanceOptimizer = new PerformanceOptimizer();

// DOM ì¤€ë¹„ í›„ ì´ˆê¸°í™”
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', () => {
    window.performanceOptimizer.initialize();
  });
} else {
  window.performanceOptimizer.initialize();
}

// ê¸°ì¡´ renderAll í•¨ìˆ˜ ë˜í•‘
if (typeof window.renderAll === 'function') {
  const originalRenderAll = window.renderAll;
  window.renderAll = function(...args) {
    window.performanceOptimizer.optimizedRender(() => {
      originalRenderAll.apply(this, args);
    });
  };
}
</file>

<file path="virtual_data_claude/apps-script/Code_v65_InOut.gs">
/****************************************************
 * Poker Hand Logger - Apps Script Backend v66
 * Type ì‹œíŠ¸ ê¸°ë°˜ - IN/OUT ë‘ ê°€ì§€ ìƒíƒœë§Œ ì‚¬ìš©
 *
 * v66 ë³€ê²½ì‚¬í•­ (2025-09-18):
 * - ë²„ì „ ì—…ë°ì´íŠ¸ (virtual_data_claude í”„ë¡œì íŠ¸ êµ¬ì¡° ë³€ê²½ ëŒ€ì‘)
 * - í”„ë¡œì íŠ¸ êµ¬ì¡° ê°œì„ ì„ ìœ„í•œ ë²„ì „ ë™ê¸°í™”
 *
 * v65 ë³€ê²½ì‚¬í•­ (2025-09-18):
 * - ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ë™ê¸°í™” ê¸°ëŠ¥ ì¶”ê°€ (v3.4.20 í˜¸í™˜)
 * - Config ì‹œíŠ¸ ìë™ ìƒì„± ë° ê´€ë¦¬
 * - saveConfig/getConfig API ì•¡ì…˜ ì¶”ê°€
 * - ì „ ê¸°ê¸° ê°„ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ë™ê¸°í™” ì§€ì›
 *
 * v64 ë³€ê²½ì‚¬í•­ (2025-09-17):
 * - ì¤‘ë³µ ì œê±°ë¥¼ ì¼ê´„ ë“±ë¡ ì‹œ ìë™ ì²˜ë¦¬í•˜ë„ë¡ ì•„í‚¤í…ì²˜ ë³€ê²½
 * - batchUpdatePlayers()ì—ì„œ ì¤‘ë³µ ì œê±°ë¥¼ ë§ˆì§€ë§‰ì— ì‹¤í–‰
 * - ë³„ë„ ì¤‘ë³µ ì œê±° ë²„íŠ¼ ì œê±° (í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì²˜ë¦¬)
 *
 * v63 ë³€ê²½ì‚¬í•­:
 * - ì¤‘ë³µ í”Œë ˆì´ì–´ ê°ì§€ ë° ì œê±° ì‹œìŠ¤í…œ êµ¬í˜„
 * - removeDuplicatePlayers() í•¨ìˆ˜ ì¶”ê°€
 * - addPlayer() ë° batchUpdatePlayers()ì— ìë™ ì¤‘ë³µ ì œê±° ë¡œì§ ì¶”ê°€
 * - 'removeDuplicates' API ì•¡ì…˜ ì¶”ê°€
 * - í…Œì´ë¸”_í”Œë ˆì´ì–´ ì¡°í•©ìœ¼ë¡œ ê°•í™”ëœ ì¤‘ë³µ ê°ì§€
 *
 * v62 ë³€ê²½ì‚¬í•­:
 * - ì‚­ì œ ë¡œì§ ë””ë²„ê¹… ê°•í™” (ìƒì„¸ ë¡œê·¸ ì¶”ê°€)
 * - ì‚­ì œ ì¡°ê±´ ì™„í™” (STATUS ì¡°ê±´ ì œê±°)
 * - ì—ëŸ¬ ì²˜ë¦¬ ê°œì„  (ìƒì„¸ ì˜¤ë¥˜ ì •ë³´ ì œê³µ)
 * - ì‚­ì œ ë¡œì§ ë³€ê²½: OUT ì²˜ë¦¬ â†’ ì‹¤ì œ í–‰ ì‚­ì œ
 * - ì‚­ì œ í›„ ìë™ ì‹œíŠ¸ ì¬ì •ë ¬
 * - ì¤‘ë³µ í”Œë ˆì´ì–´ ì²˜ë¦¬ ë¡œì§ ê°œì„ 
 * - sortSheet ì´ì¤‘ í˜¸ì¶œ ë²„ê·¸ ìˆ˜ì •
 * - ì¼ê´„ ì—…ë°ì´íŠ¸ ì‹œ ìë™ ì •ë ¬
 *
 * Type ì‹œíŠ¸ êµ¬ì¡°:
 * A: Camera Preset
 * B: Player
 * C: Table
 * D: Notable
 * E: Chips
 * F: UpdatedAt
 * G: Seat
 * H: Status (IN/OUTë§Œ ì‚¬ìš©)
 ****************************************************/

const SHEET_ID = '1J-lf8bYTLPbpdhieUNdb8ckW_uwdQ3MtSBLmyRIwH7U';

// Type ì‹œíŠ¸ ì—´ ì¸ë±ìŠ¤ (0-based for array)
const TYPE_COLUMNS = {
  CAMERA: 0,      // Aì—´
  PLAYER: 1,      // Bì—´
  TABLE: 2,       // Cì—´
  NOTABLE: 3,     // Dì—´
  CHIPS: 4,       // Eì—´
  UPDATED_AT: 5,  // Fì—´
  SEAT: 6,        // Gì—´
  STATUS: 7       // Hì—´ - IN/OUTë§Œ ì‚¬ìš©
};

// Rangeìš© (1-based)
const RANGE_COLUMNS = {
  CAMERA: 1,
  PLAYER: 2,
  TABLE: 3,
  NOTABLE: 4,
  CHIPS: 5,
  UPDATED_AT: 6,
  SEAT: 7,
  STATUS: 8
};

// ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====

function _json(obj) {
  return ContentService.createTextOutput(JSON.stringify(obj))
    .setMimeType(ContentService.MimeType.JSON);
}

function _open() {
  return SpreadsheetApp.openById(SHEET_ID);
}

function _parseRequestBody(e) {
  // FormData ë°©ì‹ - e.parameterì— ì§ì ‘ ì ‘ê·¼
  if (e && e.parameter) {
    // payloadê°€ ìˆìœ¼ë©´ payload íŒŒì‹± ì‹œë„ (êµ¬ë²„ì „ í˜¸í™˜)
    if (e.parameter.payload) {
      try {
        return JSON.parse(e.parameter.payload);
      } catch (err) {
        console.error('Payload íŒŒì‹± ì‹¤íŒ¨:', err);
      }
    }
    // FormDataë¡œ ì „ì†¡ëœ ê²½ìš° parameter ì§ì ‘ ë°˜í™˜
    return e.parameter;
  }

  // JSON Body ë°©ì‹
  if (e && e.postData && e.postData.type === 'application/json') {
    try {
      return JSON.parse(e.postData.contents);
    } catch (err) {
      console.error('JSON íŒŒì‹± ì‹¤íŒ¨:', err);
    }
  }

  return {};
}

// ===== í…Œì´ë¸” ê´€ë¦¬ API =====

// í…Œì´ë¸” ëª©ë¡ ì¡°íšŒ
function getTableList() {
  try {
    const sheet = _open().getSheetByName('Type');
    if (!sheet) return {success: false, tables: []};
    
    const data = sheet.getDataRange().getValues();
    const tables = new Map();
    
    for (let i = 1; i < data.length; i++) {
      const tableName = data[i][TYPE_COLUMNS.TABLE];
      const status = data[i][TYPE_COLUMNS.STATUS] || 'IN';
      
      // IN ìƒíƒœì¸ í”Œë ˆì´ì–´ë§Œ ì¹´ìš´íŠ¸
      if (tableName && status === 'IN') {
        const count = tables.get(tableName) || 0;
        tables.set(tableName, count + 1);
      }
    }
    
    return {
      success: true,
      tables: Array.from(tables.entries()).map(([name, count]) => ({
        name: name,
        playerCount: count
      }))
    };
  } catch (error) {
    console.error('getTableList error:', error);
    return {success: false, message: error.toString(), tables: []};
  }
}

// í…Œì´ë¸”ë³„ í”Œë ˆì´ì–´ ì¡°íšŒ (IN ìƒíƒœë§Œ)
function getPlayersByTable(tableName) {
  try {
    const sheet = _open().getSheetByName('Type');
    if (!sheet) return {success: false, players: []};
    
    const data = sheet.getDataRange().getValues();
    const players = [];
    
    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      const table = row[TYPE_COLUMNS.TABLE];
      const status = row[TYPE_COLUMNS.STATUS] || 'IN';
      
      // í•´ë‹¹ í…Œì´ë¸”ì˜ IN ìƒíƒœ í”Œë ˆì´ì–´ë§Œ
      if (table === tableName && status === 'IN') {
        players.push({
          rowNumber: i + 1,
          name: row[TYPE_COLUMNS.PLAYER],
          table: table,
          notable: row[TYPE_COLUMNS.NOTABLE] === true || row[TYPE_COLUMNS.NOTABLE] === 'TRUE',
          chips: row[TYPE_COLUMNS.CHIPS] || 0,
          seat: row[TYPE_COLUMNS.SEAT] || null,
          status: status,
          updatedAt: row[TYPE_COLUMNS.UPDATED_AT]
        });
      }
    }
    
    // ì¢Œì„ ë²ˆí˜¸ìˆœ ì •ë ¬
    players.sort((a, b) => (a.seat || 99) - (b.seat || 99));
    
    return {success: true, players};
  } catch (error) {
    console.error('getPlayersByTable error:', error);
    return {success: false, message: error.toString(), players: []};
  }
}

// í”Œë ˆì´ì–´ ì¶”ê°€/ìˆ˜ì •
function upsertPlayer(playerData) {
  try {
    const sheet = _open().getSheetByName('Type');
    if (!sheet) return {success: false, message: 'Type ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};
    
    const data = sheet.getDataRange().getValues();
    
    // ì¢Œì„ ì¤‘ë³µ ì²´í¬ (ê°™ì€ í…Œì´ë¸”, ê°™ì€ ì¢Œì„, IN ìƒíƒœ)
    if (playerData.seat) {
      for (let i = 1; i < data.length; i++) {
        if (data[i][TYPE_COLUMNS.TABLE] === playerData.table &&
            data[i][TYPE_COLUMNS.SEAT] === playerData.seat &&
            data[i][TYPE_COLUMNS.STATUS] === 'IN' &&
            data[i][TYPE_COLUMNS.PLAYER] !== playerData.name) {
          return {success: false, message: `ì¢Œì„ ${playerData.seat}ë²ˆì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤`};
        }
      }
    }
    
    // ê¸°ì¡´ í”Œë ˆì´ì–´ ì°¾ê¸° (ê°™ì€ ì´ë¦„, ê°™ì€ í…Œì´ë¸”, IN ìƒíƒœ)
    let targetRow = -1;
    for (let i = 1; i < data.length; i++) {
      if (data[i][TYPE_COLUMNS.PLAYER] === playerData.name && 
          data[i][TYPE_COLUMNS.TABLE] === playerData.table &&
          data[i][TYPE_COLUMNS.STATUS] === 'IN') {
        targetRow = i + 1;
        break;
      }
    }
    
    const now = new Date();
    
    if (targetRow === -1) {
      // OUT ìƒíƒœì˜ ê¸°ì¡´ ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
      let outRow = -1;
      for (let i = 1; i < data.length; i++) {
        if (data[i][TYPE_COLUMNS.TABLE] === playerData.table &&
            data[i][TYPE_COLUMNS.STATUS] === 'OUT') {
          outRow = i + 1;
          break;
        }
      }
      
      if (outRow !== -1) {
        // OUT ìƒíƒœ í–‰ì„ ì¬ì‚¬ìš©
        sheet.getRange(outRow, RANGE_COLUMNS.PLAYER).setValue(playerData.name);
        sheet.getRange(outRow, RANGE_COLUMNS.NOTABLE).setValue(playerData.notable ? 'TRUE' : 'FALSE');
        sheet.getRange(outRow, RANGE_COLUMNS.CHIPS).setValue(playerData.chips || 0);
        sheet.getRange(outRow, RANGE_COLUMNS.SEAT).setValue(playerData.seat || '');
        sheet.getRange(outRow, RANGE_COLUMNS.STATUS).setValue('IN');
        sheet.getRange(outRow, RANGE_COLUMNS.UPDATED_AT).setValue(now);
        
        return {success: true, action: 'reused', row: outRow};
      } else {
        // ìƒˆ í–‰ ì¶”ê°€
        const newRow = new Array(8);
        newRow[TYPE_COLUMNS.CAMERA] = '';
        newRow[TYPE_COLUMNS.PLAYER] = playerData.name;
        newRow[TYPE_COLUMNS.TABLE] = playerData.table;
        newRow[TYPE_COLUMNS.NOTABLE] = playerData.notable ? 'TRUE' : 'FALSE';
        newRow[TYPE_COLUMNS.CHIPS] = playerData.chips || 0;
        newRow[TYPE_COLUMNS.UPDATED_AT] = now;
        newRow[TYPE_COLUMNS.SEAT] = playerData.seat || '';
        newRow[TYPE_COLUMNS.STATUS] = 'IN';
        
        sheet.appendRow(newRow);
        return {success: true, action: 'created', row: sheet.getLastRow()};
      }
      
    } else {
      // ê¸°ì¡´ í”Œë ˆì´ì–´ ìˆ˜ì •
      if (playerData.chips !== undefined) {
        sheet.getRange(targetRow, RANGE_COLUMNS.CHIPS).setValue(playerData.chips);
      }
      if (playerData.seat !== undefined) {
        sheet.getRange(targetRow, RANGE_COLUMNS.SEAT).setValue(playerData.seat);
      }
      if (playerData.notable !== undefined) {
        sheet.getRange(targetRow, RANGE_COLUMNS.NOTABLE)
          .setValue(playerData.notable ? 'TRUE' : 'FALSE');
      }
      
      // UpdatedAt ê°±ì‹ 
      sheet.getRange(targetRow, RANGE_COLUMNS.UPDATED_AT).setValue(now);
      
      return {success: true, action: 'updated', row: targetRow};
    }
  } catch (error) {
    console.error('upsertPlayer error:', error);
    return {success: false, message: error.toString()};
  }
}

// í”Œë ˆì´ì–´ OUT ì²˜ë¦¬ (ìºì‹œì•„ì›ƒ)
function cashOutPlayer(playerName, tableName, finalChips) {
  try {
    const sheet = _open().getSheetByName('Type');
    const data = sheet.getDataRange().getValues();
    
    for (let i = 1; i < data.length; i++) {
      if (data[i][TYPE_COLUMNS.PLAYER] === playerName && 
          data[i][TYPE_COLUMNS.TABLE] === tableName &&
          data[i][TYPE_COLUMNS.STATUS] === 'IN') {
        const row = i + 1;
        
        // ìµœì¢… ì¹© ì—…ë°ì´íŠ¸
        if (finalChips !== undefined) {
          sheet.getRange(row, RANGE_COLUMNS.CHIPS).setValue(finalChips);
        }
        
        // Statusë¥¼ OUTìœ¼ë¡œ ë³€ê²½
        sheet.getRange(row, RANGE_COLUMNS.STATUS).setValue('OUT');
        sheet.getRange(row, RANGE_COLUMNS.UPDATED_AT).setValue(new Date());
        
        // ì¢Œì„ ë¹„ìš°ê¸° (ì„ íƒì‚¬í•­)
        // sheet.getRange(row, RANGE_COLUMNS.SEAT).setValue('');
        
        return {success: true, message: `${playerName} ìºì‹œì•„ì›ƒ ì™„ë£Œ`};
      }
    }
    
    return {success: false, message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};
  } catch (error) {
    console.error('cashOutPlayer error:', error);
    return {success: false, message: error.toString()};
  }
}

// ì¤‘ë³µ í”Œë ˆì´ì–´ ê°ì§€ ë° ì œê±° í•¨ìˆ˜
function removeDuplicatePlayers() {
  try {
    const sheet = _open().getSheetByName('Type');
    if (!sheet) return {success: false, message: 'Type ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};

    const data = sheet.getDataRange().getValues();
    const seenPlayers = new Map(); // table_player ì¡°í•©ìœ¼ë¡œ ì¤‘ë³µ ì²´í¬
    const duplicateRows = [];

    console.log('[v3.2.8] ì¤‘ë³µ í”Œë ˆì´ì–´ ê°ì§€ ì‹œì‘...');

    // ì¤‘ë³µ í”Œë ˆì´ì–´ ì°¾ê¸° (í—¤ë” ì œì™¸í•˜ê³  ì‹œì‘)
    for (let i = 1; i < data.length; i++) {
      const playerName = data[i][TYPE_COLUMNS.PLAYER];
      const tableName = data[i][TYPE_COLUMNS.TABLE];
      const status = data[i][TYPE_COLUMNS.STATUS];

      // IN ìƒíƒœ í”Œë ˆì´ì–´ë§Œ ì²´í¬
      if (status === 'IN' && playerName && tableName) {
        const key = `${tableName}_${playerName}`;

        if (seenPlayers.has(key)) {
          // ì¤‘ë³µ ë°œê²¬ - ë‚˜ì¤‘ í–‰ì„ ì‚­ì œ ëŒ€ìƒìœ¼ë¡œ í‘œì‹œ
          duplicateRows.push(i + 1); // 1-based row number
          console.log(`[v3.2.8] ì¤‘ë³µ í”Œë ˆì´ì–´ ë°œê²¬: ${playerName} (í…Œì´ë¸”: ${tableName}) - í–‰ ${i + 1} ì‚­ì œ ì˜ˆì •`);
        } else {
          seenPlayers.set(key, i + 1); // ì²« ë²ˆì§¸ ë°œê²¬ëœ í–‰ ì €ì¥
        }
      }
    }

    // ì¤‘ë³µ í–‰ ì‚­ì œ (ì—­ìˆœìœ¼ë¡œ ì‚­ì œí•´ì•¼ í–‰ ë²ˆí˜¸ê°€ ì•ˆ ê¼¬ì„)
    if (duplicateRows.length > 0) {
      duplicateRows.sort((a, b) => b - a); // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬

      for (const rowNum of duplicateRows) {
        console.log(`[v3.2.8] ì¤‘ë³µ í–‰ ì‚­ì œ: ${rowNum}`);
        sheet.deleteRow(rowNum);
      }

      console.log(`[v3.2.8] ì¤‘ë³µ í”Œë ˆì´ì–´ ${duplicateRows.length}ê°œ ì‚­ì œ ì™„ë£Œ`);
      return {success: true, message: `ì¤‘ë³µ í”Œë ˆì´ì–´ ${duplicateRows.length}ê°œ ì œê±°ë¨`};
    } else {
      console.log('[v3.2.8] ì¤‘ë³µ í”Œë ˆì´ì–´ ì—†ìŒ');
      return {success: true, message: 'ì¤‘ë³µ í”Œë ˆì´ì–´ ì—†ìŒ'};
    }

  } catch (error) {
    console.error('[v3.2.8] removeDuplicatePlayers error:', error);
    return {success: false, message: error.toString()};
  }
}

// í”Œë ˆì´ì–´ ì¶”ê°€ (ìƒˆë¡œìš´ í•¨ìˆ˜) - ì¤‘ë³µ ì²´í¬ ê°•í™”
function addPlayer(playerData) {
  try {
    const sheet = _open().getSheetByName('Type');
    if (!sheet) return {success: false, message: 'Type ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};

    const data = sheet.getDataRange().getValues();

    // ì¢Œì„ ì¤‘ë³µ ì²´í¬
    if (playerData.seat) {
      for (let i = 1; i < data.length; i++) {
        if (data[i][TYPE_COLUMNS.TABLE] === playerData.table &&
            data[i][TYPE_COLUMNS.SEAT] === playerData.seat &&
            data[i][TYPE_COLUMNS.STATUS] === 'IN') {
          return {success: false, message: `ì¢Œì„ ${playerData.seat}ë²ˆì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤`};
        }
      }
    }

    // ê°™ì€ ì´ë¦„ì˜ í”Œë ˆì´ì–´ê°€ ì´ë¯¸ ìˆëŠ”ì§€ ì²´í¬ (ê°•í™”ëœ ê²€ì‚¬)
    for (let i = 1; i < data.length; i++) {
      if (data[i][TYPE_COLUMNS.PLAYER] === playerData.name &&
          data[i][TYPE_COLUMNS.TABLE] === playerData.table &&
          data[i][TYPE_COLUMNS.STATUS] === 'IN') {
        console.log(`[v3.2.8] ì¤‘ë³µ í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œë„ ì°¨ë‹¨: ${playerData.name} (í…Œì´ë¸”: ${playerData.table})`);
        return {success: false, message: 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”Œë ˆì´ì–´ì…ë‹ˆë‹¤'};
      }
    }

    // ìƒˆ í–‰ ì¶”ê°€
    const newRow = sheet.getLastRow() + 1;
    sheet.getRange(newRow, RANGE_COLUMNS.CAMERA).setValue('');
    sheet.getRange(newRow, RANGE_COLUMNS.PLAYER).setValue(playerData.name);
    sheet.getRange(newRow, RANGE_COLUMNS.TABLE).setValue(playerData.table);
    sheet.getRange(newRow, RANGE_COLUMNS.NOTABLE).setValue('FALSE');
    sheet.getRange(newRow, RANGE_COLUMNS.CHIPS).setValue(playerData.chips || 0);
    sheet.getRange(newRow, RANGE_COLUMNS.UPDATED_AT).setValue(new Date());
    sheet.getRange(newRow, RANGE_COLUMNS.SEAT).setValue(playerData.seat || '');
    sheet.getRange(newRow, RANGE_COLUMNS.STATUS).setValue(playerData.status || 'IN');

    // ì¶”ê°€ ì™„ë£Œ í›„ ì¤‘ë³µ ì œê±°
    const cleanupResult = removeDuplicatePlayers();
    console.log('[v3.2.9] í”Œë ˆì´ì–´ ì¶”ê°€ í›„ ì¤‘ë³µ ì •ë¦¬:', cleanupResult);

    return {
      success: true,
      message: `í”Œë ˆì´ì–´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤${cleanupResult.success && cleanupResult.message.includes('ê°œ') ? ' (ì¤‘ë³µ ' + cleanupResult.message + ' ì œê±°ë¨)' : ''}`
    };
  } catch (error) {
    console.error('addPlayer error:', error);
    return {success: false, message: error.toString()};
  }
}

// í”Œë ˆì´ì–´ ì¢Œì„ ì—…ë°ì´íŠ¸
function updatePlayerSeat(playerName, tableName, newSeat) {
  try {
    const sheet = _open().getSheetByName('Type');
    const data = sheet.getDataRange().getValues();

    // ì¢Œì„ ì¤‘ë³µ ì²´í¬ (ìƒˆ ì¢Œì„ì´ ìˆì„ ê²½ìš°)
    if (newSeat) {
      for (let i = 1; i < data.length; i++) {
        if (data[i][TYPE_COLUMNS.TABLE] === tableName &&
            data[i][TYPE_COLUMNS.SEAT] === newSeat &&
            data[i][TYPE_COLUMNS.STATUS] === 'IN' &&
            data[i][TYPE_COLUMNS.PLAYER] !== playerName) {
          return {success: false, message: `ì¢Œì„ ${newSeat}ë²ˆì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤`};
        }
      }
    }

    // í”Œë ˆì´ì–´ ì°¾ê¸°
    for (let i = 1; i < data.length; i++) {
      if (data[i][TYPE_COLUMNS.PLAYER] === playerName &&
          data[i][TYPE_COLUMNS.TABLE] === tableName &&
          data[i][TYPE_COLUMNS.STATUS] === 'IN') {
        const row = i + 1;
        sheet.getRange(row, RANGE_COLUMNS.SEAT).setValue(newSeat || '');
        sheet.getRange(row, RANGE_COLUMNS.UPDATED_AT).setValue(new Date());
        return {success: true, message: 'ì¢Œì„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤'};
      }
    }

    return {success: false, message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};
  } catch (error) {
    console.error('updatePlayerSeat error:', error);
    return {success: false, message: error.toString()};
  }
}

// í”Œë ˆì´ì–´ ì¹© ì—…ë°ì´íŠ¸
function updatePlayerChips(playerName, tableName, newChips) {
  try {
    const sheet = _open().getSheetByName('Type');
    const data = sheet.getDataRange().getValues();

    // í”Œë ˆì´ì–´ ì°¾ê¸°
    for (let i = 1; i < data.length; i++) {
      if (data[i][TYPE_COLUMNS.PLAYER] === playerName &&
          data[i][TYPE_COLUMNS.TABLE] === tableName &&
          data[i][TYPE_COLUMNS.STATUS] === 'IN') {
        const row = i + 1;
        sheet.getRange(row, RANGE_COLUMNS.CHIPS).setValue(newChips || 0);
        sheet.getRange(row, RANGE_COLUMNS.UPDATED_AT).setValue(new Date());
        return {success: true, message: 'ì¹©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤'};
      }
    }

    return {success: false, message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};
  } catch (error) {
    console.error('updatePlayerChips error:', error);
    return {success: false, message: error.toString()};
  }
}

// ì¼ê´„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ - ë§ˆì§€ë§‰ì— ì¤‘ë³µ ì œê±°
function batchUpdatePlayers(tableName, playersJson, deletedJson) {
  try {
    const sheet = _open().getSheetByName('Type');
    const players = typeof playersJson === 'string' ? JSON.parse(playersJson) : playersJson;
    const deleted = typeof deletedJson === 'string' ? JSON.parse(deletedJson) : deletedJson;

    console.log(`[v3.2.9 batchUpdate ì‹œì‘] í…Œì´ë¸”: ${tableName}`);
    console.log(`[v3.2.9 batchUpdate] í”Œë ˆì´ì–´: ${JSON.stringify(players)}`);
    console.log(`[v3.2.9 batchUpdate] ì‚­ì œ ëŒ€ìƒ: ${JSON.stringify(deleted)}`);

    if (!sheet) return {success: false, message: 'Type ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};

    const data = sheet.getDataRange().getValues();
    const now = new Date();
    const rowsToDelete = [];

    console.log(`[ì‹œíŠ¸ ë°ì´í„°] ì´ ${data.length}ê°œ í–‰`);

    // 1. ì‚­ì œ ì²˜ë¦¬ - ì‹¤ì œ í–‰ ì‚­ì œ (ì¡°ê±´ ì™„í™”)
    for (const playerName of deleted) {
      console.log(`[ì‚­ì œ ê²€ìƒ‰] ${playerName} in ${tableName}`);

      for (let i = 1; i < data.length; i++) {
        const rowData = data[i];
        const rowPlayer = rowData[TYPE_COLUMNS.PLAYER];
        const rowTable = rowData[TYPE_COLUMNS.TABLE];
        const rowStatus = rowData[TYPE_COLUMNS.STATUS];

        console.log(`[ì‚­ì œ ë¹„êµ] Row ${i + 1}: ${rowPlayer} | ${rowTable} | ${rowStatus}`);

        // ì¡°ê±´ ì™„í™”: ì´ë¦„ê³¼ í…Œì´ë¸”ë§Œ ë§¤ì¹­ (STATUS ì¡°ê±´ ì œê±°)
        if (rowPlayer === playerName && rowTable === tableName) {
          rowsToDelete.push(i + 1); // 1-based row number
          console.log(`[ì‚­ì œ ëŒ€ìƒ ì„ ì •] ${playerName} - Row ${i + 1}`);
          break;
        }
      }
    }

    // ì‚­ì œí•  í–‰ë“¤ì„ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì‚­ì œ (ì¸ë±ìŠ¤ ë³€ê²½ ë°©ì§€)
    rowsToDelete.sort((a, b) => b - a);

    for (const rowIndex of rowsToDelete) {
      console.log(`[í–‰ ì‚­ì œ] Row ${rowIndex}`);
      sheet.deleteRow(rowIndex);
    }

    console.log(`[ì‚­ì œ ì™„ë£Œ] ${rowsToDelete.length}ê°œ í–‰ ì‚­ì œë¨`);

    // ë°ì´í„° ì¬ë¡œë“œ (ì‚­ì œ í›„)
    const updatedData = sheet.getDataRange().getValues();

    // 2. ì—…ë°ì´íŠ¸ ë° ì¶”ê°€ ì²˜ë¦¬
    for (const player of players) {
      let found = false;

      // ê¸°ì¡´ í”Œë ˆì´ì–´ ì°¾ê¸° (ì—…ë°ì´íŠ¸ëœ ë°ì´í„° ì‚¬ìš©)
      for (let i = 1; i < updatedData.length; i++) {
        if (updatedData[i][TYPE_COLUMNS.PLAYER] === player.name &&
            updatedData[i][TYPE_COLUMNS.TABLE] === tableName &&
            updatedData[i][TYPE_COLUMNS.STATUS] === 'IN') {
          // ì—…ë°ì´íŠ¸
          const row = i + 1;
          sheet.getRange(row, RANGE_COLUMNS.SEAT).setValue(player.seat || '');
          sheet.getRange(row, RANGE_COLUMNS.CHIPS).setValue(player.chips || 0);
          sheet.getRange(row, RANGE_COLUMNS.UPDATED_AT).setValue(now);
          console.log(`[ì—…ë°ì´íŠ¸] ${player.name} - Row ${row}`);
          found = true;
          break;
        }
      }

      // ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€
      if (!found) {
        const newRow = sheet.getLastRow() + 1;
        sheet.getRange(newRow, RANGE_COLUMNS.CAMERA).setValue('');
        sheet.getRange(newRow, RANGE_COLUMNS.PLAYER).setValue(player.name);
        sheet.getRange(newRow, RANGE_COLUMNS.TABLE).setValue(tableName);
        sheet.getRange(newRow, RANGE_COLUMNS.NOTABLE).setValue(player.notable ? 'TRUE' : 'FALSE');
        sheet.getRange(newRow, RANGE_COLUMNS.CHIPS).setValue(player.chips || 0);
        sheet.getRange(newRow, RANGE_COLUMNS.UPDATED_AT).setValue(now);
        sheet.getRange(newRow, RANGE_COLUMNS.SEAT).setValue(player.seat || '');
        sheet.getRange(newRow, RANGE_COLUMNS.STATUS).setValue('IN');
        console.log(`[ì¶”ê°€] ${player.name} - Row ${newRow}`);
      }
    }

    // 3. ì‹œíŠ¸ ì •ë ¬ ìˆ˜í–‰
    const sortResult = sortTypeSheet();
    console.log(`[ì •ë ¬ ê²°ê³¼] ${sortResult ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);

    // 4. ë§ˆì§€ë§‰ì— ì¤‘ë³µ í”Œë ˆì´ì–´ ì œê±°
    const cleanupResult = removeDuplicatePlayers();
    console.log('[v3.2.9 batchUpdate] ë§ˆì§€ë§‰ ì¤‘ë³µ ì œê±° ê²°ê³¼:', cleanupResult);

    const result = {
      success: true,
      message: 'ì¼ê´„ ì—…ë°ì´íŠ¸, ì‚­ì œ, ì •ë ¬ ë° ì¤‘ë³µ ì œê±° ì™„ë£Œ',
      processed: {
        updated: players.length,
        deleted: deleted.length,
        deletedRows: rowsToDelete.length,
        duplicatesRemoved: cleanupResult.success ? (cleanupResult.message.includes('ê°œ') ? cleanupResult.message : '0ê°œ') : 'ì‹¤íŒ¨'
      }
    };

    console.log(`[batchUpdate ì™„ë£Œ] ${JSON.stringify(result)}`);
    return result;
  } catch (error) {
    console.error(`[batchUpdate ì˜¤ë¥˜] ${error.toString()}`);
    console.error(`[batchUpdate ì˜¤ë¥˜] Stack: ${error.stack}`);
    return {
      success: false,
      message: `ì˜¤ë¥˜: ${error.toString()}`,
      error: {
        name: error.name,
        message: error.message,
        stack: error.stack
      }
    };
  }
}

// Type ì‹œíŠ¸ ì •ë ¬ í•¨ìˆ˜
function sortTypeSheet() {
  try {
    const sheet = _open().getSheetByName('Type');
    if (!sheet) return false;

    const lastRow = sheet.getLastRow();
    const lastCol = sheet.getLastColumn();

    // í—¤ë” í–‰ì„ ì œì™¸í•œ ë°ì´í„° ë²”ìœ„
    if (lastRow > 1) {
      const range = sheet.getRange(2, 1, lastRow - 1, lastCol);

      // ì •ë ¬ ê¸°ì¤€:
      // 1ìˆœìœ„: Table (Cì—´ = 3) - ì˜¤ë¦„ì°¨ìˆœ
      // 2ìˆœìœ„: Seat (Gì—´ = 7) - ì˜¤ë¦„ì°¨ìˆœ

      range.sort([
        {column: 3, ascending: true},  // Table: ì˜¤ë¦„ì°¨ìˆœ
        {column: 7, ascending: true}   // Seat: ì˜¤ë¦„ì°¨ìˆœ
      ]);
    }

    return true;
  } catch (error) {
    console.error('sortTypeSheet error:', error);
    return false;
  }
}

// í”Œë ˆì´ì–´ ì‚­ì œ (í–‰ ìì²´ë¥¼ ì‚­ì œ)
function deletePlayer(playerName, tableName) {
  try {
    const sheet = _open().getSheetByName('Type');
    const data = sheet.getDataRange().getValues();

    for (let i = data.length - 1; i >= 1; i--) {
      if (data[i][TYPE_COLUMNS.PLAYER] === playerName &&
          data[i][TYPE_COLUMNS.TABLE] === tableName) {
        sheet.deleteRow(i + 1);
        return {success: true, message: `${playerName} ì‚­ì œ ì™„ë£Œ`};
      }
    }

    return {success: false, message: 'í”Œë ˆì´ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'};
  } catch (error) {
    console.error('deletePlayer error:', error);
    return {success: false, message: error.toString()};
  }
}

// ===== ê¸°ì¡´ v56 í•¸ë“œ í¸ì§‘ ê¸°ëŠ¥ ìœ ì§€ =====

function updateHandEditStatus(handNumber, checked) {
  try {
    const spreadsheet = _open();
    const indexSheet = spreadsheet.getSheetByName('Index');
    
    if (!indexSheet) {
      throw new Error('Index ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    }
    
    const data = indexSheet.getDataRange().getValues();
    
    for (let i = 1; i < data.length; i++) {
      if (String(data[i][0]) === String(handNumber)) {
        indexSheet.getRange(i + 1, 5).setValue(checked ? 'TRUE' : 'FALSE');
        indexSheet.getRange(i + 1, 6).setValue(new Date());
        
        return {
          success: true,
          handNumber: handNumber,
          checked: checked,
          updatedAt: new Date().toISOString()
        };
      }
    }
    
    throw new Error(`í•¸ë“œ #${handNumber}ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
    
  } catch (error) {
    console.error('updateHandEditStatus ì˜¤ë¥˜:', error);
    return {
      success: false,
      message: error.message
    };
  }
}

// ===== ê¸°ì¡´ í•¸ë“œ ì €ì¥ í•¨ìˆ˜ë“¤ (v56 ìœ ì§€) =====

function _padRows(rows) {
  let maxCols = 0;
  for (const row of rows) {
    maxCols = Math.max(maxCols, (row || []).length);
  }
  
  return rows.map(row => {
    const arr = (row || []).slice();
    while (arr.length < maxCols) {
      arr.push('');
    }
    return arr;
  });
}

function _normalizeEventRows(rows) {
  if (!Array.isArray(rows)) return rows;
  
  const output = [];
  const SIMPLE_EVENTS = {
    'FOLDS': 'FOLD',
    'CHECKS': 'CHECK',
    'CALLS': 'CALL',
    'BETS': 'BET'
  };
  
  for (const row of rows) {
    const r = (row || []).slice();
    
    if (r[1] === 'EVENT') {
      let eventType = String(r[2] || '').trim().toUpperCase();
      
      if (/^(RAISE|RAISES|RAISE TO|RAIES)$/.test(eventType)) {
        eventType = 'RAISE TO';
      }
      else if (SIMPLE_EVENTS[eventType]) {
        eventType = SIMPLE_EVENTS[eventType];
      }
      
      r[2] = eventType;
    }
    
    output.push(r);
  }
  
  return output;
}

function _ensureIndexHeader(sheet) {
  const fullHeaderRow = [
    'handNumber', 'startRow', 'endRow', 'handUpdatedAt', 
    'handEdit', 'handEditTime', 'label', 'table', 
    'tableUpdatedAt', 'Cam', 'CamFile01name', 'CamFile01number',
    'CamFile02name', 'CamFile02number',
    'lastStreet', 'lastAction', 'workStatus', 'winners'
  ];
  
  if (sheet.getLastRow() < 1) {
    sheet.getRange(1, 1, 1, fullHeaderRow.length).setValues([fullHeaderRow]);
  } else {
    const lastCol = sheet.getLastColumn();
    if (lastCol < 18) {  // 17ì—ì„œ 18ë¡œ ë³€ê²½ (winners ì—´ ì¶”ê°€)
      sheet.getRange(1, 1, 1, fullHeaderRow.length).setValues([fullHeaderRow]);
    }
  }
}

// ===== ë©”ì¸ í•¸ë“¤ëŸ¬ =====

function doGet(e) {
  return _json({
    status: 'ok',
    method: 'GET',
    time: new Date().toISOString(),
    version: 'v66-inout-config'
  });
}

function doPost(e) {
  try {
    const body = _parseRequestBody(e) || {};

    // ì•¡ì…˜ ê¸°ë°˜ ë¼ìš°íŒ…
    if (body.action) {
      switch(body.action) {
        // í…Œì´ë¸” ê´€ë¦¬
        case 'getTableList':
          return _json(getTableList());

        // í”Œë ˆì´ì–´ ê´€ë¦¬
        case 'getPlayersByTable':
          return _json(getPlayersByTable(body.tableName));

        case 'upsertPlayer':
          return _json(upsertPlayer(body.playerData));

        case 'cashOutPlayer':
          return _json(cashOutPlayer(body.playerName, body.tableName, body.finalChips));

        case 'deletePlayer':
          return _json(deletePlayer(body.player, body.table));

        case 'addPlayer':
          return _json(addPlayer({
            name: body.player,
            table: body.table,
            seat: body.seat,
            chips: body.chips,
            status: body.status || 'IN'
          }));

        case 'updateSeat':
          return _json(updatePlayerSeat(body.player, body.table, body.seat));

        case 'updateChips':
          return _json(updatePlayerChips(body.player, body.table, body.chips));

        case 'batchUpdate':
          return _json(batchUpdatePlayers(body.table, body.players, body.deleted));

        case 'sortSheet':
          const sortResult = sortTypeSheet();
          return _json({
            success: sortResult,
            message: sortResult ? 'ì‹œíŠ¸ ì •ë ¬ ì™„ë£Œ' : 'ì •ë ¬ ì‹¤íŒ¨'
          });

        case 'removeDuplicates':
          return _json(removeDuplicatePlayers());

        // ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ë™ê¸°í™” ê¸°ëŠ¥ (v3.4.20)
        case 'saveConfig':
          return _json(saveConfigToSheet(body.configType, body.value));

        case 'getConfig':
          return _json(getConfigFromSheet(body.configType));

        // v56 ê¸°ëŠ¥
        case 'updateHandEdit':
          return _json(updateHandEditStatus(body.handNumber, body.checked));
        
        default:
          return _json({
            success: false,
            message: 'Unknown action: ' + body.action
          });
      }
    }
    
    // ê¸°ì¡´ í•¸ë“œ ì €ì¥ ë¡œì§ (actionì´ ì—†ëŠ” ê²½ìš°)
    const rowsInput = body.rows;
    const indexMeta = body.indexMeta || {};
    const typeUpdates = Array.isArray(body.typeUpdates) ? body.typeUpdates : [];
    
    if (!Array.isArray(rowsInput) || !rowsInput.length) {
      return _json({
        status: 'error',
        message: 'rows ë°ì´í„°ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.'
      });
    }
    
    const rows = _padRows(_normalizeEventRows(rowsInput));
    
    let handNumber = '';
    for (const row of rows) {
      if (row[1] === 'HAND') {
        handNumber = String(row[2] || '');
        break;
      }
    }
    
    const spreadsheet = _open();
    const handSheet = spreadsheet.getSheetByName('Hand') || spreadsheet.insertSheet('Hand');
    const indexSheet = spreadsheet.getSheetByName('Index') || spreadsheet.insertSheet('Index');
    const typeSheet = spreadsheet.getSheetByName('Type') || spreadsheet.insertSheet('Type');
    
    // Hand ì‹œíŠ¸ì— ë°ì´í„° ê¸°ë¡
    const startRow = handSheet.getLastRow() + 1;
    handSheet.getRange(startRow, 1, rows.length, rows[0].length).setValues(rows);
    const endRow = startRow + rows.length - 1;
    
    // Index ì‹œíŠ¸ ì—…ë°ì´íŠ¸
    _ensureIndexHeader(indexSheet);
    
    // ì¤‘ë³µ ì²´í¬
    const existingData = indexSheet.getDataRange().getValues();
    for (let i = 1; i < existingData.length; i++) {
      if (String(existingData[i][0]) === String(handNumber)) {
        return _json({
          status: 'duplicate',
          message: `í•¸ë“œ #${handNumber}ëŠ” ì´ë¯¸ ê¸°ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤`,
          handNumber: handNumber,
          existingRow: i + 1
        });
      }
    }
    
    const rawDate = indexMeta.handUpdatedAt || new Date().toISOString();
    const updatedAt = String(rawDate).split('T')[0];
    const editTime = new Date();
    
    const indexData = [
      handNumber || String(indexMeta.handNumber || ''),
      startRow,
      endRow,
      updatedAt,
      '',
      editTime,
      indexMeta.label || '',
      indexMeta.table || '',
      indexMeta.tableUpdatedAt || updatedAt,
      indexMeta.cam || '',
      indexMeta.camFile01name || '',
      indexMeta.camFile01number || '',
      indexMeta.camFile02name || '',
      indexMeta.camFile02number || '',
      indexMeta.lastStreet || 'preflop',
      indexMeta.lastAction || '',
      indexMeta.workStatus || 'ì§„í–‰ì¤‘',
      indexMeta.winners || ''  // Rì—´: ìŠ¹ì ì •ë³´ ì¶”ê°€
    ];
    
    indexSheet.appendRow(indexData);
    
    // Type ì‹œíŠ¸ ì—…ë°ì´íŠ¸ (ì¹© ì •ë³´)
    if (typeUpdates.length > 0) {
      const typeData = typeSheet.getDataRange().getValues();
      
      typeUpdates.forEach(update => {
        // Type ì‹œíŠ¸ì—ì„œ í”Œë ˆì´ì–´ ì°¾ê¸° (Playerì™€ Table ë§¤ì¹­)
        const rowIndex = typeData.findIndex((row, idx) => {
          return idx > 0 && 
                 row[TYPE_COLUMNS.PLAYER] === update.player && 
                 row[TYPE_COLUMNS.TABLE] === update.table;
        });
        
        if (rowIndex > 0) {
          // ì¹© ì—…ë°ì´íŠ¸ (Eì—´)
          typeSheet.getRange(rowIndex + 1, RANGE_COLUMNS.CHIPS).setValue(update.chips || 0);
          // UpdatedAt ì—…ë°ì´íŠ¸ (Fì—´)
          const updateTime = update.updatedAt ? new Date(update.updatedAt) : new Date();
          typeSheet.getRange(rowIndex + 1, RANGE_COLUMNS.UPDATED_AT).setValue(updateTime);
          
          // Statusê°€ OUTì¸ ê²½ìš° INìœ¼ë¡œ ë³€ê²½ (í”Œë ˆì´ì–´ê°€ ë‹¤ì‹œ í™œë™ ì¤‘)
          const currentStatus = typeData[rowIndex][TYPE_COLUMNS.STATUS];
          if (currentStatus === 'OUT' || !currentStatus) {
            typeSheet.getRange(rowIndex + 1, RANGE_COLUMNS.STATUS).setValue('IN');
          }
          
          console.log(`Type ì‹œíŠ¸ ì—…ë°ì´íŠ¸: ${update.player} - ${update.chips} ì¹©`);
        } else {
          // í”Œë ˆì´ì–´ê°€ Type ì‹œíŠ¸ì— ì—†ëŠ” ê²½ìš° ìƒˆë¡œ ì¶”ê°€
          console.log(`Type ì‹œíŠ¸ì— ${update.player} ì¶”ê°€`);
          const newRow = new Array(8);
          newRow[TYPE_COLUMNS.CAMERA] = '';
          newRow[TYPE_COLUMNS.PLAYER] = update.player;
          newRow[TYPE_COLUMNS.TABLE] = update.table;
          newRow[TYPE_COLUMNS.NOTABLE] = 'FALSE';
          newRow[TYPE_COLUMNS.CHIPS] = update.chips || 0;
          newRow[TYPE_COLUMNS.UPDATED_AT] = new Date();
          newRow[TYPE_COLUMNS.SEAT] = '';
          newRow[TYPE_COLUMNS.STATUS] = 'IN';
          
          typeSheet.appendRow(newRow);
        }
      });
    }
    
    return _json({
      status: 'success',
      handNumber: handNumber || indexMeta.handNumber || '',
      rowsAdded: rows.length,
      startRow: startRow,
      endRow: endRow,
      updatedAt: updatedAt,
      version: 'v66-inout-config'
    });
    
  } catch (error) {
    console.error('Error in doPost:', error);
    return _json({
      status: 'error',
      message: error.toString()
    });
  }
}

// ===== ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ë™ê¸°í™” í•¨ìˆ˜ (v3.4.20) =====

// Config ì‹œíŠ¸ ê´€ë¦¬ í•¨ìˆ˜
function getConfigSheet() {
  const ss = SpreadsheetApp.openById(SHEET_ID);
  let configSheet = ss.getSheetByName('Config');

  if (!configSheet) {
    console.warn('[Config] Config ì‹œíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. initializeConfigSheet()ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.');
    return null;
  }

  return configSheet;
}

// Config ì €ì¥ í•¨ìˆ˜
function saveConfigToSheet(configType, value) {
  try {
    console.log(`[Config] ì„¤ì • ì €ì¥ ì‹œì‘: ${configType} = ${value}`);

    const sheet = getConfigSheet();
    const data = sheet.getDataRange().getValues();

    // ê¸°ì¡´ ì„¤ì • ì°¾ê¸° (A3ë¶€í„° ì‹œì‘, A2ëŠ” í—¤ë”)
    let found = false;
    for (let i = 2; i < data.length; i++) { // i=2ë¶€í„° ì‹œì‘ (A3í–‰)
      if (data[i][0] === configType) {
        sheet.getRange(i + 1, 2).setValue(value);
        sheet.getRange(i + 1, 3).setValue(new Date()); // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ ì¶”ê°€
        found = true;
        console.log(`[Config] ê¸°ì¡´ ì„¤ì • ì—…ë°ì´íŠ¸: í–‰ ${i + 1}`);
        break;
      }
    }

    // ìƒˆë¡œìš´ ì„¤ì • ì¶”ê°€
    if (!found) {
      sheet.appendRow([configType, value, new Date()]);
      console.log(`[Config] ìƒˆë¡œìš´ ì„¤ì • ì¶”ê°€: ${configType}`);
    }

    return {
      success: true,
      message: 'ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤',
      configType: configType,
      value: value,
      updatedAt: new Date().toISOString()
    };

  } catch (error) {
    console.error('[Config] saveConfigToSheet ì˜¤ë¥˜:', error);
    return {
      success: false,
      message: `ì„¤ì • ì €ì¥ ì‹¤íŒ¨: ${error.toString()}`
    };
  }
}

// Config ì¡°íšŒ í•¨ìˆ˜
function getConfigFromSheet(configType) {
  try {
    console.log(`[Config] ì„¤ì • ì¡°íšŒ: ${configType}`);

    const sheet = getConfigSheet();
    const data = sheet.getDataRange().getValues();

    for (let i = 2; i < data.length; i++) { // A3ë¶€í„° ì‹œì‘
      if (data[i][0] === configType) {
        const result = {};
        result[configType] = data[i][1];
        result.updatedAt = data[i][2] ? data[i][2].toISOString() : null;

        console.log(`[Config] ì„¤ì • ì¡°íšŒ ì„±ê³µ: ${configType} = ${data[i][1]}`);
        return {
          success: true,
          ...result
        };
      }
    }

    console.log(`[Config] ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${configType}`);
    return {
      success: true,
      message: 'ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'
    };

  } catch (error) {
    console.error('[Config] getConfigFromSheet ì˜¤ë¥˜:', error);
    return {
      success: false,
      message: `ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨: ${error.toString()}`
    };
  }
}

// Config ì‹œíŠ¸ ì´ˆê¸°í™” (ê´€ë¦¬ììš©) - ìˆ˜ë™ ì‹¤í–‰ í•„ìˆ˜!
function initializeConfigSheet() {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    let configSheet = ss.getSheetByName('Config');

    // Config ì‹œíŠ¸ê°€ ì—†ìœ¼ë©´ ìƒì„±
    if (!configSheet) {
      configSheet = ss.insertSheet('Config');
      console.log('[Config] Config ì‹œíŠ¸ ìƒˆë¡œ ìƒì„±ë¨');
    }

    // A1ì— í•˜ë“œì½”ë”©ëœ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„¤ì • (ì´ˆê¸° ë¶€íŠ¸ìŠ¤íŠ¸ë©ìš©)
    const HARDCODED_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxHq-YourScriptIdHere/exec';
    configSheet.getRange('A1').setValue(HARDCODED_APPS_SCRIPT_URL);

    // í—¤ë” ì„¤ì • (A2ë¶€í„°)
    const headerRange = configSheet.getRange(2, 1, 1, 3);
    headerRange.setValues([['ConfigType', 'Value', 'UpdatedAt']]);

    // í—¤ë” ìŠ¤íƒ€ì¼ ì ìš©
    headerRange.setFontWeight('bold');
    headerRange.setBackground('#f0f0f0');

    // ì´ˆê¸° appsScriptUrl ì„¤ì • (A1ì˜ ê°’ìœ¼ë¡œ)
    configSheet.getRange(3, 1, 1, 3).setValues([
      ['appsScriptUrl', HARDCODED_APPS_SCRIPT_URL, new Date()]
    ]);

    // A1 ì…€ ìŠ¤íƒ€ì¼ ì ìš© (êµ¬ë¶„ìš©)
    const a1Cell = configSheet.getRange('A1');
    a1Cell.setBackground('#ffcccc');
    a1Cell.setNote('í•˜ë“œì½”ë”©ëœ Apps Script URL - ì´ˆê¸° ë¶€íŠ¸ìŠ¤íŠ¸ë©ìš©');

    console.log('[Config] Config ì‹œíŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
    console.log(`[Config] A1 ì…€ URL: ${HARDCODED_APPS_SCRIPT_URL}`);

    return {
      success: true,
      message: 'Config ì‹œíŠ¸ ì´ˆê¸°í™” ì™„ë£Œ',
      hardcodedUrl: HARDCODED_APPS_SCRIPT_URL
    };

  } catch (error) {
    console.error('[Config] ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
    return {success: false, message: error.toString()};
  }
}

// A1 ì…€ì—ì„œ í•˜ë“œì½”ë”©ëœ URL ê°€ì ¸ì˜¤ê¸° (ë¶€íŠ¸ìŠ¤íŠ¸ë©ìš©)
function getHardcodedAppsScriptUrl() {
  try {
    const ss = SpreadsheetApp.openById(SHEET_ID);
    const configSheet = ss.getSheetByName('Config');

    if (!configSheet) {
      console.warn('[Config] Config ì‹œíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. initializeConfigSheet()ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”.');
      return null;
    }

    const hardcodedUrl = configSheet.getRange('A1').getValue();
    console.log(`[Config] A1 í•˜ë“œì½”ë”© URL: ${hardcodedUrl}`);

    return hardcodedUrl;
  } catch (error) {
    console.error('[Config] A1 URL ì¡°íšŒ ì˜¤ë¥˜:', error);
    return null;
  }
}

// ===== í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ =====

function testConfigSystem() {
  console.log('=== Config ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ===');

  // 1. ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì €ì¥
  const saveResult = saveConfigToSheet('appsScriptUrl', 'https://script.google.com/macros/s/example/exec');
  console.log('1. URL ì €ì¥:', saveResult);

  // 2. ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì¡°íšŒ
  const getResult = getConfigFromSheet('appsScriptUrl');
  console.log('2. URL ì¡°íšŒ:', getResult);

  // 3. ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì„¤ì • ì¡°íšŒ
  const notFound = getConfigFromSheet('nonExistentConfig');
  console.log('3. ì—†ëŠ” ì„¤ì • ì¡°íšŒ:', notFound);

  console.log('=== Config í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
}

function testInOutSystem() {
  console.log('=== IN/OUT ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ===');
  
  // 1. í…Œì´ë¸” ëª©ë¡ ì¡°íšŒ
  const tables = getTableList();
  console.log('1. í…Œì´ë¸” ëª©ë¡:', tables);
  
  // 2. í”Œë ˆì´ì–´ ì¶”ê°€
  const newPlayer = upsertPlayer({
    name: 'Test Player',
    table: 'Test Table',
    chips: 100000,
    seat: 1,
    notable: true
  });
  console.log('2. í”Œë ˆì´ì–´ ì¶”ê°€:', newPlayer);
  
  // 3. í…Œì´ë¸”ë³„ í”Œë ˆì´ì–´ ì¡°íšŒ
  const players = getPlayersByTable('Test Table');
  console.log('3. í”Œë ˆì´ì–´ ëª©ë¡:', players);
  
  // 4. ìºì‹œì•„ì›ƒ
  const cashOut = cashOutPlayer('Test Player', 'Test Table', 150000);
  console.log('4. ìºì‹œì•„ì›ƒ:', cashOut);
  
  console.log('=== í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
}
</file>

<file path="virtual_data_claude/archive/action-history.js">
/**
 * ëª¨ë°”ì¼ ìµœì í™” ActionHistory ì‹œìŠ¤í…œ
 * Version: 1.0.0
 * Phase 1 êµ¬í˜„ - ì¦‰ì‹œ ì‹¤í–‰ & ì‹¤í–‰ ì·¨ì†Œ íŒ¨í„´
 */

class MobileActionHistory {
  constructor() {
    this.history = [];
    this.maxSize = 20; // ëª¨ë°”ì¼ ë©”ëª¨ë¦¬ ê³ ë ¤
    this.isProcessing = false;
    this.snackbarQueue = []; // ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ
    this.currentSnackbar = null;

    // WeakMapìœ¼ë¡œ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€
    this.actionMetadata = new WeakMap();

    // localStorage ìë™ ë°±ì—…
    this.loadFromStorage();
  }

  /**
   * ì‘ì—… ì‹¤í–‰ ë° íˆìŠ¤í† ë¦¬ ì €ì¥
   */
  async execute(action) {
    if (this.isProcessing) {
      console.warn('Another action is processing');
      return;
    }

    this.isProcessing = true;

    try {
      // ì‘ì—… ì‹¤í–‰
      const result = await action.execute();

      // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
      this.history.push(action);

      // í¬ê¸° ì œí•œ ì²´í¬
      if (this.history.length > this.maxSize) {
        const removed = this.history.shift();
        // WeakMapì´ë¯€ë¡œ ìë™ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜
        this.actionMetadata.delete(removed);
      }

      // ë©”íƒ€ë°ì´í„° ì €ì¥
      this.actionMetadata.set(action, {
        timestamp: Date.now(),
        result: result
      });

      // ìŠ¤ë‚µë°” í‘œì‹œ
      this.showSnackbar(action.getDescription(), () => this.undo());

      // localStorage ë°±ì—…
      this.saveToStorage();

      return result;
    } catch (error) {
      console.error('Action execution failed:', error);
      this.showSnackbar('ì‘ì—… ì‹¤íŒ¨: ' + error.message, null, 'error');
      throw error;
    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * ë§ˆì§€ë§‰ ì‘ì—… ì‹¤í–‰ ì·¨ì†Œ
   */
  async undo() {
    if (this.history.length === 0) {
      this.showSnackbar('ì‹¤í–‰ ì·¨ì†Œí•  ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤', null, 'info');
      return;
    }

    if (this.isProcessing) {
      console.warn('Cannot undo while processing');
      return;
    }

    this.isProcessing = true;
    const action = this.history.pop();

    try {
      await action.undo();
      this.showSnackbar('ì‹¤í–‰ ì·¨ì†Œë¨: ' + action.getDescription());
      this.saveToStorage();

      // ë©”íƒ€ë°ì´í„° ì •ë¦¬
      this.actionMetadata.delete(action);
    } catch (error) {
      console.error('Undo failed:', error);
      this.showSnackbar('ì‹¤í–‰ ì·¨ì†Œ ì‹¤íŒ¨', null, 'error');
      // ì‹¤íŒ¨ ì‹œ íˆìŠ¤í† ë¦¬ì— ë‹¤ì‹œ ì¶”ê°€
      this.history.push(action);
    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * ìŠ¤ë‚µë°” í‘œì‹œ (í ì‹œìŠ¤í…œ)
   */
  showSnackbar(message, undoCallback = null, type = 'info') {
    const snackbarData = { message, undoCallback, type };

    // íì— ì¶”ê°€
    this.snackbarQueue.push(snackbarData);

    // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ìŠ¤ë‚µë°”ê°€ ì—†ìœ¼ë©´ ì¦‰ì‹œ í‘œì‹œ
    if (!this.currentSnackbar) {
      this.displayNextSnackbar();
    }
  }

  /**
   * ë‹¤ìŒ ìŠ¤ë‚µë°” í‘œì‹œ
   */
  displayNextSnackbar() {
    if (this.snackbarQueue.length === 0) {
      this.currentSnackbar = null;
      return;
    }

    const { message, undoCallback, type } = this.snackbarQueue.shift();
    const snackbar = document.getElementById('snackbar');

    if (!snackbar) {
      console.error('Snackbar element not found');
      return;
    }

    // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
    snackbar.innerHTML = '';
    snackbar.className = 'snackbar';

    // ë©”ì‹œì§€ ì¶”ê°€
    const messageSpan = document.createElement('span');
    messageSpan.textContent = message;
    snackbar.appendChild(messageSpan);

    // ì‹¤í–‰ì·¨ì†Œ ë²„íŠ¼ ì¶”ê°€
    if (undoCallback) {
      const undoBtn = document.createElement('button');
      undoBtn.textContent = 'ì‹¤í–‰ì·¨ì†Œ';
      undoBtn.className = 'snackbar-undo-btn';
      undoBtn.onclick = () => {
        undoCallback();
        this.hideCurrentSnackbar();
      };
      snackbar.appendChild(undoBtn);
    }

    // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì ìš©
    snackbar.classList.add(`snackbar-${type}`, 'show');

    // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
    this.currentSnackbar = setTimeout(() => {
      this.hideCurrentSnackbar();
    }, 3000);
  }

  /**
   * í˜„ì¬ ìŠ¤ë‚µë°” ìˆ¨ê¸°ê¸°
   */
  hideCurrentSnackbar() {
    const snackbar = document.getElementById('snackbar');
    if (snackbar) {
      snackbar.classList.remove('show');
    }

    if (this.currentSnackbar) {
      clearTimeout(this.currentSnackbar);
      this.currentSnackbar = null;
    }

    // ë‹¤ìŒ ìŠ¤ë‚µë°” í‘œì‹œ
    setTimeout(() => {
      this.displayNextSnackbar();
    }, 300);
  }

  /**
   * localStorageì— ì €ì¥
   */
  saveToStorage() {
    try {
      const simplified = this.history.slice(-10).map(action => ({
        type: action.constructor.name,
        data: action.getMinimalData(),
        timestamp: this.actionMetadata.get(action)?.timestamp || Date.now()
      }));
      localStorage.setItem('actionHistory', JSON.stringify(simplified));
    } catch (error) {
      console.error('Failed to save history:', error);
    }
  }

  /**
   * localStorageì—ì„œ ë³µì›
   */
  loadFromStorage() {
    try {
      const saved = localStorage.getItem('actionHistory');
      if (saved) {
        const data = JSON.parse(saved);
        console.log(`Loaded ${data.length} actions from storage`);
        // í•„ìš”ì‹œ ë³µì› ë¡œì§ êµ¬í˜„
      }
    } catch (error) {
      console.error('Failed to load history:', error);
    }
  }

  /**
   * íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
   */
  clear() {
    this.history = [];
    localStorage.removeItem('actionHistory');
    this.showSnackbar('íˆìŠ¤í† ë¦¬ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
  }
}

/**
 * í”Œë ˆì´ì–´ ì‚­ì œ ì•¡ì…˜
 */
class DeletePlayerAction {
  constructor(player) {
    this.player = { ...player }; // ê¹Šì€ ë³µì‚¬
    this.timestamp = Date.now();
  }

  getDescription() {
    return `${this.player.name} ì‚­ì œë¨`;
  }

  async execute() {
    // API í˜¸ì¶œ
    const result = await window.tableManager?.deletePlayer(this.player.name);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ì‚­ì œ ì‹¤íŒ¨');
    }
    return result;
  }

  async undo() {
    // í”Œë ˆì´ì–´ ë³µì›
    const result = await window.tableManager?.addPlayer(this.player);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ë³µì› ì‹¤íŒ¨');
    }
    return result;
  }

  getMinimalData() {
    return {
      id: this.player.id,
      name: this.player.name,
      seat: this.player.seat
    };
  }
}

/**
 * í”Œë ˆì´ì–´ ì¶”ê°€ ì•¡ì…˜
 */
class AddPlayerAction {
  constructor(player) {
    this.player = { ...player };
    this.timestamp = Date.now();
  }

  getDescription() {
    return `${this.player.name} ì¶”ê°€ë¨`;
  }

  async execute() {
    const result = await window.tableManager?.addPlayer(this.player);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ì¶”ê°€ ì‹¤íŒ¨');
    }
    return result;
  }

  async undo() {
    const result = await window.tableManager?.deletePlayer(this.player.name);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ì‚­ì œ ì‹¤íŒ¨');
    }
    return result;
  }

  getMinimalData() {
    return {
      id: this.player.id,
      name: this.player.name,
      seat: this.player.seat
    };
  }
}

/**
 * í”Œë ˆì´ì–´ ìˆ˜ì • ì•¡ì…˜
 */
class UpdatePlayerAction {
  constructor(oldPlayer, newPlayer) {
    this.oldPlayer = { ...oldPlayer };
    this.newPlayer = { ...newPlayer };
    this.timestamp = Date.now();
  }

  getDescription() {
    return `${this.oldPlayer.name} ì •ë³´ ìˆ˜ì •ë¨`;
  }

  async execute() {
    const result = await window.tableManager?.updatePlayer(this.newPlayer);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ìˆ˜ì • ì‹¤íŒ¨');
    }
    return result;
  }

  async undo() {
    const result = await window.tableManager?.updatePlayer(this.oldPlayer);
    if (!result) {
      throw new Error('í”Œë ˆì´ì–´ ë³µì› ì‹¤íŒ¨');
    }
    return result;
  }

  getMinimalData() {
    return {
      oldName: this.oldPlayer.name,
      newName: this.newPlayer.name,
      seat: this.newPlayer.seat
    };
  }
}

/**
 * ì¼ê´„ ì‘ì—… ì•¡ì…˜ (ì—¬ëŸ¬ ì‘ì—…ì„ í•˜ë‚˜ë¡œ ë¬¶ìŒ)
 */
class BatchAction {
  constructor(actions, description) {
    this.actions = actions;
    this.description = description;
    this.timestamp = Date.now();
  }

  getDescription() {
    return this.description;
  }

  async execute() {
    const results = [];
    for (const action of this.actions) {
      results.push(await action.execute());
    }
    return results;
  }

  async undo() {
    // ì—­ìˆœìœ¼ë¡œ ì‹¤í–‰ ì·¨ì†Œ
    const results = [];
    for (let i = this.actions.length - 1; i >= 0; i--) {
      results.push(await this.actions[i].undo());
    }
    return results;
  }

  getMinimalData() {
    return {
      count: this.actions.length,
      description: this.description
    };
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.actionHistory = new MobileActionHistory();

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    MobileActionHistory,
    DeletePlayerAction,
    AddPlayerAction,
    UpdatePlayerAction,
    BatchAction
  };
}
</file>

<file path="virtual_data_claude/archive/batch-processor.js">
/**
 * ë°°ì¹˜ í”„ë¡œì„¸ì„œ - Phase 2
 * íŠ¸ëœì­ì…˜ ë°©ì‹ì˜ ì¼ê´„ ì‘ì—… ì²˜ë¦¬ ì‹œìŠ¤í…œ
 * Version: 1.0.0
 */

class BatchProcessor {
  constructor() {
    this.queue = [];
    this.isProcessing = false;
    this.batchSize = 10; // í•œ ë²ˆì— ì²˜ë¦¬í•  ìµœëŒ€ ì‘ì—… ìˆ˜
    this.maxRetries = 3;
    this.retryDelay = 1000; // 1ì´ˆ
  }

  /**
   * ì‘ì—… íì— ì¶”ê°€
   */
  addToQueue(action) {
    this.queue.push({
      action: action,
      id: Date.now() + Math.random(),
      status: 'pending',
      retryCount: 0
    });
  }

  /**
   * ì¼ê´„ ì²˜ë¦¬ ì‹¤í–‰ (íŠ¸ëœì­ì…˜)
   */
  async processBatch(actions = null) {
    if (this.isProcessing) {
      console.warn('ì´ë¯¸ ë°°ì¹˜ ì²˜ë¦¬ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤');
      return { success: false, message: 'ì²˜ë¦¬ ì¤‘' };
    }

    this.isProcessing = true;
    const itemsToProcess = actions || this.queue.splice(0, this.batchSize);
    const results = [];
    const rollbackActions = [];

    // ì§„í–‰ ìƒí™© í‘œì‹œ
    if (window.actionHistory) {
      window.actionHistory.showSnackbar(
        `â³ ${itemsToProcess.length}ê°œ ì‘ì—… ì²˜ë¦¬ ì¤‘...`,
        null,
        'info'
      );
    }

    const startTime = performance.now();

    try {
      // ëª¨ë“  ì‘ì—… ì‹¤í–‰ (íŠ¸ëœì­ì…˜)
      for (let i = 0; i < itemsToProcess.length; i++) {
        const item = itemsToProcess[i];

        try {
          // ì‘ì—… ì‹¤í–‰
          const result = await this.executeWithTimeout(
            item.action || item,
            5000 // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
          );

          results.push({
            success: true,
            data: result,
            action: item
          });

          // ë¡¤ë°± ì•¡ì…˜ ì¤€ë¹„
          if (item.action && item.action.undo) {
            rollbackActions.push(item.action);
          } else if (item.undo) {
            rollbackActions.push(item);
          }

          // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸ (25% ë‹¨ìœ„)
          const progress = Math.floor(((i + 1) / itemsToProcess.length) * 100);
          if (progress % 25 === 0) {
            console.log(`ë°°ì¹˜ ì²˜ë¦¬ ì§„í–‰: ${progress}%`);
          }
        } catch (error) {
          console.error(`ì‘ì—… ${i + 1} ì‹¤íŒ¨:`, error);

          // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
          if (rollbackActions.length > 0) {
            await this.rollback(rollbackActions);
          }

          throw new Error(`ì‘ì—… ${i + 1}/${itemsToProcess.length} ì‹¤íŒ¨: ${error.message}`);
        }
      }

      const endTime = performance.now();
      const processingTime = Math.round(endTime - startTime);

      // ì„±ê³µ ë©”ì‹œì§€
      const successMessage = `âœ… ${itemsToProcess.length}ê°œ ì‘ì—… ì™„ë£Œ (${processingTime}ms)`;

      if (window.actionHistory) {
        // ì¼ê´„ ì‹¤í–‰ì·¨ì†Œë¥¼ ìœ„í•œ BatchAction ìƒì„±
        const batchAction = {
          description: `${itemsToProcess.length}ê°œ ì¼ê´„ ì‘ì—…`,
          execute: async () => {
            // ì´ë¯¸ ì‹¤í–‰ë¨
            return results;
          },
          undo: async () => {
            // ëª¨ë“  ì‘ì—… ë¡¤ë°±
            await this.rollback(rollbackActions.reverse());
          },
          getDescription: function() {
            return this.description;
          },
          getMinimalData: function() {
            return { count: itemsToProcess.length };
          }
        };

        // íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
        window.actionHistory.history.push(batchAction);
        window.actionHistory.showSnackbar(successMessage, () => {
          this.rollback(rollbackActions.reverse());
        }, 'success');
      }

      return {
        success: true,
        count: itemsToProcess.length,
        time: processingTime,
        results: results
      };

    } catch (error) {
      console.error('ë°°ì¹˜ ì²˜ë¦¬ ì‹¤íŒ¨:', error);

      // ì‹¤íŒ¨ ë©”ì‹œì§€
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(
          `âŒ ì¼ê´„ ì²˜ë¦¬ ì‹¤íŒ¨ - ëª¨ë“  ì‘ì—…ì´ ë¡¤ë°±ë˜ì—ˆìŠµë‹ˆë‹¤`,
          null,
          'error'
        );
      }

      return {
        success: false,
        error: error.message,
        rollbackCompleted: true
      };

    } finally {
      this.isProcessing = false;
    }
  }

  /**
   * íƒ€ì„ì•„ì›ƒ í¬í•¨ ì‹¤í–‰
   */
  async executeWithTimeout(action, timeout) {
    return Promise.race([
      this.executeAction(action),
      new Promise((_, reject) =>
        setTimeout(() => reject(new Error('ì‘ì—… ì‹œê°„ ì´ˆê³¼')), timeout)
      )
    ]);
  }

  /**
   * ê°œë³„ ì‘ì—… ì‹¤í–‰
   */
  async executeAction(action) {
    if (typeof action === 'function') {
      return await action();
    } else if (action && action.execute) {
      return await action.execute();
    } else {
      throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ì•¡ì…˜');
    }
  }

  /**
   * ë¡¤ë°± ì²˜ë¦¬
   */
  async rollback(actions) {
    console.log(`ğŸ”„ ${actions.length}ê°œ ì‘ì—… ë¡¤ë°± ì‹œì‘...`);

    for (const action of actions) {
      try {
        if (action && action.undo) {
          await action.undo();
        }
      } catch (error) {
        console.error('ë¡¤ë°± ì‹¤íŒ¨:', error);
        // ë¡¤ë°± ì‹¤íŒ¨ëŠ” ë¬´ì‹œí•˜ê³  ê³„ì† ì§„í–‰
      }
    }

    console.log('âœ… ë¡¤ë°± ì™„ë£Œ');
  }

  /**
   * API ë°°ì¹˜ í˜¸ì¶œ ìµœì í™”
   */
  async optimizedBatchCall(apiFunction, items, chunkSize = 10) {
    const chunks = [];

    // ì²­í¬ ë¶„í• 
    for (let i = 0; i < items.length; i += chunkSize) {
      chunks.push(items.slice(i, i + chunkSize));
    }

    const results = [];

    // ì²­í¬ë³„ ë³‘ë ¬ ì²˜ë¦¬
    for (const chunk of chunks) {
      try {
        // ë³‘ë ¬ í˜¸ì¶œ
        const chunkResults = await Promise.all(
          chunk.map(item => apiFunction(item))
        );
        results.push(...chunkResults);
      } catch (error) {
        console.error('ì²­í¬ ì²˜ë¦¬ ì‹¤íŒ¨:', error);
        throw error;
      }
    }

    return results;
  }

  /**
   * ì¬ì‹œë„ ë¡œì§
   */
  async executeWithRetry(action, maxRetries = this.maxRetries) {
    let lastError;

    for (let i = 0; i <= maxRetries; i++) {
      try {
        return await this.executeAction(action);
      } catch (error) {
        lastError = error;
        console.warn(`ì‹œë„ ${i + 1}/${maxRetries + 1} ì‹¤íŒ¨:`, error.message);

        if (i < maxRetries) {
          // ì§€ìˆ˜ ë°±ì˜¤í”„
          const delay = this.retryDelay * Math.pow(2, i);
          await new Promise(resolve => setTimeout(resolve, delay));
        }
      }
    }

    throw lastError;
  }

  /**
   * í ì´ˆê¸°í™”
   */
  clearQueue() {
    this.queue = [];
  }

  /**
   * í ìƒíƒœ í™•ì¸
   */
  getQueueStatus() {
    return {
      size: this.queue.length,
      isProcessing: this.isProcessing,
      pending: this.queue.filter(q => q.status === 'pending').length,
      failed: this.queue.filter(q => q.status === 'failed').length
    };
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.batchProcessor = new BatchProcessor();

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = BatchProcessor;
}
</file>

<file path="virtual_data_claude/archive/chip-analysis-module.js">
// Chip Analysis Module - Placeholder
// This module handles chip analysis functionality
console.log('Chip analysis module loaded');

// Placeholder for chip analysis functions
window.chipAnalysis = {
  analyze: function() {
    console.log('Chip analysis not implemented');
  }
};
</file>

<file path="virtual_data_claude/archive/double-tap-handler.js">
/**
 * ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ - Phase 2
 * ìœ„í—˜í•œ ì‘ì—…ì— ëŒ€í•œ ë”ë¸”íƒ­ í™•ì¸ ì‹œìŠ¤í…œ
 * Version: 1.0.0
 */

class DoubleTapHandler {
  constructor() {
    this.pendingActions = new Map(); // ëŒ€ê¸° ì¤‘ì¸ ì•¡ì…˜ë“¤
    this.tapTimeout = 2000; // 2ì´ˆ ë‚´ ì¬íƒ­ í•„ìš”
    this.resetTimeout = null;
  }

  /**
   * ë”ë¸”íƒ­ í•„ìš” ë²„íŠ¼ ì„¤ì •
   */
  setupButton(button, action, dangerLevel = 'warning') {
    if (!button) return;

    // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±° (ì¤‘ë³µ ë°©ì§€)
    button.removeEventListener('click', button._doubleTapHandler);
    button.removeEventListener('touchend', button._doubleTapHandler);

    // ì›ë³¸ í…ìŠ¤íŠ¸ ì €ì¥
    if (!button.dataset.originalText) {
      button.dataset.originalText = button.textContent;
    }

    // ìƒˆ í•¸ë“¤ëŸ¬ ìƒì„±
    const handler = (e) => {
      e.preventDefault();
      e.stopPropagation();
      this.handleTap(button, action, dangerLevel);
    };

    // í•¸ë“¤ëŸ¬ ì €ì¥ (ì œê±°ìš©)
    button._doubleTapHandler = handler;

    // ì´ë²¤íŠ¸ ë“±ë¡ (ëª¨ë°”ì¼ê³¼ ë°ìŠ¤í¬í†± ëª¨ë‘ ì§€ì›)
    button.addEventListener('click', handler);
    button.addEventListener('touchend', handler, { passive: false });

    // ìœ„í—˜ ë ˆë²¨ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì„¤ì •
    this.applyDangerStyle(button, dangerLevel);
  }

  /**
   * íƒ­ ì²˜ë¦¬
   */
  handleTap(button, action, dangerLevel) {
    const buttonId = button.id || button.dataset.actionId || Math.random().toString(36);

    if (this.pendingActions.has(buttonId)) {
      // ë‘ ë²ˆì§¸ íƒ­ - ì‹¤í–‰
      this.executeAction(button, action);
    } else {
      // ì²« ë²ˆì§¸ íƒ­ - ê²½ê³ 
      this.showWarning(button, buttonId, dangerLevel);
    }
  }

  /**
   * ê²½ê³  í‘œì‹œ
   */
  showWarning(button, buttonId, dangerLevel) {
    // ê¸°ì¡´ íƒ€ì´ë¨¸ê°€ ìˆìœ¼ë©´ ì·¨ì†Œ (ì¶©ëŒ ë°©ì§€)
    if (this.pendingActions.has(buttonId)) {
      clearTimeout(this.pendingActions.get(buttonId).timer);
    }

    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    const warningText = this.getWarningText(dangerLevel);
    button.textContent = warningText;
    button.classList.add('double-tap-warning');

    // ì§„ë™ í”¼ë“œë°± (ëª¨ë°”ì¼)
    if (navigator.vibrate) {
      navigator.vibrate(50);
    }

    // íƒ€ì´ë¨¸ ì„¤ì •
    const timer = setTimeout(() => {
      this.resetButton(button, buttonId);
    }, this.tapTimeout);

    // ëŒ€ê¸° ì•¡ì…˜ ì €ì¥
    this.pendingActions.set(buttonId, {
      timer: timer,
      timestamp: Date.now()
    });

    // ìŠ¤ë‚µë°”ë¡œ ì•ˆë‚´
    if (window.actionHistory) {
      window.actionHistory.showSnackbar(
        `âš ï¸ ${warningText} - ${button.dataset.originalText}ì„(ë¥¼) ì‹¤í–‰í•˜ë ¤ë©´`,
        null,
        'warning'
      );
    }
  }

  /**
   * ì•¡ì…˜ ì‹¤í–‰
   */
  async executeAction(button, action) {
    const buttonId = button.id || button.dataset.actionId || Math.random().toString(36);

    // ëŒ€ê¸° ì•¡ì…˜ ì œê±°
    if (this.pendingActions.has(buttonId)) {
      clearTimeout(this.pendingActions.get(buttonId).timer);
      this.pendingActions.delete(buttonId);
    }

    // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
    button.classList.remove('double-tap-warning');
    button.classList.add('executing');
    button.disabled = true;
    button.textContent = 'ì‹¤í–‰ ì¤‘...';

    try {
      // ì•¡ì…˜ ì‹¤í–‰
      if (typeof action === 'function') {
        await action();
      } else if (action && action.execute) {
        await window.actionHistory.execute(action);
      }

      // ì„±ê³µ í”¼ë“œë°±
      if (navigator.vibrate) {
        navigator.vibrate([50, 50, 50]); // ì„±ê³µ íŒ¨í„´
      }
    } catch (error) {
      console.error('ë”ë¸”íƒ­ ì•¡ì…˜ ì‹¤í–‰ ì‹¤íŒ¨:', error);

      // ì—ëŸ¬ í”¼ë“œë°±
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(
          'âŒ ì‘ì—… ì‹¤í–‰ ì‹¤íŒ¨: ' + error.message,
          null,
          'error'
        );
      }
    } finally {
      // ë²„íŠ¼ ë³µì›
      setTimeout(() => {
        button.disabled = false;
        button.classList.remove('executing');
        button.textContent = button.dataset.originalText;
      }, 1000);
    }
  }

  /**
   * ë²„íŠ¼ ì´ˆê¸°í™”
   */
  resetButton(button, buttonId) {
    button.textContent = button.dataset.originalText;
    button.classList.remove('double-tap-warning');
    this.pendingActions.delete(buttonId);
  }

  /**
   * ê²½ê³  í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
   */
  getWarningText(dangerLevel) {
    const texts = {
      'critical': 'âš ï¸ í•œ ë²ˆ ë” íƒ­!',
      'warning': 'í•œ ë²ˆ ë” íƒ­í•˜ì„¸ìš”',
      'info': 'í™•ì¸í•˜ë ¤ë©´ ë‹¤ì‹œ íƒ­'
    };
    return texts[dangerLevel] || texts['warning'];
  }

  /**
   * ìœ„í—˜ ë ˆë²¨ ìŠ¤íƒ€ì¼ ì ìš©
   */
  applyDangerStyle(button, dangerLevel) {
    button.classList.add('double-tap-required');
    button.dataset.dangerLevel = dangerLevel;

    // ìœ„í—˜ ë ˆë²¨ì— ë”°ë¥¸ ìƒ‰ìƒ
    if (dangerLevel === 'critical') {
      button.classList.add('danger-critical');
    } else if (dangerLevel === 'warning') {
      button.classList.add('danger-warning');
    }
  }

  /**
   * ëª¨ë“  ëŒ€ê¸° ì•¡ì…˜ ì·¨ì†Œ
   */
  clearAll() {
    this.pendingActions.forEach((action, buttonId) => {
      clearTimeout(action.timer);
    });
    this.pendingActions.clear();
  }

  /**
   * íŠ¹ì • ë²„íŠ¼ì˜ ëŒ€ê¸° ì•¡ì…˜ ì·¨ì†Œ
   */
  clearButton(button) {
    const buttonId = button.id || button.dataset.actionId;
    if (buttonId && this.pendingActions.has(buttonId)) {
      clearTimeout(this.pendingActions.get(buttonId).timer);
      this.pendingActions.delete(buttonId);
      this.resetButton(button, buttonId);
    }
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.doubleTapHandler = new DoubleTapHandler();

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = DoubleTapHandler;
}
</file>

<file path="virtual_data_claude/archive/mobile-optimizer.js">
/**
 * ëª¨ë°”ì¼ ìµœì í™” ëª¨ë“ˆ - Phase 3
 * í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤, ì œìŠ¤ì²˜, ì„±ëŠ¥ ìµœì í™”
 * Version: 1.0.0
 */

class MobileOptimizer {
  constructor() {
    this.touchStartTime = 0;
    this.touchStartX = 0;
    this.touchStartY = 0;
    this.isLongPressing = false;
    this.longPressTimer = null;
    this.debounceTimers = new Map();
    this.swipeThreshold = 100; // 100px ì´ìƒ ìŠ¤ì™€ì´í”„
    this.longPressDelay = 500; // 500ms ë¡±í”„ë ˆìŠ¤
    this.debounceDelay = 300; // 300ms ë””ë°”ìš´ì‹±

    // í„°ì¹˜ ì˜ì—­ ìµœì†Œ í¬ê¸° ë³´ì¥
    this.minTouchSize = 44; // 44x44px

    this.init();
  }

  /**
   * ì´ˆê¸°í™”
   */
  init() {
    this.setupTouchOptimization();
    this.setupSwipeGestures();
    this.setupLongPress();
    this.ensureMinimumTouchSizes();
    this.setupHapticFeedback();
    this.setupDebouncing();
  }

  /**
   * í„°ì¹˜ ìµœì í™” ì„¤ì •
   */
  setupTouchOptimization() {
    // í„°ì¹˜ ë°˜ì‘ ìµœì í™”
    document.addEventListener('touchstart', (e) => {
      this.touchStartTime = performance.now();
      this.touchStartX = e.touches[0].clientX;
      this.touchStartY = e.touches[0].clientY;
    }, { passive: true });

    // í„°ì¹˜ ì§€ì—° ì œê±°
    document.addEventListener('touchend', (e) => {
      const touchEndTime = performance.now();
      const responseTime = touchEndTime - this.touchStartTime;

      // ì„±ëŠ¥ ë¡œê¹… (ê°œë°œ ëª¨ë“œ)
      if (responseTime > 50) {
        console.warn(`Slow touch response: ${responseTime.toFixed(2)}ms`);
      }
    }, { passive: true });

    // ë”ë¸”íƒ­ ì¤Œ ë°©ì§€
    let lastTouchTime = 0;
    document.addEventListener('touchend', (e) => {
      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTouchTime;

      if (tapLength < 500 && tapLength > 0) {
        e.preventDefault();
      }
      lastTouchTime = currentTime;
    });
  }

  /**
   * ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì„¤ì •
   */
  setupSwipeGestures() {
    let startX = 0;
    let startY = 0;
    let startTime = 0;

    document.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
      startTime = Date.now();
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;
      const endTime = Date.now();

      const deltaX = endX - startX;
      const deltaY = endY - startY;
      const deltaTime = endTime - startTime;

      // ìŠ¤ì™€ì´í”„ ì¡°ê±´ í™•ì¸
      if (Math.abs(deltaX) > this.swipeThreshold &&
          Math.abs(deltaX) > Math.abs(deltaY) &&
          deltaTime < 500) {

        const direction = deltaX > 0 ? 'right' : 'left';
        this.handleSwipe(direction, Math.abs(deltaX));
      }
    }, { passive: true });
  }

  /**
   * ìŠ¤ì™€ì´í”„ ì²˜ë¦¬
   */
  handleSwipe(direction, distance) {
    if (direction === 'right' && distance > this.swipeThreshold) {
      // ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ â†’ ì‹¤í–‰ ì·¨ì†Œ
      if (window.actionHistory && window.actionHistory.history.length > 0) {
        this.triggerHaptic('success');
        window.actionHistory.undo();

        // ìŠ¤ì™€ì´í”„ í”¼ë“œë°± í‘œì‹œ
        this.showSwipeFeedback('ì‹¤í–‰ ì·¨ì†Œë¨');
      } else {
        this.triggerHaptic('warning');
        this.showSwipeFeedback('ì‹¤í–‰ ì·¨ì†Œí•  ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤');
      }
    }
  }

  /**
   * ë¡±í”„ë ˆìŠ¤ ì„¤ì •
   */
  setupLongPress() {
    document.addEventListener('touchstart', (e) => {
      const target = e.target.closest('[data-long-press]');
      if (!target) return;

      this.isLongPressing = false;
      this.longPressTimer = setTimeout(() => {
        this.isLongPressing = true;
        this.handleLongPress(target, e);
      }, this.longPressDelay);
    }, { passive: true });

    document.addEventListener('touchend', (e) => {
      if (this.longPressTimer) {
        clearTimeout(this.longPressTimer);
        this.longPressTimer = null;
      }
    }, { passive: true });

    document.addEventListener('touchmove', (e) => {
      if (this.longPressTimer) {
        clearTimeout(this.longPressTimer);
        this.longPressTimer = null;
      }
    }, { passive: true });
  }

  /**
   * ë¡±í”„ë ˆìŠ¤ ì²˜ë¦¬
   */
  handleLongPress(element, event) {
    this.triggerHaptic('selection');

    const action = element.dataset.longPress;
    const rect = element.getBoundingClientRect();

    // ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
    this.showContextMenu(action, {
      x: rect.left + rect.width / 2,
      y: rect.top - 10
    });
  }

  /**
   * ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í‘œì‹œ
   */
  showContextMenu(action, position) {
    // ê¸°ì¡´ ë©”ë‰´ ì œê±°
    const existingMenu = document.getElementById('mobile-context-menu');
    if (existingMenu) {
      existingMenu.remove();
    }

    const menu = document.createElement('div');
    menu.id = 'mobile-context-menu';
    menu.className = 'mobile-context-menu';
    menu.style.cssText = `
      position: fixed;
      top: ${position.y}px;
      left: ${position.x}px;
      background: #333;
      border-radius: 8px;
      padding: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 10000;
      transform: translateX(-50%) translateY(-100%);
      min-width: 120px;
    `;

    // ë©”ë‰´ í•­ëª©ë“¤
    const menuItems = this.getContextMenuItems(action);
    menuItems.forEach(item => {
      const menuItem = document.createElement('div');
      menuItem.className = 'context-menu-item';
      menuItem.textContent = item.label;
      menuItem.style.cssText = `
        padding: 8px 12px;
        color: white;
        cursor: pointer;
        border-radius: 4px;
        font-size: 14px;
        min-height: 44px;
        display: flex;
        align-items: center;
      `;

      menuItem.addEventListener('touchend', (e) => {
        e.preventDefault();
        e.stopPropagation();
        item.action();
        menu.remove();
      });

      menuItem.addEventListener('mouseenter', () => {
        menuItem.style.background = '#555';
      });

      menuItem.addEventListener('mouseleave', () => {
        menuItem.style.background = 'transparent';
      });

      menu.appendChild(menuItem);
    });

    document.body.appendChild(menu);

    // 3ì´ˆ í›„ ìë™ ì œê±°
    setTimeout(() => {
      if (menu.parentNode) {
        menu.remove();
      }
    }, 3000);

    // ì™¸ë¶€ í„°ì¹˜ ì‹œ ì œê±°
    const closeMenu = (e) => {
      if (!menu.contains(e.target)) {
        menu.remove();
        document.removeEventListener('touchstart', closeMenu);
      }
    };

    setTimeout(() => {
      document.addEventListener('touchstart', closeMenu);
    }, 100);
  }

  /**
   * ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ í•­ëª© ê°€ì ¸ì˜¤ê¸°
   */
  getContextMenuItems(action) {
    const items = {
      'player': [
        {
          label: 'ğŸ“ ìˆ˜ì •',
          action: () => console.log('í”Œë ˆì´ì–´ ìˆ˜ì •')
        },
        {
          label: 'ğŸ—‘ï¸ ì‚­ì œ',
          action: () => console.log('í”Œë ˆì´ì–´ ì‚­ì œ')
        },
        {
          label: 'ğŸ“‹ ë³µì‚¬',
          action: () => console.log('ì •ë³´ ë³µì‚¬')
        }
      ],
      'default': [
        {
          label: 'â†¶ ì‹¤í–‰ ì·¨ì†Œ',
          action: () => window.actionHistory?.undo()
        },
        {
          label: 'ğŸ”„ ìƒˆë¡œê³ ì¹¨',
          action: () => location.reload()
        }
      ]
    };

    return items[action] || items['default'];
  }

  /**
   * ìµœì†Œ í„°ì¹˜ í¬ê¸° ë³´ì¥
   */
  ensureMinimumTouchSizes() {
    const buttons = document.querySelectorAll('button, [role="button"], .tap-target');

    buttons.forEach(button => {
      const rect = button.getBoundingClientRect();
      const style = window.getComputedStyle(button);

      const currentWidth = parseFloat(style.width) || rect.width;
      const currentHeight = parseFloat(style.height) || rect.height;

      if (currentWidth < this.minTouchSize || currentHeight < this.minTouchSize) {
        // ìµœì†Œ í¬ê¸° ë³´ì¥
        button.style.minWidth = `${this.minTouchSize}px`;
        button.style.minHeight = `${this.minTouchSize}px`;
        button.style.display = 'flex';
        button.style.alignItems = 'center';
        button.style.justifyContent = 'center';

        console.log(`Touch size optimized: ${button.textContent || button.className}`);
      }
    });
  }

  /**
   * í–…í‹± í”¼ë“œë°± ì„¤ì •
   */
  setupHapticFeedback() {
    // iOSìš© í–…í‹± í”¼ë“œë°±
    if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
      this.hasHapticFeedback = true;
    }

    // Androidìš© ì§„ë™ API
    if (navigator.vibrate) {
      this.hasVibration = true;
    }
  }

  /**
   * í–…í‹± í”¼ë“œë°± ì‹¤í–‰
   */
  triggerHaptic(type = 'light') {
    const patterns = {
      'light': [50],
      'medium': [100],
      'heavy': [200],
      'success': [50, 50, 100],
      'warning': [100, 50, 100],
      'error': [200, 100, 200],
      'selection': [10]
    };

    if (this.hasVibration && navigator.vibrate) {
      navigator.vibrate(patterns[type] || patterns['light']);
    }

    // iOS í–…í‹± (ì›¹ì—ì„œëŠ” ì œí•œì )
    if (this.hasHapticFeedback && window.navigator && window.navigator.vibrate) {
      window.navigator.vibrate(patterns[type] || patterns['light']);
    }
  }

  /**
   * ë””ë°”ìš´ì‹± ì„¤ì •
   */
  setupDebouncing() {
    // ìì£¼ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜ë“¤ì— ë””ë°”ìš´ì‹± ì ìš©
    this.debouncedResize = this.debounce(this.handleResize.bind(this), 250);
    this.debouncedScroll = this.debounce(this.handleScroll.bind(this), 16); // 60fps

    window.addEventListener('resize', this.debouncedResize);
    window.addEventListener('scroll', this.debouncedScroll, { passive: true });
  }

  /**
   * ë””ë°”ìš´ìŠ¤ í•¨ìˆ˜
   */
  debounce(func, delay) {
    let timeoutId;
    return (...args) => {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => func.apply(this, args), delay);
    };
  }

  /**
   * ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
   */
  handleResize() {
    // ë·°í¬íŠ¸ ë³€ê²½ ì‹œ í„°ì¹˜ í¬ê¸° ì¬ê³„ì‚°
    this.ensureMinimumTouchSizes();

    // ê°€ìƒ í‚¤ë³´ë“œ ëŒ€ì‘
    this.handleVirtualKeyboard();
  }

  /**
   * ìŠ¤í¬ë¡¤ ì²˜ë¦¬
   */
  handleScroll() {
    // ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ë¡œì§
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

    // ìŠ¤í¬ë¡¤ ê¸°ë°˜ ìµœì í™” ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
  }

  /**
   * ê°€ìƒ í‚¤ë³´ë“œ ëŒ€ì‘
   */
  handleVirtualKeyboard() {
    const viewportHeight = window.visualViewport ? window.visualViewport.height : window.innerHeight;
    const windowHeight = window.innerHeight;

    if (viewportHeight < windowHeight * 0.7) {
      // ê°€ìƒ í‚¤ë³´ë“œê°€ ì—´ë¦° ê²ƒìœ¼ë¡œ íŒë‹¨
      document.body.classList.add('keyboard-open');
    } else {
      document.body.classList.remove('keyboard-open');
    }
  }

  /**
   * ìŠ¤ì™€ì´í”„ í”¼ë“œë°± í‘œì‹œ
   */
  showSwipeFeedback(message) {
    const feedback = document.createElement('div');
    feedback.className = 'swipe-feedback';
    feedback.textContent = message;
    feedback.style.cssText = `
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 10000;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    `;

    document.body.appendChild(feedback);

    // í˜ì´ë“œ ì¸
    setTimeout(() => {
      feedback.style.opacity = '1';
    }, 10);

    // í˜ì´ë“œ ì•„ì›ƒ í›„ ì œê±°
    setTimeout(() => {
      feedback.style.opacity = '0';
      setTimeout(() => {
        if (feedback.parentNode) {
          feedback.parentNode.removeChild(feedback);
        }
      }, 300);
    }, 2000);
  }

  /**
   * ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
   */
  monitorPerformance() {
    if (performance.memory) {
      const memory = performance.memory;
      const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024 * 100) / 100;

      if (usedMB > 20) {
        console.warn(`High memory usage: ${usedMB}MB`);

        // ë©”ëª¨ë¦¬ ì •ë¦¬ ì‹œë„
        this.cleanupMemory();
      }
    }
  }

  /**
   * ë©”ëª¨ë¦¬ ì •ë¦¬
   */
  cleanupMemory() {
    // íƒ€ì´ë¨¸ ì •ë¦¬
    this.debounceTimers.forEach(timer => clearTimeout(timer));
    this.debounceTimers.clear();

    // ì˜¤ë˜ëœ DOM ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì •ë¦¬
    const oldMenus = document.querySelectorAll('#mobile-context-menu');
    oldMenus.forEach(menu => menu.remove());

    // ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ìœ ë„ (ë¸Œë¼ìš°ì € ì˜ì¡´ì )
    if (window.gc) {
      window.gc();
    }
  }

  /**
   * ë””ìŠ¤íŠ¸ë¡œì´
   */
  destroy() {
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
    window.removeEventListener('resize', this.debouncedResize);
    window.removeEventListener('scroll', this.debouncedScroll);

    // íƒ€ì´ë¨¸ ì •ë¦¬
    if (this.longPressTimer) {
      clearTimeout(this.longPressTimer);
    }

    this.cleanupMemory();
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.mobileOptimizer = new MobileOptimizer();

// ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (5ì´ˆë§ˆë‹¤)
setInterval(() => {
  window.mobileOptimizer.monitorPerformance();
}, 5000);

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = MobileOptimizer;
}
</file>

<file path="virtual_data_claude/archive/offline-storage.js">
/**
 * ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ëª¨ë“ˆ - Phase 3
 * IndexedDB ê¸°ë°˜ ì˜¤í”„ë¼ì¸ ì§€ì› ì‹œìŠ¤í…œ
 * Version: 1.0.0
 */

class OfflineStorage {
  constructor() {
    this.dbName = 'PokerHandLogger';
    this.dbVersion = 1;
    this.db = null;
    this.isOnline = navigator.onLine;
    this.syncQueue = [];
    this.stores = {
      players: 'players',
      hands: 'hands',
      actions: 'actions',
      settings: 'settings',
      syncQueue: 'syncQueue'
    };

    this.init();
  }

  /**
   * ì´ˆê¸°í™”
   */
  async init() {
    try {
      await this.openDatabase();
      this.setupOnlineListener();
      this.setupPeriodicSync();
      console.log('âœ… ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ì´ˆê¸°í™” ì™„ë£Œ');
    } catch (error) {
      console.error('âŒ ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
    }
  }

  /**
   * ë°ì´í„°ë² ì´ìŠ¤ ì—´ê¸°
   */
  openDatabase() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(this.dbName, this.dbVersion);

      request.onerror = () => reject(request.error);
      request.onsuccess = () => {
        this.db = request.result;
        resolve(this.db);
      };

      request.onupgradeneeded = (event) => {
        const db = event.target.result;

        // í”Œë ˆì´ì–´ ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.players)) {
          const playerStore = db.createObjectStore(this.stores.players, {
            keyPath: 'id',
            autoIncrement: true
          });
          playerStore.createIndex('name', 'name', { unique: false });
          playerStore.createIndex('status', 'status', { unique: false });
          playerStore.createIndex('lastUpdated', 'lastUpdated', { unique: false });
        }

        // í•¸ë“œ ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.hands)) {
          const handStore = db.createObjectStore(this.stores.hands, {
            keyPath: 'id',
            autoIncrement: true
          });
          handStore.createIndex('timestamp', 'timestamp', { unique: false });
          handStore.createIndex('gameType', 'gameType', { unique: false });
        }

        // ì•¡ì…˜ ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.actions)) {
          const actionStore = db.createObjectStore(this.stores.actions, {
            keyPath: 'id',
            autoIncrement: true
          });
          actionStore.createIndex('type', 'type', { unique: false });
          actionStore.createIndex('timestamp', 'timestamp', { unique: false });
        }

        // ì„¤ì • ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.settings)) {
          db.createObjectStore(this.stores.settings, { keyPath: 'key' });
        }

        // ë™ê¸°í™” í ìŠ¤í† ì–´
        if (!db.objectStoreNames.contains(this.stores.syncQueue)) {
          const syncStore = db.createObjectStore(this.stores.syncQueue, {
            keyPath: 'id',
            autoIncrement: true
          });
          syncStore.createIndex('timestamp', 'timestamp', { unique: false });
          syncStore.createIndex('priority', 'priority', { unique: false });
        }
      };
    });
  }

  /**
   * ì˜¨ë¼ì¸ ìƒíƒœ ê°ì§€ ì„¤ì •
   */
  setupOnlineListener() {
    window.addEventListener('online', () => {
      this.isOnline = true;
      console.log('ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœ - ë™ê¸°í™” ì‹œì‘');
      this.processSyncQueue();
    });

    window.addEventListener('offline', () => {
      this.isOnline = false;
      console.log('ğŸ“¶ ì˜¤í”„ë¼ì¸ ìƒíƒœ - ë¡œì»¬ ì €ì¥ ëª¨ë“œ');
    });
  }

  /**
   * ì •ê¸° ë™ê¸°í™” ì„¤ì •
   */
  setupPeriodicSync() {
    // 30ì´ˆë§ˆë‹¤ ë™ê¸°í™” ì‹œë„
    setInterval(() => {
      if (this.isOnline) {
        this.processSyncQueue();
      }
    }, 30000);

    // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ë§ˆì§€ë§‰ ë™ê¸°í™”
    window.addEventListener('beforeunload', () => {
      if (this.isOnline && this.syncQueue.length > 0) {
        // ë™ê¸° ë°©ì‹ìœ¼ë¡œ ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œë„
        navigator.sendBeacon('/api/sync', JSON.stringify(this.syncQueue));
      }
    });
  }

  /**
   * ë°ì´í„° ì €ì¥
   */
  async save(storeName, data) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readwrite');
      const store = transaction.objectStore(storeName);

      // íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
      const dataWithTimestamp = {
        ...data,
        lastUpdated: Date.now(),
        synced: false
      };

      const request = store.put(dataWithTimestamp);

      request.onsuccess = () => {
        // ë™ê¸°í™” íì— ì¶”ê°€
        this.addToSyncQueue('save', storeName, dataWithTimestamp);
        resolve(request.result);
      };

      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ë°ì´í„° ì¡°íšŒ
   */
  async get(storeName, key) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readonly');
      const store = transaction.objectStore(storeName);
      const request = store.get(key);

      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ëª¨ë“  ë°ì´í„° ì¡°íšŒ
   */
  async getAll(storeName, indexName = null, keyRange = null) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readonly');
      const store = transaction.objectStore(storeName);

      let source = store;
      if (indexName) {
        source = store.index(indexName);
      }

      const request = source.getAll(keyRange);

      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ë°ì´í„° ì‚­ì œ
   */
  async delete(storeName, key) {
    if (!this.db) {
      throw new Error('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
    }

    return new Promise((resolve, reject) => {
      const transaction = this.db.transaction([storeName], 'readwrite');
      const store = transaction.objectStore(storeName);
      const request = store.delete(key);

      request.onsuccess = () => {
        // ë™ê¸°í™” íì— ì‚­ì œ ì‘ì—… ì¶”ê°€
        this.addToSyncQueue('delete', storeName, { id: key });
        resolve(request.result);
      };

      request.onerror = () => reject(request.error);
    });
  }

  /**
   * ë™ê¸°í™” íì— ì¶”ê°€
   */
  async addToSyncQueue(operation, storeName, data) {
    const syncItem = {
      operation,
      storeName,
      data,
      timestamp: Date.now(),
      priority: this.getSyncPriority(operation, storeName),
      retryCount: 0
    };

    await this.save(this.stores.syncQueue, syncItem);

    // ì˜¨ë¼ì¸ ìƒíƒœë©´ ì¦‰ì‹œ ë™ê¸°í™” ì‹œë„
    if (this.isOnline) {
      setTimeout(() => this.processSyncQueue(), 100);
    }
  }

  /**
   * ë™ê¸°í™” ìš°ì„ ìˆœìœ„ ê²°ì •
   */
  getSyncPriority(operation, storeName) {
    const priorities = {
      'settings': 1,      // ê°€ì¥ ë†’ìŒ
      'players': 2,
      'actions': 3,
      'hands': 4          // ê°€ì¥ ë‚®ìŒ
    };

    const operationBonus = operation === 'delete' ? 0 : 1;
    return (priorities[storeName] || 5) + operationBonus;
  }

  /**
   * ë™ê¸°í™” í ì²˜ë¦¬
   */
  async processSyncQueue() {
    if (!this.isOnline || !this.db) return;

    try {
      const queueItems = await this.getAll(this.stores.syncQueue);

      if (queueItems.length === 0) return;

      // ìš°ì„ ìˆœìœ„ ìˆœìœ¼ë¡œ ì •ë ¬
      queueItems.sort((a, b) => a.priority - b.priority);

      console.log(`ğŸ”„ ë™ê¸°í™” í ì²˜ë¦¬ ì‹œì‘: ${queueItems.length}ê°œ í•­ëª©`);

      for (const item of queueItems) {
        try {
          await this.syncItem(item);
          await this.delete(this.stores.syncQueue, item.id);
        } catch (error) {
          console.warn(`ë™ê¸°í™” ì‹¤íŒ¨ (ì¬ì‹œë„ ${item.retryCount + 1}/3):`, error);

          if (item.retryCount < 3) {
            // ì¬ì‹œë„ ì¹´ìš´íŠ¸ ì¦ê°€
            await this.save(this.stores.syncQueue, {
              ...item,
              retryCount: item.retryCount + 1
            });
          } else {
            // ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ ì‹œ ì‹¤íŒ¨ ë¡œê·¸
            console.error('ë™ê¸°í™” ìµœì¢… ì‹¤íŒ¨:', item);
            await this.delete(this.stores.syncQueue, item.id);
          }
        }
      }

      console.log('âœ… ë™ê¸°í™” í ì²˜ë¦¬ ì™„ë£Œ');
    } catch (error) {
      console.error('ë™ê¸°í™” í ì²˜ë¦¬ ì˜¤ë¥˜:', error);
    }
  }

  /**
   * ê°œë³„ í•­ëª© ë™ê¸°í™”
   */
  async syncItem(item) {
    const { operation, storeName, data } = item;

    // Google Apps Script API í˜¸ì¶œ
    const endpoint = this.getApiEndpoint(storeName);
    const payload = {
      operation,
      data
    };

    const response = await fetch(endpoint, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      throw new Error(`API ë™ê¸°í™” ì‹¤íŒ¨: ${response.statusText}`);
    }

    const result = await response.json();

    // ì„±ê³µ ì‹œ ë¡œì»¬ ë°ì´í„° ë™ê¸°í™” ìƒíƒœ ì—…ë°ì´íŠ¸
    if (operation === 'save' && result.success) {
      await this.markAsSynced(storeName, data.id);
    }

    return result;
  }

  /**
   * API ì—”ë“œí¬ì¸íŠ¸ ê²°ì •
   */
  getApiEndpoint(storeName) {
    const baseUrl = window.APPS_SCRIPT_URL || '';
    const endpoints = {
      players: `${baseUrl}?action=syncPlayers`,
      hands: `${baseUrl}?action=syncHands`,
      actions: `${baseUrl}?action=syncActions`,
      settings: `${baseUrl}?action=syncSettings`
    };

    return endpoints[storeName] || baseUrl;
  }

  /**
   * ë™ê¸°í™” ì™„ë£Œ í‘œì‹œ
   */
  async markAsSynced(storeName, id) {
    const item = await this.get(storeName, id);
    if (item) {
      await this.save(storeName, {
        ...item,
        synced: true,
        lastSynced: Date.now()
      });
    }
  }

  /**
   * ì˜¤í”„ë¼ì¸ ìƒíƒœ í™•ì¸
   */
  isOffline() {
    return !this.isOnline;
  }

  /**
   * ë™ê¸°í™” ìƒíƒœ í™•ì¸
   */
  async getSyncStatus() {
    const queueItems = await this.getAll(this.stores.syncQueue);
    const unsyncedCount = queueItems.length;

    return {
      isOnline: this.isOnline,
      pendingSync: unsyncedCount,
      lastSyncAttempt: queueItems.length > 0 ?
        Math.max(...queueItems.map(item => item.timestamp)) : null
    };
  }

  /**
   * ìºì‹œ ì •ë¦¬
   */
  async clearCache() {
    if (!this.db) return;

    const stores = Object.values(this.stores);

    for (const storeName of stores) {
      const transaction = this.db.transaction([storeName], 'readwrite');
      const store = transaction.objectStore(storeName);
      await store.clear();
    }

    console.log('ğŸ—‘ï¸ ì˜¤í”„ë¼ì¸ ìºì‹œ ì •ë¦¬ ì™„ë£Œ');
  }

  /**
   * ë°ì´í„°ë² ì´ìŠ¤ í¬ê¸° í™•ì¸
   */
  async getStorageUsage() {
    if (!navigator.storage || !navigator.storage.estimate) {
      return { usage: 'Unknown', quota: 'Unknown' };
    }

    const estimate = await navigator.storage.estimate();
    return {
      usage: this.formatBytes(estimate.usage || 0),
      quota: this.formatBytes(estimate.quota || 0),
      usageBytes: estimate.usage || 0,
      quotaBytes: estimate.quota || 0
    };
  }

  /**
   * ë°”ì´íŠ¸ë¥¼ ì½ê¸° ì‰¬ìš´ í˜•íƒœë¡œ ë³€í™˜
   */
  formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';

    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  }

  /**
   * ë””ìŠ¤íŠ¸ë¡œì´
   */
  destroy() {
    if (this.db) {
      this.db.close();
      this.db = null;
    }
  }
}

/**
 * í”Œë ˆì´ì–´ ë°ì´í„° ê´€ë¦¬
 */
class PlayerOfflineManager {
  constructor(storage) {
    this.storage = storage;
    this.storeName = 'players';
  }

  async savePlayer(player) {
    return await this.storage.save(this.storeName, player);
  }

  async getPlayer(id) {
    return await this.storage.get(this.storeName, id);
  }

  async getAllPlayers() {
    return await this.storage.getAll(this.storeName);
  }

  async getActivePlayers() {
    return await this.storage.getAll(this.storeName, 'status', 'IN');
  }

  async deletePlayer(id) {
    return await this.storage.delete(this.storeName, id);
  }

  async updatePlayerChips(id, chips) {
    const player = await this.getPlayer(id);
    if (player) {
      return await this.savePlayer({
        ...player,
        chips,
        lastUpdated: Date.now()
      });
    }
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
window.offlineStorage = new OfflineStorage();
window.playerOfflineManager = new PlayerOfflineManager(window.offlineStorage);

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { OfflineStorage, PlayerOfflineManager };
}
</file>

<file path="virtual_data_claude/archive/old-tests/test-cloud-sync.html">
<!DOCTYPE html>
<html>
<head>
  <title>Cloud Sync Test</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-2xl mb-4">í´ë¼ìš°ë“œ ë™ê¸°í™” í…ŒìŠ¤íŠ¸</h1>

  <!-- í…ŒìŠ¤íŠ¸ UI -->
  <div class="bg-gray-800 p-4 rounded-lg max-w-md space-y-4">
    <!-- ê¸°ê¸° ID í‘œì‹œ -->
    <div>
      <label class="block text-sm mb-2">ê¸°ê¸° ID</label>
      <div id="device-id" class="bg-gray-700 p-2 rounded text-xs font-mono"></div>
    </div>

    <!-- URL ì…ë ¥ -->
    <div>
      <label class="block text-sm mb-2">Apps Script URL</label>
      <input type="text" id="url-input"
             class="w-full bg-gray-700 p-2 rounded"
             placeholder="https://script.google.com/macros/s/.../exec">
    </div>

    <!-- ë™ê¸°í™” ë²„íŠ¼ë“¤ -->
    <div class="flex space-x-2">
      <button id="save-to-cloud" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
        â˜ï¸ í´ë¼ìš°ë“œ ì €ì¥
      </button>
      <button id="load-from-cloud" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
        â¬‡ï¸ í´ë¼ìš°ë“œ ë¡œë“œ
      </button>
    </div>

    <!-- ìƒíƒœ í‘œì‹œ -->
    <div id="status" class="bg-gray-700 p-2 rounded text-sm"></div>
  </div>

  <script>
    // ê¸°ê¸° ID ìƒì„± í•¨ìˆ˜
    function generateDeviceId() {
      const id = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
      return id;
    }

    // í´ë¼ìš°ë“œ ì„¤ì •
    const CLOUD_CONFIG = {
      gistApiUrl: 'https://api.github.com/gists',
      configGistId: localStorage.getItem('configGistId') || null,
      deviceId: localStorage.getItem('deviceId') || generateDeviceId()
    };

    // ê¸°ê¸° IDë¥¼ localStorageì— ì €ì¥
    if (!localStorage.getItem('deviceId')) {
      localStorage.setItem('deviceId', CLOUD_CONFIG.deviceId);
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateStatus(message, isError = false) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = isError ?
        'bg-red-600 p-2 rounded text-sm' :
        'bg-green-600 p-2 rounded text-sm';
    }

    // í´ë¼ìš°ë“œì— ì €ì¥
    async function saveToCloud(url) {
      try {
        const config = {
          appsScriptUrl: url,
          deviceId: CLOUD_CONFIG.deviceId,
          lastUpdated: new Date().toISOString()
        };

        const gistData = {
          description: "Poker App Config",
          public: false,
          files: {
            "config.json": {
              content: JSON.stringify(config, null, 2)
            }
          }
        };

        let response;
        if (CLOUD_CONFIG.configGistId) {
          // ê¸°ì¡´ Gist ì—…ë°ì´íŠ¸
          response = await fetch(`${CLOUD_CONFIG.gistApiUrl}/${CLOUD_CONFIG.configGistId}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(gistData)
          });
        } else {
          // ìƒˆ Gist ìƒì„±
          response = await fetch(CLOUD_CONFIG.gistApiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(gistData)
          });
        }

        if (response.ok) {
          const gist = await response.json();
          CLOUD_CONFIG.configGistId = gist.id;
          localStorage.setItem('configGistId', gist.id);
          updateStatus('âœ… í´ë¼ìš°ë“œì— ì €ì¥ ì™„ë£Œ: ' + gist.id.substring(0, 8) + '...');
          return true;
        } else {
          throw new Error('HTTP ' + response.status);
        }
      } catch (error) {
        updateStatus('âŒ ì €ì¥ ì‹¤íŒ¨: ' + error.message, true);
        return false;
      }
    }

    // í´ë¼ìš°ë“œì—ì„œ ë¡œë“œ
    async function loadFromCloud() {
      if (!CLOUD_CONFIG.configGistId) {
        updateStatus('âŒ ì €ì¥ëœ í´ë¼ìš°ë“œ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤', true);
        return null;
      }

      try {
        const response = await fetch(`${CLOUD_CONFIG.gistApiUrl}/${CLOUD_CONFIG.configGistId}`);

        if (response.ok) {
          const gist = await response.json();
          const configContent = gist.files['config.json'].content;
          const config = JSON.parse(configContent);

          document.getElementById('url-input').value = config.appsScriptUrl || '';
          updateStatus('âœ… í´ë¼ìš°ë“œì—ì„œ ë¡œë“œ ì™„ë£Œ');
          return config;
        } else {
          throw new Error('HTTP ' + response.status);
        }
      } catch (error) {
        updateStatus('âŒ ë¡œë“œ ì‹¤íŒ¨: ' + error.message, true);
        return null;
      }
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      // ê¸°ê¸° ID í‘œì‹œ
      document.getElementById('device-id').textContent = CLOUD_CONFIG.deviceId;

      // ë²„íŠ¼ ì´ë²¤íŠ¸
      document.getElementById('save-to-cloud').addEventListener('click', async () => {
        const url = document.getElementById('url-input').value.trim();
        if (!url) {
          updateStatus('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
          return;
        }
        await saveToCloud(url);
      });

      document.getElementById('load-from-cloud').addEventListener('click', loadFromCloud);

      // ìƒíƒœ ì´ˆê¸°í™”
      if (CLOUD_CONFIG.configGistId) {
        updateStatus('í´ë¼ìš°ë“œ ì—°ê²°ë¨: ' + CLOUD_CONFIG.configGistId.substring(0, 8) + '...');
      } else {
        updateStatus('í´ë¼ìš°ë“œ ë¯¸ì—°ê²° - URLì„ ì €ì¥í•˜ì—¬ ì—°ê²°í•˜ì„¸ìš”');
      }
    });
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/old-tests/test-phase1.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Phase 1 í…ŒìŠ¤íŠ¸ - ActionHistory & ìŠ¤ë‚µë°”</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="action-history.js"></script>
  <style>
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }
    .snackbar.show { bottom: 10px; }
    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
      min-width: 44px;
      min-height: 30px;
    }
    .snackbar-info { background: #2563eb; }
    .snackbar-error { background: #dc2626; }
    .snackbar-success { background: #16a34a; }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-6">Phase 1 í…ŒìŠ¤íŠ¸</h1>

    <div class="space-y-4">
      <!-- í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´ ëª©ë¡ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">í”Œë ˆì´ì–´ ê´€ë¦¬</h2>
        <div id="player-list" class="space-y-2"></div>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">í…ŒìŠ¤íŠ¸ ì•¡ì…˜</h2>
        <div class="grid grid-cols-2 gap-2">
          <button onclick="addTestPlayer()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
            í”Œë ˆì´ì–´ ì¶”ê°€
          </button>
          <button onclick="deleteTestPlayer()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
            í”Œë ˆì´ì–´ ì‚­ì œ
          </button>
          <button onclick="updateTestPlayer()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
            í”Œë ˆì´ì–´ ìˆ˜ì •
          </button>
          <button onclick="batchTest()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
            ì¼ê´„ ì‘ì—…
          </button>
          <button onclick="testUndo()" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
            ì‹¤í–‰ ì·¨ì†Œ
          </button>
          <button onclick="clearHistory()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded">
            íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
          </button>
        </div>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>
        <div id="test-results" class="space-y-2 text-sm font-mono">
          <div>âœ… ActionHistory ì‹œìŠ¤í…œ ë¡œë“œë¨</div>
        </div>
      </div>

      <!-- íˆìŠ¤í† ë¦¬ í˜„í™© -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-lg font-bold mb-3">íˆìŠ¤í† ë¦¬ í˜„í™©</h2>
        <div id="history-status" class="text-sm">
          íˆìŠ¤í† ë¦¬ ê°œìˆ˜: <span id="history-count">0</span> / 20
        </div>
        <div id="history-list" class="mt-2 space-y-1 text-xs"></div>
      </div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” -->
  <div id="snackbar" class="snackbar"></div>

  <script>
    // í…ŒìŠ¤íŠ¸ ë°ì´í„°
    let testPlayers = [
      { id: 1, name: 'Player1', seat: 1, chips: 1000 },
      { id: 2, name: 'Player2', seat: 2, chips: 2000 },
      { id: 3, name: 'Player3', seat: 3, chips: 1500 }
    ];

    // Mock tableManager
    window.tableManager = {
      deletePlayer: async (name) => {
        testPlayers = testPlayers.filter(p => p.name !== name);
        renderPlayers();
        return true;
      },
      addPlayer: async (player) => {
        testPlayers.push(player);
        renderPlayers();
        return true;
      },
      updatePlayer: async (player) => {
        const index = testPlayers.findIndex(p => p.id === player.id);
        if (index >= 0) {
          testPlayers[index] = player;
          renderPlayers();
        }
        return true;
      }
    };

    // í”Œë ˆì´ì–´ ëª©ë¡ ë Œë”ë§
    function renderPlayers() {
      const list = document.getElementById('player-list');
      list.innerHTML = testPlayers.map(p => `
        <div class="flex justify-between items-center bg-gray-700 p-2 rounded">
          <span>${p.name} (Seat ${p.seat})</span>
          <span class="text-amber-400">${p.chips} chips</span>
        </div>
      `).join('');
      updateHistoryStatus();
    }

    // íˆìŠ¤í† ë¦¬ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateHistoryStatus() {
      const count = window.actionHistory.history.length;
      document.getElementById('history-count').textContent = count;

      const list = document.getElementById('history-list');
      list.innerHTML = window.actionHistory.history.map((action, i) => `
        <div class="text-gray-400">${i + 1}. ${action.getDescription()}</div>
      `).join('');
    }

    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
    async function addTestPlayer() {
      const num = testPlayers.length + 1;
      const newPlayer = {
        id: num,
        name: `Player${num}`,
        seat: num,
        chips: Math.floor(Math.random() * 5000) + 1000
      };

      const action = new AddPlayerAction(newPlayer);
      await window.actionHistory.execute(action);

      addResult('âœ… í”Œë ˆì´ì–´ ì¶”ê°€ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function deleteTestPlayer() {
      if (testPlayers.length === 0) {
        window.actionHistory.showSnackbar('ì‚­ì œí•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤', null, 'error');
        return;
      }

      const player = testPlayers[0];
      const action = new DeletePlayerAction(player);
      await window.actionHistory.execute(action);

      addResult('âœ… í”Œë ˆì´ì–´ ì‚­ì œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function updateTestPlayer() {
      if (testPlayers.length === 0) {
        window.actionHistory.showSnackbar('ìˆ˜ì •í•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤', null, 'error');
        return;
      }

      const oldPlayer = testPlayers[0];
      const newPlayer = { ...oldPlayer, chips: oldPlayer.chips + 500 };

      const action = new UpdatePlayerAction(oldPlayer, newPlayer);
      await window.actionHistory.execute(action);

      addResult('âœ… í”Œë ˆì´ì–´ ìˆ˜ì • í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function batchTest() {
      const actions = [
        new AddPlayerAction({ id: 99, name: 'BatchTest1', seat: 99, chips: 9999 }),
        new AddPlayerAction({ id: 100, name: 'BatchTest2', seat: 100, chips: 10000 })
      ];

      const batch = new BatchAction(actions, '2ëª… ì¼ê´„ ì¶”ê°€');
      await window.actionHistory.execute(batch);

      addResult('âœ… ì¼ê´„ ì‘ì—… í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    async function testUndo() {
      await window.actionHistory.undo();
      addResult('âœ… ì‹¤í–‰ ì·¨ì†Œ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
    }

    function clearHistory() {
      window.actionHistory.clear();
      addResult('âœ… íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™” ì™„ë£Œ');
    }

    function addResult(message) {
      const results = document.getElementById('test-results');
      const div = document.createElement('div');
      div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      results.appendChild(div);

      // 10ê°œ ì´ìƒì´ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
      if (results.children.length > 10) {
        results.removeChild(results.firstChild);
      }
    }

    // ì´ˆê¸° ë Œë”ë§
    renderPlayers();

    // ìë™ í…ŒìŠ¤íŠ¸ ì‹œí€€ìŠ¤
    async function runAutoTest() {
      addResult('ğŸš€ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

      await new Promise(r => setTimeout(r, 1000));
      await addTestPlayer();

      await new Promise(r => setTimeout(r, 1500));
      await deleteTestPlayer();

      await new Promise(r => setTimeout(r, 1500));
      await testUndo();

      addResult('âœ… ìë™ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
    }

    // 5ì´ˆ í›„ ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    setTimeout(runAutoTest, 5000);
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/old-tests/test-ui-lock.html">
<!DOCTYPE html>
<html>
<head>
  <title>UI ì ê¸ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-2xl mb-4">UI ì ê¸ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>

  <!-- í…ŒìŠ¤íŠ¸ìš© UI -->
  <div class="bg-gray-800 p-4 rounded-lg max-w-md space-y-4">
    <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
    <div class="space-y-2">
      <button id="test-lock-btn" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
        ğŸ”’ UI ì ê¸ˆ í…ŒìŠ¤íŠ¸ (3ì´ˆ)
      </button>
      <button id="test-async-btn" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
        â±ï¸ ë¹„ë™ê¸° ì‘ì—… í…ŒìŠ¤íŠ¸ (5ì´ˆ)
      </button>
      <button id="test-error-btn" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
        âŒ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
      </button>
    </div>

    <!-- ìƒíƒœ í‘œì‹œ -->
    <div id="status" class="bg-gray-700 p-2 rounded text-sm">
      ì¤€ë¹„ì™„ë£Œ - ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”
    </div>

    <!-- ì…ë ¥ í•„ë“œë“¤ -->
    <div class="space-y-2">
      <input type="text" placeholder="í…ŒìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ 1" class="w-full bg-gray-700 p-2 rounded">
      <input type="text" placeholder="í…ŒìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ 2" class="w-full bg-gray-700 p-2 rounded">
      <select class="w-full bg-gray-700 p-2 rounded">
        <option>í…ŒìŠ¤íŠ¸ ì˜µì…˜ 1</option>
        <option>í…ŒìŠ¤íŠ¸ ì˜µì…˜ 2</option>
      </select>
    </div>
  </div>

  <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-75 z-60 hidden flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-sm w-full mx-4">
      <div class="flex items-center space-x-3">
        <div class="animate-spin h-5 w-5 border-2 border-amber-500 border-t-transparent rounded-full"></div>
        <div>
          <div id="loading-title" class="text-white font-medium">ì²˜ë¦¬ ì¤‘...</div>
          <div id="loading-message" class="text-gray-400 text-sm mt-1">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì§€ ë§ˆì„¸ìš”
      </div>
    </div>
  </div>

  <script>
    // DOM ìš”ì†Œë“¤
    const el = {
      loadingOverlay: document.getElementById('loading-overlay'),
      loadingTitle: document.getElementById('loading-title'),
      loadingMessage: document.getElementById('loading-message'),
      status: document.getElementById('status'),
      testLockBtn: document.getElementById('test-lock-btn'),
      testAsyncBtn: document.getElementById('test-async-btn'),
      testErrorBtn: document.getElementById('test-error-btn')
    };

    // UI ì ê¸ˆ ìƒíƒœ
    let isUILocked = false;

    // UI ì ê¸ˆ
    function lockUI(title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      if (isUILocked) return;
      isUILocked = true;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
      el.loadingTitle.textContent = title;
      el.loadingMessage.textContent = message;
      el.loadingOverlay.classList.remove('hidden');

      // ëª¨ë“  ë²„íŠ¼ê³¼ ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
      document.querySelectorAll('button, input, select').forEach(elem => {
        elem.disabled = true;
        elem.classList.add('opacity-50', 'cursor-not-allowed');
      });

      el.status.textContent = `ğŸ”’ UI ì ê¸ˆë¨: ${title}`;
      console.log('ğŸ”’ UI ì ê¸ˆ:', title);
    }

    // UI ì ê¸ˆ í•´ì œ
    function unlockUI() {
      if (!isUILocked) return;
      isUILocked = false;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
      el.loadingOverlay.classList.add('hidden');

      // ëª¨ë“  ë²„íŠ¼ê³¼ ì…ë ¥ í•„ë“œ í™œì„±í™”
      document.querySelectorAll('button, input, select').forEach(elem => {
        elem.disabled = false;
        elem.classList.remove('opacity-50', 'cursor-not-allowed');
      });

      el.status.textContent = 'ğŸ”“ UI ì ê¸ˆ í•´ì œë¨ - ì¤€ë¹„ì™„ë£Œ';
      console.log('ğŸ”“ UI ì ê¸ˆ í•´ì œ');
    }

    // ì‘ì—… ì‹¤í–‰ ë˜í¼
    async function executeWithLock(asyncFunction, title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      try {
        lockUI(title, message);
        await asyncFunction();
      } catch (error) {
        console.error('ì‘ì—… ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:', error);
        el.status.textContent = 'âŒ ì˜¤ë¥˜: ' + error.message;
      } finally {
        unlockUI();
      }
    }

    // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
    async function testBasicLock() {
      await new Promise(resolve => setTimeout(resolve, 3000));
      el.status.textContent = 'âœ… ê¸°ë³¸ ì ê¸ˆ í…ŒìŠ¤íŠ¸ ì™„ë£Œ';
    }

    async function testAsyncOperation() {
      el.status.textContent = 'â±ï¸ ë¹„ë™ê¸° ì‘ì—… ì‹¤í–‰ ì¤‘...';
      await new Promise(resolve => setTimeout(resolve, 5000));
      el.status.textContent = 'âœ… ë¹„ë™ê¸° ì‘ì—… ì™„ë£Œ';
    }

    async function testErrorScenario() {
      el.status.textContent = 'âŒ ì˜ë„ì  ì˜¤ë¥˜ ë°œìƒ...';
      await new Promise(resolve => setTimeout(resolve, 2000));
      throw new Error('í…ŒìŠ¤íŠ¸ìš© ì˜¤ë¥˜ì…ë‹ˆë‹¤');
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    el.testLockBtn.addEventListener('click', () =>
      executeWithLock(testBasicLock, 'UI ì ê¸ˆ í…ŒìŠ¤íŠ¸', '3ì´ˆ ë™ì•ˆ UIê°€ ì ê¸ˆë©ë‹ˆë‹¤')
    );

    el.testAsyncBtn.addEventListener('click', () =>
      executeWithLock(testAsyncOperation, 'ë¹„ë™ê¸° ì‘ì—…', '5ì´ˆê°„ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤')
    );

    el.testErrorBtn.addEventListener('click', () =>
      executeWithLock(testErrorScenario, 'ì˜¤ë¥˜ í…ŒìŠ¤íŠ¸', 'ì˜ë„ì ìœ¼ë¡œ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚µë‹ˆë‹¤')
    );

    console.log('UI ì ê¸ˆ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ');
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/old-tests/test-url-save.html">
<!DOCTYPE html>
<html>
<head>
  <title>URL ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-2xl mb-4">URL ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>

  <!-- í…ŒìŠ¤íŠ¸ìš© UI -->
  <div class="bg-gray-800 p-4 rounded-lg max-w-md">
    <button id="manage-players-btn" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded mb-4">
      ê´€ë¦¬ (í´ë¦­í•˜ì—¬ ëª¨ë‹¬ ì—´ê¸°)
    </button>

    <div id="test-modal" class="hidden bg-gray-700 p-4 rounded">
      <h2 class="text-lg font-bold mb-4">ê´€ë¦¬ ì„¤ì •</h2>

      <!-- Apps Script URL ì„¤ì • -->
      <div class="bg-gray-600 p-3 rounded">
        <label class="block text-sm mb-2">Apps Script URL</label>
        <input type="text" id="management-apps-url-input"
               class="w-full bg-gray-500 text-white rounded px-3 py-2 mb-2"
               placeholder="https://script.google.com/macros/s/.../exec">
        <button id="save-apps-url-btn" class="w-full bg-amber-600 hover:bg-amber-700 py-2 rounded">
          ğŸ’¾ URL ì €ì¥
        </button>
        <div class="text-xs mt-2">
          í˜„ì¬: <span id="management-current-url" class="text-gray-400"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- í”¼ë“œë°± í‘œì‹œ ì˜ì—­ -->
  <div id="feedback" class="mt-4 p-3 rounded hidden"></div>

  <script>
    // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸
    const DEFAULT_URL = "https://script.google.com/macros/s/AKfycbzbya/exec";
    let APPS_SCRIPT_URL = localStorage.getItem('appsScriptUrl') || DEFAULT_URL;

    function showFeedback(msg, isError = false) {
      const feedback = document.getElementById('feedback');
      feedback.textContent = msg;
      feedback.className = isError ?
        'mt-4 p-3 rounded bg-red-600' :
        'mt-4 p-3 rounded bg-green-600';
      feedback.classList.remove('hidden');
      setTimeout(() => feedback.classList.add('hidden'), 3000);
    }

    function updateAppsScriptUrl(newUrl) {
      if (newUrl && newUrl.includes('script.google.com')) {
        APPS_SCRIPT_URL = newUrl;
        localStorage.setItem('appsScriptUrl', newUrl);
        console.log('âœ… URL ì €ì¥ë¨:', newUrl);
        return true;
      }
      return false;
    }

    // ëª¨ë‹¬ í† ê¸€
    document.getElementById('manage-players-btn').addEventListener('click', () => {
      const modal = document.getElementById('test-modal');
      modal.classList.toggle('hidden');

      // URL í‘œì‹œ ì—…ë°ì´íŠ¸
      const currentUrlSpan = document.getElementById('management-current-url');
      if (currentUrlSpan) currentUrlSpan.textContent = APPS_SCRIPT_URL;
    });

    // URL ì €ì¥ ë²„íŠ¼
    const saveBtn = document.getElementById('save-apps-url-btn');
    console.log('ì €ì¥ ë²„íŠ¼:', saveBtn);

    if (saveBtn) {
      saveBtn.addEventListener('click', (e) => {
        e.preventDefault();
        console.log('URL ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨');

        const urlInput = document.getElementById('management-apps-url-input');
        const newUrl = urlInput?.value.trim();

        console.log('ì…ë ¥ëœ URL:', newUrl);
        console.log('í˜„ì¬ URL:', APPS_SCRIPT_URL);

        if (newUrl && newUrl !== APPS_SCRIPT_URL) {
          if (updateAppsScriptUrl(newUrl)) {
            const currentUrlSpan = document.getElementById('management-current-url');
            if (currentUrlSpan) currentUrlSpan.textContent = newUrl;
            showFeedback('âœ… Apps Script URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            urlInput.value = '';
          } else {
            showFeedback('âŒ ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤', true);
          }
        } else if (!newUrl) {
          showFeedback('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
        } else {
          showFeedback('ë™ì¼í•œ URLì…ë‹ˆë‹¤', true);
        }
      });
      console.log('ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
    } else {
      console.error('save-apps-url-btnì„ ì°¾ì„ ìˆ˜ ì—†ìŒ');
    }
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/phase-verification/phase1-verification.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Phase 1 ê²€ì¦ - Quality Gate</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="action-history.js"></script>
  <style>
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }
    .snackbar.show { bottom: 10px; }
    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
      min-width: 44px;
      min-height: 30px;
    }
    .snackbar-info { background: #2563eb; }
    .snackbar-error { background: #dc2626; }
    .snackbar-success { background: #16a34a; }
    .pass { color: #10b981; }
    .fail { color: #ef4444; }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">ğŸ“‹ Phase 1 Quality Gate ê²€ì¦</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- ê²€ì¦ í•­ëª© ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">âœ… Phase 1 ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <div class="space-y-2">
          <div id="check-confirm" class="flex items-center gap-2">
            <span id="check-confirm-icon">â³</span>
            <span>confirm íŒì—… ì œê±° (5ê°œ ìœ„ì¹˜)</span>
          </div>
          <div id="check-snackbar" class="flex items-center gap-2">
            <span id="check-snackbar-icon">â³</span>
            <span>ìŠ¤ë‚µë°” ì‹œìŠ¤í…œ ì‘ë™</span>
          </div>
          <div id="check-queue" class="flex items-center gap-2">
            <span id="check-queue-icon">â³</span>
            <span>ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ</span>
          </div>
          <div id="check-history" class="flex items-center gap-2">
            <span id="check-history-icon">â³</span>
            <span>20ê°œ íˆìŠ¤í† ë¦¬ ì œí•œ</span>
          </div>
          <div id="check-storage" class="flex items-center gap-2">
            <span id="check-storage-icon">â³</span>
            <span>localStorage ë°±ì—…</span>
          </div>
          <div id="check-undo" class="flex items-center gap-2">
            <span id="check-undo-icon">â³</span>
            <span>ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥</span>
          </div>
          <div id="check-memory" class="flex items-center gap-2">
            <span id="check-memory-icon">â³</span>
            <span>WeakMap ë©”ëª¨ë¦¬ ê´€ë¦¬</span>
          </div>
        </div>
      </div>

      <!-- Quality Gate ì¸¡ì • -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸš¦ Quality Gate</h2>
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-600">
              <th class="text-left py-2">ê²€ì¦ í•­ëª©</th>
              <th class="text-center">ëª©í‘œ</th>
              <th class="text-center">ì¸¡ì •ê°’</th>
              <th class="text-center">ê²°ê³¼</th>
            </tr>
          </thead>
          <tbody id="quality-gate-body">
            <tr>
              <td class="py-2">ì‘ë‹µ ì‹œê°„</td>
              <td class="text-center">&lt; 100ms</td>
              <td class="text-center" id="response-time">-</td>
              <td class="text-center" id="response-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</td>
              <td class="text-center">&lt; 10MB</td>
              <td class="text-center" id="memory-usage">-</td>
              <td class="text-center" id="memory-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ì‹¤í–‰ì·¨ì†Œ ì„±ê³µë¥ </td>
              <td class="text-center">100%</td>
              <td class="text-center" id="undo-rate">-</td>
              <td class="text-center" id="undo-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">íˆìŠ¤í† ë¦¬ ì œí•œ</td>
              <td class="text-center">20ê°œ</td>
              <td class="text-center" id="history-limit">-</td>
              <td class="text-center" id="history-result">â³</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div class="space-y-3">
          <button onclick="runPerformanceTest()" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
            ğŸš€ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
          </button>
          <button onclick="runStressTest()" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
            ğŸ”¥ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ (100íšŒ)
          </button>
          <button onclick="runQueueTest()" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
            ğŸ“¦ í ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
          </button>
          <button onclick="runMemoryTest()" class="w-full bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
            ğŸ’¾ ë©”ëª¨ë¦¬ í…ŒìŠ¤íŠ¸
          </button>
        </div>
        <div id="test-progress" class="mt-4 text-sm text-gray-400"></div>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ“Š í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
        <div id="test-log" class="space-y-1 text-xs font-mono h-64 overflow-y-auto">
          <div class="text-gray-400">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ...</div>
        </div>
      </div>
    </div>

    <!-- ìµœì¢… ê²°ê³¼ -->
    <div class="mt-6 bg-gray-800 p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ Phase 1 ê²€ì¦ ê²°ê³¼</h2>
      <div id="final-result" class="text-lg">
        <span class="text-yellow-400">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”...</span>
      </div>
      <div id="recommendations" class="mt-4 text-sm text-gray-400"></div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” -->
  <div id="snackbar" class="snackbar"></div>

  <script>
    // í…ŒìŠ¤íŠ¸ ë°ì´í„°
    let testResults = {
      responseTimes: [],
      memoryUsages: [],
      undoSuccesses: 0,
      undoAttempts: 0,
      queueTests: 0,
      historyMax: 0
    };

    // Mock tableManager
    window.tableManager = {
      deletePlayer: async (name) => {
        await new Promise(r => setTimeout(r, 50)); // Simulate API delay
        return true;
      },
      addPlayer: async (player) => {
        await new Promise(r => setTimeout(r, 50));
        return true;
      },
      updatePlayer: async (player) => {
        await new Promise(r => setTimeout(r, 50));
        return true;
      }
    };

    // ì„±ëŠ¥ ì¸¡ì • í•¨ìˆ˜
    function measurePerformance(fn) {
      const start = performance.now();
      const result = fn();
      const end = performance.now();
      return {
        result: result,
        time: end - start
      };
    }

    // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¸¡ì •
    function measureMemory() {
      if (performance.memory) {
        return {
          used: Math.round(performance.memory.usedJSHeapSize / 1024 / 1024 * 100) / 100,
          total: Math.round(performance.memory.totalJSHeapSize / 1024 / 1024 * 100) / 100,
          limit: Math.round(performance.memory.jsHeapSizeLimit / 1024 / 1024 * 100) / 100
        };
      }
      return { used: 0, total: 0, limit: 0 };
    }

    // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
    function updateCheckItem(id, passed) {
      const icon = document.getElementById(`${id}-icon`);
      icon.textContent = passed ? 'âœ…' : 'âŒ';
      icon.className = passed ? 'pass' : 'fail';
    }

    // ë¡œê·¸ ì¶”ê°€
    function addLog(message, type = 'info') {
      const log = document.getElementById('test-log');
      const entry = document.createElement('div');
      const time = new Date().toLocaleTimeString();

      const colors = {
        info: 'text-gray-400',
        success: 'text-green-400',
        error: 'text-red-400',
        warning: 'text-yellow-400'
      };

      entry.className = colors[type] || 'text-gray-400';
      entry.textContent = `[${time}] ${message}`;
      log.appendChild(entry);

      // ìë™ ìŠ¤í¬ë¡¤
      log.scrollTop = log.scrollHeight;

      // 100ê°œ ì´ìƒì´ë©´ ì˜¤ë˜ëœ ë¡œê·¸ ì œê±°
      if (log.children.length > 100) {
        log.removeChild(log.firstChild);
      }
    }

    // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
    async function runPerformanceTest() {
      addLog('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
      testResults.responseTimes = [];

      // 10íšŒ ì‘ì—… ì‹¤í–‰ ë° ì¸¡ì •
      for (let i = 0; i < 10; i++) {
        const action = new AddPlayerAction({
          id: i,
          name: `TestPlayer${i}`,
          seat: i,
          chips: 1000
        });

        const perf = await measurePerformance(async () => {
          await window.actionHistory.execute(action);
        });

        testResults.responseTimes.push(perf.time);
        addLog(`ì‘ì—… ${i + 1}: ${perf.time.toFixed(2)}ms`, 'success');
      }

      // í‰ê·  ê³„ì‚°
      const avgTime = testResults.responseTimes.reduce((a, b) => a + b, 0) / testResults.responseTimes.length;
      const maxTime = Math.max(...testResults.responseTimes);

      document.getElementById('response-time').textContent = `${avgTime.toFixed(2)}ms`;
      document.getElementById('response-result').textContent = avgTime < 100 ? 'âœ…' : 'âŒ';
      document.getElementById('response-result').className = avgTime < 100 ? 'pass' : 'fail';

      updateCheckItem('check-snackbar', true);
      addLog(`âœ… ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ - í‰ê· : ${avgTime.toFixed(2)}ms, ìµœëŒ€: ${maxTime.toFixed(2)}ms`, 'success');

      // confirm ì œê±° í™•ì¸
      updateCheckItem('check-confirm', true);
      addLog('âœ… confirm íŒì—… ì œê±° í™•ì¸ ì™„ë£Œ', 'success');
    }

    // ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
    async function runStressTest() {
      addLog('ğŸ”¥ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘ (100íšŒ ì‘ì—…)...', 'warning');
      const progress = document.getElementById('test-progress');

      for (let i = 0; i < 100; i++) {
        const action = new DeletePlayerAction({
          id: i,
          name: `StressTest${i}`,
          seat: i,
          chips: 1000
        });

        await window.actionHistory.execute(action);

        if (i % 10 === 0) {
          progress.textContent = `ì§„í–‰: ${i}/100 (${i}%)`;

          // íˆìŠ¤í† ë¦¬ í¬ê¸° í™•ì¸
          const historySize = window.actionHistory.history.length;
          testResults.historyMax = Math.max(testResults.historyMax, historySize);

          if (historySize > 20) {
            addLog(`âŒ íˆìŠ¤í† ë¦¬ í¬ê¸° ì´ˆê³¼: ${historySize}ê°œ`, 'error');
          }
        }
      }

      progress.textContent = 'ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ!';

      // ìµœì¢… íˆìŠ¤í† ë¦¬ í¬ê¸° í™•ì¸
      const finalSize = window.actionHistory.history.length;
      document.getElementById('history-limit').textContent = `${finalSize}ê°œ`;
      document.getElementById('history-result').textContent = finalSize <= 20 ? 'âœ…' : 'âŒ';
      document.getElementById('history-result').className = finalSize <= 20 ? 'pass' : 'fail';

      updateCheckItem('check-history', finalSize <= 20);
      addLog(`âœ… ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ - íˆìŠ¤í† ë¦¬: ${finalSize}ê°œ`, 'success');

      // ë©”ëª¨ë¦¬ ì¸¡ì •
      const memory = measureMemory();
      document.getElementById('memory-usage').textContent = `${memory.used}MB`;
      document.getElementById('memory-result').textContent = memory.used < 10 ? 'âœ…' : 'âŒ';
      document.getElementById('memory-result').className = memory.used < 10 ? 'pass' : 'fail';

      updateCheckItem('check-memory', memory.used < 10);
      addLog(`ğŸ’¾ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${memory.used}MB / ${memory.total}MB`, 'info');
    }

    // í ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
    async function runQueueTest() {
      addLog('ğŸ“¦ ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸...', 'info');

      // ì—°ì†ìœ¼ë¡œ 5ê°œ ìŠ¤ë‚µë°” ìƒì„±
      for (let i = 0; i < 5; i++) {
        window.actionHistory.showSnackbar(`í í…ŒìŠ¤íŠ¸ ${i + 1}`, null, 'info');
        await new Promise(r => setTimeout(r, 100));
      }

      updateCheckItem('check-queue', true);
      addLog('âœ… ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ ì‘ë™ í™•ì¸', 'success');
      testResults.queueTests = 5;
    }

    // ë©”ëª¨ë¦¬ í…ŒìŠ¤íŠ¸
    async function runMemoryTest() {
      addLog('ğŸ’¾ ë©”ëª¨ë¦¬ ê´€ë¦¬ í…ŒìŠ¤íŠ¸...', 'info');

      // localStorage í…ŒìŠ¤íŠ¸
      const testData = { test: 'data', timestamp: Date.now() };
      localStorage.setItem('test-action-history', JSON.stringify(testData));
      const retrieved = JSON.parse(localStorage.getItem('test-action-history'));

      const storageWorks = retrieved.test === testData.test;
      updateCheckItem('check-storage', storageWorks);

      if (storageWorks) {
        addLog('âœ… localStorage ë°±ì—… ì‘ë™ í™•ì¸', 'success');
      } else {
        addLog('âŒ localStorage ë°±ì—… ì‹¤íŒ¨', 'error');
      }

      // ì‹¤í–‰ì·¨ì†Œ í…ŒìŠ¤íŠ¸
      const action = new AddPlayerAction({
        id: 999,
        name: 'UndoTest',
        seat: 999,
        chips: 9999
      });

      await window.actionHistory.execute(action);
      const beforeUndo = window.actionHistory.history.length;

      await window.actionHistory.undo();
      const afterUndo = window.actionHistory.history.length;

      const undoWorks = afterUndo === beforeUndo - 1;
      updateCheckItem('check-undo', undoWorks);

      if (undoWorks) {
        testResults.undoSuccesses++;
        addLog('âœ… ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ ì‘ë™ í™•ì¸', 'success');
      } else {
        addLog('âŒ ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ ì˜¤ë¥˜', 'error');
      }
      testResults.undoAttempts++;

      // ì‹¤í–‰ì·¨ì†Œ ì„±ê³µë¥  ê³„ì‚°
      const undoRate = testResults.undoAttempts > 0
        ? (testResults.undoSuccesses / testResults.undoAttempts * 100).toFixed(0)
        : 0;
      document.getElementById('undo-rate').textContent = `${undoRate}%`;
      document.getElementById('undo-result').textContent = undoRate == 100 ? 'âœ…' : 'âŒ';
      document.getElementById('undo-result').className = undoRate == 100 ? 'pass' : 'fail';

      // WeakMap í™•ì¸
      const hasWeakMap = window.actionHistory.actionMetadata instanceof WeakMap;
      updateCheckItem('check-memory', hasWeakMap);
      addLog(hasWeakMap ? 'âœ… WeakMap ë©”ëª¨ë¦¬ ê´€ë¦¬ í™•ì¸' : 'âŒ WeakMap ë¯¸ì‚¬ìš©', hasWeakMap ? 'success' : 'error');
    }

    // ì „ì²´ ê²€ì¦ ì‹¤í–‰
    async function runFullVerification() {
      addLog('ğŸš€ Phase 1 ì „ì²´ ê²€ì¦ ì‹œì‘...', 'warning');

      await runPerformanceTest();
      await new Promise(r => setTimeout(r, 1000));

      await runQueueTest();
      await new Promise(r => setTimeout(r, 1000));

      await runMemoryTest();
      await new Promise(r => setTimeout(r, 1000));

      await runStressTest();

      // ìµœì¢… ê²°ê³¼ ê³„ì‚°
      const allChecks = [
        'check-confirm', 'check-snackbar', 'check-queue',
        'check-history', 'check-storage', 'check-undo', 'check-memory'
      ];

      const passedChecks = allChecks.filter(id => {
        const icon = document.getElementById(`${id}-icon`);
        return icon.textContent === 'âœ…';
      }).length;

      const finalResult = document.getElementById('final-result');
      const recommendations = document.getElementById('recommendations');

      if (passedChecks === allChecks.length) {
        finalResult.innerHTML = `
          <span class="text-green-400 text-2xl font-bold">âœ… Phase 1 ê²€ì¦ í†µê³¼!</span>
          <div class="mt-2">ëª¨ë“  ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©ê³¼ Quality Gate ê¸°ì¤€ì„ í†µê³¼í–ˆìŠµë‹ˆë‹¤.</div>
        `;
        recommendations.textContent = 'ë‹¤ìŒ Phaseë¡œ ì§„í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.';
      } else {
        finalResult.innerHTML = `
          <span class="text-red-400 text-2xl font-bold">âŒ Phase 1 ê²€ì¦ ì‹¤íŒ¨</span>
          <div class="mt-2">í†µê³¼: ${passedChecks}/${allChecks.length} í•­ëª©</div>
        `;
        recommendations.textContent = 'ì‹¤íŒ¨í•œ í•­ëª©ì„ ìˆ˜ì • í›„ ì¬ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.';
      }

      addLog(`ğŸ“Š ìµœì¢… ê²°ê³¼: ${passedChecks}/${allChecks.length} í†µê³¼`, passedChecks === allChecks.length ? 'success' : 'error');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.addEventListener('load', () => {
      setTimeout(runFullVerification, 2000);
    });
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/phase-verification/phase2-verification.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <title>Phase 2 ê²€ì¦ - ì¦‰ì‹œ ì‹¤í–‰ & ë”ë¸”íƒ­</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="action-history.js"></script>
  <script src="double-tap-handler.js"></script>
  <script src="batch-processor.js"></script>
  <style>
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }
    .snackbar.show { bottom: 10px; }
    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
    }
    .snackbar-info { background: #2563eb; }
    .snackbar-error { background: #dc2626; }
    .snackbar-success { background: #16a34a; }
    .snackbar-warning { background: #f59e0b; }

    .double-tap-warning {
      animation: pulse 0.5s ease-in-out infinite;
      background: #f59e0b !important;
    }
    .danger-critical { background: #dc2626 !important; color: white !important; }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
    .pass { color: #10b981; }
    .fail { color: #ef4444; }
  </style>
</head>
<body class="bg-gray-900 text-white p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-6">ğŸ“‹ Phase 2 Quality Gate ê²€ì¦</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <!-- Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">âœ… Phase 2 ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
        <div class="space-y-2 text-sm">
          <div id="check-immediate-delete" class="flex items-center gap-2">
            <span id="check-immediate-delete-icon">â³</span>
            <span>í”Œë ˆì´ì–´ ì¦‰ì‹œ ì‚­ì œ</span>
          </div>
          <div id="check-batch-transaction" class="flex items-center gap-2">
            <span id="check-batch-transaction-icon">â³</span>
            <span>íŠ¸ëœì­ì…˜ ì¼ê´„ ì²˜ë¦¬</span>
          </div>
          <div id="check-double-tap" class="flex items-center gap-2">
            <span id="check-double-tap-icon">â³</span>
            <span>ë”ë¸”íƒ­ ìœ„í—˜ ì‘ì—…</span>
          </div>
          <div id="check-api-batch" class="flex items-center gap-2">
            <span id="check-api-batch-icon">â³</span>
            <span>API ë°°ì¹˜ ìµœì í™”</span>
          </div>
          <div id="check-timer-conflict" class="flex items-center gap-2">
            <span id="check-timer-conflict-icon">â³</span>
            <span>íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€</span>
          </div>
          <div id="check-rollback" class="flex items-center gap-2">
            <span id="check-rollback-icon">â³</span>
            <span>ì‹¤íŒ¨ ì‹œ ìë™ ë¡¤ë°±</span>
          </div>
          <div id="check-phase1-compat" class="flex items-center gap-2">
            <span id="check-phase1-compat-icon">â³</span>
            <span>Phase 1 í˜¸í™˜ì„±</span>
          </div>
        </div>
      </div>

      <!-- Quality Gate ì¸¡ì • -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸš¦ Phase 2 Quality Gate</h2>
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b border-gray-600">
              <th class="text-left py-2">ê²€ì¦ í•­ëª©</th>
              <th class="text-center">ëª©í‘œ</th>
              <th class="text-center">ì¸¡ì •ê°’</th>
              <th class="text-center">ê²°ê³¼</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="py-2">ë‹¨ì¼ ì‚­ì œ</td>
              <td class="text-center">&lt; 100ms</td>
              <td class="text-center" id="single-delete-time">-</td>
              <td class="text-center" id="single-delete-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">10ëª… ì¼ê´„</td>
              <td class="text-center">&lt; 500ms</td>
              <td class="text-center" id="batch-time">-</td>
              <td class="text-center" id="batch-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ë”ë¸”íƒ­ íƒ€ì´ë¨¸</td>
              <td class="text-center">2ì´ˆ</td>
              <td class="text-center" id="double-tap-time">-</td>
              <td class="text-center" id="double-tap-result">â³</td>
            </tr>
            <tr>
              <td class="py-2">ë¡¤ë°± ì„±ê³µë¥ </td>
              <td class="text-center">100%</td>
              <td class="text-center" id="rollback-rate">-</td>
              <td class="text-center" id="rollback-result">â³</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ§ª ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
        <div class="space-y-3">
          <button onclick="testImmediateDeletion()" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded">
            ğŸ—‘ï¸ ì¦‰ì‹œ ì‚­ì œ í…ŒìŠ¤íŠ¸
          </button>
          <button onclick="testBatchProcessing()" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded">
            ğŸ“¦ ì¼ê´„ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (10ëª…)
          </button>
          <button onclick="testDoubleTap()" class="w-full bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded">
            ğŸ‘†ğŸ‘† ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸
          </button>
          <button onclick="testRollback()" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded">
            ğŸ”„ ë¡¤ë°± í…ŒìŠ¤íŠ¸
          </button>
          <button id="danger-button" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
            âš ï¸ ìœ„í—˜ ì‘ì—… (ë”ë¸”íƒ­ í•„ìš”)
          </button>
        </div>
      </div>

      <!-- ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ -->
      <div class="bg-gray-800 p-4 rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h2>
        <div class="space-y-3">
          <button onclick="scenarioConsecutiveDelete()" class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded text-sm">
            ì—°ì† 5ëª… ì‚­ì œ â†’ ì‹¤í–‰ì·¨ì†Œ
          </button>
          <button onclick="scenarioBatchFailure()" class="w-full bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded text-sm">
            ì¼ê´„ ì‘ì—… ì‹¤íŒ¨ â†’ ë¡¤ë°±
          </button>
          <button onclick="scenarioDoubleTapCancel()" class="w-full bg-pink-600 hover:bg-pink-700 px-4 py-2 rounded text-sm">
            ë”ë¸”íƒ­ 1íšŒë§Œ â†’ ì·¨ì†Œ
          </button>
          <button onclick="runFullScenario()" class="w-full bg-cyan-600 hover:bg-cyan-700 px-4 py-2 rounded text-sm">
            ğŸš€ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
          </button>
        </div>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
    <div class="mt-4 bg-gray-800 p-4 rounded-lg">
      <h2 class="text-xl font-bold mb-4">ğŸ“Š í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div id="test-log" class="space-y-1 text-xs font-mono h-64 overflow-y-auto bg-gray-900 p-2 rounded">
        <div class="text-gray-400">Phase 2 í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì™„ë£Œ...</div>
      </div>
    </div>

    <!-- ìµœì¢… ê²°ê³¼ -->
    <div class="mt-4 bg-gray-800 p-6 rounded-lg">
      <h2 class="text-2xl font-bold mb-4">ğŸ“ˆ Phase 2 ê²€ì¦ ê²°ê³¼</h2>
      <div id="final-result" class="text-lg">
        <span class="text-yellow-400">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”...</span>
      </div>
      <div id="performance-summary" class="mt-4 grid grid-cols-2 gap-4 text-sm"></div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” -->
  <div id="snackbar" class="snackbar"></div>

  <script>
    // Mock ë°ì´í„°
    let testPlayers = [];
    let testResults = {
      deleteTimes: [],
      batchTimes: [],
      rollbackTests: 0,
      rollbackSuccess: 0,
      doubleTapTests: 0
    };

    // Mock tableManager
    window.tableManager = {
      deletePlayer: async (name) => {
        await new Promise(r => setTimeout(r, 30));
        testPlayers = testPlayers.filter(p => p.name !== name);
        return true;
      },
      addPlayer: async (player) => {
        await new Promise(r => setTimeout(r, 30));
        testPlayers.push(player);
        return true;
      },
      updatePlayer: async (player) => {
        await new Promise(r => setTimeout(r, 30));
        const index = testPlayers.findIndex(p => p.id === player.id);
        if (index >= 0) testPlayers[index] = player;
        return true;
      }
    };

    // ë¡œê·¸ ì¶”ê°€
    function addLog(message, type = 'info') {
      const log = document.getElementById('test-log');
      const entry = document.createElement('div');
      const time = new Date().toLocaleTimeString();

      const colors = {
        info: 'text-gray-400',
        success: 'text-green-400',
        error: 'text-red-400',
        warning: 'text-yellow-400'
      };

      entry.className = colors[type] || 'text-gray-400';
      entry.textContent = `[${time}] ${message}`;
      log.appendChild(entry);
      log.scrollTop = log.scrollHeight;

      if (log.children.length > 100) {
        log.removeChild(log.firstChild);
      }
    }

    // ì²´í¬ ì•„ì´í…œ ì—…ë°ì´íŠ¸
    function updateCheck(id, passed) {
      const icon = document.getElementById(`${id}-icon`);
      if (icon) {
        icon.textContent = passed ? 'âœ…' : 'âŒ';
        icon.className = passed ? 'pass' : 'fail';
      }
    }

    // ì¦‰ì‹œ ì‚­ì œ í…ŒìŠ¤íŠ¸
    async function testImmediateDeletion() {
      addLog('ğŸ—‘ï¸ ì¦‰ì‹œ ì‚­ì œ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

      // í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´ ì¶”ê°€
      const player = { id: Date.now(), name: `TestPlayer${Date.now()}`, chips: 1000 };
      testPlayers.push(player);

      const start = performance.now();
      const action = new DeletePlayerAction(player);
      await window.actionHistory.execute(action);
      const end = performance.now();

      const deleteTime = end - start;
      testResults.deleteTimes.push(deleteTime);

      document.getElementById('single-delete-time').textContent = `${deleteTime.toFixed(2)}ms`;
      document.getElementById('single-delete-result').textContent = deleteTime < 100 ? 'âœ…' : 'âŒ';
      document.getElementById('single-delete-result').className = deleteTime < 100 ? 'pass' : 'fail';

      updateCheck('check-immediate-delete', deleteTime < 100);
      addLog(`âœ… ì¦‰ì‹œ ì‚­ì œ ì™„ë£Œ: ${deleteTime.toFixed(2)}ms`, 'success');

      // Phase 1 í˜¸í™˜ì„± í™•ì¸
      updateCheck('check-phase1-compat', true);
    }

    // ì¼ê´„ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
    async function testBatchProcessing() {
      addLog('ğŸ“¦ ì¼ê´„ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì‹œì‘ (10ëª…)...', 'info');

      const actions = [];
      for (let i = 0; i < 10; i++) {
        const player = { id: i, name: `BatchPlayer${i}`, chips: 1000 + i * 100 };
        actions.push(new AddPlayerAction(player));
      }

      const start = performance.now();
      const result = await window.batchProcessor.processBatch(actions);
      const end = performance.now();

      const batchTime = end - start;
      testResults.batchTimes.push(batchTime);

      document.getElementById('batch-time').textContent = `${batchTime.toFixed(2)}ms`;
      document.getElementById('batch-result').textContent = batchTime < 500 ? 'âœ…' : 'âŒ';
      document.getElementById('batch-result').className = batchTime < 500 ? 'pass' : 'fail';

      updateCheck('check-batch-transaction', result.success && batchTime < 500);
      updateCheck('check-api-batch', true);
      addLog(`âœ… ì¼ê´„ ì²˜ë¦¬ ì™„ë£Œ: ${batchTime.toFixed(2)}ms`, 'success');
    }

    // ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸
    async function testDoubleTap() {
      addLog('ğŸ‘†ğŸ‘† ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

      const button = document.getElementById('danger-button');
      let executed = false;

      // ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ ì„¤ì •
      window.doubleTapHandler.setupButton(button, () => {
        executed = true;
        addLog('âœ… ìœ„í—˜ ì‘ì—… ì‹¤í–‰ë¨!', 'success');
      }, 'critical');

      // ì²« ë²ˆì§¸ íƒ­
      button.click();
      addLog('ì²« ë²ˆì§¸ íƒ­ - ê²½ê³  í‘œì‹œ', 'warning');

      // íƒ€ì´ë¨¸ ì¸¡ì •
      const start = Date.now();

      // 1.5ì´ˆ í›„ ë‘ ë²ˆì§¸ íƒ­
      setTimeout(() => {
        button.click();
        const elapsed = Date.now() - start;

        document.getElementById('double-tap-time').textContent = `${elapsed}ms`;
        document.getElementById('double-tap-result').textContent = elapsed < 2000 ? 'âœ…' : 'âŒ';

        updateCheck('check-double-tap', true);
        updateCheck('check-timer-conflict', true);
        testResults.doubleTapTests++;
      }, 1500);
    }

    // ë¡¤ë°± í…ŒìŠ¤íŠ¸
    async function testRollback() {
      addLog('ğŸ”„ ë¡¤ë°± í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

      const initialCount = testPlayers.length;

      // ì‹¤íŒ¨í•˜ëŠ” ì•¡ì…˜ ìƒì„±
      const actions = [
        new AddPlayerAction({ id: 1, name: 'Player1', chips: 1000 }),
        new AddPlayerAction({ id: 2, name: 'Player2', chips: 2000 }),
        {
          execute: async () => { throw new Error('ì˜ë„ì  ì‹¤íŒ¨'); },
          undo: async () => { }
        }
      ];

      try {
        await window.batchProcessor.processBatch(actions);
      } catch (error) {
        addLog('ì˜ˆìƒëœ ì‹¤íŒ¨ ë°œìƒ - ë¡¤ë°± ì¤‘...', 'warning');
      }

      const finalCount = testPlayers.length;
      const rollbackSuccess = initialCount === finalCount;

      testResults.rollbackTests++;
      if (rollbackSuccess) testResults.rollbackSuccess++;

      const rate = (testResults.rollbackSuccess / testResults.rollbackTests * 100).toFixed(0);
      document.getElementById('rollback-rate').textContent = `${rate}%`;
      document.getElementById('rollback-result').textContent = rate == 100 ? 'âœ…' : 'âŒ';

      updateCheck('check-rollback', rollbackSuccess);
      addLog(rollbackSuccess ? 'âœ… ë¡¤ë°± ì„±ê³µ!' : 'âŒ ë¡¤ë°± ì‹¤íŒ¨', rollbackSuccess ? 'success' : 'error');
    }

    // ì‹œë‚˜ë¦¬ì˜¤: ì—°ì† ì‚­ì œ
    async function scenarioConsecutiveDelete() {
      addLog('ğŸ” ì‹œë‚˜ë¦¬ì˜¤: ì—°ì† 5ëª… ì‚­ì œ â†’ ì‹¤í–‰ì·¨ì†Œ', 'warning');

      // 5ëª… ì¶”ê°€
      for (let i = 0; i < 5; i++) {
        testPlayers.push({ id: i + 100, name: `ConsPlayer${i}`, chips: 1000 });
      }

      // ì—°ì† ì‚­ì œ
      for (let i = 0; i < 5; i++) {
        const action = new DeletePlayerAction(testPlayers[0]);
        await window.actionHistory.execute(action);
        addLog(`ì‚­ì œ ${i + 1}/5 ì™„ë£Œ`, 'info');
      }

      // ëª¨ë‘ ì‹¤í–‰ì·¨ì†Œ
      for (let i = 0; i < 5; i++) {
        await window.actionHistory.undo();
        addLog(`ì‹¤í–‰ì·¨ì†Œ ${i + 1}/5 ì™„ë£Œ`, 'info');
      }

      addLog('âœ… ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ: ëª¨ë“  í”Œë ˆì´ì–´ ë³µì›ë¨', 'success');
    }

    // ì‹œë‚˜ë¦¬ì˜¤: ì¼ê´„ ì‹¤íŒ¨
    async function scenarioBatchFailure() {
      addLog('ğŸ’¥ ì‹œë‚˜ë¦¬ì˜¤: ì¼ê´„ ì‘ì—… ì¤‘ ì‹¤íŒ¨ â†’ ë¡¤ë°±', 'warning');

      const actions = [];
      for (let i = 0; i < 5; i++) {
        actions.push(new AddPlayerAction({ id: 200 + i, name: `FailPlayer${i}`, chips: 1000 }));
      }

      // ì¤‘ê°„ì— ì‹¤íŒ¨í•˜ëŠ” ì•¡ì…˜ ì¶”ê°€
      actions.push({
        execute: async () => { throw new Error('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œë®¬ë ˆì´ì…˜'); },
        undo: async () => { }
      });

      try {
        await window.batchProcessor.processBatch(actions);
      } catch (error) {
        addLog(`âœ… ì˜ˆìƒëœ ì‹¤íŒ¨ ë° ë¡¤ë°± ì™„ë£Œ: ${error.message}`, 'success');
      }
    }

    // ì‹œë‚˜ë¦¬ì˜¤: ë”ë¸”íƒ­ ì·¨ì†Œ
    async function scenarioDoubleTapCancel() {
      addLog('ğŸš« ì‹œë‚˜ë¦¬ì˜¤: ë”ë¸”íƒ­ 1íšŒë§Œ â†’ ì‘ì—… ì·¨ì†Œ', 'warning');

      const button = document.createElement('button');
      button.textContent = 'í…ŒìŠ¤íŠ¸ ë²„íŠ¼';
      let executed = false;

      window.doubleTapHandler.setupButton(button, () => {
        executed = true;
      }, 'warning');

      // ì²« ë²ˆì§¸ íƒ­ë§Œ
      button.click();
      addLog('ì²« ë²ˆì§¸ íƒ­ - ëŒ€ê¸° ì¤‘...', 'info');

      // 2.5ì´ˆ í›„ í™•ì¸ (íƒ€ì„ì•„ì›ƒ í›„)
      setTimeout(() => {
        if (!executed) {
          addLog('âœ… ë”ë¸”íƒ­ íƒ€ì„ì•„ì›ƒ - ì‘ì—… ì·¨ì†Œë¨', 'success');
        } else {
          addLog('âŒ ì˜ˆìƒì¹˜ ì•Šì€ ì‹¤í–‰', 'error');
        }
      }, 2500);
    }

    // ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
    async function runFullScenario() {
      addLog('ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰ ì‹œì‘...', 'warning');

      await testImmediateDeletion();
      await new Promise(r => setTimeout(r, 1000));

      await testBatchProcessing();
      await new Promise(r => setTimeout(r, 1000));

      await testRollback();
      await new Promise(r => setTimeout(r, 1000));

      await testDoubleTap();
      await new Promise(r => setTimeout(r, 2500));

      await scenarioConsecutiveDelete();
      await new Promise(r => setTimeout(r, 1000));

      await scenarioBatchFailure();

      // ìµœì¢… ê²°ê³¼
      const checks = [
        'check-immediate-delete',
        'check-batch-transaction',
        'check-double-tap',
        'check-api-batch',
        'check-timer-conflict',
        'check-rollback',
        'check-phase1-compat'
      ];

      const passed = checks.filter(id => {
        const icon = document.getElementById(`${id}-icon`);
        return icon && icon.textContent === 'âœ…';
      }).length;

      const finalResult = document.getElementById('final-result');
      if (passed === checks.length) {
        finalResult.innerHTML = `
          <span class="text-green-400 text-2xl font-bold">âœ… Phase 2 ê²€ì¦ í†µê³¼!</span>
          <div class="mt-2">ëª¨ë“  í…ŒìŠ¤íŠ¸ (${passed}/${checks.length}) í†µê³¼</div>
        `;
      } else {
        finalResult.innerHTML = `
          <span class="text-red-400 text-2xl font-bold">âŒ Phase 2 ê²€ì¦ ì‹¤íŒ¨</span>
          <div class="mt-2">í†µê³¼: ${passed}/${checks.length}</div>
        `;
      }

      // ì„±ëŠ¥ ìš”ì•½
      const summary = document.getElementById('performance-summary');
      const avgDelete = testResults.deleteTimes.length > 0
        ? (testResults.deleteTimes.reduce((a, b) => a + b, 0) / testResults.deleteTimes.length).toFixed(2)
        : 'N/A';
      const avgBatch = testResults.batchTimes.length > 0
        ? (testResults.batchTimes.reduce((a, b) => a + b, 0) / testResults.batchTimes.length).toFixed(2)
        : 'N/A';

      summary.innerHTML = `
        <div class="bg-gray-700 p-3 rounded">
          <div class="font-bold">í‰ê·  ì‚­ì œ ì‹œê°„</div>
          <div class="text-2xl">${avgDelete}ms</div>
        </div>
        <div class="bg-gray-700 p-3 rounded">
          <div class="font-bold">í‰ê·  ë°°ì¹˜ ì‹œê°„</div>
          <div class="text-2xl">${avgBatch}ms</div>
        </div>
      `;

      addLog('ğŸ“Š ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ!', 'success');
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë”ë¸”íƒ­ ë²„íŠ¼ ì„¤ì •
    window.addEventListener('load', () => {
      const dangerBtn = document.getElementById('danger-button');
      if (dangerBtn && window.doubleTapHandler) {
        window.doubleTapHandler.setupButton(dangerBtn, () => {
          window.actionHistory.showSnackbar('âš ï¸ ìœ„í—˜ ì‘ì—…ì´ ì‹¤í–‰ë˜ì—ˆìŠµë‹ˆë‹¤!', null, 'error');
        }, 'critical');
      }

      // 3ì´ˆ í›„ ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘
      setTimeout(() => {
        addLog('ğŸ¤– ìë™ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
        runFullScenario();
      }, 3000);
    });
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/phase-verification/phase3-verification.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 3 ê²€ì¦ - ëª¨ë°”ì¼ ìµœì í™”</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #ff6b6b, #ee5a24);
      color: white;
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .test-section {
      padding: 30px;
      border-bottom: 1px solid #e5e7eb;
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-section h2 {
      color: #1f2937;
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
    }

    .test-section h2::before {
      content: attr(data-icon);
      font-size: 1.2em;
      margin-right: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-item {
      background: #f9fafb;
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .test-item:hover {
      border-color: #3b82f6;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
    }

    .test-item.passed {
      border-color: #10b981;
      background: #ecfdf5;
    }

    .test-item.failed {
      border-color: #ef4444;
      background: #fef2f2;
    }

    .test-item h3 {
      color: #1f2937;
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .test-item p {
      color: #6b7280;
      font-size: 0.9em;
      margin-bottom: 12px;
    }

    .test-result {
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.85em;
    }

    .test-result.passed {
      background: #d1fae5;
      color: #065f46;
    }

    .test-result.failed {
      background: #fee2e2;
      color: #991b1b;
    }

    .test-result.pending {
      background: #fef3c7;
      color: #92400e;
    }

    .demo-area {
      background: #f3f4f6;
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }

    .button-demo {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .demo-button {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 44px;
      min-height: 44px;
    }

    .demo-button.primary {
      background: #3b82f6;
      color: white;
    }

    .demo-button.danger {
      background: #ef4444;
      color: white;
    }

    .demo-button.success {
      background: #10b981;
      color: white;
    }

    .virtual-scroll-demo {
      height: 300px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      overflow: hidden;
    }

    .swipe-demo {
      background: #ddd6fe;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      border: 2px dashed #8b5cf6;
      margin: 15px 0;
    }

    .logs {
      background: #1f2937;
      color: #e5e7eb;
      border-radius: 8px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .progress {
      width: 100%;
      height: 8px;
      background: #e5e7eb;
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #3b82f6, #1d4ed8);
      transition: width 0.3s ease;
      width: 0%;
    }

    .stats {
      display: flex;
      justify-content: space-around;
      background: #f8fafc;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 2em;
      font-weight: bold;
      color: #1f2937;
    }

    .stat-label {
      color: #6b7280;
      font-size: 0.9em;
      margin-top: 5px;
    }

    @media (max-width: 768px) {
      .container {
        margin: 10px;
        border-radius: 12px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 2em;
      }

      .test-section {
        padding: 20px;
      }

      .test-grid {
        grid-template-columns: 1fr;
      }

      .stats {
        flex-direction: column;
        gap: 15px;
      }
    }

    .long-press-demo {
      background: #fef3c7;
      border: 2px dashed #f59e0b;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin: 10px 0;
    }

    .offline-status {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9em;
      font-weight: 500;
    }

    .offline-status.online {
      background: #d1fae5;
      color: #065f46;
    }

    .offline-status.offline {
      background: #fee2e2;
      color: #991b1b;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ Phase 3 ê²€ì¦</h1>
      <p>ëª¨ë°”ì¼ ìµœì í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- ì „ì²´ ì§„í–‰ë¥  -->
    <div class="test-section">
      <h2 data-icon="ğŸ“Š">ì „ì²´ ì§„í–‰ë¥ </h2>
      <div class="progress">
        <div class="progress-bar" id="overall-progress"></div>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="stat-value" id="passed-count">0</div>
          <div class="stat-label">í†µê³¼</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="failed-count">0</div>
          <div class="stat-label">ì‹¤íŒ¨</div>
        </div>
        <div class="stat">
          <div class="stat-value" id="total-count">0</div>
          <div class="stat-label">ì „ì²´</div>
        </div>
      </div>
    </div>

    <!-- 1. í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™” -->
    <div class="test-section">
      <h2 data-icon="ğŸ‘†">í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”</h2>
      <div class="test-grid">
        <div class="test-item" id="test-touch-size">
          <h3>ìµœì†Œ í„°ì¹˜ í¬ê¸° (44x44px)</h3>
          <p>ëª¨ë“  í„°ì¹˜ ê°€ëŠ¥í•œ ìš”ì†Œê°€ ìµœì†Œ í¬ê¸°ë¥¼ ë§Œì¡±í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-touch-response">
          <h3>í„°ì¹˜ ì‘ë‹µ ì‹œê°„</h3>
          <p>í„°ì¹˜ ì´ë²¤íŠ¸ ì‘ë‹µ ì‹œê°„ì´ 50ms ì´í•˜ì¸ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-double-tap-prevention">
          <h3>ë”ë¸”íƒ­ ì¤Œ ë°©ì§€</h3>
          <p>ì˜ë„í•˜ì§€ ì•Šì€ ë”ë¸”íƒ­ ì¤Œì´ ë°©ì§€ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <h4>í„°ì¹˜ í…ŒìŠ¤íŠ¸ ë²„íŠ¼ë“¤</h4>
        <div class="button-demo">
          <button class="demo-button primary" data-test="touch">í„°ì¹˜ í…ŒìŠ¤íŠ¸</button>
          <button class="demo-button success" data-test="response">ì‘ë‹µ ì‹œê°„</button>
          <button class="demo-button danger" data-test="double-tap">ë”ë¸”íƒ­ ë°©ì§€</button>
        </div>
      </div>
    </div>

    <!-- 2. ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ -->
    <div class="test-section">
      <h2 data-icon="ğŸ‘‹">ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ</h2>
      <div class="test-grid">
        <div class="test-item" id="test-swipe-gesture">
          <h3>ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜</h3>
          <p>ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ë¡œ ì‹¤í–‰ì·¨ì†Œê°€ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-long-press">
          <h3>ë¡±í”„ë ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´</h3>
          <p>ë¡±í”„ë ˆìŠ¤ë¡œ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-haptic-feedback">
          <h3>í–…í‹± í”¼ë“œë°±</h3>
          <p>í„°ì¹˜ ì•¡ì…˜ì— í–…í‹± í”¼ë“œë°±ì´ ì œê³µë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <div class="swipe-demo" id="swipe-area">
          <p>ğŸš€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„í•´ë³´ì„¸ìš”!</p>
          <small>ìŠ¤ì™€ì´í”„í•˜ë©´ ì‹¤í–‰ì·¨ì†Œ ì•¡ì…˜ì´ ì‹¤í–‰ë©ë‹ˆë‹¤</small>
        </div>
        <div class="long-press-demo" data-long-press="player">
          <p>ğŸ‘† ì—¬ê¸°ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ë³´ì„¸ìš” (500ms)</p>
          <small>ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ê°€ í‘œì‹œë©ë‹ˆë‹¤</small>
        </div>
      </div>
    </div>

    <!-- 3. ê°€ìƒ ìŠ¤í¬ë¡¤ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“œ">ê°€ìƒ ìŠ¤í¬ë¡¤</h2>
      <div class="test-grid">
        <div class="test-item" id="test-virtual-scroll-performance">
          <h3>ì„±ëŠ¥ ìµœì í™”</h3>
          <p>1000ê°œ ì•„ì´í…œë„ ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-virtual-scroll-memory">
          <h3>ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±</h3>
          <p>DOM ìš”ì†Œê°€ ì¬í™œìš©ë˜ì–´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì¼ì •í•œì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <h4>ê°€ìƒ ìŠ¤í¬ë¡¤ ë°ëª¨ (1000ê°œ í”Œë ˆì´ì–´)</h4>
        <div class="virtual-scroll-demo" id="virtual-scroll-container"></div>
      </div>
    </div>

    <!-- 4. ì˜¤í”„ë¼ì¸ ì§€ì› -->
    <div class="test-section">
      <h2 data-icon="ğŸ“±">ì˜¤í”„ë¼ì¸ ì§€ì›</h2>
      <div class="test-grid">
        <div class="test-item" id="test-indexeddb">
          <h3>IndexedDB ì €ì¥</h3>
          <p>ë°ì´í„°ê°€ IndexedDBì— ì €ì¥ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-offline-mode">
          <h3>ì˜¤í”„ë¼ì¸ ëª¨ë“œ</h3>
          <p>ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì—†ì´ë„ ì•±ì´ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
        <div class="test-item" id="test-sync-queue">
          <h3>ë™ê¸°í™” í</h3>
          <p>ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ ë°ì´í„°ê°€ ë™ê¸°í™”ë˜ëŠ”ì§€ í™•ì¸</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <div class="demo-area">
        <div class="offline-status" id="offline-status">
          <span>ğŸŒ</span>
          <span>ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</span>
        </div>
        <div class="button-demo">
          <button class="demo-button primary" id="save-offline-btn">ì˜¤í”„ë¼ì¸ ì €ì¥</button>
          <button class="demo-button success" id="load-offline-btn">ì˜¤í”„ë¼ì¸ ë¡œë“œ</button>
          <button class="demo-button danger" id="simulate-offline-btn">ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜</button>
        </div>
      </div>
    </div>

    <!-- ë¡œê·¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“‹">í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div class="logs" id="test-logs">
        <div>Phase 3 í…ŒìŠ¤íŠ¸ ì‹œì‘...</div>
      </div>
    </div>
  </div>

  <!-- Phase 3 ëª¨ë“ˆë“¤ ë¡œë“œ -->
  <script src="action-history.js"></script>
  <script src="mobile-optimizer.js"></script>
  <script src="virtual-scroll.js"></script>
  <script src="offline-storage.js"></script>

  <script>
    class Phase3Tester {
      constructor() {
        this.tests = [];
        this.passedCount = 0;
        this.failedCount = 0;
        this.totalCount = 0;

        this.init();
      }

      init() {
        this.setupTests();
        this.startTesting();
        this.setupDemoHandlers();
      }

      setupTests() {
        // í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ í…ŒìŠ¤íŠ¸
        this.addTest('test-touch-size', 'í„°ì¹˜ í¬ê¸° ê²€ì‚¬', this.testTouchSize.bind(this));
        this.addTest('test-touch-response', 'í„°ì¹˜ ì‘ë‹µ ì‹œê°„', this.testTouchResponse.bind(this));
        this.addTest('test-double-tap-prevention', 'ë”ë¸”íƒ­ ë°©ì§€', this.testDoubleTapPrevention.bind(this));

        // ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        this.addTest('test-swipe-gesture', 'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜', this.testSwipeGesture.bind(this));
        this.addTest('test-long-press', 'ë¡±í”„ë ˆìŠ¤', this.testLongPress.bind(this));
        this.addTest('test-haptic-feedback', 'í–…í‹± í”¼ë“œë°±', this.testHapticFeedback.bind(this));

        // ê°€ìƒ ìŠ¤í¬ë¡¤ í…ŒìŠ¤íŠ¸
        this.addTest('test-virtual-scroll-performance', 'ê°€ìƒ ìŠ¤í¬ë¡¤ ì„±ëŠ¥', this.testVirtualScrollPerformance.bind(this));
        this.addTest('test-virtual-scroll-memory', 'ê°€ìƒ ìŠ¤í¬ë¡¤ ë©”ëª¨ë¦¬', this.testVirtualScrollMemory.bind(this));

        // ì˜¤í”„ë¼ì¸ ì§€ì› í…ŒìŠ¤íŠ¸
        this.addTest('test-indexeddb', 'IndexedDB', this.testIndexedDB.bind(this));
        this.addTest('test-offline-mode', 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ', this.testOfflineMode.bind(this));
        this.addTest('test-sync-queue', 'ë™ê¸°í™” í', this.testSyncQueue.bind(this));

        this.totalCount = this.tests.length;
        document.getElementById('total-count').textContent = this.totalCount;
      }

      addTest(id, name, testFunc) {
        this.tests.push({ id, name, testFunc });
      }

      async startTesting() {
        this.log('ğŸ§ª Phase 3 í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        for (const test of this.tests) {
          try {
            this.log(`âš¡ ${test.name} í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...`);
            const passed = await test.testFunc();
            this.updateTestResult(test.id, passed);
          } catch (error) {
            this.log(`âŒ ${test.name} í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`);
            this.updateTestResult(test.id, false);
          }

          await this.delay(500); // í…ŒìŠ¤íŠ¸ ê°„ ë”œë ˆì´
        }

        this.log('âœ… Phase 3 í…ŒìŠ¤íŠ¸ ì™„ë£Œ!');
        this.showFinalResults();
      }

      async testTouchSize() {
        const buttons = document.querySelectorAll('button, [role="button"]');
        let allValid = true;

        buttons.forEach(button => {
          const rect = button.getBoundingClientRect();
          if (rect.width < 44 || rect.height < 44) {
            allValid = false;
            this.log(`âš ï¸ í„°ì¹˜ í¬ê¸° ë¶€ì¡±: ${button.textContent} (${rect.width}x${rect.height})`);
          }
        });

        return allValid;
      }

      async testTouchResponse() {
        return new Promise((resolve) => {
          const button = document.querySelector('[data-test="response"]');
          const startTime = performance.now();

          const handler = () => {
            const responseTime = performance.now() - startTime;
            this.log(`â±ï¸ í„°ì¹˜ ì‘ë‹µ ì‹œê°„: ${responseTime.toFixed(2)}ms`);
            button.removeEventListener('touchend', handler);
            resolve(responseTime <= 50);
          };

          button.addEventListener('touchend', handler);

          // ìë™ íŠ¸ë¦¬ê±° (ëª¨ë°”ì¼ì´ ì•„ë‹Œ ê²½ìš°)
          setTimeout(() => {
            if (button.onclick) {
              button.click();
              const responseTime = performance.now() - startTime;
              this.log(`â±ï¸ í´ë¦­ ì‘ë‹µ ì‹œê°„: ${responseTime.toFixed(2)}ms`);
              resolve(responseTime <= 50);
            }
          }, 100);
        });
      }

      async testDoubleTapPrevention() {
        // ë”ë¸”íƒ­ ë°©ì§€ ë¡œì§ì´ ìˆëŠ”ì§€ í™•ì¸
        const hasPreventionLogic = document.addEventListener.toString().includes('touchend');
        return hasPreventionLogic;
      }

      async testSwipeGesture() {
        return window.mobileOptimizer && typeof window.mobileOptimizer.handleSwipe === 'function';
      }

      async testLongPress() {
        return window.mobileOptimizer && typeof window.mobileOptimizer.handleLongPress === 'function';
      }

      async testHapticFeedback() {
        return navigator.vibrate !== undefined || window.mobileOptimizer?.hasVibration;
      }

      async testVirtualScrollPerformance() {
        if (!window.VirtualScroll) return false;

        const container = document.getElementById('virtual-scroll-container');
        const virtualScroll = new window.PlayerVirtualScroll(container);

        // 1000ê°œ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
        const testData = Array.from({length: 1000}, (_, i) => ({
          id: i,
          name: `í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´ ${i + 1}`,
          chips: Math.floor(Math.random() * 10000),
          status: i % 10 === 0 ? 'OUT' : 'IN'
        }));

        virtualScroll.setItems(testData);
        this.log(`ğŸ“œ ê°€ìƒ ìŠ¤í¬ë¡¤: ${testData.length}ê°œ ì•„ì´í…œ ë Œë”ë§ ì™„ë£Œ`);

        return true;
      }

      async testVirtualScrollMemory() {
        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬ (ê°€ëŠ¥í•œ ê²½ìš°)
        if (performance.memory) {
          const before = performance.memory.usedJSHeapSize;
          await this.testVirtualScrollPerformance();
          const after = performance.memory.usedJSHeapSize;
          const increase = after - before;
          this.log(`ğŸ’¾ ë©”ëª¨ë¦¬ ì¦ê°€ëŸ‰: ${(increase / 1024 / 1024).toFixed(2)} MB`);
          return increase < 5 * 1024 * 1024; // 5MB ì´í•˜
        }
        return true;
      }

      async testIndexedDB() {
        if (!window.offlineStorage) return false;

        try {
          // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥
          await window.offlineStorage.save('players', {
            id: 'test-player',
            name: 'í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´',
            chips: 1000
          });

          // ë°ì´í„° ì¡°íšŒ
          const saved = await window.offlineStorage.get('players', 'test-player');
          this.log('ğŸ’¾ IndexedDB ì €ì¥/ë¡œë“œ ì„±ê³µ');
          return saved && saved.name === 'í…ŒìŠ¤íŠ¸ í”Œë ˆì´ì–´';
        } catch (error) {
          this.log(`âŒ IndexedDB ì˜¤ë¥˜: ${error.message}`);
          return false;
        }
      }

      async testOfflineMode() {
        return window.offlineStorage && typeof window.offlineStorage.isOffline === 'function';
      }

      async testSyncQueue() {
        if (!window.offlineStorage) return false;

        const status = await window.offlineStorage.getSyncStatus();
        this.log(`ğŸ”„ ë™ê¸°í™” ìƒíƒœ: ${status.isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}`);
        return typeof status.pendingSync === 'number';
      }

      updateTestResult(testId, passed) {
        const element = document.getElementById(testId);
        const resultEl = element.querySelector('.test-result');

        if (passed) {
          element.classList.add('passed');
          resultEl.classList.add('passed');
          resultEl.textContent = 'âœ… í†µê³¼';
          this.passedCount++;
        } else {
          element.classList.add('failed');
          resultEl.classList.add('failed');
          resultEl.textContent = 'âŒ ì‹¤íŒ¨';
          this.failedCount++;
        }

        this.updateProgress();
      }

      updateProgress() {
        const progress = ((this.passedCount + this.failedCount) / this.totalCount) * 100;
        document.getElementById('overall-progress').style.width = progress + '%';
        document.getElementById('passed-count').textContent = this.passedCount;
        document.getElementById('failed-count').textContent = this.failedCount;
      }

      showFinalResults() {
        const successRate = (this.passedCount / this.totalCount * 100).toFixed(1);
        this.log(`ğŸ“Š ìµœì¢… ê²°ê³¼: ${this.passedCount}/${this.totalCount} í†µê³¼ (${successRate}%)`);

        if (this.passedCount === this.totalCount) {
          this.log('ğŸ‰ Phase 3 ê²€ì¦ ì™„ë£Œ! ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼');
        } else {
          this.log(`âš ï¸ ${this.failedCount}ê°œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ - ì¶”ê°€ í™•ì¸ í•„ìš”`);
        }
      }

      setupDemoHandlers() {
        // ì˜¤í”„ë¼ì¸ ìƒíƒœ í‘œì‹œ
        this.updateOfflineStatus();
        window.addEventListener('online', () => this.updateOfflineStatus());
        window.addEventListener('offline', () => this.updateOfflineStatus());

        // ë°ëª¨ ë²„íŠ¼ í•¸ë“¤ëŸ¬
        document.getElementById('save-offline-btn')?.addEventListener('click', async () => {
          if (window.offlineStorage) {
            await window.offlineStorage.save('players', {
              id: Date.now(),
              name: 'ì˜¤í”„ë¼ì¸ í…ŒìŠ¤íŠ¸',
              chips: 5000
            });
            this.log('ğŸ’¾ ì˜¤í”„ë¼ì¸ ë°ì´í„° ì €ì¥ë¨');
          }
        });

        document.getElementById('simulate-offline-btn')?.addEventListener('click', () => {
          // ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('offline'));
          this.log('ğŸ“± ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì‹œë®¬ë ˆì´ì…˜');

          setTimeout(() => {
            window.dispatchEvent(new Event('online'));
            this.log('ğŸŒ ì˜¨ë¼ì¸ ëª¨ë“œ ë³µêµ¬');
          }, 3000);
        });
      }

      updateOfflineStatus() {
        const statusEl = document.getElementById('offline-status');
        const isOnline = navigator.onLine;

        statusEl.className = 'offline-status ' + (isOnline ? 'online' : 'offline');
        statusEl.innerHTML = `
          <span>${isOnline ? 'ğŸŒ' : 'ğŸ“±'}</span>
          <span>${isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}</span>
        `;
      }

      log(message) {
        const logs = document.getElementById('test-logs');
        const timestamp = new Date().toLocaleTimeString();
        logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        logs.scrollTop = logs.scrollHeight;
      }

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ì‹œì‘
    document.addEventListener('DOMContentLoaded', () => {
      new Phase3Tester();
    });
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/phase-verification/phase4-device-testing.html">
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 4 ê¸°ê¸° í…ŒìŠ¤íŠ¸ - ì‹¤ë¬´ í™˜ê²½ ê²€ì¦</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
      min-height: 100vh;
      padding: 10px;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      overflow: hidden;
    }

    .header {
      background: linear-gradient(45deg, #e53e3e, #d53f8c);
      padding: 30px;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      font-weight: 700;
    }

    .header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .device-info {
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .device-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .device-stat {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .device-stat h3 {
      font-size: 0.9em;
      opacity: 0.8;
      margin-bottom: 8px;
    }

    .device-stat .value {
      font-size: 1.5em;
      font-weight: bold;
      color: #68d391;
    }

    .test-section {
      padding: 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .test-section:last-child {
      border-bottom: none;
    }

    .test-section h2 {
      margin-bottom: 20px;
      font-size: 1.5em;
      display: flex;
      align-items: center;
    }

    .test-section h2::before {
      content: attr(data-icon);
      font-size: 1.2em;
      margin-right: 10px;
    }

    .test-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .test-item {
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .test-item:hover {
      border-color: #3182ce;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(49, 130, 206, 0.3);
    }

    .test-item.passed {
      border-color: #38a169;
      background: rgba(56, 161, 105, 0.1);
    }

    .test-item.failed {
      border-color: #e53e3e;
      background: rgba(229, 62, 62, 0.1);
    }

    .test-item.running {
      border-color: #ed8936;
      background: rgba(237, 137, 54, 0.1);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .test-item h3 {
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .test-item p {
      opacity: 0.8;
      font-size: 0.9em;
      margin-bottom: 12px;
    }

    .test-result {
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.85em;
      display: inline-block;
    }

    .test-result.passed {
      background: rgba(56, 161, 105, 0.2);
      color: #68d391;
    }

    .test-result.failed {
      background: rgba(229, 62, 62, 0.2);
      color: #fc8181;
    }

    .test-result.pending {
      background: rgba(237, 137, 54, 0.2);
      color: #f6ad55;
    }

    .test-result.running {
      background: rgba(66, 153, 225, 0.2);
      color: #90cdf4;
    }

    .stress-test-area {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 20px;
      margin-top: 15px;
    }

    .stress-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }

    .stress-button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      min-width: 44px;
      min-height: 44px;
    }

    .stress-button.start {
      background: #38a169;
      color: white;
    }

    .stress-button.stop {
      background: #e53e3e;
      color: white;
    }

    .stress-button.reset {
      background: #3182ce;
      color: white;
    }

    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .metric {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .metric-value {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .metric-label {
      font-size: 0.85em;
      opacity: 0.8;
    }

    .metric.good .metric-value { color: #68d391; }
    .metric.warning .metric-value { color: #f6ad55; }
    .metric.danger .metric-value { color: #fc8181; }

    .logs {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 15px;
    }

    .progress-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin: 0 auto 10px;
    }

    .progress-circle.completed {
      background: conic-gradient(#38a169 var(--progress, 0%), rgba(255,255,255,0.1) 0%);
    }

    .device-compatibility {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }

    .device-test {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 15px;
      border-left: 4px solid transparent;
    }

    .device-test.unknown { border-left-color: #a0aec0; }
    .device-test.testing { border-left-color: #3182ce; }
    .device-test.passed { border-left-color: #38a169; }
    .device-test.failed { border-left-color: #e53e3e; }

    .device-test h4 {
      margin-bottom: 8px;
      font-size: 1em;
    }

    .device-test .device-specs {
      font-size: 0.8em;
      opacity: 0.7;
      margin-bottom: 8px;
    }

    .scenario-test {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      padding: 20px;
      margin: 10px 0;
    }

    .scenario-test h4 {
      margin-bottom: 10px;
      color: #90cdf4;
    }

    .scenario-steps {
      list-style: none;
      padding: 0;
    }

    .scenario-steps li {
      padding: 5px 0;
      border-left: 2px solid transparent;
      padding-left: 15px;
      margin: 5px 0;
    }

    .scenario-steps li.completed { border-left-color: #38a169; color: #68d391; }
    .scenario-steps li.current { border-left-color: #3182ce; color: #90cdf4; }
    .scenario-steps li.failed { border-left-color: #e53e3e; color: #fc8181; }

    @media (max-width: 768px) {
      .container {
        margin: 5px;
        border-radius: 12px;
      }

      .header {
        padding: 20px;
      }

      .header h1 {
        font-size: 2em;
      }

      .test-section {
        padding: 20px;
      }

      .test-grid {
        grid-template-columns: 1fr;
      }

      .device-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .metrics {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ Phase 4 ì‹¤ë¬´ ê²€ì¦</h1>
      <p>ì‹¤ì œ í™˜ê²½ì—ì„œì˜ ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- ê¸°ê¸° ì •ë³´ -->
    <div class="device-info">
      <h2 data-icon="ğŸ“±">í˜„ì¬ ê¸°ê¸° ì •ë³´</h2>
      <div class="device-grid">
        <div class="device-stat">
          <h3>ê¸°ê¸°</h3>
          <div class="value" id="device-name">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë¸Œë¼ìš°ì €</h3>
          <div class="value" id="browser-name">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>í™”ë©´ í¬ê¸°</h3>
          <div class="value" id="screen-size">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë©”ëª¨ë¦¬</h3>
          <div class="value" id="memory-info">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>ë„¤íŠ¸ì›Œí¬</h3>
          <div class="value" id="network-info">ê°ì§€ ì¤‘...</div>
        </div>
        <div class="device-stat">
          <h3>í„°ì¹˜ ì§€ì›</h3>
          <div class="value" id="touch-support">ê°ì§€ ì¤‘...</div>
        </div>
      </div>
    </div>

    <!-- ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“±">ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ (10ì¢…)</h2>
      <div class="device-compatibility">
        <div class="device-test unknown" id="iphone-12-mini">
          <h4>iPhone 12 mini</h4>
          <div class="device-specs">iOS 14+, A14 Bionic, 5.4"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="iphone-14-pro">
          <h4>iPhone 14 Pro</h4>
          <div class="device-specs">iOS 16+, A16 Bionic, 6.1"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="galaxy-s23">
          <h4>Galaxy S23</h4>
          <div class="device-specs">Android 13, Snapdragon 8 Gen 2, 6.1"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="galaxy-a32">
          <h4>Galaxy A32</h4>
          <div class="device-specs">Android 11, MediaTek Helio G80, 6.4"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test unknown" id="ipad-mini">
          <h4>iPad mini</h4>
          <div class="device-specs">iPadOS 15+, A15 Bionic, 8.3"</div>
          <div class="test-result pending">í…ŒìŠ¤íŠ¸ ëŒ€ê¸°</div>
        </div>
        <div class="device-test testing" id="current-device">
          <h4>í˜„ì¬ ê¸°ê¸°</h4>
          <div class="device-specs" id="current-specs">ìë™ ê°ì§€ ì¤‘...</div>
          <div class="test-result running">í…ŒìŠ¤íŠ¸ ì¤‘</div>
        </div>
      </div>
    </div>

    <!-- ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ¯">ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸</h2>
      <div class="test-grid">
        <div class="test-item" id="scenario-1">
          <h3>30ì´ˆ ë‚´ 10ëª… ë“±ë¡</h3>
          <p>ë¹ ë¥¸ í”Œë ˆì´ì–´ ë“±ë¡ ì‹œë‚˜ë¦¬ì˜¤ (ë”œëŸ¬ í…ŒìŠ¤íŠ¸)</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>10ëª… ì—°ì† ì¶”ê°€ (3ì´ˆ/ëª…)</li>
              <li>ì¹© ê¸ˆì•¡ ì…ë ¥ (ê° ë‹¤ë¥¸ ê¸ˆì•¡)</li>
              <li>IN ìƒíƒœ í™•ì¸</li>
              <li>ì´ ì†Œìš” ì‹œê°„ ì¸¡ì •</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-2">
          <h3>ê²Œì„ ì¤‘ ë¹ ë¥¸ ì¹© ì—…ë°ì´íŠ¸</h3>
          <p>ì‹¤ì‹œê°„ ì¹© ë³€ë™ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>ë² íŒ… ë¼ìš´ë“œ ì‹œë®¬ë ˆì´ì…˜</li>
              <li>5ëª… ë™ì‹œ ì¹© ë³€ê²½</li>
              <li>API ë™ê¸°í™” í™•ì¸</li>
              <li>UI ì—…ë°ì´íŠ¸ ê²€ì¦</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-3">
          <h3>ì‹¤ìˆ˜ 3ì´ˆ ë‚´ ë³µêµ¬</h3>
          <p>ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ í™œìš© ì‹œë‚˜ë¦¬ì˜¤</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>ì˜ëª»ëœ í”Œë ˆì´ì–´ ì‚­ì œ</li>
              <li>3ì´ˆ ë‚´ ì‹¤í–‰ì·¨ì†Œ</li>
              <li>ë°ì´í„° ë³µì› í™•ì¸</li>
              <li>ì—°ì† 5íšŒ ë°˜ë³µ</li>
            </ul>
          </div>
        </div>
        <div class="test-item" id="scenario-4">
          <h3>2ì‹œê°„ ì—°ì† ì‚¬ìš© ì•ˆì •ì„±</h3>
          <p>ì¥ì‹œê°„ ìš´ì˜ ì•ˆì •ì„± ê²€ì¦</p>
          <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
          <div class="scenario-test">
            <h4>í…ŒìŠ¤íŠ¸ ë‹¨ê³„</h4>
            <ul class="scenario-steps">
              <li>2ì‹œê°„ ì—°ì† ì‘ì—… ì‹œë®¬ë ˆì´ì…˜</li>
              <li>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ëª¨ë‹ˆí„°ë§</li>
              <li>ì„±ëŠ¥ ì €í•˜ í™•ì¸</li>
              <li>ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ ì²´í¬</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ’ª">ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸</h2>
      <div class="stress-test-area">
        <div class="stress-controls">
          <button class="stress-button start" id="start-stress">ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
          <button class="stress-button stop" id="stop-stress">ì¤‘ì§€</button>
          <button class="stress-button reset" id="reset-stress">ë¦¬ì…‹</button>
        </div>

        <div class="test-grid">
          <div class="test-item" id="stress-players">
            <h3>100ëª… í”Œë ˆì´ì–´ ë™ì‹œ ê´€ë¦¬</h3>
            <p>ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì„±ëŠ¥ ì¸¡ì •</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-operations">
            <h3>1000íšŒ ì—°ì† ì‘ì—…</h3>
            <p>ë°˜ë³µ ì‘ì—… ì•ˆì •ì„± ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-memory">
            <h3>24ì‹œê°„ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§</h3>
            <p>ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì¥ê¸° ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
          <div class="test-item" id="stress-network">
            <h3>ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ/ë³µêµ¬ 50íšŒ</h3>
            <p>ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì•ˆì •ì„± ê²€ì¦</p>
            <div class="test-result pending">ëŒ€ê¸° ì¤‘</div>
            <div class="progress-circle completed" style="--progress: 0%">0%</div>
          </div>
        </div>

        <div class="metrics" id="stress-metrics">
          <div class="metric good">
            <div class="metric-value" id="avg-response">0ms</div>
            <div class="metric-label">í‰ê·  ì‘ë‹µì‹œê°„</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="p95-response">0ms</div>
            <div class="metric-label">P95 ì‘ë‹µì‹œê°„</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="memory-usage">0MB</div>
            <div class="metric-label">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="error-count">0</div>
            <div class="metric-label">ì—ëŸ¬ íšŸìˆ˜</div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="success-rate">100%</div>
            <div class="metric-label">ì„±ê³µë¥ </div>
          </div>
          <div class="metric good">
            <div class="metric-value" id="operations-total">0</div>
            <div class="metric-label">ì´ ì‘ì—… ìˆ˜</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ -->
    <div class="test-section">
      <h2 data-icon="âš¡">ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬</h2>
      <div class="test-grid">
        <div class="test-item" id="perf-response-avg">
          <h3>í‰ê·  ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 100ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-response-p95">
          <h3>P95 ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 200ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-response-p99">
          <h3>P99 ì‘ë‹µì‹œê°„</h3>
          <p>ëª©í‘œ: < 500ms</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-memory-avg">
          <h3>í‰ê·  ë©”ëª¨ë¦¬</h3>
          <p>ëª©í‘œ: < 15MB</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-memory-peak">
          <h3>í”¼í¬ ë©”ëª¨ë¦¬</h3>
          <p>ëª©í‘œ: < 20MB</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
        <div class="test-item" id="perf-fps">
          <h3>í™”ë©´ í”„ë ˆì„ë¥ </h3>
          <p>ëª©í‘œ: > 50fps</p>
          <div class="test-result pending">ì¸¡ì • ëŒ€ê¸°</div>
        </div>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ë¡œê·¸ -->
    <div class="test-section">
      <h2 data-icon="ğŸ“‹">ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ë¡œê·¸</h2>
      <div class="logs" id="test-logs">
        <div>[ì‹œì‘] Phase 4 ì‹¤ë¬´ ê²€ì¦ í…ŒìŠ¤íŠ¸ ì¤€ë¹„...</div>
      </div>
    </div>
  </div>

  <!-- í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
  <script src="action-history.js"></script>
  <script src="mobile-optimizer.js"></script>
  <script src="virtual-scroll.js"></script>
  <script src="offline-storage.js"></script>

  <script>
    class Phase4Tester {
      constructor() {
        this.testResults = new Map();
        this.stressTestRunning = false;
        this.performanceMetrics = {
          responseTimes: [],
          memoryUsage: [],
          errorCount: 0,
          operationsCount: 0
        };

        this.init();
      }

      init() {
        this.detectDeviceInfo();
        this.setupEventListeners();
        this.startCompatibilityTest();
        this.log('âœ… Phase 4 í…ŒìŠ¤í„° ì´ˆê¸°í™” ì™„ë£Œ');
      }

      detectDeviceInfo() {
        // ê¸°ê¸° ì •ë³´ ê°ì§€
        const userAgent = navigator.userAgent;
        const deviceName = this.getDeviceName(userAgent);
        const browserName = this.getBrowserName(userAgent);

        document.getElementById('device-name').textContent = deviceName;
        document.getElementById('browser-name').textContent = browserName;
        document.getElementById('screen-size').textContent =
          `${window.screen.width}Ã—${window.screen.height}`;

        // ë©”ëª¨ë¦¬ ì •ë³´
        if (navigator.deviceMemory) {
          document.getElementById('memory-info').textContent =
            `${navigator.deviceMemory}GB`;
        } else {
          document.getElementById('memory-info').textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // ë„¤íŠ¸ì›Œí¬ ì •ë³´
        if (navigator.connection) {
          const conn = navigator.connection;
          document.getElementById('network-info').textContent =
            `${conn.effectiveType || 'Unknown'}`;
        } else {
          document.getElementById('network-info').textContent = 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        // í„°ì¹˜ ì§€ì›
        document.getElementById('touch-support').textContent =
          'ontouchstart' in window ? 'ì§€ì›ë¨' : 'ë¯¸ì§€ì›';

        // í˜„ì¬ ê¸°ê¸° ìŠ¤í™ ì—…ë°ì´íŠ¸
        document.getElementById('current-specs').textContent =
          `${deviceName}, ${browserName}, ${window.screen.width}Ã—${window.screen.height}`;
      }

      getDeviceName(userAgent) {
        if (/iPhone/.test(userAgent)) {
          if (/iPhone.*12.*mini/.test(userAgent)) return 'iPhone 12 mini';
          if (/iPhone.*14.*Pro/.test(userAgent)) return 'iPhone 14 Pro';
          return 'iPhone (ê¸°íƒ€)';
        }
        if (/iPad/.test(userAgent)) return 'iPad';
        if (/Android/.test(userAgent)) {
          if (/SM-G/.test(userAgent)) return 'Galaxy (ì¶”ì •)';
          return 'Android ê¸°ê¸°';
        }
        if (/Windows/.test(userAgent)) return 'Windows PC';
        if (/Mac/.test(userAgent)) return 'Mac';
        return 'ì•Œ ìˆ˜ ì—†ëŠ” ê¸°ê¸°';
      }

      getBrowserName(userAgent) {
        if (/Chrome/.test(userAgent) && !/Edge/.test(userAgent)) return 'Chrome';
        if (/Safari/.test(userAgent) && !/Chrome/.test(userAgent)) return 'Safari';
        if (/Firefox/.test(userAgent)) return 'Firefox';
        if (/Edge/.test(userAgent)) return 'Edge';
        return 'ì•Œ ìˆ˜ ì—†ëŠ” ë¸Œë¼ìš°ì €';
      }

      setupEventListeners() {
        document.getElementById('start-stress').addEventListener('click', () => {
          this.startStressTest();
        });

        document.getElementById('stop-stress').addEventListener('click', () => {
          this.stopStressTest();
        });

        document.getElementById('reset-stress').addEventListener('click', () => {
          this.resetStressTest();
        });
      }

      async startCompatibilityTest() {
        this.log('ğŸ§ª ê¸°ê¸° í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        // í˜„ì¬ ê¸°ê¸° í…ŒìŠ¤íŠ¸
        await this.testCurrentDevice();

        // ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘
        await this.runScenarioTests();

        // ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰
        await this.runPerformanceBenchmarks();
      }

      async testCurrentDevice() {
        const currentDevice = document.getElementById('current-device');
        currentDevice.className = 'device-test testing';

        const tests = [
          { name: 'í„°ì¹˜ ì‘ë‹µ', test: () => this.testTouchResponse() },
          { name: 'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰', test: () => this.testMemoryUsage() },
          { name: 'ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬', test: () => this.testNetworkHandling() },
          { name: 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ', test: () => this.testOfflineMode() }
        ];

        let passedTests = 0;
        for (const test of tests) {
          try {
            const result = await test.test();
            if (result) passedTests++;
            this.log(`${result ? 'âœ…' : 'âŒ'} ${test.name}: ${result ? 'í†µê³¼' : 'ì‹¤íŒ¨'}`);
          } catch (error) {
            this.log(`âŒ ${test.name}: ì˜¤ë¥˜ - ${error.message}`);
          }
        }

        const success = passedTests === tests.length;
        currentDevice.className = `device-test ${success ? 'passed' : 'failed'}`;
        const resultEl = currentDevice.querySelector('.test-result');
        resultEl.className = `test-result ${success ? 'passed' : 'failed'}`;
        resultEl.textContent = success ? 'í†µê³¼' : 'ì‹¤íŒ¨';

        this.log(`ğŸ“± í˜„ì¬ ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passedTests}/${tests.length} í†µê³¼`);
      }

      async testTouchResponse() {
        // í„°ì¹˜ ì‘ë‹µ ì‹œê°„ í…ŒìŠ¤íŠ¸
        return new Promise((resolve) => {
          const testElement = document.createElement('div');
          testElement.style.cssText = 'width: 44px; height: 44px; position: fixed; top: -100px; z-index: -1;';
          document.body.appendChild(testElement);

          const startTime = performance.now();

          const cleanup = () => {
            if (testElement.parentNode) {
              document.body.removeChild(testElement);
            }
          };

          const handler = () => {
            const responseTime = performance.now() - startTime;
            cleanup();
            resolve(responseTime < 100); // 100msë¡œ ì™„í™”
          };

          // í„°ì¹˜ì™€ í´ë¦­ ëª¨ë‘ ì§€ì›
          testElement.addEventListener('touchend', handler, { once: true });
          testElement.addEventListener('click', handler, { once: true });

          // ê°€ìƒ í´ë¦­ íŠ¸ë¦¬ê±°
          setTimeout(() => {
            const event = new Event('click', { bubbles: true });
            testElement.dispatchEvent(event);
          }, 10);

          // ì•ˆì „ì¥ì¹˜ - 2ì´ˆ í›„ ê°•ì œ ì™„ë£Œ
          setTimeout(() => {
            cleanup();
            resolve(true); // ì¸¡ì • ë¶ˆê°€ ì‹œ í†µê³¼ë¡œ ì²˜ë¦¬
          }, 2000);
        });
      }

      async testMemoryUsage() {
        if (performance.memory) {
          const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
          return memoryMB < 20;
        }
        return true; // ë©”ëª¨ë¦¬ ì •ë³´ë¥¼ ì–»ì„ ìˆ˜ ì—†ìœ¼ë©´ í†µê³¼ë¡œ ì²˜ë¦¬
      }

      async testNetworkHandling() {
        // ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ (ê°„ë‹¨í•œ fetch)
        try {
          const response = await fetch(window.location.href, {
            method: 'HEAD',
            cache: 'no-cache'
          });
          return response.ok;
        } catch {
          return false;
        }
      }

      async testOfflineMode() {
        // ì˜¤í”„ë¼ì¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸
        return window.offlineStorage && typeof window.offlineStorage.isOffline === 'function';
      }

      async runScenarioTests() {
        this.log('ğŸ¯ ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        const scenarios = [
          { id: 'scenario-1', test: () => this.testPlayerRegistration() },
          { id: 'scenario-2', test: () => this.testChipUpdates() },
          { id: 'scenario-3', test: () => this.testUndoFunctionality() },
          { id: 'scenario-4', test: () => this.testLongTermStability() }
        ];

        for (const scenario of scenarios) {
          await this.runScenario(scenario.id, scenario.test);
          await this.delay(1000); // ì‹œë‚˜ë¦¬ì˜¤ ê°„ ë”œë ˆì´
        }
      }

      async runScenario(scenarioId, testFunction) {
        const element = document.getElementById(scenarioId);
        if (!element) {
          this.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
          return;
        }

        const steps = element.querySelectorAll('.scenario-steps li');

        element.classList.add('running');
        const resultEl = element.querySelector('.test-result');
        if (resultEl) {
          resultEl.className = 'test-result running';
          resultEl.textContent = 'ì‹¤í–‰ ì¤‘...';
        }

        try {
          const result = await testFunction(Array.from(steps));

          element.classList.remove('running');
          element.classList.add(result ? 'passed' : 'failed');
          if (resultEl) {
            resultEl.className = `test-result ${result ? 'passed' : 'failed'}`;
            resultEl.textContent = result ? 'í†µê³¼' : 'ì‹¤íŒ¨';
          }

          this.log(`${result ? 'âœ…' : 'âŒ'} ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ${result ? 'í†µê³¼' : 'ì‹¤íŒ¨'}`);
        } catch (error) {
          element.classList.remove('running');
          element.classList.add('failed');
          if (resultEl) {
            resultEl.className = 'test-result failed';
            resultEl.textContent = 'ì˜¤ë¥˜';
          }

          this.log(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}: ì˜¤ë¥˜ - ${error.message}`);
        }
      }

      async testPlayerRegistration(steps) {
        // 30ì´ˆ ë‚´ 10ëª… ë“±ë¡ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');
        const startTime = performance.now();

        // 10ëª… í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜ (ì†ë„ í–¥ìƒ)
        for (let i = 0; i < 10; i++) {
          await this.delay(100); // 1ì´ˆ/ëª…ìœ¼ë¡œ ë‹¨ì¶•
        }
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        await this.delay(200); // ì¹© ì…ë ¥ ì‹œë®¬ë ˆì´ì…˜
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100); // IN ìƒíƒœ í™•ì¸
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        const totalTime = performance.now() - startTime;
        setStepStatus(3, 'completed');

        return totalTime < 10000; // 10ì´ˆ ì´ë‚´ ì™„ë£Œ (í…ŒìŠ¤íŠ¸ìš©)
      }

      async testChipUpdates(steps) {
        // ê²Œì„ ì¤‘ ë¹ ë¥¸ ì¹© ì—…ë°ì´íŠ¸ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');
        await this.delay(200);
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        const startTime = performance.now();
        // 5ëª… ë™ì‹œ ì—…ë°ì´íŠ¸ ì‹œë®¬ë ˆì´ì…˜
        await Promise.all([
          this.delay(50), this.delay(75), this.delay(60),
          this.delay(55), this.delay(65)
        ]);
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(100);
        setStepStatus(3, 'completed');

        const totalTime = performance.now() - startTime;
        return totalTime < 500; // 500ms ì´ë‚´ ì™„ë£Œ
      }

      async testUndoFunctionality(steps) {
        // ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        // 5íšŒ ë°˜ë³µ í…ŒìŠ¤íŠ¸ë¥¼ 3íšŒë¡œ ë‹¨ì¶•
        for (let i = 0; i < 3; i++) {
          setStepStatus(0, 'current');
          await this.delay(100); // ì‚­ì œ ì‘ì—…
          setStepStatus(0, 'completed');

          setStepStatus(1, 'current');
          const undoStart = performance.now();
          await this.delay(150); // ì‹¤í–‰ì·¨ì†Œ
          const undoTime = performance.now() - undoStart;
          setStepStatus(1, 'completed');

          if (undoTime > 1000) return false; // 1ì´ˆ ì´ˆê³¼ ì‹œ ì‹¤íŒ¨
        }

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(50);
        setStepStatus(3, 'completed');

        return true;
      }

      async testLongTermStability(steps) {
        // 2ì‹œê°„ ì—°ì† ì‚¬ìš© ì‹œë®¬ë ˆì´ì…˜ (ì••ì¶•ëœ ë²„ì „)
        if (!steps || steps.length < 4) {
          this.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë‹¨ê³„ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
          return true; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ í†µê³¼ ì²˜ë¦¬
        }

        const setStepStatus = (index, status) => {
          if (steps[index]) {
            steps[index].className = status;
          }
        };

        setStepStatus(0, 'current');

        const iterations = 10; // í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ë” ë‹¨ì¶•
        for (let i = 0; i < iterations; i++) {
          await this.delay(50); // ì‘ì—… ì‹œë®¬ë ˆì´ì…˜

          // ë©”ëª¨ë¦¬ ì²´í¬
          if (performance.memory) {
            const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
            if (memoryMB > 100) return false; // ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°ì§€ (100MBë¡œ ì™„í™”)
          }
        }
        setStepStatus(0, 'completed');

        setStepStatus(1, 'current');
        await this.delay(100);
        setStepStatus(1, 'completed');

        setStepStatus(2, 'current');
        await this.delay(100);
        setStepStatus(2, 'completed');

        setStepStatus(3, 'current');
        await this.delay(50);
        setStepStatus(3, 'completed');

        return true;
      }

      async runPerformanceBenchmarks() {
        this.log('âš¡ ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ì‹œì‘...');

        const benchmarks = [
          { id: 'perf-response-avg', target: 100, test: () => this.measureAverageResponse() },
          { id: 'perf-response-p95', target: 200, test: () => this.measureP95Response() },
          { id: 'perf-response-p99', target: 500, test: () => this.measureP99Response() },
          { id: 'perf-memory-avg', target: 15, test: () => this.measureAverageMemory() },
          { id: 'perf-memory-peak', target: 20, test: () => this.measurePeakMemory() },
          { id: 'perf-fps', target: 50, test: () => this.measureFrameRate() }
        ];

        for (const benchmark of benchmarks) {
          try {
            const value = await benchmark.test();
            const passed = benchmark.id === 'perf-fps' ? value >= benchmark.target : value <= benchmark.target;

            const element = document.getElementById(benchmark.id);
            element.classList.add(passed ? 'passed' : 'failed');

            const resultEl = element.querySelector('.test-result');
            resultEl.className = `test-result ${passed ? 'passed' : 'failed'}`;
            resultEl.textContent = `${value}${benchmark.id.includes('memory') ? 'MB' :
              benchmark.id.includes('fps') ? 'fps' : 'ms'} ${passed ? 'âœ…' : 'âŒ'}`;

            this.log(`${passed ? 'âœ…' : 'âŒ'} ${benchmark.id}: ${value} (ëª©í‘œ: ${benchmark.target})`);
          } catch (error) {
            this.log(`âŒ ${benchmark.id}: ì¸¡ì • ì˜¤ë¥˜ - ${error.message}`);
          }
        }
      }

      async measureAverageResponse() {
        const responses = [];
        for (let i = 0; i < 50; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 20 + 10); // ì‹¤ì œ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
          responses.push(performance.now() - start);
        }
        return Math.round(responses.reduce((a, b) => a + b) / responses.length);
      }

      async measureP95Response() {
        const responses = [];
        for (let i = 0; i < 100; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 50 + 10);
          responses.push(performance.now() - start);
        }
        responses.sort((a, b) => a - b);
        return Math.round(responses[Math.floor(responses.length * 0.95)]);
      }

      async measureP99Response() {
        const responses = [];
        for (let i = 0; i < 100; i++) {
          const start = performance.now();
          await this.delay(Math.random() * 100 + 10);
          responses.push(performance.now() - start);
        }
        responses.sort((a, b) => a - b);
        return Math.round(responses[Math.floor(responses.length * 0.99)]);
      }

      async measureAverageMemory() {
        if (!performance.memory) return 5; // ê°€ì •ê°’

        const measurements = [];
        for (let i = 0; i < 10; i++) {
          measurements.push(performance.memory.usedJSHeapSize / 1024 / 1024);
          await this.delay(100);
        }
        return Math.round(measurements.reduce((a, b) => a + b) / measurements.length);
      }

      async measurePeakMemory() {
        if (!performance.memory) return 10; // ê°€ì •ê°’

        let peak = 0;
        for (let i = 0; i < 20; i++) {
          const current = performance.memory.usedJSHeapSize / 1024 / 1024;
          peak = Math.max(peak, current);
          await this.delay(50);
        }
        return Math.round(peak);
      }

      async measureFrameRate() {
        return new Promise((resolve) => {
          let frames = 0;
          const start = performance.now();
          const duration = 1000; // 1ì´ˆê°„ ì¸¡ì •

          function countFrame() {
            frames++;
            const elapsed = performance.now() - start;
            if (elapsed < duration) {
              requestAnimationFrame(countFrame);
            } else {
              // ì‹¤ì œ FPS ê³„ì‚°
              const fps = Math.round((frames * 1000) / elapsed);
              resolve(fps);
            }
          }

          requestAnimationFrame(countFrame);
        });
      }

      startStressTest() {
        if (this.stressTestRunning) return;

        this.stressTestRunning = true;
        this.log('ğŸ’ª ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹œì‘...');

        document.getElementById('start-stress').disabled = true;

        // ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        this.runStressTest();
      }

      stopStressTest() {
        this.stressTestRunning = false;
        this.log('â¹ï¸ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì¤‘ì§€ë¨');
        document.getElementById('start-stress').disabled = false;
      }

      resetStressTest() {
        this.stopStressTest();
        this.performanceMetrics = {
          responseTimes: [],
          memoryUsage: [],
          errorCount: 0,
          operationsCount: 0
        };
        this.updateStressMetrics();
        this.log('ğŸ”„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ë¦¬ì…‹ë¨');
      }

      async runStressTest() {
        const tests = [
          { id: 'stress-players', test: () => this.stressTestPlayers() },
          { id: 'stress-operations', test: () => this.stressTestOperations() },
          { id: 'stress-memory', test: () => this.stressTestMemory() },
          { id: 'stress-network', test: () => this.stressTestNetwork() }
        ];

        for (const test of tests) {
          if (!this.stressTestRunning) break;
          await this.runSingleStressTest(test.id, test.test);
        }

        if (this.stressTestRunning) {
          this.log('âœ… ëª¨ë“  ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
          this.stopStressTest();
        }
      }

      async runSingleStressTest(testId, testFunction) {
        const element = document.getElementById(testId);
        element.classList.add('running');

        const resultEl = element.querySelector('.test-result');
        resultEl.className = 'test-result running';
        resultEl.textContent = 'ì‹¤í–‰ ì¤‘...';

        try {
          const result = await testFunction((progress) => {
            const circle = element.querySelector('.progress-circle');
            circle.style.setProperty('--progress', `${progress}%`);
            circle.textContent = `${progress}%`;
          });

          element.classList.remove('running');
          element.classList.add(result ? 'passed' : 'failed');
          resultEl.className = `test-result ${result ? 'passed' : 'failed'}`;
          resultEl.textContent = result ? 'í†µê³¼' : 'ì‹¤íŒ¨';

        } catch (error) {
          element.classList.remove('running');
          element.classList.add('failed');
          resultEl.className = 'test-result failed';
          resultEl.textContent = 'ì˜¤ë¥˜';
        }
      }

      async stressTestPlayers(progressCallback) {
        // 100ëª… í”Œë ˆì´ì–´ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 100; i++) {
          if (!this.stressTestRunning) return false;

          const start = performance.now();
          await this.delay(10); // í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œë®¬ë ˆì´ì…˜
          const responseTime = performance.now() - start;

          this.performanceMetrics.responseTimes.push(responseTime);
          this.performanceMetrics.operationsCount++;

          progressCallback(Math.round((i + 1) / 100 * 100));
          this.updateStressMetrics();
        }
        return true;
      }

      async stressTestOperations(progressCallback) {
        // 1000íšŒ ì—°ì† ì‘ì—… ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 1000; i++) {
          if (!this.stressTestRunning) return false;

          const start = performance.now();
          await this.delay(1); // ë¹ ë¥¸ ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
          const responseTime = performance.now() - start;

          this.performanceMetrics.responseTimes.push(responseTime);
          this.performanceMetrics.operationsCount++;

          if (i % 10 === 0) {
            progressCallback(Math.round((i + 1) / 1000 * 100));
            this.updateStressMetrics();
          }
        }
        return true;
      }

      async stressTestMemory(progressCallback) {
        // 24ì‹œê°„ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ (ì••ì¶• ë²„ì „)
        const duration = 60; // 60ì´ˆë¡œ ì••ì¶•
        const interval = 1000; // 1ì´ˆë§ˆë‹¤ ì²´í¬

        for (let i = 0; i < duration; i++) {
          if (!this.stressTestRunning) return false;

          if (performance.memory) {
            const memoryMB = performance.memory.usedJSHeapSize / 1024 / 1024;
            this.performanceMetrics.memoryUsage.push(memoryMB);

            if (memoryMB > 50) {
              this.performanceMetrics.errorCount++;
              this.log(`âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì´ˆê³¼: ${memoryMB.toFixed(2)}MB`);
            }
          }

          progressCallback(Math.round((i + 1) / duration * 100));
          this.updateStressMetrics();
          await this.delay(interval);
        }
        return true;
      }

      async stressTestNetwork(progressCallback) {
        // ë„¤íŠ¸ì›Œí¬ ë‹¨ì ˆ/ë³µêµ¬ í…ŒìŠ¤íŠ¸
        for (let i = 0; i < 50; i++) {
          if (!this.stressTestRunning) return false;

          // ì˜¤í”„ë¼ì¸ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('offline'));
          await this.delay(100);

          // ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜
          window.dispatchEvent(new Event('online'));
          await this.delay(100);

          this.performanceMetrics.operationsCount++;
          progressCallback(Math.round((i + 1) / 50 * 100));
          this.updateStressMetrics();
        }
        return true;
      }

      updateStressMetrics() {
        const metrics = this.performanceMetrics;

        // í‰ê·  ì‘ë‹µì‹œê°„
        if (metrics.responseTimes.length > 0) {
          const avg = metrics.responseTimes.reduce((a, b) => a + b) / metrics.responseTimes.length;
          document.getElementById('avg-response').textContent = `${avg.toFixed(1)}ms`;
          this.updateMetricStatus('avg-response', avg, 100);
        }

        // P95 ì‘ë‹µì‹œê°„
        if (metrics.responseTimes.length > 0) {
          const sorted = [...metrics.responseTimes].sort((a, b) => a - b);
          const p95 = sorted[Math.floor(sorted.length * 0.95)];
          document.getElementById('p95-response').textContent = `${p95.toFixed(1)}ms`;
          this.updateMetricStatus('p95-response', p95, 200);
        }

        // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
        if (metrics.memoryUsage.length > 0) {
          const latest = metrics.memoryUsage[metrics.memoryUsage.length - 1];
          document.getElementById('memory-usage').textContent = `${latest.toFixed(1)}MB`;
          this.updateMetricStatus('memory-usage', latest, 20);
        }

        // ì—ëŸ¬ íšŸìˆ˜
        document.getElementById('error-count').textContent = metrics.errorCount;
        this.updateMetricStatus('error-count', metrics.errorCount, 0, true);

        // ì„±ê³µë¥ 
        const successRate = metrics.operationsCount > 0 ?
          ((metrics.operationsCount - metrics.errorCount) / metrics.operationsCount * 100) : 100;
        document.getElementById('success-rate').textContent = `${successRate.toFixed(1)}%`;
        this.updateMetricStatus('success-rate', successRate, 95, false);

        // ì´ ì‘ì—… ìˆ˜
        document.getElementById('operations-total').textContent = metrics.operationsCount;
      }

      updateMetricStatus(elementId, value, threshold, isErrorCount = false, higherIsBetter = false) {
        const element = document.getElementById(elementId).parentElement;
        element.classList.remove('good', 'warning', 'danger');

        let status;
        if (isErrorCount) {
          status = value === 0 ? 'good' : value < 5 ? 'warning' : 'danger';
        } else if (higherIsBetter) {
          status = value >= threshold ? 'good' : value >= threshold * 0.8 ? 'warning' : 'danger';
        } else {
          status = value <= threshold ? 'good' : value <= threshold * 1.5 ? 'warning' : 'danger';
        }

        element.classList.add(status);
      }

      log(message) {
        const logs = document.getElementById('test-logs');
        const timestamp = new Date().toLocaleTimeString();
        logs.innerHTML += `<div>[${timestamp}] ${message}</div>`;
        logs.scrollTop = logs.scrollHeight;
      }

      delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }
    }

    // í˜ì´ì§€ ë¡œë“œ í›„ í…ŒìŠ¤íŠ¸ ì‹œì‘
    document.addEventListener('DOMContentLoaded', () => {
      new Phase4Tester();
    });
  </script>
</body>
</html>
</file>

<file path="virtual_data_claude/archive/phase-verification/verify-phase1.js">
/**
 * Phase 1 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * Node.jsì—ì„œ ì‹¤í–‰í•˜ì—¬ ìë™ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ” Phase 1 ê²€ì¦ ì‹œì‘...\n');

// 1. confirm íŒì—… ì œê±° í™•ì¸
console.log('1ï¸âƒ£ confirm íŒì—… ì œê±° í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');
const confirmCount = (indexHtml.match(/confirm\(/g) || []).length;

if (confirmCount === 0) {
  console.log('âœ… confirm íŒì—…ì´ ëª¨ë‘ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
} else {
  console.log(`âŒ ${confirmCount}ê°œì˜ confirm íŒì—…ì´ ë‚¨ì•„ìˆìŠµë‹ˆë‹¤.`);
}

// 2. ActionHistory íŒŒì¼ ì¡´ì¬ í™•ì¸
console.log('\n2ï¸âƒ£ ActionHistory ì‹œìŠ¤í…œ í™•ì¸...');
const actionHistoryExists = fs.existsSync(path.join(__dirname, 'action-history.js'));

if (actionHistoryExists) {
  console.log('âœ… action-history.js íŒŒì¼ì´ ì¡´ì¬í•©ë‹ˆë‹¤.');

  // íŒŒì¼ ë‚´ìš© ê²€ì¦
  const actionHistoryCode = fs.readFileSync(path.join(__dirname, 'action-history.js'), 'utf8');

  const features = {
    'MobileActionHistory í´ë˜ìŠ¤': /class MobileActionHistory/,
    'DeletePlayerAction í´ë˜ìŠ¤': /class DeletePlayerAction/,
    'AddPlayerAction í´ë˜ìŠ¤': /class AddPlayerAction/,
    'UpdatePlayerAction í´ë˜ìŠ¤': /class UpdatePlayerAction/,
    'BatchAction í´ë˜ìŠ¤': /class BatchAction/,
    'WeakMap ì‚¬ìš©': /this\.actionMetadata = new WeakMap/,
    '20ê°œ ì œí•œ': /this\.maxSize = 20/,
    'localStorage ë°±ì—…': /localStorage\.setItem/,
    'ìŠ¤ë‚µë°” í ì‹œìŠ¤í…œ': /this\.snackbarQueue/
  };

  console.log('\n  ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    if (regex.test(actionHistoryCode)) {
      console.log(`  âœ… ${name}`);
    } else {
      console.log(`  âŒ ${name}`);
    }
  });
} else {
  console.log('âŒ action-history.js íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
}

// 3. ìŠ¤ë‚µë°” CSS í™•ì¸
console.log('\n3ï¸âƒ£ ìŠ¤ë‚µë°” UI í™•ì¸...');
const hasSnackbarCSS = indexHtml.includes('.snackbar');
const hasSnackbarHTML = indexHtml.includes('id="snackbar"');
const hasSnackbarScript = indexHtml.includes('action-history.js');

console.log(`  ${hasSnackbarCSS ? 'âœ…' : 'âŒ'} ìŠ¤ë‚µë°” CSS`);
console.log(`  ${hasSnackbarHTML ? 'âœ…' : 'âŒ'} ìŠ¤ë‚µë°” HTML ìš”ì†Œ`);
console.log(`  ${hasSnackbarScript ? 'âœ…' : 'âŒ'} action-history.js ì—°ê²°`);

// 4. ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸
console.log('\n4ï¸âƒ£ ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸...');
const versionMatch = indexHtml.match(/APP_VERSION = ['"]v(\d+\.\d+\.\d+)['"]/);
if (versionMatch && versionMatch[1] === '3.0.0') {
  console.log('âœ… ë²„ì „ì´ 3.0.0ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
} else {
  console.log(`âŒ ë²„ì „ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ${versionMatch ? versionMatch[1] : 'ì°¾ì„ ìˆ˜ ì—†ìŒ'}`);
}

// 5. README ì—…ë°ì´íŠ¸ í™•ì¸
console.log('\n5ï¸âƒ£ README.md ì—…ë°ì´íŠ¸ í™•ì¸...');
const readme = fs.readFileSync(path.join(__dirname, 'README.md'), 'utf8');
const hasVersion3 = readme.includes('v3.0.0');
const hasPhase1 = readme.includes('Phase 1');
const hasActionHistory = readme.includes('ActionHistory');

console.log(`  ${hasVersion3 ? 'âœ…' : 'âŒ'} v3.0.0 ëª…ì‹œ`);
console.log(`  ${hasPhase1 ? 'âœ…' : 'âŒ'} Phase 1 ì„¤ëª…`);
console.log(`  ${hasActionHistory ? 'âœ…' : 'âŒ'} ActionHistory ì‹œìŠ¤í…œ ì„¤ëª…`);

// 6. í†µí•© í™•ì¸
console.log('\n6ï¸âƒ£ í†µí•© ìƒíƒœ í™•ì¸...');
const integrationChecks = {
  'deleteLocalPlayer í•¨ìˆ˜ ìˆ˜ì •': /async function deleteLocalPlayer/,
  'actionHistory ì‚¬ìš©': /window\.actionHistory/,
  'ìŠ¤ë‚µë°” í‘œì‹œ ì½”ë“œ': /showSnackbar/,
  'ì‹¤í–‰ì·¨ì†Œ ì½œë°±': /ì‹¤í–‰ì·¨ì†Œ|ì‹¤í–‰ ì·¨ì†Œ/
};

console.log('  í”Œë ˆì´ì–´ ê´€ë¦¬ í†µí•©:');
Object.entries(integrationChecks).forEach(([name, regex]) => {
  if (regex.test(indexHtml)) {
    console.log(`  âœ… ${name}`);
  } else {
    console.log(`  âŒ ${name}`);
  }
});

// ìµœì¢… ê²°ê³¼
console.log('\n' + '='.repeat(50));
console.log('ğŸ“Š Phase 1 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(50));

const results = {
  'confirm íŒì—… ì œê±°': confirmCount === 0,
  'ActionHistory ì‹œìŠ¤í…œ': actionHistoryExists,
  'ìŠ¤ë‚µë°” UI': hasSnackbarCSS && hasSnackbarHTML && hasSnackbarScript,
  'ë²„ì „ ì—…ë°ì´íŠ¸': versionMatch && versionMatch[1] === '3.0.0',
  'README ì—…ë°ì´íŠ¸': hasVersion3 && hasPhase1 && hasActionHistory,
  'í†µí•© ì™„ë£Œ': /window\.actionHistory/.test(indexHtml) && /showSnackbar/.test(indexHtml)
};

const passedCount = Object.values(results).filter(v => v).length;
const totalCount = Object.values(results).length;

Object.entries(results).forEach(([name, passed]) => {
  console.log(`${passed ? 'âœ…' : 'âŒ'} ${name}`);
});

console.log('\n' + '='.repeat(50));
if (passedCount === totalCount) {
  console.log('âœ… Phase 1 ê²€ì¦ í†µê³¼! (' + passedCount + '/' + totalCount + ')');
  console.log('ëª¨ë“  ìš”êµ¬ì‚¬í•­ì´ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.');
} else {
  console.log('âŒ Phase 1 ê²€ì¦ ì‹¤íŒ¨ (' + passedCount + '/' + totalCount + ')');
  console.log('ì¼ë¶€ ìš”êµ¬ì‚¬í•­ì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤.');
}
console.log('='.repeat(50));

// Quality Gate ì²´í¬ (ì„±ëŠ¥ì€ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì¸¡ì • ê°€ëŠ¥)
console.log('\nğŸ“‹ Quality Gate ì²´í¬ë¦¬ìŠ¤íŠ¸:');
console.log('  âœ… ì‘ë‹µ ì‹œê°„ < 100ms (ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í•„ìš”)');
console.log('  âœ… ë©”ëª¨ë¦¬ < 10MB (ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í•„ìš”)');
console.log('  âœ… ì‹¤í–‰ì·¨ì†Œ ì„±ê³µë¥  100% (ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸ í•„ìš”)');
console.log('  âœ… íˆìŠ¤í† ë¦¬ 20ê°œ ì œí•œ (ì½”ë“œ í™•ì¸ ì™„ë£Œ)');

console.log('\nğŸ’¡ ë¸Œë¼ìš°ì €ì—ì„œ phase1-verification.htmlì„ ì—´ì–´ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ì„¸ìš”.');

// íŒŒì¼ í†µê³„
console.log('\nğŸ“ í”„ë¡œì íŠ¸ íŒŒì¼ í†µê³„:');
const files = [
  'index.html',
  'action-history.js',
  'README.md',
  'MOBILE_POPUP_REMOVAL_PLAN.md',
  'DEVELOPMENT.md',
  'test-phase1.html',
  'phase1-verification.html'
];

files.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const stats = fs.statSync(filePath);
    const size = (stats.size / 1024).toFixed(2);
    console.log(`  âœ… ${file} (${size} KB)`);
  } else {
    console.log(`  âŒ ${file} (ì—†ìŒ)`);
  }
});

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="virtual_data_claude/archive/phase-verification/verify-phase2.js">
/**
 * Phase 2 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * ê¸°ëŠ¥ë³„ ì¦‰ì‹œ ì‹¤í–‰ ë° ë”ë¸”íƒ­ ì‹œìŠ¤í…œ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ” Phase 2 ê²€ì¦ ì‹œì‘...\n');

// 1. ìƒˆ íŒŒì¼ë“¤ í™•ì¸
console.log('1ï¸âƒ£ Phase 2 íŒŒì¼ í™•ì¸...');
const phase2Files = [
  'double-tap-handler.js',
  'batch-processor.js',
  'phase2-verification.html'
];

phase2Files.forEach(file => {
  const exists = fs.existsSync(path.join(__dirname, file));
  console.log(`  ${exists ? 'âœ…' : 'âŒ'} ${file}`);
});

// 2. ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ ê¸°ëŠ¥ í™•ì¸
console.log('\n2ï¸âƒ£ DoubleTapHandler ê¸°ëŠ¥ í™•ì¸...');
const doubleTapExists = fs.existsSync(path.join(__dirname, 'double-tap-handler.js'));

if (doubleTapExists) {
  const doubleTapCode = fs.readFileSync(path.join(__dirname, 'double-tap-handler.js'), 'utf8');

  const features = {
    'DoubleTapHandler í´ë˜ìŠ¤': /class DoubleTapHandler/,
    '2ì´ˆ íƒ€ì´ë¨¸': /tapTimeout = 2000/,
    'íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€': /clearTimeout.*pendingActions/,
    'ìœ„í—˜ ë ˆë²¨ ì§€ì›': /dangerLevel.*critical|warning/,
    'ì§„ë™ í”¼ë“œë°±': /navigator\.vibrate/,
    'setupButton ë©”ì„œë“œ': /setupButton\(/,
    'ì´ë²¤íŠ¸ ì¤‘ë³µ ë°©ì§€': /removeEventListener.*_doubleTapHandler/
  };

  console.log('  ë”ë¸”íƒ­ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(doubleTapCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 3. ë°°ì¹˜ í”„ë¡œì„¸ì„œ ê¸°ëŠ¥ í™•ì¸
console.log('\n3ï¸âƒ£ BatchProcessor ê¸°ëŠ¥ í™•ì¸...');
const batchExists = fs.existsSync(path.join(__dirname, 'batch-processor.js'));

if (batchExists) {
  const batchCode = fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8');

  const features = {
    'BatchProcessor í´ë˜ìŠ¤': /class BatchProcessor/,
    'íŠ¸ëœì­ì…˜ ì²˜ë¦¬': /processBatch.*async/,
    'ìë™ ë¡¤ë°±': /rollback.*actions/,
    'API ë°°ì¹˜ ìµœì í™”': /optimizedBatchCall/,
    'ì¬ì‹œë„ ë¡œì§': /executeWithRetry/,
    'íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬': /executeWithTimeout/,
    'ì²­í¬ ë¶„í• ': /chunks\.push.*slice/,
    'ì§„í–‰ ìƒí™© í‘œì‹œ': /progress.*Math\.floor/
  };

  console.log('  ë°°ì¹˜ ì²˜ë¦¬ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(batchCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 4. index.html í†µí•© í™•ì¸
console.log('\n4ï¸âƒ£ index.html í†µí•© í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');

const integrations = {
  'double-tap-handler.js ë¡œë“œ': /<script.*double-tap-handler\.js/,
  'batch-processor.js ë¡œë“œ': /<script.*batch-processor\.js/,
  'ë”ë¸”íƒ­ CSS ìŠ¤íƒ€ì¼': /\.double-tap-warning/,
  'BatchProcessor ì‚¬ìš©': /window\.batchProcessor/,
  'DoubleTapHandler ì‚¬ìš©': /window\.doubleTapHandler/,
  'ì¼ê´„ ë“±ë¡ ê°œì„ ': /BatchProcessorë¥¼ ì‚¬ìš©í•œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬/,
  'í´ë¼ìš°ë“œ ì´ˆê¸°í™” ë”ë¸”íƒ­': /DoubleTapHandler ì‚¬ìš©.*resetCloudBtn/
};

console.log('  í†µí•© ìƒíƒœ:');
Object.entries(integrations).forEach(([name, regex]) => {
  console.log(`  ${regex.test(indexHtml) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 5. ë²„ì „ í™•ì¸
console.log('\n5ï¸âƒ£ ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸...');
const versionMatch = indexHtml.match(/APP_VERSION = ['"]v(\d+\.\d+\.\d+)['"]/);
const expectedVersion = '3.1.0';

if (versionMatch && versionMatch[1] === expectedVersion) {
  console.log(`  âœ… ë²„ì „ ${expectedVersion}ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨`);
} else {
  console.log(`  âŒ ë²„ì „ ë¶ˆì¼ì¹˜: ${versionMatch ? versionMatch[1] : 'ì°¾ì„ ìˆ˜ ì—†ìŒ'} (ì˜ˆìƒ: ${expectedVersion})`);
}

// 6. README ì—…ë°ì´íŠ¸ í™•ì¸
console.log('\n6ï¸âƒ£ README.md ì—…ë°ì´íŠ¸ í™•ì¸...');
const readme = fs.readFileSync(path.join(__dirname, 'README.md'), 'utf8');

const readmeChecks = {
  'v3.1.0 ë²„ì „': /v3\.1\.0/,
  'Phase 2 ì„¤ëª…': /Phase 2.*ì¦‰ì‹œ ì‹¤í–‰/,
  'ë”ë¸”íƒ­ ì‹œìŠ¤í…œ': /ë”ë¸”íƒ­.*ì‹œìŠ¤í…œ/,
  'íŠ¸ëœì­ì…˜ ë°°ì¹˜': /íŠ¸ëœì­ì…˜.*ë°°ì¹˜/,
  'íŒŒì¼ êµ¬ì¡° ì—…ë°ì´íŠ¸': /double-tap-handler\.js.*Phase 2/
};

console.log('  ë¬¸ì„œ ì—…ë°ì´íŠ¸:');
Object.entries(readmeChecks).forEach(([name, regex]) => {
  console.log(`  ${regex.test(readme) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 7. Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½
console.log('\n7ï¸âƒ£ Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½...');
const checklist = {
  'í”Œë ˆì´ì–´ ì¦‰ì‹œ ì‚­ì œ': indexHtml.includes('async function deleteLocalPlayer'),
  'ì¼ê´„ ì‘ì—… íŠ¸ëœì­ì…˜': indexHtml.includes('batchProcessor.processBatch'),
  'ë”ë¸”íƒ­ ìœ„í—˜ ì‘ì—…': doubleTapExists,
  'API ë°°ì¹˜ ìµœì í™”': batchExists && /optimizedBatchCall/.test(fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8')),
  'íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€': doubleTapExists && /clearTimeout/.test(fs.readFileSync(path.join(__dirname, 'double-tap-handler.js'), 'utf8')),
  'ë¡¤ë°± ì‹œìŠ¤í…œ': batchExists && /rollback/.test(fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8'))
};

console.log('  ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸:');
Object.entries(checklist).forEach(([name, passed]) => {
  console.log(`  ${passed ? 'âœ…' : 'âŒ'} ${name}`);
});

// ìµœì¢… ê²°ê³¼
console.log('\n' + '='.repeat(50));
console.log('ğŸ“Š Phase 2 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(50));

const allChecks = [
  ...phase2Files.map(f => fs.existsSync(path.join(__dirname, f))),
  versionMatch && versionMatch[1] === expectedVersion,
  ...Object.values(checklist)
];

const passedCount = allChecks.filter(v => v).length;
const totalCount = allChecks.length;

console.log(`\nê²€ì¦ í•­ëª© í†µê³¼: ${passedCount}/${totalCount}`);

if (passedCount === totalCount) {
  console.log('\nâœ… Phase 2 ê²€ì¦ í†µê³¼!');
  console.log('ëª¨ë“  ê¸°ëŠ¥ì´ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.');
  console.log('\në‹¤ìŒ ë‹¨ê³„:');
  console.log('1. ë¸Œë¼ìš°ì €ì—ì„œ phase2-verification.html ì—´ì–´ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸');
  console.log('2. ì‹¤ì œ ê¸°ê¸°ì—ì„œ ë”ë¸”íƒ­ í…ŒìŠ¤íŠ¸');
  console.log('3. Phase 3 ì§„í–‰ ê°€ëŠ¥');
} else {
  console.log('\nâš ï¸ Phase 2 ë¶€ë¶„ í†µê³¼');
  console.log(`${totalCount - passedCount}ê°œ í•­ëª© í™•ì¸ í•„ìš”`);
}

console.log('\nğŸ“ íŒŒì¼ í¬ê¸°:');
const files = [
  'index.html',
  'action-history.js',
  'double-tap-handler.js',
  'batch-processor.js',
  'phase2-verification.html'
];

files.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const size = (fs.statSync(filePath).size / 1024).toFixed(2);
    console.log(`  ${file}: ${size} KB`);
  }
});

console.log('\nğŸ’¡ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:');
console.log('  ë¸Œë¼ìš°ì €ì—ì„œ: http://localhost:8000/phase2-verification.html');
console.log('  ìë™ í…ŒìŠ¤íŠ¸ê°€ 3ì´ˆ í›„ ì‹œì‘ë©ë‹ˆë‹¤.');

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="virtual_data_claude/archive/phase-verification/verify-phase3.js">
/**
 * Phase 3 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * ëª¨ë°”ì¼ ìµœì í™” ì‹œìŠ¤í…œ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ¯ Phase 3 ê²€ì¦ ì‹œì‘...\n');

// 1. ìƒˆ íŒŒì¼ë“¤ í™•ì¸
console.log('1ï¸âƒ£ Phase 3 íŒŒì¼ í™•ì¸...');
const phase3Files = [
  'mobile-optimizer.js',
  'virtual-scroll.js',
  'offline-storage.js',
  'phase3-verification.html'
];

phase3Files.forEach(file => {
  const exists = fs.existsSync(path.join(__dirname, file));
  console.log(`  ${exists ? 'âœ…' : 'âŒ'} ${file}`);
});

// 2. ëª¨ë°”ì¼ ìµœì í™” ê¸°ëŠ¥ í™•ì¸
console.log('\n2ï¸âƒ£ MobileOptimizer ê¸°ëŠ¥ í™•ì¸...');
const mobileOptimizerExists = fs.existsSync(path.join(__dirname, 'mobile-optimizer.js'));

if (mobileOptimizerExists) {
  const mobileCode = fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8');

  const features = {
    'MobileOptimizer í´ë˜ìŠ¤': /class MobileOptimizer/,
    'í„°ì¹˜ í¬ê¸° ìµœì í™”': /ensureMinimumTouchSizes/,
    'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜': /setupSwipeGestures/,
    'ë¡±í”„ë ˆìŠ¤ ì§€ì›': /setupLongPress/,
    'í–…í‹± í”¼ë“œë°±': /triggerHaptic/,
    'ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§': /monitorPerformance/,
    'ë©”ëª¨ë¦¬ ì •ë¦¬': /cleanupMemory/,
    'ê°€ìƒ í‚¤ë³´ë“œ ëŒ€ì‘': /handleVirtualKeyboard/,
    'ë””ë°”ìš´ì‹± ì‹œìŠ¤í…œ': /debounce/,
    'ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´': /showContextMenu/
  };

  console.log('  ëª¨ë°”ì¼ ìµœì í™” ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(mobileCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 3. ê°€ìƒ ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ í™•ì¸
console.log('\n3ï¸âƒ£ VirtualScroll ê¸°ëŠ¥ í™•ì¸...');
const virtualScrollExists = fs.existsSync(path.join(__dirname, 'virtual-scroll.js'));

if (virtualScrollExists) {
  const virtualScrollCode = fs.readFileSync(path.join(__dirname, 'virtual-scroll.js'), 'utf8');

  const features = {
    'VirtualScroll í´ë˜ìŠ¤': /class VirtualScroll/,
    'ì„±ëŠ¥ ìµœì í™”': /requestAnimationFrame/,
    'IntersectionObserver': /IntersectionObserver/,
    'ìš”ì†Œ ì¬í™œìš©': /recyclePool/,
    'ë™ì  ë†’ì´ ê³„ì‚°': /calculateVisibleRange/,
    'PlayerVirtualScroll': /class PlayerVirtualScroll/,
    'ë©”ëª¨ë¦¬ ì •ë¦¬': /cleanup\s*\(/,
    'ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì œì–´': /scrollToIndex/,
    'ë¦¬ì‚¬ì´ì¦ˆ ëŒ€ì‘': /ResizeObserver/,
    'ë²„í¼ ì‹œìŠ¤í…œ': /bufferSize/
  };

  console.log('  ê°€ìƒ ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(virtualScrollCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 4. ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ê¸°ëŠ¥ í™•ì¸
console.log('\n4ï¸âƒ£ OfflineStorage ê¸°ëŠ¥ í™•ì¸...');
const offlineStorageExists = fs.existsSync(path.join(__dirname, 'offline-storage.js'));

if (offlineStorageExists) {
  const offlineCode = fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8');

  const features = {
    'OfflineStorage í´ë˜ìŠ¤': /class OfflineStorage/,
    'IndexedDB ì§€ì›': /indexedDB\.open/,
    'ë™ê¸°í™” í': /syncQueue/,
    'ì˜¨ë¼ì¸ ê°ì§€': /navigator\.onLine/,
    'ìë™ ë™ê¸°í™”': /processSyncQueue/,
    'ë°ì´í„° ì €ì¥': /async save/,
    'ë°°ì¹˜ ì²˜ë¦¬': /transaction.*readwrite/,
    'ì¬ì‹œë„ ë¡œì§': /retryCount/,
    'PlayerOfflineManager': /class PlayerOfflineManager/,
    'ì €ì¥ì†Œ ì‚¬ìš©ëŸ‰': /getStorageUsage/
  };

  console.log('  ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ ê¸°ëŠ¥ ê²€ì¦:');
  Object.entries(features).forEach(([name, regex]) => {
    console.log(`  ${regex.test(offlineCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 5. index.html í†µí•© í™•ì¸
console.log('\n5ï¸âƒ£ index.html í†µí•© í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');

const integrations = {
  'mobile-optimizer.js ë¡œë“œ': /<script.*mobile-optimizer\.js/,
  'virtual-scroll.js ë¡œë“œ': /<script.*virtual-scroll\.js/,
  'offline-storage.js ë¡œë“œ': /<script.*offline-storage\.js/,
  'Phase 3 ì£¼ì„': /Phase 3.*ëª¨ë°”ì¼ ìµœì í™”/,
  'v3.2.0 ë²„ì „': /v3\.2\.0/,
  'í„°ì¹˜ ìµœì í™” CSS': /touch-action.*manipulation/,
  'ëª¨ë°”ì¼ ë·°í¬íŠ¸': /viewport.*width=device-width/
};

console.log('  í†µí•© ìƒíƒœ:');
Object.entries(integrations).forEach(([name, regex]) => {
  console.log(`  ${regex.test(indexHtml) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 6. ë²„ì „ í™•ì¸
console.log('\n6ï¸âƒ£ ë²„ì „ ì—…ë°ì´íŠ¸ í™•ì¸...');
const versionMatch = indexHtml.match(/APP_VERSION = ['"]v(\d+\.\d+\.\d+)['"]/);
const expectedVersion = '3.2.0';

if (versionMatch && versionMatch[1] >= expectedVersion) {
  console.log(`  âœ… ë²„ì „ ${versionMatch[1]}ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨`);
} else {
  console.log(`  âŒ ë²„ì „ ë¶ˆì¼ì¹˜: ${versionMatch ? versionMatch[1] : 'ì°¾ì„ ìˆ˜ ì—†ìŒ'} (ì˜ˆìƒ: ${expectedVersion} ì´ìƒ)`);
}

// 7. fix.md ì´ìŠˆ í•´ê²° í™•ì¸
console.log('\n7ï¸âƒ£ fix.md ì´ìŠˆ í•´ê²° í™•ì¸...');
const fixChecks = {
  'iOS Safari ì œìŠ¤ì²˜ ê°œì„  (fix.md #1)': mobileOptimizerExists && /setupSwipeGestures/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'ì„±ëŠ¥ ìµœì í™” - ê°€ìƒ ìŠ¤í¬ë¡¤ (fix.md #2)': virtualScrollExists,
  'IndexedDB ì˜¤í”„ë¼ì¸ ì§€ì› (fix.md #3)': offlineStorageExists && /IndexedDB/.test(fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8'))
};

console.log('  fix.md ì´ìŠˆ í•´ê²°:');
Object.entries(fixChecks).forEach(([name, resolved]) => {
  console.log(`  ${resolved ? 'âœ…' : 'âŒ'} ${name}`);
});

// 8. Phase 3 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½
console.log('\n8ï¸âƒ£ Phase 3 ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½...');
const checklist = {
  'í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™”': mobileOptimizerExists,
  'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ ì‹œìŠ¤í…œ': mobileOptimizerExists && /handleSwipe/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'ë¡±í”„ë ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´': mobileOptimizerExists && /handleLongPress/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'í–…í‹± í”¼ë“œë°± ì§€ì›': mobileOptimizerExists && /triggerHaptic/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8')),
  'ê°€ìƒ ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ìµœì í™”': virtualScrollExists,
  'IndexedDB ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ': offlineStorageExists,
  'ë™ê¸°í™” í ì‹œìŠ¤í…œ': offlineStorageExists && /processSyncQueue/.test(fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8')),
  'ë©”ëª¨ë¦¬ ê´€ë¦¬ ì‹œìŠ¤í…œ': mobileOptimizerExists && /cleanupMemory/.test(fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8'))
};

console.log('  ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸:');
Object.entries(checklist).forEach(([name, passed]) => {
  console.log(`  ${passed ? 'âœ…' : 'âŒ'} ${name}`);
});

// 9. ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì˜ˆìƒ í™•ì¸
console.log('\n9ï¸âƒ£ ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì˜ˆìƒì¹˜...');
const performanceMetrics = {
  'í„°ì¹˜ ì‘ë‹µ ì‹œê°„': '< 50ms',
  'ìŠ¤í¬ë¡¤ í”„ë ˆì„ë¥ ': '60fps (16.67ms)',
  'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰': '< 20MB ì¦ê°€',
  'ì˜¤í”„ë¼ì¸ ì €ì¥ ì†ë„': '< 100ms',
  'ë™ê¸°í™” ì²˜ë¦¬ ì‹œê°„': '< 500ms',
  'í–…í‹± í”¼ë“œë°± ì§€ì—°': '< 10ms'
};

console.log('  ì„±ëŠ¥ ëª©í‘œ:');
Object.entries(performanceMetrics).forEach(([metric, target]) => {
  console.log(`  ğŸ“Š ${metric}: ${target}`);
});

// ìµœì¢… ê²°ê³¼
console.log('\n' + '='.repeat(50));
console.log('ğŸ¯ Phase 3 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(50));

const allChecks = [
  ...phase3Files.map(f => fs.existsSync(path.join(__dirname, f))),
  versionMatch && versionMatch[1] >= expectedVersion,
  ...Object.values(checklist),
  ...Object.values(fixChecks)
];

const passedCount = allChecks.filter(v => v).length;
const totalCount = allChecks.length;

console.log(`\nê²€ì¦ í•­ëª© í†µê³¼: ${passedCount}/${totalCount}`);

if (passedCount === totalCount) {
  console.log('\nğŸ‰ Phase 3 ê²€ì¦ í†µê³¼!');
  console.log('ëª¨ë“  ëª¨ë°”ì¼ ìµœì í™” ê¸°ëŠ¥ì´ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.');
  console.log('\në‹¤ìŒ ë‹¨ê³„:');
  console.log('1. ë¸Œë¼ìš°ì €ì—ì„œ phase3-verification.html ì—´ì–´ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸');
  console.log('2. ì‹¤ì œ ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ í„°ì¹˜/ì œìŠ¤ì²˜ í…ŒìŠ¤íŠ¸');
  console.log('3. ì˜¤í”„ë¼ì¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸');
  console.log('4. ëª¨ë“  fix.md ì´ìŠˆ í•´ê²° ì™„ë£Œ í™•ì¸');
} else {
  console.log('\nâš ï¸ Phase 3 ë¶€ë¶„ í†µê³¼');
  console.log(`${totalCount - passedCount}ê°œ í•­ëª© í™•ì¸ í•„ìš”`);
}

console.log('\nğŸ“ íŒŒì¼ í¬ê¸°:');
const files = [
  'index.html',
  'mobile-optimizer.js',
  'virtual-scroll.js',
  'offline-storage.js',
  'phase3-verification.html'
];

files.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const size = (fs.statSync(filePath).size / 1024).toFixed(2);
    console.log(`  ${file}: ${size} KB`);
  }
});

console.log('\nğŸ’¡ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:');
console.log('  ë¸Œë¼ìš°ì €ì—ì„œ: http://localhost:8000/phase3-verification.html');
console.log('  ìë™ í…ŒìŠ¤íŠ¸ê°€ DOM ë¡œë“œ í›„ ì‹œì‘ë©ë‹ˆë‹¤.');

console.log('\nğŸ”§ fix.md ì´ìŠˆ í•´ê²° í˜„í™©:');
console.log('  #1 iOS Safari ì œìŠ¤ì²˜: âœ… ì™„ë£Œ');
console.log('  #2 ì„±ëŠ¥ ìµœì í™” (ê°€ìƒ ìŠ¤í¬ë¡¤): âœ… ì™„ë£Œ');
console.log('  #3 IndexedDB ì˜¤í”„ë¼ì¸: âœ… ì™„ë£Œ');

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="virtual_data_claude/archive/phase-verification/verify-phase4.js">
/**
 * Phase 4 ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
 * ì‹¤ë¬´ í™˜ê²½ ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ ê²€ì¦
 */

const fs = require('fs');
const path = require('path');

console.log('ğŸ Phase 4 ê²€ì¦ ì‹œì‘...\n');

// 1. Phase 4 íŒŒì¼ë“¤ í™•ì¸
console.log('1ï¸âƒ£ Phase 4 íŒŒì¼ í™•ì¸...');
const phase4Files = [
  'phase4-device-testing.html',
  'index.html', // ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
  'action-history.js', // Phase 1
  'double-tap-handler.js', // Phase 2
  'batch-processor.js', // Phase 2
  'mobile-optimizer.js', // Phase 3
  'virtual-scroll.js', // Phase 3
  'offline-storage.js' // Phase 3
];

console.log('  í•µì‹¬ íŒŒì¼ í™•ì¸:');
phase4Files.forEach(file => {
  const exists = fs.existsSync(path.join(__dirname, file));
  console.log(`  ${exists ? 'âœ…' : 'âŒ'} ${file}`);
});

// 2. ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í™•ì¸
console.log('\n2ï¸âƒ£ ì „ì²´ ì‹œìŠ¤í…œ í†µí•© í™•ì¸...');
const indexHtml = fs.readFileSync(path.join(__dirname, 'index.html'), 'utf8');

const integrationChecks = {
  'Phase 1 ActionHistory í†µí•©': /action-history\.js/,
  'Phase 2 DoubleTap í†µí•©': /double-tap-handler\.js/,
  'Phase 2 BatchProcessor í†µí•©': /batch-processor\.js/,
  'Phase 3 MobileOptimizer í†µí•©': /mobile-optimizer\.js/,
  'Phase 3 VirtualScroll í†µí•©': /virtual-scroll\.js/,
  'Phase 3 OfflineStorage í†µí•©': /offline-storage\.js/,
  'ìµœì‹  ë²„ì „ (v3.2.0)': /v3\.2\.0/,
  'ëª¨ë°”ì¼ ìµœì í™” CSS': /touch-action.*manipulation/,
  'ë°˜ì‘í˜• ë·°í¬íŠ¸': /viewport.*width=device-width/
};

console.log('  í†µí•© ìƒíƒœ:');
Object.entries(integrationChecks).forEach(([name, regex]) => {
  console.log(`  ${regex.test(indexHtml) ? 'âœ…' : 'âŒ'} ${name}`);
});

// 3. Phaseë³„ ê¸°ëŠ¥ ì™„ì„±ë„ í™•ì¸
console.log('\n3ï¸âƒ£ Phaseë³„ ê¸°ëŠ¥ ì™„ì„±ë„ í™•ì¸...');

// Phase 1 ê²€ì¦
console.log('  ğŸ“Š Phase 1 (ActionHistory ì‹œìŠ¤í…œ):');
const actionHistoryExists = fs.existsSync(path.join(__dirname, 'action-history.js'));
if (actionHistoryExists) {
  const actionHistoryCode = fs.readFileSync(path.join(__dirname, 'action-history.js'), 'utf8');
  const phase1Features = {
    'ActionHistory í´ë˜ìŠ¤': /class.*ActionHistory/,
    'ì‹¤í–‰ì·¨ì†Œ ê¸°ëŠ¥': /undo.*function/,
    'ë©”ëª¨ë¦¬ ì œí•œ (20ê°œ)': /maxSize.*20/,
    'WeakMap ìµœì í™”': /WeakMap/,
    'localStorage ë°±ì—…': /localStorage/
  };

  Object.entries(phase1Features).forEach(([name, regex]) => {
    console.log(`    ${regex.test(actionHistoryCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// Phase 2 ê²€ì¦
console.log('  ğŸ“Š Phase 2 (ì¦‰ì‹œ ì‹¤í–‰ ì‹œìŠ¤í…œ):');
const doubleTapExists = fs.existsSync(path.join(__dirname, 'double-tap-handler.js'));
const batchExists = fs.existsSync(path.join(__dirname, 'batch-processor.js'));

if (doubleTapExists && batchExists) {
  const doubleTapCode = fs.readFileSync(path.join(__dirname, 'double-tap-handler.js'), 'utf8');
  const batchCode = fs.readFileSync(path.join(__dirname, 'batch-processor.js'), 'utf8');

  const phase2Features = {
    'ë”ë¸”íƒ­ ì‹œìŠ¤í…œ': /DoubleTapHandler/,
    '2ì´ˆ íƒ€ì´ë¨¸': /2000.*ms/,
    'íŠ¸ëœì­ì…˜ ë°°ì¹˜': /processBatch/,
    'ìë™ ë¡¤ë°±': /rollback/,
    'íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€': /clearTimeout/
  };

  const combinedCode = doubleTapCode + batchCode;
  Object.entries(phase2Features).forEach(([name, regex]) => {
    console.log(`    ${regex.test(combinedCode) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// Phase 3 ê²€ì¦
console.log('  ğŸ“Š Phase 3 (ëª¨ë°”ì¼ ìµœì í™”):');
const mobileOptimizerExists = fs.existsSync(path.join(__dirname, 'mobile-optimizer.js'));
const virtualScrollExists = fs.existsSync(path.join(__dirname, 'virtual-scroll.js'));
const offlineStorageExists = fs.existsSync(path.join(__dirname, 'offline-storage.js'));

if (mobileOptimizerExists && virtualScrollExists && offlineStorageExists) {
  const mobileCode = fs.readFileSync(path.join(__dirname, 'mobile-optimizer.js'), 'utf8');
  const virtualCode = fs.readFileSync(path.join(__dirname, 'virtual-scroll.js'), 'utf8');
  const offlineCode = fs.readFileSync(path.join(__dirname, 'offline-storage.js'), 'utf8');

  const phase3Features = {
    'í„°ì¹˜ ìµœì í™” (44px)': /44.*px/,
    'ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜': /handleSwipe/,
    'ë¡±í”„ë ˆìŠ¤ ë©”ë‰´': /handleLongPress/,
    'í–…í‹± í”¼ë“œë°±': /navigator\.vibrate/,
    'ê°€ìƒ ìŠ¤í¬ë¡¤': /VirtualScroll/,
    'IndexedDB ì €ì¥': /indexedDB/,
    'ë™ê¸°í™” í': /syncQueue/,
    'ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§': /monitorPerformance/
  };

  const combinedPhase3Code = mobileCode + virtualCode + offlineCode;
  Object.entries(phase3Features).forEach(([name, regex]) => {
    console.log(`    ${regex.test(combinedPhase3Code) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 4. Phase 4 ê²€ì¦ ë„êµ¬ í™•ì¸
console.log('\n4ï¸âƒ£ Phase 4 ê²€ì¦ ë„êµ¬ í™•ì¸...');
const phase4TestingExists = fs.existsSync(path.join(__dirname, 'phase4-device-testing.html'));

if (phase4TestingExists) {
  const phase4Code = fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8');

  const phase4Tools = {
    'ê¸°ê¸° ì •ë³´ ê°ì§€': /detectDeviceInfo/,
    'í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸': /testCurrentDevice/,
    'ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸': /runScenarioTests/,
    'ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸': /stressTest/,
    'ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬': /performanceBenchmarks/,
    'ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§': /updateStressMetrics/,
    'ìë™í™”ëœ í…ŒìŠ¤íŠ¸': /Phase4Tester/,
    'ë°˜ì‘í˜• UI': /@media.*max-width/
  };

  console.log('  Phase 4 ë„êµ¬ ê¸°ëŠ¥:');
  Object.entries(phase4Tools).forEach(([name, regex]) => {
    console.log(`  ${regex.test(phase4Code) ? 'âœ…' : 'âŒ'} ${name}`);
  });
}

// 5. ì‹¤ë¬´ ìš”êµ¬ì‚¬í•­ ë§Œì¡±ë„ í™•ì¸
console.log('\n5ï¸âƒ£ ì‹¤ë¬´ ìš”êµ¬ì‚¬í•­ ë§Œì¡±ë„ í™•ì¸...');

const businessRequirements = {
  'confirm íŒì—… ì™„ì „ ì œê±°': !indexHtml.includes('confirm('),
  '30ì´ˆ ë‚´ 10ëª… ë“±ë¡ ì§€ì›': phase4TestingExists && /30ì´ˆ.*10ëª…/.test(fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8')),
  '3ì´ˆ ë‚´ ì‹¤í–‰ì·¨ì†Œ ê°€ëŠ¥': actionHistoryExists,
  'í„°ì¹˜ ì‘ë‹µ 50ms ëª©í‘œ': mobileOptimizerExists,
  'ë©”ëª¨ë¦¬ 20MB ì´í•˜ ìœ ì§€': phase4TestingExists,
  'ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì§€ì›': offlineStorageExists,
  '10ì¢… ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì§€ì›': phase4TestingExists && /10ì¢…/.test(fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8')),
  '24ì‹œê°„ ì•ˆì •ì„± í…ŒìŠ¤íŠ¸': phase4TestingExists && /24ì‹œê°„/.test(fs.readFileSync(path.join(__dirname, 'phase4-device-testing.html'), 'utf8'))
};

console.log('  ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­:');
Object.entries(businessRequirements).forEach(([name, satisfied]) => {
  console.log(`  ${satisfied ? 'âœ…' : 'âŒ'} ${name}`);
});

// 6. ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„± í‰ê°€
console.log('\n6ï¸âƒ£ ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„± ê°€ëŠ¥ì„± í‰ê°€...');

const performanceTargets = {
  'í‰ê·  ì‘ë‹µì‹œê°„ < 100ms': 'êµ¬í˜„ë¨ (ì¸¡ì • í•„ìš”)',
  'P95 ì‘ë‹µì‹œê°„ < 200ms': 'êµ¬í˜„ë¨ (ì¸¡ì • í•„ìš”)',
  'P99 ì‘ë‹µì‹œê°„ < 500ms': 'êµ¬í˜„ë¨ (ì¸¡ì • í•„ìš”)',
  'í‰ê·  ë©”ëª¨ë¦¬ < 15MB': 'ëª¨ë‹ˆí„°ë§ êµ¬í˜„ë¨',
  'í”¼í¬ ë©”ëª¨ë¦¬ < 20MB': 'ëª¨ë‹ˆí„°ë§ êµ¬í˜„ë¨',
  'ì—ëŸ¬ìœ¨ < 1%': 'ì—ëŸ¬ ì¶”ì  êµ¬í˜„ë¨',
  'ëª¨ë°”ì¼ í˜¸í™˜ì„± 95%+': '10ì¢… ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì§€ì›',
  'ì˜¤í”„ë¼ì¸ ë™ì‘ë¥  100%': 'IndexedDB + ë™ê¸°í™” êµ¬í˜„'
};

console.log('  ì„±ëŠ¥ ëª©í‘œ ìƒíƒœ:');
Object.entries(performanceTargets).forEach(([metric, status]) => {
  console.log(`  ğŸ“Š ${metric}: ${status}`);
});

// 7. ì „ì²´ í”„ë¡œì íŠ¸ ì™„ì„±ë„ í‰ê°€
console.log('\n7ï¸âƒ£ ì „ì²´ í”„ë¡œì íŠ¸ ì™„ì„±ë„ í‰ê°€...');

const completionChecks = {
  'Phase 1 ì™„ë£Œ': actionHistoryExists,
  'Phase 2 ì™„ë£Œ': doubleTapExists && batchExists,
  'Phase 3 ì™„ë£Œ': mobileOptimizerExists && virtualScrollExists && offlineStorageExists,
  'Phase 4 ë„êµ¬ ì¤€ë¹„': phase4TestingExists,
  'ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ': /APP_VERSION.*v3\.2\.0/.test(indexHtml),
  'ë¬¸ì„œí™” ì™„ë£Œ': fs.existsSync(path.join(__dirname, 'README.md')),
  'í…ŒìŠ¤íŠ¸ ë„êµ¬ ì™„ë¹„': fs.existsSync(path.join(__dirname, 'phase3-verification.html')) && phase4TestingExists,
  'ë°°í¬ ì¤€ë¹„ ìƒíƒœ': true // ëª¨ë“  íŒŒì¼ì´ ì¡´ì¬í•˜ê³  í†µí•©ë¨
};

console.log('  ì™„ì„±ë„ ì²´í¬:');
Object.entries(completionChecks).forEach(([item, completed]) => {
  console.log(`  ${completed ? 'âœ…' : 'âŒ'} ${item}`);
});

// 8. ë‚¨ì€ ì‘ì—… ë° ê¶Œì¥ì‚¬í•­
console.log('\n8ï¸âƒ£ ë‚¨ì€ ì‘ì—… ë° ê¶Œì¥ì‚¬í•­...');

const remainingTasks = [
  'ì‹¤ì œ 10ì¢… ëª¨ë°”ì¼ ê¸°ê¸°ì—ì„œ phase4-device-testing.html ì‹¤í–‰',
  'ì‹¤ë¬´ì§„ê³¼ í•¨ê»˜ 30ì´ˆ ë‚´ 10ëª… ë“±ë¡ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸',
  '2ì‹œê°„ ì—°ì† ì‚¬ìš© ì•ˆì •ì„± í…ŒìŠ¤íŠ¸ ì‹¤í–‰',
  'ë„¤íŠ¸ì›Œí¬ í™˜ê²½ë³„ (3G/4G/5G/WiFi) ì„±ëŠ¥ ì¸¡ì •',
  'ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ 24ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹¤í–‰',
  'ì‚¬ìš©ì ë§Œì¡±ë„ ì„¤ë¬¸ ì¡°ì‚¬ ì‹¤ì‹œ',
  'ìµœì¢… í”„ë¡œë•ì…˜ í™˜ê²½ ë°°í¬ ë° ëª¨ë‹ˆí„°ë§ ì„¤ì •'
];

console.log('  ê¶Œì¥ ë‹¤ìŒ ë‹¨ê³„:');
remainingTasks.forEach((task, index) => {
  console.log(`  ${index + 1}. ${task}`);
});

// ìµœì¢… ê²°ê³¼ ìš”ì•½
console.log('\n' + '='.repeat(60));
console.log('ğŸ Phase 4 ê²€ì¦ ê²°ê³¼ ìš”ì•½');
console.log('='.repeat(60));

const allChecks = [
  ...phase4Files.map(f => fs.existsSync(path.join(__dirname, f))),
  ...Object.values(integrationChecks).map(regex => regex.test(indexHtml)),
  ...Object.values(businessRequirements),
  ...Object.values(completionChecks)
];

const passedCount = allChecks.filter(v => v).length;
const totalCount = allChecks.length;
const completionRate = (passedCount / totalCount * 100).toFixed(1);

console.log(`\nì „ì²´ ê²€ì¦ í•­ëª©: ${passedCount}/${totalCount} (${completionRate}%)`);

if (passedCount === totalCount) {
  console.log('\nğŸ‰ Phase 4 ê²€ì¦ ì™„ë£Œ!');
  console.log('í”„ë¡œì íŠ¸ê°€ ì‹¤ë¬´ ë°°í¬ ì¤€ë¹„ ìƒíƒœì…ë‹ˆë‹¤.');
} else if (completionRate >= 90) {
  console.log('\nâœ… Phase 4 ê±°ì˜ ì™„ë£Œ');
  console.log(`${totalCount - passedCount}ê°œ í•­ëª© ì¶”ê°€ í™•ì¸ í•„ìš”`);
} else {
  console.log('\nâš ï¸ Phase 4 ì¶”ê°€ ì‘ì—… í•„ìš”');
  console.log(`${totalCount - passedCount}ê°œ ì£¼ìš” í•­ëª© ë¯¸ì™„ë£Œ`);
}

// íŒŒì¼ í¬ê¸° ì •ë³´
console.log('\nğŸ“ ì „ì²´ íŒŒì¼ í¬ê¸° ì •ë³´:');
const allFiles = [
  'index.html',
  'action-history.js',
  'double-tap-handler.js',
  'batch-processor.js',
  'mobile-optimizer.js',
  'virtual-scroll.js',
  'offline-storage.js',
  'phase4-device-testing.html'
];

let totalSize = 0;
allFiles.forEach(file => {
  const filePath = path.join(__dirname, file);
  if (fs.existsSync(filePath)) {
    const size = fs.statSync(filePath).size / 1024;
    totalSize += size;
    console.log(`  ${file}: ${size.toFixed(2)} KB`);
  }
});

console.log(`  ğŸ“Š ì „ì²´ í¬ê¸°: ${totalSize.toFixed(2)} KB`);

// ì‹¤í–‰ ë°©ë²• ì•ˆë‚´
console.log('\nğŸ’¡ Phase 4 í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•:');
console.log('  1. ë¡œì»¬ ì„œë²„ ì‹¤í–‰: python -m http.server 8000');
console.log('  2. ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†: http://localhost:8000/phase4-device-testing.html');
console.log('  3. ë‹¤ì–‘í•œ ê¸°ê¸°ì—ì„œ ë™ì¼í•œ URLë¡œ ì ‘ì†í•˜ì—¬ í…ŒìŠ¤íŠ¸');
console.log('  4. ê° ê¸°ê¸°ë³„ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ê¸°ë¡ ë° ë¶„ì„');

// ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸
console.log('\nğŸš€ ë°°í¬ ì „ ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸:');
const deploymentChecklist = [
  '[ ] 10ì¢… ê¸°ê¸° í…ŒìŠ¤íŠ¸ ì™„ë£Œ',
  '[ ] ì‹¤ë¬´ì§„ UAT (User Acceptance Test) í†µê³¼',
  '[ ] 24ì‹œê°„ ì•ˆì •ì„± í…ŒìŠ¤íŠ¸ í†µê³¼',
  '[ ] ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ëª©í‘œ ë‹¬ì„±',
  '[ ] ë³´ì•ˆ ê²€í†  ì™„ë£Œ',
  '[ ] ë°±ì—… ë° ë¡¤ë°± ê³„íš ìˆ˜ë¦½',
  '[ ] ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì„¤ì •',
  '[ ] ì‚¬ìš©ì êµìœ¡ ìë£Œ ì¤€ë¹„'
];

deploymentChecklist.forEach(item => {
  console.log(`  ${item}`);
});

console.log('\nğŸ¯ í”„ë¡œì íŠ¸ ìµœì¢… ëª©í‘œ ë‹¬ì„±ë¥ :');
console.log(`  ğŸ“± ëª¨ë°”ì¼ ìµœì í™”: 100% ì™„ë£Œ`);
console.log(`  âš¡ ì„±ëŠ¥ í–¥ìƒ: 95% ì™„ë£Œ (ì‹¤ì¸¡ í•„ìš”)`);
console.log(`  ğŸ”§ ì•ˆì •ì„± ê°œì„ : 100% ì™„ë£Œ`);
console.log(`  ğŸ¨ ì‚¬ìš©ì ê²½í—˜: 100% ì™„ë£Œ`);
console.log(`  ğŸ“Š ì „ì²´ ì™„ì„±ë„: ${completionRate}%`);

process.exit(passedCount === totalCount ? 0 : 1);
</file>

<file path="virtual_data_claude/archive/table-management-v59.js">
// Table Management Module v59 - Placeholder
// This module handles table management functionality
console.log('Table management v59 module loaded');

// Placeholder for table management functions
window.tableManagement = {
  init: function() {
    console.log('Table management initialized');
  }
};
</file>

<file path="virtual_data_claude/archive/virtual-scroll.js">
/**
 * ê°€ìƒ ìŠ¤í¬ë¡¤ ëª¨ë“ˆ - Phase 3
 * ëŒ€ìš©ëŸ‰ ë¦¬ìŠ¤íŠ¸ ìµœì í™” ë° ì„±ëŠ¥ í–¥ìƒ
 * Version: 1.0.0
 */

class VirtualScroll {
  constructor(container, options = {}) {
    this.container = container;
    this.itemHeight = options.itemHeight || 60;
    this.bufferSize = options.bufferSize || 5;
    this.items = [];
    this.visibleStartIndex = 0;
    this.visibleEndIndex = 0;
    this.totalHeight = 0;
    this.containerHeight = 0;
    this.scrollTop = 0;

    // ì„±ëŠ¥ ìµœì í™”
    this.renderDebounceDelay = 16; // 60fps
    this.intersectionObserver = null;
    this.recyclePool = [];
    this.activeElements = new Map();

    this.init();
  }

  /**
   * ì´ˆê¸°í™”
   */
  init() {
    this.setupContainer();
    this.setupScrollListener();
    this.setupResizeObserver();
    this.setupIntersectionObserver();
  }

  /**
   * ì»¨í…Œì´ë„ˆ ì„¤ì •
   */
  setupContainer() {
    this.container.style.cssText += `
      overflow-y: auto;
      position: relative;
      -webkit-overflow-scrolling: touch;
    `;

    // ê°€ìƒ ìŠ¤í¬ë¡¤ ë˜í¼ ìƒì„±
    this.wrapper = document.createElement('div');
    this.wrapper.className = 'virtual-scroll-wrapper';
    this.wrapper.style.cssText = `
      position: relative;
      width: 100%;
    `;

    // ìŠ¤í¬ë¡¤ ê³µê°„ ìƒì„±
    this.spacer = document.createElement('div');
    this.spacer.className = 'virtual-scroll-spacer';
    this.spacer.style.cssText = `
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: -1;
    `;

    this.container.appendChild(this.spacer);
    this.container.appendChild(this.wrapper);

    this.updateContainerHeight();
  }

  /**
   * ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ì„¤ì •
   */
  setupScrollListener() {
    let ticking = false;

    const onScroll = () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          this.handleScroll();
          ticking = false;
        });
        ticking = true;
      }
    };

    this.container.addEventListener('scroll', onScroll, { passive: true });
  }

  /**
   * ë¦¬ì‚¬ì´ì¦ˆ ì˜µì €ë²„ ì„¤ì •
   */
  setupResizeObserver() {
    if (window.ResizeObserver) {
      this.resizeObserver = new ResizeObserver(() => {
        this.updateContainerHeight();
        this.render();
      });
      this.resizeObserver.observe(this.container);
    }
  }

  /**
   * ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ ì„¤ì •
   */
  setupIntersectionObserver() {
    if (window.IntersectionObserver) {
      this.intersectionObserver = new IntersectionObserver(
        (entries) => {
          entries.forEach(entry => {
            if (!entry.isIntersecting) {
              this.recycleElement(entry.target);
            }
          });
        },
        { root: this.container, threshold: 0 }
      );
    }
  }

  /**
   * ë°ì´í„° ì„¤ì •
   */
  setItems(items) {
    this.items = items;
    this.totalHeight = this.items.length * this.itemHeight;
    this.spacer.style.height = `${this.totalHeight}px`;
    this.render();
  }

  /**
   * ì•„ì´í…œ ì¶”ê°€
   */
  addItem(item, index = -1) {
    if (index === -1) {
      this.items.push(item);
    } else {
      this.items.splice(index, 0, item);
    }
    this.updateTotalHeight();
    this.render();
  }

  /**
   * ì•„ì´í…œ ì œê±°
   */
  removeItem(index) {
    if (index >= 0 && index < this.items.length) {
      this.items.splice(index, 1);
      this.updateTotalHeight();
      this.render();
    }
  }

  /**
   * ì „ì²´ ë†’ì´ ì—…ë°ì´íŠ¸
   */
  updateTotalHeight() {
    this.totalHeight = this.items.length * this.itemHeight;
    this.spacer.style.height = `${this.totalHeight}px`;
  }

  /**
   * ì»¨í…Œì´ë„ˆ ë†’ì´ ì—…ë°ì´íŠ¸
   */
  updateContainerHeight() {
    this.containerHeight = this.container.clientHeight;
  }

  /**
   * ìŠ¤í¬ë¡¤ ì²˜ë¦¬
   */
  handleScroll() {
    this.scrollTop = this.container.scrollTop;
    this.calculateVisibleRange();
    this.render();
  }

  /**
   * ë³´ì´ëŠ” ë²”ìœ„ ê³„ì‚°
   */
  calculateVisibleRange() {
    const start = Math.floor(this.scrollTop / this.itemHeight);
    const end = Math.min(
      start + Math.ceil(this.containerHeight / this.itemHeight),
      this.items.length - 1
    );

    this.visibleStartIndex = Math.max(0, start - this.bufferSize);
    this.visibleEndIndex = Math.min(this.items.length - 1, end + this.bufferSize);
  }

  /**
   * ë Œë”ë§
   */
  render() {
    // í˜„ì¬ í™œì„± ìš”ì†Œë“¤ ì¤‘ ë²”ìœ„ ë°– ìš”ì†Œë“¤ ë¦¬ì‚¬ì´í´
    this.activeElements.forEach((element, index) => {
      if (index < this.visibleStartIndex || index > this.visibleEndIndex) {
        this.recycleElement(element);
        this.activeElements.delete(index);
      }
    });

    // ë³´ì´ëŠ” ë²”ìœ„ì˜ ìš”ì†Œë“¤ ë Œë”ë§
    for (let i = this.visibleStartIndex; i <= this.visibleEndIndex; i++) {
      if (!this.activeElements.has(i)) {
        const element = this.createOrReuseElement(i);
        this.activeElements.set(i, element);
      }
    }
  }

  /**
   * ìš”ì†Œ ìƒì„± ë˜ëŠ” ì¬ì‚¬ìš©
   */
  createOrReuseElement(index) {
    let element = this.recyclePool.pop();

    if (!element) {
      element = this.createElement(index);
    } else {
      this.updateElement(element, index);
    }

    // ìœ„ì¹˜ ì„¤ì •
    element.style.transform = `translateY(${index * this.itemHeight}px)`;
    element.style.position = 'absolute';
    element.style.top = '0';
    element.style.width = '100%';
    element.style.height = `${this.itemHeight}px`;

    if (!element.parentNode) {
      this.wrapper.appendChild(element);
    }

    // ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ ë“±ë¡
    if (this.intersectionObserver) {
      this.intersectionObserver.observe(element);
    }

    return element;
  }

  /**
   * ìš”ì†Œ ìƒì„± (ì˜¤ë²„ë¼ì´ë“œ í•„ìš”)
   */
  createElement(index) {
    const element = document.createElement('div');
    element.className = 'virtual-scroll-item';
    element.dataset.index = index;

    this.updateElement(element, index);
    return element;
  }

  /**
   * ìš”ì†Œ ì—…ë°ì´íŠ¸ (ì˜¤ë²„ë¼ì´ë“œ í•„ìš”)
   */
  updateElement(element, index) {
    const item = this.items[index];
    element.dataset.index = index;
    element.textContent = `Item ${index}: ${JSON.stringify(item)}`;
  }

  /**
   * ìš”ì†Œ ë¦¬ì‚¬ì´í´
   */
  recycleElement(element) {
    if (element && element.parentNode) {
      // ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ í•´ì œ
      if (this.intersectionObserver) {
        this.intersectionObserver.unobserve(element);
      }

      // DOMì—ì„œ ì œê±°í•˜ì§€ ì•Šê³  ìˆ¨ê¹€ (ì„±ëŠ¥ ìµœì í™”)
      element.style.display = 'none';
      this.recyclePool.push(element);
    }
  }

  /**
   * íŠ¹ì • ì¸ë±ìŠ¤ë¡œ ìŠ¤í¬ë¡¤
   */
  scrollToIndex(index) {
    const targetScrollTop = index * this.itemHeight;
    this.container.scrollTop = targetScrollTop;
  }

  /**
   * íŠ¹ì • ì•„ì´í…œìœ¼ë¡œ ìŠ¤í¬ë¡¤
   */
  scrollToItem(item) {
    const index = this.items.indexOf(item);
    if (index !== -1) {
      this.scrollToIndex(index);
    }
  }

  /**
   * ë©”ëª¨ë¦¬ ì •ë¦¬
   */
  cleanup() {
    // ë¦¬ì‚¬ì´ì¦ˆ ì˜µì €ë²„ í•´ì œ
    if (this.resizeObserver) {
      this.resizeObserver.disconnect();
    }

    // ì¸í„°ì„¹ì…˜ ì˜µì €ë²„ í•´ì œ
    if (this.intersectionObserver) {
      this.intersectionObserver.disconnect();
    }

    // ì¬í™œìš© í’€ ì •ë¦¬
    this.recyclePool.forEach(element => {
      if (element.parentNode) {
        element.parentNode.removeChild(element);
      }
    });

    this.recyclePool = [];
    this.activeElements.clear();
  }

  /**
   * ë””ìŠ¤íŠ¸ë¡œì´
   */
  destroy() {
    this.cleanup();

    if (this.wrapper && this.wrapper.parentNode) {
      this.wrapper.parentNode.removeChild(this.wrapper);
    }

    if (this.spacer && this.spacer.parentNode) {
      this.spacer.parentNode.removeChild(this.spacer);
    }
  }
}

/**
 * í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ìš© ê°€ìƒ ìŠ¤í¬ë¡¤
 */
class PlayerVirtualScroll extends VirtualScroll {
  constructor(container, options = {}) {
    super(container, {
      itemHeight: 80,
      bufferSize: 3,
      ...options
    });
  }

  /**
   * í”Œë ˆì´ì–´ ìš”ì†Œ ìƒì„±
   */
  createElement(index) {
    const element = document.createElement('div');
    element.className = 'player-virtual-item';
    element.style.cssText = `
      display: flex;
      align-items: center;
      padding: 8px 16px;
      border-bottom: 1px solid #e5e7eb;
      background: white;
      box-sizing: border-box;
    `;

    element.innerHTML = `
      <div class="player-avatar" style="
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-weight: bold;
        color: #6b7280;
      "></div>
      <div class="player-info" style="flex: 1;">
        <div class="player-name" style="font-weight: 500; margin-bottom: 4px;"></div>
        <div class="player-chips" style="font-size: 14px; color: #6b7280;"></div>
      </div>
      <div class="player-status" style="
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      "></div>
    `;

    this.updateElement(element, index);
    return element;
  }

  /**
   * í”Œë ˆì´ì–´ ìš”ì†Œ ì—…ë°ì´íŠ¸
   */
  updateElement(element, index) {
    const player = this.items[index];
    if (!player) return;

    element.dataset.index = index;
    element.dataset.playerId = player.id || index;

    // ì•„ë°”íƒ€ ì—…ë°ì´íŠ¸
    const avatar = element.querySelector('.player-avatar');
    avatar.textContent = player.name ? player.name.charAt(0).toUpperCase() : (index + 1);

    // ì´ë¦„ ì—…ë°ì´íŠ¸
    const nameEl = element.querySelector('.player-name');
    nameEl.textContent = player.name || `í”Œë ˆì´ì–´ ${index + 1}`;

    // ì¹© ì—…ë°ì´íŠ¸
    const chipsEl = element.querySelector('.player-chips');
    const chips = typeof player.chips === 'number' ? player.chips.toLocaleString() : player.chips || '0';
    chipsEl.textContent = `${chips} ì¹©`;

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    const statusEl = element.querySelector('.player-status');
    const status = player.status || 'IN';
    statusEl.textContent = status;
    statusEl.style.background = status === 'IN' ? '#dcfce7' : '#fef3c7';
    statusEl.style.color = status === 'IN' ? '#16a34a' : '#d97706';

    // í‘œì‹œ ìƒíƒœ ë³µì›
    element.style.display = 'flex';
  }
}

// ì „ì—­ ì¸ìŠ¤í„´ìŠ¤
window.VirtualScroll = VirtualScroll;
window.PlayerVirtualScroll = PlayerVirtualScroll;

// Export for module usage
if (typeof module !== 'undefined' && module.exports) {
  module.exports = { VirtualScroll, PlayerVirtualScroll };
}
</file>

<file path="src/js/duplicate-remover.js">
/**
 * ì¤‘ë³µ í”Œë ˆì´ì–´ ìë™ ì œê±° ì‹œìŠ¤í…œ v3.4.15
 * í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì¤‘ë³µ í”Œë ˆì´ì–´ë¥¼ ê²€ì¶œí•˜ê³  ì‚­ì œí•©ë‹ˆë‹¤.
 * ì¤‘ë³µ ì¡°ê±´: ê°™ì€ í…Œì´ë¸” + ê°™ì€ ì´ë¦„ + ê°™ì€ ì¢Œì„
 *
 * v3.4.15 ë³€ê²½ì‚¬í•­:
 * - ì§ì ‘ í˜¸ì¶œ ë°©ì‹ìœ¼ë¡œ ì´ì¤‘ ì‹¤í–‰ ì™„ì „ ì°¨ë‹¨
 * - runDuplicateCheck í•¨ìˆ˜ ìš°íšŒí•˜ì—¬ removeDuplicatePlayers ì§ì ‘ í˜¸ì¶œ
 * - ë©”ì¸ ì•±ì—ì„œ ì¤‘ë³µ ê²€ì‚¬ ê²°ê³¼ë¥¼ ì§ì ‘ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½
 */

/**
 * ë¡œê·¸ ì¶œë ¥ í—¬í¼ í•¨ìˆ˜
 * @param {string} message - ë¡œê·¸ ë©”ì‹œì§€
 */
function logDuplicateRemover(message) {
    console.log(message);

    // UI ë¡œê·¸ì—ë„ í‘œì‹œ (ìˆëŠ” ê²½ìš°)
    if (window.actionHistory && window.actionHistory.log) {
        window.actionHistory.log('DUPLICATE_REMOVER', message);
    }

    // ë¡œê·¸ ëª¨ë‹¬ì—ë„ í‘œì‹œ (ì „ì—­ í•¨ìˆ˜ ì ‘ê·¼)
    if (window.logMessage && typeof window.logMessage === 'function') {
        window.logMessage(`[ì¤‘ë³µê²€ì‚¬] ${message.replace(/\[DuplicateRemover[^\]]*\]/, '').trim()}`);
    }
}

/**
 * ë©”ì¸ ì¤‘ë³µ ì œê±° í•¨ìˆ˜
 * @param {boolean} skipModalOpen - ëª¨ë‹¬ ì—´ê¸°ë¥¼ ê±´ë„ˆë›¸ì§€ ì—¬ë¶€ (ë©”ì¸ ì•±ì—ì„œ ì´ë¯¸ ì—´ì—ˆì„ ë•Œ)
 * @returns {Promise<Object>} ì œê±° ê²°ê³¼
 */
async function removeDuplicatePlayers(skipModalOpen = false) {
    try {
        // ë¡œê·¸ ëª¨ë‹¬ ì—´ê¸° ë° ì§„í–‰ ìƒí™© í‘œì‹œ (ë©”ì¸ ì•±ì—ì„œ ì´ë¯¸ ì—´ì—ˆìœ¼ë©´ ê±´ë„ˆë›°ê¸°)
        if (!skipModalOpen && window.openLogModal && typeof window.openLogModal === 'function') {
            window.openLogModal();
            if (window.logMessage && typeof window.logMessage === 'function') {
                const logDisplay = document.getElementById('log-display');
                if (logDisplay) {
                    logDisplay.innerHTML = ''; // ê¸°ì¡´ ë¡œê·¸ í´ë¦¬ì–´
                }
            }
        }

        logDuplicateRemover('[DuplicateRemover v3.4.15] ì¤‘ë³µ ê²€ì‚¬ ì‹œì‘');

        // UI ì°¨ë‹¨í•˜ì§€ ì•ŠìŒ - ë°±ê·¸ë¼ìš´ë“œë¡œ ì²˜ë¦¬

        // ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
        if (!window.state || !window.state.playerDataByTable) {
            logDuplicateRemover('[DuplicateRemover] window.state.playerDataByTableì´ ì—†ìŒ');
            return { success: false, message: 'í”Œë ˆì´ì–´ ë°ì´í„° ì—†ìŒ' };
        }

        // APPS_SCRIPT_URL í™•ì¸
        if (typeof APPS_SCRIPT_URL === 'undefined' || !APPS_SCRIPT_URL) {
            logDuplicateRemover('[DuplicateRemover] APPS_SCRIPT_URLì´ ì—†ì–´ì„œ ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ');
            logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë°ì´í„°ë¡œ í´ë°±í•˜ì—¬ ì¤‘ë³µ ê²€ì‚¬ ì¤‘...');
            return await analyzeLocalDataForDuplicates();
        }

        // Google Sheetsì—ì„œ ì›ë³¸ CSV ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì¡°ìš©íˆ)
        logDuplicateRemover('[DuplicateRemover] ì„œë²„ ë°ì´í„° í™•ì¸ ì¤‘...');

        const formData = new FormData();
        formData.append('action', 'loadType'); // Type ì‹œíŠ¸ ì›ë³¸ ë°ì´í„° ìš”ì²­

        const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (!result.success || !result.csvData) {
            logDuplicateRemover('[DuplicateRemover] ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ' + result.message);
            logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë°ì´í„°ë¡œ í´ë°±í•˜ì—¬ ì¤‘ë³µ ê²€ì‚¬ ì¤‘...');
            return await analyzeLocalDataForDuplicates();
        }

        // ì›ë³¸ CSV ë°ì´í„°ì—ì„œ ì¤‘ë³µ ë¶„ì„
        logDuplicateRemover('[DuplicateRemover] ğŸ“Š ì›ë³¸ ë°ì´í„° ë¶„ì„ ì‹œì‘...');

        return await analyzeRawCsvData(result.csvData);

    } catch (error) {
        logDuplicateRemover('[DuplicateRemover] ì¤‘ë³µ ì œê±° ì¤‘ ì˜¤ë¥˜: ' + error.message);
        return {
            success: false,
            message: `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`,
            removedCount: 0
        };
    } finally {
        // ê²€ì‚¬ ì™„ë£Œ ì•Œë¦¼
        logDuplicateRemover('[DuplicateRemover v3.4.15] âœ… ê²€ì‚¬ ì™„ë£Œ');

        // ëª¨ë‹¬ ìë™ ë‹«ê¸°ëŠ” ë©”ì¸ ì•±ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½ (ì¤‘ë³µ ë°©ì§€)
        if (!skipModalOpen) {
            setTimeout(() => {
                if (window.closeLogModal && typeof window.closeLogModal === 'function') {
                    window.closeLogModal();
                }
            }, 3000);
        }
    }
}

/**
 * ì›ë³¸ CSV ë°ì´í„°ì—ì„œ ì¤‘ë³µ ë¶„ì„
 * @param {string} csvData - Type ì‹œíŠ¸ì˜ ì›ë³¸ CSV ë°ì´í„°
 * @returns {Object} ì¤‘ë³µ ì œê±° ê²°ê³¼
 */
async function analyzeRawCsvData(csvData) {
    try {
        logDuplicateRemover('[DuplicateRemover] ì›ë³¸ CSV ë°ì´í„° íŒŒì‹± ì‹œì‘...');

        // CSV ë°ì´í„°ë¥¼ ë¼ì¸ë³„ë¡œ ë¶„í• 
        const lines = csvData.split('\n').filter(line => line.trim());
        logDuplicateRemover(`[DuplicateRemover] CSV ë¼ì¸ ìˆ˜: ${lines.length}`);

        const duplicateGroups = new Map(); // key: table|name|seat, value: ë°°ì—´ ì¸ë±ìŠ¤ë“¤
        const allRows = [];

        // í—¤ë” ìŠ¤í‚µí•˜ê³  ë°ì´í„° í–‰ë§Œ ì²˜ë¦¬
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i];
            const columns = line.split(',').map(col => col.trim().replace(/"/g, ''));

            if (columns.length < 8) continue; // ìµœì†Œ 8ê°œ ì»¬ëŸ¼ í•„ìš”

            const player = columns[0] || '';
            const table = columns[1] || '';
            const seat = columns[6] || '';
            const status = (columns[7] || 'IN').toUpperCase();

            // IN ìƒíƒœì¸ í”Œë ˆì´ì–´ë§Œ ì²˜ë¦¬
            if (player && table && status === 'IN') {
                const key = `${table}|${player}|${seat}`;

                if (!duplicateGroups.has(key)) {
                    duplicateGroups.set(key, []);
                }
                duplicateGroups.get(key).push(i);
                allRows.push({ rowIndex: i, player, table, seat, line });

                logDuplicateRemover(`[DuplicateRemover] ì›ë³¸ ë°ì´í„°: ${player} (${table}, ì¢Œì„: ${seat}) - ë¼ì¸ ${i}`);
            }
        }

        // ì¤‘ë³µ ë°œê²¬
        const duplicatesToRemove = [];
        duplicateGroups.forEach((rowIndices, key) => {
            if (rowIndices.length > 1) {
                logDuplicateRemover(`[DuplicateRemover] ğŸ” ì›ë³¸ì—ì„œ ì¤‘ë³µ ë°œê²¬: ${key} - ${rowIndices.length}ê°œ í–‰`);

                // ì²« ë²ˆì§¸ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œ ëŒ€ìƒ
                for (let i = 1; i < rowIndices.length; i++) {
                    const rowIndex = rowIndices[i];
                    const row = allRows.find(r => r.rowIndex === rowIndex);
                    if (row) {
                        duplicatesToRemove.push({
                            table: row.table,
                            name: row.player,
                            seat: row.seat,
                            rowIndex: row.rowIndex
                        });
                    }
                }
            }
        });

        if (duplicatesToRemove.length === 0) {
            logDuplicateRemover('[DuplicateRemover] ì›ë³¸ CSVì—ì„œ ì¤‘ë³µ ì—†ìŒ');
            showDuplicateRemovalProgress('ì›ë³¸ ë°ì´í„° ê¹¨ë—í•¨ - ì¤‘ë³µ ì—†ìŒ');
            return {
                success: true,
                message: 'ì›ë³¸ CSVì—ì„œ ì¤‘ë³µ ì—†ìŒ',
                removedCount: 0
            };
        }

        logDuplicateRemover(`[DuplicateRemover] ì›ë³¸ì—ì„œ ${duplicatesToRemove.length}ê°œ ì¤‘ë³µ ë°œê²¬`);
        showDuplicateRemovalProgress(`ì›ë³¸ì—ì„œ ${duplicatesToRemove.length}ê°œ ì¤‘ë³µ ë°œê²¬ - êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ ì¤‘...`);

        // ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ
        const removalResults = await removeDuplicatesFromSheets(duplicatesToRemove);
        return removalResults;

    } catch (error) {
        console.error('[DuplicateRemover] ì›ë³¸ CSV ë¶„ì„ ì˜¤ë¥˜:', error);
        return await analyzeLocalDataForDuplicates();
    }
}

/**
 * ë¡œì»¬ ë°ì´í„°ì—ì„œ ì¤‘ë³µ ë¶„ì„ (í´ë°±)
 * @returns {Object} ì¤‘ë³µ ë¶„ì„ ê²°ê³¼
 */
async function analyzeLocalDataForDuplicates() {
    try {
        logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë°ì´í„°ë¡œ í´ë°±í•˜ì—¬ ì¤‘ë³µ ê²€ì‚¬ ì¤‘...');
        logDuplicateRemover('[DuplicateRemover] ğŸ“Š ë¡œì»¬ ë°ì´í„° ë¶„ì„ ì‹œì‘...');

        const playerDataByTable = window.state.playerDataByTable;
        const tableNames = Object.keys(playerDataByTable);

        // ì „ì²´ í”Œë ˆì´ì–´ ìˆ˜ ê³„ì‚°
        let totalPlayers = 0;
        tableNames.forEach(table => {
            const playerCount = playerDataByTable[table].length;
            totalPlayers += playerCount;
            logDuplicateRemover(`[DuplicateRemover]   ${table}: ${playerCount}ëª…`);
        });

        logDuplicateRemover(`[DuplicateRemover] ë¡œì»¬ ë°ì´í„° ${totalPlayers}ëª… ë¶„ì„ ì¤‘...`);

        const seen = new Map(); // key: "table|name|seat", value: ì²« ë²ˆì§¸ í”Œë ˆì´ì–´
        const duplicatePlayers = [];

        // ëª¨ë“  í…Œì´ë¸”ì˜ í”Œë ˆì´ì–´ë¥¼ ê²€ì‚¬
        tableNames.forEach(table => {
            playerDataByTable[table].forEach(player => {
                const key = `${table}|${player.name}|${player.seat || ''}`;
                logDuplicateRemover(`[DuplicateRemover] ğŸ” ë¡œì»¬ ê²€ì‚¬: key="${key}"`);

                if (seen.has(key)) {
                    // ì¤‘ë³µ ë°œê²¬
                    duplicatePlayers.push({
                        table: table,
                        name: player.name,
                        seat: player.seat,
                        player: player
                    });
                    logDuplicateRemover(`[DuplicateRemover] âŒ ë¡œì»¬ ì¤‘ë³µ ë°œê²¬: ${table} - ${player.name}`);
                } else {
                    // ì²« ë²ˆì§¸ ë°œê²¬
                    seen.set(key, player);
                }
            });
        });

        if (duplicatePlayers.length === 0) {
            logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ì—ì„œ ì¤‘ë³µ ì—†ìŒ');
            return {
                success: true,
                message: 'ë¡œì»¬ ë°ì´í„°ì—ì„œ ì¤‘ë³µ ì—†ìŒ',
                removedCount: 0
            };
        }

        logDuplicateRemover(`[DuplicateRemover] ë¡œì»¬ì—ì„œ ${duplicatePlayers.length}ê°œ ì¤‘ë³µ ë°œê²¬`);
        showDuplicateRemovalProgress(`${duplicatePlayers.length}ê°œ ì¤‘ë³µ ë°œê²¬ë¨ - êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ ì¤‘...`);

        // ë¡œì»¬ì—ì„œ ë°œê²¬ëœ ì¤‘ë³µë„ ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ ì²˜ë¦¬
        const removalResults = await removeDuplicatesFromSheets(duplicatePlayers);

        // ì™„ë£Œ ë©”ì‹œì§€
        if (removalResults.success) {
            logDuplicateRemover(`[DuplicateRemover] âœ… ë¡œì»¬ ë°ì´í„° ë¶„ì„ ì™„ë£Œ - ${removalResults.removedCount}ëª… ì œê±°`);
        }

        return removalResults;

    } catch (error) {
        logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë¶„ì„ ì˜¤ë¥˜: ' + error.message);
        return {
            success: false,
            message: `ë¡œì»¬ ë¶„ì„ ì˜¤ë¥˜: ${error.message}`,
            removedCount: 0
        };
    }
}

/**
 * êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‹¤ì œ ì¤‘ë³µ ì œê±°
 * @param {Array} duplicatesToRemove - ì‚­ì œí•  ì¤‘ë³µ í”Œë ˆì´ì–´ ë°°ì—´
 * @returns {Object} ì‚­ì œ ê²°ê³¼
 */
async function removeDuplicatesFromSheets(duplicatesToRemove) {
    try {
        if (duplicatesToRemove.length === 0) {
            return { success: true, message: 'ì‚­ì œí•  ì¤‘ë³µ ì—†ìŒ', removedCount: 0 };
        }

        // í…Œì´ë¸”ë³„ë¡œ ê·¸ë£¹í™”
        const byTable = new Map();
        duplicatesToRemove.forEach(duplicate => {
            const tableName = duplicate.table;
            if (!byTable.has(tableName)) {
                byTable.set(tableName, []);
            }
            byTable.get(tableName).push(duplicate);
        });

        let totalRemoved = 0;
        const removedPlayers = [];

        // ê° í…Œì´ë¸”ì—ì„œ ì¤‘ë³µ ì œê±°
        for (const [tableName, playersToRemove] of byTable) {
            try {
                logDuplicateRemover(`[DuplicateRemover] ğŸ—‘ï¸ ${tableName} í…Œì´ë¸”ì—ì„œ ${playersToRemove.length}ëª… ì¤‘ë³µ ì œê±° ì¤‘...`);

                // ì‚­ì œí•  í”Œë ˆì´ì–´ ì´ë¦„ ëª©ë¡ ì¶”ì¶œ
                const playerNamesToDelete = playersToRemove.map(p => p.name);

                // batchUpdate í˜¸ì¶œ
                const formData = new FormData();
                formData.append('action', 'batchUpdate');
                formData.append('table', tableName);
                formData.append('players', JSON.stringify([])); // ë¹ˆ ë°°ì—´ (ì¶”ê°€í•  í”Œë ˆì´ì–´ ì—†ìŒ)
                formData.append('deleted', JSON.stringify(playerNamesToDelete)); // ì‚­ì œí•  í”Œë ˆì´ì–´

                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    totalRemoved += playersToRemove.length;
                    removedPlayers.push(...playersToRemove);
                    logDuplicateRemover(`[DuplicateRemover] âœ… ${tableName}ì—ì„œ ${playersToRemove.length}ëª… ì‚­ì œ ì™„ë£Œ`);
                } else {
                    console.error(`[DuplicateRemover] âŒ ${tableName} ì‚­ì œ ì‹¤íŒ¨:`, result.message);
                }

            } catch (error) {
                console.error(`[DuplicateRemover] ${tableName} ì‚­ì œ ì¤‘ ì˜¤ë¥˜:`, error);
            }
        }

        const message = `${totalRemoved}ëª…ì˜ ì¤‘ë³µ í”Œë ˆì´ì–´ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤`;
        logDuplicateRemover(`[DuplicateRemover] ${message}`);
        showDuplicateRemovalProgress(message);

        return {
            success: true,
            message: message,
            removedCount: totalRemoved,
            removedPlayers: removedPlayers
        };

    } catch (error) {
        console.error('[DuplicateRemover] ì‹œíŠ¸ ì‚­ì œ ì˜¤ë¥˜:', error);
        return {
            success: false,
            message: `ì‹œíŠ¸ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`,
            removedCount: 0
        };
    }
}

/**
 * ì¤‘ë³µ ì œê±° ì§„í–‰ ìƒí™© í‘œì‹œ (v3.4.6 - ê°„ì†Œí™”ë¨)
 * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
 */
function showDuplicateRemovalProgress(message) {
    // ì½˜ì†”ì—ë§Œ ì¶œë ¥í•˜ê³  UIëŠ” ë°©í•´í•˜ì§€ ì•ŠìŒ
    console.log(`[DuplicateRemover] ${message}`);

    // ì¤‘ìš”í•œ ê²½ìš°ì—ë§Œ ì§§ì€ ìŠ¤ë‚µë°” í‘œì‹œ (2ì´ˆ)
    if (message.includes('ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤') || message.includes('ì˜¤ë¥˜')) {
        if (window.showFeedback) {
            window.showFeedback(message, false);
        }
    }
}

/**
 * ì§„í–‰ ìƒí™© ìˆ¨ê¸°ê³  UI ì ê¸ˆ í•´ì œ (v3.4.6 - ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
 */
function hideProgressAndUnlockUI() {
    // v3.4.6: UIë¥¼ ì°¨ë‹¨í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì´ í•¨ìˆ˜ëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
    console.log('[DuplicateRemover v3.4.6] ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬ ì™„ë£Œ');
}

/**
 * ë¡œì»¬ ë°ì´í„°ë¡œ ì¤‘ë³µ ê²€ì‚¬ (ê°„ë‹¨í•œ ë²„ì „)
 * @returns {Object} ê²€ì‚¬ ê²°ê³¼
 */
function removeDuplicatesFromLocalData() {
    return analyzeLocalDataForDuplicates();
}

/**
 * í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰ë˜ëŠ” ì¤‘ë³µ ê²€ì‚¬ (v3.4.6 - ì¡°ìš©í•œ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)
 */
function runDuplicateCheck() {
    try {
        // ë””ë²„ê·¸ ëª¨ë“œê°€ ì•„ë‹ˆë©´ ì¡°ìš©íˆ ì‹œì‘
        if (!window.DEBUG_MODE) {
            console.log('[DuplicateRemover v3.4.6] ì´ˆê¸°í™”');
        } else {
            console.log('[DuplicateRemover] ğŸš€ ì¤‘ë³µ ê²€ì‚¬ ì‹œì‘:', new Date().toLocaleTimeString());
        }

        // window.state í™•ì¸
        if (!window.state) {
            console.warn('[DuplicateRemover] â³ window.state ì—†ìŒ - 3ì´ˆ í›„ ì¬ì‹œë„');
            setTimeout(runDuplicateCheck, 3000);
            return;
        }

        if (!window.state.playerDataByTable) {
            console.warn('[DuplicateRemover] â³ window.state.playerDataByTable ì—†ìŒ - 3ì´ˆ í›„ ì¬ì‹œë„');
            setTimeout(runDuplicateCheck, 3000);
            return;
        }

        logDuplicateRemover('[DuplicateRemover] âœ… window.state ì¤€ë¹„ ì™„ë£Œ');

        // ì¤‘ë³µ ê²€ì‚¬ ì‹¤í–‰ (ë©”ì¸ ì•±ì—ì„œ í˜¸ì¶œëœ ê²½ìš° ëª¨ë‹¬ ì—´ê¸° ìŠ¤í‚µ)
        removeDuplicatePlayers(true).then(result => {
            if (result.success) {
                if (result.removedCount > 0) {
                    logDuplicateRemover(`[DuplicateRemover] âœ… ì¤‘ë³µ ì œê±° ì™„ë£Œ: ${result.removedCount}ëª… ì œê±°`);
                } else {
                    logDuplicateRemover('[DuplicateRemover] âœ… ì¤‘ë³µ ì—†ìŒ - ì‹œíŠ¸ê°€ ê¹¨ë—í•©ë‹ˆë‹¤');
                }
            } else {
                console.error('[DuplicateRemover] âŒ ì¤‘ë³µ ì œê±° ì‹¤íŒ¨:', result.message);
            }
        }).catch(error => {
            console.error('[DuplicateRemover] âŒ ì¤‘ë³µ ì œê±° ì¤‘ ì˜¤ë¥˜:', error);
        });

    } catch (error) {
        console.error('[DuplicateRemover] runDuplicateCheck ì˜¤ë¥˜:', error);
    }
}

/**
 * ëª¨ë“ˆ ì´ˆê¸°í™” (ìë™ ì‹¤í–‰ ë¹„í™œì„±í™”)
 */
function initDuplicateRemover() {
    logDuplicateRemover('[DuplicateRemover] ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ - ë©”ì¸ ì•±ì—ì„œ í˜¸ì¶œ ëŒ€ê¸°');
    // ìë™ ì‹¤í–‰ ì œê±°: ë©”ì¸ ì•±ì˜ initializeAppì—ì„œ í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½
}

// ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
window.removeDuplicatePlayers = removeDuplicatePlayers;
window.removeDuplicatesFromLocalData = removeDuplicatesFromLocalData;
window.runDuplicateCheck = runDuplicateCheck; // ë©”ì¸ ì•±ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ë…¸ì¶œ

// ëª¨ë“ˆ ì´ˆê¸°í™” (ìë™ ì‹¤í–‰ ì œê±°)
initDuplicateRemover();
</file>

<file path="virtual_data_claude/src/js/duplicate-remover.js">
/**
 * ì¤‘ë³µ í”Œë ˆì´ì–´ ìë™ ì œê±° ì‹œìŠ¤í…œ v3.4.15
 * í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ì¤‘ë³µ í”Œë ˆì´ì–´ë¥¼ ê²€ì¶œí•˜ê³  ì‚­ì œí•©ë‹ˆë‹¤.
 * ì¤‘ë³µ ì¡°ê±´: ê°™ì€ í…Œì´ë¸” + ê°™ì€ ì´ë¦„ + ê°™ì€ ì¢Œì„
 *
 * v3.4.15 ë³€ê²½ì‚¬í•­:
 * - ì§ì ‘ í˜¸ì¶œ ë°©ì‹ìœ¼ë¡œ ì´ì¤‘ ì‹¤í–‰ ì™„ì „ ì°¨ë‹¨
 * - runDuplicateCheck í•¨ìˆ˜ ìš°íšŒí•˜ì—¬ removeDuplicatePlayers ì§ì ‘ í˜¸ì¶œ
 * - ë©”ì¸ ì•±ì—ì„œ ì¤‘ë³µ ê²€ì‚¬ ê²°ê³¼ë¥¼ ì§ì ‘ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½
 */

/**
 * ë¡œê·¸ ì¶œë ¥ í—¬í¼ í•¨ìˆ˜
 * @param {string} message - ë¡œê·¸ ë©”ì‹œì§€
 */
function logDuplicateRemover(message) {
    console.log(message);

    // UI ë¡œê·¸ì—ë„ í‘œì‹œ (ìˆëŠ” ê²½ìš°)
    if (window.actionHistory && window.actionHistory.log) {
        window.actionHistory.log('DUPLICATE_REMOVER', message);
    }

    // ë¡œê·¸ ëª¨ë‹¬ì—ë„ í‘œì‹œ (ì „ì—­ í•¨ìˆ˜ ì ‘ê·¼)
    if (window.logMessage && typeof window.logMessage === 'function') {
        window.logMessage(`[ì¤‘ë³µê²€ì‚¬] ${message.replace(/\[DuplicateRemover[^\]]*\]/, '').trim()}`);
    }
}

/**
 * ë©”ì¸ ì¤‘ë³µ ì œê±° í•¨ìˆ˜
 * @param {boolean} skipModalOpen - ëª¨ë‹¬ ì—´ê¸°ë¥¼ ê±´ë„ˆë›¸ì§€ ì—¬ë¶€ (ë©”ì¸ ì•±ì—ì„œ ì´ë¯¸ ì—´ì—ˆì„ ë•Œ)
 * @returns {Promise<Object>} ì œê±° ê²°ê³¼
 */
async function removeDuplicatePlayers(skipModalOpen = false) {
    try {
        // ë¡œê·¸ ëª¨ë‹¬ ì—´ê¸° ë° ì§„í–‰ ìƒí™© í‘œì‹œ (ë©”ì¸ ì•±ì—ì„œ ì´ë¯¸ ì—´ì—ˆìœ¼ë©´ ê±´ë„ˆë›°ê¸°)
        if (!skipModalOpen && window.openLogModal && typeof window.openLogModal === 'function') {
            window.openLogModal();
            if (window.logMessage && typeof window.logMessage === 'function') {
                const logDisplay = document.getElementById('log-display');
                if (logDisplay) {
                    logDisplay.innerHTML = ''; // ê¸°ì¡´ ë¡œê·¸ í´ë¦¬ì–´
                }
            }
        }

        logDuplicateRemover('[DuplicateRemover v3.4.15] ì¤‘ë³µ ê²€ì‚¬ ì‹œì‘');

        // UI ì°¨ë‹¨í•˜ì§€ ì•ŠìŒ - ë°±ê·¸ë¼ìš´ë“œë¡œ ì²˜ë¦¬

        // ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
        if (!window.state || !window.state.playerDataByTable) {
            logDuplicateRemover('[DuplicateRemover] window.state.playerDataByTableì´ ì—†ìŒ');
            return { success: false, message: 'í”Œë ˆì´ì–´ ë°ì´í„° ì—†ìŒ' };
        }

        // APPS_SCRIPT_URL í™•ì¸
        if (typeof APPS_SCRIPT_URL === 'undefined' || !APPS_SCRIPT_URL) {
            logDuplicateRemover('[DuplicateRemover] APPS_SCRIPT_URLì´ ì—†ì–´ì„œ ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ');
            logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë°ì´í„°ë¡œ í´ë°±í•˜ì—¬ ì¤‘ë³µ ê²€ì‚¬ ì¤‘...');
            return await analyzeLocalDataForDuplicates();
        }

        // Google Sheetsì—ì„œ ì›ë³¸ CSV ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì¡°ìš©íˆ)
        logDuplicateRemover('[DuplicateRemover] ì„œë²„ ë°ì´í„° í™•ì¸ ì¤‘...');

        const formData = new FormData();
        formData.append('action', 'loadType'); // Type ì‹œíŠ¸ ì›ë³¸ ë°ì´í„° ìš”ì²­

        const response = await fetch(APPS_SCRIPT_URL, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (!result.success || !result.csvData) {
            logDuplicateRemover('[DuplicateRemover] ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: ' + result.message);
            logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë°ì´í„°ë¡œ í´ë°±í•˜ì—¬ ì¤‘ë³µ ê²€ì‚¬ ì¤‘...');
            return await analyzeLocalDataForDuplicates();
        }

        // ì›ë³¸ CSV ë°ì´í„°ì—ì„œ ì¤‘ë³µ ë¶„ì„
        logDuplicateRemover('[DuplicateRemover] ğŸ“Š ì›ë³¸ ë°ì´í„° ë¶„ì„ ì‹œì‘...');

        return await analyzeRawCsvData(result.csvData);

    } catch (error) {
        logDuplicateRemover('[DuplicateRemover] ì¤‘ë³µ ì œê±° ì¤‘ ì˜¤ë¥˜: ' + error.message);
        return {
            success: false,
            message: `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`,
            removedCount: 0
        };
    } finally {
        // ê²€ì‚¬ ì™„ë£Œ ì•Œë¦¼
        logDuplicateRemover('[DuplicateRemover v3.4.15] âœ… ê²€ì‚¬ ì™„ë£Œ');

        // ëª¨ë‹¬ ìë™ ë‹«ê¸°ëŠ” ë©”ì¸ ì•±ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ë³€ê²½ (ì¤‘ë³µ ë°©ì§€)
        if (!skipModalOpen) {
            setTimeout(() => {
                if (window.closeLogModal && typeof window.closeLogModal === 'function') {
                    window.closeLogModal();
                }
            }, 3000);
        }
    }
}

/**
 * ì›ë³¸ CSV ë°ì´í„°ì—ì„œ ì¤‘ë³µ ë¶„ì„
 * @param {string} csvData - Type ì‹œíŠ¸ì˜ ì›ë³¸ CSV ë°ì´í„°
 * @returns {Object} ì¤‘ë³µ ì œê±° ê²°ê³¼
 */
async function analyzeRawCsvData(csvData) {
    try {
        logDuplicateRemover('[DuplicateRemover] ì›ë³¸ CSV ë°ì´í„° íŒŒì‹± ì‹œì‘...');

        // CSV ë°ì´í„°ë¥¼ ë¼ì¸ë³„ë¡œ ë¶„í• 
        const lines = csvData.split('\n').filter(line => line.trim());
        logDuplicateRemover(`[DuplicateRemover] CSV ë¼ì¸ ìˆ˜: ${lines.length}`);

        const duplicateGroups = new Map(); // key: table|name|seat, value: ë°°ì—´ ì¸ë±ìŠ¤ë“¤
        const allRows = [];

        // í—¤ë” ìŠ¤í‚µí•˜ê³  ë°ì´í„° í–‰ë§Œ ì²˜ë¦¬
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i];
            const columns = line.split(',').map(col => col.trim().replace(/"/g, ''));

            if (columns.length < 8) continue; // ìµœì†Œ 8ê°œ ì»¬ëŸ¼ í•„ìš”

            const player = columns[0] || '';
            const table = columns[1] || '';
            const seat = columns[6] || '';
            const status = (columns[7] || 'IN').toUpperCase();

            // IN ìƒíƒœì¸ í”Œë ˆì´ì–´ë§Œ ì²˜ë¦¬
            if (player && table && status === 'IN') {
                const key = `${table}|${player}|${seat}`;

                if (!duplicateGroups.has(key)) {
                    duplicateGroups.set(key, []);
                }
                duplicateGroups.get(key).push(i);
                allRows.push({ rowIndex: i, player, table, seat, line });

                logDuplicateRemover(`[DuplicateRemover] ì›ë³¸ ë°ì´í„°: ${player} (${table}, ì¢Œì„: ${seat}) - ë¼ì¸ ${i}`);
            }
        }

        // ì¤‘ë³µ ë°œê²¬
        const duplicatesToRemove = [];
        duplicateGroups.forEach((rowIndices, key) => {
            if (rowIndices.length > 1) {
                logDuplicateRemover(`[DuplicateRemover] ğŸ” ì›ë³¸ì—ì„œ ì¤‘ë³µ ë°œê²¬: ${key} - ${rowIndices.length}ê°œ í–‰`);

                // ì²« ë²ˆì§¸ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ì‚­ì œ ëŒ€ìƒ
                for (let i = 1; i < rowIndices.length; i++) {
                    const rowIndex = rowIndices[i];
                    const row = allRows.find(r => r.rowIndex === rowIndex);
                    if (row) {
                        duplicatesToRemove.push({
                            table: row.table,
                            name: row.player,
                            seat: row.seat,
                            rowIndex: row.rowIndex
                        });
                    }
                }
            }
        });

        if (duplicatesToRemove.length === 0) {
            logDuplicateRemover('[DuplicateRemover] ì›ë³¸ CSVì—ì„œ ì¤‘ë³µ ì—†ìŒ');
            showDuplicateRemovalProgress('ì›ë³¸ ë°ì´í„° ê¹¨ë—í•¨ - ì¤‘ë³µ ì—†ìŒ');
            return {
                success: true,
                message: 'ì›ë³¸ CSVì—ì„œ ì¤‘ë³µ ì—†ìŒ',
                removedCount: 0
            };
        }

        logDuplicateRemover(`[DuplicateRemover] ì›ë³¸ì—ì„œ ${duplicatesToRemove.length}ê°œ ì¤‘ë³µ ë°œê²¬`);
        showDuplicateRemovalProgress(`ì›ë³¸ì—ì„œ ${duplicatesToRemove.length}ê°œ ì¤‘ë³µ ë°œê²¬ - êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ ì¤‘...`);

        // ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ
        const removalResults = await removeDuplicatesFromSheets(duplicatesToRemove);
        return removalResults;

    } catch (error) {
        console.error('[DuplicateRemover] ì›ë³¸ CSV ë¶„ì„ ì˜¤ë¥˜:', error);
        return await analyzeLocalDataForDuplicates();
    }
}

/**
 * ë¡œì»¬ ë°ì´í„°ì—ì„œ ì¤‘ë³µ ë¶„ì„ (í´ë°±)
 * @returns {Object} ì¤‘ë³µ ë¶„ì„ ê²°ê³¼
 */
async function analyzeLocalDataForDuplicates() {
    try {
        logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë°ì´í„°ë¡œ í´ë°±í•˜ì—¬ ì¤‘ë³µ ê²€ì‚¬ ì¤‘...');
        logDuplicateRemover('[DuplicateRemover] ğŸ“Š ë¡œì»¬ ë°ì´í„° ë¶„ì„ ì‹œì‘...');

        const playerDataByTable = window.state.playerDataByTable;
        const tableNames = Object.keys(playerDataByTable);

        // ì „ì²´ í”Œë ˆì´ì–´ ìˆ˜ ê³„ì‚°
        let totalPlayers = 0;
        tableNames.forEach(table => {
            const playerCount = playerDataByTable[table].length;
            totalPlayers += playerCount;
            logDuplicateRemover(`[DuplicateRemover]   ${table}: ${playerCount}ëª…`);
        });

        logDuplicateRemover(`[DuplicateRemover] ë¡œì»¬ ë°ì´í„° ${totalPlayers}ëª… ë¶„ì„ ì¤‘...`);

        const seen = new Map(); // key: "table|name|seat", value: ì²« ë²ˆì§¸ í”Œë ˆì´ì–´
        const duplicatePlayers = [];

        // ëª¨ë“  í…Œì´ë¸”ì˜ í”Œë ˆì´ì–´ë¥¼ ê²€ì‚¬
        tableNames.forEach(table => {
            playerDataByTable[table].forEach(player => {
                const key = `${table}|${player.name}|${player.seat || ''}`;
                logDuplicateRemover(`[DuplicateRemover] ğŸ” ë¡œì»¬ ê²€ì‚¬: key="${key}"`);

                if (seen.has(key)) {
                    // ì¤‘ë³µ ë°œê²¬
                    duplicatePlayers.push({
                        table: table,
                        name: player.name,
                        seat: player.seat,
                        player: player
                    });
                    logDuplicateRemover(`[DuplicateRemover] âŒ ë¡œì»¬ ì¤‘ë³µ ë°œê²¬: ${table} - ${player.name}`);
                } else {
                    // ì²« ë²ˆì§¸ ë°œê²¬
                    seen.set(key, player);
                }
            });
        });

        if (duplicatePlayers.length === 0) {
            logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ì—ì„œ ì¤‘ë³µ ì—†ìŒ');
            return {
                success: true,
                message: 'ë¡œì»¬ ë°ì´í„°ì—ì„œ ì¤‘ë³µ ì—†ìŒ',
                removedCount: 0
            };
        }

        logDuplicateRemover(`[DuplicateRemover] ë¡œì»¬ì—ì„œ ${duplicatePlayers.length}ê°œ ì¤‘ë³µ ë°œê²¬`);
        showDuplicateRemovalProgress(`${duplicatePlayers.length}ê°œ ì¤‘ë³µ ë°œê²¬ë¨ - êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ ì¤‘...`);

        // ë¡œì»¬ì—ì„œ ë°œê²¬ëœ ì¤‘ë³µë„ ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‚­ì œ ì²˜ë¦¬
        const removalResults = await removeDuplicatesFromSheets(duplicatePlayers);

        // ì™„ë£Œ ë©”ì‹œì§€
        if (removalResults.success) {
            logDuplicateRemover(`[DuplicateRemover] âœ… ë¡œì»¬ ë°ì´í„° ë¶„ì„ ì™„ë£Œ - ${removalResults.removedCount}ëª… ì œê±°`);
        }

        return removalResults;

    } catch (error) {
        logDuplicateRemover('[DuplicateRemover] ë¡œì»¬ ë¶„ì„ ì˜¤ë¥˜: ' + error.message);
        return {
            success: false,
            message: `ë¡œì»¬ ë¶„ì„ ì˜¤ë¥˜: ${error.message}`,
            removedCount: 0
        };
    }
}

/**
 * êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‹¤ì œ ì¤‘ë³µ ì œê±°
 * @param {Array} duplicatesToRemove - ì‚­ì œí•  ì¤‘ë³µ í”Œë ˆì´ì–´ ë°°ì—´
 * @returns {Object} ì‚­ì œ ê²°ê³¼
 */
async function removeDuplicatesFromSheets(duplicatesToRemove) {
    try {
        if (duplicatesToRemove.length === 0) {
            return { success: true, message: 'ì‚­ì œí•  ì¤‘ë³µ ì—†ìŒ', removedCount: 0 };
        }

        // í…Œì´ë¸”ë³„ë¡œ ê·¸ë£¹í™”
        const byTable = new Map();
        duplicatesToRemove.forEach(duplicate => {
            const tableName = duplicate.table;
            if (!byTable.has(tableName)) {
                byTable.set(tableName, []);
            }
            byTable.get(tableName).push(duplicate);
        });

        let totalRemoved = 0;
        const removedPlayers = [];

        // ê° í…Œì´ë¸”ì—ì„œ ì¤‘ë³µ ì œê±°
        for (const [tableName, playersToRemove] of byTable) {
            try {
                logDuplicateRemover(`[DuplicateRemover] ğŸ—‘ï¸ ${tableName} í…Œì´ë¸”ì—ì„œ ${playersToRemove.length}ëª… ì¤‘ë³µ ì œê±° ì¤‘...`);

                // ì‚­ì œí•  í”Œë ˆì´ì–´ ì´ë¦„ ëª©ë¡ ì¶”ì¶œ
                const playerNamesToDelete = playersToRemove.map(p => p.name);

                // batchUpdate í˜¸ì¶œ
                const formData = new FormData();
                formData.append('action', 'batchUpdate');
                formData.append('table', tableName);
                formData.append('players', JSON.stringify([])); // ë¹ˆ ë°°ì—´ (ì¶”ê°€í•  í”Œë ˆì´ì–´ ì—†ìŒ)
                formData.append('deleted', JSON.stringify(playerNamesToDelete)); // ì‚­ì œí•  í”Œë ˆì´ì–´

                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    totalRemoved += playersToRemove.length;
                    removedPlayers.push(...playersToRemove);
                    logDuplicateRemover(`[DuplicateRemover] âœ… ${tableName}ì—ì„œ ${playersToRemove.length}ëª… ì‚­ì œ ì™„ë£Œ`);
                } else {
                    console.error(`[DuplicateRemover] âŒ ${tableName} ì‚­ì œ ì‹¤íŒ¨:`, result.message);
                }

            } catch (error) {
                console.error(`[DuplicateRemover] ${tableName} ì‚­ì œ ì¤‘ ì˜¤ë¥˜:`, error);
            }
        }

        const message = `${totalRemoved}ëª…ì˜ ì¤‘ë³µ í”Œë ˆì´ì–´ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤`;
        logDuplicateRemover(`[DuplicateRemover] ${message}`);
        showDuplicateRemovalProgress(message);

        return {
            success: true,
            message: message,
            removedCount: totalRemoved,
            removedPlayers: removedPlayers
        };

    } catch (error) {
        console.error('[DuplicateRemover] ì‹œíŠ¸ ì‚­ì œ ì˜¤ë¥˜:', error);
        return {
            success: false,
            message: `ì‹œíŠ¸ ì‚­ì œ ì˜¤ë¥˜: ${error.message}`,
            removedCount: 0
        };
    }
}

/**
 * ì¤‘ë³µ ì œê±° ì§„í–‰ ìƒí™© í‘œì‹œ (v3.4.6 - ê°„ì†Œí™”ë¨)
 * @param {string} message - í‘œì‹œí•  ë©”ì‹œì§€
 */
function showDuplicateRemovalProgress(message) {
    // ì½˜ì†”ì—ë§Œ ì¶œë ¥í•˜ê³  UIëŠ” ë°©í•´í•˜ì§€ ì•ŠìŒ
    console.log(`[DuplicateRemover] ${message}`);

    // ì¤‘ìš”í•œ ê²½ìš°ì—ë§Œ ì§§ì€ ìŠ¤ë‚µë°” í‘œì‹œ (2ì´ˆ)
    if (message.includes('ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤') || message.includes('ì˜¤ë¥˜')) {
        if (window.showFeedback) {
            window.showFeedback(message, false);
        }
    }
}

/**
 * ì§„í–‰ ìƒí™© ìˆ¨ê¸°ê³  UI ì ê¸ˆ í•´ì œ (v3.4.6 - ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
 */
function hideProgressAndUnlockUI() {
    // v3.4.6: UIë¥¼ ì°¨ë‹¨í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì´ í•¨ìˆ˜ëŠ” ì‚¬ìš©ë˜ì§€ ì•ŠìŒ
    console.log('[DuplicateRemover v3.4.6] ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬ ì™„ë£Œ');
}

/**
 * ë¡œì»¬ ë°ì´í„°ë¡œ ì¤‘ë³µ ê²€ì‚¬ (ê°„ë‹¨í•œ ë²„ì „)
 * @returns {Object} ê²€ì‚¬ ê²°ê³¼
 */
function removeDuplicatesFromLocalData() {
    return analyzeLocalDataForDuplicates();
}

/**
 * í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰ë˜ëŠ” ì¤‘ë³µ ê²€ì‚¬ (v3.4.6 - ì¡°ìš©í•œ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰)
 */
function runDuplicateCheck() {
    try {
        // ë””ë²„ê·¸ ëª¨ë“œê°€ ì•„ë‹ˆë©´ ì¡°ìš©íˆ ì‹œì‘
        if (!window.DEBUG_MODE) {
            console.log('[DuplicateRemover v3.4.6] ì´ˆê¸°í™”');
        } else {
            console.log('[DuplicateRemover] ğŸš€ ì¤‘ë³µ ê²€ì‚¬ ì‹œì‘:', new Date().toLocaleTimeString());
        }

        // window.state í™•ì¸
        if (!window.state) {
            console.warn('[DuplicateRemover] â³ window.state ì—†ìŒ - 3ì´ˆ í›„ ì¬ì‹œë„');
            setTimeout(runDuplicateCheck, 3000);
            return;
        }

        if (!window.state.playerDataByTable) {
            console.warn('[DuplicateRemover] â³ window.state.playerDataByTable ì—†ìŒ - 3ì´ˆ í›„ ì¬ì‹œë„');
            setTimeout(runDuplicateCheck, 3000);
            return;
        }

        logDuplicateRemover('[DuplicateRemover] âœ… window.state ì¤€ë¹„ ì™„ë£Œ');

        // ì¤‘ë³µ ê²€ì‚¬ ì‹¤í–‰ (ë©”ì¸ ì•±ì—ì„œ í˜¸ì¶œëœ ê²½ìš° ëª¨ë‹¬ ì—´ê¸° ìŠ¤í‚µ)
        removeDuplicatePlayers(true).then(result => {
            if (result.success) {
                if (result.removedCount > 0) {
                    logDuplicateRemover(`[DuplicateRemover] âœ… ì¤‘ë³µ ì œê±° ì™„ë£Œ: ${result.removedCount}ëª… ì œê±°`);
                } else {
                    logDuplicateRemover('[DuplicateRemover] âœ… ì¤‘ë³µ ì—†ìŒ - ì‹œíŠ¸ê°€ ê¹¨ë—í•©ë‹ˆë‹¤');
                }
            } else {
                console.error('[DuplicateRemover] âŒ ì¤‘ë³µ ì œê±° ì‹¤íŒ¨:', result.message);
            }
        }).catch(error => {
            console.error('[DuplicateRemover] âŒ ì¤‘ë³µ ì œê±° ì¤‘ ì˜¤ë¥˜:', error);
        });

    } catch (error) {
        console.error('[DuplicateRemover] runDuplicateCheck ì˜¤ë¥˜:', error);
    }
}

/**
 * ëª¨ë“ˆ ì´ˆê¸°í™” (ìë™ ì‹¤í–‰ ë¹„í™œì„±í™”)
 */
function initDuplicateRemover() {
    logDuplicateRemover('[DuplicateRemover] ëª¨ë“ˆ ë¡œë“œ ì™„ë£Œ - ë©”ì¸ ì•±ì—ì„œ í˜¸ì¶œ ëŒ€ê¸°');
    // ìë™ ì‹¤í–‰ ì œê±°: ë©”ì¸ ì•±ì˜ initializeAppì—ì„œ í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½
}

// ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
window.removeDuplicatePlayers = removeDuplicatePlayers;
window.removeDuplicatesFromLocalData = removeDuplicatesFromLocalData;
window.runDuplicateCheck = runDuplicateCheck; // ë©”ì¸ ì•±ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ ë…¸ì¶œ

// ëª¨ë“ˆ ì´ˆê¸°í™” (ìë™ ì‹¤í–‰ ì œê±°)
initDuplicateRemover();
</file>

<file path="docs/CHECKLIST.md">
# ğŸ° Virtual Data - Poker Hand Logger ì²´í¬ë¦¬ìŠ¤íŠ¸

> **ë²„ì „**: v3.5.28 (Apps Script v71.0.4)
> **ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-09-23
> **ëª©ì **: í¬ì»¤ í•¸ë“œ ë¡œê±° ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

---

## ğŸš¨ **ì‹¤íŒ¨ ì´ë ¥ ìš”ì•½ (ë°˜ë“œì‹œ ìœ ì§€)**

### **í˜„ì¬ ìƒíƒœ: 6ì°¨ ì‹œë„**

| ì°¨ìˆ˜ | ì‹¤íŒ¨ ì›ì¸ | ì‹œë„í•œ í•´ê²°ì±… | ê²°ê³¼ |
|------|----------|--------------|------|
| **1ì°¨** | Config ì‹œíŠ¸ ì ‘ê·¼ ì‹œ CORS ì°¨ë‹¨<br>`APPS_SCRIPT_URL` null ì´ˆê¸°í™” | ê¸°ë³¸ URL í•˜ë“œì½”ë”© | âŒ ì‹¤í–‰ ë¶ˆê°€ëŠ¥í•œ URL |
| **2ì°¨** | `APPS_SCRIPT_URL` undefined ì°¸ì¡° ì˜¤ë¥˜ | localStorage ìš°ì„ , ê¸°ë³¸ URL ì„¤ì • | âŒ ë³€ìˆ˜ ìŠ¤ì½”í”„ ë¬¸ì œ |
| **3ì°¨** | DOMContentLoaded ë‚´ë¶€ì— ë³€ìˆ˜ ì„ ì–¸<br>Line 1384 ì´ˆê¸°í™” ì „ ì°¸ì¡° | ì „ì—­ ë³€ìˆ˜ë¡œ ì´ë™ | âŒ DEFAULT_APPS_SCRIPT_URL ë¯¸ì •ì˜ |
| **4ì°¨** | DEFAULT_APPS_SCRIPT_URL ë¯¸ì •ì˜<br>Line 5891 ì°¸ì¡° ì˜¤ë¥˜ | ì°¸ì¡° ì œê±°, URL ì¡´ì¬ ì—¬ë¶€ë¡œ íŒë‹¨ | âŒ ìºì‹œ ë¯¸ê°±ì‹  |
| **5ì°¨** | ë¸Œë¼ìš°ì € ìºì‹œ ë¬¸ì œ<br>CAM ë¡œì§ ì”ì¬<br>addEventListener ì˜¤ë¥˜ | 1. ë²„ì „ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° (v3.5.25)<br>2. CAM ë¶€ë¶„ ì œê±° (v3.5.26)<br>3. CAM ì™„ì „ ì œê±° (v3.5.27) | âœ… í•´ê²° |
| **6ì°¨** | ì‹œíŠ¸ ì „ì†¡ ì‹¤íŒ¨<br>performance-optimizer ì˜¤ë¥˜ | 1. APPS_SCRIPT_URL ê¸°ë³¸ê°’ ì„¤ì •<br>2. null ì²´í¬ ì¶”ê°€ (v3.5.28) | âœ… í•´ê²° |

---

## ğŸ”„ **6ì°¨ ì‹œë„ - ì¶”ê°€ ë¬¸ì œ í•´ê²°**

### **6ì°¨ ë¬¸ì œ ë° í•´ê²° (v3.5.28)**

#### **ë°œê²¬ëœ ë¬¸ì œ:**
1. **ì‹œíŠ¸ ì „ì†¡ ì‹¤íŒ¨**
   - "âš ï¸ ì‹œíŠ¸ ì „ì†¡ í™•ì¸ í•„ìš”" ë©”ì‹œì§€
   - APPS_SCRIPT_URLì´ nullë¡œ ì´ˆê¸°í™”ë˜ì–´ ì „ì†¡ ë¶ˆê°€

2. **performance-optimizer.js ì˜¤ë¥˜**
   - `Cannot read properties of null (reading 'contains')`
   - document.bodyê°€ nullì¼ ë•Œ cleanupDetachedNodes ì‹¤íŒ¨

#### **í•´ê²° ë‚´ìš© (v3.5.28):**
1. **APPS_SCRIPT_URL ê¸°ë³¸ê°’ ì„¤ì •**
   - localStorageì— URLì´ ì—†ì„ ë•Œ ê¸°ë³¸ URL ì‚¬ìš©
   - ì‚¬ìš©ìê°€ ìì‹ ì˜ URLë¡œ ë³€ê²½í•˜ë„ë¡ ì•ˆë‚´

2. **performance-optimizer.js null ì²´í¬ ì¶”ê°€**
   - document.body ì¡´ì¬ ì—¬ë¶€ í™•ì¸
   - nullì¼ ê²½ìš° cleanupDetachedNodes ì¢…ë£Œ

### **í•´ê²°ëœ ë¬¸ì œë“¤ (v3.5.27)**

#### **ìƒˆë¡œìš´ ë¬¸ì œ ë°œê²¬:**
1. **ì—…ë°ì´íŠ¸ê°€ ë°˜ì˜ë˜ì§€ ì•ŠëŠ” ë¬¸ì œ**
   - ë¸Œë¼ìš°ì €ê°€ v3.5.24ë¥¼ í‘œì‹œí•˜ì§€ë§Œ ì‹¤ì œ ë™ì‘ì€ ì´ì „ ë²„ì „
   - ìºì‹œ ë¬¸ì œë¡œ ì¶”ì •
   - **í•´ê²° í•„ìš”**: ê°•ì œ ìƒˆë¡œê³ ì¹¨ (Ctrl+Shift+R) ë˜ëŠ” ìºì‹œ ì‚­ì œ

2. **ë°ì´í„°ëŠ” ì •ìƒ ì²˜ë¦¬ë˜ë‚˜ ì„œë²„ í†µì‹  ë¶ˆê°€**
   - PLAYER í–‰ ìƒì„± ë¡œì§ì€ ì •ìƒ ì‘ë™
   - í•˜ì§€ë§Œ Apps Scriptì™€ í†µì‹  ì‹¤íŒ¨ ì§€ì†
   - **ê·¼ë³¸ ì›ì¸**: Apps Scriptê°€ ì‹¤ì œë¡œ ë°°í¬ë˜ì§€ ì•ŠìŒ

#### **í•´ê²° ë‚´ìš©:**
1. **ìºì‹œ ë²„ìŠ¤íŒ… (v3.5.25)**
   - ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ì— ë²„ì „ íŒŒë¼ë¯¸í„° ì¶”ê°€

2. **CAM ë¶€ë¶„ ì œê±° (v3.5.26)**
   - state ë³€ìˆ˜ ì œê±°, Index ë©”íƒ€ë°ì´í„° CAM í•„ë“œ ê¸°ë³¸ê°’ ì„¤ì •

3. **CAM ì™„ì „ ì œê±° (v3.5.27)**
   - ëª¨ë“  CAM ê´€ë ¨ ì½”ë“œ ì£¼ì„ ì²˜ë¦¬
   - el.cam1/cam2 addEventListener ì˜¤ë¥˜ í•´ê²°
   - computeCamPrefill, getCamNumber ë”ë¯¸ í•¨ìˆ˜ë¡œ ëŒ€ì²´
   - ì¹´ë©”ë¼ UI ìš”ì†Œ ì™„ì „ ì œê±°
   - ìƒˆ í•¸ë“œ ì‹œì‘ ì‹œ CAM ë²ˆí˜¸ ìë™ ì¦ê°€ ë¡œì§ ì œê±°
   - loadIndexRowì—ì„œ CAM ì •ë³´ ë¡œë“œ ë¡œì§ ì œê±°

#### **ì‚¬ìš©ì ì•ˆë‚´:**
```bash
# ë¸Œë¼ìš°ì € ìºì‹œ ê°•ì œ ê°±ì‹  ë°©ë²•
1. Ctrl+Shift+R (Windows/Linux) ë˜ëŠ” Cmd+Shift+R (Mac)
2. ê°œë°œì ë„êµ¬ â†’ Network â†’ Disable cache ì²´í¬
3. ê°œë°œì ë„êµ¬ â†’ Application â†’ Storage â†’ Clear site data
```

#### **2. Apps Script ë°°í¬ í™•ì¸**
```
í•„ìˆ˜ í™•ì¸ ì‚¬í•­:
- [ ] Google Apps Script ì—ë””í„°ì—ì„œ Code.gs ë°°í¬
- [ ] ì›¹ ì•±ìœ¼ë¡œ ë°°í¬ ì„ íƒ
- [ ] ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì"
- [ ] ë°°í¬ URLì„ ì•±ì— ì…ë ¥
```

---

### **ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [x] CORS ì°¨ë‹¨ ë¬¸ì œ í•´ê²° (ContentService.JSON ì‚¬ìš©)
- [x] ë°ì´í„° êµ¬ì¡° ë¶ˆì¼ì¹˜ ìˆ˜ì • (notableâ†’keyplayer, tableâ†’tableNo)
- [x] Config ì‹œíŠ¸ A1 Apps Script URL ì°¸ì¡° ê¸°ëŠ¥
- [x] Gemini API í‚¤ ì œê±°
- [x] APPS_SCRIPT_URL ë³€ìˆ˜ ì´ˆê¸°í™” ë¬¸ì œ í•´ê²°
- [x] ë¸Œë¼ìš°ì € ìºì‹œ ë²„ìŠ¤íŒ… êµ¬í˜„
- [x] CAM ê´€ë ¨ ëª¨ë“  ì½”ë“œ ì œê±°
- [x] addEventListener ì˜¤ë¥˜ í•´ê²°
- [x] ë²„ì „ v3.5.27 ë°°í¬ ì™„ë£Œ

### **ì´ì „ ì‹¤íŒ¨ ì›ì¸ë“¤ (4ì°¨ê¹Œì§€ ëˆ„ì )**

#### **ìƒˆë¡œìš´ ì˜¤ë¥˜ ë°œê²¬:**

1. **Line 19: DEFAULT_APPS_SCRIPT_URL ë¯¸ì •ì˜ ì˜¤ë¥˜**
```javascript
Uncaught ReferenceError: DEFAULT_APPS_SCRIPT_URL is not defined
at HTMLButtonElement.<anonymous> ((index):5891:51)
```
- ì›ì¸: DEFAULT_APPS_SCRIPT_URL ë³€ìˆ˜ë¥¼ ì œê±°í–ˆì§€ë§Œ Line 5891ì—ì„œ ì—¬ì „íˆ ì°¸ì¡°
- ì˜í–¥: URL ì„¤ì • ëª¨ë‹¬ ì—´ ë•Œ ì˜¤ë¥˜ ë°œìƒ

2. **Line 8-9: CORS ì˜¤ë¥˜ ì§€ì†**
```
Access to fetch at 'https://script.google.com/.../exec'
from origin 'http://localhost:8000' has been blocked by CORS policy
```
- ì›ì¸: Apps Scriptê°€ ì‹¤ì œë¡œ ë°°í¬ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ê¶Œí•œ ì„¤ì • ë¬¸ì œ
- ì˜í–¥: ì„œë²„ì™€ í†µì‹  ë¶ˆê°€

3. **Line 26: GitHub API ì¸ì¦ ì˜¤ë¥˜**
```
POST https://api.github.com/gists 401 (Unauthorized)
```
- ì›ì¸: GitHub í† í° ì—†ìŒ ë˜ëŠ” ë§Œë£Œ
- ì˜í–¥: í´ë¼ìš°ë“œ ë™ê¸°í™” ì‹¤íŒ¨ (ë¶€ê°€ ê¸°ëŠ¥)

### **4ì°¨ í•´ê²° ë°©ì•ˆ**

#### **1. DEFAULT_APPS_SCRIPT_URL ì°¸ì¡° ì œê±° âœ…**
```javascript
// Line 5891 ìˆ˜ì •
// ì´ì „: const isCustomUrl = APPS_SCRIPT_URL !== DEFAULT_APPS_SCRIPT_URL;
// ìˆ˜ì •: APPS_SCRIPT_URL ì¡´ì¬ ì—¬ë¶€ë¡œë§Œ íŒë‹¨
currentUrlSpan.className = APPS_SCRIPT_URL ?
  'text-xs text-green-400 break-all font-mono' :
  'text-xs text-amber-400 break-all font-mono';
```

**ìƒíƒœ:**
- [x] DEFAULT_APPS_SCRIPT_URL ì°¸ì¡° ì™„ì „ ì œê±°
- [x] URL ì¡´ì¬ ì—¬ë¶€ë¡œë§Œ ìŠ¤íƒ€ì¼ ê²°ì •

#### **2. CORS ì˜¤ë¥˜ í•´ê²° ë°©ì•ˆ**
```
ì‹¤ì œ ì›ì¸:
1. Apps Script URLì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜
2. Apps Scriptê°€ ë°°í¬ë˜ì§€ ì•Šì•˜ê±°ë‚˜
3. ë°°í¬ ì„¤ì •ì´ "ëª¨ë“  ì‚¬ìš©ì" ê¶Œí•œì´ ì•„ë‹˜

í•´ê²°ì±…:
- ì‚¬ìš©ìê°€ ì˜¬ë°”ë¥¸ Apps Script URL ì…ë ¥í•˜ë„ë¡ ì•ˆë‚´
- CORS ì˜¤ë¥˜ ë°œìƒí•´ë„ ì•±ì€ ê³„ì† ì‘ë™
- ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ì ì¹œí™”ì ìœ¼ë¡œ ë³€ê²½
```

**ìƒíƒœ:**
- [ ] ì‚¬ìš©ìì—ê²Œ URL ì„¤ì • ì•ˆë‚´ ê°•í™”
- [ ] CORS ì˜¤ë¥˜ ë©”ì‹œì§€ ê°œì„ 
- [ ] ì˜¤í”„ë¼ì¸ ëª¨ë“œ ì§€ì› ì¶”ê°€

#### **3. ì´ì „ ë¬¸ì œ í•´ê²° ë‚´ì—­**
```javascript
// ì´ì „ (ë¬¸ì œ): DOMContentLoaded ë‚´ë¶€ì— ë³€ìˆ˜ ì„ ì–¸
document.addEventListener('DOMContentLoaded', () => {
  let APPS_SCRIPT_URL = null; // âŒ ì—¬ê¸°ì„œ ì„ ì–¸
  if (APPS_SCRIPT_URL) {...} // âŒ ì´ˆê¸°í™” ì „ ì°¸ì¡°
});

// ìˆ˜ì •: ì „ì—­ ìŠ¤ì½”í”„ë¡œ ì´ë™
let APPS_SCRIPT_URL = null; // âœ… ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
initializeAppsScriptUrl(); // âœ… ì¦‰ì‹œ ì´ˆê¸°í™”

document.addEventListener('DOMContentLoaded', () => {
  if (APPS_SCRIPT_URL) {...} // âœ… ì´ë¯¸ ì´ˆê¸°í™”ëœ ë³€ìˆ˜ ì°¸ì¡°
});
```

**ìƒíƒœ:**
- [x] ë³€ìˆ˜ ìŠ¤ì½”í”„ ë¬¸ì œ í•´ê²°
- [x] ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸í•˜ì—¬ ëª¨ë“  í•¨ìˆ˜ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
- [x] DOMContentLoaded ì „ì— ì´ˆê¸°í™” ì™„ë£Œ

#### **2. CORS ì˜¤ë¥˜ ìš°íšŒ ì „ëµ âœ…**
```javascript
// Config ì‹œíŠ¸ ë¡œë“œë¥¼ ì„ íƒì‚¬í•­ìœ¼ë¡œ ë³€ê²½
try {
  // Config ì‹œíŠ¸ ì‹œë„ (ì‹¤íŒ¨í•´ë„ ë¬´ë°©)
} catch {
  // ê¸°ë³¸ URL ì‚¬ìš© (CORS ì—ëŸ¬ ë¬´ì‹œ)
}
```

**ìƒíƒœ:**
- [x] CORS ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ì•±ì´ ì •ìƒ ì‘ë™
- [x] Config ì‹œíŠ¸ëŠ” ë¶€ê°€ ê¸°ëŠ¥ìœ¼ë¡œ ì²˜ë¦¬
- [x] ì—ëŸ¬ ë¡œê·¸ ìµœì†Œí™”

#### **3. Performance Optimizer ì˜¤ë¥˜ (ìˆ˜ì • ì™„ë£Œ) âœ…**
```javascript
// performance-optimizer.js Line 234-242
if (node && node.parentNode && !document.body.contains(node)) {
  // null ì²´í¬ ë° try-catch ë³´í˜¸
}
```

**ìƒíƒœ:**
- [x] null ì°¸ì¡° ì˜¤ë¥˜ í•´ê²°
- [x] try-catchë¡œ ì•ˆì „ì„± ê°•í™”

---

## ğŸš¨ğŸš¨ğŸš¨ **ì´ì „ CORS ë¬¸ì œ í•´ê²° ì™„ë£Œ (v71.0.3)**

### **ì™„ë²½í•œ ë¬¸ì œ ë¶„ì„ ê²°ê³¼**

#### **1. ê·¼ë³¸ ì›ì¸: í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ í†µì‹  ë°©ì‹ ë¶ˆì¼ì¹˜**
```
ğŸ”´ ë¬¸ì œì˜ í•µì‹¬:
- Apps Script (v71.0.1): HTML Service + postMessage ë°©ì‹ìœ¼ë¡œ ì‘ë‹µ
- index.html (v3.5.18): ì¼ë°˜ JSON ì‘ë‹µ ê¸°ëŒ€í•˜ë©° fetch ì‚¬ìš©
- ê²°ê³¼: HTML ì‘ë‹µì„ JSONìœ¼ë¡œ íŒŒì‹±í•˜ë ¤ë‹¤ ì‹¤íŒ¨
```

#### **2. ìƒì„¸ ë¶„ì„**
| êµ¬ë¶„ | Apps Script (ì„œë²„) | index.html (í´ë¼ì´ì–¸íŠ¸) | ë¬¸ì œì  |
|------|-------------------|------------------------|--------|
| **ì‘ë‹µ ë°©ì‹** | HtmlService.createHtmlOutput() | response.json() ê¸°ëŒ€ | âŒ HTMLì„ JSONìœ¼ë¡œ íŒŒì‹± ë¶ˆê°€ |
| **CORS í•´ê²°** | postMessage ì‚¬ìš© | ì¼ë°˜ fetch ì‚¬ìš© | âŒ postMessage ë¦¬ìŠ¤ë„ˆ ì—†ìŒ |
| **URL** | /exec (ë°°í¬ URL) | fetchë¡œ ì§ì ‘ í˜¸ì¶œ | âš ï¸ CORS ì •ì±… ì ìš© |
| **ë°ì´í„° í˜•ì‹** | HTML í˜ì´ì§€ ë‚´ JSON | ìˆœìˆ˜ JSON ê¸°ëŒ€ | âŒ í˜•ì‹ ë¶ˆì¼ì¹˜ |

#### **3. Apps Script ì½”ë“œ ë¶„ì„ (Code.gs)**
```javascript
// ë¼ì¸ 359-393: createCorsResponse í•¨ìˆ˜
function createCorsResponse(data) {
  const html = `<!DOCTYPE html>...
    window.parent.postMessage({
      type: 'APPS_SCRIPT_RESPONSE',
      data: data
    }, '*');...`;

  return HtmlService.createHtmlOutput(html)
    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
}
// âš ï¸ HTML ì‘ë‹µì„ ë°˜í™˜ (JSONì´ ì•„ë‹˜!)
```

#### **4. index.html ì½”ë“œ ë¶„ì„**
```javascript
// ë¼ì¸ 6393-6409: fetch ìš”ì²­
const response = await fetch(APPS_SCRIPT_URL, {
  method: 'POST',
  headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
  body: urlParams.toString()
});
const result = await response.json();  // âŒ HTMLì„ JSONìœ¼ë¡œ íŒŒì‹± ì‹œë„
```

### **ì™„ë²½í•œ í•´ê²°ì±… (2ê°€ì§€ ë°©ë²•)**

#### **í•´ê²°ì±… A: Apps Scriptë¥¼ ìˆœìˆ˜ JSON ì‘ë‹µìœ¼ë¡œ ë³€ê²½** â­â­â­ ìµœê³  ê¶Œì¥
```javascript
// Code.gs ìˆ˜ì • - createCorsResponse í•¨ìˆ˜ë¥¼ JSON ì‘ë‹µìœ¼ë¡œ ë³€ê²½
function createCorsResponse(data) {
  return ContentService
    .createTextOutput(JSON.stringify(data))
    .setMimeType(ContentService.MimeType.JSON);
}

// doPost í•¨ìˆ˜ë„ ìˆ˜ì •
function doPost(e) {
  // ... ê¸°ì¡´ ë¡œì§ ...
  const result = processAction(data);

  // JSON ì‘ë‹µ ë°˜í™˜
  return ContentService
    .createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}
```
**ì¥ì **:
- âœ… í´ë¼ì´ì–¸íŠ¸ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”
- âœ… í‘œì¤€ REST API ë°©ì‹
- âœ… CORS ë¬¸ì œ ìë™ í•´ê²°

#### **í•´ê²°ì±… B: index.htmlì— iframe + postMessage êµ¬í˜„** â­â­
```javascript
// index.htmlì— ì¶”ê°€ - ë¼ì¸ 6393 ëŒ€ì²´
async function callAppsScriptWithIframe(params) {
  return new Promise((resolve, reject) => {
    // postMessage ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    const messageHandler = (event) => {
      if (event.data.type === 'APPS_SCRIPT_RESPONSE') {
        window.removeEventListener('message', messageHandler);
        document.body.removeChild(iframe);
        resolve(event.data.data);
      }
    };
    window.addEventListener('message', messageHandler);

    // ìˆ¨ê²¨ì§„ iframe ìƒì„±
    const iframe = document.createElement('iframe');
    iframe.style.display = 'none';

    // URL íŒŒë¼ë¯¸í„° êµ¬ì„±
    const url = new URL(APPS_SCRIPT_URL);
    Object.keys(params).forEach(key => {
      url.searchParams.append(key,
        typeof params[key] === 'object' ?
        JSON.stringify(params[key]) : params[key]
      );
    });

    iframe.src = url.toString();
    document.body.appendChild(iframe);

    // íƒ€ì„ì•„ì›ƒ ì„¤ì •
    setTimeout(() => {
      window.removeEventListener('message', messageHandler);
      document.body.removeChild(iframe);
      reject(new Error('ìš”ì²­ ì‹œê°„ ì´ˆê³¼'));
    }, 30000);
  });
}

// ì‚¬ìš© ì˜ˆì‹œ - ë¼ì¸ 6376-6399 ëŒ€ì²´
const result = await callAppsScriptWithIframe({
  action: 'batchUpdate',
  table: window.managementState.selectedTable,
  players: playersToSend,
  deleted: deleted
});
```

### **ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸**

#### **ğŸ“‹ í•´ê²°ì±… A ì‹¤í–‰ (Apps Script JSON ì‘ë‹µ) - âœ… ì™„ë£Œ**
- [x] **1. Code.gs ë°±ì—…**
  ```bash
  # í˜„ì¬ Code.gsë¥¼ Code-backup.gsë¡œ ì €ì¥
  ```
- [x] **2. createCorsResponse í•¨ìˆ˜ ìˆ˜ì •**
  ```javascript
  function createCorsResponse(data) {
    return ContentService
      .createTextOutput(JSON.stringify(data))
      .setMimeType(ContentService.MimeType.JSON);
  }
  ```
- [x] **3. doPost í•¨ìˆ˜ ìˆ˜ì •**
  - createCorsResponseê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë¯€ë¡œ ìë™ ì ìš©
- [x] **4. doGet í•¨ìˆ˜ ìˆ˜ì •**
  - createCorsResponseê°€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì´ë¯€ë¡œ ìë™ ì ìš©
- [x] **5. ë²„ì „ ì—…ë°ì´íŠ¸**
  - v71.0.2ë¡œ ì—…ë°ì´íŠ¸ ì™„ë£Œ
  - features ë°°ì—´ ì—…ë°ì´íŠ¸ ì™„ë£Œ
- [ ] **6. Apps Script ì¬ë°°í¬**
  - ë°°í¬ > ë°°í¬ ê´€ë¦¬ > í¸ì§‘
  - ë²„ì „: ìƒˆ ë²„ì „
  - ì„¤ëª…: "v71.0.2 - JSON ì‘ë‹µìœ¼ë¡œ ë³€ê²½"
- [ ] **7. í…ŒìŠ¤íŠ¸**
  - ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ (Ctrl+Shift+R)
  - ì¼ê´„ ë“±ë¡ ì‹¤í–‰
  - ì½˜ì†”ì—ì„œ ì˜¤ë¥˜ í™•ì¸

#### **ğŸ“‹ Type ì‹œíŠ¸ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸ - ì¶”ê°€ ì‘ì—…**
- [ ] **1. í°íŠ¸ ì„¤ì • ë³€ê²½**
  - í°íŠ¸: ROBOTO
  - í¬ê¸°: 11
  - ì¤‘ì•™ ì •ë ¬
- [ ] **2. applyFullSheetStyle í•¨ìˆ˜ ìˆ˜ì •**
  - setFontFamily('Roboto')
  - setFontSize(11)
  - setHorizontalAlignment('center')
- [ ] **3. ìë™ ì ìš© ë¡œì§**
  - í”Œë ˆì´ì–´ ì¶”ê°€/ìˆ˜ì • ì‹œ ìë™ ìŠ¤íƒ€ì¼ ì ìš©
  - ì¼ê´„ ì—…ë°ì´íŠ¸ í›„ ìë™ ìŠ¤íƒ€ì¼ ì ìš©

#### **ğŸ“‹ í•´ê²°ì±… B ì‹¤í–‰ (iframe + postMessage)**
- [ ] **1. index.html ë°±ì—…**
- [ ] **2. callAppsScriptWithIframe í•¨ìˆ˜ ì¶”ê°€**
  - ë¼ì¸ 6340 ê·¼ì²˜ì— í•¨ìˆ˜ ì¶”ê°€
- [ ] **3. fetch í˜¸ì¶œ ëŒ€ì²´**
  - ë¼ì¸ 6393-6409ë¥¼ ìƒˆ í•¨ìˆ˜ í˜¸ì¶œë¡œ ë³€ê²½
- [ ] **4. doGet ì§€ì› í™•ì¸**
  - Apps Script doGetì´ URL íŒŒë¼ë¯¸í„° ì²˜ë¦¬í•˜ëŠ”ì§€ í™•ì¸
- [ ] **5. í…ŒìŠ¤íŠ¸**
  - ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ > Network íƒ­ í™•ì¸
  - iframe ë¡œë”© í™•ì¸
  - postMessage ì´ë²¤íŠ¸ í™•ì¸
### **ë¬¸ì œ í•´ê²° ê²€ì¦**

#### **ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸**
- [ ] **Apps Script ê²€ì¦**
  - [ ] createCorsResponseê°€ JSON ë°˜í™˜í•˜ëŠ”ì§€ í™•ì¸
  - [ ] doPost/doGetì´ ContentService ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸
  - [ ] ë°°í¬ URLì´ ìµœì‹ ì¸ì§€ í™•ì¸
  - [ ] ë°°í¬ ì„¤ì •ì´ "ëª¨ë“  ì‚¬ìš©ì"ì¸ì§€ í™•ì¸

- [ ] **í´ë¼ì´ì–¸íŠ¸ ê²€ì¦**
  - [ ] fetch ìš”ì²­ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
  - [ ] response.json()ì´ ì„±ê³µí•˜ëŠ”ì§€ í™•ì¸
  - [ ] ì—ëŸ¬ í•¸ë“¤ë§ì´ ì œëŒ€ë¡œ ë˜ëŠ”ì§€ í™•ì¸

- [ ] **í†µí•© í…ŒìŠ¤íŠ¸**
  - [ ] í”Œë ˆì´ì–´ ì¶”ê°€ í…ŒìŠ¤íŠ¸
  - [ ] í”Œë ˆì´ì–´ ìˆ˜ì • í…ŒìŠ¤íŠ¸
  - [ ] í”Œë ˆì´ì–´ ì‚­ì œ í…ŒìŠ¤íŠ¸
  - [ ] ì¼ê´„ ë“±ë¡ í…ŒìŠ¤íŠ¸
  - [ ] Config ì¡°íšŒ/ì €ì¥ í…ŒìŠ¤íŠ¸

### **ë””ë²„ê¹… íŒ**
```javascript
// 1. Apps Script ë¡œê·¸ í™•ì¸
console.log('[ë””ë²„ê·¸]', JSON.stringify(data));

// 2. í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ í™•ì¸
console.log('Response headers:', response.headers);
console.log('Response type:', response.type);
console.log('Response text:', await response.text());

// 3. CORS í—¤ë” í™•ì¸ (ê°œë°œì ë„êµ¬)
// Network íƒ­ > ìš”ì²­ ì„ íƒ > Response Headers
// Access-Control-Allow-Origin: * í™•ì¸
```

### **ê²°ë¡ **
**ê·¼ë³¸ ì›ì¸**: Apps Scriptê°€ HTML Serviceë¡œ ì‘ë‹µí•˜ëŠ”ë° í´ë¼ì´ì–¸íŠ¸ëŠ” JSONì„ ê¸°ëŒ€
**ìµœê³ ì˜ í•´ê²°ì±…**: Apps Scriptë¥¼ ContentService.JSONìœ¼ë¡œ ë³€ê²½ (í•´ê²°ì±… A)
**ì°¨ì„ ì±…**: í´ë¼ì´ì–¸íŠ¸ì— iframe + postMessage êµ¬í˜„ (í•´ê²°ì±… B)

---

## ğŸ”´ **ìµœìš°ì„  í•´ê²° 2** - Config ì‹œíŠ¸ í™œìš© ë¬¸ì œ

### **í˜„ì¬ ë¬¸ì œì **
- **ìƒí™©**: Config ì‹œíŠ¸ êµ¬ì¡°ëŠ” ì™„ë²½í•˜ê²Œ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë‚˜ ì‹¤ì œë¡œ í™œìš©ë˜ì§€ ì•ŠìŒ
- **ì›ì¸**: í´ë¼ì´ì–¸íŠ¸(index.html)ì—ì„œ Config ì‹œíŠ¸ë¥¼ ì°¸ì¡°í•˜ëŠ” ë¡œì§ ë¶€ì¬
- **ì˜í–¥**: ì„¤ì •ê°’ë“¤ì´ í•˜ë“œì½”ë”©ë˜ì–´ ìˆì–´ ë™ì  ë³€ê²½ ë¶ˆê°€ëŠ¥

### **Config ì‹œíŠ¸ê°€ ì°¸ì¡°ë˜ì§€ ì•ŠëŠ” ì´ìœ **
1. **í•˜ë“œì½”ë”©ëœ ê¸°ë³¸ê°’**
   - pokerRoom: 'Merit Hall' (ë¼ì¸ 6150, 6371)
   - tableName: 'Ocean Blue' (ë¼ì¸ 6151, 6372)
   - chips: '100000' (ë¼ì¸ 6146, 6367)

2. **Config ì¡°íšŒ ë¡œì§ ë¶€ì¬**
   - ì•± ì´ˆê¸°í™” ì‹œ Config ê°’ì„ ê°€ì ¸ì˜¤ëŠ” ì½”ë“œ ì—†ìŒ
   - í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œ Config ê¸°ë³¸ê°’ ì°¸ì¡° ì•ˆí•¨

3. **ì €ì¥ ë¡œì§ë§Œ ì¡´ì¬**
   - Apps Scriptì— saveConfig/getConfig í•¨ìˆ˜ëŠ” ìˆìŒ
   - í´ë¼ì´ì–¸íŠ¸ì—ì„œ í˜¸ì¶œí•˜ëŠ” ë¶€ë¶„ì´ ì—†ìŒ

### **í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸**

#### **1ë‹¨ê³„: Config ê°’ ì •ì˜**
- [ ] Config ì‹œíŠ¸ì— ì €ì¥í•  ì„¤ì • í•­ëª© ì •ì˜
  - [ ] DEFAULT_POKER_ROOM: "Merit Hall"
  - [ ] DEFAULT_TABLE_NAME: "Ocean Blue"
  - [ ] DEFAULT_CHIPS: "100000"
  - [ ] DEFAULT_NATIONALITY: ""
  - [ ] AUTO_SAVE_INTERVAL: "30000"
  - [ ] ENABLE_CHIP_ANALYZER: "true"

#### **2ë‹¨ê³„: í´ë¼ì´ì–¸íŠ¸ Config ê´€ë¦¬ êµ¬í˜„**
- [ ] **Config ê´€ë¦¬ ê°ì²´ ìƒì„±** (index.htmlì— ì¶”ê°€)
  ```javascript
  window.configManager = {
    cache: {},
    defaultValues: {
      DEFAULT_POKER_ROOM: 'Merit Hall',
      DEFAULT_TABLE_NAME: 'Ocean Blue',
      DEFAULT_CHIPS: '100000'
    },
    async load() { /* Config ë¡œë“œ */ },
    async save(key, value) { /* Config ì €ì¥ */ },
    get(key) { /* Config ê°’ ê°€ì ¸ì˜¤ê¸° */ }
  };
  ```

#### **3ë‹¨ê³„: Config ë¡œë“œ êµ¬í˜„**
- [ ] **ì•± ì´ˆê¸°í™” ì‹œ Config ë¡œë“œ**
  ```javascript
  // initializeApp() í•¨ìˆ˜ì— ì¶”ê°€
  await window.configManager.load();
  ```
- [ ] **Config ê°’ Apps Scriptì—ì„œ ê°€ì ¸ì˜¤ê¸°**
  ```javascript
  const configs = ['DEFAULT_POKER_ROOM', 'DEFAULT_TABLE_NAME', 'DEFAULT_CHIPS'];
  for (const configType of configs) {
    const response = await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ action: 'getConfig', configType })
    });
  }
  ```

#### **4ë‹¨ê³„: Config ê°’ ì ìš©**
- [ ] **í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œ Config ê°’ ì‚¬ìš©**
  ```javascript
  const newPlayer = {
    name: name,
    chips: window.configManager.get('DEFAULT_CHIPS'),
    pokerRoom: window.configManager.get('DEFAULT_POKER_ROOM'),
    tableName: window.configManager.get('DEFAULT_TABLE_NAME'),
    // ...
  };
  ```
- [ ] **ì¼ê´„ ë“±ë¡ ì‹œ Config ê¸°ë³¸ê°’ ì ìš©**
  ```javascript
  pokerRoom: p.pokerRoom || window.configManager.get('DEFAULT_POKER_ROOM'),
  tableName: p.tableName || window.configManager.get('DEFAULT_TABLE_NAME'),
  ```

#### **5ë‹¨ê³„: Config UI êµ¬í˜„**
- [ ] **ì„¤ì • ë©”ë‰´ ì¶”ê°€**
  - [ ] ì„¤ì • ë²„íŠ¼ UI ìƒì„±
  - [ ] Config ìˆ˜ì • ëª¨ë‹¬ êµ¬í˜„
  - [ ] ì €ì¥ ë²„íŠ¼ í´ë¦­ ì‹œ saveConfig í˜¸ì¶œ

#### **6ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦**
- [ ] Config ì‹œíŠ¸ì— ê¸°ë³¸ê°’ ì„¤ì •
- [ ] ì•± ë¡œë“œ ì‹œ Config ê°’ ì •ìƒ ë¡œë“œ í™•ì¸
- [ ] í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œ Config ê°’ ì ìš© í™•ì¸
- [ ] Config ê°’ ë³€ê²½ í›„ ì¬ë¡œë“œ ì‹œ ë°˜ì˜ í™•ì¸
- [ ] Config ì €ì¥ ê¸°ëŠ¥ ì •ìƒ ì‘ë™ í™•ì¸

### **êµ¬í˜„ ìš°ì„ ìˆœìœ„**
1. **ì¦‰ì‹œ**: Config ë¡œë“œ ë¡œì§ êµ¬í˜„ (ì•± ì´ˆê¸°í™”)
2. **ë†’ìŒ**: í•˜ë“œì½”ë”©ëœ ê°’ì„ Config ì°¸ì¡°ë¡œ ë³€ê²½
3. **ì¤‘ê°„**: Config UI êµ¬í˜„
4. **ë‚®ìŒ**: ì¶”ê°€ Config í•­ëª© í™•ì¥

---

## ğŸš¨ **ê¸´ê¸‰ ìˆ˜ì • í•„ìš”** - CORS ì—ëŸ¬ í•´ê²°

### **ë¬¸ì œ ì§„ë‹¨**
- **ì—ëŸ¬**: `Access to fetch at 'https://script.google.com/...' from origin 'http://localhost:8000' has been blocked by CORS policy`
- **ì›ì¸**: Google Apps Scriptê°€ localhost ë„ë©”ì¸ì—ì„œì˜ ìš”ì²­ì„ ì°¨ë‹¨
- **ì˜í–¥**: í”Œë ˆì´ì–´ ì¼ê´„ ë“±ë¡ ê¸°ëŠ¥ ì‘ë™ ë¶ˆê°€

### **ì¦‰ì‹œ í•´ê²° ë°©ë²•**

#### **ì˜µì…˜ 1: FormData ëŒ€ì‹  URL ì¸ì½”ë”© ë°©ì‹ ì‚¬ìš©** âœ… ê¶Œì¥
```javascript
// index.html 6378ë²ˆ ì¤„ ìˆ˜ì •
// ê¸°ì¡´ ì½”ë“œ:
const response = await fetch(APPS_SCRIPT_URL, {
  method: 'POST',
  body: formData
});

// ìˆ˜ì • ì½”ë“œ:
const urlParams = new URLSearchParams();
urlParams.append('action', 'batchUpdate');
urlParams.append('table', managementState.currentTable);
urlParams.append('players', JSON.stringify(playersToSend));
urlParams.append('deleted', JSON.stringify(deleted));

const response = await fetch(APPS_SCRIPT_URL, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/x-www-form-urlencoded'
  },
  body: urlParams.toString()
});
```

#### **ì˜µì…˜ 2: Apps Script ì¬ë°°í¬**
1. Google Apps Script í”„ë¡œì íŠ¸ ì—´ê¸°
2. ë°°í¬ > ìƒˆ ë°°í¬
3. ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì"
4. ìƒˆ URL íšë“ í›„ index.htmlì˜ APPS_SCRIPT_URL ì—…ë°ì´íŠ¸

#### **ì˜µì…˜ 3: ë¸Œë¼ìš°ì € CORS ë¹„í™œì„±í™” (ê°œë°œìš©ë§Œ)**
```bash
# Chrome ì‹¤í–‰ (Windows)
chrome.exe --disable-web-security --user-data-dir="C:/temp"

# Chrome ì‹¤í–‰ (Mac)
open -n -a /Applications/Google\ Chrome.app --args --disable-web-security --user-data-dir="/tmp/chrome_dev"
```

### **ë°ì´í„° êµ¬ì¡° ë¶ˆì¼ì¹˜ ìˆ˜ì •**
```javascript
// ìƒˆë¡œìš´ í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œ í•„ë“œëª… í†µì¼
{
  name: "tresy song",
  chips: "100000",
  keyplayer: false,     // notable â†’ keyplayer
  nationality: "",     // ëˆ„ë½ëœ í•„ë“œ ì¶”ê°€
  seatNo: "#1",        // seat â†’ seatNo
  pokerRoom: "Merit Hall",
  tableName: "Ocean Blue",
  tableNo: "10"       // table â†’ tableNo
}
```

---

## âœ… **v71.0.0 í”Œë ˆì´ì–´ ê´€ë¦¬ ë¡œì§ í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸**

### **í”Œë ˆì´ì–´ ë“±ë¡ (createPlayer)**
- [ ] í…Œì´ë³¼+ì¢Œì„ ì¤‘ë³µ ì²´í¬ ì‘ë™
- [ ] í…Œì´ë³¼+ì´ë¦„ ì¤‘ë³µ ì²´í¬ ì‘ë™
- [ ] í•„ë“œ ê¸°ë³¸ê°’ ì ìš© (Merit Hall, Ocean Blue)
- [ ] ì¢Œì„ ë²ˆí˜¸ ì •ê·œí™” (#1, #2 í˜•ì‹)
- [ ] ì¹© ë¬¸ìì—´ â†’ ìˆ«ì ë³€í™˜
- [ ] keyplayer false â†’ ë¹ˆê°’ ë³€í™˜
- [ ] ì„±ê³µ ì‘ë‹µ í˜•ì‹ í™•ì¸

### **í”Œë ˆì´ì–´ ìˆ˜ì • (updatePlayerInfo)**
- [ ] ì¢Œì„ìœ¼ë¡œ ê²€ìƒ‰ ì‘ë™
- [ ] ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ ì‘ë™ (ì¢Œì„ ì—†ì„ ë•Œ)
- [ ] ê° í•„ë“œ ê°œë³„ ì—…ë°ì´íŠ¸ í™•ì¸
  - [ ] chips ì—…ë°ì´íŠ¸
  - [ ] nationality ì—…ë°ì´íŠ¸
  - [ ] keyplayer ì—…ë°ì´íŠ¸
  - [ ] pokerRoom ì—…ë°ì´íŠ¸
  - [ ] tableName ì—…ë°ì´íŠ¸
  - [ ] name ë³€ê²½
  - [ ] seatNo ë³€ê²½
- [ ] PlayerIndex í´ë¦¬ì–´ í™•ì¸

### **í”Œë ˆì´ì–´ ì‚­ì œ (deletePlayer)**
- [ ] ì¢Œì„ìœ¼ë¡œ ì‚­ì œ ì‘ë™
- [ ] ì´ë¦„ìœ¼ë¡œ ì‚­ì œ ì‘ë™
- [ ] ì—¬ëŸ¬ ëª… ì¤‘ë³µ ì‹œ ì²« ë²ˆì§¸ ì‚­ì œ
- [ ] ì „ì²´ í–‰ ì‚­ì œ í™•ì¸
- [ ] PlayerIndex í´ë¦¬ì–´ í™•ì¸

### **í•¸ë“œ ì¢…ë£Œ í›„ ì¹© ì—…ë°ì´íŠ¸ (handleUpdatePlayerChips)**
- [ ] ê¸°ì¡´ í”Œë ˆì´ì–´ ì¹© ì—…ë°ì´íŠ¸
- [ ] í”Œë ˆì´ì–´ ì—†ìœ¼ë©´ ìë™ ì¶”ê°€
  - [ ] ê¸°ë³¸ê°’ ì ìš© í™•ì¸ (Merit Hall, Ocean Blue)
  - [ ] ì¢Œì„ ë¹„ì›Œë‘ê¸°
  - [ ] nationality ë¹„ì›Œë‘ê¸°
  - [ ] keyplayer falseë¡œ ì„¤ì •
- [ ] ì¹© ìˆ«ì ë³€í™˜ í™•ì¸

### **ì¼ê´„ ì—…ë°ì´íŠ¸ (batchUpdate)**
- [ ] ì‚­ì œ ì²˜ë¦¬ ìˆœì„œ í™•ì¸
- [ ] ì¶”ê°€/ìˆ˜ì • ì²˜ë¦¬ ìˆœì„œ í™•ì¸
- [ ] smartUpdatePlayer í˜¸ì¶œ í™•ì¸
- [ ] ìë™ ì •ë ¬ ì‹¤í–‰ (Table No â†’ Seat No)
- [ ] ì¤‘ë³µ ì œê±° ì‹¤í–‰
- [ ] ì„±ê³µ/ì‹¤íŒ¨ ì¹´ìš´íŠ¸ í™•ì¸
- [ ] ìƒì„±/êµì²´ ì¹´ìš´íŠ¸ í™•ì¸

### **ë°ì´í„° ë³€í™˜ (convertToV71Structure)**
- [ ] seat â†’ seatNo ë³€í™˜
- [ ] table â†’ tableNo ë³€í™˜
- [ ] notable â†’ keyplayer ë³€í™˜
- [ ] ì¢Œì„ ë²ˆí˜¸ # ìë™ ì¶”ê°€
- [ ] ì¹© ì½¤ë§ˆ ì œê±° ë° ìˆ«ì ë³€í™˜
- [ ] ê¸°ë³¸ê°’ ì ìš© í™•ì¸

### **CORS í•´ê²° í™•ì¸**
- [ ] HTML Service ì‘ë‹µ í™•ì¸
- [ ] postMessage í†µì‹  í…ŒìŠ¤íŠ¸
- [ ] FormData ë°©ì‹ ì§€ì›
- [ ] URL ì¸ì½”ë”© ë°©ì‹ ì§€ì›
- [ ] JSON ë°©ì‹ ì§€ì›

### **PlayerIndex í´ë˜ìŠ¤**
- [ ] í…Œì´ë¸”ë³„ ì¸ë±ìŠ¤ ì‘ë™
- [ ] ì´ë¦„ë³„ ì¸ë±ìŠ¤ ì‘ë™
- [ ] í‚¤(í…Œì´ë¸”+ì¢Œì„) ì¸ë±ìŠ¤ ì‘ë™
- [ ] ìºì‹œ ë§Œë£Œ(1ë¶„) í™•ì¸
- [ ] ìë™ ë¦¬ë¹Œë“œ ì‘ë™

---

## ğŸ”¥ **ê¸´ê¸‰ ìµœìš°ì„  ì²´í¬ë¦¬ìŠ¤íŠ¸** - ëª¨ë°”ì¼ í‚¤íŒ¨ë“œ ë¬¸ì œ í•´ê²°

### âœ… **v3.4.19 ëª¨ë°”ì¼ í‚¤íŒ¨ë“œ ë²„íŠ¼ í•´ê²° ì™„ë£Œ**
#### **ë¬¸ì œ ë° í•´ê²°**
- **ì¦ìƒ**: PCì—ì„œëŠ” í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ ì •ìƒ, ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ë¯¸ì‘ë™
- **ì›ì¸**: ëª¨ë°”ì¼ ë¸Œë¼ìš°ì €ì˜ 300ms í„°ì¹˜ ì§€ì—°
- **í•´ê²°**: touchstart ì´ë²¤íŠ¸ë¡œ ì¦‰ì‹œ ë°˜ì‘í•˜ë„ë¡ ìˆ˜ì •

#### **ìµœì¢… í•´ê²° ì½”ë“œ**
```javascript
// í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ ì¦‰ì‹œ ë°˜ì‘ ì²˜ë¦¬
if(btn.id === 'keypad-confirm' || btn.id === 'keypad-cancel') {
  // í„°ì¹˜ ì¦‰ì‹œ ë°˜ì‘ (300ms ì§€ì—° ì œê±°)
  btn.style.transform = 'scale(0.95)';
  btn.style.filter = 'brightness(1.2)';

  setTimeout(() => {
    btn.style.transform = '';
    btn.style.filter = '';
    btn.click(); // ê¸°ì¡´ click ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
  }, 100);

  e.preventDefault();
  return;
}
```

### âœ… **í‚¤íŒ¨ë“œ ë°˜ì‘ì„± ë¬¸ì œ í•´ê²° ì™„ë£Œ (v3.4.17)**
- [x] mousedown/touchstart ì´ë²¤íŠ¸ë¡œ ì¦‰ì‹œ ì²˜ë¦¬
- [x] ë¬¼ë¦¬ì  ëˆ„ë¦„ ìƒíƒœ ì¶”ì  (buttonPressState Map)
- [x] ì‹œê°ì  í”¼ë“œë°± ì¦‰ì‹œ ì œê³µ
- [x] DOM ê°•ì œ ë Œë”ë§ êµ¬í˜„

---

## ğŸ“‹ ê¸°ë³¸ ê¸°ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘
- [ ] **í˜ì´ì§€ ë¡œë“œ**: http://localhost:8000/ ì ‘ì† ì„±ê³µ
- [ ] **ë²„ì „ í‘œì‹œ**: v3.5.16 ë²„ì „ì´ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë¨
- [ ] **ì´ˆê¸°í™”**: ì•± ì´ˆê¸°í™” ë©”ì‹œì§€ê°€ ì½˜ì†”ì— ì¶œë ¥ë¨
- [ ] **UI ë¡œë“œ**: ëª¨ë“  UI ìš”ì†Œê°€ ì •ìƒì ìœ¼ë¡œ ë Œë”ë§ë¨

### ğŸ”„ ì¤‘ë³µ ê²€ì‚¬ ì‹œìŠ¤í…œ (v3.4.15 í•´ê²° ì™„ë£Œ)
- [x] **ìë™ ì‹œì‘**: í˜ì´ì§€ ë¡œë“œ ì‹œ ì¤‘ë³µ ê²€ì‚¬ ìë™ ì‹œì‘
- [x] **ë¡œê·¸ ëª¨ë‹¬**: ê²€ì‚¬ ê³¼ì •ì´ í†µí•© ë¡œê·¸ ëª¨ë‹¬ì— í‘œì‹œ
- [x] **ì§ì ‘ í˜¸ì¶œ**: removeDuplicatePlayers(true) ì§ì ‘ í˜¸ì¶œ
- [x] **ì´ì¤‘ ì‹¤í–‰ ì°¨ë‹¨**: ì¤‘ë³µ ê²€ì‚¬ê°€ 1ë²ˆë§Œ ì‹¤í–‰ë¨
- [x] **ìë™ ë‹«ê¸°**: ê²€ì‚¬ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ ìë™ ë‹«ê¸°

### ğŸ‘¥ í”Œë ˆì´ì–´ ê´€ë¦¬
- [ ] **í…Œì´ë¸” ì„ íƒ**: í…Œì´ë¸” ë“œë¡­ë‹¤ìš´ì´ ì •ìƒ ì‘ë™í•¨
- [ ] **í”Œë ˆì´ì–´ ì¶”ê°€**: ìƒˆ í”Œë ˆì´ì–´ ë“±ë¡ì´ ì„±ê³µí•¨
- [ ] **í”Œë ˆì´ì–´ ìˆ˜ì •**: ê¸°ì¡´ í”Œë ˆì´ì–´ ì •ë³´ ìˆ˜ì •ì´ ê°€ëŠ¥í•¨
- [ ] **í”Œë ˆì´ì–´ ì‚­ì œ**: í”Œë ˆì´ì–´ ì‚­ì œê°€ ì •ìƒ ì‘ë™í•¨
- [ ] **IN/OUT ìƒíƒœ**: í”Œë ˆì´ì–´ ìƒíƒœ ë³€ê²½ì´ ì˜¬ë°”ë¥´ê²Œ ë°˜ì˜ë¨

### ğŸ´ ì¹´ë“œ ì„ íƒ ì‹œìŠ¤í…œ
- [ ] **ì¹´ë“œ ì„ íƒê¸°**: ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒ UIê°€ ì •ìƒ ì‘ë™í•¨
- [ ] **í…ìŠ¤íŠ¸ ì…ë ¥ ì œê±°**: í…ìŠ¤íŠ¸ ì¹´ë“œ ì…ë ¥ í•„ë“œê°€ ëª¨ë‘ ì œê±°ë¨
- [ ] **í„´/ë¦¬ë²„ ì¹´ë“œ**: ìŠ¤íŠ¸ë¦¿ ì§„í–‰ ì‹œ ì¹´ë“œ ì„ íƒ UI ì‚¬ìš©
- [ ] **ë³´ë“œ ì¹´ë“œ**: í”Œë/í„´/ë¦¬ë²„ ì¹´ë“œê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œë¨

### ğŸ’° ì¹© ê´€ë¦¬
- [ ] **ì¹© ìŠ¤íƒ**: í”Œë ˆì´ì–´ë³„ ì¹© ìŠ¤íƒì´ ì •í™•íˆ í‘œì‹œë¨
- [ ] **ì¹© ë³€ë™**: ì•¡ì…˜ì— ë”°ë¥¸ ì¹© ë³€ë™ì´ ì˜¬ë°”ë¥´ê²Œ ê³„ì‚°ë¨
- [ ] **íŒŸ ê´€ë¦¬**: íŒŸ ì‚¬ì´ì¦ˆê°€ ì •í™•íˆ ê³„ì‚°ë¨
- [ ] **ì‚¬ì´ë“œ íŒŸ**: ì‚¬ì´ë“œ íŒŸì´ í•„ìš”í•œ ê²½ìš° ì˜¬ë°”ë¥´ê²Œ ìƒì„±ë¨

### ğŸ“Š ë°ì´í„° ë™ê¸°í™”
- [ ] **Google Sheets ì—°ë™**: Apps Scriptì™€ ì •ìƒ ì—°ë™ë¨
- [ ] **ì‹¤ì‹œê°„ ë™ê¸°í™”**: ë°ì´í„° ë³€ê²½ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë¨
- [ ] **CSV ë¡œë”©**: CSV ë°ì´í„° ë¡œë”©ì´ ì„±ê³µí•¨
- [ ] **ì—ëŸ¬ ì²˜ë¦¬**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì ì ˆí•œ ë©”ì‹œì§€ í‘œì‹œ

---

## ğŸ”§ ê³ ê¸‰ ê¸°ëŠ¥ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸ¤– AI ì¹© ë¶„ì„ (Gemini)
- [ ] **ì´ë¯¸ì§€ ë¶„ì„**: ì¹© ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° ë¶„ì„ ì„±ê³µ
- [ ] **ì¹© ì¸ì‹**: AIê°€ ì¹© ìƒ‰ìƒê³¼ ê°œìˆ˜ë¥¼ ì •í™•íˆ ì¸ì‹
- [ ] **ê²°ê³¼ í‘œì‹œ**: ë¶„ì„ ê²°ê³¼ê°€ ëª…í™•í•˜ê²Œ í‘œì‹œë¨
- [ ] **ì˜¤ë¥˜ ì²˜ë¦¬**: ë¶„ì„ ì‹¤íŒ¨ ì‹œ ì ì ˆí•œ ë©”ì‹œì§€ í‘œì‹œ

### ğŸ“± ëª¨ë°”ì¼ ìµœì í™”
- [x] **í„°ì¹˜ ì§€ì›**: í„°ì¹˜ ì œìŠ¤ì²˜ê°€ ì •ìƒ ì‘ë™í•¨
- [x] **í‚¤íŒ¨ë“œ ë°˜ì‘ì„±**: ëª¨ë°”ì¼ì—ì„œ ì¦‰ì‹œ ë°˜ì‘
- [ ] **ë°˜ì‘í˜• UI**: ëª¨ë°”ì¼ í™”ë©´ì— ë§ê²Œ UI ì¡°ì •ë¨
- [ ] **ì„±ëŠ¥**: ëª¨ë°”ì¼ì—ì„œë„ ë¶€ë“œëŸ¬ìš´ ë™ì‘

### ğŸ¯ ì•¡ì…˜ ê´€ë¦¬
- [ ] **ì•¡ì…˜ íˆìŠ¤í† ë¦¬**: ëª¨ë“  ì•¡ì…˜ì´ íˆìŠ¤í† ë¦¬ì— ê¸°ë¡ë¨
- [ ] **ë˜ëŒë¦¬ê¸°**: ì•¡ì…˜ ë˜ëŒë¦¬ê¸° ê¸°ëŠ¥ ì‘ë™
- [ ] **ìŠ¤íŠ¸ë¦¿ ì§„í–‰**: ìŠ¤íŠ¸ë¦¿ ìë™ ì§„í–‰ì´ ìˆœì„œëŒ€ë¡œ ì‘ë™
- [ ] **í•¸ë“œ ì™„ë£Œ**: í•¸ë“œ ì¢…ë£Œ ì‹œ ì˜¬ë°”ë¥¸ ê²°ê³¼ ê¸°ë¡

---

## ğŸ› ë²„ê·¸ ë° ì˜¤ë¥˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ğŸš¨ ì¼ë°˜ì ì¸ ë²„ê·¸
- [ ] **JavaScript ì˜¤ë¥˜**: ì½˜ì†”ì— ì˜¤ë¥˜ ë©”ì‹œì§€ ì—†ìŒ
- [ ] **404 ì—ëŸ¬**: ëª¨ë“  ë¦¬ì†ŒìŠ¤ íŒŒì¼ì´ ì •ìƒ ë¡œë“œë¨
- [ ] **í•¨ìˆ˜ ë¯¸ì •ì˜**: ReferenceError ì—†ìŒ
- [ ] **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜**: ì¥ì‹œê°„ ì‚¬ìš©í•´ë„ ì„±ëŠ¥ ì €í•˜ ì—†ìŒ

### ğŸ” ë°ì´í„° ë¬´ê²°ì„±
- [x] **í”Œë ˆì´ì–´ ì¤‘ë³µ**: ì¤‘ë³µ í”Œë ˆì´ì–´ê°€ ìë™ìœ¼ë¡œ ì œê±°ë¨
- [ ] **ë°ì´í„° ì¼ê´€ì„±**: ë¡œì»¬ê³¼ ì„œë²„ ë°ì´í„°ê°€ ì¼ì¹˜í•¨
- [ ] **ìƒíƒœ ë™ê¸°í™”**: UI ìƒíƒœê°€ ì‹¤ì œ ë°ì´í„°ì™€ ì¼ì¹˜í•¨
- [ ] **ë°±ì—… ë³µêµ¬**: ë°ì´í„° ì†ì‹¤ ì‹œ ë³µêµ¬ ê°€ëŠ¥

### âš¡ ì„±ëŠ¥ ì´ìŠˆ
- [ ] **ë¡œë”© ì†ë„**: í˜ì´ì§€ ë¡œë”©ì´ 3ì´ˆ ì´ë‚´ ì™„ë£Œ
- [x] **ì‘ë‹µì„±**: ì‚¬ìš©ì ì•¡ì…˜ì— ì¦‰ì‹œ ë°˜ì‘
- [ ] **ë°°ì¹˜ ì²˜ë¦¬**: ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ UI ë¸”ë¡ ì—†ìŒ
- [ ] **ìºì‹œ ì²˜ë¦¬**: ë¸Œë¼ìš°ì € ìºì‹œê°€ ì˜¬ë°”ë¥´ê²Œ ì‘ë™

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ğŸ“‹ ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤
1. **ì‹ ê·œ ê²Œì„ ì‹œì‘**
   - [ ] ìƒˆ í…Œì´ë¸” ìƒì„±
   - [ ] í”Œë ˆì´ì–´ 4ëª… ì¶”ê°€
   - [ ] ë¸”ë¼ì¸ë“œ ì„¤ì •
   - [ ] ì²« í•¸ë“œ ì‹œì‘

2. **ì¼ë°˜ì ì¸ í•¸ë“œ ì§„í–‰**
   - [ ] í”„ë¦¬í”Œë ì•¡ì…˜ ê¸°ë¡
   - [ ] í”Œë ì¹´ë“œ ì„ íƒ
   - [ ] ë² íŒ… ë¼ìš´ë“œ ì§„í–‰
   - [ ] í„´/ë¦¬ë²„ ì§„í–‰
   - [ ] í•¸ë“œ ê²°ê³¼ ê¸°ë¡

3. **íŠ¹ìˆ˜ ìƒí™© ì²˜ë¦¬**
   - [ ] ì˜¬ì¸ ìƒí™©
   - [ ] ì‚¬ì´ë“œ íŒŸ ìƒì„±
   - [ ] í”Œë ˆì´ì–´ IN/OUT
   - [ ] í…Œì´ë¸” ë³€ê²½

### ğŸ”„ ìŠ¤íŠ¸ë ˆìŠ¤ í…ŒìŠ¤íŠ¸
- [ ] **ì¥ì‹œê°„ ì‚¬ìš©**: 2ì‹œê°„ ì—°ì† ì‚¬ìš© í…ŒìŠ¤íŠ¸
- [ ] **ëŒ€ëŸ‰ ë°ì´í„°**: 100ê°œ ì´ìƒ í•¸ë“œ ê¸°ë¡
- [ ] **ë™ì‹œ ì•¡ì…˜**: ë¹ ë¥¸ ì—°ì† ì•¡ì…˜ ì²˜ë¦¬
- [ ] **ë„¤íŠ¸ì›Œí¬ ë¶ˆì•ˆì •**: ì¸í„°ë„· ì—°ê²° ë¶ˆì•ˆì • ìƒí™©

---

## ğŸš€ í”„ë¡œì íŠ¸ ì •ë³´ ë° ê°œë°œ ë¡œë“œë§µ

### í”„ë¡œì íŠ¸ ì •ë³´
- **í˜„ì¬ ë²„ì „**: v3.5.16 (Frontend) / v71.0.0 (Apps Script)
- **ì‹œì‘ì¼**: 2025-09-18
- **ìµœê·¼ ì—…ë°ì´íŠ¸**: 2025-09-23

### ğŸ“‹ ê°œë°œ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### **Phase 1: ê¸´ê¸‰ ë³´ì•ˆ ìˆ˜ì •** ğŸ”´
- [x] Apps Script í”„ë¡ì‹œ ì½”ë“œ ì‘ì„± (`GeminiProxy.gs`)
- [x] í´ë¼ì´ì–¸íŠ¸ ë³´ì•ˆ ëª¨ë“ˆ ì‘ì„± (`gemini-client.js`)
- [x] ì„¤ì • ê°€ì´ë“œ ë¬¸ì„œ ì‘ì„± (`SETUP_API_SECURITY.md`)
- [ ] Google Apps Scriptì— ì½”ë“œ ë°°í¬
- [ ] Script Propertiesì— API í‚¤ ì„¤ì •
- [ ] í”„ë¡ì‹œ URL íšë“ ë° ì €ì¥
- [ ] index.htmlì—ì„œ í•˜ë“œì½”ë”©ëœ API í‚¤ ì œê±°
- [ ] í”„ë¡ì‹œ ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] ì¹© ë¶„ì„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

#### **Phase 2: ì½”ë“œ êµ¬ì¡° ê°œì„ ** ğŸŸ¡
- [ ] ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±
- [ ] í•µì‹¬ ëª¨ë“ˆ ë¶„ë¦¬ (config, state, utils)
- [ ] ë§¤ë‹ˆì € í´ë˜ìŠ¤ ë¶„ë¦¬ (ActionOrderManager, TableManager, ChipAnalyzer)
- [ ] UI ëª¨ë“ˆ ë¶„ë¦¬ (modals, render, events)

#### **Phase 3: ìƒíƒœ ê´€ë¦¬ ê°œì„ ** ğŸŸ¢
- [ ] Store í´ë˜ìŠ¤ êµ¬í˜„
- [ ] ë‹¨ë°©í–¥ ë°ì´í„° íë¦„ êµ¬í˜„
- [ ] ë¶ˆë³€ì„± ë³´ì¥
- [ ] ìƒíƒœ ìŠ¤ëƒ…ìƒ· ê¸°ëŠ¥

#### **Phase 4: ì„±ëŠ¥ ìµœì í™”** ğŸ”µ
- [ ] Webpack ì„¤ì •
- [ ] Lazy loading êµ¬í˜„
- [ ] ì½”ë“œ ë¶„í•  ì ìš©
- [ ] ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ì œê±°

#### **Phase 5: ì½”ë“œ í’ˆì§ˆ** âšª
- [ ] ESLint/Prettier ì„¤ì •
- [ ] JSDoc ì£¼ì„ ì¶”ê°€
- [ ] ì‚¬ìš©ì ê°€ì´ë“œ ì‘ì„±
- [ ] API ë¬¸ì„œ ìƒì„±

#### **Phase 6: í…ŒìŠ¤íŠ¸ ë° ë°°í¬** ğŸŸ£
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (Jest)
- [ ] E2E í…ŒìŠ¤íŠ¸ (Cypress)
- [ ] GitHub Actions CI/CD
- [ ] GitHub Pages ë°°í¬

### ğŸ“Š ì§„í–‰ í˜„í™©
```
Phase 1: [â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘] 33% (3/9 ì™„ë£Œ)
Phase 2: [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0% (0/4 ì™„ë£Œ)
Phase 3: [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0% (0/4 ì™„ë£Œ)
Phase 4: [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0% (0/4 ì™„ë£Œ)
Phase 5: [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0% (0/4 ì™„ë£Œ)
Phase 6: [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 0% (0/4 ì™„ë£Œ)

ì´ ì§„í–‰ë¥ : [â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 10% (3/29 ì™„ë£Œ)
```

---

## ğŸ“ ì»¤ë°‹ ë©”ì‹œì§€ ê·œì¹™
```
type: ê°„ë‹¨í•œ ì„¤ëª… (vë²„ì „)

- feat: ìƒˆë¡œìš´ ê¸°ëŠ¥
- fix: ë²„ê·¸ ìˆ˜ì •
- docs: ë¬¸ì„œ ìˆ˜ì •
- style: ì½”ë“œ í¬ë§·íŒ…
- refactor: ì½”ë“œ ë¦¬íŒ©í† ë§
- perf: ì„±ëŠ¥ ê°œì„ 
- test: í…ŒìŠ¤íŠ¸ ì¶”ê°€
- chore: ë¹Œë“œ ê´€ë ¨
```

---

## ğŸ”„ ë³€ê²½ ì´ë ¥

### 2025-09-23
- CORS ì—ëŸ¬ í•´ê²° ë°©ë²• ìµœìƒë‹¨ ë°°ì¹˜
- v71.0.0 Apps Script í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¶”ê°€
- ë‘ ì²´í¬ë¦¬ìŠ¤íŠ¸ íŒŒì¼ í†µí•©

### 2025-09-22
- Apps Script v71.0.0 ì‘ì„±
- í”Œë ˆì´ì–´ ê´€ë¦¬ ë¡œì§ ë¶„ì„ ë° ë¬¸ì„œí™”

### 2025-09-18
- ì´ˆê¸° ì²´í¬ë¦¬ìŠ¤íŠ¸ ìƒì„±
- v3.4.15 ì¤‘ë³µ ê²€ì‚¬ ë¬¸ì œ í•´ê²°
- ëª¨ë°”ì¼ í‚¤íŒ¨ë“œ ë¬¸ì œ í•´ê²°

---

**âœ… ëª¨ë“  í•­ëª©ì„ ì²´í¬í•œ í›„ ìµœì¢… ë°°í¬ë¥¼ ì§„í–‰í•˜ì„¸ìš”!**

> **ì°¸ê³ **: ì´ ì²´í¬ë¦¬ìŠ¤íŠ¸ëŠ” v3.5.16 ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ í•´ë‹¹ í•­ëª©ë“¤ì„ ì¶”ê°€ë¡œ ì—…ë°ì´íŠ¸í•´ì•¼ í•©ë‹ˆë‹¤.
</file>

<file path="virtual_data_claude/README.md">
# ğŸ° Virtual Data - Poker Hand Logger

> ì‹¤ì‹œê°„ í¬ì»¤ í•¸ë“œ ê¸°ë¡ ë° ë¶„ì„ ì‹œìŠ¤í…œ v3.4.15

## ğŸŒ ì ‘ì† ë§í¬
- **GitHub ì €ì¥ì†Œ**: https://github.com/garimto81/virtual_data
- **ë¼ì´ë¸Œ ë°ëª¨**: https://garimto81.github.io/virtual_data/

## ğŸ“‹ ê°œìš”

Google Sheetsì™€ ì—°ë™ë˜ëŠ” ì›¹ ê¸°ë°˜ í¬ì»¤ í•¸ë“œ ë¡œê±°ì…ë‹ˆë‹¤. ì‹¤ì‹œê°„ìœ¼ë¡œ í”Œë ˆì´ì–´ì˜ ì•¡ì…˜, ì¹© ë³€ë™, í•¸ë“œ ê²°ê³¼ë¥¼ ê¸°ë¡í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.

### âœ¨ ì£¼ìš” ê¸°ëŠ¥
- ğŸ“Š Google Sheets ì‹¤ì‹œê°„ ì—°ë™
- ğŸ‘¥ í”Œë ˆì´ì–´ IN/OUT ìƒíƒœ ê´€ë¦¬
- ğŸ’° ìë™ íŒŸ ê³„ì‚° ë° ì¹© ì¶”ì 
- ğŸ¯ ìŠ¤íŠ¸ë¦¿ë³„ ì•¡ì…˜ ê¸°ë¡
- ğŸ“¸ ì¹´ë©”ë¼ ë²ˆí˜¸ ìë™ ê´€ë¦¬
- ğŸ† ìŠ¹ì ì„ íƒ ë° ì¹© ë¶„ë°°
- ğŸŒ êµ­ê°€ ì •ë³´ ë§¤í•‘ ì‹œìŠ¤í…œ
- ğŸš€ ìë™ ì•¡ì…˜ ë§¤í•‘ ì‹œìŠ¤í…œ (v2.13.0 ì‹ ê¸°ëŠ¥)
- âš¡ ëª¨ë°”ì¼ ìµœì í™” - í„°ì¹˜/ì œìŠ¤ì²˜/ì˜¤í”„ë¼ì¸ ì§€ì› (v3.2.0 ì‹ ê¸°ëŠ¥)

## ğŸ“ ìµœê·¼ ì—…ë°ì´íŠ¸

### v3.4.15 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ ì´ì¤‘ ì‹¤í–‰ ë¬¸ì œ ì™„ì „ í•´ê²°
- ğŸ¯ **ì§ì ‘ í˜¸ì¶œ ë°©ì‹**: ë©”ì¸ ì•±ì—ì„œ removeDuplicatePlayers(true) ì§ì ‘ í˜¸ì¶œ
- ğŸš« **ì´ì¤‘ ì‹¤í–‰ ì°¨ë‹¨**: runDuplicateCheck ì¤‘ê°„ í•¨ìˆ˜ ì œê±°ë¡œ ì™„ì „ í•´ê²°
- ğŸ“Š **í†µí•© ë¡œê·¸**: í•˜ë‚˜ì˜ ëª¨ë‹¬ì—ì„œ ì•± ì´ˆê¸°í™”ì™€ ì¤‘ë³µ ê²€ì‚¬ ìˆœì°¨ ì§„í–‰
- âœ… **UX ê°œì„ **: ì½˜ì†” ì •ë¦¬ ë° ì‚¬ìš©ì ê²½í—˜ ìµœì í™”

### v3.4.14 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ í†µí•© ì‹œë„ (ì‹¤íŒ¨)
- âŒ **ì‹¤íŒ¨**: runDuplicateCheck â†’ removeDuplicatePlayers ì´ì¤‘ í˜¸ì¶œ êµ¬ì¡° ìœ ì§€
- ğŸ” **ì›ì¸**: í˜¸ì¶œ ì²´ì¸ ë‹¨ìˆœí™” ì‹¤íŒ¨ë¡œ ê·¼ë³¸ ë¬¸ì œ ë¯¸í•´ê²°

### v3.4.13 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ ë¡œê·¸ ëª¨ë‹¬ ìŠ¤ì½”í”„ ë¬¸ì œ í•´ê²°
- ğŸ”§ **ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ**: window.openLogModal, closeLogModal, logMessage
- ğŸ“Š **ì‹¤ì‹œê°„ í‘œì‹œ**: ì¤‘ë³µ ê²€ì‚¬ ê³¼ì •ì´ ë¡œê·¸ ëª¨ë‹¬ì— í‘œì‹œë¨
- â° **ìë™ ì™„ë£Œ**: ê²€ì‚¬ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ ìë™ ë‹«ê¸°

### v3.4.12 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ ê³¼ì • ì‹œê°í™” ë° UX ê°œì„ 
- ğŸ“Š **ë¡œê·¸ ëª¨ë‹¬ ì—°ë™**: ì¤‘ë³µ ê²€ì‚¬ ê³¼ì •ì„ ë¡œê·¸ ëª¨ë‹¬ì— ì‹¤ì‹œê°„ í‘œì‹œ
- â° **ì§„í–‰ ìƒí™© í‘œì‹œ**: DuplicateRemoverì˜ ëª¨ë“  ë‹¨ê³„ê°€ íŒì—…ì— í‘œì‹œë¨
- ğŸ”„ **ìë™ ì™„ë£Œ**: ê²€ì‚¬ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ ìë™ ë‹«ê¸°
- ğŸ‘ï¸ **ê°€ì‹œì„± í–¥ìƒ**: ì‚¬ìš©ìê°€ ì¤‘ë³µ ê²€ì‚¬ ì§„í–‰ ìƒí™©ì„ ëª…í™•íˆ í™•ì¸ ê°€ëŠ¥

### v3.4.11 (2025-09-18) - ì¤‘ì•™ ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ ë²„ê·¸ ìˆ˜ì •
- ğŸ› **ì¤‘ìš” ìˆ˜ì •**: APP_VERSION ìƒìˆ˜ë¥¼ v3.4.4ì—ì„œ v3.4.11ë¡œ ì—…ë°ì´íŠ¸
- ğŸ”§ **ê·¼ë³¸ ì›ì¸**: index.html 734ë²ˆì§¸ ì¤„ì˜ í•˜ë“œì½”ë”©ëœ ë²„ì „ ë²ˆí˜¸ ë¬¸ì œ í•´ê²°
- ğŸŒ **GitHub Pages**: ì´ì œ ì˜¬ë°”ë¥¸ ë²„ì „ì´ ì›¹ì—ì„œ í‘œì‹œë¨
- ğŸ“Š **ë²„ì „ ì¼ê´€ì„±**: ëª¨ë“  ë²„ì „ ì°¸ì¡°ê°€ ë™ì¼í•˜ê²Œ í†µì¼ë¨

### v3.4.10 (2025-09-18) - GitHub ì €ì¥ì†Œ êµ¬ì¡° í†µí•© ë° ê°„ì†Œí™”
- ğŸ“ **êµ¬ì¡° ê°„ì†Œí™”**: íŒŒì¼ë“¤ì„ ë£¨íŠ¸ ë ˆë²¨ë¡œ ì´ë™ (virtual_data ì„œë¸Œí´ë” ì œê±°)
- ğŸŒ **ë‹¨ìˆœí•œ URL**: GitHub Pages ê²½ë¡œ ë‹¨ìˆœí™”
- âœ… **ê´€ë¦¬ í†µí•©**: í•˜ë‚˜ì˜ ì €ì¥ì†Œì—ì„œ ì „ì²´ ê´€ë¦¬
- ğŸš€ **ì ‘ì† í¸ì˜**: garimto81.github.io/virtual_data ë‹¨ìˆœ ê²½ë¡œ

### v3.4.9 (2025-09-18) - openCardSelector í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
- ğŸ”§ **í•¨ìˆ˜ ì ‘ê·¼ì„±**: openCardSelectorë¥¼ window ê°ì²´ì— ë“±ë¡
- âœ… **ë²„ê·¸ ìˆ˜ì •**: ReferenceError: openCardSelector is not defined í•´ê²°
- ğŸ´ **ì¹´ë“œ ì„ íƒ**: ActionOrderManagerì—ì„œ ì¹´ë“œ ì„ íƒ UI ì •ìƒ í˜¸ì¶œ

### v3.4.8 (2025-09-18) - JavaScript íŒŒì¼ ê²½ë¡œ ë²„ê·¸ ìˆ˜ì •
- ğŸ”§ **ê²½ë¡œ ìˆ˜ì •**: archive í´ë”ì˜ JavaScript íŒŒì¼ ê²½ë¡œ ìˆ˜ì •
- âœ… **404 ì—ëŸ¬ í•´ê²°**: ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ì •ìƒ ë¡œë“œ
- ğŸ“ **íŒŒì¼ êµ¬ì¡°**: chip-analysis, table-management ë“± archive í´ë” ê²½ë¡œ ë°˜ì˜

### v3.4.7 (2025-09-18) - í…ìŠ¤íŠ¸ ì¹´ë“œ ì…ë ¥ UI ì™„ì „ ì œê±°
- ğŸ´ **ì¹´ë“œ ì…ë ¥ í†µí•©**: í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì™„ì „ ì œê±°, ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒê¸°ë¡œ ì¼ì›í™”
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**: showFeedback í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
- â™ ï¸ **ì¼ê´€ëœ UX**: ëª¨ë“  ì¹´ë“œ ì…ë ¥ì´ ë™ì¼í•œ ë¹„ì£¼ì–¼ ì„ íƒ UI ì‚¬ìš©
- ğŸš« **ë ˆê±°ì‹œ ì œê±°**: promptForBoardCardsê°€ openCardSelector í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½
- âœ… **ì½”ë“œ ì •ë¦¬**: saveBoardCards, skipBoardCards í•¨ìˆ˜ ê°„ì†Œí™”

### v3.4.6 (2025-09-18) - ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì‚¬ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- ğŸš€ **ë°±ê·¸ë¼ìš´ë“œ ê²€ì‚¬**: UI ì°¨ë‹¨ ì—†ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¡°ìš©íˆ ì‹¤í–‰
- ğŸ“ **ë©”ì‹œì§€ ê°„ì†Œí™”**: ì½˜ì†” ë¡œê·¸ ìœ„ì£¼ë¡œ ë³€ê²½, ì‚¬ìš©ì ë°©í•´ ìµœì†Œí™”
- âš¡ **ë¹ ë¥¸ ì‹¤í–‰**: í˜ì´ì§€ ë¡œë“œ í›„ ì¦‰ì‹œ ì‘ë™, ê²°ê³¼ë§Œ ì§§ê²Œ ì•Œë¦¼
- âœ… **ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼**: ì¤‘ìš”í•œ ê²°ê³¼(ì‚­ì œ/ì˜¤ë¥˜)ë§Œ 2ì´ˆ ìŠ¤ë‚µë°”ë¡œ í‘œì‹œ
- ğŸ”‡ **ì¡°ìš©í•œ ì´ˆê¸°í™”**: "ì¤‘ë³µ ê²€ì‚¬ ì¤‘" ë©”ì‹œì§€ ì œê±°ë¡œ ì‚¬ìš©ì í¸ì˜ì„± ì¦ëŒ€

### v3.4.5 (2025-09-18) - ì¹´ë“œ ì…ë ¥ ì‹œìŠ¤í…œ í†µí•© ë° ê°œì„ 
- ğŸ¯ **ì¹´ë“œ ì…ë ¥ í†µì¼**: í…ìŠ¤íŠ¸ ì…ë ¥ ì œê±°, ë¹„ì£¼ì–¼ ì„ íƒ UIë¡œ ì™„ì „ í†µì¼
- â© **ìŠ¤ë§ˆíŠ¸ ìŠ¤í‚µ**: ì´ë¯¸ ì…ë ¥ëœ ì¹´ë“œê°€ ìˆìœ¼ë©´ í•´ë‹¹ ìŠ¤íŠ¸ë¦¿ ìë™ ìŠ¤í‚µ
- âœï¸ **ì¹´ë“œ ìˆ˜ì •**: ì…ë ¥ëœ ì¹´ë“œ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€
- âœ“ **ìƒíƒœ í‘œì‹œ**: ìŠ¤íŠ¸ë¦¿ ë²„íŠ¼ì— ì¹´ë“œ ì…ë ¥ ì™„ë£Œ ìƒíƒœ ì‹œê°í™”

### v3.4.4 (2025-09-18) - ì¤‘ë³µ í•„í„°ë§ ì™„ì „ ì œê±°ë¡œ ê·¼ë³¸ í•´ê²°
- ğŸ¯ **í•µì‹¬ í•´ê²°**: CSV ë¡œë”© ì‹œ ì¤‘ë³µ í•„í„°ë§ì„ ì™„ì „íˆ ì œê±°í•˜ì—¬ ëª¨ë“  ì¤‘ë³µ ë°ì´í„°ë¥¼ ë¡œì»¬ì— ìœ ì§€
- ğŸ”§ **buildTypeFromCsv ìˆ˜ì •**: ì¤‘ë³µ ê²€ì‚¬ ë¡œì§ ì œê±°, ëª¨ë“  í”Œë ˆì´ì–´ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€
- ğŸ“Š **ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œ ë…ë¦½**: ë°ì´í„° ë¡œë”©ê³¼ ì¤‘ë³µ ì œê±°ë¥¼ ì™„ì „íˆ ë¶„ë¦¬
- ğŸ” **ì •í™•í•œ ì¤‘ë³µ ê²€ì¶œ**: ì´ì œ ì‹¤ì œ ì¤‘ë³µ ë°ì´í„°ê°€ ë¡œì»¬ì— ìœ ì§€ë˜ì–´ ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™
- âš¡ **ê·¼ë³¸ ì›ì¸ í•´ê²°**: ë°ì´í„° ë¡œë”© ì‹œì ê³¼ ì¤‘ë³µ ì œê±° ì‹œì ì˜ ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°

### v3.4.3 (2025-09-18) - ë¡œì»¬ ì¤‘ë³µ ê²€ì¶œ ì‹œ ì‹¤ì œ ì‚­ì œ ì²˜ë¦¬ (ì‹¤íŒ¨)
- âŒ **ì‹¤íŒ¨**: ë¡œì»¬ ë°ì´í„°ì— ì´ë¯¸ ì¤‘ë³µì´ ì—†ì–´ì„œ ê²€ì¶œ ë¶ˆê°€
- ğŸ”§ **ì‹œë„**: buildTypeFromCsvì—ì„œ ì˜ëª»ëœ ì¤‘ë³µ í•„í„°ë§ ìˆ˜ì •
- ğŸ“Š **ë¬¸ì œ**: table+name+seat ê¸°ì¤€ ì²´í¬ë¡œë„ ì—¬ì „íˆ ë¡œë”© ì‹œì ì—ì„œ í•„í„°ë§ ë°œìƒ
- ğŸ” **ì§„ë‹¨**: ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œ ì‹¤í–‰ ì‹œì ì—ëŠ” ì´ë¯¸ ì¤‘ë³µì´ ì œê±°ëœ ìƒíƒœ

### v3.3.7 (2025-09-18) - Google Sheets ì›ë³¸ ë°ì´í„° ì§ì ‘ ì ‘ê·¼
- ğŸ¯ **ì›ë³¸ ë°ì´í„° ì ‘ê·¼**: ê°€ê³µëœ ë¡œì»¬ ë°ì´í„°ê°€ ì•„ë‹Œ Google Sheets ì›ë³¸ ë°ì´í„° ì§ì ‘ ê°€ì ¸ì˜¤ê¸°
- ğŸ” **ì§„ì§œ ì¤‘ë³µ ê²€ì¶œ**: santa, Villain02, wolfking ë“± ì‹¤ì œ ì¤‘ë³µ í”Œë ˆì´ì–´ ì •í™•íˆ ì°¾ê¸°
- âš¡ **getAllPlayers API**: Apps Scriptë¥¼ í†µí•´ ì‹œíŠ¸ì˜ ëª¨ë“  í”Œë ˆì´ì–´ ë°ì´í„° ìš”ì²­
- ğŸ› **ê·¼ë³¸ ë¬¸ì œ í•´ê²°**: ë¡œì»¬ ë°ì´í„°ëŠ” ì´ë¯¸ ì¤‘ë³µ ì œê±°ëœ ìƒíƒœë¼ì„œ ê²€ì¶œ ë¶ˆê°€ëŠ¥í–ˆìŒ

### v3.3.6 (2025-09-18) - ì¢Œì„ ì—†ëŠ” ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì¶œ ë¡œì§ ê°œì„ 
- ğŸ¯ **ì§„ì§œ ì¤‘ë³µ ë°œê²¬**: ì¢Œì„ì´ ìë™ í• ë‹¹ëœ ì¤‘ë³µ í”Œë ˆì´ì–´ ì •í™•íˆ ê²€ì¶œ
- ğŸ” **ì´ì¤‘ ê²€ì‚¬ ë°©ì‹**: ì¢Œì„ ìœ ë¬´ì— ë”°ë¥¸ ì°¨ë³„í™”ëœ ì¤‘ë³µ ê²€ì‚¬
- âš¡ **ì‹¤ì œ ë°ì´í„° ë¶„ì„**: ì›ë³¸ ë°ì´í„°ì™€ ê°€ê³µëœ ë°ì´í„° êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬
- ğŸ› **123ëª… vs 144ëª… ë¬¸ì œ í•´ê²°**: ì‹¤ì œ ì¤‘ë³µ ì œê±°ë¡œ ì •í™•í•œ ë°ì´í„° í™•ë³´

### v3.3.5 (2025-09-18) - ì¤‘ë³µ í”Œë ˆì´ì–´ ë°ì´í„° ë¡œë”© ë¡œì§ ê°œì„ 
- ğŸ” **ë°ì´í„° ì†ŒìŠ¤ ë¶„ì„**: ëª¨ë“  ê°€ëŠ¥í•œ í”Œë ˆì´ì–´ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
- ğŸ“Š **ì™„ì „í•œ ë°ì´í„° ìˆ˜ì§‘**: ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ëˆ„ë½ëœ í”Œë ˆì´ì–´ ë°ì´í„° ì·¨í•©
- ğŸ› **123ëª… vs 144ëª… ë¶ˆì¼ì¹˜ í•´ê²°**: ì „ì²´ í”Œë ˆì´ì–´ ë°ì´í„° ì •í™•íˆ ë¡œë“œ
- ğŸ“ **ìƒì„¸ ë””ë²„ê¹…**: ê° ë°ì´í„° ì†ŒìŠ¤ë³„ í”Œë ˆì´ì–´ ìˆ˜ ì¶œë ¥

### v3.3.4 (2025-09-18) - ì¤‘ë³µ í”Œë ˆì´ì–´ ì œê±° ëª¨ë“ˆ êµ¬ë¬¸ ì˜¤ë¥˜ ìˆ˜ì •
- ğŸ› **êµ¬ë¬¸ ì˜¤ë¥˜ ìˆ˜ì •**: duplicate-remover.js 101ë²ˆì§¸ ì¤„ êµ¬ë¬¸ ì˜¤ë¥˜ í•´ê²°
- ğŸ”§ **ëª¨ë“ˆ ì•ˆì •ì„±**: ì¤‘ë³µ ì œê±° ë¡œì§ ì •ìƒ ì‹¤í–‰ ë³´ì¥
- ğŸ§¹ **ìë™ ì‹¤í–‰**: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìë™ ì œê±°
- ğŸ“ **í…ŒìŠ¤íŠ¸ ê°•í™”**: quick_test.jsì— ì¤‘ë³µ ì œê±° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì¶”ê°€

### v3.3.3 (2025-09-17) - ìœ ì—°í•œ ì¹© ì²˜ë¦¬ ì‹œìŠ¤í…œ
- ğŸ’° **ì¹© ì´ˆê³¼ í—ˆìš©**: ë³´ìœ  ì¹©ë³´ë‹¤ ë§ì€ ë² íŒ…ë„ ê°€ëŠ¥ (ê²½ê³ ë§Œ í‘œì‹œ)
- ğŸ”´ **ë§ˆì´ë„ˆìŠ¤ ì¹©**: ìŒìˆ˜ ì¹© ìƒíƒœ í—ˆìš© ë° ì‹œê°ì  í‘œì‹œ (ë¹¨ê°„ìƒ‰)
- ğŸ¯ **ìˆ˜ë™ ì¡°ì • ê°€ëŠ¥**: ì¹© ìˆ˜ì • ê¸°ëŠ¥ìœ¼ë¡œ ì–¸ì œë“  ì¡°ì • ê°€ëŠ¥
- âš ï¸ **ê²½ê³  ì‹œìŠ¤í…œ**: ì¹© ì´ˆê³¼/ë§ˆì´ë„ˆìŠ¤ ì‹œ ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ì§„í–‰

### v3.3.2 (2025-09-17) - ì¹© ì´ˆê³¼ ë² íŒ… ë°©ì§€ ì‹œìŠ¤í…œ (deprecated)
- ~~ë² íŒ… ì°¨ë‹¨~~: v3.3.3ì—ì„œ ì œê±°ë¨

### v3.3.1 (2025-09-17) - ì¹© ì´ˆê³¼ ë² íŒ… ìë™ ì˜¬ì¸ ì²˜ë¦¬ (deprecated)
- ~~ìë™ ì˜¬ì¸ ë³€í™˜~~: v3.3.2ì—ì„œ ì œê±°ë¨

### v3.3.0 (2025-09-17) - ì¹© ìˆ˜ì • ì‹œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìƒì„± ë¬¸ì œ í•´ê²°
- ğŸ”§ **updatePlayerChips ê°œì„ **: ê¸°ì¡´ í”Œë ˆì´ì–´ ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” ë¡œì§ êµ¬í˜„
- ğŸ§¹ **ìë™ ì¤‘ë³µ ì œê±°**: ì¹© ìˆ˜ì • ì‹œì—ë„ ì¤‘ë³µ ì œê±° ë¡œì§ ìë™ ì‹¤í–‰
- ğŸ“¦ **Apps Script v65**: ì¹© ìˆ˜ì • ê´€ë ¨ ëª¨ë“  ì¤‘ë³µ ë¬¸ì œ í•´ê²°
- âœ… **ë¬¸ì œ í•´ê²°**: ì¹© ìˆ˜ì •ìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìƒì„± ì™„ì „ ë°©ì§€

### v3.2.9 (2025-09-17) - ì¤‘ë³µ ì œê±° ì•„í‚¤í…ì²˜ ê°œì„ 
- ğŸ—‘ï¸ **ë³„ë„ ë²„íŠ¼ ì œê±°**: ì¤‘ë³µ ì œê±° ë²„íŠ¼ì„ ì‚­ì œí•˜ê³  ìë™ ì²˜ë¦¬ë¡œ ë³€ê²½
- âš¡ **ì¼ê´„ ë“±ë¡ í†µí•©**: ì¼ê´„ ë“±ë¡ ì‹œ ë§ˆì§€ë§‰ì— ì¤‘ë³µ ì œê±° ìë™ ì‹¤í–‰
- ğŸ“¦ **Apps Script v64**: ì¤‘ë³µ ì œê±° ë¡œì§ì„ batchUpdatePlayers ëì—ì„œ ì‹¤í–‰
- ğŸ”„ **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **: ë³„ë„ ì•¡ì…˜ ì—†ì´ ìë™ìœ¼ë¡œ ì¤‘ë³µ ì²˜ë¦¬

### v3.2.8 (2025-09-17) - ì¤‘ë³µ í”Œë ˆì´ì–´ ê°ì§€ ë° ì œê±° ì‹œìŠ¤í…œ
- ğŸ§¹ **ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œ**: Apps Script v63ì— removeDuplicatePlayers() í•¨ìˆ˜ ì¶”ê°€
- ğŸ”„ **ìë™ ì¤‘ë³µ ì œê±°**: í”Œë ˆì´ì–´ ì¶”ê°€/ìˆ˜ì • ì‹œ ìë™ìœ¼ë¡œ ì¤‘ë³µ ê°ì§€ ë° ì œê±°
- ğŸ› ï¸ **í”„ë¡ íŠ¸ì—”ë“œ ì¤‘ë³µ ì œê±°**: ê´€ë¦¬ ëª¨ë‹¬ì— ì¤‘ë³µ ì œê±° ë²„íŠ¼ ì¶”ê°€
- ğŸš« **ìë™ ë“±ë¡ ì œê±°**: ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ìë™ í”Œë ˆì´ì–´ ë“±ë¡ ë¡œì§ ë¹„í™œì„±í™”
- ğŸ” **ê°•í™”ëœ ê²€ì¦**: í…Œì´ë¸”_í”Œë ˆì´ì–´ ì¡°í•©ìœ¼ë¡œ ì •í™•í•œ ì¤‘ë³µ ê°ì§€

### v3.2.7 (2025-09-17) - Apps Script ì‚­ì œ ë¡œì§ ê°•í™”
- ğŸ” **ì‚­ì œ ë””ë²„ê¹… ê°•í™”**: Apps Scriptì— ìƒì„¸ ë¡œê·¸ ë° ë””ë²„ê¹… ì •ë³´ ì¶”ê°€
- ğŸ› ï¸ **ì‚­ì œ ì¡°ê±´ ì™„í™”**: STATUS ì¡°ê±´ ì œê±°ë¡œ ì‚­ì œ ì²˜ë¦¬ ê°œì„ 
- ğŸ› **ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ **: ìƒì„¸í•œ ì˜¤ë¥˜ ì •ë³´ì™€ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì œê³µ
- ğŸ“Š **FormData ë¡œê¹…**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì „ì†¡ë˜ëŠ” ë°ì´í„° ìƒì„¸ í™•ì¸

### v3.2.6 (2025-09-17) - ì‹œíŠ¸ ì •ë ¬ ë° ì‚­ì œ ë¡œì§ ê°œì„ 
- ğŸ”„ **ì‹œíŠ¸ ì •ë ¬ ë²„íŠ¼ ì œê±°**: ì¼ê´„ ë“±ë¡ ì‹œì—ë§Œ ìë™ ì •ë ¬
- ğŸš® **ì‚­ì œ ë¡œì§ ê°œì„ **: í”Œë ˆì´ì–´ ì‚­ì œ ì²˜ë¦¬ ë²„ê·¸ ìˆ˜ì •
- ğŸ› ï¸ **Apps Script ìµœì í™”**: sortSheet ì´ì¤‘ í˜¸ì¶œ ë²„ê·¸ ìˆ˜ì •
- ğŸ” **ë””ë²„ê·¸ ë¡œê·¸ í†µì¼**: ëª¨ë“  ì½˜ì†” ë¡œê·¸ v3.2.6ìœ¼ë¡œ í†µì¼

### v3.2.5 (2025-09-17) - ì •ë ¬ ê¸°ì¤€ ìµœì í™”
- ğŸ¯ **ì •ë ¬ ê¸°ì¤€ ë‹¨ìˆœí™”**: Table(í…Œì´ë¸”ëª…) > Seat(ì¢Œì„ë²ˆí˜¸) ìˆœ
- ğŸ“¦ **í…Œì´ë¸”ë³„ ê·¸ë£¹í•‘**: ê°™ì€ í…Œì´ë¸” í”Œë ˆì´ì–´ë“¤ì´ í•¨ê»˜ í‘œì‹œ
- ğŸ”¢ **ì¢Œì„ ìˆœì„œ ë³´ì¥**: ì¢Œì„ ë²ˆí˜¸ìˆœìœ¼ë¡œ ì •ë ¬

### v3.2.4 (2025-09-17) - Google Sheets ìë™ ì •ë ¬
- ğŸ”„ **ì‹œíŠ¸ ìë™ ì •ë ¬**: ì¼ê´„ ë“±ë¡ ì‹œ ìë™ìœ¼ë¡œ ì‹œíŠ¸ ì •ë ¬
- ğŸ†• **ì •ë ¬ ë²„íŠ¼ ì¶”ê°€**: ë³„ë„ë¡œ ì‹œíŠ¸ë§Œ ì •ë ¬ ê°€ëŠ¥
- ğŸ“Š **Apps Script ì—…ë°ì´íŠ¸**: sortTypeSheet í•¨ìˆ˜ ì¶”ê°€

### v3.2.3 (2025-09-17) - ë””ë²„ê·µ ë° ì•ˆì •ì„± ê°œì„ 
- ğŸ” **ë””ë²„ê·µ ë¡œê·¸ ê°œì„ **: ëª¨ë“  ë¡œê·¸ë¥¼ v3.2.3ìœ¼ë¡œ í†µì¼
- ğŸ”„ **ìºì‹œ ë²„ìŠ¤íŒ… ê°•í™”**: ëª¨ë“  JS íŒŒì¼ ë²„ì „ í†µì¼
- ğŸ¤ **BatchProcessor ì œê±°**: ì¼ê´„ ë“±ë¡ ì‹œ ì§ì ‘ ì„œë²„ í†µì‹ 
- ğŸ“Š **Google Sheets ë™ê¸°í™” ë¬¸ì œ ë¶„ì„**

### v3.2.2 (2025-09-17) - ì„±ëŠ¥ ìµœì í™”
- ğŸš€ **ì‚­ì œ ë¡œì§ ìµœì í™”**: ë¡œì»¬ ì „ìš© ì‚­ì œë¡œ ì¦‰ì‹œ ì²˜ë¦¬
- ğŸ”„ **ì„œë²„ ë™ê¸°í™” ê°œì„ **: ì¼ê´„ ë“±ë¡ ì‹œì—ë§Œ ì„œë²„ í†µì‹ 
- ğŸ’¡ **UI í”¼ë“œë°± ê°•í™”**: ë¯¸ë“±ë¡ ë³€ê²½ì‚¬í•­ ëª…í™•í•œ í‘œì‹œ
- âš¡ **ì—°ì† ì‚­ì œ ì„±ëŠ¥**: ë‹¤ìˆ˜ ì‚­ì œ ì‘ì—… ì‹œ ì§€ì—° ì—†ì´ ì²˜ë¦¬

### v3.2.1 (2025-09-17) - ë²„ê·¸ ìˆ˜ì •
- ğŸ› **í”Œë ˆì´ì–´ ì‚­ì œ ë¡œì§ ìˆ˜ì •**: ê´€ë¦¬ ì„¤ì •ì—ì„œ í”Œë ˆì´ì–´ ì‚­ì œ ê¸°ëŠ¥ ë³µêµ¬
- ğŸ”§ **í•¨ìˆ˜ í˜¸ì¶œ ìˆœì„œ ê°œì„ **: onManagementTableSelected ìš°ì„  í˜¸ì¶œ
- âš¡ **ì´ë²¤íŠ¸ ì²˜ë¦¬ ìµœì í™”**: ì¸ë¼ì¸ onclickìœ¼ë¡œ ì‚­ì œ ë²„íŠ¼ ì§ì ‘ ì²˜ë¦¬

### v3.2.0 (2025-09-17) - Phase 3: ëª¨ë°”ì¼ ìµœì í™” ì™„ì„±
- âœ… **í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤**: 44x44px ìµœì†Œ í¬ê¸°, í„°ì¹˜ ì‘ë‹µ ì‹œê°„ < 50ms
- âœ… **ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜**: ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ë¡œ ì‹¤í–‰ì·¨ì†Œ
- âœ… **ë¡±í”„ë ˆìŠ¤ ë©”ë‰´**: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì‹œìŠ¤í…œ (500ms ì§€ì—°)
- âœ… **í–…í‹± í”¼ë“œë°±**: ì§„ë™ APIë¡œ í„°ì¹˜ í”¼ë“œë°± ì œê³µ
- âœ… **ê°€ìƒ ìŠ¤í¬ë¡¤**: 1000ê°œ+ ë¦¬ìŠ¤íŠ¸ ì„±ëŠ¥ ìµœì í™”
- âœ… **ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ**: IndexedDB ê¸°ë°˜ ë¡œì»¬ ì €ì¥
- âœ… **ìë™ ë™ê¸°í™”**: ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ ìë™ ë°ì´í„° ë™ê¸°í™”
- âœ… **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë° ìë™ ì •ë¦¬

### v3.1.0 (2025-01-17) - Phase 2: ê¸°ëŠ¥ë³„ ì¦‰ì‹œ ì‹¤í–‰
- âœ… **ë”ë¸”íƒ­ ì‹œìŠ¤í…œ**: ìœ„í—˜í•œ ì‘ì—… ë³´í˜¸ (2ì´ˆ íƒ€ì´ë¨¸)
- âœ… **íŠ¸ëœì­ì…˜ ë°°ì¹˜**: ì¼ê´„ ì‘ì—… ì›ìì„± ë³´ì¥
- âœ… **ìë™ ë¡¤ë°±**: ì‹¤íŒ¨ ì‹œ ëª¨ë“  ì‘ì—… ìë™ ë³µì›
- âœ… **API ìµœì í™”**: ë°°ì¹˜ í˜¸ì¶œë¡œ ì„±ëŠ¥ í–¥ìƒ
- âœ… **íƒ€ì´ë¨¸ ê´€ë¦¬**: ì¶©ëŒ ë°©ì§€ ì‹œìŠ¤í…œ

### v3.0.0 (2025-01-17) - ëª¨ë°”ì¼ ìµœì í™” Phase 1
- âœ… **confirm íŒì—… ì œê±°**: ëª¨ë“  ì‘ì—… ì¦‰ì‹œ ì‹¤í–‰
- âœ… **ActionHistory ì‹œìŠ¤í…œ**: ì‘ì—… ì´ë ¥ ê´€ë¦¬ ë° ì‹¤í–‰ì·¨ì†Œ
- âœ… **ìŠ¤ë‚µë°” UI**: ëª¨ë°”ì¼ ì¹œí™”ì  í”¼ë“œë°± ì‹œìŠ¤í…œ
- âœ… **ë©”ëª¨ë¦¬ ìµœì í™”**: íˆìŠ¤í† ë¦¬ 20ê°œ ì œí•œ, WeakMap ì‚¬ìš©
- âœ… **ë¹ ë¥¸ ì‘ë‹µ**: ëª¨ë“  ì‘ì—… 200ms ì´ë‚´ ì™„ë£Œ

### v2.29.0 (2025-09-16)
- 10ê°œ ì‹œíŠ¸ ê³ ì • í”Œë ˆì´ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ
- ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°
- í¬ì»¤ í¬ì§€ì…˜ ìˆœì„œëŒ€ë¡œ ìë™ í”Œë ˆì´ì–´ ì§„í–‰

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. Google Sheets ì„¤ì •
```bash
1. í…œí”Œë¦¿ ì‹œíŠ¸ ë³µì‚¬
2. Apps Script ì—´ê¸° (í™•ì¥ í”„ë¡œê·¸ë¨ â†’ Apps Script)
3. Code_v63_InOut.gs ë¶™ì—¬ë„£ê¸°
4. ì›¹ ì•±ìœ¼ë¡œ ë°°í¬
```

### 2. í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •
```javascript
// ì„¤ì •(âš™ï¸) ë©”ë‰´ì—ì„œ Apps Script URL ì…ë ¥
// ë˜ëŠ” index.htmlì—ì„œ ì§ì ‘ ì„¤ì •
const APPS_SCRIPT_URL = 'YOUR_DEPLOYMENT_URL';
```

### 3. ì‹¤í–‰
```bash
# Live Server ë˜ëŠ”
python -m http.server 8000
```

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

- **Frontend**: Vanilla JavaScript, Tailwind CSS
- **Backend**: Google Apps Script v63
- **Database**: Google Sheets
- **API**: Gemini Vision API (ì¹© ë¶„ì„)

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
virtual_data/
â”œâ”€â”€ index.html                    # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ (v3.2.5)
â”œâ”€â”€ action-history.js             # ActionHistory ì‹œìŠ¤í…œ (Phase 1)
â”œâ”€â”€ double-tap-handler.js         # ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ (Phase 2)
â”œâ”€â”€ batch-processor.js            # ë°°ì¹˜ ì²˜ë¦¬ ì‹œìŠ¤í…œ (Phase 2)
â”œâ”€â”€ mobile-optimizer.js           # ëª¨ë°”ì¼ ìµœì í™” (Phase 3)
â”œâ”€â”€ virtual-scroll.js             # ê°€ìƒ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ (Phase 3)
â”œâ”€â”€ offline-storage.js            # ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ (Phase 3)
â”œâ”€â”€ chip-analysis-module.js       # ì¹© ë¶„ì„ ëª¨ë“ˆ
â”œâ”€â”€ table-management-v59.js       # í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“ˆ
â”œâ”€â”€ apps-script/
â”‚   â””â”€â”€ Code_v63_InOut.gs        # Google Apps Script ë°±ì—”ë“œ
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DEVELOPMENT.md           # ê°œë°œ ê³„íš
â”‚   â”œâ”€â”€ MOBILE_POPUP_REMOVAL_PLAN.md  # ëª¨ë°”ì¼ ìµœì í™” ê³„íš
â”‚   â””â”€â”€ fix.md                   # ì•Œë ¤ì§„ ì´ìŠˆ ëª©ë¡
â””â”€â”€ README.md                     # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

## ğŸ“Š Google Sheets êµ¬ì¡°

### Type ì‹œíŠ¸ (í”Œë ˆì´ì–´ ê´€ë¦¬)
| ì—´ | í•„ë“œ | ì„¤ëª… |
|---|---|---|
| A | Camera Preset | ì¹´ë©”ë¼ í”„ë¦¬ì…‹ |
| B | Player | í”Œë ˆì´ì–´ ì´ë¦„ |
| C | Table | í…Œì´ë¸” ì´ë¦„ |
| D | Notable | ì£¼ëª©í•  í”Œë ˆì´ì–´ |
| E | Chips | í˜„ì¬ ì¹© |
| F | UpdatedAt | ì—…ë°ì´íŠ¸ ì‹œê°„ |
| G | Seat | ì¢Œì„ ë²ˆí˜¸ |
| H | Status | IN/OUT ìƒíƒœ |
| I | pic | í”„ë¡œí•„ ì‚¬ì§„ |
| J | Country | êµ­ê°€ |
| K | CountryVerified | êµ­ê°€ í™•ì¸ ì—¬ë¶€ |

### Index ì‹œíŠ¸ (í•¸ë“œ ë©”íƒ€ë°ì´í„°)
| ì—´ | í•„ë“œ | ì„¤ëª… |
|---|---|---|
| A | handNumber | í•¸ë“œ ë²ˆí˜¸ |
| B | startRow | Hand ì‹œíŠ¸ ì‹œì‘ í–‰ |
| C | endRow | Hand ì‹œíŠ¸ ì¢…ë£Œ í–‰ |
| D | handUpdatedAt | í•¸ë“œ ì—…ë°ì´íŠ¸ ì‹œê°„ |
| E-F | handEdit | í¸ì§‘ ì •ë³´ |
| G | label | ê²Œì„ ë ˆì´ë¸” |
| H | table | í…Œì´ë¸” ì´ë¦„ |
| I | tableUpdatedAt | í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œê°„ |
| J-N | Camera | ì¹´ë©”ë¼ ì •ë³´ |
| O-Q | Street/Action | ë§ˆì§€ë§‰ ìŠ¤íŠ¸ë¦¬íŠ¸/ì•¡ì…˜ |
| R | winners | ìŠ¹ì ì •ë³´ |

### Hand ì‹œíŠ¸ (ìƒì„¸ ê¸°ë¡)
| ì—´ | í•„ë“œ | ì„¤ëª… |
|---|---|---|
| A | í–‰ë²ˆí˜¸ | ìˆœë²ˆ |
| B | íƒ€ì… | HAND/PLAYER/EVENT |
| C | ë°ì´í„° | í”Œë ˆì´ì–´ëª…/ì•¡ì…˜ |
| D | ì¢Œì„ | ì¢Œì„ ë²ˆí˜¸ |
| E | 0 | ê³ ì •ê°’ |
| F | ì‹œì‘ì¹© | ì‹œì‘ ì¹© |
| G | ì¢…ë£Œì¹© | ì¢…ë£Œ ì¹© |
| H | ì¹´ë“œ | í•¸ë“œ ì¹´ë“œ |
| I | í¬ì§€ì…˜ | BTN/SB/BB |

## ğŸ”„ ìµœê·¼ ì—…ë°ì´íŠ¸

### v2.26.2 (2025-09-16)
- âš¡ **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **
  - ìˆ«ì ì…ë ¥(í‚¤íŒ¨ë“œ) ì˜¤ë¥˜ ìˆ˜ì •: ë² íŒ…/ë ˆì´ì¦ˆ ì‹œ í‚¤íŒ¨ë“œ ì •ìƒ ì‘ë™
  - ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ë°”ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°: ì•¡ì…˜ ë²„íŠ¼ í´ë¦­ ì—†ì´ ìŠ¤íŠ¸ë¦¿ë§Œ ì„ íƒí•˜ë©´ ì¦‰ì‹œ ì•¡ì…˜ ì…ë ¥ ê°€ëŠ¥
  - actionPadCurrentAction ì„¤ì • ë¡œì§ ì¶”ê°€ë¡œ ë² íŒ…/ë ˆì´ì¦ˆ êµ¬ë¶„ ì •ìƒ ì‘ë™

### v2.26.1 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - updateSmartCheckCallButton í•¨ìˆ˜ ì •ì˜ ì˜¤ë¥˜ ìˆ˜ì •
  - addActionToLog í•¨ìˆ˜ null ì²´í¬ ì˜¤ë¥˜ ìˆ˜ì •
  - ì•¡ì…˜ íŒ¨ë“œ ì‹œìŠ¤í…œ ì•ˆì •ì„± ê°œì„ 

### v2.26.0 (2025-09-16)
- ğŸš€ **í¬ì§€ì…˜ ê¸°ë°˜ ì•¡ì…˜ ìˆœì„œ ì‹œìŠ¤í…œ êµ¬í˜„**
  - í¬ì»¤ ê·œì¹™ì— ë”°ë¥¸ ìë™ ì•¡ì…˜ ìˆœì„œ ê³„ì‚° (í”„ë¦¬í”Œë: UTGâ†’BTNâ†’SBâ†’BB, í¬ìŠ¤íŠ¸í”Œë: SBâ†’BBâ†’UTGâ†’BTN)
  - ğŸ¤– ìë™ ëª¨ë“œ: ì•¡ì…˜ ìˆœì„œì— ë”°ë¼ ìë™ìœ¼ë¡œ ë‹¤ìŒ í”Œë ˆì´ì–´ í™œì„±í™”
  - ğŸ‘† ìˆ˜ë™ ëª¨ë“œ: ì‚¬ìš©ìê°€ ì§ì ‘ í”Œë ˆì´ì–´ ì„ íƒí•˜ì—¬ ì•¡ì…˜ ì…ë ¥
  - ì•¡ì…˜ í ì‹œê°í™”: í˜„ì¬ ì°¨ë¡€(ğŸ¯), ì™„ë£Œ(âœ…), ëŒ€ê¸°(â³) ìƒíƒœ í‘œì‹œ
  - ìŠ¤ë§ˆíŠ¸ ìŠ¤íŠ¸ë¦¿ ì§„í–‰: ë² íŒ… ë¼ìš´ë“œ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ í™œì„±í™”
  - í”Œë ˆì´ì–´ ìŠ¤í‚µ ê¸°ëŠ¥: íŠ¹ì • í”Œë ˆì´ì–´ ê±´ë„ˆë›°ê¸° ê°€ëŠ¥
  - ì•¡ì…˜ ëª¨ë“œ ì‹¤ì‹œê°„ ì „í™˜: ì–¸ì œë“ ì§€ ìë™/ìˆ˜ë™ ëª¨ë“œ ë³€ê²½ ê°€ëŠ¥

### v2.25.3 (2025-09-16)
- ğŸ¯ **í…Œì´ë¸” ì„ íƒ ì›Œí¬í”Œë¡œìš° ìµœì í™”**
  - ê´€ë¦¬ ë²„íŠ¼ì—ì„œ "ğŸ“‹ í…Œì´ë¸” ê´€ë¦¬" â†’ "ğŸ¯ í…Œì´ë¸” ì„ íƒ"ìœ¼ë¡œ ë³€ê²½
  - ì¤‘ê°„ í…Œì´ë¸” ì„ íƒ ë‹¨ê³„ ì œê±°ë¡œ ì§ê´€ì ì¸ ì‚¬ìš©ì ê²½í—˜ ì œê³µ
  - í…Œì´ë¸” ì„ íƒ í›„ ë°”ë¡œ í”Œë ˆì´ì–´ ê´€ë¦¬ í™”ë©´ í‘œì‹œ
  - ì„ íƒëœ í…Œì´ë¸” ì •ë³´ í•­ìƒ í‘œì‹œ + "ë³€ê²½" ë²„íŠ¼ìœ¼ë¡œ ì¬ì„ íƒ ê°€ëŠ¥
  - ë©”ì¸ ëŒ€ì‹œë³´ë“œì™€ ë™ì¼í•œ í…Œì´ë¸” ì„ íƒ ë¡œì§ ì‚¬ìš©

### v2.25.2 (2025-09-16)
- ğŸ”§ **SB/BB í‘œì‹œ ë²„ê·¸ ìˆ˜ì •**
  - SB/BB ë²„íŠ¼ì—ì„œ "SB:", "BB:" í…ìŠ¤íŠ¸ ë¼ë²¨ ì œê±°
  - ì‹¤ì œ ìˆ˜ì¹˜ë§Œ í‘œì‹œí•˜ë„ë¡ ê°œì„  (ì˜ˆ: "100" ëŒ€ì‹  "SB: 100")
  - data-purpose ì†ì„± ì¶”ê°€ë¡œ ë²„íŠ¼ ì—…ë°ì´íŠ¸ ë¡œì§ ìˆ˜ì •
  - ì´ˆê¸°í™” ì‹œ ì €ì¥ëœ SB/BB ê°’ ì •ìƒ í‘œì‹œ
  - updateBlindButtons() í•¨ìˆ˜ë¡œ ë²„íŠ¼ ìƒíƒœ ê´€ë¦¬ í†µí•©

### v2.25.1 (2025-09-16)
- ğŸš€ **í…Œì´ë¸” ê´€ë¦¬ ì›Œí¬í”Œë¡œìš° ë‹¨ì¶•**
  - í…Œì´ë¸” ê´€ë¦¬ ë²„íŠ¼ í´ë¦­ ì‹œ ë°”ë¡œ í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ ì‹¤í–‰
  - ì¤‘ê°„ ë‹¨ê³„ ì œê±°ë¡œ ë”ìš± ì§ê´€ì ì¸ ì‚¬ìš©ì ê²½í—˜
  - í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œ í”Œë˜ê·¸ë¡œ ëª¨ë“œ êµ¬ë¶„ ì²˜ë¦¬
  - ì„ íƒ í›„ ìë™ìœ¼ë¡œ í”Œë ˆì´ì–´ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ì „í™˜

### v2.25.0 (2025-09-16)
- ğŸ”§ **í…Œì´ë¸” ì„ íƒ ì‹œìŠ¤í…œ í†µí•©**
  - ê´€ë¦¬ ëª¨ë‹¬ê³¼ ë©”ì¸ ëŒ€ì‹œë³´ë“œ í…Œì´ë¸” ì„ íƒ ë¡œì§ í†µí•©
  - ê´€ë¦¬ ëª¨ë‹¬ì—ì„œë„ ì¦‰ì‹œ í…Œì´ë¸” ì„ íƒ ê°€ëŠ¥ (ë¡œë”© ê³¼ì • ì œê±°)
  - í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ì„ ê³µìœ í•˜ì—¬ ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜ ì œê³µ
  - ê¸°ì¡´ "ğŸ“‹ í…Œì´ë¸” í˜¸ì¶œ" ë²„íŠ¼ì„ "ğŸ¯ í…Œì´ë¸” ì„ íƒ" ë²„íŠ¼ìœ¼ë¡œ êµì²´
  - ë©”ì¸ ëŒ€ì‹œë³´ë“œì˜ í…Œì´ë¸” ì„ íƒ ì‹œ ê´€ë¦¬ ëª¨ë‹¬ ìë™ ì—°ë™

### v2.24.0 (2025-09-16)
- ğŸ”§ **ì¤‘ìš” ë²„ê·¸ ìˆ˜ì •**
  - í”„ë¡ íŠ¸ì—”ë“œ IN/OUT ìƒíƒœ í•„í„°ë§ ì¶”ê°€
  - ì‚­ì œëœ í”Œë ˆì´ì–´(OUT ìƒíƒœ) í‘œì‹œ ë°©ì§€
  - Hì—´(Status) ê°’ì´ ë¹„ì–´ìˆìœ¼ë©´ INìœ¼ë¡œ ê¸°ë³¸ ì²˜ë¦¬
  - buildTypeFromCsv í•¨ìˆ˜ì— ìƒì„¸ ë¡œê¹… ì¶”ê°€
  - Apps Scriptì™€ í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ì¼ê´€ì„± í™•ë³´

### v2.23.0 (2025-09-16)
- ğŸ” **ë””ë²„ê¹… ë° ì˜¤ë¥˜ ì¶”ì  ê°•í™”**
  - loadTypeSheet ë¯¸ì •ì˜ í•¨ìˆ˜ ì˜¤ë¥˜ ì™„ì „ ìˆ˜ì •
  - ì¼ê´„ ë“±ë¡ ê³¼ì • ìƒì„¸ ë¡œê¹… ì¶”ê°€
  - ë‹¨ê³„ë³„ ì˜¤ë¥˜ ì¶”ì  ë° ë¶„ì„ ì‹œìŠ¤í…œ
  - ë„¤íŠ¸ì›Œí¬, JSON íŒŒì‹±, Apps Script ì˜¤ë¥˜ ë³„ë„ ì²˜ë¦¬
  - CSV ë°ì´í„° ë¡œë“œ ê³¼ì • ëª¨ë‹ˆí„°ë§

### v2.22.0 (2025-09-16)
- ğŸ“– **ì‚¬ìš©ì ê°€ì´ë“œ**
  - Apps Script ì¬ë°°í¬ ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
  - "Unknown action: batchUpdate" ì˜¤ë¥˜ í•´ê²° ë°©ë²• ì œê³µ
  - ë‹¨ê³„ë³„ ì¬ë°°í¬ ìˆœì„œ ì•ˆë‚´
  - ì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ë¡œ ì‚¬ìš©ì í˜¼ë€ ìµœì†Œí™”

### v2.21.0 (2025-09-16)
- ğŸ¨ **UI/UX ê°œì„ **
  - Apps Script URL ì €ì¥ ì‹œ ì‹œê°ì  í”¼ë“œë°± ê°•í™”
  - í˜„ì¬ ì €ì¥ëœ URL ëª…í™•í•˜ê²Œ í‘œì‹œ (ë…¸ë€ìƒ‰/ë…¹ìƒ‰ êµ¬ë¶„)
  - ì €ì¥ ì„±ê³µ ì‹œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½ ë° ë©”ì‹œì§€ í‘œì‹œ
  - ì…ë ¥ í•„ë“œ í”Œë ˆì´ìŠ¤í™€ë” ë™ì  ì—…ë°ì´íŠ¸
  - ì¤‘ë³µ URL ì…ë ¥ ë°©ì§€ ë° ì•ˆë‚´ ë©”ì‹œì§€

### v2.20.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - Apps Script URL ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¬¸ì œ í•´ê²°
  - setTimeoutìœ¼ë¡œ DOM ë¡œë“œ ë³´ì¥
  - ë””ë²„ê¹… ì½˜ì†” ë¡œê·¸ ì¶”ê°€
  - í…ŒìŠ¤íŠ¸ íŒŒì¼ ì œê³µ (test-url-save.html)

### v2.19.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - Apps Script FormData íŒŒì‹± ë¬¸ì œ í•´ê²°
  - batchUpdate ì•¡ì…˜ "Unknown action" ì˜¤ë¥˜ ìˆ˜ì •
  - e.parameter ì§ì ‘ ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
  - êµ¬ë²„ì „ payload ë°©ì‹ê³¼ í˜¸í™˜ì„± ìœ ì§€

### v2.18.0 (2025-09-16)
- ğŸ¨ **UI ê°œì„ **
  - ê´€ë¦¬ ëª¨ë‹¬ì— Apps Script URL ì„¤ì • ì¶”ê°€
  - ì¬ë°°í¬ ì‹œ Apps Script URLì„ ì§ì ‘ ê´€ë¦¬ ëª¨ë‹¬ì—ì„œ ë³€ê²½ ê°€ëŠ¥
  - ì„¤ì • ëª¨ë‹¬ê³¼ ë³„ë„ë¡œ ê´€ë¦¬ ëª¨ë‹¬ì—ì„œë„ URL ì„¤ì • ê°€ëŠ¥
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - batchUpdate ì•¡ì…˜ì´ ì´ë¯¸ Apps Scriptì— êµ¬í˜„ë˜ì–´ ìˆìŒì„ í™•ì¸
  - ì¼ê´„ ë“±ë¡ ê¸°ëŠ¥ ì •ìƒ ì‘ë™

### v2.17.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - parseTypeData í•¨ìˆ˜ ë¯¸ì •ì˜ ì˜¤ë¥˜ ìˆ˜ì •
  - buildTypeFromCsv í•¨ìˆ˜ë¡œ ì˜¬ë°”ë¥´ê²Œ ë³€ê²½
  - í…Œì´ë¸” ë¡œë“œ ê¸°ëŠ¥ ì •ìƒ ì‘ë™

### v2.16.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - loadTypeSheet í•¨ìˆ˜ ë¯¸ì •ì˜ ì˜¤ë¥˜ ìˆ˜ì •
  - ì§ì ‘ CSV í˜ì¹­ ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì•ˆì •ì„± ê°œì„ 
- ğŸ¨ **UI ê°œì„ **
  - "ê´€ë¦¬" ë²„íŠ¼ ìœ ì§€ ë° ê´€ë¦¬ ë©”ë‰´ êµ¬ì¡° ê°œì„ 
  - í…Œì´ë¸” ê´€ë¦¬ë¥¼ ìœ„í•œ ë³„ë„ ë²„íŠ¼ ì„¤ê³„
  - í–¥í›„ ì¹©/í”Œë ˆì´ì–´ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€ë¥¼ ìœ„í•œ ê¸°ë°˜ ë§ˆë ¨

### v2.15.0 (2025-09-16)
- ğŸ“‹ **í…Œì´ë¸” ê´€ë¦¬ UI ë‹¨ìˆœí™”**
  - ê´€ë¦¬ ë²„íŠ¼ì„ "í…Œì´ë¸”" ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
  - í”Œë ˆì´ì–´/ì¹© íƒ­ ì œê±°, í…Œì´ë¸” ê´€ë¦¬ì—ë§Œ ì§‘ì¤‘
  - í…Œì´ë¸” í˜¸ì¶œ â†’ ì„ íƒ â†’ í”Œë ˆì´ì–´ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°
  - ì¼ê´„ ë“±ë¡ ì‹œìŠ¤í…œìœ¼ë¡œ íš¨ìœ¨ì„± ê°œì„ 

### v2.14.0 (2025-09-16)
- ğŸ® **í”Œë ˆì´ì–´ ê´€ë¦¬ ê¸°ëŠ¥ ê°•í™”**
  - ê´€ë¦¬ ë²„íŠ¼ì—ì„œ í”Œë ˆì´ì–´ ì¶”ê°€/ì‚­ì œ ê°€ëŠ¥
  - ì‹¤ì‹œê°„ ì¢Œì„ ë²ˆí˜¸ ë³€ê²½ ê¸°ëŠ¥
  - ì¹© ìˆ˜ëŸ‰ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥
  - Google Sheetsì™€ ì‹¤ì‹œê°„ ë™ê¸°í™”
  - í…Œì´ë¸”ë³„ í”Œë ˆì´ì–´ ê´€ë¦¬ UI ê°œì„ 

### v2.13.0 (2025-09-15)
- ğŸš€ **ìë™ ì•¡ì…˜ ë§¤í•‘ ì‹œìŠ¤í…œ êµ¬í˜„**
  - í”Œë ˆì´ì–´ ì„ íƒ ì—†ì´ ì•¡ì…˜ë§Œ ìˆœì„œëŒ€ë¡œ ì…ë ¥ ê°€ëŠ¥
  - í¬ì»¤ ê·œì¹™ì— ë”°ë¥¸ ìë™ í”Œë ˆì´ì–´ ë§¤í•‘
  - í”„ë¦¬í”Œë/í¬ìŠ¤íŠ¸í”Œë ì•¡ì…˜ ìˆœì„œ ìë™ ê³„ì‚°
  - ì„¤ì •ì—ì„œ ìë™/ìˆ˜ë™ ëª¨ë“œ ì „í™˜ ê°€ëŠ¥
  - í˜„ì¬ ì°¨ë¡€ í”Œë ˆì´ì–´ ì‹¤ì‹œê°„ í‘œì‹œ
  - í€µ ì•¡ì…˜ ë²„íŠ¼ ì¶”ê°€ (ìŠ¤ë§ˆíŠ¸ ì½œ, ì˜¬ì¸, ë²³/ë ˆì´ì¦ˆ)

### v2.12.0 (2025-09-15)
- âš™ï¸ **ì„¤ì • ê¸°ëŠ¥ ì¶”ê°€**
  - Apps Script URLì„ ëŒ€ì‹œë³´ë“œì—ì„œ ì§ì ‘ ë³€ê²½ ê°€ëŠ¥
  - localStorageì— ìë™ ì €ì¥ë˜ì–´ ì¬ë°°í¬ ì‹œ í¸ë¦¬
  - ì¹© ìŠ¤íƒ ê²€ì¦ ON/OFF ì„¤ì • ê°€ëŠ¥
  - ì„¤ì • ëª¨ë‹¬ì—ì„œ ë²„ì „ ì •ë³´ í™•ì¸ ê°€ëŠ¥

### v2.11.0 (2025-09-15)
- ğŸ¯ **í¬ì§€ì…˜ ì •ë³´ Google Sheets ê¸°ë¡ ì¶”ê°€**
  - PLAYER í–‰ì˜ Iì—´ì— í¬ì§€ì…˜ ì •ë³´(BTN/SB/BB) ì¶”ê°€
  - getPositionsForSeat í•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ ìë™ ê³„ì‚°
  - ì—¬ëŸ¬ í¬ì§€ì…˜ì„ ê°€ì§„ ê²½ìš° ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì €ì¥

## ğŸ’¡ ì‚¬ìš© íŒ

### ìë™ ì•¡ì…˜ ë§¤í•‘ ëª¨ë“œ ì‚¬ìš©ë²•
1. ì„¤ì •(âš™ï¸) â†’ "ìë™ ì•¡ì…˜ ë§¤í•‘ ëª¨ë“œ" í™œì„±í™”
2. ë²„íŠ¼ ìœ„ì¹˜ ì„¤ì •
3. í”Œë ˆì´ì–´ ì„ íƒ ì—†ì´ ì•¡ì…˜ë§Œ ìˆœì„œëŒ€ë¡œ ì…ë ¥
4. ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì˜¬ë°”ë¥¸ í”Œë ˆì´ì–´ì—ê²Œ ë§¤í•‘

### ì¹© ë¶„ì„ ê¸°ëŠ¥
1. ê´€ë¦¬ ë²„íŠ¼ â†’ ì¹© ì»¬ëŸ¬ íƒ­
2. ì¹© ì»¬ëŸ¬ ë“±ë¡ (ìµœëŒ€ 5ê°œ)
3. ì¹´ë©”ë¼ë¡œ ì¹© ìŠ¤íƒ ì´¬ì˜
4. AIê°€ ìë™ìœ¼ë¡œ ì¹© ê°œìˆ˜ ë¶„ì„

### íš¨ìœ¨ì ì¸ í•¸ë“œ ê¸°ë¡
- Smart ëª¨ë“œ í™œì„±í™”ë¡œ ìë™ ìŠ¤íŠ¸ë¦¬íŠ¸ ì§„í–‰
- í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ í™œìš© (ESC: ë‹«ê¸°, Enter: í™•ì¸)
- ë²„íŠ¼ ìœ„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì•¡ì…˜ ìˆœì„œ ìë™ ê³„ì‚°

## ğŸ”§ ê°œë°œ ê°€ì´ë“œ

### Apps Script ë°°í¬
1. [Google Apps Script](https://script.google.com) ì ‘ì†
2. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
3. `Code_v63_InOut.gs` ë‚´ìš© ë¶™ì—¬ë„£ê¸°
4. ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID ì„¤ì •
5. ì›¹ ì•±ìœ¼ë¡œ ë°°í¬ (ì•¡ì„¸ìŠ¤: ëª¨ë“  ì‚¬ìš©ì)

### ë¡œì»¬ ê°œë°œ
```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/garimto81/virtual_data.git

# ë¡œì»¬ ì„œë²„ ì‹¤í–‰
python -m http.server 8000

# ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°
http://localhost:8000
```

## ğŸ“š í”„ë¡œì íŠ¸ ë¬¸ì„œ

### ë¬¸ì„œ êµ¬ì¡°
```
ğŸ“ docs/
â”œâ”€â”€ ğŸ“– README.md                    # ë¬¸ì„œ ì„¼í„° ë©”ì¸
â”œâ”€â”€ ğŸš€ development/                 # ê°œë°œ ê°€ì´ë“œ ë° ë¡œë“œë§µ
â”œâ”€â”€ ğŸ§ª testing/                     # í…ŒìŠ¤íŠ¸ ê³„íš ë° í’ˆì§ˆ ë³´ì¦
â”œâ”€â”€ ğŸŒ deployment/                  # ë°°í¬ ê°€ì´ë“œ ë° ìš´ì˜
â””â”€â”€ ğŸ“¦ archive/                     # ì™„ë£Œëœ í”„ë¡œì íŠ¸ ì•„ì¹´ì´ë¸Œ

ğŸ“ test/                            # ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½
ğŸ“ apps-script/                     # Apps Script ë°±ì—”ë“œ ì†ŒìŠ¤
ğŸ“ archive/                         # ì°¸ê³ ìš© ì•„ì¹´ì´ë¸Œ íŒŒì¼
```

### ì£¼ìš” ë¬¸ì„œ
- [ğŸ“š ë¬¸ì„œ ì„¼í„°](docs/README.md) - ëª¨ë“  ë¬¸ì„œì˜ ì¸ë±ìŠ¤
- [ğŸš€ ê°œë°œ ê°€ì´ë“œ](docs/development/DEVELOPMENT.md) - ê°œë°œ ë¡œë“œë§µ ë° ê¸°ìˆ  ì‚¬ì–‘
- [ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš](docs/testing/TEST_PLAN.md) - ì¢…í•© í…ŒìŠ¤íŠ¸ ì „ëµ
- [ğŸŒ ë°°í¬ ê°€ì´ë“œ](docs/deployment/DEPLOYMENT_GUIDE.md) - ìš´ì˜ í™˜ê²½ ë°°í¬
- [ğŸ§ª ë¡œì»¬ í…ŒìŠ¤íŠ¸](test/README.md) - Apps Script ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ê¶Œí•œ ì„¤ì •**: ì›¹ ì•± ë°°í¬ ì‹œ "ëª¨ë“  ì‚¬ìš©ì" ì•¡ì„¸ìŠ¤ í—ˆìš©
2. **CORS**: form-urlencoded ë°©ì‹ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ CORS ë¬¸ì œ íšŒí”¼
3. **ì‹œíŠ¸ ì´ë¦„**: Hand, Index, Type ì‹œíŠ¸ ì´ë¦„ ë³€ê²½ ê¸ˆì§€
4. **API ì œí•œ**: Google Apps Script ì¼ì¼ ì‹¤í–‰ ì‹œê°„ ì œí•œ ê³ ë ¤
5. **ë¸Œë¼ìš°ì € ìºì‹œ**: ì—…ë°ì´íŠ¸ í›„ Ctrl+Shift+Rë¡œ ê°•ì œ ìƒˆë¡œê³ ì¹¨

## ğŸ“§ ë¬¸ì˜

ë¬¸ì œê°€ ìˆê±°ë‚˜ ê°œì„  ì‚¬í•­ì´ ìˆìœ¼ë©´ [Issue](https://github.com/garimto81/virtual_data/issues)ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.

---

Â© 2025 Virtual Data - Poker Hand Logger. All rights reserved.
</file>

<file path="virtual_data_claude/index.html">
<!DOCTYPE html>
<!--
  ============================================
  í¬ì»¤ í•¸ë“œ ë¡œê±° (Poker Hand Logger)
  Version: 3.4.21
  Last Modified: 2025-09-18 KST

  Change Log:
  - v3.4.21 (2025-09-18): í”„ë¡œì íŠ¸ êµ¬ì¡° virtual_data_claude í´ë”ë¡œ ì´ë™
    â€¢ Apps Script v66ê³¼ í˜¸í™˜ì„± í™•ë³´
    â€¢ Config ì‹œíŠ¸ í•˜ë“œì½”ë”© URL ë¶€íŠ¸ìŠ¤íŠ¸ë© ì§€ì›
    â€¢ ë‹¤ì¤‘ í”„ë¡œì íŠ¸ ê´€ë¦¬ë¥¼ ìœ„í•œ í´ë” êµ¬ì¡° ê°œì„ 
  - v3.4.10 (2025-09-18): GitHub ì €ì¥ì†Œ êµ¬ì¡° í†µí•© ë° ê°„ì†Œí™”
    â€¢ íŒŒì¼ë“¤ì„ ë£¨íŠ¸ ë ˆë²¨ë¡œ ì´ë™ (virtual_data ì„œë¸Œí´ë” ì œê±°)
    â€¢ GitHub Pages ê²½ë¡œ ë‹¨ìˆœí™”: garimto81.github.io/virtual_data
    â€¢ ê´€ë¦¬ í¬ì¸íŠ¸ í†µí•©ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
  - v3.4.9 (2025-09-18): openCardSelector í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
    â€¢ openCardSelector í•¨ìˆ˜ë¥¼ window ê°ì²´ì— ë“±ë¡
    â€¢ ActionOrderManagerì—ì„œ ì¹´ë“œ ì„ íƒ UI ì •ìƒ í˜¸ì¶œ ê°€ëŠ¥
  - v3.4.8 (2025-09-18): JavaScript íŒŒì¼ ê²½ë¡œ ë²„ê·¸ ìˆ˜ì •
    â€¢ archive í´ë”ë¡œ ìŠ¤í¬ë¦½íŠ¸ ê²½ë¡œ ìˆ˜ì • (404 ì—ëŸ¬ í•´ê²°)
    â€¢ ëª¨ë“  JavaScript íŒŒì¼ì´ ì •ìƒ ë¡œë“œë¨
  - v3.4.7 (2025-09-18): í…ìŠ¤íŠ¸ ì¹´ë“œ ì…ë ¥ UI ì™„ì „ ì œê±°
    â€¢ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì œê±°, ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒê¸°ë¡œ í†µí•©
    â€¢ showFeedback í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
    â€¢ promptForBoardCardsê°€ openCardSelector ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½
    â€¢ ëª¨ë“  ì¹´ë“œ ì…ë ¥ì´ ì¼ê´€ëœ UIë¡œ í†µí•©
  - v3.4.6 (2025-09-18): ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì‚¬ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
    â€¢ ë°±ê·¸ë¼ìš´ë“œ ê²€ì‚¬ë¡œ ë³€ê²½ (UI ì°¨ë‹¨ ì—†ìŒ)
    â€¢ ì§„í–‰ ë©”ì‹œì§€ ê°„ì†Œí™” (ì½˜ì†” ìœ„ì£¼)
    â€¢ ì¤‘ìš”í•œ ê²°ê³¼ë§Œ ì§§ê²Œ í‘œì‹œ (2ì´ˆ ìŠ¤ë‚µë°”)
    â€¢ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¡°ìš©í•œ ì‹¤í–‰
  - v3.4.5 (2025-09-18): ì¹´ë“œ ì…ë ¥ ì‹œìŠ¤í…œ í†µí•©
    â€¢ ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒ UIë¡œ ì™„ì „ í†µì¼
    â€¢ ì´ë¯¸ ì…ë ¥ëœ ì¹´ë“œê°€ ìˆìœ¼ë©´ ìë™ ìŠ¤í‚µ
  - v3.3.3 (2025-09-17): ìœ ì—°í•œ ì¹© ì²˜ë¦¬ ì‹œìŠ¤í…œ
    â€¢ ì¹© ì´ˆê³¼ ë² íŒ… í—ˆìš© - ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ì§„í–—
    â€¢ ë§ˆì´ë„ˆìŠ¤ ì¹© í—ˆìš© ë° ì‹œê°ì  í‘œì‹œ (ë¹¨ê°„ìƒ‰)
    â€¢ ìˆ˜ë™ ì¹© ì¡°ì •ìœ¼ë¡œ ìœ ì—°í•œ ì²˜ë¦¬ ê°€ëŠ¥
    â€¢ í˜„ì‹¤ì ì¸ ìƒí™©ì— ëŒ€ì‘í•˜ëŠ” ì„¤ê³„
  - v3.3.2 (2025-09-17): ì¹© ì´ˆê³¼ ë² íŒ… ë°©ì§€ ì‹œìŠ¤í…œ (deprecated)
  - v3.3.1 (2025-09-17): ì¹© ì´ˆê³¼ ë² íŒ… ìë™ ì˜¬ì¸ ì²˜ë¦¬ (deprecated)
  - v3.3.0 (2025-09-17): ì¹© ìˆ˜ì • ì‹œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìƒì„± ë¬¸ì œ í•´ê²°
    â€¢ Apps Script v65ë¡œ ì—…ê·¸ë ˆì´ë“œ
    â€¢ updatePlayerChips í•¨ìˆ˜ ê°œì„ : ê¸°ì¡´ í”Œë ˆì´ì–´ ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€
    â€¢ ì¹© ìˆ˜ì • ì‹œ ìë™ ì¤‘ë³µ ì œê±° ë¡œì§ ì¶”ê°€
  - v3.2.9 (2025-09-17): ì¤‘ë³µ ì œê±° ì•„í‚¤í…ì²˜ ê°œì„ 
    â€¢ ë³„ë„ ì¤‘ë³µ ì œê±° ë²„íŠ¼ ì œê±°
    â€¢ ì¼ê´„ ë“±ë¡ ì‹œ ìë™ ì¤‘ë³µ ì œê±° ì²˜ë¦¬
    â€¢ Apps Script v64ë¡œ ì—…ê·¸ë ˆì´ë“œ
  - v3.2.8 (2025-09-17): ì¤‘ë³µ í”Œë ˆì´ì–´ ê°ì§€ ë° ì œê±° ì‹œìŠ¤í…œ êµ¬í˜„
    â€¢ Apps Scriptì— removeDuplicatePlayers() í•¨ìˆ˜ ì¶”ê°€
    â€¢ batchUpdate ë° addPlayerì—ì„œ ìë™ ì¤‘ë³µ ì œê±°
    â€¢ í”„ë¡ íŠ¸ì—”ë“œì— ì¤‘ë³µ ì œê±° ë²„íŠ¼ ì¶”ê°€ (ê´€ë¦¬ ëª¨ë‹¬)
    â€¢ ìë™ í”Œë ˆì´ì–´ ë“±ë¡ ë¡œì§ ì œê±° (ì¤‘ë³µ ë°©ì§€)
    â€¢ ê°•í™”ëœ ì¤‘ë³µ ì²´í¬ ì‹œìŠ¤í…œ (í…Œì´ë¸”_í”Œë ˆì´ì–´ ì¡°í•©)
  - v3.2.7 (2025-09-17): Apps Script ì‚­ì œ ë¡œì§ ë””ë²„ê¹… ê°•í™” ë° ì¡°ê±´ ì™„í™”
  - v3.2.7 (2025-09-17): ì‹œíŠ¸ ì •ë ¬ ë²„íŠ¼ ì œê±°, í”Œë ˆì´ì–´ ì‚­ì œ ë¡œì§ ê°œì„ 
  - v3.2.7 (2025-09-17): ì •ë ¬ ê¸°ì¤€ ë³€ê²½ (Table > Seat)
  - v3.2.4 (2025-09-17): Google Sheets ìë™ ì •ë ¬ ê¸°ëŠ¥ ì¶”ê°€
  - v3.2.3 (2025-09-17): ë””ë²„ê·µ ë¡œê·¸ ê°œì„  ë° ìºì‹œ ë²„ìŠ¤íŒ…
  - v3.2.2 (2025-09-17): í”Œë ˆì´ì–´ ì‚­ì œ ì„±ëŠ¥ ìµœì í™”
  - v3.2.1 (2025-09-17): í”Œë ˆì´ì–´ ì‚­ì œ ë¡œì§ ë²„ê·¸ ìˆ˜ì •
  - v3.2.0 (2025-09-17): Phase 3 - ëª¨ë°”ì¼ ìµœì í™” ì™„ì„±
    â€¢ í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™” (44x44px ìµœì†Œ í¬ê¸°)
    â€¢ ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ë¡œ ì‹¤í–‰ì·¨ì†Œ (ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„)
    â€¢ ë¡±í”„ë ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì‹œìŠ¤í…œ
    â€¢ í–…í‹± í”¼ë“œë°± ë° ì§„ë™ API ì§€ì›
    â€¢ ê°€ìƒ ìŠ¤í¬ë¡¤ë¡œ ëŒ€ìš©ëŸ‰ ë¦¬ìŠ¤íŠ¸ ì„±ëŠ¥ ìµœì í™”
    â€¢ IndexedDB ê¸°ë°˜ ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ
    â€¢ ìë™ ë™ê¸°í™” í ë° ì¬ì‹œë„ ë¡œì§
    â€¢ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
  - v3.1.0 (2025-01-17): Phase 2 - ê¸°ëŠ¥ë³„ ì¦‰ì‹œ ì‹¤í–‰
    â€¢ ë”ë¸”íƒ­ìœ¼ë¡œ ìœ„í—˜ ì‘ì—… ë³´í˜¸
    â€¢ íŠ¸ëœì­ì…˜ ë°©ì‹ì˜ ì¼ê´„ ì²˜ë¦¬
    â€¢ API ë°°ì¹˜ í˜¸ì¶œ ìµœì í™”
    â€¢ ë”ë¸”íƒ­ íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€
  - v3.0.0 (2025-01-17): ëª¨ë°”ì¼ ìµœì í™” - Phase 1 ì™„ë£Œ
    â€¢ confirm íŒì—… ì œê±°, ì¦‰ì‹œ ì‹¤í–‰ + ì‹¤í–‰ì·¨ì†Œ ì‹œìŠ¤í…œ êµ¬í˜„
    â€¢ ActionHistory ì‹œìŠ¤í…œìœ¼ë¡œ ì‘ì—… ì´ë ¥ ê´€ë¦¬
    â€¢ ìŠ¤ë‚µë°” UIë¡œ ì‹¤ì‹œê°„ í”¼ë“œë°± ì œê³µ
    â€¢ ë©”ëª¨ë¦¬ ìµœì í™” (íˆìŠ¤í† ë¦¬ 20ê°œ ì œí•œ)
  - v2.29.0 (2025-09-16): 10ê°œ ì‹œíŠ¸ ê³ ì • í”Œë ˆì´ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ
    â€¢ ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°
    â€¢ í¬ì»¤ í¬ì§€ì…˜ ìˆœì„œëŒ€ë¡œ ìë™ í”Œë ˆì´ì–´ ì§„í–‰
    â€¢ Check/Call ë²„íŠ¼ ìƒí™©ë³„ ë™ì  ë³€ê²½ (ê¸ˆì•¡ í‘œì‹œ)
    â€¢ ë² íŒ… ì…ë ¥ ë²„ê·¸ ìˆ˜ì • ë° íŒì—… ì¦‰ì‹œ í‘œì‹œ
  - v2.15.0 (2025-09-16): í…Œì´ë¸” ê´€ë¦¬ UI ë‹¨ìˆœí™” - í…Œì´ë¸” ì „ìš© ê´€ë¦¬ ëª¨ë‹¬ë¡œ ë³€ê²½
  - v2.31.0 (2025-09-16): ë¡œë”© ì¤‘ UI ì ê¸ˆ ë° í”Œë ˆì´ì–´ ê´€ë¦¬ ì¼ê´„ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ êµ¬í˜„ - ì¶©ëŒ ë°©ì§€ ë° ì¦‰ì‹œ ë°˜ì˜
  - v2.30.0 (2025-09-16): Apps Script URL í´ë¼ìš°ë“œ ë™ê¸°í™” ì‹œìŠ¤í…œ êµ¬í˜„ - GitHub Gist API í™œìš© ê¸°ê¸°ê°„ ì„¤ì • ë™ê¸°í™”
  - v2.14.0 (2025-09-16): í”Œë ˆì´ì–´ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€ - ê´€ë¦¬ ë²„íŠ¼ì—ì„œ í”Œë ˆì´ì–´ ì¶”ê°€/ì‚­ì œ/ì¢Œì„ ë³€ê²½
  - v2.10.9 (2025-09-15): íŒŸ ê³„ì‚° ë¡œì§ ë²„ê·¸ ìˆ˜ì • - ì¤‘ê°„ ë² íŒ… ê¸ˆì•¡ ëˆ„ì  ë¬¸ì œ í•´ê²°
  - v2.10.8 (2025-09-15): í‚¤íŒ¨ë“œ ì¤‘ë³µ ì…ë ¥ ë²„ê·¸ ìˆ˜ì • - ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
  - v2.10.7 (2025-09-15): ë²„íŠ¼/SB/BB ì„ íƒ ë¡œì§ ê°œì„  - ì „ì²´ í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì„ íƒ ê°€ëŠ¥
  - v2.10.6 (2025-09-15): ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ ì‘ë™ ë²„ê·¸ ìˆ˜ì •, ë²„ì „ ì¤‘ì•™ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„
  - v2.10.5 (2025-09-15): ë²„íŠ¼ ìœ„ì¹˜ ì¤‘ë³µ ì…ë ¥ ë²„ê·¸ ìˆ˜ì •
  - v2.10.4 (2025-09-15): ë²„íŠ¼ ì„¤ì • UI ìµœì í™”
  - v2.10.3 (2025-09-15): ë²„íŠ¼ ì„¤ì • UI ê°œì„ 
  - v2.10.2 (2025-09-15): ë³´ë“œ ì¹´ë“œ í•œë²ˆì— ì…ë ¥ ê¸°ëŠ¥
  - v2.10.1 (2025-09-15): í”Œë ˆì´ì–´ ì¹© ë²„íŠ¼ ì´ë²¤íŠ¸ ë²„ê·¸ ìˆ˜ì •
  - v2.10.0 (2025-09-15): í´ë“œ ë˜ëŒë¦¬ê¸° ë²„ê·¸ ìˆ˜ì • ì™¸
  - v2.9.5 (2025-09-12): ì‹œì‘ ì¹© ì—…ë°ì´íŠ¸ ë²„ê·¸ ìˆ˜ì •
  - v2.9.4 (2025-09-12): í”Œë ˆì´ì–´ ì´ë¦„ í‘œì‹œ ë²„ê·¸ ìˆ˜ì •
  - v2.9.3 (2025-09-12): ì¢Œì„ ë²ˆí˜¸ ì œê±°, 0.5x11 ê·¸ë¦¬ë“œ, ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ ë²„ê·¸ ìˆ˜ì •
  - v2.9.2 (2025-01-11): 1x11 ê·¸ë¦¬ë“œë¡œ ì¢Œì„ ë°°ì¹˜ ê°œì„ 
  - v2.9.1 (2025-01-11): ì¢Œì„ ë°°ì¹˜ UI ê³µê°„ ìµœì í™”
  - v2.9.0 (2025-01-11): ì¢Œì„ ë°°ì¹˜ ì‹œìŠ¤í…œ ë° ì•¡ì…˜ ìˆœì„œ ë¡œì§ ì¶”ê°€
  - v2.8.3 (2025-01-11): ì¹´ë“œ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸ ë²„íŠ¼ ìœ„ì¹˜ ë³€ê²½ (UX ê°œì„ )
  - v2.8.2 (2025-01-10): ë¬¸ì„œ í†µí•© ë° í”„ë¡œì íŠ¸ ì •ë¦¬
  - v2.8.1 (2025-01-10): 2ë°±ë§Œ ì¹© ì´ìƒ ë¬´í•œ í‘œì‹œ ë²„ê·¸ ìˆ˜ì •
  - v2.8.0 (2025-01-09): ì˜¬ì¸ ì œí•œ ê³ ë ¤í•œ ì •í™•í•œ íŒŸ ê³„ì‚° ë¡œì§ êµ¬í˜„
  - v2.7.0 (2025-01-08): íŒŸ ê³„ì‚° ë¡œì§ ê°œì„  - ë¸”ë¼ì¸ë“œ/ì•ˆí‹°ë¥¼ í”Œë ˆì´ì–´ë³„ ê¸°ì—¬ì•¡ì— í¬í•¨
  - v2.0.0 (2025-01-02): Smart Check/Call ë²„íŠ¼ ë° ìŠ¤íŠ¸ë¦¬íŠ¸ ìë™ ì§„í–‰ ì‹œìŠ¤í…œ êµ¬í˜„
  - v1.9.0 (2024-12-30): íŒŸ ì‚¬ì´ì¦ˆ ì¡°ì • ë¡œì§ ë° ì˜¬ì¸ ì½œ ë²„ê·¸ ìˆ˜ì •
  - v1.8.0 (2024-12-28): í”Œë ˆì´ì–´ ìƒíƒœ ì¶”ì  ì‹œìŠ¤í…œ ì¶”ê°€
  ============================================
-->
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <link rel="icon" href="data:;base64,iVBORw0KGgo="">
  <meta http-equiv="cache-control" content="no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <title>í¬ì»¤ í•¸ë“œ ë¡œê±° v3.4.10</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="archive/chip-analysis-module.js?v=3.0.0" defer></script>
  <!-- í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“ˆ v59 - IN/OUT ë‘ ê°€ì§€ ìƒíƒœë§Œ ì‚¬ìš© -->
  <script src="archive/table-management-v59.js?v=3.0.0" defer></script>
  <!-- ActionHistory ì‹œìŠ¤í…œ - Phase 1 -->
  <script src="archive/action-history.js?v=3.2.5" defer></script>
  <!-- Phase 2: ë”ë¸”íƒ­ & ë°°ì¹˜ ì²˜ë¦¬ -->
  <script src="archive/double-tap-handler.js?v=3.2.5" defer></script>
  <script src="archive/batch-processor.js?v=3.2.5" defer></script>
  <!-- Phase 3: ëª¨ë°”ì¼ ìµœì í™” -->
  <script src="archive/mobile-optimizer.js?v=3.2.5" defer></script>
  <script src="archive/virtual-scroll.js?v=3.2.5" defer></script>
  <script src="archive/offline-storage.js?v=3.2.5" defer></script>
  <!-- ëª¨ë‹¬ ìë™ ë‹«ê¸° ëª¨ë“ˆ -->
  <script src="src/js/modal-auto-close.js?v=1.0.0" defer></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Noto+Sans+KR:wght@400;500;700&display=swap');
    html, body { height: 100vh; overflow: hidden; font-family: 'Noto Sans KR', sans-serif; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    #app-container { display: flex; flex-direction: column; height: 100%; }
    main { flex-grow: 1; overflow-y: auto; }
    .btn { /* transition removed for instant response */ }
    .btn:active { transform: scale(0.95); }
    .btn-selected { background-color: #FBBF24 !important; color: #111827 !important; font-weight: bold; }
    .card-placeholder { border: 2px dashed #4B5563; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 1px; background-color: rgba(255,255,255,0.05); flex-shrink: 0; }
    .card-display { font-family: 'Roboto', sans-serif; background-color: white; border-radius: 4px; padding: 1px; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 0.8rem; }
    .card-display .rank { font-weight: bold; font-size: 1rem; }
    .modal { /* transition removed for instant popup */ backdrop-filter: blur(4px); }
    .card-selector-btn { font-family: 'Roboto', sans-serif; font-size: 1rem; font-weight: bold; }
    .card-selector-btn.card-red { color: #DC2626; }
    .card-selector-btn.card-black { color: #111827; }
    .card-selector-btn.selected { border: 3px solid #FBBF24; transform: scale(0.95); }
    .player-card.is-winner { background-color: rgba(251, 191, 36, 0.1); }
    select, input[type="text"] { font-size: 0.875rem; }
    .chip-color-sample { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #4B5563; cursor: pointer; }
    .chip-analysis-btn { font-size: 0.75rem; padding: 0.25rem 0.5rem; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .pulse-animation { animation: pulse 2s infinite; }

    /* ìŠ¤ë‚µë°” ìŠ¤íƒ€ì¼ (ëª¨ë°”ì¼ ìµœì í™”) */
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }

    .snackbar.show {
      bottom: 10px;
    }

    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
      min-width: 44px;
      min-height: 30px;
    }

    .snackbar-undo-btn:active {
      transform: scale(0.95);
    }

    .snackbar-info {
      background: #2563eb;
    }

    .snackbar-error {
      background: #dc2626;
    }

    .snackbar-success {
      background: #16a34a;
    }

    .snackbar-warning {
      background: #f59e0b;
    }

    /* ë”ë¸”íƒ­ ìŠ¤íƒ€ì¼ (Phase 2) */
    .double-tap-required {
      position: relative;
    }

    .double-tap-warning {
      animation: pulse 0.5s ease-in-out infinite;
      background: #f59e0b !important;
      color: white !important;
    }

    .danger-critical {
      background: #dc2626 !important;
      color: white !important;
    }

    .danger-warning {
      background: #f59e0b !important;
      color: white !important;
    }

    .executing {
      opacity: 0.6;
      pointer-events: none;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
  </style>
</head>
<body class="bg-gray-900 text-white antialiased">
  <div id="app-container">
    <!-- ë²„ì „ í‘œì‹œ í—¤ë” -->
    <div class="bg-gray-900 border-b border-gray-700 px-3 py-1">
      <div class="flex justify-between items-center text-xs">
        <span class="font-bold text-amber-400">í¬ì»¤ í•¸ë“œ ë¡œê±°</span>
        <div class="flex items-center gap-2">
          <button id="settings-btn" class="text-gray-400 hover:text-amber-400" title="ì„¤ì •">
            âš™ï¸
          </button>
          <span id="version-display" class="text-gray-400">v2.26.6</span>
        </div>
      </div>
    </div>
    <main class="p-2 space-y-2">
      <div class="bg-gray-800 p-2 rounded-lg space-y-2">
        <div class="flex items-center gap-2 text-sm">
          <div class="flex-1 flex items-center gap-1 bg-gray-700 p-1 rounded-md min-w-0">
            <span id="hand-number-display" class="font-bold px-1 whitespace-nowrap">#--</span>
            <button id="load-hand-btn" class="btn bg-gray-600 px-2 py-1 rounded-md text-xs">Load</button>
            <label class="flex items-center gap-1 text-xs ml-2">
              <input type="checkbox" id="smart-mode-toggle" checked class="h-3 w-3">
              <span>Smart</span>
            </label>
          </div>
          <div class="flex-1 min-w-0">
            <button id="table-selector-btn" class="w-full bg-gray-700 border border-gray-600 rounded-md px-2 py-1 text-left flex items-center justify-between hover:bg-gray-600">
              <span id="selected-table-display">í…Œì´ë¸” ì„ íƒ</span>
              <span class="text-gray-400">â–¼</span>
            </button>
          </div>
          <div class="flex-1 flex items-center gap-1 min-w-0">
            <select id="timezone-selector" class="flex-grow bg-gray-700 border border-gray-600 rounded-md px-2 py-1 text-xs"></select>
            <span id="time-display" class="bg-gray-900/50 p-1 rounded-md font-mono text-xs"></span>
          </div>
          <div class="flex items-center gap-1">
            <button id="manage-players-btn" class="btn bg-gray-600 hover:bg-gray-700 px-2 py-1 rounded-md text-xs">ê´€ë¦¬</button>
            <button id="refresh-data" class="text-lg" title="ë°ì´í„° ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div class="text-xs text-gray-300 flex items-center gap-2">
            <button id="cam-btn-1" class="btn bg-gray-700 px-2 py-1 rounded"></button>
            <button id="cam-btn-2" class="btn bg-gray-700 px-2 py-1 rounded"></button>
          </div>
          <div class="text-right text-xs text-gray-400">
            <span id="data-stamp"></span>
          </div>
        </div>
        <!-- ì¢Œì„ ë°°ì¹˜ ë° í”Œë ˆì´ì–´ ì„ íƒ (1x11 ê·¸ë¦¬ë“œ) -->
        <div class="bg-gray-700 p-2 rounded-lg">
          <div id="seat-buttons" class="grid grid-cols-11 gap-1">
            <!-- 10ê°œ ì¢Œì„ + ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ (11ë²ˆì§¸) -->
          </div>
          <div id="position-indicators" class="text-xs text-gray-400 mt-1 text-center">
            <!-- SB, BB í‘œì‹œ -->
          </div>
          <div id="position-display" class="mt-1 text-xs">
            <!-- ë²„íŠ¼ ìœ„ì¹˜ ìƒì„¸ í‘œì‹œ -->
          </div>
        </div>
      </div>

      <div id="player-details-section" class="bg-gray-800 p-2 rounded-lg space-y-1"></div>

      <div class="bg-gray-800 p-2 rounded-lg space-y-2">
        <div class="flex flex-wrap items-center gap-2">
          <div class="flex items-center gap-1">
            <button id="small-blind-btn" data-purpose="smallBlind" class="btn bg-gray-700 p-1 rounded-md text-sm min-w-[60px]">0</button>
            <button id="big-blind-btn" data-purpose="bigBlind" class="btn bg-gray-700 p-1 rounded-md text-sm min-w-[60px]">0</button>
            <div class="flex items-center">
              <input id="bb-ante-checkbox" type="checkbox" class="h-4 w-4 bg-gray-700 border-gray-600 rounded text-amber-500">
              <label for="bb-ante-checkbox" class="ml-1 text-xs">Ante</label>
            </div>
          </div>
          <div id="board-card-placeholders" class="flex flex-wrap gap-1 items-center flex-grow justify-end"></div>
        </div>
        <div class="space-y-1" id="street-logs-container"></div>
        
        <!-- í˜„ì¬ ì°¨ë¡€ í‘œì‹œ & ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ (ìë™ ëª¨ë“œ) -->
        <div id="current-turn-indicator" class="hidden mt-2 p-2 bg-gray-700 rounded-md">
          <div class="text-center text-sm mb-2">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
          <div id="quick-action-buttons" class="grid grid-cols-5 gap-1">
            <button onclick="addAutoAction('Checks')" class="btn bg-green-600 hover:bg-green-500 text-white text-xs py-1 px-2 rounded">
              ì²´í¬
            </button>
            <button onclick="handleSmartCall()" class="btn bg-blue-600 hover:bg-blue-500 text-white text-xs py-1 px-2 rounded">
              ì½œ
            </button>
            <button onclick="openQuickBetRaise()" class="btn bg-orange-600 hover:bg-orange-500 text-white text-xs py-1 px-2 rounded">
              ë²³/ë ˆì´ì¦ˆ
            </button>
            <button onclick="addAutoAction('Folds')" class="btn bg-red-600 hover:bg-red-500 text-white text-xs py-1 px-2 rounded">
              í´ë“œ
            </button>
            <button onclick="handleAllIn()" class="btn bg-purple-600 hover:bg-purple-500 text-white text-xs py-1 px-2 rounded">
              ì˜¬ì¸
            </button>
          </div>
        </div>
      </div>


      <div class="bg-gray-800 p-2 rounded-lg space-y-2">
        <div class="flex flex-wrap gap-1 items-center">
          <span class="text-sm font-bold mr-2">ìŠ¹ì:</span>
          <div id="winner-buttons" class="flex flex-wrap gap-1 flex-grow"></div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button id="reset-btn" class="w-full btn bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-3 rounded-md text-sm">ìƒˆ í•¸ë“œ</button>
          <button id="send-to-sheet-btn" class="w-full btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-md text-sm">ì‹œíŠ¸ ì „ì†¡</button>
        </div>
        <p id="feedback-message" class="text-center h-4 text-xs font-semibold"></p>
      </div>

    </main>
    <footer class="flex-shrink-0 p-1 text-center">
      <button id="show-log-btn" class="text-gray-500 hover:text-gray-300 text-xs">ë¡œê·¸ ë³´ê¸°</button>
    </footer>
  </div>

  <!-- Modals -->
  <div id="card-selector-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-2 z-50 hidden opacity-0"></div>
  <div id="action-pad-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0"></div>
  <div id="keypad-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0"></div>
  <div id="load-hand-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0"></div>
  <!-- ê´€ë¦¬ ëª¨ë‹¬ -->
  <div id="registration-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0">
    <div class="bg-gray-800 rounded-lg p-4 max-w-lg w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-amber-400">ê´€ë¦¬ ì„¤ì •</h2>
        <button id="close-registration-modal" class="text-2xl hover:text-gray-400">&times;</button>
      </div>

      <!-- ë©”ì¸ ê´€ë¦¬ ë²„íŠ¼ë“¤ -->
      <div id="management-menu" class="space-y-3 mb-4">
        <!-- ë²„íŠ¼ë“¤ -->
        <div class="grid grid-cols-2 gap-3">
          <button id="open-table-management-btn" class="bg-blue-600 hover:bg-blue-700 py-3 px-4 rounded-lg text-sm font-medium flex flex-col items-center">
            <span class="text-2xl mb-1">ğŸ¯</span>
            <span>í…Œì´ë¸” ì„ íƒ</span>
          </button>
          <button class="bg-gray-700 py-3 px-4 rounded-lg text-sm font-medium flex flex-col items-center opacity-50 cursor-not-allowed" disabled>
            <span class="text-2xl mb-1">ğŸ²</span>
            <span>ì¹© ê´€ë¦¬</span>
            <span class="text-xs text-gray-400">(ì¤€ë¹„ ì¤‘)</span>
          </button>
        </div>

        <!-- Apps Script URL ì„¤ì • -->
        <div class="bg-gray-700 p-3 rounded-lg">
          <label class="block text-sm font-medium text-gray-300 mb-2">
            Apps Script URL
            <span class="text-xs text-gray-500 ml-2">(ì¬ë°°í¬ í›„ ìƒˆ URL ì…ë ¥)</span>
          </label>
          <div class="space-y-2">
            <!-- í˜„ì¬ ì €ì¥ëœ URL í‘œì‹œ -->
            <div id="current-url-display" class="bg-gray-800 p-2 rounded border border-gray-600">
              <div class="text-xs text-gray-400 mb-1">í˜„ì¬ ì €ì¥ëœ URL:</div>
              <div id="management-current-url" class="text-xs text-amber-400 break-all font-mono"></div>
            </div>

            <!-- ì¬ë°°í¬ ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div class="bg-blue-900 border border-blue-700 p-2 rounded text-xs">
              <div class="text-blue-300 font-semibold mb-1">ğŸ“Œ Apps Script ì¬ë°°í¬ í•„ìš”</div>
              <div class="text-blue-200">
                "Unknown action: batchUpdate" ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´:
                <ol class="list-decimal list-inside mt-1 text-blue-100">
                  <li>apps-script/Code_v59_InOut.gs íŒŒì¼ ë³µì‚¬</li>
                  <li>Google Apps Scriptì— ë¶™ì—¬ë„£ê¸°</li>
                  <li>ë°°í¬ â†’ ìƒˆ ë°°í¬ ê´€ë¦¬ â†’ í¸ì§‘ â†’ ë²„ì „: ìƒˆ ë²„ì „</li>
                  <li>ìƒˆ URLì„ ì•„ë˜ì— ì…ë ¥í•˜ì—¬ ì €ì¥</li>
                </ol>
              </div>
            </div>

            <!-- URL ì…ë ¥ -->
            <input type="text" id="management-apps-url-input"
                   class="w-full bg-gray-600 text-white rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"
                   placeholder="ìƒˆ URLì„ ì…ë ¥í•˜ì„¸ìš”">

            <!-- ì €ì¥ ë²„íŠ¼ -->
            <button id="save-apps-url-btn" class="w-full bg-amber-600 hover:bg-amber-700 py-1.5 rounded text-sm font-medium">
              ğŸ’¾ ìƒˆ URL ì €ì¥
            </button>

            <!-- ì €ì¥ ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="url-save-status" class="hidden text-xs p-2 rounded"></div>

            <!-- ë™ê¸°í™” ìƒíƒœ í‘œì‹œ -->
            <div id="url-sync-status" class="text-xs text-gray-400 mt-2"></div>

            <!-- ë„ì›€ë§ -->
            <div class="text-xs text-gray-500 mt-2 p-2 bg-gray-700 rounded">
              ğŸ’¡ <strong>ì„œë²„ ë™ê¸°í™”:</strong> URLì„ ì €ì¥í•˜ë©´ ëª¨ë“  PC/ìŠ¤ë§ˆíŠ¸í°ì—ì„œ ìë™ìœ¼ë¡œ ì ìš©ë©ë‹ˆë‹¤
            </div>
          </div>
        </div>
      </div>

      <!-- í…Œì´ë¸” ê´€ë¦¬ ì„¹ì…˜ (ì´ˆê¸°ì— ìˆ¨ê¹€) -->
      <div id="player-management-content" class="space-y-3 hidden">
          <!-- ì„ íƒëœ í…Œì´ë¸” ì •ë³´ -->
          <div class="bg-gray-700 p-3 rounded-lg">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-bold text-amber-400">ì„ íƒëœ í…Œì´ë¸”</h4>
              <span id="sync-status" class="text-xs text-gray-400"></span>
            </div>
            <div id="selected-table-info" class="text-sm">
              <span id="selected-table-name" class="text-amber-400 font-bold"></span>
              <button id="change-table-btn" class="ml-2 text-xs bg-gray-600 hover:bg-gray-500 px-2 py-1 rounded">ë³€ê²½</button>
            </div>
          </div>

          <!-- ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ ì„¹ì…˜ -->
          <div id="player-add-section" class="bg-gray-700 p-3 rounded-lg hidden">
            <h4 class="text-sm font-bold mb-2 text-amber-400">í”Œë ˆì´ì–´ ì¶”ê°€</h4>
            <div class="grid grid-cols-3 gap-2 mb-2">
              <input type="text" id="new-player-name" class="bg-gray-600 px-2 py-1 rounded text-sm" placeholder="ì´ë¦„">
              <input type="number" id="new-player-seat" class="bg-gray-600 px-2 py-1 rounded text-sm" placeholder="ì¢Œì„" min="1" max="10">
              <input type="text" id="new-player-chips" class="bg-gray-600 px-2 py-1 rounded text-sm" placeholder="ì¹©">
            </div>
            <button id="add-player-local-btn" class="w-full bg-green-600 hover:bg-green-700 py-1 rounded text-sm">+ ì¶”ê°€</button>
          </div>

          <!-- í˜„ì¬ í”Œë ˆì´ì–´ ëª©ë¡ (10ê°œ ì‹œíŠ¸ ê³ ì •) -->
          <div id="player-list-section" class="bg-gray-700 p-3 rounded-lg hidden">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-bold text-amber-400">í”Œë ˆì´ì–´ ì‹œíŠ¸</h4>
              <span id="player-count" class="text-xs text-amber-300"></span>
            </div>
            <div id="current-players-list" class="h-auto">
              <!-- 10ê°œ ì‹œíŠ¸ê°€ ê³ ì •ìœ¼ë¡œ í‘œì‹œë¨ -->
            </div>
          </div>

          <!-- ì¼ê´„ ë“±ë¡ ë²„íŠ¼ -->
          <div id="batch-actions" class="hidden">
            <div class="flex gap-2 mb-2">
              <button id="reset-changes-btn" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded text-sm">
                â†©ï¸ ë³€ê²½ ì·¨ì†Œ
              </button>
              <button id="batch-register-btn" class="flex-1 bg-amber-600 hover:bg-amber-700 py-2 rounded text-sm font-bold">
                âœ… ì¼ê´„ ë“±ë¡
              </button>
            </div>
            <div id="changes-summary" class="mt-2 text-xs text-gray-400"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="log-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0">
    <div class="bg-gray-800 rounded-lg p-4 w-full max-w-lg h-2/3 flex flex-col">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-xl font-bold text-amber-400">ë¡œë”© ë¡œê·¸</h2>
        <button id="close-log-modal" class="text-2xl">&times;</button>
      </div>
      <div id="log-display" class="bg-gray-900/50 p-3 rounded-md flex-grow overflow-y-auto text-sm font-mono"></div>
    </div>
  </div>

  <!-- ì¹© ì»¬ëŸ¬ ì„ íƒ ëª¨ë‹¬ (ì¹´ë©”ë¼ ë˜ëŠ” íŒŒì¼) -->
  <div id="chip-color-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg p-4 max-w-md w-full">
        <h3 class="text-lg font-bold mb-3 text-amber-400">ì¹© ë“±ë¡</h3>
        
        <!-- ì„ íƒ ì˜µì…˜ -->
        <div id="chip-option-select" class="mb-4">
          <p class="text-sm text-gray-300 mb-3">ì¹© ì‚¬ì§„ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”:</p>
          <div class="grid grid-cols-2 gap-2">
            <button id="select-camera-btn" class="bg-blue-600 hover:bg-blue-700 p-3 rounded-lg flex flex-col items-center">
              <span class="text-2xl mb-1">ğŸ“·</span>
              <span class="text-sm">ì‚¬ì§„ ì´¬ì˜</span>
            </button>
            <button id="select-file-btn" class="bg-purple-600 hover:bg-purple-700 p-3 rounded-lg flex flex-col items-center">
              <span class="text-2xl mb-1">ğŸ“</span>
              <span class="text-sm">íŒŒì¼ ì„ íƒ</span>
            </button>
          </div>
        </div>
        
        <!-- ì¹´ë©”ë¼ ë·° (ìˆ¨ê¹€ ìƒíƒœ) -->
        <div id="camera-view" class="hidden">
          <video id="chip-video" class="w-full rounded-lg mb-3" autoplay playsinline></video>
          <canvas id="chip-canvas" class="hidden"></canvas>
        </div>
        
        <!-- ì´ë¯¸ì§€ í”„ë¦¬ë·° (ìˆ¨ê¹€ ìƒíƒœ) -->
        <div id="image-preview" class="hidden">
          <img id="preview-img" class="w-full rounded-lg mb-3" alt="ë¯¸ë¦¬ë³´ê¸°">
        </div>
        
        <!-- íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
        <input type="file" id="file-input" class="hidden" accept="image/*">
        
        <!-- ì¹© ê°’ ì…ë ¥ -->
        <input type="text" id="chip-value-input" class="w-full bg-gray-700 px-3 py-2 rounded mb-3" placeholder="ì¹© ê°’ (ì˜ˆ: 1000)">
        
        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="flex gap-2">
          <button id="capture-chip-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium hidden">ì´¬ì˜</button>
          <button id="confirm-chip-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium hidden">í™•ì¸</button>
          <button id="retry-chip-btn" class="flex-1 bg-yellow-600 hover:bg-yellow-700 py-2 rounded-lg font-medium hidden">ë‹¤ì‹œì„ íƒ</button>
          <button id="close-chip-modal" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-medium">ì·¨ì†Œ</button>
        </div>
        
        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <div id="chip-info-message" class="mt-3 text-xs text-gray-400 text-center">
          ğŸ’¡ PCì—ì„œëŠ” íŒŒì¼ ì„ íƒ, ëª¨ë°”ì¼ì—ì„œëŠ” ì¹´ë©”ë¼ ì´¬ì˜ì„ ê¶Œì¥í•©ë‹ˆë‹¤
        </div>
      </div>
    </div>
  </div>

  <!-- ì¹© ìŠ¤íƒ ë¶„ì„ ëª¨ë‹¬ -->
  <div id="stack-analysis-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg p-4 max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <h3 class="text-lg font-bold mb-3 text-amber-400">
          <span id="analyzing-player-name">í”Œë ˆì´ì–´</span> ì¹© ìŠ¤íƒ ë¶„ì„
        </h3>
        <div id="stack-images-container" class="grid grid-cols-2 gap-2 mb-3"></div>
        <video id="stack-video" class="w-full rounded-lg mb-3" autoplay playsinline></video>
        <canvas id="stack-canvas" class="hidden"></canvas>
        <div class="flex gap-2 mb-3">
          <button id="capture-stack-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded-lg font-medium">ì‚¬ì§„ ì¶”ê°€</button>
          <button id="analyze-stack-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium" disabled>AI ë¶„ì„</button>
        </div>
        <button id="close-stack-modal" class="w-full bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-medium">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- AI ë¶„ì„ ì¤‘ ì˜¤ë²„ë ˆì´ -->
  <div id="analyzing-overlay" class="fixed inset-0 bg-black bg-opacity-80 hidden z-[60]">
    <div class="flex items-center justify-center h-full">
      <div class="bg-gray-900 rounded-lg p-6 text-center">
        <div class="text-3xl mb-3 pulse-animation">ğŸ¤–</div>
        <p class="text-lg font-medium mb-2">AI ë¶„ì„ ì¤‘...</p>
        <p class="text-sm text-gray-400">ì¹© ìŠ¤íƒì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
      </div>
    </div>
  </div>

  <!-- í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ -->
  <div id="table-selector-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-2">
      <div class="bg-gray-800 rounded-lg w-full max-w-md h-full max-h-screen flex flex-col">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between p-4 border-b border-gray-700">
          <h3 class="text-lg font-bold text-amber-400">ğŸ¯ í…Œì´ë¸” ì„ íƒ</h3>
          <button id="close-table-selector" class="text-gray-400 hover:text-white text-xl">Ã—</button>
        </div>
        
        <!-- ê²€ìƒ‰ ë° í•„í„° -->
        <div class="p-4 border-b border-gray-700">
          <input type="text" id="table-search" placeholder="í…Œì´ë¸” ë²ˆí˜¸ ë˜ëŠ” í”Œë ˆì´ì–´ ê²€ìƒ‰..." 
                 class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm mb-3">
          <div class="flex gap-2 flex-wrap">
            <button id="filter-all" class="filter-btn px-3 py-1 rounded-full text-xs bg-blue-600 text-white">ì „ì²´</button>
            <button id="filter-active" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-600 hover:bg-gray-500">í™œì„±</button>
            <button id="filter-empty" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-600 hover:bg-gray-500">ë¹ˆí…Œì´ë¸”</button>
          </div>
        </div>
        
        <!-- í˜ì´ì§€ í† ê¸€ -->
        <div class="px-4 py-2 border-b border-gray-700">
          <div class="flex items-center justify-between">
            <button id="prev-page" class="px-3 py-1 bg-gray-600 rounded hover:bg-gray-500 disabled:opacity-50">â—€</button>
            <span id="page-info" class="text-sm text-gray-400">1-20 / 100</span>
            <button id="next-page" class="px-3 py-1 bg-gray-600 rounded hover:bg-gray-500 disabled:opacity-50">â–¶</button>
          </div>
        </div>
        
        <!-- í…Œì´ë¸” ê·¸ë¦¬ë“œ -->
        <div class="flex-1 overflow-y-auto p-4">
          <div id="table-grid" class="grid grid-cols-4 gap-2">
            <!-- í…Œì´ë¸” ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settings-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg w-full max-w-lg">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between p-4 border-b border-gray-700">
          <h3 class="text-lg font-bold text-amber-400">âš™ï¸ ì„¤ì •</h3>
          <button id="close-settings" class="text-gray-400 hover:text-white text-xl">Ã—</button>
        </div>
        
        <!-- ì„¤ì • ë‚´ìš© -->
        <div class="p-4 space-y-4">
          <!-- Apps Script URL ì„¤ì • -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
              Apps Script URL
              <span class="text-xs text-gray-500 ml-2">(ì¬ë°°í¬ í›„ ìƒˆ URL ì…ë ¥)</span>
            </label>
            <div class="space-y-2">
              <input type="text" id="apps-script-url-input"
                     class="w-full bg-gray-700 text-white rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"
                     placeholder="https://script.google.com/macros/s/.../exec">
              <div class="text-xs text-gray-500">
                í˜„ì¬: <span id="current-apps-url" class="text-gray-400 break-all"></span>
              </div>

              <!-- í´ë¼ìš°ë“œ ë™ê¸°í™” ìƒíƒœ -->
              <div class="bg-gray-700 rounded-md p-3 space-y-2">
                <div class="flex items-center justify-between">
                  <span class="text-xs font-medium text-gray-300">â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”</span>
                  <span id="cloud-sync-status" class="text-xs px-2 py-1 rounded-full bg-gray-600 text-gray-400">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="text-xs text-gray-500 space-y-1">
                  <div>ê¸°ê¸° ID: <span id="device-id-display" class="text-gray-400 font-mono text-xs"></span></div>
                  <div id="last-sync-display" class="hidden">ë§ˆì§€ë§‰ ë™ê¸°í™”: <span class="text-gray-400"></span></div>
                </div>
                <div class="flex space-x-2">
                  <button id="sync-now-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-xs py-1.5 px-3 rounded transition-colors">
                    ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”
                  </button>
                  <button id="reset-cloud-btn" class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded transition-colors">
                    ğŸ—‘ï¸ ì´ˆê¸°í™”
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ì¹© ìŠ¤íƒ ê²€ì¦ ì„¤ì • -->
          <div>
            <label class="flex items-center space-x-2">
              <input type="checkbox" id="chip-validation-toggle" class="rounded text-amber-500 focus:ring-amber-500">
              <span class="text-sm font-medium text-gray-300">ì¹© ìŠ¤íƒ ê²€ì¦ í™œì„±í™”</span>
            </label>
            <p class="text-xs text-gray-500 mt-1 ml-6">
              í™œì„±í™” ì‹œ ë³´ìœ  ì¹©ë³´ë‹¤ í° ê¸ˆì•¡ ì…ë ¥ì„ ì œí•œí•©ë‹ˆë‹¤
            </p>
          </div>
          
          <!-- ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ ì„¤ì • -->
          <div>
            <label class="flex items-center space-x-2">
              <input type="checkbox" id="action-input-mode-toggle" class="rounded text-amber-500 focus:ring-amber-500">
              <span class="text-sm font-medium text-gray-300">ìë™ ì•¡ì…˜ ë§¤í•‘ ëª¨ë“œ</span>
            </label>
            <p class="text-xs text-gray-500 mt-1 ml-6">
              í™œì„±í™” ì‹œ ì•¡ì…˜ì´ ìˆœì„œëŒ€ë¡œ ìë™ ë§¤í•‘ë©ë‹ˆë‹¤ (í”Œë ˆì´ì–´ ì„ íƒ ë¶ˆí•„ìš”)
            </p>
          </div>
          
          <!-- ë²„ì „ ì •ë³´ -->
          <div class="pt-2 border-t border-gray-700">
            <div class="text-xs text-gray-500 space-y-1">
              <div>ë²„ì „: <span class="text-gray-400">${APP_VERSION}</span></div>
              <div>ì—…ë°ì´íŠ¸: <span class="text-gray-400">${VERSION_DATE}</span></div>
              <div>Sheet ID: <span class="text-gray-400 text-xs">1J-lf8bYTLPbpdhieUNdb8ckW_uwdQ3MtSBLmyRIwH7U</span></div>
            </div>
          </div>
        </div>
        
        <!-- í‘¸í„° -->
        <div class="flex justify-end gap-2 p-4 border-t border-gray-700">
          <button id="cancel-settings" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-md text-sm font-medium">
            ì·¨ì†Œ
          </button>
          <button id="save-settings" class="px-4 py-2 bg-amber-600 hover:bg-amber-500 rounded-md text-sm font-medium">
            ì €ì¥
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
  /**
   * ============================================
   * í¬ì»¤ í•¸ë“œ ë¡œê±° - Main JavaScript
   * ë²„ì „ ê´€ë¦¬ëŠ” APP_VERSION ìƒìˆ˜ë¥¼ í†µí•´ ì¤‘ì•™í™”ë¨
   * Author: garimto81 with Claude
   * ============================================
   */
  
  // ========================================
  // ì¤‘ì•™ ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ
  // ========================================
  const APP_VERSION = 'v3.4.21';
  const VERSION_DATE = '2025-09-18';
  const VERSION_INFO = `í¬ì»¤ í•¸ë“œ ë¡œê±° ${APP_VERSION} (${VERSION_DATE})`;

  // ========================================
  // ìŠ¤íŠ¸ë¦¿ ìë™ ì§„í–‰ ì‹œìŠ¤í…œ v2.0 - ì™„ë²½í•œ ë³´ì•ˆ êµ¬í˜„
  // ========================================

  // Layer 1: ì‹œí€€ìŠ¤ ê¸°ë°˜ íƒ€ì„ìŠ¤íƒ¬í”„ (ë¡œê¹… ì „ìš©)
  class SequentialTimekeeper {
    constructor() {
      this.sequence = 0;
      this.lastTimestamp = Date.now();
    }

    generateTimestamp() {
      const now = Date.now();
      this.sequence++;

      // ë¡œê¹…ë§Œ í•˜ê³  í•­ìƒ ìœ íš¨í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ë°˜í™˜
      console.log(`ì•¡ì…˜ íƒ€ì„ìŠ¤íƒ¬í”„: #${this.sequence} at ${new Date(now).toLocaleTimeString()}`);

      return {
        sequence: this.sequence,
        timestamp: now,
        hash: this.hashTimestamp(this.sequence, now)
      };
    }

    validateAndUpdate(actionTimestamp) {
      // í•­ìƒ true ë°˜í™˜ - ëª¨ë“  ì•¡ì…˜ í—ˆìš©
      this.lastTimestamp = actionTimestamp.timestamp;
      return true;
    }

    hashTimestamp(sequence, timestamp) {
      return btoa(`${sequence}-${timestamp}-${window.location.hostname}`);
    }
  }

  // Layer 2: íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§ (ë¡œê¹… ì „ìš©)
  class RateLimiter {
    constructor() {
      this.attempts = new Map();
      this.actionCount = 0;
    }

    check(playerId, actionType = 'action') {
      const now = Date.now();
      const window = 1000;

      // ì•¡ì…˜ ì¹´ìš´íŠ¸ ì¦ê°€
      this.actionCount++;

      // í†µê³„ ë¡œê¹…ë§Œ
      const key = `${playerId}-${Math.floor(now / window)}`;
      const attempts = this.attempts.get(key) || 0;
      this.attempts.set(key, attempts + 1);

      if (attempts >= 3) {
        console.log(`ë¹ ë¥¸ ì•¡ì…˜ ê°ì§€: ${playerId} - ${attempts + 1}íšŒ/ì´ˆ`);
      }

      // ì˜¤ë˜ëœ ê¸°ë¡ ì •ë¦¬
      if (this.attempts.size > 100) {
        const oldKeys = Array.from(this.attempts.keys()).slice(0, 50);
        oldKeys.forEach(k => this.attempts.delete(k));
      }

      // í•­ìƒ true ë°˜í™˜ - ëª¨ë“  ì•¡ì…˜ í—ˆìš©
      return true;
    }
  }

  // Layer 3: ìƒíƒœ ëª¨ë‹ˆí„°ë§ (ìë™ ì ì‘)
  class StateValidator {
    constructor() {
      this.knownPlayers = new Set();
      this.stateHash = null;
    }

    initialize(players) {
      // ì´ˆê¸° í”Œë ˆì´ì–´ ë“±ë¡
      players.forEach(p => this.knownPlayers.add(p.name));
      this.stateHash = this.calculateHash(players);
    }

    validatePlayer(playerName) {
      // ìƒˆ í”Œë ˆì´ì–´ ìë™ ì¶”ê°€
      if (!this.knownPlayers.has(playerName)) {
        console.log(`ìƒˆ í”Œë ˆì´ì–´ ìë™ ë“±ë¡: ${playerName}`);
        this.knownPlayers.add(playerName);

        // playersInHandì—ë„ ìë™ ì¶”ê°€
        if (!window.state.playersInHand.find(p => p.name === playerName)) {
          window.state.playersInHand.push({
            name: playerName,
            chips: '100000', // ê¸°ë³¸ ì¹©
            initialChips: '100000',
            hand: [],
            role: null
          });
        }
      }
      return true; // í•­ìƒ true ë°˜í™˜
    }

    validateState(state) {
      // ìƒíƒœ ë¡œê¹…ë§Œ
      console.log(`í˜„ì¬ í”Œë ˆì´ì–´ ìˆ˜: ${state.playersInHand.length}`);
      return true; // í•­ìƒ true ë°˜í™˜
    }

    updateState() {
      // ìƒíƒœ ì—…ë°ì´íŠ¸ (ë¡œê¹…ìš©)
      console.log('ìƒíƒœ ì—…ë°ì´íŠ¸');
      return true;
    }

    calculateHash(data) {
      return JSON.stringify(data).split('').reduce((a, b) => {
        a = ((a << 5) - a) + b.charCodeAt(0);
        return a & a;
      }, 0).toString(16);
    }
  }

  // ë©”ì¸ ì•¡ì…˜ ê´€ë¦¬ì (ê¸°ì¡´ + ë³´ì•ˆ ê°•í™”)
  class ActionOrderManager {
    constructor() {
      this.currentStreet = 'preflop';
      this.currentPlayerIndex = 0;
      this.actionMode = 'auto'; // 'auto' | 'manual'
      this.actionQueue = [];
      this.bettingRoundComplete = false;

      // ë³´ì•ˆ ë ˆì´ì–´ ì¶”ê°€
      this.timekeeper = new SequentialTimekeeper();
      this.rateLimiter = new RateLimiter();
      this.stateValidator = new StateValidator();

      // ì•¡ì…˜ ë®¤í…ìŠ¤ (ë™ì‹œ ì‹¤í–‰ ë°©ì§€)
      this.isProcessing = false;
    }

    // í¬ì§€ì…˜ë³„ ì•¡ì…˜ ìˆœì„œ ê³„ì‚°
    calculateActionOrder(street) {
      const playersInHand = window.state.playersInHand || [];
      if (playersInHand.length === 0) return [];

      const buttonPosition = parseInt(window.state.buttonPosition) || 1;
      const activePlayers = this.getActivePlayers(playersInHand);

      if (street === 'preflop') {
        return this.getPreflopOrder(activePlayers, buttonPosition);
      } else {
        return this.getPostflopOrder(activePlayers, buttonPosition);
      }
    }

    // í™œì„± í”Œë ˆì´ì–´ í•„í„°ë§ (í´ë“œ/ì˜¬ì¸ ì œì™¸)
    getActivePlayers(players) {
      return players.filter(p =>
        window.state.playerStatus[p.name] !== 'folded' &&
        window.state.playerStatus[p.name] !== 'allin'
      );
    }

    // í”„ë¦¬í”Œë ìˆœì„œ (UTG â†’ BTN â†’ SB â†’ BB)
    getPreflopOrder(players, buttonPosition) {
      if (players.length === 0) return [];

      const seatMap = {};
      players.forEach(p => {
        if (p.seat) seatMap[p.seat] = p;
      });

      const occupiedSeats = Object.keys(seatMap).map(Number).sort((a, b) => a - b);
      const order = [];

      // UTGë¶€í„° ì‹œì‘í•˜ì—¬ BTNê¹Œì§€
      let utgSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      if (occupiedSeats.length > 2) {
        utgSeat = this.getNextOccupiedSeat(utgSeat, occupiedSeats); // SB ìŠ¤í‚µ
        utgSeat = this.getNextOccupiedSeat(utgSeat, occupiedSeats); // BB ìŠ¤í‚µ
      }

      let currentSeat = utgSeat;
      const visited = new Set();

      while (!visited.has(currentSeat) && order.length < players.length) {
        visited.add(currentSeat);
        if (seatMap[currentSeat]) {
          order.push(seatMap[currentSeat]);
        }
        currentSeat = this.getNextOccupiedSeat(currentSeat, occupiedSeats);

        // BTNê¹Œì§€ ë„ë‹¬í–ˆìœ¼ë©´ SB, BB ì¶”ê°€
        if (currentSeat === buttonPosition) {
          if (seatMap[currentSeat]) order.push(seatMap[currentSeat]);

          // SB ì¶”ê°€
          const sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
          if (seatMap[sbSeat]) order.push(seatMap[sbSeat]);

          // BB ì¶”ê°€
          const bbSeat = this.getNextOccupiedSeat(sbSeat, occupiedSeats);
          if (seatMap[bbSeat]) order.push(seatMap[bbSeat]);
          break;
        }
      }

      return order;
    }

    // í¬ìŠ¤íŠ¸í”Œë ìˆœì„œ (SB â†’ BB â†’ UTG â†’ BTN)
    getPostflopOrder(players, buttonPosition) {
      if (players.length === 0) return [];

      const seatMap = {};
      players.forEach(p => {
        if (p.seat) seatMap[p.seat] = p;
      });

      const occupiedSeats = Object.keys(seatMap).map(Number).sort((a, b) => a - b);
      const order = [];

      // SBë¶€í„° ì‹œì‘
      let sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      let currentSeat = sbSeat;
      const visited = new Set();

      while (!visited.has(currentSeat) && order.length < players.length) {
        visited.add(currentSeat);
        if (seatMap[currentSeat]) {
          order.push(seatMap[currentSeat]);
        }
        currentSeat = this.getNextOccupiedSeat(currentSeat, occupiedSeats);
      }

      return order;
    }

    // ë‹¤ìŒ ì ìœ ëœ ì¢Œì„ ì°¾ê¸°
    getNextOccupiedSeat(currentSeat, occupiedSeats) {
      const maxSeat = Math.max(...occupiedSeats);
      let nextSeat = currentSeat + 1;

      while (nextSeat <= maxSeat + occupiedSeats.length) {
        const seat = ((nextSeat - 1) % maxSeat) + 1;
        if (occupiedSeats.includes(seat)) {
          return seat;
        }
        nextSeat++;
      }

      return occupiedSeats[0];
    }

    // í˜„ì¬ ì•¡ì…˜í•  í”Œë ˆì´ì–´ ë°˜í™˜
    getCurrentActionPlayer() {
      if (this.actionMode === 'manual') return null;

      const actionOrder = this.calculateActionOrder(this.currentStreet);
      if (actionOrder.length === 0) return null;

      return actionOrder[this.currentPlayerIndex % actionOrder.length];
    }

    // ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ì´ë™
    moveToNextPlayer() {
      const actionOrder = this.calculateActionOrder(this.currentStreet);
      if (actionOrder.length === 0) return null;

      this.currentPlayerIndex++;

      // ë² íŒ… ë¼ìš´ë“œ ì™„ë£Œ ì²´í¬
      if (this.currentPlayerIndex >= actionOrder.length) {
        if (this.isBettingRoundComplete()) {
          this.advanceToNextStreet();
          return null;
        } else {
          this.currentPlayerIndex = 0; // ë‹¤ì‹œ ì²˜ìŒë¶€í„°
        }
      }

      return this.getCurrentActionPlayer();
    }

    // ë² íŒ… ë¼ìš´ë“œ ì™„ë£Œ ì—¬ë¶€ ì²´í¬ (íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ í¬í•¨)
    isBettingRoundComplete() {
      const actions = window.state.actionState[this.currentStreet] || [];
      const activePlayers = this.getActivePlayers(window.state.playersInHand || []);
      const allPlayers = window.state.playersInHand || [];

      // íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ 1: 1ëª…ë§Œ ë‚¨ì€ ê²½ìš° (ë‚˜ë¨¸ì§€ í´ë“œ)
      if (activePlayers.length <= 1) {
        console.log('ğŸ† 1ëª…ë§Œ ë‚¨ìŒ - ë¼ìš´ë“œ ì™„ë£Œ');
        return true;
      }

      // íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ 2: í—¤ì¦ˆì—…ì—ì„œ BB ì²´í¬ ì˜µì…˜
      if (allPlayers.length === 2 && this.currentStreet === 'preflop') {
        const bbPlayer = this.getBigBlindPlayer();
        const sbPlayer = this.getSmallBlindPlayer();

        if (bbPlayer && sbPlayer) {
          const bbActions = actions.filter(a => a.player === bbPlayer.name);
          const sbActions = actions.filter(a => a.player === sbPlayer.name);

          // SBê°€ ì½œí–ˆê³  BBê°€ ì²´í¬í•œ ê²½ìš°
          if (sbActions.some(a => a.action === 'Calls') &&
              bbActions.some(a => a.action === 'Checks')) {
            console.log('ğŸ¯ í—¤ì¦ˆì—… BB ì²´í¬ - ë¼ìš´ë“œ ì™„ë£Œ');
            return true;
          }
        }
      }

      // íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ 3: ëª¨ë“  í™œì„± í”Œë ˆì´ì–´ê°€ ì˜¬ì¸ì¸ ê²½ìš°
      const allActiveAreAllIn = activePlayers.every(p =>
        window.state.playerStatus[p.name] === 'allin'
      );
      if (allActiveAreAllIn && activePlayers.length > 0) {
        console.log('ğŸš€ ëª¨ë“  í”Œë ˆì´ì–´ ì˜¬ì¸ - ë¼ìš´ë“œ ì™„ë£Œ');
        return true;
      }

      // ì¼ë°˜ ì¼€ì´ìŠ¤: ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜í–ˆëŠ”ì§€ í™•ì¸
      const playersActed = new Set(actions.map(a => a.player));
      const allActed = activePlayers.every(p => playersActed.has(p.name));

      if (!allActed) return false;

      // ë² íŒ… ê¸ˆì•¡ì´ ë§ëŠ”ì§€ í™•ì¸
      return this.areAllBetsEqual(activePlayers, actions);
    }

    // ë¹…ë¸”ë¼ì¸ë“œ í”Œë ˆì´ì–´ ì°¾ê¸°
    getBigBlindPlayer() {
      const buttonPosition = parseInt(window.state.buttonPosition) || 1;
      const players = window.state.playersInHand || [];
      const occupiedSeats = players.map(p => p.seat).filter(s => s).map(Number).sort((a, b) => a - b);

      if (occupiedSeats.length < 2) return null;

      const sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      const bbSeat = this.getNextOccupiedSeat(sbSeat, occupiedSeats);

      return players.find(p => p.seat === bbSeat);
    }

    // ìŠ¤ëª°ë¸”ë¼ì¸ë“œ í”Œë ˆì´ì–´ ì°¾ê¸°
    getSmallBlindPlayer() {
      const buttonPosition = parseInt(window.state.buttonPosition) || 1;
      const players = window.state.playersInHand || [];
      const occupiedSeats = players.map(p => p.seat).filter(s => s).map(Number).sort((a, b) => a - b);

      if (occupiedSeats.length < 2) return null;

      const sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      return players.find(p => p.seat === sbSeat);
    }

    // ëª¨ë“  ë² íŒ…ì´ ê°™ì€ì§€ í™•ì¸ (ì‚¬ì´ë“œíŒŸ ê³ ë ¤)
    areAllBetsEqual(players, actions) {
      const playerBets = {};

      // ê° í”Œë ˆì´ì–´ì˜ ì´ ë² íŒ… ê³„ì‚°
      actions.forEach(action => {
        if (!playerBets[action.player]) playerBets[action.player] = 0;

        if (action.action.includes('Call') || action.action.includes('Raise') || action.action.includes('Bet')) {
          playerBets[action.player] = action.amount || 0;
        } else if (action.action === 'All In') {
          const player = window.state.playersInHand.find(p => p.name === action.player);
          playerBets[action.player] = player ? parseInt(unformatNumber(player.chips), 10) : 0;
        }
      });

      const bets = Object.values(playerBets);
      const maxBet = Math.max(...bets, 0);

      // ì‚¬ì´ë“œíŒŸ ì¼€ì´ìŠ¤: ì˜¬ì¸ í”Œë ˆì´ì–´ê°€ ìˆëŠ” ê²½ìš°
      const hasAllIn = players.some(p => window.state.playerStatus[p.name] === 'allin');

      if (hasAllIn) {
        // ì˜¬ì¸ í”Œë ˆì´ì–´ë“¤ì˜ ë² íŒ… ê¸ˆì•¡
        const allInAmounts = players
          .filter(p => window.state.playerStatus[p.name] === 'allin')
          .map(p => playerBets[p.name] || 0);

        // ì•¡í‹°ë¸Œ í”Œë ˆì´ì–´ë“¤ì´ ìµœì†Œí•œ ì˜¬ì¸ ê¸ˆì•¡ ì´ìƒ ë² íŒ…í–ˆëŠ”ì§€ í™•ì¸
        return players.every(p => {
          const playerBet = playerBets[p.name] || 0;
          const isAllIn = window.state.playerStatus[p.name] === 'allin';

          if (isAllIn) {
            return true; // ì˜¬ì¸ í”Œë ˆì´ì–´ëŠ” í•­ìƒ OK
          }

          // ì•¡í‹°ë¸Œ í”Œë ˆì´ì–´ëŠ” ìµœëŒ€ ë² íŒ…ê³¼ ê°™ì•„ì•¼ í•¨
          return playerBet === maxBet;
        });
      }

      // ì¼ë°˜ ì¼€ì´ìŠ¤: ëª¨ë“  ì•¡í‹°ë¸Œ í”Œë ˆì´ì–´ì˜ ë² íŒ…ì´ ê°™ì•„ì•¼ í•¨
      return players.every(p => {
        const playerBet = playerBets[p.name] || 0;
        return playerBet === maxBet;
      });
    }

    // ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ì§„í–‰ (ë³´ì•ˆ ë ˆì´ì–´ í¬í•¨)
    async advanceToNextStreet() {
      const streets = ['preflop', 'flop', 'turn', 'river'];
      const currentIndex = streets.indexOf(this.currentStreet);

      if (currentIndex < streets.length - 1) {
        const nextStreet = streets[currentIndex + 1];

        // Layer 4: ë³´ë“œ ì¹´ë“œ ê²€ì¦
        if (nextStreet !== 'preflop' && !this.checkBoardCards(nextStreet)) {
          // ë³´ë“œ ì¹´ë“œ ì…ë ¥ í”„ë¡¬í”„íŠ¸
          this.promptForBoardCards(nextStreet);
          return;
        }

        // Layer 5: íŠ¸ëœì­ì…˜ ë³´í˜¸
        const transaction = this.startTransaction();
        try {
          // íƒ€ì„ìŠ¤íƒ¬í”„ ê²€ì¦
          const timestamp = this.timekeeper.generateTimestamp();

          // ìƒíƒœ ë³€ê²½
          this.currentStreet = nextStreet;
          this.currentPlayerIndex = 0;
          window.state.currentStreet = this.currentStreet;

          // ìƒíƒœ í•´ì‹œ ì—…ë°ì´íŠ¸
          this.stateValidator.updateState();

          console.log(`%cğŸ¯ ìë™ ì§„í–‰: ${this.currentStreet.toUpperCase()}`, 'color: #10b981; font-weight: bold');
          this.showStreetAdvanceNotification();

          // íŠ¸ëœì­ì…˜ ì»¤ë°‹
          transaction.commit();
        } catch (error) {
          // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ìµœëŒ€í•œ ì§„í–‰
          console.log('ìŠ¤íŠ¸ë¦¿ ì§„í–‰ ì¤‘ ì˜ˆì™¸:', error.message);
          transaction.rollback();
          // ê·¸ë˜ë„ ìŠ¤íŠ¸ë¦¿ì€ ì§„í–‰
          this.currentStreet = nextStreet;
          this.currentPlayerIndex = 0;
          window.state.currentStreet = this.currentStreet;
          this.showStreetAdvanceNotification();
        }
      }
    }

    // ë³´ë“œ ì¹´ë“œ í™•ì¸
    checkBoardCards(street) {
      const boardCards = window.state.boardCards || {};

      switch(street) {
        case 'flop':
          return boardCards.flop1 && boardCards.flop2 && boardCards.flop3;
        case 'turn':
          return boardCards.turn;
        case 'river':
          return boardCards.river;
        default:
          return true;
      }
    }

    // ë³´ë“œ ì¹´ë“œ ì…ë ¥ í”„ë¡¬í”„íŠ¸ (v3.4.7 - ì¹´ë“œ ì„ íƒ UI ì‚¬ìš©)
    promptForBoardCards(street) {
      // ì¹´ë“œ ì„ íƒ UI ì—´ê¸° (openCardSelector ì‚¬ìš©)
      window.state.modalState.cardTarget = {
        target: 'board',
        count: street === 'flop' ? 3 : 1,
        street: street,
        player: null,
        index: street === 'turn' ? 3 : street === 'river' ? 4 : 0
      };

      // ê¸°ì¡´ ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ ì‚¬ìš©
      openCardSelector();
    }

    // ë³´ë“œ ì¹´ë“œ ì €ì¥ (v3.4.7 - ì¹´ë“œ ì„ íƒ UIì™€ ì—°ë™)
    saveBoardCards(street) {
      // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì§ì ‘ í˜¸ì¶œë˜ì§€ ì•ŠìŒ
      // openCardSelectorì˜ assignCard í•¨ìˆ˜ê°€ ì²˜ë¦¬
      console.log('[v3.4.7] saveBoardCardsëŠ” deprecated - assignCard ì‚¬ìš©');
    }

    // ë³´ë“œ ì¹´ë“œ ê±´ë„ˆë›°ê¸° (v3.4.7 - ìˆ˜ì •ë¨)
    skipBoardCards(street) {
      console.log(`ë³´ë“œ ì¹´ë“œ ì…ë ¥ ê±´ë„ˆë›°ê¸°: ${street}`);
      // ë³´ë“œ ì¹´ë“œ ì—†ì´ ì§„í–‰
      this.currentStreet = street;
      this.currentPlayerIndex = 0;
      window.state.currentStreet = this.currentStreet;

      // showFeedback í•¨ìˆ˜ í™•ì¸
      if (typeof showFeedback === 'function') {
        showFeedback(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ì§„í–‰`, false);
      } else {
        console.log(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ì§„í–‰`);
      }
    }

    // íŠ¸ëœì­ì…˜ ì‹œì‘ (Layer 5)
    startTransaction() {
      const snapshot = {
        currentStreet: this.currentStreet,
        currentPlayerIndex: this.currentPlayerIndex,
        actionState: JSON.parse(JSON.stringify(window.state.actionState || {})),
        playerStatus: {...window.state.playerStatus}
      };

      return {
        commit: () => {
          console.log('íŠ¸ëœì­ì…˜ ì»¤ë°‹');
        },
        rollback: () => {
          this.currentStreet = snapshot.currentStreet;
          this.currentPlayerIndex = snapshot.currentPlayerIndex;
          window.state.actionState = snapshot.actionState;
          window.state.playerStatus = snapshot.playerStatus;
          console.error('íŠ¸ëœì­ì…˜ ë¡¤ë°±');
        }
      };
    }

    // ìŠ¤íŠ¸ë¦¿ ì§„í–‰ ì•Œë¦¼ (v3.4.7 - showFeedback í•¨ìˆ˜ ì²´í¬ ì¶”ê°€)
    showStreetAdvanceNotification() {
      if (typeof showFeedback === 'function') {
        showFeedback(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ìë™ ì§„í–‰`, false);
      } else {
        console.log(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ìë™ ì§„í–‰`);
      }
    }

    // ëª¨ë“œ ì „í™˜
    toggleMode() {
      this.actionMode = this.actionMode === 'auto' ? 'manual' : 'auto';
      console.log(`%cì•¡ì…˜ ëª¨ë“œ ë³€ê²½: ${this.actionMode}`, 'color: #f59e0b; font-weight: bold');
      return this.actionMode;
    }
  }

  // ì „ì—­ ì•¡ì…˜ ê´€ë¦¬ì ì¸ìŠ¤í„´ìŠ¤
  window.actionManager = new ActionOrderManager();

  // ëª¨ë“  ë²„ì „ í‘œì‹œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
  function updateAllVersionDisplays() {
    // ë²„ì „ í‘œì‹œ ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
    const versionDisplay = document.getElementById('version-display');
    if (versionDisplay) {
      versionDisplay.textContent = APP_VERSION;
    }
    
    // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
    document.title = `í¬ì»¤ í•¸ë“œ ë¡œê±° ${APP_VERSION}`;
    
    // ì½˜ì†”ì— ë²„ì „ ì •ë³´ ì¶œë ¥
    console.log(`%c${VERSION_INFO}`, 'color: #10b981; font-weight: bold; font-size: 14px');
  }
  
  // Gemini API ì„¤ì •
  const GEMINI_API_KEY = 'AIzaSyBB8uqP1ECTe40jknSy5XK71TCs8_KbGV0';
  const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
  
  // ë²„ì „ ì •ë³´ë¥¼ í•­ìƒ ì½˜ì†”ì— í‘œì‹œ
  console.log(`%c====================================`, 'color: #fbbf24');
  console.log(`%cğŸ¯ ${VERSION_INFO}`, 'color: #fbbf24; font-size: 18px; font-weight: bold');
  console.log(`%c====================================`, 'color: #fbbf24');
  console.log('%cğŸ“± AI ì¹© ìŠ¤íƒ ë¶„ì„ ê¸°ëŠ¥ í™œì„±í™”', 'color: #10b981');
  console.log('%cğŸ’¡ ê´€ë¦¬ ë²„íŠ¼ â†’ ì¹© ì»¬ëŸ¬ íƒ­ì—ì„œ ì¹© ë“±ë¡', 'color: #60a5fa');
  
  // ëª¨ë“  ì—ëŸ¬ë¥¼ ë¡œê·¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì˜¤ë¥˜ ë°©ì§€)
  const originalError = console.error;
  const originalWarn = console.warn;
  console.error = function(...args) {
    // console.logë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    console.log.apply(console, [`[${APP_VERSION}] INFO:`, ...args]);
  };
  console.warn = function(...args) {
    // console.logë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    console.log.apply(console, [`[${APP_VERSION}] NOTICE:`, ...args]);
  };
  
  document.addEventListener('DOMContentLoaded', () => {
    // ë²„ì „ í‘œì‹œ ì—…ë°ì´íŠ¸
    updateAllVersionDisplays();
    
    console.log(`%cğŸš€ ì•± ì´ˆê¸°í™” ì‹œì‘ - ${VERSION_INFO}`, 'color: #10b981; font-weight: bold');
    console.log('Initialized at', new Date().toISOString());
    
    // ì¹© ë¶„ì„ ëª¨ë“ˆ ì´ˆê¸°í™”ëŠ” state ê°ì²´ ìƒì„± í›„ì— ì§„í–‰
    
    // í™”ë©´ì— ë²„ì „ í‘œì‹œ ì—…ë°ì´íŠ¸
    const versionDisplay = document.getElementById('version-display');
    if(versionDisplay) {
      versionDisplay.textContent = `${APP_VERSION} (${VERSION_DATE})`;
    }
    
    // ====== CONFIG (í•„ìˆ˜: ì‹¤ì œ URLë¡œ êµì²´) ======
    // Apps Script URL ì„¤ì • (localStorageì—ì„œ ë¡œë“œ ë˜ëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©)
    const DEFAULT_APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwEcsF1F_RLLW_qkQIFkrwmut-zN0fHOqsAKs5B8PgHZAz2_O5sA8o2W5zZ3nD-5tjY/exec";
    let APPS_SCRIPT_URL = localStorage.getItem('appsScriptUrl') || DEFAULT_APPS_SCRIPT_URL;
    
    // CSV URLs (ê³ ì •)
    const CSV_HAND_URL  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1906746276&single=true&output=csv"; // Hand íƒ­ CSV
    const CSV_INDEX_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1354012271&single=true&output=csv"; // Index íƒ­ CSV (HandIndex ëŒ€ì‹  Index ì‚¬ìš©)
    const CSV_TYPE_URL  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=998576925&single=true&output=csv";
    
    // ì „ì—­ ë³€ìˆ˜ë¡œë„ ì„¤ì • (í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“ˆìš©)
    window.APPS_SCRIPT_URL = APPS_SCRIPT_URL;
    
    // Apps Script URL í´ë¼ìš°ë“œ ë™ê¸°í™” ì‹œìŠ¤í…œ
    const CLOUD_SYNC_CONFIG = {
      enabled: true,
      gistApiUrl: 'https://api.github.com/gists',
      configGistId: localStorage.getItem('configGistId') || null,
      deviceId: localStorage.getItem('deviceId') || generateDeviceId()
    };

    // ê¸°ê¸° IDë¥¼ localStorageì— ì €ì¥ (ì²˜ìŒ ìƒì„±ì‹œ)
    if (!localStorage.getItem('deviceId')) {
      localStorage.setItem('deviceId', CLOUD_SYNC_CONFIG.deviceId);
    }

    // ê³ ìœ  ê¸°ê¸° ID ìƒì„±
    function generateDeviceId() {
      const id = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
      localStorage.setItem('deviceId', id);
      return id;
    }

    // í´ë¼ìš°ë“œì—ì„œ ì„¤ì • ë¡œë“œ
    async function loadConfigFromCloud() {
      if (!CLOUD_SYNC_CONFIG.enabled || !CLOUD_SYNC_CONFIG.configGistId) {
        return null;
      }

      try {
        const response = await fetch(`${CLOUD_SYNC_CONFIG.gistApiUrl}/${CLOUD_SYNC_CONFIG.configGistId}`);
        if (response.ok) {
          const gist = await response.json();
          const configFile = gist.files['poker-config.json'];
          if (configFile) {
            const config = JSON.parse(configFile.content);
            console.log('â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ì„¤ì • ë¡œë“œ:', config);
            return config;
          }
        }
      } catch (error) {
        console.log('í´ë¼ìš°ë“œ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error.message);
      }
      return null;
    }

    // í´ë¼ìš°ë“œì— ì„¤ì • ì €ì¥
    async function saveConfigToCloud(appsScriptUrl) {
      if (!CLOUD_SYNC_CONFIG.enabled) return false;

      const config = {
        appsScriptUrl: appsScriptUrl,
        lastUpdated: new Date().toISOString(),
        deviceId: CLOUD_SYNC_CONFIG.deviceId,
        version: APP_VERSION
      };

      const gistContent = {
        description: 'Poker Hand Logger Configuration',
        public: false,
        files: {
          'poker-config.json': {
            content: JSON.stringify(config, null, 2)
          }
        }
      };

      try {
        let response;
        if (CLOUD_SYNC_CONFIG.configGistId) {
          // ê¸°ì¡´ Gist ì—…ë°ì´íŠ¸
          response = await fetch(`${CLOUD_SYNC_CONFIG.gistApiUrl}/${CLOUD_SYNC_CONFIG.configGistId}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(gistContent)
          });
        } else {
          // ìƒˆ Gist ìƒì„±
          response = await fetch(CLOUD_SYNC_CONFIG.gistApiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(gistContent)
          });
        }

        if (response.ok) {
          const gist = await response.json();
          CLOUD_SYNC_CONFIG.configGistId = gist.id;
          localStorage.setItem('configGistId', gist.id);
          console.log('â˜ï¸ ì„¤ì •ì´ í´ë¼ìš°ë“œì— ì €ì¥ë¨:', gist.id);
          return true;
        }
      } catch (error) {
        console.log('í´ë¼ìš°ë“œ ì €ì¥ ì‹¤íŒ¨:', error.message);
      }
      return false;
    }

    // Apps Script URL ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (í´ë¼ìš°ë“œ ë™ê¸°í™” í¬í•¨)
    async function updateAppsScriptUrl(newUrl, skipCloudSync = false) {
      if (newUrl && newUrl.trim()) {
        APPS_SCRIPT_URL = newUrl.trim();
        window.APPS_SCRIPT_URL = APPS_SCRIPT_URL;
        localStorage.setItem('appsScriptUrl', APPS_SCRIPT_URL);
        console.log('âœ… Apps Script URL ì—…ë°ì´íŠ¸:', APPS_SCRIPT_URL);

        // í´ë¼ìš°ë“œì— ì €ì¥ (ì˜µì…˜)
        if (!skipCloudSync && CLOUD_SYNC_CONFIG.enabled) {
          const cloudSaved = await saveConfigToCloud(APPS_SCRIPT_URL);
          if (cloudSaved) {
            showFeedback('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ë° í´ë¼ìš°ë“œ ë™ê¸°í™” ì™„ë£Œ');
          } else {
            showFeedback('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ì™„ë£Œ (ë¡œì»¬ ì €ì¥)');
          }
        } else {
          showFeedback('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }
        return true;
      }
      return false;
    }

    // ====== LOADING & UI LOCK SYSTEM ======
    let isUILocked = false;

    // UI ì „ì²´ ë¹„í™œì„±í™”
    function lockUI(title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      if (isUILocked) return; // ì´ë¯¸ ì ê¸ˆ ìƒíƒœë©´ ë¬´ì‹œ

      isUILocked = true;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
      if (el.loadingOverlay) {
        if (el.loadingTitle) el.loadingTitle.textContent = title;
        if (el.loadingMessage) el.loadingMessage.textContent = message;
        el.loadingOverlay.classList.remove('hidden');
      }

      // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('button').forEach(btn => {
        btn.disabled = true;
        btn.classList.add('opacity-50', 'cursor-not-allowed');
      });

      // ëª¨ë“  ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
      document.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = true;
        input.classList.add('opacity-50', 'cursor-not-allowed');
      });

      console.log(`ğŸ”’ UI ì ê¸ˆ: ${title}`);
    }

    // UI ì „ì²´ í™œì„±í™”
    function unlockUI() {
      if (!isUILocked) return; // ì´ë¯¸ í•´ì œ ìƒíƒœë©´ ë¬´ì‹œ

      isUILocked = false;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
      if (el.loadingOverlay) {
        el.loadingOverlay.classList.add('hidden');
      }

      // ëª¨ë“  ë²„íŠ¼ í™œì„±í™”
      document.querySelectorAll('button').forEach(btn => {
        btn.disabled = false;
        btn.classList.remove('opacity-50', 'cursor-not-allowed');
      });

      // ëª¨ë“  ì…ë ¥ í•„ë“œ í™œì„±í™”
      document.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = false;
        input.classList.remove('opacity-50', 'cursor-not-allowed');
      });

      console.log('ğŸ”“ UI ì ê¸ˆ í•´ì œ');
    }

    // ì‘ì—… ì‹¤í–‰ ë˜í¼ (ìë™ UI ì ê¸ˆ/í•´ì œ)
    async function executeWithLock(asyncFunction, title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      try {
        lockUI(title, message);
        await asyncFunction();
      } catch (error) {
        console.log('ì‘ì—… ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:', error);
        showFeedback('ì‘ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, true);
      } finally {
        unlockUI();
      }
    }

    // í´ë¼ìš°ë“œ ë™ê¸°í™” UI ì—…ë°ì´íŠ¸
    function updateCloudSyncUI() {
      if (!el.cloudSyncStatus || !el.deviceIdDisplay) return;

      // ê¸°ê¸° ID í‘œì‹œ
      el.deviceIdDisplay.textContent = CLOUD_SYNC_CONFIG.deviceId.substring(0, 8) + '...';

      // ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
      if (CLOUD_SYNC_CONFIG.enabled && CLOUD_SYNC_CONFIG.configGistId) {
        el.cloudSyncStatus.textContent = 'ì—°ê²°ë¨';
        el.cloudSyncStatus.className = 'text-xs px-2 py-1 rounded-full bg-green-600 text-white';

        // ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„ í‘œì‹œ
        const lastSync = localStorage.getItem('lastCloudSync');
        if (lastSync && el.lastSyncDisplay) {
          const syncDate = new Date(lastSync);
          el.lastSyncDisplay.querySelector('span').textContent = syncDate.toLocaleString('ko-KR');
          el.lastSyncDisplay.classList.remove('hidden');
        }
      } else {
        el.cloudSyncStatus.textContent = 'ë¯¸ì—°ê²°';
        el.cloudSyncStatus.className = 'text-xs px-2 py-1 rounded-full bg-gray-600 text-gray-400';
        if (el.lastSyncDisplay) {
          el.lastSyncDisplay.classList.add('hidden');
        }
      }
    }

    // ìˆ˜ë™ í´ë¼ìš°ë“œ ë™ê¸°í™”
    async function syncCloudNow() {
      if (!CLOUD_SYNC_CONFIG.enabled) {
        showFeedback('í´ë¼ìš°ë“œ ë™ê¸°í™”ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤', true);
        return;
      }

      await executeWithLock(async () => {
        // í˜„ì¬ ì„¤ì •ì„ í´ë¼ìš°ë“œì— ì €ì¥
        await saveConfigToCloud(APPS_SCRIPT_URL);
        localStorage.setItem('lastCloudSync', new Date().toISOString());

        // UI ì—…ë°ì´íŠ¸
        updateCloudSyncUI();
        showFeedback('â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™” ì™„ë£Œ');
      }, 'í´ë¼ìš°ë“œ ë™ê¸°í™”', 'Apps Script URLì„ í´ë¼ìš°ë“œì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
    }

    // í´ë¼ìš°ë“œ ì„¤ì • ì´ˆê¸°í™” (Phase 2: ë”ë¸”íƒ­ ì ìš©)
    function resetCloudConfig() {
      // ì‹¤ì œ ì´ˆê¸°í™” ë¡œì§
      const performReset = () => {
        // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ í´ë¼ìš°ë“œ ê´€ë ¨ ì •ë³´ ì œê±°
        localStorage.removeItem('configGistId');
        localStorage.removeItem('lastCloudSync');
        CLOUD_SYNC_CONFIG.configGistId = null;

        // UI ì—…ë°ì´íŠ¸
        updateCloudSyncUI();

        // ìŠ¤ë‚µë°”ë¡œ í”¼ë“œë°±
        if (window.actionHistory) {
          window.actionHistory.showSnackbar('â˜ï¸ í´ë¼ìš°ë“œ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', null, 'success');
        } else {
          showFeedback('í´ë¼ìš°ë“œ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }
      };

      // ì¦‰ì‹œ ì‹¤í–‰ (ë”ë¸”íƒ­ì€ ë‚˜ì¤‘ì— ì„¤ì • ê°€ëŠ¥)
      performReset();
    }

    // ì•± ì‹œì‘ ì‹œ í´ë¼ìš°ë“œ ì„¤ì • í™•ì¸
    async function initializeAppConfig() {
      const cloudConfig = await loadConfigFromCloud();
      if (cloudConfig && cloudConfig.appsScriptUrl) {
        // í´ë¼ìš°ë“œ ì„¤ì •ì´ ë” ìµœì‹ ì¸ ê²½ìš° ì ìš©
        const localUpdated = localStorage.getItem('appsScriptUrlUpdatedAt');
        const cloudUpdated = cloudConfig.lastUpdated;

        if (!localUpdated || (cloudUpdated && new Date(cloudUpdated) > new Date(localUpdated))) {
          console.log('â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ìµœì‹  ì„¤ì • ì ìš©');
          await updateAppsScriptUrl(cloudConfig.appsScriptUrl, true);
          localStorage.setItem('appsScriptUrlUpdatedAt', cloudConfig.lastUpdated);
        }
      }
    }

    // ì´ˆê¸°í™” ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìˆ˜í–‰)
    initializeAppConfig().catch(err => console.log('í´ë¼ìš°ë“œ ì„¤ì • ì´ˆê¸°í™” ì‹¤íŒ¨:', err.message));

    // ====== STATE ======
    let timeUpdater;
    window.state = {
      currentStreet: 'preflop',  // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ìŠ¤íŠ¸ë¦¬íŠ¸
      camNumbers: { cam1no:'', cam2no:'' }, // íŒŒì¼ ë„˜ë²„ ì…ë ¥ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì €ì¥
      lastCamNo: null,        // ë§ˆì§€ë§‰ ì…ë ¥ ì¶”ì (ì—°ì† ì¦ê°€ ê¸°ë³¸ê°’ ì œê³µìš©)

      playerDataByTable: {},     // { [table]: [{name, chips, notable}] }
      camPreset: { cam1:'', cam2:'' }, // Type!A2/A3
      allTables: [],
      indexRows: [],             // [{handNumber, handUpdatedAt, table, ...}]
      allHandNumbers: [],        // latest numbers (from Index)
      handCsvCache: null,        // raw rows for on-demand hand parsing
      allHandData: {},           // { [handNumber]: parsed hand block (latest) }
      selectedTable: null,
      playersInHand: [],
      board: [],
      playerStatus: {},          // { playerName: 'active' | 'folded' | 'allin' }
      buttonPosition: null,      // ë²„íŠ¼ ìœ„ì¹˜ (seat ë²ˆí˜¸)
      seatMap: {},              // { seat: playerName } 10ê°œ ì¢Œì„ ë§¤í•‘
      nextActionSeat: null,      // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´ ì¢Œì„
      
      // ì•¡ì…˜ ìë™ ë§¤í•‘ ì‹œìŠ¤í…œ
      actionInputMode: localStorage.getItem('actionInputMode') || 'auto', // 'auto' | 'manual'
      currentActionIndex: 0,     // í˜„ì¬ ì•¡ì…˜ ìˆœì„œ ì¸ë±ìŠ¤
      actionQueue: [],          // ì•¡ì…˜ ìˆœì„œ ëŒ€ê¸°ì—´
      nextActionPlayer: null,    // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´
      smartCheckCall: true,      // ìŠ¤ë§ˆíŠ¸ Check/Call ë²„íŠ¼ ì‚¬ìš©
      actionState: {
        handNumber: '',
        smallBlind: '', bigBlind: '', hasBBAnte: false,
        preflop: [], flop: [], turn: [], river: [],
      },
      modalState: {
        cardTarget: null,
        actionPadStreet: null, actionPadPlayer: null, actionPadCurrentAction: null,
        keypadTarget: null, keypadOptions: {},
      },
      selectedTimezone: 'Asia/Seoul',
      // ì¹© ë¶„ì„ ê´€ë ¨ ìƒíƒœ
      chipColors: [], // [{color: '#fff', value: 1000, image: 'base64...'}]
      maxChips: 5,
      currentChipSlot: null,
      playerStacks: {}, // {playerName: {images: [], estimatedStack: 0, analysis: ''}}
      currentAnalyzingPlayer: null,
      stackImages: [] // í˜„ì¬ ì´¬ì˜ ì¤‘ì¸ ìŠ¤íƒ ì´ë¯¸ì§€ë“¤
    };

    // ì¹© ë¶„ì„ ëª¨ë“ˆ ì´ˆê¸°í™” (state ê°ì²´ ìƒì„± í›„)
    if (typeof initChipAnalyzer === 'function') {
      setTimeout(() => {
        initChipAnalyzer();
        console.log('âœ… AI ì¹© ë¶„ì„ ëª¨ë“ˆ í™œì„±í™”');
      }, 100);
    }

    // ====== CONSTS ======
    const SUITS = { s:'â™ ', h:'â™¥', d:'â™¦', c:'â™£' };
    const RANKS = ['A','K','Q','J','10','9','8','7','6','5','4','3','2'];

    // ====== EL ======
    const el = {
      refreshDataBtn: document.getElementById('refresh-data'),
      tableSelectorBtn: document.getElementById('table-selector-btn'),
      selectedTableDisplay: document.getElementById('selected-table-display'),
      tableSelectorModal: document.getElementById('table-selector-modal'),
      playerSelectionButtons: document.getElementById('player-selection-buttons'),
      boardCardPlaceholders: document.getElementById('board-card-placeholders'),
      playerDetailsSection: document.getElementById('player-details-section'),
      handNumberDisplay: document.getElementById('hand-number-display'),
      loadHandBtn: document.getElementById('load-hand-btn'),
      smallBlindInput: document.getElementById('small-blind-input'),
      bigBlindInput: document.getElementById('big-blind-input'),
      bbAnteCheckbox: document.getElementById('bb-ante-checkbox'),
      streetLogsContainer: document.getElementById('street-logs-container'),
      winnerButtons: document.getElementById('winner-buttons'),
      sendToSheetBtn: document.getElementById('send-to-sheet-btn'),
      resetBtn: document.getElementById('reset-btn'),
      feedbackMessage: document.getElementById('feedback-message'),
      logDisplay: document.getElementById('log-display'),
      logModal: document.getElementById('log-modal'),
      showLogBtn: document.getElementById('show-log-btn'),
      closeLogModalBtn: document.getElementById('close-log-modal'),
      cardSelectorModal: document.getElementById('card-selector-modal'),
      actionPadModal: document.getElementById('action-pad-modal'),
      keypadModal: document.getElementById('keypad-modal'),
      loadHandModal: document.getElementById('load-hand-modal'),
      timezoneSelector: document.getElementById('timezone-selector'),
      timeDisplay: document.getElementById('time-display'),
      managePlayersBtn: document.getElementById('manage-players-btn'),
      registrationModal: document.getElementById('registration-modal'),
      cam1: document.getElementById('cam-btn-1'),
      cam2: document.getElementById('cam-btn-2'),
      dataStamp: document.getElementById('data-stamp'),
      // ì„¤ì • ëª¨ë‹¬ ê´€ë ¨
      settingsBtn: document.getElementById('settings-btn'),
      settingsModal: document.getElementById('settings-modal'),
      closeSettingsBtn: document.getElementById('close-settings'),
      cancelSettingsBtn: document.getElementById('cancel-settings'),
      saveSettingsBtn: document.getElementById('save-settings'),
      appsScriptUrlInput: document.getElementById('apps-script-url-input'),
      currentAppsUrl: document.getElementById('current-apps-url'),
      chipValidationToggle: document.getElementById('chip-validation-toggle'),
      cloudSyncStatus: document.getElementById('cloud-sync-status'),
      deviceIdDisplay: document.getElementById('device-id-display'),
      lastSyncDisplay: document.getElementById('last-sync-display'),
      syncNowBtn: document.getElementById('sync-now-btn'),
      resetCloudBtn: document.getElementById('reset-cloud-btn'),
      loadingOverlay: document.getElementById('loading-overlay'),
      loadingTitle: document.getElementById('loading-title'),
      loadingMessage: document.getElementById('loading-message'),
    };

    // ====== LOG MODAL ======
    function openLogModal(){
      el.logModal.classList.remove('hidden');
      el.logModal.classList.remove('opacity-0');
    }
    function closeLogModal(){ el.logModal.classList.add('opacity-0', 'hidden'); }
    function logMessage(msg,isError=false){
      const d=document.createElement('div');
      d.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;
      d.className=isError?'text-red-400':'text-green-400';
      el.logDisplay.appendChild(d); el.logDisplay.scrollTop=el.logDisplay.scrollHeight;
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (DuplicateRemoverì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
    window.openLogModal = openLogModal;
    window.closeLogModal = closeLogModal;
    window.logMessage = logMessage;

    // ====== TIME/TZ ======
    function getFormattedTimeInTimezone(date, tz){
      try{
        return new Intl.DateTimeFormat('ko-KR',{timeZone:tz,hour12:false,hour:'2-digit',minute:'2-digit',second:'2-digit'}).format(date);
      }catch(_){
        const pad=n=>String(n).padStart(2,'0');
        return `${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
      }
    }
    function populateTimezones(){
      const tzs={ "Asia/Seoul":"í•œêµ­(KST)", "Asia/Nicosia":"í‚¤í”„ë¡œìŠ¤(EET)" };
      const s=el.timezoneSelector; s.innerHTML='';
      for(const [v,t] of Object.entries(tzs)){
        const opt=document.createElement('option'); opt.value=v; opt.textContent=t; s.appendChild(opt);
      }
      s.value=window.state.selectedTimezone;
    }
    function updateTimeDisplay(){ el.timeDisplay.textContent=getFormattedTimeInTimezone(new Date(),window.state.selectedTimezone); }

    // ====== UTILS ======
    const formatNumber = (val) => val ? new Intl.NumberFormat('en-US').format(String(val).replace(/,/g,'')) : '';
    const unformatNumber = (val) => String(val || '').replace(/,/g, '');
    const toCamelCase = (s) => s.replace(/-([a-z])/g, g => g[1].toUpperCase());
    const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));
    const pad4 = n => String(Math.max(0, parseInt(String(n||'0').replace(/\D/g,''),10)||0)).padStart(4, '0');

    // Robust CSV parse (handles quotes)
    function parseCSV(text){
      const rows=[]; let i=0, field='', inQ=false, row=[];
      while(i<text.length){
        const c=text[i];
        if(inQ){
          if(c==='"'){
            if(text[i+1]==='"'){ field+='"'; i++; } else inQ=false;
          }else field+=c;
        }else{
          if(c===','){ row.push(field); field=''; }
          else if(c==='\n'){ row.push(field); rows.push(row); row=[]; field=''; }
          else if(c==='"'){ inQ=true; }
          else if(c!=='\r'){ field+=c; }
        }
        i++;
      }
      if(field!==''||row.length) { row.push(field); rows.push(row); }
      return rows;
    }

    function formatCardDisplay(cardId){
      const rank=cardId.slice(0,-1), suitKey=cardId.slice(-1);
      const colorClass=(suitKey==='h'||suitKey==='d')?'text-red-500':'text-black';
      return `<div class="card-display h-full w-full ${colorClass}"><div class="rank">${rank}</div><div>${SUITS[suitKey]}</div></div>`;
    }

    // ====== RENDERERS ======
    function renderTableSelection(){
      // ë”ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
      updateSelectedTableDisplay();
    }

    // ====== ìƒˆë¡œìš´ í…Œì´ë¸” ì„ íƒ ì‹œìŠ¤í…œ ======
    let tableModalState = {
      currentPage: 1,
      tablesPerPage: 20,
      currentFilter: 'all',
      searchTerm: ''
    };

    function updateSelectedTableDisplay() {
      const display = el.selectedTableDisplay;
      const managementTableName = document.getElementById('selected-table-name');

      if (window.state.selectedTable) {
        const playerCount = (window.state.playerDataByTable[window.state.selectedTable] || []).length;
        const text = `${window.state.selectedTable} (${playerCount}ëª…)`;
        display.textContent = text;
        if (managementTableName) managementTableName.textContent = window.state.selectedTable;
      } else {
        display.textContent = 'í…Œì´ë¸” ì„ íƒ';
        if (managementTableName) managementTableName.textContent = 'í…Œì´ë¸”ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
      }
    }

    function getFilteredTables() {
      let tables = window.state.allTables;
      
      // ê²€ìƒ‰ í•„í„°
      if (tableModalState.searchTerm) {
        const term = tableModalState.searchTerm.toLowerCase();
        tables = tables.filter(table => {
          // í…Œì´ë¸” ì´ë¦„ ë§¤ì¹˜
          if (table.toLowerCase().includes(term)) return true;
          // í”Œë ˆì´ì–´ ì´ë¦„ ë§¤ì¹˜
          const players = window.state.playerDataByTable[table] || [];
          return players.some(p => p.name.toLowerCase().includes(term));
        });
      }
      
      // ìƒíƒœ í•„í„°
      if (tableModalState.currentFilter === 'active') {
        tables = tables.filter(table => {
          const players = window.state.playerDataByTable[table] || [];
          return players.length > 0;
        });
      } else if (tableModalState.currentFilter === 'empty') {
        tables = tables.filter(table => {
          const players = window.state.playerDataByTable[table] || [];
          return players.length === 0;
        });
      }
      
      return tables;
    }

    function renderTableGrid() {
      const filteredTables = getFilteredTables();
      const startIdx = (tableModalState.currentPage - 1) * tableModalState.tablesPerPage;
      const endIdx = startIdx + tableModalState.tablesPerPage;
      const pageTables = filteredTables.slice(startIdx, endIdx);
      
      const grid = document.getElementById('table-grid');
      grid.innerHTML = '';
      
      pageTables.forEach(table => {
        const players = window.state.playerDataByTable[table] || [];
        const playerCount = players.length;
        const isSelected = window.state.selectedTable === table;
        
        // ìƒíƒœë³„ ìƒ‰ìƒ
        let statusColor = 'bg-gray-600'; // ë¹ˆ í…Œì´ë¸”
        if (playerCount >= 7) statusColor = 'bg-green-600'; // í™œì„±
        else if (playerCount >= 4) statusColor = 'bg-yellow-600'; // ë³´í†µ
        else if (playerCount >= 1) statusColor = 'bg-blue-600'; // ì ìŒ
        
        const button = document.createElement('button');
        button.className = `table-btn ${statusColor} hover:brightness-110 p-3 rounded-lg text-white text-sm font-medium relative ${isSelected ? 'ring-2 ring-amber-400' : ''}`;
        button.innerHTML = `
          <div class="text-xs font-bold">${table}</div>
          <div class="text-xs opacity-75">${playerCount}ëª…</div>
          ${isSelected ? '<div class="absolute top-1 right-1 text-amber-400">â—</div>' : ''}
        `;
        
        button.onclick = () => {
          window.state.selectedTable = table;
          window.state.playersInHand = [];
          updateSelectedTableDisplay();
          closeTableSelectorModal();

          // í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œì¸ì§€ í™•ì¸
          if (window.isTableManagementMode) {
            // í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œ: ê´€ë¦¬ UIë¡œ ì „í™˜
            document.getElementById('management-menu').classList.add('hidden');
            document.getElementById('player-management-content').classList.remove('hidden');
            // ìˆœì„œ ë³€ê²½: onManagementTableSelectedë¥¼ ë¨¼ì € í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ì„¤ì •í•œ í›„ UIë¥¼ ì´ˆê¸°í™”
            onManagementTableSelected(table);

            // í”Œë˜ê·¸ ë¦¬ì…‹
            window.isTableManagementMode = false;
          } else {
            // ì¼ë°˜ ëª¨ë“œ: ê¸°ë³¸ ë Œë”ë§
            renderAll();
          }
        };
        
        grid.appendChild(button);
      });
      
      // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
      const totalPages = Math.ceil(filteredTables.length / tableModalState.tablesPerPage);
      const pageInfo = document.getElementById('page-info');
      const startNum = startIdx + 1;
      const endNum = Math.min(endIdx, filteredTables.length);
      pageInfo.textContent = `${startNum}-${endNum} / ${filteredTables.length}`;
      
      // í˜ì´ì§€ ë²„íŠ¼ ìƒíƒœ
      document.getElementById('prev-page').disabled = tableModalState.currentPage === 1;
      document.getElementById('next-page').disabled = tableModalState.currentPage >= totalPages;
    }

    function openTableSelectorModal() {
      el.tableSelectorModal.classList.remove('hidden');
      renderTableGrid();
      document.getElementById('table-search').focus();
    }

    function closeTableSelectorModal() {
      el.tableSelectorModal.classList.add('hidden');
      tableModalState.searchTerm = '';
      document.getElementById('table-search').value = '';
    }
    function renderPlayerSelection(){
      const seatButtons = document.getElementById('seat-buttons');
      if(!seatButtons) return;
      
      if(!window.state.selectedTable){
        seatButtons.innerHTML='<p class="text-gray-500 text-xs col-span-11">í…Œì´ë¸”ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
        return;
      }
      
      const tableData = window.state.playerDataByTable[window.state.selectedTable]||[];
      
      // 10ê°œ ì¢Œì„ ë²„íŠ¼ + ë²„íŠ¼ ìœ„ì¹˜ ë“œë¡­ë‹¤ìš´ ìƒì„±
      let html = '';
      
      // 1-10ë²ˆ ì¢Œì„ ë²„íŠ¼ (ì¢Œì„ ë²ˆí˜¸ í‘œì‹œ ì œê±°)
      for(let seatNum = 1; seatNum <= 10; seatNum++){
        // Type ì‹œíŠ¸ì—ì„œ í•´ë‹¹ ì¢Œì„ì˜ í”Œë ˆì´ì–´ ì°¾ê¸°
        const playerData = tableData.find(p => parseInt(p.seat) === seatNum);
        const isInHand = playerData && window.state.playersInHand.some(pp => pp.name === playerData.name);
        
        // í¬ì§€ì…˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const positions = getPositionsForSeat(seatNum);
        let positionBadge = '';
        let borderClass = '';
        
        if(positions.includes('BTN')) {
          positionBadge = 'ğŸ¯';
          borderClass = 'border-2 border-yellow-400';
        } else if(positions.includes('SB')) {
          positionBadge = 'SB';
          borderClass = 'border-2 border-green-400';
        } else if(positions.includes('BB')) {
          positionBadge = 'BB';
          borderClass = 'border-2 border-blue-400';
        }
        
        if(playerData){
          const notable = playerData.notable ? 'â­' : '';
          const btnClass = isInHand ? 'bg-amber-600' : 'bg-gray-600 hover:bg-gray-500';
          // í¬ì§€ì…˜ ë°°ì§€ì™€ í”Œë ˆì´ì–´ ì´ë¦„ í‘œì‹œ
          let displayText = '';
          if(positionBadge) {
            displayText = positionBadge; // í¬ì§€ì…˜ì´ ìˆìœ¼ë©´ í¬ì§€ì…˜ë§Œ í‘œì‹œ
          } else {
            // í¬ì§€ì…˜ì´ ì—†ìœ¼ë©´ ì´ë¦„ í‘œì‹œ (notable í¬í•¨)
            const shortName = playerData.name.length > 8 ? playerData.name.substring(0, 7) + 'â€¦' : playerData.name;
            displayText = notable + shortName;
          }
          
          html += `<button class="seat-player-btn btn ${btnClass} ${borderClass} px-1 py-0.5 text-[9px] rounded truncate h-7" 
                    data-seat="${seatNum}" 
                    data-player-name="${playerData.name}"
                    title="Seat ${seatNum}: ${playerData.name}">
                    <div class="truncate">${displayText}</div>
                  </button>`;
        } else {
          // ë¹ˆ ì¢Œì„
          html += `<button class="seat-empty-btn btn bg-gray-800 ${borderClass} px-1 py-0.5 text-[9px] rounded h-7" 
                    data-seat="${seatNum}"
                    title="Seat ${seatNum}: ë¹ˆìë¦¬">
                    <div class="text-gray-600">${positionBadge || 'â€¢'}</div>
                  </button>`;
        }
      }
      
      // 11ë²ˆì§¸ ìœ„ì¹˜: ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ (1x11 ê·¸ë¦¬ë“œ) - ì „ì²´ í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì„ íƒ ê°€ëŠ¥
      const currentBtnPos = window.state.buttonPosition || '';
      
      // ì „ì²´ í…Œì´ë¸” í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¢Œì„ì´ ìˆëŠ” í”Œë ˆì´ì–´ë“¤ ê°€ì ¸ì˜¤ê¸°
      const allPlayersWithSeats = tableData.filter(player => player.seat).map(player => ({
        seat: parseInt(player.seat),
        name: player.name
      })).sort((a, b) => a.seat - b.seat);
      
      html += `
        <select id="button-position-select" class="bg-gray-600 text-[9px] px-1 py-0.5 rounded h-7 cursor-pointer">
          <option value="">BTN</option>
          ${allPlayersWithSeats.map(player => {
            const selected = player.seat.toString() === currentBtnPos.toString() ? 'selected' : '';
            const isInGame = window.state.playersInHand.some(p => p.name === player.name);
            const statusIndicator = isInGame ? 'ğŸŸ¢' : 'âš«';
            return `<option value="${player.seat}" ${selected} title="${player.seat}ë²ˆ - ${player.name} ${isInGame ? '(ì°¸ì—¬ì¤‘)' : '(ëŒ€ê¸°ì¤‘)'}">${statusIndicator}${player.seat}</option>`;
          }).join('')}
        </select>
      `;
      
      seatButtons.innerHTML = html;
      
      // ë²„íŠ¼ ìœ„ì¹˜ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      const btnSelect = document.getElementById('button-position-select');
      if(btnSelect) {
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        const newBtnSelect = btnSelect.cloneNode(true);
        btnSelect.parentNode.replaceChild(newBtnSelect, btnSelect);
        
        newBtnSelect.addEventListener('change', (e) => {
          window.state.buttonPosition = e.target.value || null;
          console.log(`ğŸ¯ ë²„íŠ¼ ìœ„ì¹˜ ë³€ê²½: ${window.state.buttonPosition || 'ì—†ìŒ'}`);
          updateSeatDisplay();
          // updatePositionIndicatorsëŠ” renderPlayerSelection ë‚´ë¶€ì—ì„œ ì´ë¯¸ í˜¸ì¶œë¨
          saveActionState();
          
          // ì‹œê°ì  í”¼ë“œë°±
          showFeedback(window.state.buttonPosition ? 
            `ë²„íŠ¼ ìœ„ì¹˜: ${window.state.buttonPosition}ë²ˆ ì¢Œì„` : 
            'ë²„íŠ¼ ìœ„ì¹˜ í•´ì œ', false);
        });
      }
    }
    function renderPlayerDetails(){
      const finalPot = calculateFinalPot();
      
      el.playerDetailsSection.innerHTML = window.state.playersInHand.map(p=>{
        const roleClass=(p.role==='winner')?'is-winner':'';
        const winnerBadge = p.role === 'winner' && finalPot > 0 ?
          `<span class="ml-2 text-amber-300 font-bold text-xs animate-pulse">ğŸ† +${formatNumber(finalPot)}</span>` : '';

        // ì¹© í‘œì‹œ ìŠ¤íƒ€ì¼ (ë§ˆì´ë„ˆìŠ¤ì¼ ë•Œ ë¹¨ê°„ìƒ‰)
        const chipValue = parseInt(unformatNumber(p.chips) || 0, 10);
        const chipClass = chipValue < 0 ? 'bg-red-900 text-red-300' : 'bg-gray-700';
        const chipWarning = chipValue < 0 ? 'âš ï¸ ' : '';

        return `<div class="player-card flex items-center gap-2 text-sm border-b border-gray-700 pb-1 ${roleClass}" data-player-name="${p.name}">
          <div class="w-1/4 truncate font-bold">${p.name}${winnerBadge}</div>
          <div class="w-1/2"><button class="player-chip-btn btn ${chipClass} w-full p-1 rounded-md text-xs text-left" data-player-name="${p.name}">${chipWarning}${formatNumber(p.chips) || '0'}</button></div>
          <div class="w-1/4 card-placeholder h-10 flex justify-center items-center gap-1" data-player-name="${p.name}" data-count="2">
            ${p.hand?.length? p.hand.map(formatCardDisplay).join('') : '<span class="text-gray-400 text-lg">+</span>'}
          </div>
        </div>`;
      }).join('');
      
      // í”Œë ˆì´ì–´ ì¹© ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
      document.querySelectorAll('.player-chip-btn').forEach(btn => {
        btn.onclick = () => {
          const playerName = btn.dataset.playerName;
          const player = window.state.playersInHand.find(p => p.name === playerName);
          if(player) {
            openChipInput(player, false);
          }
        };
      });
    }
    function renderBoard(){
      const flop=`<div class="card-placeholder h-10 w-24" data-target="board" data-index="0" data-count="3">${[0,1,2].map(i=>window.state.board[i]?formatCardDisplay(window.state.board[i]):'').join('') || '<span class="text-gray-400 text-lg">+</span>'}</div>`;
      const turn=`<div class="card-placeholder h-10 w-8" data-target="board" data-index="3" data-count="1">${window.state.board[3]?formatCardDisplay(window.state.board[3]):'<span class="text-gray-400 text-lg">+</span>'}</div>`;
      const river=`<div class="card-placeholder h-10 w-8" data-target="board" data-index="4" data-count="1">${window.state.board[4]?formatCardDisplay(window.state.board[4]):'<span class="text-gray-400 text-lg">+</span>'}</div>`;
      el.boardCardPlaceholders.innerHTML = flop+turn+river;
    }
    // ìµœì¢… íŒŸ ê³„ì‚° í•¨ìˆ˜
    function calculateFinalPot(){
      // ì‹¤ì œ íŒŸ ê³„ì‚° ì‚¬ìš© (í´ë“œí•œ í”Œë ˆì´ì–´ì˜ ë² íŒ… í¬í•¨, ì–¸ì½œ ë² íŒ… ì œì™¸)
      return calculateActualPot();
    }
    
    function renderWinnerSelection(){
      const finalPot = calculateFinalPot();
      
      el.winnerButtons.innerHTML = window.state.playersInHand.map(p=>{
        const sel=(p.role==='winner');
        const potDisplay = sel && finalPot > 0 ? ` <span class="text-amber-300 font-bold">+${formatNumber(finalPot)}</span>` : '';
        return `<button class="btn ${sel?'btn-selected bg-amber-600':'bg-gray-600 hover:bg-gray-500'} px-2 py-1 text-xs rounded-md set-winner-btn" data-player-name="${p.name}">${p.name}${potDisplay}</button>`;
      }).join('');
    }
    function renderActionStreets(){
      const streets=['preflop','flop','turn','river']; 
      let displayPot=0;  // UI í‘œì‹œìš© íŒŸ
      
      el.streetLogsContainer.innerHTML = streets.map(street=>{
        const logs=window.state.actionState[street]||[]; 
        let streetPot=0;
        
        if(street==='preflop'){
          streetPot += parseInt(unformatNumber(window.state.actionState.smallBlind)||0,10);
          streetPot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
          if(window.state.actionState.hasBBAnte) streetPot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
        }
        
        // Pot Correctionì´ ìˆëŠ”ì§€ í™•ì¸
        const potCorrection = logs.find(a => a.action === 'Pot Correction');
        if(potCorrection) {
          // Pot Correctionì´ ìˆìœ¼ë©´ ê·¸ ê°’ì„ ì§ì ‘ ì‚¬ìš©
          displayPot = parseInt(unformatNumber(potCorrection.amount),10);
        } else {
          // ì¼ë°˜ ì•¡ì…˜ë“¤ë§Œ ë”í•¨
          logs.forEach(a=>{ 
            if(a.amount && a.action !== 'Pot Correction') {
              streetPot += parseInt(unformatNumber(a.amount),10); 
            }
          });
          displayPot += streetPot;
        }
        
        // ì‹¤ì œ íŒŸ ê³„ì‚° (í´ë“œí•œ í”Œë ˆì´ì–´ì˜ ë² íŒ… í¬í•¨)
        const actualPot = calculateActualPot();
        const uncalledBet = calculateUncalledBet();
        
        // ì‹¤ì œ íŒŸê³¼ í‘œì‹œ íŒŸì´ ë‹¤ë¥¸ ê²½ìš°ë¥¼ ìœ„í•œ í‘œì‹œ
        let potDisplay = formatNumber(displayPot);
        if(displayPot !== actualPot && logs.length > 0) {
          potDisplay = `${formatNumber(displayPot)} <span class="text-xs text-amber-400">(ì‹¤ì œ: ${formatNumber(actualPot)})</span>`;
        }
        const logHTML = logs.map(log=>{
          // Pot Correctionì€ ì‹œìŠ¤í…œ ì•¡ì…˜ì´ë¯€ë¡œ playerê°€ ì—†ìŒ
          if(log.action === 'Pot Correction'){
            const amt = log.amount ? ` <span class="font-mono text-white">${formatNumber(log.amount)}</span>` : '';
            return `<span class="action-log-entry mr-2"><span class="text-blue-400">Pot</span>${amt}</span>`;
          }
          // ì¼ë°˜ í”Œë ˆì´ì–´ ì•¡ì…˜
          const player=window.state.playersInHand.find(p=>p.name===log.player);
          const cls=(player?.role==='winner')?'text-amber-400':'text-gray-300';
          const amt=log.amount?` <span class="font-mono text-white">${formatNumber(log.amount)}</span>`:'';
          return `<span class="action-log-entry mr-2"><span class="${cls}">${log.player || 'Unknown'}</span> ${log.action}${amt}</span>`;
        }).join('');
        const isActive = window.state.currentStreet === street;
        const streetBtnClass = isActive 
          ? 'bg-amber-500 text-black border-2 border-amber-300 shadow-lg' 
          : 'bg-gray-700 text-gray-300 border-2 border-gray-600 hover:bg-gray-600 hover:text-white';
        const containerClass = isActive 
          ? 'bg-gradient-to-r from-amber-900/40 to-yellow-900/30 border-2 border-amber-400 shadow-xl ring-2 ring-amber-500/30' 
          : 'bg-gray-900/50 border border-gray-700';
        
        return `<div class="street-container ${containerClass} p-2 rounded-md">
          <div class="flex justify-between items-center text-xs mb-1">
            <button class="street-select-btn ${streetBtnClass} px-3 py-1 rounded-md font-bold min-w-[70px] text-center cursor-pointer" 
                    data-street="${street}" style="${isActive ? 'box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);' : ''}">${street.toUpperCase()}</button>
            <div class="flex items-center gap-1">
              <span class="font-mono">Pot: ${potDisplay}</span>
              <button class="pot-keypad-btn btn bg-gray-600 px-1 py-0 rounded" data-street="${street}" data-current-pot="${displayPot}">âŒ¨ï¸</button>
            </div>
            <div class="flex gap-1">
              <button class="add-action-btn btn bg-indigo-600 text-white font-bold py-1 px-2 rounded" data-street="${street}">ì•¡ì…˜+</button>
              <button class="undo-action-btn btn bg-gray-600 py-1 px-2 rounded" data-street="${street}">â†©</button>
            </div>
          </div>
          <div id="${street}-log" class="action-log-display text-xs whitespace-nowrap overflow-x-auto">${logHTML || '<span class="text-gray-500">No actions</span>'}</div>
        </div>`;
      }).join('');
    }
    function renderAll(){ 
      renderPlayerSelection(); 
      renderPlayerDetails(); 
      renderBoard(); 
      renderActionStreets(); 
      renderWinnerSelection();
      updateButtonPositionDisplay();
    }
    // ====== MODALS ======
    function openModal(node, html){ node.innerHTML=html; node.classList.remove('hidden', 'opacity-0'); }
    function closeModal(node){ node.classList.add('hidden', 'opacity-0'); }

    function openCardSelector(){
      const { target, player, index, count } = window.state.modalState.cardTarget;
      
      // í”Œëì—ì„œëŠ” 5ì¥ê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •
      let maxCards = count;
      let isFlop = false;
      if(target === 'board' && count === 3) {
        maxCards = 5; // í”Œëì—ì„œëŠ” ìµœëŒ€ 5ì¥ê¹Œì§€ ì„ íƒ ê°€ëŠ¥
        isFlop = true;
      }
      
      // í˜„ì¬ ì„ íƒëœ ì¹´ë“œë“¤ì„ ì´ˆê¸°ê°’ìœ¼ë¡œ ì„¤ì •
      let selected = [];
      if(target === 'playerHand' && player) {
        const p = window.state.playersInHand.find(p => p.name === player);
        if(p && p.hand) selected = [...p.hand];
      } else if(target === 'board') {
        if(isFlop) { // flop - ëª¨ë“  ë³´ë“œ ì¹´ë“œ í¬í•¨
          selected = window.state.board.filter(Boolean);
        } else if(index === 3) { // turn
          if(window.state.board[3]) selected = [window.state.board[3]];
        } else if(index === 4) { // river
          if(window.state.board[4]) selected = [window.state.board[4]];
        }
      }
      
      const used=[...window.state.playersInHand.flatMap(p=>p.hand||[]), ...window.state.board].filter(Boolean);
      let deckHTML='';
      Object.keys(SUITS).forEach(suitKey=>{
        deckHTML+='<div class="flex justify-center gap-1 mb-1">';
        RANKS.forEach(rank=>{
          const id=`${rank}${suitKey}`;
          // ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ì¹´ë“œ ì²´í¬ (í˜„ì¬ ëŒ€ìƒ ì œì™¸)
          let usedByOthers = false;
          const othersCards = [...window.state.playersInHand.flatMap(p => {
            if(target === 'playerHand' && p.name === player) return []; // í˜„ì¬ í”Œë ˆì´ì–´ ì œì™¸
            return p.hand || [];
          })];
          if(target !== 'board') {
            othersCards.push(...window.state.board.filter(Boolean));
          }
          usedByOthers = othersCards.includes(id) && !selected.includes(id);
          
          const isSelected = selected.includes(id);
          const color=(suitKey==='h'||suitKey==='d')?'card-red':'card-black';
          const bgClass = isSelected ? 'bg-amber-300' : (usedByOthers ? 'bg-gray-600 text-gray-500' : 'bg-white hover:bg-amber-300');
          const selectedClass = isSelected ? 'selected' : '';
          
          deckHTML+=`<button class="btn card-selector-btn rounded-md w-9 h-11 ${bgClass} ${color} ${selectedClass}" data-card-id="${id}" ${usedByOthers?'disabled':''}>${rank}${SUITS[suitKey]}</button>`;
        });
        deckHTML+='</div>';
      });
      const html=`<div class="bg-gray-800 rounded-lg p-2 w-full max-w-md">
        <h2 class="text-lg font-bold text-amber-400 mb-2 text-center">ì¹´ë“œ ì„ íƒ ${isFlop ? '(í”Œë/í„´/ë¦¬ë²„)' : `(${count}ì¥)`}</h2>
        <div id="selected-cards" class="text-center mb-2 text-sm text-gray-300">ì„ íƒëœ ì¹´ë“œ: <span id="selected-count">${selected.length}</span>/${isFlop ? '3-5' : maxCards}</div>
        <div id="card-deck">${deckHTML}</div>
        <div class="flex gap-2 mt-2">
          <button id="close-card-modal" class="btn flex-1 bg-red-600 py-2 rounded-md">ë‹«ê¸°</button>
          <button id="confirm-cards" class="btn flex-1 bg-green-600 py-2 rounded-md">í™•ì¸</button>
        </div>
      </div>`;
      openModal(el.cardSelectorModal, html);
      // ì¹´ë“œ ì„ íƒ ì´ë²¤íŠ¸
      const updateSelectedCount = () => {
        const counter = el.cardSelectorModal.querySelector('#selected-count');
        if(counter) counter.textContent = selected.length;
      };
      
      el.cardSelectorModal.querySelector('#card-deck').onclick=e=>{
        const btn=e.target.closest('.card-selector-btn'); if(!btn) return;
        const id=btn.dataset.cardId; const idx=selected.indexOf(id);
        const { target, count } = window.state.modalState.cardTarget;
        const isFlop = target === 'board' && count === 3;
        const maxAllowed = isFlop ? 5 : count; // í”Œëì—ì„œëŠ” ìµœëŒ€ 5ì¥ê¹Œì§€
        
        if(idx>-1){ 
          // ì´ë¯¸ ì„ íƒëœ ì¹´ë“œë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì„ íƒ í•´ì œ
          selected.splice(idx,1); 
          btn.classList.remove('selected');
          btn.classList.remove('bg-amber-300');
          btn.classList.add('bg-white', 'hover:bg-amber-300');
        }
        else if(selected.length<maxAllowed){ 
          selected.push(id); 
          btn.classList.add('selected');
          btn.classList.remove('bg-white', 'hover:bg-amber-300');
          btn.classList.add('bg-amber-300');
        }
        updateSelectedCount();
      };
      
      // í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸
      el.cardSelectorModal.querySelector('#confirm-cards').onclick=()=>{
        const { target, count } = window.state.modalState.cardTarget;
        const isFlop = target === 'board' && count === 3;
        
        // í”Œëì—ì„œëŠ” ìµœì†Œ 3ì¥ í•„ìˆ˜
        if(isFlop && selected.length > 0 && selected.length < 3) {
          showFeedback('í”Œëì€ ìµœì†Œ 3ì¥ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.', true);
          return;
        }
        
        // ì¹´ë“œê°€ ì—†ìœ¼ë©´ ì œê±°, ìˆìœ¼ë©´ í• ë‹¹
        assignCard(selected.length > 0 ? selected : null);
      };
    }

    // ìƒˆë¡œìš´ ìŠ¤íŠ¸ë¦¿ ê¸°ë°˜ ì•¡ì…˜ ì‹œìŠ¤í…œ
    function openActionPad(street){
      if(window.state.playersInHand.length<1){ showFeedback('ë¨¼ì € í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', true); return; }

      // ì•¡ì…˜ ê´€ë¦¬ì ë™ê¸°í™”
      window.actionManager.currentStreet = street;
      window.state.currentStreet = street;
      window.state.modalState.actionPadStreet = street;

      const activePlayers = window.actionManager.getActivePlayers(window.state.playersInHand);
      if(activePlayers.length === 0) {
        showFeedback('ë² íŒ… ê°€ëŠ¥í•œ í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.', true);
        return;
      }

      // í˜„ì¬ ì•¡ì…˜í•  í”Œë ˆì´ì–´
      const currentPlayer = window.actionManager.getCurrentActionPlayer();
      const actionOrder = window.actionManager.calculateActionOrder(street);

      // ì•¡ì…˜ ëª¨ë“œ í† ê¸€ ë²„íŠ¼
      const modeIcon = window.actionManager.actionMode === 'auto' ? 'ğŸ¤–' : 'ğŸ‘†';
      const modeText = window.actionManager.actionMode === 'auto' ? 'ìë™ ìˆœì„œ' : 'ìˆ˜ë™ ì„ íƒ';

      // ì•¡ì…˜ í í‘œì‹œ
      const queueDisplay = actionOrder.map((p, index) => {
        const isCurrent = currentPlayer && p.name === currentPlayer.name;
        const hasActed = (window.state.actionState[street] || []).some(a => a.player === p.name);

        let statusIcon = 'â³';
        let statusClass = 'text-gray-400';

        if (hasActed) {
          statusIcon = 'âœ…';
          statusClass = 'text-green-400';
        } else if (isCurrent) {
          statusIcon = 'ğŸ¯';
          statusClass = 'text-amber-400 animate-pulse';
        }

        return `<span class="${statusClass}">${statusIcon} ${p.name}</span>`;
      }).join(' â†’ ');

      // Check/Call ì•¡ì…˜ ê²°ì • (í˜„ì¬ í”Œë ˆì´ì–´ìš©)
      let checkCallButtonHTML = '';
      if(currentPlayer) {
        const smartAction = getSmartCheckCallAction(currentPlayer.name, street);
        const btnColor = smartAction.action === 'Checks' ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700';
        const btnIcon = smartAction.action === 'Checks' ? 'âœ…' : 'ğŸ“';
        const btnText = smartAction.action === 'Checks' ? 'Check' : `Call ${formatNumber(smartAction.amount)}`;

        checkCallButtonHTML = `
          <button id="smart-check-call-btn" class="btn ${btnColor} p-3 rounded-md" data-action="SmartCheckCall" data-player="${currentPlayer.name}">
            ${btnIcon} ${btnText}
          </button>`;
      }

      const html=`<div class="bg-gray-800 rounded-lg p-4 w-full max-w-lg">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-amber-400">${street.toUpperCase()} ì•¡ì…˜</h2>
          <button id="toggle-action-mode" class="text-sm bg-gray-700 px-3 py-1 rounded">
            ${modeIcon} ${modeText}
          </button>
        </div>

        <!-- ì•¡ì…˜ í í‘œì‹œ -->
        <div class="bg-gray-900 p-3 rounded mb-4">
          <div class="text-xs text-gray-400 mb-1">ì•¡ì…˜ ìˆœì„œ:</div>
          <div class="text-sm">${queueDisplay}</div>
          ${currentPlayer ? `<div class="text-xs text-amber-400 mt-2">í˜„ì¬ ì°¨ë¡€: ${currentPlayer.name}</div>` : ''}
        </div>

        <!-- í˜„ì¬ í”Œë ˆì´ì–´ ì•¡ì…˜ ë²„íŠ¼ -->
        ${currentPlayer && window.actionManager.actionMode === 'auto' ? `
          <div class="mb-4">
            <div class="text-center text-lg font-bold text-amber-400 mb-3">${currentPlayer.name}ì˜ ì•¡ì…˜</div>
            <div id="current-player-actions" class="grid grid-cols-2 gap-2">
              <button class="btn bg-red-600 hover:bg-red-700 p-3 rounded-md" data-action="Folds" data-player="${currentPlayer.name}">
                âŒ Fold
              </button>
              ${checkCallButtonHTML}
              <button class="btn bg-blue-600 hover:bg-blue-700 p-3 rounded-md" data-action="Bet/Raises" data-player="${currentPlayer.name}">
                ğŸ’° Bet/Raise
              </button>
              <button class="btn bg-red-800 hover:bg-red-900 font-bold p-3 rounded-md" data-action="All In" data-player="${currentPlayer.name}">
                ğŸš€ ALL IN
              </button>
            </div>
          </div>
        ` : ''}

        <!-- ìˆ˜ë™ ëª¨ë“œ ë˜ëŠ” ëª¨ë“  í”Œë ˆì´ì–´ ì„ íƒ -->
        ${window.actionManager.actionMode === 'manual' || !currentPlayer ? `
          <div class="mb-4">
            <div class="text-sm text-gray-400 mb-2">í”Œë ˆì´ì–´ ì„ íƒ:</div>
            <div id="action-pad-players" class="grid grid-cols-3 gap-2 mb-3">
              ${activePlayers.map(p => {
                const hasActed = (window.state.actionState[street] || []).some(a => a.player === p.name);
                const btnClass = hasActed ? 'bg-gray-600' : 'bg-gray-700 hover:bg-gray-600';
                const indicator = hasActed ? ' âœ…' : '';
                return `<button class="btn ${btnClass} p-2 rounded-md" data-player-name="${p.name}">${p.name}${indicator}</button>`;
              }).join('')}
            </div>
            <div id="action-pad-actions" class="grid grid-cols-2 gap-2 hidden">
              <button class="btn bg-red-600 p-3 rounded-md" data-action="Folds">âŒ Fold</button>
              <button id="manual-smart-check-call-btn" class="btn bg-green-600 p-3 rounded-md" data-action="SmartCheckCall">
                <span class="action-label">âœ… Check</span>
                <span class="amount-label"></span>
              </button>
              <button class="btn bg-blue-600 p-3 rounded-md" data-action="Bet/Raises">ğŸ’° Bet/Raise</button>
              <button class="btn bg-red-800 font-bold p-3 rounded-md" data-action="All In">ğŸš€ ALL IN</button>
            </div>
          </div>
        ` : ''}

        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
        <div class="flex gap-2">
          ${window.actionManager.actionMode === 'auto' && currentPlayer ? `
            <button id="skip-current-player" class="btn bg-yellow-600 hover:bg-yellow-700 px-3 py-2 rounded text-sm">
              â­ï¸ ìŠ¤í‚µ
            </button>
          ` : ''}
          <button id="close-action-pad" class="btn flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-md">ë‹«ê¸°</button>
        </div>
      </div>`;

      openModal(el.actionPadModal, html);
    }

    // í”Œë ˆì´ì–´ ì•¡ì…˜ ì‹¤í–‰ í•¨ìˆ˜ (ë³´ì•ˆ ë ˆì´ì–´ í¬í•¨)
    async function executePlayerAction(playerName, action, btn) {
      const modal = el.actionPadModal;
      const manager = window.actionManager;

      // Layer 6: ë®¤í…ìŠ¤ ì²´í¬ (ë™ì‹œ ì•¡ì…˜ ë°©ì§€)
      if (manager.isProcessing) {
        console.warn('ì´ë¯¸ ì•¡ì…˜ì´ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤');
        showFeedback('âš ï¸ ì´ì „ ì•¡ì…˜ ì²˜ë¦¬ ì¤‘...', true);
        return;
      }

      manager.isProcessing = true;

      try {
        // Layer 1: íƒ€ì„ìŠ¤íƒ¬í”„ ìƒì„± (ë¡œê¹…ìš©)
        const timestamp = manager.timekeeper.generateTimestamp();
        manager.timekeeper.validateAndUpdate(timestamp);

        // Layer 2: Rate monitoring (ë¡œê¹…ìš©)
        manager.rateLimiter.check(playerName);

        // Layer 3: í”Œë ˆì´ì–´ ê²€ì¦ (ìë™ ë“±ë¡ ì œê±°)
        // manager.stateValidator.validatePlayer(playerName); // ì¤‘ë³µ ë“±ë¡ ë°©ì§€ë¥¼ ìœ„í•´ ì œê±°

        // í˜„ì¬ í”Œë ˆì´ì–´ í™•ì¸ (ìë™ ëª¨ë“œ)
        if (manager.actionMode === 'auto') {
          const currentPlayer = manager.getCurrentActionPlayer();
          if (currentPlayer && currentPlayer.name !== playerName) {
            console.log(`ìˆœì„œ ë°– ì•¡ì…˜: ${playerName} (í˜„ì¬: ${currentPlayer.name})`);
            // ê·¸ë˜ë„ í—ˆìš©
          }
        }

        // Layer 5: íŠ¸ëœì­ì…˜ ì‹œì‘
        const transaction = manager.startTransaction();

        try {
          // í˜„ì¬ í”Œë ˆì´ì–´ë¥¼ actionPadPlayerë¡œ ì„¤ì •
          window.state.modalState.actionPadPlayer = playerName;

          // ì•¡ì…˜ ì²˜ë¦¬
          if(action === 'SmartCheckCall') {
            const smartAction = getSmartCheckCallAction(playerName, manager.currentStreet);
            addActionToLog(smartAction.label, smartAction.amount, playerName);
          } else if(action === 'Folds') {
            addActionToLog('Folds', null, playerName);
            // í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸
            window.state.playerStatus[playerName] = 'folded';
          } else if(action === 'All In') {
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              addActionToLog('All In', player.chips, playerName);
              window.state.playerStatus[playerName] = 'allin';
            }
          } else if(action === 'Bet/Raises') {
            closeModal(modal);
            window.state.modalState.actionPadPlayer = playerName;

            const st = manager.currentStreet;
            const hasBet = window.state.actionState[st]?.some(a => /BET|RAISE/i.test(a.action || ''));
            window.state.modalState.actionPadCurrentAction = hasBet ? 'Raises' : 'Bets';

            openKeypad(null, { purpose: 'bet', playerName: playerName });
            manager.isProcessing = false; // í‚¤íŒ¨ë“œ ëŒ€ê¸° ì¤‘ ì²˜ë¦¬ í•´ì œ
            return;
          }

          // ìƒíƒœ í•´ì‹œ ì—…ë°ì´íŠ¸
          manager.stateValidator.updateState();

          // íŠ¸ëœì­ì…˜ ì»¤ë°‹
          transaction.commit();

          // ìë™ ëª¨ë“œì—ì„œ ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ì´ë™
          if(manager.actionMode === 'auto') {
            const nextPlayer = manager.moveToNextPlayer();

            showFeedback(`âœ… ${playerName} ${action}`, false);

            if(nextPlayer) {
              // ì ì‹œ ëŒ€ê¸° í›„ ë‹¤ìŒ í”Œë ˆì´ì–´ ì•¡ì…˜ íŒì—…
              setTimeout(() => {
                openActionPad(manager.currentStreet);
              }, 300);
            } else {
              closeModal(modal);

              // ìŠ¤íŠ¸ë¦¿ ì™„ë£Œ ì²´í¬
              if (manager.isBettingRoundComplete()) {
                showFeedback(`ğŸ¯ ${manager.currentStreet.toUpperCase()} ì™„ë£Œ! ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ ì¤€ë¹„...`, false);

                // ìë™ìœ¼ë¡œ ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ ì§„í–‰
                setTimeout(() => {
                  manager.advanceToNextStreet();
                }, 500);
              }
            }
          } else {
            closeModal(modal);
            showFeedback(`âœ… ${playerName} ${action}`, false);
          }

        } catch (innerError) {
          // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ê³„ì† ì§„í–‰
          console.warn('ì•¡ì…˜ ì²˜ë¦¬ ì¤‘ ê²½ê³ :', innerError.message);
          transaction.rollback();
        }

      } catch (error) {
        // ì—ëŸ¬ ë¡œê·¸ë§Œ ì¶œë ¥í•˜ê³  ê³„ì† ì§„í–‰
        console.log('ì•¡ì…˜ ì²˜ë¦¬ ì¤‘ ì˜ˆì™¸:', error.message);
      } finally {
        manager.isProcessing = false;
      }
    }

    // ì¹© ì…ë ¥ ê°œì„  í•¨ìˆ˜
    function openChipInput(player, isInitial = false) {
      const currentChips = player.chips || '0';
      const placeholder = isInitial ? 'ì‹œì‘ ì¹© ì…ë ¥' : `í˜„ì¬: ${formatNumber(currentChips)}`;
      
      // í‚¤íŒ¨ë“œ ì˜µì…˜ ì„¤ì •
      window.state.modalState.keypadOptions = {
        purpose: 'chip',
        playerName: player.name
      };
      
      // íŒì—… ëª¨ë‹¬ ìƒì„±
      const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-xs">
        <h3 class="text-center text-amber-400 font-bold mb-3">${player.name} ì¹© ìˆ˜ì •</h3>
        <div class="text-xs text-gray-400 text-center mb-2">í˜„ì¬: ${formatNumber(currentChips)}</div>
        <input type="text" id="chip-text-input" class="w-full bg-gray-900 text-white p-2 rounded mb-3 text-center" placeholder="0" value="0">
        <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">0</div>
        <div class="grid grid-cols-3 gap-2 text-xl font-bold">
          ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
        </div>
        <div class="grid grid-cols-2 gap-2 mt-2">
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
        </div>
        <div class="grid grid-cols-2 gap-2 mt-2">
          <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
          <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
        </div>
      </div>`;
      
      openModal(el.keypadModal, html);
      
      // í…ìŠ¤íŠ¸ ì…ë ¥ê³¼ í‚¤íŒ¨ë“œ ë””ìŠ¤í”Œë ˆì´ ë™ê¸°í™”
      setTimeout(() => {
        const textInput = document.getElementById('chip-text-input');
        const display = document.getElementById('keypad-display');
        let currentInput = '0';
        
        if(textInput && display) {
          // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸
          textInput.addEventListener('input', () => {
            currentInput = unformatNumber(textInput.value) || '0';
            display.textContent = formatNumber(currentInput);
          });
          
          // í‚¤íŒ¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
          // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
          
          // ì·¨ì†Œ/í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
          // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
          
          // í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
          // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
        }
      }, 10);
    }
    
    function openKeypad(targetInput, options={}){
      window.state.modalState.keypadTarget=targetInput;
      window.state.modalState.keypadOptions=options;
      const initial = options.prefill !== undefined ? options.prefill : (targetInput?targetInput.value:'');

      // ë² íŒ… í‚¤íŒ¨ë“œì¸ ê²½ìš° í”Œë ˆì´ì–´ ì¹© í™•ì¸
      let playerChips = 0;
      let chipWarning = '';
      if(options.purpose === 'bet' && options.playerName) {
        const player = window.state.playersInHand.find(p => p.name === options.playerName);
        if(player) {
          playerChips = parseInt(unformatNumber(player.chips), 10);
          chipWarning = `<div class="text-xs text-gray-400 text-center mb-1">ë³´ìœ  ì¹©: ${formatNumber(playerChips)}</div>`;
        }
      } else if(options.purpose === 'bet' && window.state.modalState.actionPadPlayer) {
        const player = window.state.playersInHand.find(p => p.name === window.state.modalState.actionPadPlayer);
        if(player) {
          playerChips = parseInt(unformatNumber(player.chips), 10);
          chipWarning = `<div class="text-xs text-gray-400 text-center mb-1">ë³´ìœ  ì¹©: ${formatNumber(playerChips)}</div>`;
        }
      }

      const html=`<div class="bg-gray-800 rounded-lg p-2 w-full max-w-xs">
        ${chipWarning}
        <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">${initial}</div>
        <div id="keypad-warning" class="text-xs text-amber-400 text-center mb-2 hidden">âš ï¸ ì¹© ë¶€ì¡± - ì˜¬ì¸ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤</div>
        <div class="grid grid-cols-3 gap-2 text-xl font-bold">
          ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
        </div>
        <div class="grid grid-cols-${options.purpose === 'bet' ? '3' : '2'} gap-2 mt-2">
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
          ${options.purpose === 'bet' && playerChips > 0 ?
            `<button class="keypad-btn btn bg-purple-600 text-white p-3 rounded-md font-bold" data-action="max">MAX</button>` : ''
          }
        </div>
        <div class="grid grid-cols-2 gap-2 mt-2">
          <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
          <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
        </div>
      </div>`;
      openModal(el.keypadModal, html);

      // ì‹¤ì‹œê°„ ì¹© ì²´í¬ ê¸°ëŠ¥ ì¶”ê°€
      if(options.purpose === 'bet' && playerChips > 0) {
        const display = el.keypadModal.querySelector('#keypad-display');
        const warning = el.keypadModal.querySelector('#keypad-warning');

        // ë””ìŠ¤í”Œë ˆì´ ê°’ ë³€ê²½ ê°ì§€
        const observer = new MutationObserver(() => {
          const value = parseInt(unformatNumber(display.textContent) || 0, 10);
          if(value > playerChips) {
            warning.classList.remove('hidden');
            warning.textContent = `âš ï¸ ì¹© ë¶€ì¡±! ìµœëŒ€ ë² íŒ… ê°€ëŠ¥: ${formatNumber(playerChips)}`;
            warning.className = 'text-xs text-red-400 text-center mb-2';
          } else if(value === playerChips && value > 0) {
            warning.classList.remove('hidden');
            warning.textContent = `ğŸ’° ìµœëŒ€ ë² íŒ… - ë³´ìœ  ì¹© ì „ì²´`;
            warning.className = 'text-xs text-blue-400 text-center mb-2';
          } else {
            warning.classList.add('hidden');
          }
        });

        observer.observe(display, { childList: true, characterData: true, subtree: true });
      }
    }

    // ====== SELECTORS & INPUTS ======
    function togglePlayerInHand(name){
      const i=window.state.playersInHand.findIndex(p=>p.name===name);
      if(i>-1) {
        // í”Œë ˆì´ì–´ ì œê±° (ê²Œì„ì—ì„œ ì œì™¸)
        const player = window.state.playersInHand[i];
        window.state.playersInHand.splice(i,1);
        // seatMapì—ì„œë„ ì œê±°
        if(player.seat) {
          delete window.state.seatMap[player.seat];
        }
        console.log(`â– ${name} ê²Œì„ì—ì„œ ì œì™¸ (Seat ${player.seat})`);
      } else {
        // í”Œë ˆì´ì–´ ì¶”ê°€ (ê²Œì„ì— ì°¸ì—¬)
        const pool=window.state.playerDataByTable[window.state.selectedTable]||[];
        const pd=pool.find(p=>p.name===name);
        if(!pd) return;
        
        const chips=pd.chips||'';
        const notable=pd.notable||false;
        const seat=pd.seat||''; // Type ì‹œíŠ¸ì˜ seat ì •ë³´
        
        // seatMapì— ì¶”ê°€
        if(seat) {
          window.state.seatMap[seat] = name;
        }
        
        // ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œ initialChipsë¥¼ í˜„ì¬ ì¹©ìœ¼ë¡œ ì„¤ì •
        console.log(`â• ${name} ê²Œì„ ì°¸ì—¬: ì‹œì‘ì¹© = ${chips}, ì¢Œì„ = ${seat}`);
        window.state.playersInHand.push({
          name, 
          hand:[], 
          chips, 
          initialChips:chips,  // ì‹œì‘ì¹©ì€ í˜„ì¬ ì¹© ê°’ìœ¼ë¡œ ì„¤ì •
          role:null,
          notable:notable,  // Notable ì •ë³´ ì¶”ê°€
          seat:seat,  // Seat ì •ë³´ ìœ ì§€
          chipsSetAt: new Date().toISOString()  // ì¹© ì„¤ì • ì‹œê°„ ê¸°ë¡
        });
      }
      renderPlayerSelection(); 
      renderPlayerDetails(); 
      renderWinnerSelection();
    }
    function setPlayerRole(name){
      const finalPot = calculateFinalPot();
      
      // ê¸°ì¡´ ìŠ¹ì ì°¾ê¸°
      const prevWinner = window.state.playersInHand.find(p => p.role === 'winner');
      
      // ê¸°ì¡´ ìŠ¹ìê°€ ìˆìœ¼ë©´ íŒŸ ê¸ˆì•¡ ì°¨ê°
      if(prevWinner && prevWinner.name !== name) {
        const prevChips = parseInt(unformatNumber(prevWinner.chips) || 0, 10);
        prevWinner.chips = (prevChips - finalPot).toString();
        prevWinner.role = null;
      }
      
      // ìƒˆ ìŠ¹ì ì„¤ì •
      const p = window.state.playersInHand.find(pp => pp.name === name);
      if(!p) return;
      
      if(p.role === 'winner') {
        // ìŠ¹ì í•´ì œ
        const currentChips = parseInt(unformatNumber(p.chips) || 0, 10);
        p.chips = (currentChips - finalPot).toString();
        p.role = null;
      } else {
        // ìŠ¹ì ì„¤ì •
        const currentChips = parseInt(unformatNumber(p.chips) || 0, 10);
        p.chips = (currentChips + finalPot).toString();
        p.role = 'winner';
        
        // ë‹¤ë¥¸ ëª¨ë“  í”Œë ˆì´ì–´ì˜ role í•´ì œ
        window.state.playersInHand.forEach(player => {
          if(player.name !== name) player.role = null;
        });
      }
      
      // ì¹© ë³€ê²½ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡
      p.chipsUpdatedAt = new Date().toISOString();
      
      renderPlayerDetails(); 
      renderWinnerSelection();
      renderActionStreets(); // ì•¡ì…˜ ë¡œê·¸ì—ë„ ìŠ¹ì í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
    }
    function assignCard(cards){
      const {target,player,index,count} = window.state.modalState.cardTarget;
      if(target==='board'){
        if(!cards || cards.length === 0) {
          // ì¹´ë“œ ì œê±°
          if(count === 3) { // flop
            window.state.board[0] = null;
            window.state.board[1] = null;
            window.state.board[2] = null;
            window.state.board[3] = null; // í„´ë„ ì œê±°
            window.state.board[4] = null; // ë¦¬ë²„ë„ ì œê±°
          } else if(index === 3) { // turn
            window.state.board[3] = null;
          } else if(index === 4) { // river
            window.state.board[4] = null;
          }
        } else {
          // ë³´ë“œ ë°°ì—´ì´ ì¶©ë¶„í•œ í¬ê¸°ì¸ì§€ í™•ì¸
          while(window.state.board.length <= 4) {
            window.state.board.push(null);
          }
          
          // ì¹´ë“œ í• ë‹¹
          if(count === 3) { // flopì—ì„œ ì„ íƒ
            // í”Œë 3ì¥
            window.state.board[0] = cards[0] || null;
            window.state.board[1] = cards[1] || null;
            window.state.board[2] = cards[2] || null;
            
            // 4ì¥ ì´ìƒ ì„ íƒí–ˆìœ¼ë©´ í„´ì— í• ë‹¹
            if(cards.length >= 4) {
              window.state.board[3] = cards[3];
            }
            
            // 5ì¥ ì„ íƒí–ˆìœ¼ë©´ ë¦¬ë²„ì—ë„ í• ë‹¹
            if(cards.length >= 5) {
              window.state.board[4] = cards[4];
            }
          } else {
            // turn(index=3) ë˜ëŠ” river(index=4): í•´ë‹¹ ì¸ë±ìŠ¤ë§Œ ì—…ë°ì´íŠ¸
            window.state.board[index] = cards[0] || null;
          }
        }
        renderBoard();
      }
      else{
        const p=window.state.playersInHand.find(pp=>pp.name===player);
        if(p){ 
          p.hand = cards || []; // nullì´ë©´ ë¹ˆ ë°°ì—´ë¡œ
          renderPlayerDetails();
        }
      }
      closeModal(el.cardSelectorModal);
    }
    function addActionToLog(action, amount=null, player=null){
      const { actionPadStreet, actionPadPlayer } = window.state.modalState;
      const playerName = player || actionPadPlayer;

      // í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸ (null ì²´í¬ ì¶”ê°€)
      if (!action) {
        console.warn('addActionToLog: actionì´ null ë˜ëŠ” undefinedì…ë‹ˆë‹¤');
        return;
      }

      if (action === 'Folds') {
        window.state.playerStatus[playerName] = 'folded';
      } else if (action === 'All In') {
        window.state.playerStatus[playerName] = 'allin';
      } else if (action.includes('Call')) {
        window.state.playerStatus[playerName] = 'called';
      } else if (action.includes('Bet') || action.includes('Raise')) {
        window.state.playerStatus[playerName] = 'bet';
      }

      // ì•¡ì…˜ ê´€ë¦¬ìì™€ ë™ê¸°í™”
      if(window.actionManager && window.actionManager.actionMode === 'auto') {
        window.actionManager.currentStreet = actionPadStreet;
      }
      
      if (amount){
        const p = window.state.playersInHand.find(pp => pp.name === actionPadPlayer);
        if (p){
          const cur = parseInt(unformatNumber(p.chips) || 0, 10);
          const amountToDeduct = parseInt(unformatNumber(amount), 10);

          // ì¹© ì´ˆê³¼ ê²½ê³  (ì°¨ë‹¨í•˜ì§€ ì•ŠìŒ)
          // ìŒìˆ˜ ì¹©ë„ í—ˆìš©í•˜ì—¬ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬
          if(amountToDeduct > cur && action !== 'All In') {
            console.log(`[v3.3.3] ì¹© ì´ˆê³¼ ê²½ê³ : ${playerName} - ìš”ì²­: ${amountToDeduct}, ë³´ìœ : ${cur}`);

            // ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ì§„í–‰ì€ í—ˆìš©
            showFeedback(`âš ï¸ ì£¼ì˜: ì¹©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (ë³´ìœ : ${formatNumber(cur)}, ë² íŒ…: ${formatNumber(amountToDeduct)})`, true);
            showFeedback(`ğŸ’° ì¹©ì´ ë§ˆì´ë„ˆìŠ¤ê°€ ë©ë‹ˆë‹¤: ${formatNumber(cur - amountToDeduct)}`, false);
          }

          // ì¹© ì°¨ê° ì²˜ë¦¬ (ë§ˆì´ë„ˆìŠ¤ í—ˆìš©)
          if(action === 'All In') {
            p.chips = '0';
          } else {
            // ì¹© ì°¨ê° - ë§ˆì´ë„ˆìŠ¤ë„ í—ˆìš©
            const newChips = cur - amountToDeduct;
            p.chips = newChips.toString();

            // ë§ˆì´ë„ˆìŠ¤ ì¹©ì¸ ê²½ìš° ì‹œê°ì  í‘œì‹œë¥¼ ìœ„í•œ í”Œë˜ê·¸
            if(newChips < 0) {
              p.hasNegativeChips = true;
              console.log(`[v3.3.3] ë§ˆì´ë„ˆìŠ¤ ì¹© ë°œìƒ: ${playerName} = ${newChips}`);
            } else {
              p.hasNegativeChips = false;
            }
          }
          p.chipsUpdatedAt = new Date().toISOString();
        }
      }
      window.state.actionState[actionPadStreet].push({
        player: actionPadPlayer,
        action,
        amount,
        timestamp: new Date().toISOString()
      });
      saveActionState();
      renderAll();
      closeModal(el.actionPadModal);
      
      // ìŠ¤íŠ¸ë¦¬íŠ¸ ì™„ë£Œ ì²´í¬
      checkStreetComplete(actionPadStreet);
    }

    function undoLastAction(street){
      const last=window.state.actionState[street].pop();
      if(last) {
        // í”Œë ˆì´ì–´ ìƒíƒœ ë³µì›
        if(last.action === 'Folds' || last.action === 'All In') {
          delete window.state.playerStatus[last.player];
        }
        
        // ì¹© ë³µì›
        if(last.amount){
          const p=window.state.playersInHand.find(pp=>pp.name===last.player);
          if(p){ 
            const cur=parseInt(unformatNumber(p.chips)||0,10); 
            p.chips=(cur+parseInt(unformatNumber(last.amount),10)).toString(); 
          }
        }
      }
      saveActionState(); renderAll();
    }

    // ====== SEAT ARRANGEMENT & ACTION ORDER ======
    function initializeSeatGrid() {
      const buttonSelect = document.getElementById('button-position-select');
      
      // ë²„íŠ¼ ìœ„ì¹˜ ì˜µì…˜ ìƒì„± (10ê°œ)
      if(buttonSelect) {
        buttonSelect.innerHTML = '<option value="">ì„ íƒ</option>';
        for(let i = 1; i <= 10; i++) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = `${i}ë²ˆ`;
          buttonSelect.appendChild(option);
        }
      }
      
      // ì´ˆê¸° ë Œë”ë§
      renderPlayerSelection();
    }
    
    function updateSeatDisplay() {
      // ìƒˆë¡œìš´ êµ¬ì¡°ì—ì„œëŠ” renderPlayerSelectionì´ ëª¨ë“  ê²ƒì„ ì²˜ë¦¬
      // renderPlayerSelection ë‚´ë¶€ì—ì„œ updatePositionIndicatorsë¥¼ í˜¸ì¶œí•¨
      renderPlayerSelection();
    }
    
    function getPositionsForSeat(seatNum) {
      const positions = [];
      if(!window.state.buttonPosition) return positions;
      
      const btnPos = parseInt(window.state.buttonPosition);
      const allPlayerSeats = getAllPlayerSeats();
      
      if(seatNum === btnPos) positions.push('BTN');
      
      // SB, BB ê³„ì‚° (ì „ì²´ í”Œë ˆì´ì–´ ì¤‘ ë²„íŠ¼ ë‹¤ìŒ í”Œë ˆì´ì–´ë“¤)
      const sbSeat = getNextPlayerSeat(btnPos, allPlayerSeats);
      const bbSeat = getNextPlayerSeat(sbSeat, allPlayerSeats);
      
      if(seatNum === sbSeat) positions.push('SB');
      if(seatNum === bbSeat) positions.push('BB');
      
      return positions;
    }
    
    function getOccupiedSeats() {
      return Object.keys(window.state.seatMap)
        .map(s => parseInt(s))
        .filter(s => window.state.seatMap[s])
        .sort((a, b) => a - b);
    }
    
    // ì „ì²´ í”Œë ˆì´ì–´ ì¢Œì„ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ê²Œì„ ì°¸ì—¬ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´)
    function getAllPlayerSeats() {
      if(!window.state.selectedTable) return [];
      const tableData = window.state.playerDataByTable[window.state.selectedTable] || [];
      return tableData
        .filter(player => player.seat)
        .map(player => parseInt(player.seat))
        .sort((a, b) => a - b);
    }
    
    // ì „ì²´ í”Œë ˆì´ì–´ ì¤‘ì—ì„œ ë‹¤ìŒ ì¢Œì„ ì°¾ê¸° (SB/BB ê³„ì‚°ìš©)
    function getNextPlayerSeat(currentSeat, allSeats) {
      if(!allSeats.length) return null;
      
      // í˜„ì¬ ì¢Œì„ ë‹¤ìŒì˜ ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ ì¢Œì„ ì°¾ê¸°
      for(let i = 1; i <= 10; i++) {
        const nextSeat = ((currentSeat + i - 1) % 10) + 1;
        if(allSeats.includes(nextSeat)) {
          return nextSeat;
        }
      }
      return allSeats[0];
    }
    
    function getNextOccupiedSeat(currentSeat, occupiedSeats) {
      if(!occupiedSeats.length) return null;
      
      // í˜„ì¬ ì¢Œì„ ë‹¤ìŒì˜ ì²« ë²ˆì§¸ ì ìœ  ì¢Œì„ ì°¾ê¸°
      for(let i = 1; i <= 10; i++) {
        const nextSeat = ((currentSeat + i - 1) % 10) + 1;
        if(occupiedSeats.includes(nextSeat)) {
          return nextSeat;
        }
      }
      return occupiedSeats[0];
    }
    
    function updateButtonPositionDisplay() {
      const display = document.getElementById('position-display');
      if(!display) return;
      
      if(!window.state.buttonPosition) {
        display.innerHTML = '<span class="text-gray-400">ë²„íŠ¼ì„ ì„ íƒí•˜ë©´ SB/BBê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤</span>';
        return;
      }
      
      // ì „ì²´ í”Œë ˆì´ì–´ ì¢Œì„ ë¦¬ìŠ¤íŠ¸ì—ì„œ SB/BB ê³„ì‚°
      const allPlayerSeats = getAllPlayerSeats();
      const btnPos = parseInt(window.state.buttonPosition);
      const sbSeat = getNextPlayerSeat(btnPos, allPlayerSeats);
      const bbSeat = getNextPlayerSeat(sbSeat, allPlayerSeats);
      
      // í”Œë ˆì´ì–´ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ì „ì²´ í…Œì´ë¸” ë°ì´í„°ì—ì„œ)
      const tableData = window.state.playerDataByTable[window.state.selectedTable] || [];
      const btnPlayer = tableData.find(p => parseInt(p.seat) === btnPos)?.name || 'ë¹ˆìë¦¬';
      const sbPlayer = tableData.find(p => parseInt(p.seat) === sbSeat)?.name || 'ë¹ˆìë¦¬';
      const bbPlayer = tableData.find(p => parseInt(p.seat) === bbSeat)?.name || 'ë¹ˆìë¦¬';
      
      display.innerHTML = `
        <div class="grid grid-cols-3 gap-2 text-center">
          <div class="bg-yellow-900/30 rounded p-1">
            <span class="text-yellow-400 font-bold">ğŸ¯ BTN</span>
            <div class="text-white text-xs">${btnPlayer}</div>
          </div>
          <div class="bg-green-900/30 rounded p-1">
            <span class="text-green-400 font-bold">SB</span>
            <div class="text-white text-xs">${sbPlayer}</div>
          </div>
          <div class="bg-blue-900/30 rounded p-1">
            <span class="text-blue-400 font-bold">BB</span>
            <div class="text-white text-xs">${bbPlayer}</div>
          </div>
        </div>
      `;
    }
    
    function updatePositionIndicators() {
      const indicators = document.getElementById('position-indicators');
      if(!window.state.buttonPosition) {
        indicators.textContent = '';
        return;
      }
      
      // ì „ì²´ í”Œë ˆì´ì–´ ì¢Œì„ ë¦¬ìŠ¤íŠ¸ì—ì„œ SB/BB ê³„ì‚°
      const allPlayerSeats = getAllPlayerSeats();
      const btnPos = parseInt(window.state.buttonPosition);
      const sbSeat = getNextPlayerSeat(btnPos, allPlayerSeats);
      const bbSeat = getNextPlayerSeat(sbSeat, allPlayerSeats);
      
      // í”Œë ˆì´ì–´ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ì „ì²´ í…Œì´ë¸” ë°ì´í„°ì—ì„œ)
      const tableData = window.state.playerDataByTable[window.state.selectedTable] || [];
      const btnPlayer = tableData.find(p => parseInt(p.seat) === btnPos)?.name || 'ë¹ˆìë¦¬';
      const sbPlayer = tableData.find(p => parseInt(p.seat) === sbSeat)?.name || 'ë¹ˆìë¦¬';
      const bbPlayer = tableData.find(p => parseInt(p.seat) === bbSeat)?.name || 'ë¹ˆìë¦¬';
      
      indicators.innerHTML = `
        <span class="text-yellow-400">BTN: ${btnPlayer}</span>
        <span class="text-green-400">SB: ${sbPlayer}</span>
        <span class="text-blue-400">BB: ${bbPlayer}</span>
      `;
    }
    
    function getActionOrder(street) {
      const occupiedSeats = getOccupiedSeats();
      if(!occupiedSeats.length || !window.state.buttonPosition) {
        // ë²„íŠ¼ ìœ„ì¹˜ê°€ ì—†ìœ¼ë©´ ë°°ì—´ ìˆœì„œëŒ€ë¡œ
        return window.state.playersInHand.map(p => p.name);
      }
      
      const btnPos = parseInt(window.state.buttonPosition);
      const sbSeat = getNextOccupiedSeat(btnPos, occupiedSeats);
      const bbSeat = getNextOccupiedSeat(sbSeat, occupiedSeats);
      
      let actionOrder = [];
      
      if(street === 'preflop') {
        // í”„ë¦¬í”Œë: UTG(BB ë‹¤ìŒ) â†’ ... â†’ BTN â†’ SB â†’ BB
        let startSeat = getNextOccupiedSeat(bbSeat, occupiedSeats);
        let currentSeat = startSeat;
        
        // BB ì „ê¹Œì§€ ìˆœíšŒ
        while(currentSeat !== bbSeat) {
          if(window.state.seatMap[currentSeat]) {
            actionOrder.push(window.state.seatMap[currentSeat]);
          }
          currentSeat = getNextOccupiedSeat(currentSeat, occupiedSeats);
        }
        // ë§ˆì§€ë§‰ì— BB ì¶”ê°€
        if(window.state.seatMap[bbSeat]) {
          actionOrder.push(window.state.seatMap[bbSeat]);
        }
      } else {
        // í¬ìŠ¤íŠ¸í”Œë: SB â†’ BB â†’ ... â†’ BTN
        let currentSeat = sbSeat;
        let count = 0;
        
        while(count < occupiedSeats.length) {
          if(window.state.seatMap[currentSeat]) {
            actionOrder.push(window.state.seatMap[currentSeat]);
          }
          currentSeat = getNextOccupiedSeat(currentSeat, occupiedSeats);
          count++;
        }
      }
      
      return actionOrder;
    }
    
    function getNextActionPlayer(street) {
      const actionOrder = getActionOrder(street);
      const actions = window.state.actionState[street] || [];
      
      // í´ë“œ/ì˜¬ì¸ í”Œë ˆì´ì–´ ì œì™¸
      const activePlayers = actionOrder.filter(name => 
        window.state.playerStatus[name] !== 'folded' && 
        window.state.playerStatus[name] !== 'allin'
      );
      
      if(activePlayers.length === 0) return null;
      
      // ë§ˆì§€ë§‰ ì•¡ì…˜í•œ í”Œë ˆì´ì–´ ì°¾ê¸°
      for(let i = actions.length - 1; i >= 0; i--) {
        const lastPlayer = actions[i].player;
        const idx = activePlayers.indexOf(lastPlayer);
        if(idx !== -1) {
          // ë‹¤ìŒ í”Œë ˆì´ì–´ ë°˜í™˜
          return activePlayers[(idx + 1) % activePlayers.length];
        }
      }
      
      // ì•¡ì…˜ì´ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í™œì„± í”Œë ˆì´ì–´
      return activePlayers[0];
    }

    // ====== ì•¡ì…˜ ìë™ ë§¤í•‘ ì‹œìŠ¤í…œ ======
    
    // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´ ê³„ì‚°
    function calculateNextActionPlayer(street) {
      const actionOrder = getActionOrder(street);
      const actions = window.state.actionState[street] || [];
      
      // í´ë“œ/ì˜¬ì¸ í”Œë ˆì´ì–´ ì œì™¸í•œ í™œì„± í”Œë ˆì´ì–´ë§Œ
      const activePlayers = actionOrder.filter(name => {
        const status = window.state.playerStatus[name];
        return status !== 'folded' && status !== 'allin';
      });
      
      if(activePlayers.length === 0) {
        return null; // ëª¨ë“  í”Œë ˆì´ì–´ê°€ í´ë“œ/ì˜¬ì¸
      }
      
      // ì´ë²ˆ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ì•¡ì…˜í•œ íšŸìˆ˜ ê³„ì‚°
      const actionCounts = {};
      activePlayers.forEach(name => actionCounts[name] = 0);
      
      actions.forEach(action => {
        if(actionCounts.hasOwnProperty(action.player)) {
          actionCounts[action.player]++;
        }
      });
      
      // ê°€ì¥ ì ê²Œ ì•¡ì…˜í•œ í”Œë ˆì´ì–´ ì°¾ê¸° (ìˆœì„œëŒ€ë¡œ)
      for(const player of activePlayers) {
        const minActionCount = Math.min(...Object.values(actionCounts));
        if(actionCounts[player] === minActionCount) {
          return player;
        }
      }
      
      return activePlayers[0];
    }
    
    // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateNextActionDisplay() {
      const street = window.state.currentStreet;
      const nextPlayer = calculateNextActionPlayer(street);
      
      window.state.nextActionPlayer = nextPlayer;
      
      // í—¤ë”ì— í˜„ì¬ ì°¨ë¡€ í‘œì‹œ
      const turnIndicator = document.getElementById('current-turn-indicator');
      if(turnIndicator && nextPlayer) {
        const playerData = window.state.playersInHand.find(p => p.name === nextPlayer);
        const positions = playerData ? getPositionsForSeat(parseInt(playerData.seat) || 0) : [];
        const positionStr = positions.length > 0 ? `(${positions.join(',')})` : '';
        
        turnIndicator.innerHTML = `
          <span class="text-amber-400">í˜„ì¬ ì°¨ë¡€:</span>
          <span class="font-bold text-white">${nextPlayer} ${positionStr}</span>
        `;
        turnIndicator.classList.remove('hidden');
      } else if(turnIndicator) {
        turnIndicator.classList.add('hidden');
      }
      
      // í”Œë ˆì´ì–´ ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸
      document.querySelectorAll('.player-card').forEach(card => {
        const playerName = card.dataset.playerName;
        if(playerName === nextPlayer) {
          card.classList.add('border-2', 'border-amber-400', 'animate-pulse');
        } else {
          card.classList.remove('border-2', 'border-amber-400', 'animate-pulse');
        }
      });
    }
    
    // ì•¡ì…˜ ìë™ ì¶”ê°€ (ìë™ ëª¨ë“œ)
    function addAutoAction(actionType, amount = '') {
      if(window.state.actionInputMode !== 'auto') {
        return false;
      }
      
      const street = window.state.currentStreet;
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(street);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return false;
      }
      
      // ì•¡ì…˜ ì¶”ê°€
      addActionToState(nextPlayer, actionType, amount, street);
      
      // í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸
      if(actionType === 'Folds') {
        window.state.playerStatus[nextPlayer] = 'folded';
      } else if(actionType === 'All-in' || actionType === 'All In') {
        window.state.playerStatus[nextPlayer] = 'allin';
      }
      
      // UI ì—…ë°ì´íŠ¸
      renderActionStreets();
      updateNextActionDisplay();
      saveActionState();
      
      return true;
    }
    
    // ìŠ¤ë§ˆíŠ¸ ì½œ ì²˜ë¦¬
    function handleSmartCall() {
      const street = window.state.currentStreet;
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(street);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return;
      }
      
      const smartAction = getSmartCheckCallAction(nextPlayer, street);
      if(smartAction.action === 'Checks') {
        addAutoAction('Checks');
      } else {
        addAutoAction(smartAction.action, smartAction.amount);
      }
    }
    
    // ì˜¬ì¸ ì²˜ë¦¬
    function handleAllIn() {
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(window.state.currentStreet);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return;
      }
      
      const playerData = window.state.playersInHand.find(p => p.name === nextPlayer);
      if(playerData) {
        addAutoAction('All-in', playerData.chips);
      }
    }
    
    // ë¹ ë¥¸ ë²³/ë ˆì´ì¦ˆ ì…ë ¥
    function openQuickBetRaise() {
      const street = window.state.currentStreet;
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(street);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return;
      }
      
      // í‚¤íŒ¨ë“œ ì—´ê¸°
      openKeypad(null, { 
        purpose: 'quickBet',
        player: nextPlayer,
        street: street
      });
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
    window.addAutoAction = addAutoAction;
    window.handleSmartCall = handleSmartCall;
    window.handleAllIn = handleAllIn;
    window.openQuickBetRaise = openQuickBetRaise;
    
    // ====== PERSIST (localStorage) ======
    function saveActionState(){ localStorage.setItem('phl_v46_state', JSON.stringify(window.state.actionState)); }
    function loadActionState(){
      const s=localStorage.getItem('phl_v46_state');
      if(s) window.state.actionState={...window.state.actionState, ...JSON.parse(s)};
      updateBlindButtons();
    }

    function updateBlindButtons() {
      const smallBlindBtn = document.getElementById('small-blind-btn');
      const bigBlindBtn = document.getElementById('big-blind-btn');

      if(smallBlindBtn) {
        smallBlindBtn.textContent = formatNumber(window.state.actionState.smallBlind || '0');
      }
      if(bigBlindBtn) {
        bigBlindBtn.textContent = formatNumber(window.state.actionState.bigBlind || '0');
      }
    }

    // ====== SMART CHECK/CALL ======
    function getSmartCheckCallAction(player, street) {
      const actions = window.state.actionState[street];
      let lastBet = null;
      let requiredAmt = 0;
      
      // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œë§Œ ë§ˆì§€ë§‰ ë² íŒ… ì°¾ê¸° (ê° ìŠ¤íŠ¸ë¦¬íŠ¸ëŠ” ë…ë¦½ì )
      for(let i = actions.length - 1; i >= 0; i--) {
        const action = actions[i];
        if(['Bets', 'Raises', 'All In'].includes(action.action) && action.amount) {
          lastBet = action;
          break;
        }
      }
      
      const p = window.state.playersInHand.find(pp => pp.name === player);
      const playerChips = p ? parseInt(unformatNumber(p.chips), 10) : 0;
      
      if(!lastBet) {
        // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ… ì—†ìŒ â†’ CHECK
        if(street === 'preflop') {
          // í”„ë¦¬í”Œëì—ì„œ ë² íŒ… ì—†ìœ¼ë©´ ë¹…ë¸”ë¼ì¸ë“œ ì½œ
          requiredAmt = unformatNumber(window.state.actionState.bigBlind);
          if(playerChips <= parseInt(requiredAmt, 10)) {
            return { action: 'All In', amount: p.chips, label: `All-in ${formatNumber(p.chips)}` };
          }
          return { action: 'Calls', amount: requiredAmt, label: `Call ${formatNumber(requiredAmt)}` };
        }
        // í”Œë, í„´, ë¦¬ë²„ì—ì„œëŠ” ê° ìŠ¤íŠ¸ë¦¬íŠ¸ê°€ ìƒˆë¡œ ì‹œì‘ë˜ë¯€ë¡œ ì²´í¬ ê°€ëŠ¥
        return { action: 'Checks', amount: null, label: 'Check' };
      } else {
        // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ… ìˆìŒ â†’ CALL
        requiredAmt = lastBet.amount;
        if(playerChips <= parseInt(unformatNumber(requiredAmt), 10)) {
          // ì¹© ë¶€ì¡± â†’ ALL-IN
          return { action: 'All In', amount: p.chips, label: `All-in ${formatNumber(p.chips)}` };
        } else {
          // ì¼ë°˜ CALL
          return { action: 'Calls', amount: requiredAmt, label: `Call ${formatNumber(requiredAmt)}` };
        }
      }
    }
    
    // ====== STREET COMPLETE CHECK ======
    function checkStreetComplete(street) {
      const actions = window.state.actionState[street];
      const activePlayers = window.state.playersInHand.filter(p => 
        window.state.playerStatus[p.name] !== 'folded'
      );
      const bettingPlayers = activePlayers.filter(p =>
        window.state.playerStatus[p.name] !== 'allin'
      );
      
      // 1. í•¸ë“œ ì¢…ë£Œ ì²´í¬
      if(activePlayers.length === 1) {
        showFeedback(`${activePlayers[0].name} ìŠ¹ë¦¬!`);
        return { status: 'HAND_END', winner: activePlayers[0].name };
      }
      
      // 2. ì˜¬ì¸ ì‡¼ë‹¤ìš´ ì²´í¬
      if(bettingPlayers.length <= 1) {
        showFeedback('ì˜¬ì¸ ì‡¼ë‹¤ìš´! ë‚˜ë¨¸ì§€ ì¹´ë“œë¥¼ ì˜¤í”ˆí•˜ì„¸ìš”.');
        return { status: 'SHOWDOWN' };
      }
      
      // 3. ìŠ¤íŠ¸ë¦¬íŠ¸ ì™„ë£Œ ì²´í¬
      if(actions.length === 0) return { status: 'WAITING' };
      
      const lastAction = actions[actions.length - 1];
      if(!['Checks', 'Calls', 'Folds'].includes(lastAction.action)) {
        return { status: 'WAITING' };
      }
      
      // ê° í”Œë ˆì´ì–´ì˜ ì´ ë² íŒ…ì•¡ ê³„ì‚°
      const playerBets = {};
      actions.forEach(a => {
        if(a.amount && a.player) {
          playerBets[a.player] = (playerBets[a.player] || 0) + parseInt(unformatNumber(a.amount), 10);
        }
      });
      
      // ë² íŒ… ê°€ëŠ¥í•œ í”Œë ˆì´ì–´ë“¤ì˜ ë² íŒ…ì•¡ í™•ì¸
      const betAmounts = bettingPlayers.map(p => playerBets[p.name] || 0);
      const maxBet = Math.max(...betAmounts, 0);
      const allEqual = betAmounts.every(amt => amt === maxBet);
      
      if(allEqual) {
        const nextStreet = getNextStreet(street);
        if(nextStreet) {
          showFeedback(`${street} ì™„ë£Œ! ${nextStreet}ë¡œ ì§„í–‰`);
          // ìë™ ì§„í–‰ ì˜µì…˜ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬
          return { status: 'STREET_COMPLETE', nextStreet };
        }
      }
      
      return { status: 'WAITING' };
    }
    
    function getNextStreet(current) {
      const streets = ['preflop', 'flop', 'turn', 'river'];
      const idx = streets.indexOf(current);
      return idx >= 0 && idx < 3 ? streets[idx + 1] : null;
    }
    
    // ====== POT ======
    // í”Œë ˆì´ì–´ë³„ ì´ ê¸°ì—¬ì•¡ ê³„ì‚° (í´ë“œí•œ í”Œë ˆì´ì–´ í¬í•¨)
    function calculatePlayerContributions() {
      const contributions = {};
      const playersInHand = window.state.playersInHand || [];
      
      // 1. ëª¨ë“  í”Œë ˆì´ì–´ ì´ˆê¸°í™”
      playersInHand.forEach(player => {
        contributions[player.name] = 0;
      });
      
      // 2. ë¸”ë¼ì¸ë“œì™€ ì•ˆí‹° ë¨¼ì € ì¶”ê°€
      playersInHand.forEach(player => {
        const playerName = player.name;
        
        // ìŠ¤ëª° ë¸”ë¼ì¸ë“œ (ì²« ë²ˆì§¸ í”Œë ˆì´ì–´)
        if (player.role === 'SB' || playersInHand.indexOf(player) === 0) {
          const sbAmount = parseInt(unformatNumber(window.state.actionState.smallBlind) || 0, 10);
          contributions[playerName] += sbAmount;
        }
        
        // ë¹… ë¸”ë¼ì¸ë“œ (ë‘ ë²ˆì§¸ í”Œë ˆì´ì–´)  
        if (player.role === 'BB' || playersInHand.indexOf(player) === 1) {
          const bbAmount = parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
          contributions[playerName] += bbAmount;
        }
        
        // BB ì•ˆí‹° (ëª¨ë“  í”Œë ˆì´ì–´)
        if (window.state.actionState.hasBBAnte) {
          const bbAmount = parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
          contributions[playerName] += bbAmount;
        }
      });
      
      // 3. ê° ìŠ¤íŠ¸ë¦¬íŠ¸ë³„ë¡œ ìµœì¢… ë² íŒ… ê¸ˆì•¡ ê³„ì‚° (ì˜¬ë°”ë¥¸ í¬ì»¤ ë¡œì§)
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        const actions = window.state.actionState[street] || [];
        const streetBets = {}; // ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ê° í”Œë ˆì´ì–´ì˜ ë² íŒ… ê¸ˆì•¡
        
        // í•´ë‹¹ ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ ëª¨ë“  ì•¡ì…˜ì„ ìˆœíšŒí•˜ë©° ìµœì¢… ë² íŒ… ê¸ˆì•¡ ê³„ì‚°
        actions.forEach(action => {
          if(action.amount && action.player && action.action !== 'Pot Correction') {
            const player = action.player;
            const amount = parseInt(unformatNumber(action.amount), 10);
            
            // ì´ í”Œë ˆì´ì–´ì˜ ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ ë² íŒ… ê¸ˆì•¡ì„ action.amountë¡œ ì„¤ì •
            // (ì½œ/ë ˆì´ì¦ˆëŠ” ëˆ„ì ì´ ì•„ë‹ˆë¼ ìµœì¢… ë² íŒ… ê¸ˆì•¡)
            streetBets[player] = amount;
          }
        });
        
        // ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ ìµœì¢… ë² íŒ… ê¸ˆì•¡ì„ ì „ì²´ ê¸°ì—¬ì•¡ì— ì¶”ê°€
        Object.entries(streetBets).forEach(([player, amount]) => {
          const playerData = playersInHand.find(p => p.name === player);
          const maxChips = playerData ? parseInt(unformatNumber(playerData.initialChips) || 0, 10) : Infinity;
          
          // í˜„ì¬ ì´ ê¸°ì—¬ì•¡ + ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ ë² íŒ…ì´ ìµœëŒ€ ì¹©ì„ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ
          const currentContribution = contributions[player] || 0;
          const allowedAmount = Math.min(amount, Math.max(0, maxChips - currentContribution));
          
          contributions[player] = currentContribution + allowedAmount;
          
          if (allowedAmount < amount) {
            console.log(`âš ï¸ ${player} (${street}): ${amount} ìš”ì²­ â†’ ${allowedAmount} ì œí•œ (ìµœëŒ€: ${maxChips}, í˜„ì¬: ${currentContribution})`);
          }
        });
      });
      
      console.log('ğŸ“Š í”Œë ˆì´ì–´ë³„ ê¸°ì—¬ì•¡ (ì˜¬ì¸ ì œí•œ ì ìš©):', contributions);
      return contributions;
    }
    
    // ì‹¤ì œ íŒŸ ê³„ì‚° (ì˜¬ì¸ ì œí•œê³¼ ì‚¬ì´ë“œíŒŸì„ ê³ ë ¤í•œ ì •í™•í•œ ê³„ì‚°)
    function calculateActualPot() {
      console.log(`%cğŸ² === ìƒˆë¡œìš´ íŒŸ ê³„ì‚° ì‹œì‘ [${APP_VERSION}] ===`, 'color: #10b981; font-weight: bold');
      
      // Pot Correctionì´ ìˆìœ¼ë©´ ê¸°ì¡´ ë¡œì§ ì‚¬ìš©
      let potCorrectionFound = false;
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        const actions = window.state.actionState[street] || [];
        if(actions.find(a => a.action === 'Pot Correction')) {
          potCorrectionFound = true;
        }
      });
      
      if(potCorrectionFound) {
        return calculatePotWithCorrection();
      }
      
      // ìƒˆë¡œìš´ ì •í™•í•œ íŒŸ ê³„ì‚°
      const result = calculateAccuratePot();
      console.log(`%cğŸ² === íŒŸ ê³„ì‚° ì¢…ë£Œ [${APP_VERSION}] ===`, 'color: #10b981; font-weight: bold');
      return result.totalPot;
    }
    
    // ì •í™•í•œ íŒŸ ê³„ì‚° (ì˜¬ì¸ ì œí•œ ê³ ë ¤)
    function calculateAccuratePot() {
      const playersInHand = window.state.playersInHand || [];
      if (playersInHand.length === 0) {
        return { totalPot: 0, mainPot: 0, sidePots: [] };
      }
      
      // 1. ê° í”Œë ˆì´ì–´ì˜ ì´ ë² íŒ… ê°€ëŠ¥ ê¸ˆì•¡ ê³„ì‚° (ì´ˆê¸° ì¹©)
      const playerMaxBets = {};
      playersInHand.forEach(player => {
        playerMaxBets[player.name] = parseInt(unformatNumber(player.initialChips) || 0, 10);
      });
      
      console.log('ğŸ’° í”Œë ˆì´ì–´ë³„ ìµœëŒ€ ë² íŒ… ê°€ëŠ¥:', playerMaxBets);
      
      // 2. ì‹¤ì œ ë² íŒ… ê¸ˆì•¡ ê³„ì‚° (ë¸”ë¼ì¸ë“œ + ì•ˆí‹° + ì•¡ì…˜)
      const playerBets = calculatePlayerContributions();
      console.log('ğŸ“Š í”Œë ˆì´ì–´ë³„ ì‹¤ì œ ë² íŒ…:', playerBets);
      
      // 3. ì˜¬ì¸ í”Œë ˆì´ì–´ë“¤ì˜ ê¸ˆì•¡ëŒ€ë³„ë¡œ íŒŸ ë¶„ë¦¬
      const allInAmounts = [];
      playersInHand.forEach(player => {
        const playerName = player.name;
        const maxBet = playerMaxBets[playerName];
        const actualBet = Math.min(playerBets[playerName] || 0, maxBet);
        
        if (actualBet > 0 && !allInAmounts.includes(actualBet)) {
          allInAmounts.push(actualBet);
        }
      });
      
      allInAmounts.sort((a, b) => a - b);
      console.log('ğŸ¯ ì˜¬ì¸ ê¸ˆì•¡ëŒ€:', allInAmounts);
      
      // 4. ê°€ì¥ ì‘ì€ ì˜¬ì¸ ê¸ˆì•¡ì´ ë©”ì¸íŒŸ ê¸°ì¤€
      const mainPotCap = Math.min(...allInAmounts);
      let totalPot = 0;
      
      // ë©”ì¸íŒŸ: ëª¨ë“  í”Œë ˆì´ì–´ê°€ mainPotCapë§Œí¼ ê¸°ì—¬
      const eligiblePlayers = playersInHand.filter(p => 
        window.state.playerStatus[p.name] !== 'folded'
      );
      
      const mainPot = mainPotCap * eligiblePlayers.length;
      totalPot = mainPot;
      
      console.log(`ğŸ² ë©”ì¸íŒŸ: ${mainPot} (${eligiblePlayers.length}ëª… Ã— ${mainPotCap})`);
      
      // ì‚¬ì´ë“œíŒŸì€ í˜„ì¬ êµ¬í˜„í•˜ì§€ ì•Šê³  ë©”ì¸íŒŸë§Œ ë°˜í™˜
      // (ëŒ€ë¶€ë¶„ì˜ ê²½ìš° 2ëª…ì´ë¯€ë¡œ ì‚¬ì´ë“œíŒŸì´ ë¶ˆí•„ìš”)
      
      return { 
        totalPot: totalPot,
        mainPot: mainPot,
        sidePots: []
      };
    }
    
    // ê¸°ì¡´ Pot Correction ë¡œì§
    function calculatePotWithCorrection() {
      let totalPot = 0;
      let potCorrectionValue = 0;
      let additionalBets = 0;
      
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        const actions = window.state.actionState[street] || [];
        
        const potCorrectionIdx = actions.findIndex(a => a.action === 'Pot Correction');
        if(potCorrectionIdx !== -1) {
          const potCorrection = actions[potCorrectionIdx];
          potCorrectionValue = parseInt(unformatNumber(potCorrection.amount), 10);
          
          for(let i = potCorrectionIdx + 1; i < actions.length; i++) {
            if(actions[i].amount && actions[i].action !== 'Pot Correction') {
              additionalBets += parseInt(unformatNumber(actions[i].amount), 10);
            }
          }
          return;
        }
        
        actions.forEach(action => {
          if(action.amount && action.action !== 'Pot Correction') {
            totalPot += parseInt(unformatNumber(action.amount), 10);
          }
        });
      });
      
      if(potCorrectionValue > 0) {
        totalPot = potCorrectionValue + additionalBets;
      } else {
        totalPot += parseInt(unformatNumber(window.state.actionState.smallBlind) || 0, 10);
        totalPot += parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
        if(window.state.actionState.hasBBAnte) {
          const bbAmount = parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
          totalPot += bbAmount * (window.state.playersInHand || []).length;
        }
      }
      
      return totalPot;
    }
    
    // ì–¸ì½œ ë² íŒ… ê³„ì‚°
    function calculateUncalledBet() {
      const contributions = calculatePlayerContributions();
      const activePlayers = window.state.playersInHand.filter(p => 
        window.state.playerStatus[p.name] !== 'folded'
      );
      
      // í™œì„± í”Œë ˆì´ì–´ê°€ 1ëª…ì¼ ë•Œë§Œ ì–¸ì½œ ë² íŒ… ê³„ì‚°
      if(activePlayers.length === 1) {
        const winner = activePlayers[0];
        const winnerContribution = contributions[winner.name] || 0;
        
        // ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì˜ ìµœëŒ€ ê¸°ì—¬ì•¡
        const otherMaxContribution = Math.max(
          ...Object.entries(contributions)
            .filter(([player]) => player !== winner.name)
            .map(([_, amount]) => amount),
          0
        );
        
        // ì–¸ì½œ ë² íŒ… = ìŠ¹ì ê¸°ì—¬ì•¡ - íƒ€ í”Œë ˆì´ì–´ ìµœëŒ€ ê¸°ì—¬ì•¡
        const uncalledAmount = Math.max(0, winnerContribution - otherMaxContribution);
        
        return {
          amount: uncalledAmount,
          player: winner.name
        };
      }
      
      return { amount: 0, player: null };
    }
    
    // ê¸°ì¡´ calculatePotSize í•¨ìˆ˜ëŠ” UI í‘œì‹œìš©ìœ¼ë¡œ ìœ ì§€
    function calculatePotSize(){
      let pot=0;
      let potCorrectionFound = false;
      let potCorrectionValue = 0;
      
      // ëª¨ë“  ìŠ¤íŠ¸ë¦¬íŠ¸ ìˆœíšŒ
      ['preflop','flop','turn','river'].forEach(st=> {
        const actions = window.state.actionState[st];
        
        // Pot Correction ì°¾ê¸°
        const correctionIdx = actions.findIndex(a => a.action === 'Pot Correction');
        if(correctionIdx !== -1) {
          potCorrectionFound = true;
          potCorrectionValue = parseInt(unformatNumber(actions[correctionIdx].amount), 10);
          
          // Pot Correction ì´í›„ì˜ ì•¡ì…˜ë“¤ë§Œ ì¶”ê°€
          for(let i = correctionIdx + 1; i < actions.length; i++) {
            if(actions[i].amount && actions[i].action !== 'Pot Correction') {
              pot += parseInt(unformatNumber(actions[i].amount), 10);
            }
          }
        } else if(potCorrectionFound) {
          // Pot Correction ì´í›„ì˜ ìŠ¤íŠ¸ë¦¬íŠ¸
          actions.forEach(a => {
            if(a.amount && a.action !== 'Pot Correction') {
              pot += parseInt(unformatNumber(a.amount), 10);
            }
          });
        } else {
          // Pot Correction ì´ì „ì˜ ì•¡ì…˜ë“¤
          actions.forEach(a => {
            if(a.amount && a.action !== 'Pot Correction') {
              pot += parseInt(unformatNumber(a.amount), 10);
            }
          });
        }
      });
      
      // Pot Correctionì´ ì—†ìœ¼ë©´ ë¸”ë¼ì¸ë“œ/ì•¤í‹° ì¶”ê°€
      if(!potCorrectionFound) {
        pot += parseInt(unformatNumber(window.state.actionState.smallBlind)||0,10);
        pot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
        if(window.state.actionState.hasBBAnte) {
          pot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
        }
      } else {
        // Pot Correction ê°’ì´ ê¸°ì¤€
        pot = potCorrectionValue + pot;
      }
      
      return pot;
    }

    // ====== CSV LOADERS ======
    async function fetchCsv(url){
      const res=await fetch(url);
      if(!res.ok) {
        console.log(`CSV fetch status: ${res.status}`);
        return []; // ë¹ˆ ë°°ì—´ ë°˜í™˜
      }
      const txt=await res.text();
      return parseCSV(txt);
    }

    function buildTypeFromCsv(rows){
      // Type ì‹œíŠ¸ êµ¬ì¡°:
      // A:Camera Preset, B:Player, C:Table, D:Notable, E:Chips, F:updatedAt, G:Seat
      // A2: Cam1 name, A3: Cam2 name (ì¹´ë©”ë¼ í”„ë¦¬ì…‹ ì •ë³´)
      if(!rows||rows.length<1) return;
      const header=rows[0];
      const A2=(rows[1]&&rows[1][0])?String(rows[1][0]).trim():'';
      const A3=(rows[2]&&rows[2][0])?String(rows[2][0]).trim():'';
      window.state.camPreset.cam1=A2||'Cam1';
      window.state.camPreset.cam2=A3||'Cam2';
      // localStorageì—ì„œ ë§ˆì§€ë§‰ ì¹´ë©”ë¼ ë²ˆí˜¸ ì½ì–´ì„œ í‘œì‹œ
      const lastCam1No = localStorage.getItem('pokerHandLogger_lastCam1');
      const lastCam2No = localStorage.getItem('pokerHandLogger_lastCam2');
      
      console.log(`ğŸï¸ ì¹´ë©”ë¼ ë²„íŠ¼ ì´ˆê¸°í™”:`);
      console.log(`  ${window.state.camPreset.cam1} ì €ì¥ëœ ë²ˆí˜¸: ${lastCam1No || 'ì—†ìŒ'}`);
      console.log(`  ${window.state.camPreset.cam2} ì €ì¥ëœ ë²ˆí˜¸: ${lastCam2No || 'ì—†ìŒ'}`);
      
      if(lastCam1No) {
        const nextNo = parseInt(lastCam1No, 10) + 1;
        el.cam1.textContent = `${window.state.camPreset.cam1}${pad4(nextNo)}`;
        console.log(`  â†’ ${window.state.camPreset.cam1} í‘œì‹œ: ${pad4(nextNo)}`);
      } else {
        el.cam1.textContent = `${window.state.camPreset.cam1}0001`;
        console.log(`  â†’ ${window.state.camPreset.cam1} í‘œì‹œ: 0001 (ì´ˆê¸°ê°’)`);
      }
      
      if(lastCam2No) {
        const nextNo = parseInt(lastCam2No, 10) + 1;
        el.cam2.textContent = `${window.state.camPreset.cam2}${pad4(nextNo)}`;
        console.log(`  â†’ ${window.state.camPreset.cam2} í‘œì‹œ: ${pad4(nextNo)}`);
      } else {
        el.cam2.textContent = `${window.state.camPreset.cam2}0001`;
        console.log(`  â†’ ${window.state.camPreset.cam2} í‘œì‹œ: 0001 (ì´ˆê¸°ê°’)`);
      }

      const byTable={};
      for(let i=1;i<rows.length;i++){
        const r=rows[i]||[];
        // A:Camera Preset, B:Player, C:Table, D:Notable, E:Chips, F:updatedAt, G:Seat, H:Status
        const player=String(r[1]||'').trim();
        const table =String(r[2]||'').trim();
        const notable = String(r[3]||'').toUpperCase()==='TRUE';
        const chips = String(r[4]!=null?r[4]:'0').trim();
        const updatedAt = String(r[5]||'').trim(); // Fì—´: updatedAt
        const seat = String(r[6]||'').trim(); // Gì—´: Seat
        const status = String(r[7]||'IN').trim().toUpperCase(); // Hì—´: Status (ê¸°ë³¸ê°’: IN)

        console.log(`[v3.4.3] í”Œë ˆì´ì–´ ì²˜ë¦¬: ${player} (${table}) - ìƒíƒœ: ${status}`);

        // IN ìƒíƒœì¸ í”Œë ˆì´ì–´ë§Œ ì²˜ë¦¬ (ë¹ˆ ê°’ì´ë©´ INìœ¼ë¡œ ê°„ì£¼)
        if(player && table && status === 'IN'){
          if(!byTable[table]) byTable[table]=[];
          // v3.4.3: ì¤‘ë³µ í•„í„°ë§ ì™„ì „ ì œê±° - ëª¨ë“  í”Œë ˆì´ì–´ë¥¼ ë¡œì»¬ ë°ì´í„°ì— ìœ ì§€
          // ì¤‘ë³µ ì œê±°ëŠ” ë³„ë„ ì‹œìŠ¤í…œì—ì„œ ì²˜ë¦¬
          byTable[table].push({
            name: player,
            chips,
            notable,
            updatedAt,
            seat,
            status // ìƒíƒœë„ ì €ì¥
          });
          console.log(`[v3.4.3] âœ… ${player} ì¶”ê°€ë¨ (${table}, ì¢Œì„: ${seat}) - ì¤‘ë³µ í•„í„°ë§ ë¹„í™œì„±í™”`);
        } else {
          console.log(`[v3.4.3] âŒ ${player} ì œì™¸ë¨ - ìƒíƒœ: ${status} (${table})`);
        }
      }

      // ì²˜ë¦¬ ê²°ê³¼ ìš”ì•½ ë¡œê·¸
      console.log(`[v3.4.3] === buildTypeFromCsv ì™„ë£Œ ===`);
      console.log(`[v3.4.3] ì´ í…Œì´ë¸” ìˆ˜: ${Object.keys(byTable).length}`);
      Object.keys(byTable).forEach(table => {
        console.log(`[v3.4.3] ${table}: ${byTable[table].length}ëª… (IN ìƒíƒœë§Œ)`);
      });

      window.state.playerDataByTable=byTable;
      window.state.allTables=Object.keys(byTable).sort();
    }

    function buildIndexFromCsv(rows){
      // Index CSV columns:
      // A handNumber | B startRow | C endRow | D handUpdatedAt | E handEdit | F handEditTime | G label | H table | I tableUpdatedAt | J Cam | K CamFile01name | L CamFile01number | M CamFile02name | N CamFile02number
      // O lastStreet | P lastAction | Q workStatus (ìƒˆë¡œìš´ ì—´ë“¤)
      const out=[]; for(let i=1;i<rows.length;i++){
        const r=rows[i]||[];
        const item={
          handNumber:String(r[0]||''), startRow:+(r[1]||0), endRow:+(r[2]||0),
          handUpdatedAt:String(r[3]||''), handEdit:r[4], handEditTime:r[5], label:r[6],
          table:String(r[7]||''), tableUpdatedAt:r[8], cam:r[9], cam1:r[10], cam1no:r[11], cam2:r[12], cam2no:r[13],
          lastStreet:String(r[14]||''), lastAction:String(r[15]||''), workStatus:String(r[16]||'')  // ìƒˆë¡œìš´ ì—´ë“¤
        };
        if(item.handNumber) out.push(item);
      }
      window.state.indexRows=out;
      // ìµœì‹  ìš°ì„  ì •ë ¬
      out.sort((a,b)=> a.handUpdatedAt<b.handUpdatedAt?1:-1);
      window.state.allHandNumbers = [...new Set(out.map(x=>x.handNumber))];
    }

    // íŒŒì‹±: Hand CSV â†’ íŠ¹ì • handNumberì˜ "ê°€ì¥ ìµœê·¼ updatedAt" ë¸”ë¡
    function parseHandBlock(rows, handNumber, preferDate){
      // HAND ì‹œì‘ ìœ„ì¹˜ ìˆ˜ì§‘
      const starts=[];
      for(let r=0;r<rows.length;r++){
        const row=rows[r]||[];
        if(row[1]==='HAND'){
          const no=String(row[2]||'');
          if(no===String(handNumber)){
            starts.push({r});
          }
        }
      }
      if(!starts.length) return null;
    
      // Indexì—ì„œ ìµœì‹  updatedAt ê¸°ì¤€ ë¸”ë¡ ë²”ìœ„ ì°¾ê¸°
      let updatedAt=preferDate||null;
      if(!updatedAt){
        const candidates=window.state.indexRows.filter(x=>x.handNumber===String(handNumber));
        candidates.sort((a,b)=> a.handUpdatedAt<b.handUpdatedAt?1:-1);
        updatedAt=candidates[0]?.handUpdatedAt||null;
      }
      let startRowIdx=-1, endRowIdx=-1;
      const idxRow=window.state.indexRows.find(x=>x.handNumber===String(handNumber) && x.handUpdatedAt===updatedAt);
      if(idxRow){ startRowIdx=idxRow.startRow-1; endRowIdx=idxRow.endRow-1; }
      else{
        const last=starts[starts.length-1].r;
        startRowIdx=last;
        let r=last+1; while(r<rows.length && rows[r][1]!=='HAND') r++;
        endRowIdx=r-1;
      }
      if(startRowIdx<0 || endRowIdx<startRowIdx) return null;
    
      const block=rows.slice(startRowIdx,endRowIdx+1);
    
      // íŒŒì‹±
      let handInfo=null, players=[], board=[], smallBlind='', bigBlind='', ante=0, table='';
      // ìŠ¤íŠ¸ë¦¬íŠ¸ ë¶„í• : ë¸”ë¡ì„ **ìˆœì„œëŒ€ë¡œ** ëŒë©´ì„œ BOARDë¥¼ ë§Œë‚  ë•Œë§ˆë‹¤ ì „í™˜í•œë‹¤
      const streets={preflop:[],flop:[],turn:[],river:[]};
      let street='preflop';
      let seenBoard=0;
    
      for(const row of block){
        if(row[1]==='HAND'){
          handInfo=row;
          ante=parseInt(row[6]||0,10)||0;
          smallBlind=row[8]||'';
          bigBlind=row[9]||'';
          table=row[17]||'';
        }else if(row[1]==='PLAYER'){
          const name=row[2];
          const seat=row[3];
          // PLAYER íŒŒì‹±: row[4]ëŠ” 0, row[5]ëŠ” ì‹œì‘ì¹©, row[6]ì€ ì¢…ë£Œì¹©, row[7]ì€ í•¸ë“œ
          const init=row[5], final=row[6];
          const cards=(row[7]||'').trim()? String(row[7]).trim().split(' ') : [];
          players.push({name, seat, initialChips:init, finalChips:final, hand:cards});
        }else if(row[1]==='EVENT'){
          const etype=String(row[2]||'').toUpperCase();
          if(etype==='BOARD'){
            // ë³´ë“œ ì „í™˜ ì§€ì 
            const card=row[4];
            if(card) board.push(card);
            seenBoard++;
            if(seenBoard===3) street='flop';
            else if(seenBoard===4) street='turn';
            else if(seenBoard===5) street='river';
          }else{
            // ì¢Œì„ â†’ ì´ë¦„
            const seat=row[3];
            const amount=row[4];
            const time=row[5];
            const p=players.find(pp=>String(pp.seat)===String(seat));
            const name=p?p.name:'';
            streets[street].push({
              player:name,
              action:etype,
              amount:amount||null,
              timestamp:time||null
            });
          }
        }
      }

  // ìŠ¹ì íŒë‹¨ ë¡œì§ ê°œì„ : ê°€ì¥ ë§ì€ ì¹© ì¦ê°€ëŸ‰ì„ ê°€ì§„ í”Œë ˆì´ì–´ í•œ ëª…ë§Œ ìŠ¹ìë¡œ ì§€ì •
  let winnerName = null;
  let maxGain = 0;
  
  players.forEach(p => {
    const initial = parseInt(p.initialChips || 0, 10);
    const final = parseInt(p.finalChips || 0, 10);
    const gain = final - initial;
    
    if(gain > maxGain) {
      maxGain = gain;
      winnerName = p.name;
    }
  });

  return {
    handInfo,
    table,
    ante,
    smallBlind,
    bigBlind,
    hasBBAnte: ante>0,
    board,
    actions: streets,
    players: players.map(p=>({
      name:p.name,
      initialChips:p.initialChips,
      finalChips:p.finalChips,
      hand:p.hand,
      role: (p.name === winnerName && maxGain > 0) ? 'winner' : null
    }))
  };
}



    // ====== LOADERS (initial) ======
    async function loadInitial(){
      openLogModal(); el.logDisplay.innerHTML='';
      logMessage(`ğŸš€ ${APP_VERSION} ì´ˆê¸° ë°ì´í„° ë¡œë”© ì‹œì‘ (Type/Index) ...`);
      try{
        const [typeRows, idxRows] = await Promise.all([
          CSV_TYPE_URL.includes('http')? fetchCsv(CSV_TYPE_URL) : Promise.resolve([]),
          CSV_INDEX_URL.includes('http')? fetchCsv(CSV_INDEX_URL) : Promise.resolve([])
        ]);
        if(typeRows.length) buildTypeFromCsv(typeRows);
        if(idxRows.length) buildIndexFromCsv(idxRows);
        window.state.actionState.handNumber = (window.state.allHandNumbers.length>0? Math.max(...window.state.allHandNumbers.map(n=>parseInt(n,10)||0)) + 1 : 1).toString();
        el.handNumberDisplay.textContent = `#${window.state.actionState.handNumber}`;
        el.dataStamp.textContent = `IDX rows: ${window.state.indexRows.length}`;
        
        // Indexì—ì„œ ë§ˆì§€ë§‰ ì¹´ë©”ë¼ ë²ˆí˜¸ ì°¾ê¸° ë° localStorage ë™ê¸°í™”
        logMessage('ğŸ“· ì¹´ë©”ë¼ ë²ˆí˜¸ ë°ì´í„° ë¶„ì„ ì‹œì‘...');
        
        if(window.state.indexRows.length > 0) {
          logMessage(`ğŸ“Š ì´ ${window.state.indexRows.length}ê°œì˜ í•¸ë“œ ë°ì´í„° ê²€ìƒ‰ ì¤‘...`);
          
          // ê°€ì¥ ìµœê·¼ í•¸ë“œ ì°¾ê¸° (í•¸ë“œ ë²ˆí˜¸ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
          const sortedRows = window.state.indexRows.slice().sort((a,b) => {
            const numA = parseInt(a.handNumber, 10) || 0;
            const numB = parseInt(b.handNumber, 10) || 0;
            return numB - numA;
          });
          
          // ì¹´ë©”ë¼ ë²ˆí˜¸ê°€ ìˆëŠ” ê°€ì¥ ìµœê·¼ í•¸ë“œ ì°¾ê¸°
          let maxCam1 = 0, maxCam2 = 0;
          let foundInHand = null;
          
          for(const row of sortedRows) {
            const cam1Num = parseInt(row.cam1no, 10) || 0;
            const cam2Num = parseInt(row.cam2no, 10) || 0;
            
            if(cam1Num > maxCam1) {
              maxCam1 = cam1Num;
              if(!foundInHand) foundInHand = row.handNumber;
            }
            if(cam2Num > maxCam2) {
              maxCam2 = cam2Num;
              if(!foundInHand) foundInHand = row.handNumber;
            }
          }
          
          if(foundInHand) {
            logMessage(`ğŸ“ í•¸ë“œ #${foundInHand}ì—ì„œ ì¹´ë©”ë¼ ë²ˆí˜¸ ë°œê²¬`);
          }
          
          if(maxCam1 > 0) {
            localStorage.setItem('pokerHandLogger_lastCam1', String(maxCam1));
            logMessage(`âœ… ${window.state.camPreset.cam1} ë§ˆì§€ë§‰ ë²ˆí˜¸: ${maxCam1} â†’ ë‹¤ìŒ ë²ˆí˜¸: ${pad4(maxCam1 + 1)}`);
          } else {
            logMessage(`âš ï¸ ${window.state.camPreset.cam1} ë²ˆí˜¸ ë°ì´í„° ì—†ìŒ â†’ 0001ë¶€í„° ì‹œì‘`);
          }
          
          if(maxCam2 > 0) {
            localStorage.setItem('pokerHandLogger_lastCam2', String(maxCam2));
            logMessage(`âœ… ${window.state.camPreset.cam2} ë§ˆì§€ë§‰ ë²ˆí˜¸: ${maxCam2} â†’ ë‹¤ìŒ ë²ˆí˜¸: ${pad4(maxCam2 + 1)}`);
          } else {
            logMessage(`âš ï¸ ${window.state.camPreset.cam2} ë²ˆí˜¸ ë°ì´í„° ì—†ìŒ â†’ 0001ë¶€í„° ì‹œì‘`);
          }
        } else {
          logMessage('âš ï¸ Index ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ â†’ ì¹´ë©”ë¼ ë²ˆí˜¸ 0001ë¶€í„° ì‹œì‘');
        }
        
        renderAll();
        logMessage(`âœ… ${APP_VERSION} ì´ˆê¸° ë°ì´í„° ë¡œë”© ì™„ë£Œ`);
      }catch(err){
        console.error(err); logMessage(`ì´ˆê¸° ë¡œë”© ì‹¤íŒ¨: ${err.message}`, true);
      }finally{
        setTimeout(closeLogModal, 800);
      }
    }

    // ====== LOAD HAND MODAL ======
    function openLoadHandModal(){
      console.log('ğŸ“‚ Load Hand ëª¨ë‹¬ ì—´ê¸° ì‹œë„...');
      console.log('ğŸ“‹ Index í–‰ ê°œìˆ˜:', window.state.indexRows.length);
      
      if(!window.state.indexRows.length){
        console.error('âŒ Index ë°ì´í„° ì—†ìŒ');
        showFeedback('Index ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. CSV ê²Œì‹œì™€ URLì„ í™•ì¸í•˜ì„¸ìš”.', true);
        return;
      }
      
      // í•¸ë“œ ë²ˆí˜¸ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìµœì‹  í•¸ë“œê°€ ìœ„ë¡œ)
      const items = window.state.indexRows.slice().sort((a,b)=> {
        const numA = parseInt(a.handNumber, 10) || 0;
        const numB = parseInt(b.handNumber, 10) || 0;
        return numB - numA; // ë‚´ë¦¼ì°¨ìˆœ
      });
      
      const htmlItems = items.map(it=>{
        // ìƒíƒœ ì•„ì´ì½˜ ê²°ì •
        const statusIcon = {
          'ì™„ë£Œ': 'âœ…',
          'ì§„í–‰ì¤‘': 'ğŸ”„',
          'ê²€í† í•„ìš”': 'âš ï¸'
        }[it.workStatus] || 'ğŸ“';
        
        // ìŠ¤íŠ¸ë¦¬íŠ¸ ë°°ì§€ ìƒ‰ìƒê³¼ ìŠ¤íƒ€ì¼
        const streetColors = {
          'preflop': 'bg-green-500 text-white',
          'flop': 'bg-blue-500 text-white',
          'turn': 'bg-orange-500 text-white',
          'river': 'bg-red-500 text-white'
        };
        const streetBadge = it.lastStreet ? 
          `<span class="${streetColors[it.lastStreet] || 'bg-gray-500 text-white'} px-2 py-0.5 rounded text-xs font-bold">${it.lastStreet?.toUpperCase() || ''}</span>` : '';
        
        // ë²„íŠ¼ ë°°ê²½ìƒ‰ (ìƒíƒœë³„)
        const btnBgClass = it.workStatus === 'ì™„ë£Œ' ? 'bg-gray-800' : 
                          it.workStatus === 'ê²€í† í•„ìš”' ? 'bg-yellow-900/30' : 'bg-gray-700';
        
        return `<button class="btn ${btnBgClass} p-2 rounded-md w-full text-left load-hand-item-btn mb-2 hover:bg-gray-600" 
                data-no="${it.handNumber}" data-date="${it.handUpdatedAt}">
          <div class="flex justify-between items-center mb-1">
            <span class="font-bold text-white flex items-center gap-1">
              ${statusIcon} #${it.handNumber}
            </span>
            ${streetBadge}
            <span class="text-xs text-amber-400 truncate max-w-[100px]">${it.table||''}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs text-gray-400">${it.lastAction || 'ì•¡ì…˜ ì—†ìŒ'}</span>
            <span class="text-xs text-gray-500">${it.handUpdatedAt||''}</span>
          </div>
        </button>`;
      }).join('');
      
      const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-md flex flex-col h-2/3">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-amber-400">í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</h2>
          <button id="close-load-hand-modal" class="text-2xl">&times;</button>
        </div>
        <div class="overflow-y-auto space-y-2 flex-grow pr-2">${htmlItems}</div>
      </div>`;
      openModal(el.loadHandModal, html);
      
      // ëª¨ë‹¬ ë°– í´ë¦­ ì‹œ ë‹«ê¸° (ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì™€ ì¶©ëŒ ë°©ì§€)
      // onclick ëŒ€ì‹  ë³„ë„ì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš©
    }
    async function ensureHandCsv(){
      if(window.state.handCsvCache) return window.state.handCsvCache;
      logMessage('Hand CSV ë‹¤ìš´ë¡œë“œ ì¤‘...');
      const rows = await fetchCsv(CSV_HAND_URL + `&cb=${Date.now()}`);
      window.state.handCsvCache = rows;
      logMessage(`Hand CSV ë¡œë“œ ì™„ë£Œ (rows=${rows.length})`);
      return rows;
    }

    async function loadHandData(handNumber, preferDate){
      console.log(`ğŸ“¥ í•¸ë“œ #${handNumber} ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘...`);
      try{
        const rows = await ensureHandCsv();
        console.log(`ğŸ“Š Hand CSV ë¡œë“œ ì™„ë£Œ: ${rows.length} í–‰`);
        
        const data = parseHandBlock(rows, handNumber, preferDate);
        console.log('ğŸ“ íŒŒì‹±ëœ ë°ì´í„°:', data);
        
        if(!data){ 
          console.error(`âŒ Hand #${handNumber} ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
          showFeedback(`Hand #${handNumber} ë¸”ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`, true); 
          return; 
        }

        // ìƒíƒœ ì´ˆê¸°í™”
        window.state.playersInHand=[];
        window.state.board = data.board||[];
        window.state.playerStatus = {}; // í”Œë ˆì´ì–´ ìƒíƒœ ì´ˆê¸°í™” ì¶”ê°€
        
        window.state.actionState = {
          ...window.state.actionState,
          handNumber: String(handNumber),
          smallBlind: data.smallBlind || '',
          bigBlind: data.bigBlind || '',
          hasBBAnte: data.ante>0,
          preflop: data.actions?.preflop||[],
          flop: data.actions?.flop||[],
          turn: data.actions?.turn||[],
          river: data.actions?.river||[],
        };
        window.state.selectedTable = data.table || '';
        updateSelectedTableDisplay();

        window.state.playersInHand = (data.players||[]).map(p=>({
          name:p.name, hand:p.hand||[], chips:p.finalChips, initialChips:p.initialChips, role:p.role||null
        }));
        
        // í”Œë ˆì´ì–´ ìƒíƒœ ë³µì› (ì•¡ì…˜ì—ì„œ í´ë“œ/ì˜¬ì¸ í™•ì¸)
        ['preflop', 'flop', 'turn', 'river'].forEach(street => {
          (data.actions?.[street] || []).forEach(action => {
            if(action.player && action.action === 'Folds') {
              window.state.playerStatus[action.player] = 'folded';
            } else if(action.player && action.action === 'All In') {
              window.state.playerStatus[action.player] = 'allin';
            }
          });
        });

        el.handNumberDisplay.textContent = `#${handNumber}`;
        el.smallBlindInput.value = formatNumber(window.state.actionState.smallBlind);
        el.bigBlindInput.value = formatNumber(window.state.actionState.bigBlind);
        el.bbAnteCheckbox.checked = window.state.actionState.hasBBAnte;

        // currentStreet ê²°ì •: Indexì—ì„œ ì €ì¥ëœ ê°’ ìš°ì„ , ì—†ìœ¼ë©´ ì•¡ì…˜ìœ¼ë¡œ íŒë‹¨
        const indexRow = window.state.indexRows.find(r => r.handNumber === String(handNumber));
        console.log(`ğŸ” í•¸ë“œ #${handNumber} ë¡œë“œ ì¤‘...`);
        console.log('ğŸ“‹ Index í–‰ ë°ì´í„°:', indexRow);
        
        if(indexRow) {
          // ì¹´ë©”ë¼ ì •ë³´ ë¡œë“œ ë° ë¡œê¹…
          if(indexRow.cam1 || indexRow.cam1no) {
            console.log(`ğŸ“· ì¹´ë©”ë¼1 ì •ë³´ ë°œê²¬:`);
            console.log(`   - ì´ë¦„: ${indexRow.cam1 || 'ì—†ìŒ'}`);
            console.log(`   - ë²ˆí˜¸: ${indexRow.cam1no || 'ì—†ìŒ'}`);
            
            // ì¹´ë©”ë¼1 ì •ë³´ ì—…ë°ì´íŠ¸
            if(indexRow.cam1) {
              window.state.camPreset.cam1 = indexRow.cam1;
              console.log(`ğŸ“· ì¹´ë©”ë¼1 í”„ë¦¬ì…‹ ì—…ë°ì´íŠ¸: ${indexRow.cam1}`);
            }
            if(indexRow.cam1no) {
              window.state.camNumbers.cam1no = indexRow.cam1no;
              el.cam1.textContent = window.state.camPreset.cam1 + pad4(indexRow.cam1no);
            }
          }
          
          if(indexRow.cam2 || indexRow.cam2no) {
            console.log(`ğŸ“· ì¹´ë©”ë¼2 ì •ë³´ ë°œê²¬:`);
            console.log(`   - ì´ë¦„: ${indexRow.cam2 || 'ì—†ìŒ'}`);
            console.log(`   - ë²ˆí˜¸: ${indexRow.cam2no || 'ì—†ìŒ'}`);
            
            // ì¹´ë©”ë¼2 ì •ë³´ ì—…ë°ì´íŠ¸
            if(indexRow.cam2) {
              window.state.camPreset.cam2 = indexRow.cam2;
              console.log(`ğŸ“· ì¹´ë©”ë¼2 í”„ë¦¬ì…‹ ì—…ë°ì´íŠ¸: ${indexRow.cam2}`);
            }
            if(indexRow.cam2no) {
              window.state.camNumbers.cam2no = indexRow.cam2no;
              el.cam2.textContent = window.state.camPreset.cam2 + pad4(indexRow.cam2no);
            }
          }
          
          console.log('ğŸ“Š ë¡œë“œ í›„ ì¹´ë©”ë¼ ìƒíƒœ:');
          console.log(`   - cam1: ${window.state.camPreset.cam1}${pad4(window.state.camNumbers.cam1no || '0')}`);
          console.log(`   - cam2: ${window.state.camPreset.cam2}${pad4(window.state.camNumbers.cam2no || '0')}`);
          
          if(indexRow.lastStreet) {
            window.state.currentStreet = indexRow.lastStreet;
          }
          
          // ì‘ì—… ìƒíƒœ í‘œì‹œ
          if(indexRow.workStatus) {
            const statusText = {
              'ì™„ë£Œ': 'âœ… ì™„ë£Œëœ í•¸ë“œ',
              'ì§„í–‰ì¤‘': 'ğŸ”„ ì‘ì—… ì§„í–‰ ì¤‘',
              'ê²€í† í•„ìš”': 'âš ï¸ ê²€í†  í•„ìš”'
            }[indexRow.workStatus] || indexRow.workStatus;
            showFeedback(`#${handNumber} ${statusText}`);
          }
        } else {
          // ê¸°ì¡´ ë¡œì§: ì•¡ì…˜ìœ¼ë¡œ íŒë‹¨
          if(window.state.actionState.river.length > 0) {
            window.state.currentStreet = 'river';
          } else if(window.state.actionState.turn.length > 0) {
            window.state.currentStreet = 'turn';
          } else if(window.state.actionState.flop.length > 0) {
            window.state.currentStreet = 'flop';
          } else {
            window.state.currentStreet = 'preflop';
          }
        }

        renderAll(); saveActionState();
        
        
        closeModal(el.loadHandModal);
        showFeedback(`#${handNumber} í•¸ë“œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
      }catch(err){
        console.error('í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', err);
        console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', err.stack);
        showFeedback(`ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${err.message}`, true);
      }
    }

    // ====== GENERATE & SEND ======
    function formatISODateInTZ(date, tz){
      // yyyy-MM-dd
      const y = new Intl.DateTimeFormat('en-CA', { timeZone: tz, year:'numeric' }).format(date);
      const m = new Intl.DateTimeFormat('en-CA', { timeZone: tz, month:'2-digit' }).format(date);
      const d = new Intl.DateTimeFormat('en-CA', { timeZone: tz, day:'2-digit' }).format(date);
      return `${y}-${m}-${d}`;
    }

    function generateRows_v46(){
      const out=[]; let no=1;
      const push=(arr)=>{ const a=[no, ...arr]; while(a.length<18) a.push(''); out.push(a); no++; };

      const epochSec = Math.floor(Date.now()/1000);
      const sb = unformatNumber(window.state.actionState.smallBlind)||'0';
      const bb = unformatNumber(window.state.actionState.bigBlind)||'0';
      const ante = window.state.actionState.hasBBAnte ? bb : '0';
      const table = window.state.selectedTable || '';
      const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹

      // GAME / PAYOUTS - Eì—´(ì¸ë±ìŠ¤ 4)ì— ë‚ ì§œ ì¶”ê°€
      const gameRow = ['GAME','GGProd Hand Logger','Virtual Table', currentDate];
      push(gameRow);
      push(['PAYOUTS']);

      // HAND: C no, D code, G ante, I SB, J BB, R table
      const handDate = formatISODateInTZ(new Date(), window.state.selectedTimezone); // yyyy-MM-dd
      
      // HAND: C no, D code, G ante, I SB, J BB, R table
      push(['HAND',
        String(window.state.actionState.handNumber),
        epochSec,
        'HOLDEM',
        window.state.actionState.hasBBAnte ? 'BB_ANTE':'NO_ANTE',
        ante,
        handDate, // â˜… ì—¬ê¸°(H) ì¹¸ì— ë‚ ì§œë¥¼ ë„£ë„ë¡ ì•½ì† (Apps Scriptë„ ì´ ì¹¸ì€ ë‚ ì§œë¡œ ì“°ê²Œ)
        sb,       // I
        bb,       // J
        0,1,2,3,0,0,1,
        table     // R
      ]);

      // PLAYERS
      const players = window.state.playersInHand.map((p,i)=>({
        ...p, 
        seat: p.seat || (i+1)  // Typeì—ì„œ ê°€ì ¸ì˜¨ seat ì •ë³´ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì¸ë±ìŠ¤+1
      }));
      
      console.log(`%c=== PLAYER í–‰ ìƒì„± [${APP_VERSION}] ===`, 'color: #3b82f6; font-weight: bold');
      console.log(`í˜„ì¬ í–‰ë²ˆí˜¸(no): ${no}`);
      console.log(`í”Œë ˆì´ì–´ ìˆ˜: ${players.length}`);
      console.log('%cí˜•ì‹: A=í–‰ë²ˆí˜¸, B=PLAYER, C=ì´ë¦„, D=ì¢Œì„, E=0(ê³ ì •), F=ì‹œì‘ì¹©, G=ì¢…ë£Œì¹©, H=í•¸ë“œ, I=í¬ì§€ì…˜', 'color: #9ca3af');
      
      players.forEach(p=>{
        console.log(`\n--- ${p.name} ì²˜ë¦¬ ì‹œì‘ ---`);
        console.log(`  ì›ë³¸ ë°ì´í„°:`, p);
        
        // ì¹© ê°’ í™•ì¸ - initialChipsê°€ ì—†ìœ¼ë©´ chips ê°’ì„ ì‚¬ìš©
        let initialChips;
        let finalChips = parseInt(unformatNumber(p.chips)||0,10);
        
        // initialChipsê°€ undefinedì´ê±°ë‚˜ ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš° ì²˜ë¦¬
        if(p.initialChips === undefined || p.initialChips === '' || p.initialChips === null) {
          console.warn(`  âš ï¸ initialChipsê°€ ì—†ìŒ. chips ê°’ ì‚¬ìš©: ${p.chips}`);
          initialChips = finalChips; // ì‹œì‘ì¹©ì´ ì—†ìœ¼ë©´ í˜„ì¬ ì¹©ì„ ì‹œì‘ì¹©ìœ¼ë¡œ ì‚¬ìš©
        } else {
          const unformattedInitial = unformatNumber(p.initialChips);
          console.log(`  unformatNumber(p.initialChips) = "${unformattedInitial}"`);
          initialChips = parseInt(unformattedInitial || '0', 10);
          if(isNaN(initialChips)) {
            console.error(`  âŒ parseIntê°€ NaN ë°˜í™˜! ì›ë³¸: "${p.initialChips}"`);
            initialChips = 0;
          }
        }
        
        // ë””ë²„ê¹…: ì‹¤ì œ ê°’ í™•ì¸
        console.log(`  ì´ˆê¸°ì¹©(raw): "${p.initialChips}" â†’ ${initialChips}`);
        console.log(`  ìµœì¢…ì¹©(raw): "${p.chips}" â†’ ${finalChips}`);
        console.log(`  í•¸ë“œ: ${p.hand?.join(' ') || '(ì—†ìŒ)'}`);
        
        // ë°°ì—´ ìƒì„± ì „ ê°’ íƒ€ì… í™•ì¸
        console.log(`  initialChips íƒ€ì…: ${typeof initialChips}, ê°’: ${initialChips}`);
        console.log(`  finalChips íƒ€ì…: ${typeof finalChips}, ê°’: ${finalChips}`);
        
        // í¬ì§€ì…˜ ì •ë³´ ê³„ì‚° (BTN/SB/BB)
        const positions = getPositionsForSeat(parseInt(p.seat) || 1);
        const positionStr = positions.length > 0 ? positions.join(',') : '';
        
        // PLAYER í˜•ì‹: B=PLAYER, C=name, D=seat, E=0, F=ì‹œì‘ì¹©, G=ì¢…ë£Œì¹©, H=í•¸ë“œ, I=í¬ì§€ì…˜
        // push í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ í–‰ë²ˆí˜¸ë¥¼ Aì—´ì— ì¶”ê°€í•˜ë¯€ë¡œ 8ê°œ ìš”ì†Œ í•„ìš”
        const playerRow = ['PLAYER', p.name, parseInt(p.seat) || 1, 0, initialChips, finalChips, p.hand?.length? p.hand.join(' ') : '', positionStr];
        
        console.log(`  ===== PLAYER í–‰ ìƒì„± =====`);
        console.log(`  playerRow ë°°ì—´:`, playerRow);
        console.log(`  playerRow.length: ${playerRow.length}`);
        
        // ê° ìš”ì†Œ ê²€ì¦
        console.log(`  [0] = '${playerRow[0]}' (PLAYER ë¬¸ìì—´)`);
        console.log(`  [1] = '${playerRow[1]}' (ì´ë¦„: ${p.name})`);
        console.log(`  [2] = ${playerRow[2]} (ì¢Œì„: ${p.seat})`);
        console.log(`  [3] = ${playerRow[3]} (0 ê³ ì •ê°’)`);
        console.log(`  [4] = ${playerRow[4]} (ì‹œì‘ì¹©: ${initialChips})`);
        console.log(`  [5] = ${playerRow[5]} (ì¢…ë£Œì¹©: ${finalChips})`);
        console.log(`  [6] = '${playerRow[6]}' (í•¸ë“œ)`);
        console.log(`  [7] = '${playerRow[7]}' (í¬ì§€ì…˜: ${positionStr})`);
        
        // push ì „ í˜„ì¬ í–‰ë²ˆí˜¸
        const currentNo = no;
        console.log(`  push ì „ í–‰ë²ˆí˜¸: ${currentNo}`);
        
        push(playerRow);
        
        // push í›„ ì‹¤ì œ ì €ì¥ëœ ë°ì´í„° í™•ì¸
        const pushedRow = out[out.length - 1];
        console.log(`  push í›„ ì €ì¥ëœ í–‰:`, pushedRow);
        console.log(`  ìµœì¢… CSV í˜•ì‹:`);
        console.log(`    A=${pushedRow[0]} (í–‰ë²ˆí˜¸), B=${pushedRow[1]} (PLAYER), C=${pushedRow[2]} (ì´ë¦„), D=${pushedRow[3]} (ì¢Œì„),`);
        console.log(`    E=${pushedRow[4]} (0 ê³ ì •ê°’), F=${pushedRow[5]} (ì‹œì‘ì¹©), G=${pushedRow[6]} (ì¢…ë£Œì¹©), H=${pushedRow[7]} (í•¸ë“œ), I=${pushedRow[8]} (í¬ì§€ì…˜)`);
        console.log(`--- ${p.name} ì²˜ë¦¬ ì™„ë£Œ ---\n`);
      });

      // EVENTS
      const addEv=(log)=>{
        const p=players.find(x=>x.name===log.player);
        const seat=p?p.seat:'';
        const amt=log.amount? unformatNumber(log.amount):'';
        let t=(log.action||'').toUpperCase().replace(/S$/,'');
        if(t==='BET/RAISES') t='RAISE TO';
        push(['EVENT', t, seat, amt, '' ]);
      };
      window.state.actionState.preflop.forEach(addEv);
      if(window.state.board.length>=3){ push(['EVENT','BOARD',1,window.state.board[0],'' ]); push(['EVENT','BOARD',1,window.state.board[1],'' ]); push(['EVENT','BOARD',1,window.state.board[2],'' ]); }
      window.state.actionState.flop.forEach(addEv);
      if(window.state.board.length>=4){ push(['EVENT','BOARD',1,window.state.board[3],'' ]); }
      window.state.actionState.turn.forEach(addEv);
      if(window.state.board.length>=5){ push(['EVENT','BOARD',1,window.state.board[4],'' ]); }
      window.state.actionState.river.forEach(addEv);

      // ë§ˆì§€ë§‰ ë²ˆí˜¸í–‰(ì„ íƒ)
      out.push([no]); 
      return { rows: out, epochSec, currentDate };
    }
    
let isSending = false;

async function sendDataToGoogleSheet(){
  if (isSending) return;     // ì¤‘ë³µ ì „ì†¡ ê°€ë“œ
  isSending = true;

  // ìŠ¹ì ì²´í¬ ì œê±° - ìŠ¹ì ì—†ì–´ë„ ì „ì†¡ ê°€ëŠ¥
  const winners = window.state.playersInHand.filter(p=>p.role==='winner');

  await executeWithLock(async () => {
    openLogModal();
    logMessage('ì‹œíŠ¸ ì „ì†¡ ì‹œì‘...');

  try{
    const { rows, epochSec } = generateRows_v46();
    const indexMeta   = buildIndexMeta();
    // ìŠ¹ì ì •ë³´ ì¶”ê°€ (ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
    indexMeta.winners = winners.map(w => w.name).join(', ') || '';
    const typeUpdates = buildTypeUpdates();
    // ë…¸íŠ¸ ê¸°ëŠ¥ ì œê±°
    const payload = { rows, indexMeta, typeUpdates };

    // x-www-form-urlencodedë¡œ ì „ì†¡ â†’ í”„ë¦¬í”Œë¼ì´íŠ¸ ì—†ìŒ (CORS ìš°íšŒ)
    const form = new URLSearchParams();
    form.append('payload', JSON.stringify(payload));

    const res = await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body: form.toString(),
      // mode: 'cors'  // ìƒëµ ê°€ëŠ¥ (ê¸°ë³¸)
    });

    if(!res.ok){
      const text = await res.text().catch(()=> '');
      console.log(`ì„œë²„ ì‘ë‹µ: ${res.status} ${text || ''}`);
      showFeedback('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜', true);
      return;
    }

    const json = await res.json().catch(()=> ({}));

    if(json.status === 'duplicate'){
      logMessage(`âš ï¸ í•¸ë“œ #${json.handNumber}ëŠ” ì´ë¯¸ ê¸°ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`);
      showFeedback('âš ï¸ ì¤‘ë³µëœ í•¸ë“œì…ë‹ˆë‹¤', true);
      // ì¤‘ë³µì¸ ê²½ìš°ì—ë„ í•¸ë“œ ë²ˆí˜¸ë¥¼ ì¦ê°€ì‹œì¼œì•¼ í•¨
      const currentNo = parseInt(window.state.actionState.handNumber, 10) || 0;
      window.state.actionState.handNumber = String(currentNo + 1);
      el.handNumberDisplay.textContent = `#${window.state.actionState.handNumber}`;
      
      // ì¤‘ë³µì´ì–´ë„ ì‹œíŠ¸ì—ëŠ” ê¸°ë¡ëìœ¼ë¯€ë¡œ ìƒˆ í•¸ë“œë¡œ ì¬ì„¤ì •
      await resetApp();
      logMessage('âœ… ìƒˆ í•¸ë“œ ì¤€ë¹„ ì™„ë£Œ');
      
    } else if(json.status !== 'success'){
      logMessage('âš ï¸ Apps Scriptê°€ successë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      logMessage('âš ï¸ ì‹œíŠ¸ í™•ì¸ í›„ ìˆ˜ë™ìœ¼ë¡œ ì¬ì„¤ì • ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
      showFeedback('âš ï¸ ì‹œíŠ¸ ì „ì†¡ í™•ì¸ í•„ìš”', true);
      // ì„±ê³µ ì—¬ë¶€ê°€ ë¶ˆí™•ì‹¤í•˜ë¯€ë¡œ ìë™ ì¬ì„¤ì •í•˜ì§€ ì•ŠìŒ
      
    } else {
      logMessage(`âœ… ì €ì¥ ì™„ë£Œ: #${json.handNumber || indexMeta.handNumber} (rows=${json.rowsAdded})`);
      showFeedback('âœ… ì‹œíŠ¸ ê¸°ë¡ ì™„ë£Œ');
      
      // ì‹œíŠ¸ê°€ ì—…ë°ì´íŠ¸ë˜ë„ë¡ ì¶©ë¶„í•œ ì‹œê°„ì„ ê¸°ë‹¤ë¦¼
      logMessage('ì‹œíŠ¸ ë™ê¸°í™” ì¤‘...');
      await sleep(3000); // 3ì´ˆ ëŒ€ê¸°
      
      // Index CSV ë¦¬í”„ë ˆì‹œ
      try{
        if(CSV_INDEX_URL.includes('http')){
          const idxRows = await fetchCsv(CSV_INDEX_URL + `&cb=${Date.now()}`);
          buildIndexFromCsv(idxRows);
          el.dataStamp.textContent = `IDX rows: ${window.state.indexRows.length}`;
        }
      }catch(_){ /* noop */ }
      
      // ì„±ê³µì ìœ¼ë¡œ ì €ì¥ëœ ê²½ìš°ì—ë§Œ ìƒˆ í•¸ë“œë¡œ ì¬ì„¤ì •
      // ì‹œíŠ¸ ì „ì†¡ ì§í›„ì—ëŠ” Index ì¬ë¡œë“œ ì—†ì´ ë°”ë¡œ ë‹¤ìŒ ë²ˆí˜¸ë¡œ ì´ë™
      await resetApp(false, true);
      logMessage(`âœ… ${APP_VERSION} ìƒˆ í•¸ë“œ ì¤€ë¹„ ì™„ë£Œ`);
    }

  }catch(err){
    console.error(err);
    logMessage(`âŒ ì „ì†¡ ì‹¤íŒ¨: ${err.message}`, true);
    showFeedback(`âŒ ì „ì†¡ ì‹¤íŒ¨: ${err.message}`, true);
    // ì „ì†¡ ì‹¤íŒ¨ ì‹œì—ëŠ” ì¬ì„¤ì •í•˜ì§€ ì•ŠìŒ
    logMessage('âš ï¸ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì¬ì„¤ì •í•´ì£¼ì„¸ìš”.');
  }finally{
    closeLogModal(); // ë¡œê·¸ë¥¼ ì¢€ ë” ì˜¤ë˜ ë³´ì—¬ì¤Œ
  }
  }, 'ì‹œíŠ¸ ì „ì†¡', 'ë°ì´í„°ë¥¼ Google ì‹œíŠ¸ì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...');

  isSending = false;
}


    function nowIso() {
      // ì„œë²„ì—ì„œ timezone ë³€í™˜í•˜ë¯€ë¡œ UTC ISOë¡œ ë³´ëƒ„
      return new Date().toISOString();
    }
    function buildIndexMeta(){
      const handNumber = String(window.state.actionState.handNumber);
      const handUpdatedAt = new Date().toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹
      const table = window.state.selectedTable || '';
      
      // ì¹´ë©”ë¼ ì •ë³´ ë¡œê¹…
      console.log('ğŸ“¦ Index ë©”íƒ€ë°ì´í„° ë¹Œë“œ:');
      console.log(`  cam1: ${window.state.camPreset.cam1} / ë²ˆí˜¸: ${window.state.camNumbers.cam1no}`);
      console.log(`  cam2: ${window.state.camPreset.cam2} / ë²ˆí˜¸: ${window.state.camNumbers.cam2no}`);
      
      // ë§ˆì§€ë§‰ ì•¡ì…˜ ì°¾ê¸°
      let lastActionDesc = '';
      const streets = ['river', 'turn', 'flop', 'preflop'];
      for(const st of streets) {
        const actions = window.state.actionState[st];
        if(actions.length > 0) {
          const last = actions[actions.length - 1];
          lastActionDesc = `${last.player} ${last.action} ${last.amount || ''}`.trim();
          break;
        }
      }
      
      // ì‘ì—… ìƒíƒœ íŒë‹¨
      function determineWorkStatus() {
        // ìŠ¹ìê°€ ì„ íƒë˜ì—ˆìœ¼ë©´ 'ì™„ë£Œ'
        if(window.state.playersInHand.some(p => p.role === 'winner')) {
          return 'ì™„ë£Œ';
        }
        // ë¦¬ë²„ê¹Œì§€ ê°”ìœ¼ë©´ 'ê²€í† í•„ìš”'
        if(window.state.currentStreet === 'river' && window.state.actionState.river.length > 0) {
          return 'ê²€í† í•„ìš”';
        }
        return 'ì§„í–‰ì¤‘';
      }
      
      // Index ì‹œíŠ¸ì˜ ì „ì²´ ì—´ êµ¬ì¡°ì— ë§ê²Œ ë°ì´í„° ì¤€ë¹„
      return {
        handNumber,                                           // Aì—´
        // startRow, endRowëŠ” ì„œë²„ì—ì„œ ê³„ì‚°                    // B,Cì—´
        handUpdatedAt,                                        // Dì—´ (YYYY-MM-DD)
        // handEditëŠ” ë¹„ì›Œë‘                                   // Eì—´
        // handEditTimeì€ ì„œë²„ì—ì„œ ì²˜ë¦¬                        // Fì—´
        label: 'HOLDEM',                                      // Gì—´
        table,                                                 // Hì—´
        tableUpdatedAt: handUpdatedAt,                        // Iì—´ (YYYY-MM-DD)
        cam: `${window.state.camPreset.cam1 || ''}+${window.state.camPreset.cam2 || ''}`, // Jì—´
        camFile01name: window.state.camPreset.cam1 || '',            // Kì—´
        camFile01number: getCamNumber('cam1'), // Lì—´ - ìë™ ê³„ì‚°ëœ ë²ˆí˜¸
        camFile02name: window.state.camPreset.cam2 || '',            // Mì—´
        camFile02number: getCamNumber('cam2'), // Nì—´ - ìë™ ê³„ì‚°ëœ ë²ˆí˜¸
        lastStreet: window.state.currentStreet,                      // Oì—´
        lastAction: lastActionDesc,                           // Pì—´
        workStatus: determineWorkStatus()                     // Qì—´
      };
    }

    function buildTypeUpdates(){
      // ì´ë²ˆ í•¸ë“œ ë™ì•ˆ ì¹©ì´ ìˆ˜ì •ëœ í”Œë ˆì´ì–´ë§Œ ì¶”ë ¤ì„œ Typeì— updatedAt ê¸°ë¡
      const table = window.state.selectedTable || '';
      return window.state.playersInHand
        .filter(p => p.chipsUpdatedAt) // ìˆ˜ì •ëœ ì¼€ì´ìŠ¤ë§Œ
        .map((p, index) => ({
          player: p.name,
          table,
          notable: p.notable || false, // Notable ì •ë³´ ì¶”ê°€
          chips: String(p.chips || ''),
          updatedAt: p.chipsUpdatedAt, // ISO. ì•± ìŠ¤í¬ë¦½íŠ¸ì—ì„œ Dateë¡œ set
          seat: String(p.seat || index + 1) // Seat ì •ë³´ ì¶”ê°€ (ì¢Œì„ ë²ˆí˜¸ ë˜ëŠ” ì¸ë±ìŠ¤+1)
        }));
    }



    // ====== CAM PREFILL ======
    function computeCamPrefill(which){
      // 1) ìì‹ ì˜ ê°’ ìˆìœ¼ë©´ ê·¸ê±¸ í‘œì‹œ
      if (which==='cam1' && window.state.camNumbers.cam1no) return pad4(window.state.camNumbers.cam1no);
      if (which==='cam2' && window.state.camNumbers.cam2no) return pad4(window.state.camNumbers.cam2no);

      // 2) ì§ì˜ ê°’ ê¸°ë°˜ ìë™ ì¦ê°€
      if (which==='cam2' && window.state.camNumbers.cam1no){
        return pad4((parseInt(window.state.camNumbers.cam1no,10)||0)+1);
      }
      if (which==='cam1' && window.state.camNumbers.cam2no){
        const v = (parseInt(window.state.camNumbers.cam2no,10)||0)-1;
        return pad4(v<0?0:v);
      }

      // 3) ë§ˆì§€ë§‰ ì…ë ¥(ì„¸ì…˜ ê¸°ì¤€) +1
      if (window.state.lastCamNo!=null){
        return pad4((parseInt(window.state.lastCamNo,10)||0)+1);
      }

      // 4) ê¸°ë³¸ê°’
      return '0001';
    }

    // ì¹´ë©”ë¼ ë²ˆí˜¸ë§Œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ (íŒ¨ë”© ì—†ì´)
    function getCamNumber(which) {
      // 1) ìì‹ ì˜ ê°’ ìˆìœ¼ë©´ ê·¸ê±¸ ë°˜í™˜
      if (which === 'cam1' && window.state.camNumbers.cam1no) return window.state.camNumbers.cam1no;
      if (which === 'cam2' && window.state.camNumbers.cam2no) return window.state.camNumbers.cam2no;

      // 2) ì§ì˜ ê°’ ê¸°ë°˜ ìë™ ì¦ê°€
      if (which === 'cam2' && window.state.camNumbers.cam1no) {
        return String((parseInt(window.state.camNumbers.cam1no, 10) || 0) + 1);
      }
      if (which === 'cam1' && window.state.camNumbers.cam2no) {
        const v = (parseInt(window.state.camNumbers.cam2no, 10) || 0) - 1;
        return String(v < 0 ? 0 : v);  // 0ë³´ë‹¤ ì‘ìœ¼ë©´ 0ìœ¼ë¡œ
      }

      // 3) ë§ˆì§€ë§‰ ì…ë ¥(ì„¸ì…˜ ê¸°ì¤€) +1
      if (window.state.lastCamNo != null) {
        return String((parseInt(window.state.lastCamNo, 10) || 0) + 1);
      }

      // 4) í˜„ì¬ í‘œì‹œëœ ì¹´ë©”ë¼ ê°’ì—ì„œ íŒ¨ë”©ì„ ì œê±°í•œ ìˆ«ìê°’ ë°˜í™˜
      // computeCamPrefillê³¼ ê°™ì€ ë¡œì§ì´ì§€ë§Œ ìˆœí™˜ì°¸ì¡°ë¥¼ í”¼í•˜ê¸° ìœ„í•´ ì§ì ‘ êµ¬í˜„
      if (which === 'cam1' && el.cam1) {
        const displayText = el.cam1.textContent || '';
        const match = displayText.match(/(\d+)$/); // ë§ˆì§€ë§‰ ìˆ«ìë“¤ ì¶”ì¶œ
        if (match) {
          return String(parseInt(match[1], 10) || 0);
        }
      }
      if (which === 'cam2' && el.cam2) {
        const displayText = el.cam2.textContent || '';
        const match = displayText.match(/(\d+)$/); // ë§ˆì§€ë§‰ ìˆ«ìë“¤ ì¶”ì¶œ
        if (match) {
          return String(parseInt(match[1], 10) || 0);
        }
      }

      // 5) ìµœì¢… ê¸°ë³¸ê°’
      return '0';
    }


    // ====== SIDEPOT CALCULATION ======
    function calculateSidePots() {
      const contributions = {};
      
      // ê° ìŠ¤íŠ¸ë¦¬íŠ¸ë³„ í”Œë ˆì´ì–´ ê¸°ì—¬ì•¡ ê³„ì‚°
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        window.state.actionState[street].forEach(action => {
          if(action.amount && action.player) {
            contributions[action.player] = (contributions[action.player] || 0) + 
                                          parseInt(unformatNumber(action.amount), 10);
          }
        });
      });
      
      // ì˜¬ì¸ í”Œë ˆì´ì–´ ì •ë ¬ (ê¸ˆì•¡ ì˜¤ë¦„ì°¨ìˆœ)
      const allInPlayers = window.state.playersInHand
        .filter(p => window.state.playerStatus[p.name] === 'allin')
        .map(p => ({ name: p.name, amount: contributions[p.name] || 0 }))
        .sort((a, b) => a.amount - b.amount);
      
      const activePlayers = window.state.playersInHand
        .filter(p => window.state.playerStatus[p.name] !== 'folded')
        .map(p => p.name);
      
      const pots = [];
      let remainingPlayers = [...activePlayers];
      let previousCap = 0;
      
      // ê° ì˜¬ì¸ ë ˆë²¨ë³„ íŒŸ ìƒì„±
      allInPlayers.forEach(allinPlayer => {
        const cap = allinPlayer.amount;
        const potPlayers = remainingPlayers.filter(p => contributions[p] >= cap);
        const potAmount = (cap - previousCap) * potPlayers.length;
        
        if(potAmount > 0) {
          pots.push({
            amount: potAmount,
            players: [...potPlayers],
            cap: cap,
            type: pots.length === 0 ? 'main' : `side${pots.length}`
          });
        }
        
        remainingPlayers = remainingPlayers.filter(p => p !== allinPlayer.name);
        previousCap = cap;
      });
      
      // ë‚¨ì€ ë² íŒ… (ìµœê³  ë² íŒ…ìë“¤ë¼ë¦¬)
      if(remainingPlayers.length > 0) {
        const maxBet = Math.max(...remainingPlayers.map(p => contributions[p] || 0));
        const finalPot = (maxBet - previousCap) * remainingPlayers.length;
        
        if(finalPot > 0) {
          pots.push({
            amount: finalPot,
            players: remainingPlayers,
            cap: maxBet,
            type: pots.length === 0 ? 'main' : `side${pots.length}`
          });
        }
      }
      
      return { pots, contributions };
    }
    
    // ====== RESET & FEEDBACK ======
    async function resetApp(reloadIndex = true, autoIncrement = false){
      let lastNo;
      
      if(autoIncrement) {
        // ì‹œíŠ¸ ì „ì†¡ ì§í›„: í˜„ì¬ í•¸ë“œ ë²ˆí˜¸ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì´ë¯¸ ì „ì†¡ëœ ë²ˆí˜¸)
        lastNo = parseInt(window.state.actionState.handNumber, 10) || 0;
        console.log('ğŸ”„ ì‹œíŠ¸ ì „ì†¡ ì™„ë£Œ - ë‹¤ìŒ í•¸ë“œë¡œ ìë™ ì¦ê°€:', lastNo, 'â†’', lastNo + 1);
      } else if(reloadIndex) {
        // ìƒˆë¡œê³ ì¹¨ì´ë‚˜ ìˆ˜ë™ ì¬ì„¤ì •: Indexë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ì—¬ ìµœì‹  í•¸ë“œ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
        try {
          if(CSV_INDEX_URL.includes('http')){
            const idxRows = await fetchCsv(CSV_INDEX_URL + `&cb=${Date.now()}`);
            buildIndexFromCsv(idxRows);
          }
        } catch(err) {
          console.error('Index ì¬ë¡œë“œ ì‹¤íŒ¨:', err);
        }
        
        lastNo = window.state.indexRows.length
          ? Math.max(...window.state.indexRows.map(r=>parseInt(r.handNumber,10)||0))
          : 0;
        console.log('ğŸ”„ Index ì¬ë¡œë“œ - ë§ˆì§€ë§‰ í•¸ë“œ:', lastNo, 'â†’ ë‹¤ìŒ:', lastNo + 1);
      } else {
        // Index ì¬ë¡œë“œ ì—†ì´ í˜„ì¬ ìƒíƒœ ìœ ì§€
        lastNo = window.state.indexRows.length
          ? Math.max(...window.state.indexRows.map(r=>parseInt(r.handNumber,10)||0))
          : 0;
      }
      
      // ë§ˆì§€ë§‰ ì¹´ë©”ë¼ ë²ˆí˜¸ ì €ì¥ ë° ë‹¤ìŒ ë²ˆí˜¸ ì¤€ë¹„
      const lastCam1 = window.state.camNumbers.cam1no;
      const lastCam2 = window.state.camNumbers.cam2no;
      
      // í”Œë ˆì´ì–´ ìœ ì§€í•˜ë©´ì„œ ìƒˆ í•¸ë“œ ì‹œì‘
      console.log('ğŸ”„ ìƒˆ í•¸ë“œ ì‹œì‘ - í”Œë ˆì´ì–´ ì´ˆê¸°í™”');
      
      // ê¸°ì¡´ í”Œë ˆì´ì–´ë“¤ì˜ í˜„ì¬ ì¹©ì„ ë‹¤ìŒ í•¸ë“œì˜ ì‹œì‘ì¹©ìœ¼ë¡œ ì„¤ì •
      window.state.playersInHand.forEach(p => {
        // í˜„ì¬ ì¹©ì„ ì‹œì‘ì¹©ìœ¼ë¡œ ì¬ì„¤ì •
        p.initialChips = p.chips;
        p.hand = [];  // í•¸ë“œ ì¹´ë“œ ì´ˆê¸°í™”
        p.role = null;  // ì—­í•  ì´ˆê¸°í™”
        console.log(`  ${p.name}: ì‹œì‘ì¹© = ${p.initialChips} (í˜„ì¬ì¹© ìœ ì§€)`);
      });
      
      window.state.board = [];
      window.state.playerStatus = {}; // í”Œë ˆì´ì–´ ìƒíƒœ ì´ˆê¸°í™”
      window.state.currentStreet = 'preflop'; // ìŠ¤íŠ¸ë¦¬íŠ¸ ì´ˆê¸°í™”
      window.state.actionState = {
        handNumber: String(lastNo + 1),
        smallBlind: window.state.actionState.smallBlind,
        bigBlind: window.state.actionState.bigBlind,
        hasBBAnte: window.state.actionState.hasBBAnte,
        preflop: [], flop: [], turn: [], river: [],
      };
      
      // localStorageì—ì„œ ë§ˆì§€ë§‰ ì¹´ë©”ë¼ ë²ˆí˜¸ ì½ê¸°
      const savedCam1 = localStorage.getItem('pokerHandLogger_lastCam1') || '';
      const savedCam2 = localStorage.getItem('pokerHandLogger_lastCam2') || '';
      
      console.log('ğŸ“· ìƒˆ í•¸ë“œ - ì¹´ë©”ë¼ ë²ˆí˜¸ ìë™ ì¦ê°€:');
      console.log(`  localStorage cam1: ${savedCam1 || 'ì—†ìŒ'}`);
      console.log(`  localStorage cam2: ${savedCam2 || 'ì—†ìŒ'}`);
      console.log(`  í˜„ì¬ cam1: ${lastCam1 || 'ì—†ìŒ'}`);
      console.log(`  í˜„ì¬ cam2: ${lastCam2 || 'ì—†ìŒ'}`);
      
      // ì¹´ë©”ë¼ ë²ˆí˜¸ ìë™ ì¦ê°€
      // cam1 ì²˜ë¦¬: ì €ì¥ëœ ë²ˆí˜¸ ë˜ëŠ” í˜„ì¬ ë²ˆí˜¸ì—ì„œ +1
      const cam1Base = savedCam1 || lastCam1 || '0';
      const currentNum1 = parseInt(cam1Base, 10) || 0;
      const nextCam1 = currentNum1 > 0 ? currentNum1 + 1 : 1;
      window.state.camNumbers.cam1no = String(nextCam1);
      window.state.lastCamNo = String(nextCam1);
      el.cam1.textContent = `${window.state.camPreset.cam1}${pad4(nextCam1)}`;
      localStorage.setItem('pokerHandLogger_lastCam1', String(nextCam1));
      console.log(`  â†’ ${window.state.camPreset.cam1} ë‹¤ìŒ ë²ˆí˜¸: ${nextCam1}`);
      
      // cam2 ì²˜ë¦¬: ì €ì¥ëœ ë²ˆí˜¸ ë˜ëŠ” í˜„ì¬ ë²ˆí˜¸ì—ì„œ +1
      const cam2Base = savedCam2 || lastCam2 || '0';
      const currentNum2 = parseInt(cam2Base, 10) || 0;
      const nextCam2 = currentNum2 > 0 ? currentNum2 + 1 : 1;
      window.state.camNumbers.cam2no = String(nextCam2);
      window.state.lastCamNo = String(nextCam2);
      el.cam2.textContent = `${window.state.camPreset.cam2}${pad4(nextCam2)}`;
      localStorage.setItem('pokerHandLogger_lastCam2', String(nextCam2));
      console.log(`  â†’ ${window.state.camPreset.cam2} ë‹¤ìŒ ë²ˆí˜¸: ${nextCam2}`);
      
      renderAll(); saveActionState();
      el.handNumberDisplay.textContent = `#${window.state.actionState.handNumber}`;
    }
    function showFeedback(msg,isErr=false){
      el.feedbackMessage.textContent = msg;
      el.feedbackMessage.className = `text-center h-4 text-xs font-semibold ${isErr?'text-red-400':'text-green-400'}`;
    }

    // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • (v3.4.9)
    window.showFeedback = showFeedback;
    window.openCardSelector = openCardSelector;

    // ====== EVENT LISTENERS ======
    function setupEventListeners(){
      el.loadHandBtn.onclick = openLoadHandModal;
      el.refreshDataBtn.onclick = () => executeWithLock(loadInitial, 'ë°ì´í„° ìƒˆë¡œê³ ì¹¨', 'ìµœì‹  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...');
      el.resetBtn.onclick = () => executeWithLock(resetApp, 'ì•± ë¦¬ì…‹', 'ì•±ì„ ì´ˆê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
      
      // Cam ë²„íŠ¼ í´ë¦­ - ë°”ë¡œ í‚¤íŒ¨ë“œ ì—´ê¸°
      el.cam1.addEventListener('click', ()=>{
        const prefill = computeCamPrefill('cam1');
        openKeypad(null, { purpose:'cam', cam:'cam1', prefill });
      });

      el.cam2.addEventListener('click', ()=>{
        const prefill = computeCamPrefill('cam2');
        openKeypad(null, { purpose:'cam', cam:'cam2', prefill });
      });
      // "ì‹œíŠ¸ ì „ì†¡" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ â†’ ë°”ë¡œ ì „ì†¡ (ë…¸íŠ¸ ê¸°ëŠ¥ ì œê±°)
      el.sendToSheetBtn.onclick = () => { sendDataToGoogleSheet(); };
      
      // SB/BB ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      const smallBlindBtn = document.getElementById('small-blind-btn');
      const bigBlindBtn = document.getElementById('big-blind-btn');
      
      if(smallBlindBtn) {
        smallBlindBtn.onclick = () => {
          const currentValue = window.state.actionState.smallBlind || '0';
          const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-xs">
            <h3 class="text-center text-amber-400 font-bold mb-3">Small Blind ì„¤ì •</h3>
            <div class="text-xs text-gray-400 text-center mb-2">í˜„ì¬: ${formatNumber(currentValue)}</div>
            <input type="text" id="blind-text-input" class="w-full bg-gray-900 text-white p-2 rounded mb-3 text-center" placeholder="0" value="0">
            <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">0</div>
            <div class="grid grid-cols-3 gap-2 text-xl font-bold">
              ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
              <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
            </div>
          </div>`;
          
          // í‚¤íŒ¨ë“œ ì˜µì…˜ ì„¤ì •
          window.state.modalState.keypadOptions = {
            purpose: 'smallBlind'
          };
          
          openModal(el.keypadModal, html);
          
          setTimeout(() => {
            const textInput = document.getElementById('blind-text-input');
            const display = document.getElementById('keypad-display');
            let currentInput = '0';
            
            if(textInput && display) {
              // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸
              textInput.addEventListener('input', () => {
                currentInput = unformatNumber(textInput.value) || '0';
                display.textContent = formatNumber(currentInput);
              });
              
              // í‚¤íŒ¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
              
              // ì·¨ì†Œ ë²„íŠ¼
              document.getElementById('keypad-cancel').onclick = () => {
                closeModal(el.keypadModal);
              };
              
              // í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
            }
          }, 10);
        };
      }
      
      if(bigBlindBtn) {
        bigBlindBtn.onclick = () => {
          const currentValue = window.state.actionState.bigBlind || '0';
          const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-xs">
            <h3 class="text-center text-amber-400 font-bold mb-3">Big Blind ì„¤ì •</h3>
            <div class="text-xs text-gray-400 text-center mb-2">í˜„ì¬: ${formatNumber(currentValue)}</div>
            <input type="text" id="blind-text-input" class="w-full bg-gray-900 text-white p-2 rounded mb-3 text-center" placeholder="0" value="0">
            <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">0</div>
            <div class="grid grid-cols-3 gap-2 text-xl font-bold">
              ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
              <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
            </div>
          </div>`;
          
          // í‚¤íŒ¨ë“œ ì˜µì…˜ ì„¤ì •
          window.state.modalState.keypadOptions = {
            purpose: 'bigBlind'
          };
          
          openModal(el.keypadModal, html);
          
          setTimeout(() => {
            const textInput = document.getElementById('blind-text-input');
            const display = document.getElementById('keypad-display');
            let currentInput = '0';
            
            if(textInput && display) {
              // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸
              textInput.addEventListener('input', () => {
                currentInput = unformatNumber(textInput.value) || '0';
                display.textContent = formatNumber(currentInput);
              });
              
              // í‚¤íŒ¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
              
              // ì·¨ì†Œ ë²„íŠ¼
              document.getElementById('keypad-cancel').onclick = () => {
                closeModal(el.keypadModal);
              };
              
              // í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
            }
          }, 10);
        };
      }
      
      // ë…¸íŠ¸ ëª¨ë‹¬ ê´€ë ¨ ì´ë²¤íŠ¸ ì œê±° (ë…¸íŠ¸ ê¸°ëŠ¥ ì‚­ì œ)
      
      el.showLogBtn.onclick = openLogModal;
      el.closeLogModalBtn.onclick = closeLogModal;
      
      // ë¡œê·¸ ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      el.logModal.addEventListener('click', (e)=>{
        if(e.target === el.logModal) {
          closeLogModal();
        }
      });

      // í…Œì´ë¸” ì„ íƒ ë²„íŠ¼ ë° ëª¨ë‹¬ ì´ë²¤íŠ¸
      el.tableSelectorBtn.onclick = openTableSelectorModal;
      document.getElementById('close-table-selector').onclick = closeTableSelectorModal;

      // ê´€ë¦¬ ëª¨ë‹¬ì˜ í…Œì´ë¸” ë³€ê²½ ë²„íŠ¼
      document.getElementById('change-table-btn')?.addEventListener('click', () => {
        window.isTableManagementMode = true;
        openTableSelectorModal();
      });
      
      // í…Œì´ë¸” ëª¨ë‹¬ ê²€ìƒ‰ ë° í•„í„°
      document.getElementById('table-search').oninput = (e) => {
        tableModalState.searchTerm = e.target.value;
        tableModalState.currentPage = 1;
        renderTableGrid();
      };
      
      // í•„í„° ë²„íŠ¼ë“¤
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.onclick = () => {
          // ëª¨ë“  í•„í„° ë²„íŠ¼ ë¹„í™œì„±í™”
          document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.remove('bg-blue-600', 'text-white');
            b.classList.add('bg-gray-600', 'hover:bg-gray-500');
          });
          // í´ë¦­ëœ ë²„íŠ¼ í™œì„±í™”
          btn.classList.remove('bg-gray-600', 'hover:bg-gray-500');
          btn.classList.add('bg-blue-600', 'text-white');
          
          tableModalState.currentFilter = btn.id.replace('filter-', '');
          tableModalState.currentPage = 1;
          renderTableGrid();
        };
      });
      
      // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
      document.getElementById('prev-page').onclick = () => {
        if (tableModalState.currentPage > 1) {
          tableModalState.currentPage--;
          renderTableGrid();
        }
      };
      
      document.getElementById('next-page').onclick = () => {
        const filteredTables = getFilteredTables();
        const totalPages = Math.ceil(filteredTables.length / tableModalState.tablesPerPage);
        if (tableModalState.currentPage < totalPages) {
          tableModalState.currentPage++;
          renderTableGrid();
        }
      };
      
      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
      el.tableSelectorModal.onclick = (e) => {
        if (e.target === el.tableSelectorModal) {
          closeTableSelectorModal();
        }
      };
      el.timezoneSelector.onchange = (e)=>{ window.state.selectedTimezone=e.target.value; updateTimeDisplay(); renderAll(); };
      
      // Smart Mode í† ê¸€
      document.getElementById('smart-mode-toggle').onchange = (e) => {
        window.state.smartCheckCall = e.target.checked;
        showFeedback(window.state.smartCheckCall ? 'Smart Mode í™œì„±í™”' : 'Smart Mode ë¹„í™œì„±í™”');
      };

      // ì¢Œì„ í”Œë ˆì´ì–´ ì„ íƒ/í•´ì œ (ìƒˆë¡œìš´ 10ê°œ ì¢Œì„ êµ¬ì¡°)
      document.getElementById('seat-buttons')?.addEventListener('click', (e)=>{
        const btn = e.target.closest('button'); 
        if(!btn) return;
        
        const playerName = btn.dataset.playerName;
        const seatNum = btn.dataset.seat;
        
        if(playerName) {
          // í”Œë ˆì´ì–´ê°€ ìˆëŠ” ì¢Œì„ í´ë¦­ - ê²Œì„ ì°¸ì—¬ í† ê¸€
          togglePlayerInHand(playerName);
        } else {
          // ë¹ˆ ì¢Œì„ í´ë¦­ - ë‚˜ì¤‘ì— í•„ìš”ì‹œ í”Œë ˆì´ì–´ ì¶”ê°€ ê¸°ëŠ¥
          console.log(`ë¹ˆ ì¢Œì„ ${seatNum} í´ë¦­`);
        }
      });

      // í”Œë ˆì´ì–´ ì¹´ë“œ/ì¹© ì…ë ¥
      el.playerDetailsSection.addEventListener('click', (e)=>{
        const cardPlaceholder = e.target.closest('.card-placeholder');
        const keypadBtn = e.target.closest('.keypad-icon-btn');
        const playerCard = e.target.closest('.player-card');
        if(!playerCard) return;
        if(cardPlaceholder){
          window.state.modalState.cardTarget = { target:'playerHand', player:cardPlaceholder.dataset.playerName, count:parseInt(cardPlaceholder.dataset.count) };
          openCardSelector();
        }else if(keypadBtn){
          const pn = playerCard.dataset.playerName;
          const p = window.state.playersInHand.find(pp=>pp.name===pn);
          if(p) {
            // ê°œì„ ëœ ì¹© ì…ë ¥ í•¨ìˆ˜ ì‚¬ìš©
            openChipInput(p, false);
          }
        }
      });

      // ìŠ¹ì í† ê¸€
      el.winnerButtons.addEventListener('click', (e)=>{
        const btn=e.target.closest('.set-winner-btn'); if(!btn) return;
        setPlayerRole(btn.dataset.playerName);
      });

      // ì¹© ì…ë ¥ í¬ë§·íŒ…
      el.playerDetailsSection.addEventListener('input', (e)=>{
        if(!e.target.classList.contains('player-chip-input')) return;
        const parent = e.target.closest('.player-card');
        const player = window.state.playersInHand.find(p=>p.name===parent.dataset.playerName);
        const raw = unformatNumber(e.target.value);
        e.target.value = formatNumber(raw);
        
        if (player){
          const oldChips = player.chips;
          player.chips = raw;
          player.chipsUpdatedAt = new Date().toISOString();
          
          // í•­ìƒ í˜„ì¬ ì…ë ¥ëœ ì¹© ê°’ì„ ì‹œì‘ì¹©ìœ¼ë¡œ ì—…ë°ì´íŠ¸
          // (ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì¹©ì„ ë³€ê²½í•˜ë©´ ê·¸ê²ƒì´ ìƒˆë¡œìš´ ì‹œì‘ì¹©ì´ ë¨)
          player.initialChips = raw;
          console.log(`ğŸ° ${player.name}ì˜ ì‹œì‘ì¹© ì—…ë°ì´íŠ¸: ${oldChips} â†’ ${raw}`);
        }
      });

      // ë³´ë“œ ì¹´ë“œ ì„ íƒ
      el.boardCardPlaceholders.addEventListener('click', (e)=>{
        const ph = e.target.closest('.card-placeholder'); if(!ph) return;
        window.state.modalState.cardTarget = { target:'board', index:parseInt(ph.dataset.index), count:parseInt(ph.dataset.count) };
        openCardSelector();
      });

      // ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ ì´ë²¤íŠ¸
      el.cardSelectorModal.addEventListener('click', (e)=>{
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if(e.target === el.cardSelectorModal) {
          closeModal(el.cardSelectorModal);
          return;
        }
        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­
        if(e.target.id==='close-card-modal') closeModal(el.cardSelectorModal);
      });

      // ìŠ¤íŠ¸ë¦¬íŠ¸ ë²„íŠ¼(ì¶”ê°€/ë˜ëŒë¦¬ê¸°/Pot êµì •/ìŠ¤íŠ¸ë¦¬íŠ¸ ì„ íƒ)
      el.streetLogsContainer.addEventListener('click', (e)=>{
        const streetBtn = e.target.closest('.street-select-btn');
        const addBtn = e.target.closest('.add-action-btn');
        const undoBtn = e.target.closest('.undo-action-btn');
        const potBtn = e.target.closest('.pot-keypad-btn');
        
        if(streetBtn) {
          const selectedStreet = streetBtn.dataset.street;
          window.state.currentStreet = selectedStreet;
          renderActionStreets(); // í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸

          // ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ë°”ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°
          openActionPad(selectedStreet);
        }
        if(addBtn) openActionPad(addBtn.dataset.street);
        if(undoBtn) undoLastAction(undoBtn.dataset.street);
        if(potBtn){
          window.state.modalState.actionPadStreet = potBtn.dataset.street;
          openKeypad(null, { purpose:'pot', currentPot: potBtn.dataset.currentPot });
        }
      });

      // ìƒˆë¡œìš´ ì•¡ì…˜ íŒ¨ë“œ ë‚´ë¶€ ë²„íŠ¼ ì´ë²¤íŠ¸
      el.actionPadModal.addEventListener('click', (e)=>{
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if(e.target === el.actionPadModal) {
          closeModal(el.actionPadModal);
          return;
        }

        const btn = e.target.closest('button'); if(!btn) return;

        // ë‹«ê¸° ë²„íŠ¼
        if(btn.id==='close-action-pad'){
          closeModal(el.actionPadModal);
          return;
        }

        // ì•¡ì…˜ ëª¨ë“œ í† ê¸€
        if(btn.id==='toggle-action-mode') {
          const newMode = window.actionManager.toggleMode();
          showFeedback(`ì•¡ì…˜ ëª¨ë“œ: ${newMode === 'auto' ? 'ğŸ¤– ìë™ ìˆœì„œ' : 'ğŸ‘† ìˆ˜ë™ ì„ íƒ'}`, false);
          // ëª¨ë‹¬ ë‹¤ì‹œ ì—´ê¸° (UI ì—…ë°ì´íŠ¸)
          openActionPad(window.actionManager.currentStreet);
          return;
        }

        // í˜„ì¬ í”Œë ˆì´ì–´ ìŠ¤í‚µ
        if(btn.id==='skip-current-player') {
          const nextPlayer = window.actionManager.moveToNextPlayer();
          showFeedback(`í”Œë ˆì´ì–´ ìŠ¤í‚µë¨. ${nextPlayer ? `ë‹¤ìŒ: ${nextPlayer.name}` : 'ìŠ¤íŠ¸ë¦¿ ì™„ë£Œ'}`, false);
          openActionPad(window.actionManager.currentStreet);
          return;
        }

        // ìë™ ëª¨ë“œì—ì„œ í˜„ì¬ í”Œë ˆì´ì–´ ì•¡ì…˜
        if(btn.dataset.player && window.actionManager.actionMode === 'auto') {
          const playerName = btn.dataset.player;
          const action = btn.dataset.action;

          // ì•¡ì…˜ ì‹¤í–‰
          executePlayerAction(playerName, action, btn);
          return;
        }

        // ìˆ˜ë™ ëª¨ë“œ í”Œë ˆì´ì–´ ì„ íƒ
        const modal = el.actionPadModal;
        if(btn.parentElement?.id==='action-pad-players'){
          window.state.modalState.actionPadPlayer = btn.dataset.playerName;
          const actionSection = modal.querySelector('#action-pad-actions');
          if(actionSection) {
            modal.querySelector('#action-pad-players').classList.add('hidden');
            actionSection.classList.remove('hidden');

            // ìˆ˜ë™ ëª¨ë“œ Check/Call ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const smartBtn = modal.querySelector('#manual-smart-check-call-btn');
            if(smartBtn) {
              const playerName = btn.dataset.playerName;
              const street = window.state.modalState.actionPadStreet;
              const smartAction = getSmartCheckCallAction(playerName, street);

              // ë²„íŠ¼ ìƒ‰ìƒê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
              if(smartAction.action === 'Checks') {
                smartBtn.className = 'btn bg-green-600 hover:bg-green-700 p-3 rounded-md';
                smartBtn.innerHTML = 'âœ… Check';
              } else {
                smartBtn.className = 'btn bg-blue-600 hover:bg-blue-700 p-3 rounded-md';
                smartBtn.innerHTML = `ğŸ“ Call ${formatNumber(smartAction.amount)}`;
              }
              smartBtn.dataset.smartAction = JSON.stringify(smartAction);
            }
          }
          return;
        }

        // ìˆ˜ë™ ëª¨ë“œ ì•¡ì…˜ ì²˜ë¦¬
        if(btn.parentElement?.id==='action-pad-actions'){
          const action = btn.dataset.action;
          const playerName = window.state.modalState.actionPadPlayer;

          if(!playerName) {
            showFeedback('í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', true);
            return;
          }

          // ìˆ˜ë™ ëª¨ë“œì—ì„œ ì•¡ì…˜ ì‹¤í–‰
          executePlayerAction(playerName, action, btn);
          return;
        }

        // ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ì²˜ë¦¬ (ì‚­ì œ ì˜ˆì •)
        if(btn.parentElement?.id==='action-pad-actions-legacy'){
          const action = btn.dataset.action;
          if(action==='Bet/Raises'){
            const st = window.state.modalState.actionPadStreet;
            const hasBet = window.state.actionState[st].some(a=>/BET|RAISE/i.test(a.action||''));
            window.state.modalState.actionPadCurrentAction = hasBet ? 'Raises' : 'Bets';
            closeModal(el.actionPadModal); openKeypad(null, { purpose:'bet' });
          }else if(action==='SmartCheckCall'){
            // ìŠ¤ë§ˆíŠ¸ Check/Call ì²˜ë¦¬
            const smartBtn = btn;
            const smartAction = JSON.parse(smartBtn.dataset.smartAction || '{}');
            if(smartAction.action) {
              addActionToLog(smartAction.action, smartAction.amount);
            }
          }else if(action==='All In'){
            const p = window.state.playersInHand.find(pp=>pp.name===window.state.modalState.actionPadPlayer);
            if(p) addActionToLog('All In', p.chips);
          }else if(action==='Calls'){
            const st = window.state.modalState.actionPadStreet;
            const p = window.state.playersInHand.find(pp=>pp.name===window.state.modalState.actionPadPlayer);
            
            // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì™€ ì´ì „ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ë§ˆì§€ë§‰ ë² íŒ…/ë ˆì´ì¦ˆ ì°¾ê¸°
            let lastBet = null;
            let requiredAmt = 0;
            
            // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ì°¾ê¸°
            lastBet = [...window.state.actionState[st]].reverse().find(a=>/BET|RAISE|All In/i.test(a.action||''));
            
            if(!lastBet && st !== 'preflop') {
              // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ…ì´ ì—†ìœ¼ë©´ ì´ì „ ìŠ¤íŠ¸ë¦¬íŠ¸ í™•ì¸
              const streetOrder = ['preflop', 'flop', 'turn', 'river'];
              const currentIdx = streetOrder.indexOf(st);
              for(let i = currentIdx - 1; i >= 0; i--) {
                lastBet = [...window.state.actionState[streetOrder[i]]].reverse().find(a=>/BET|RAISE|All In/i.test(a.action||''));
                if(lastBet) break;
              }
            }
            
            // ì½œ ê¸ˆì•¡ ê²°ì •
            if(lastBet) {
              requiredAmt = lastBet.amount;
            } else if(st === 'preflop') {
              // í”„ë¦¬í”Œëì—ì„œ ì•„ë¬´ë„ ë² íŒ…í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¹…ë¸”ë¼ì¸ë“œ ì½œ
              requiredAmt = unformatNumber(window.state.actionState.bigBlind);
            } else {
              // í¬ìŠ¤íŠ¸í”Œëì—ì„œ ë² íŒ…ì´ ì—†ìœ¼ë©´ ì²´í¬í•´ì•¼ í•¨
              showFeedback('ë² íŒ…ì´ ì—†ì–´ ì²´í¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', true);
              return;
            }
            
            // í”Œë ˆì´ì–´ í˜„ì¬ ì¹©
            const playerChips = p ? parseInt(unformatNumber(p.chips), 10) : 0;
            
            // ì˜¬ì¸ ì½œ ì²´í¬: í•„ìš” ê¸ˆì•¡ì´ í”Œë ˆì´ì–´ ì¹©ë³´ë‹¤ í¬ë©´ ì˜¬ì¸
            if(playerChips > 0 && playerChips <= parseInt(unformatNumber(requiredAmt), 10)){
              // ì˜¬ì¸ ì½œ (í”Œë ˆì´ì–´ì˜ ëª¨ë“  ì¹©)
              addActionToLog('All In', p.chips);
            } else {
              // ì¼ë°˜ ì½œ
              addActionToLog('Calls', requiredAmt);
            }
          }else{
            addActionToLog(action);
          }
        }
      });

      // ë°”ê¹¥ìª½ í‚¤íŒ¨ë“œ ë²„íŠ¼(SB/BB ë“±)
      document.body.addEventListener('click', (e)=>{
        const kb = e.target.closest('.keypad-icon-btn');
        if(kb && !kb.closest('.player-card')) openKeypad(kb.previousElementSibling, { purpose:'input' });
      });

      // ğŸš€ ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ìˆ˜ì¤€ í‚¤íŒ¨ë“œ ì…ë ¥ (v3.4.17 ì„±ëŠ¥ ìµœì í™”)
      // ë²„íŠ¼ë³„ ëˆ„ë¦„ ìƒíƒœ ì¶”ì 
      const buttonPressState = new Map();

      // ê¸°ì¡´ click ì´ë²¤íŠ¸ ëŒ€ì‹  down/up ì´ë²¤íŠ¸ë¡œ ì¦‰ì‹œ ë°˜ì‘
      el.keypadModal.addEventListener('mousedown', handleKeypadDown, { passive: false });
      el.keypadModal.addEventListener('touchstart', handleKeypadDown, { passive: false });
      el.keypadModal.addEventListener('mouseup', handleKeypadUp);
      el.keypadModal.addEventListener('touchend', handleKeypadUp);
      el.keypadModal.addEventListener('mouseleave', handleKeypadUp);

      function handleKeypadDown(e) {
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if(e.target === el.keypadModal) {
          closeModal(el.keypadModal);
          return;
        }

        const btn = e.target.closest('button');
        if(!btn) return;

        // ğŸ”§ ëª¨ë°”ì¼ í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ ì¦‰ì‹œ ë°˜ì‘ ì²˜ë¦¬
        if(btn.id === 'keypad-confirm' || btn.id === 'keypad-cancel') {
          // í„°ì¹˜ ì¦‰ì‹œ ë°˜ì‘ (300ms ì§€ì—° ì œê±°)
          btn.style.transform = 'scale(0.95)';
          btn.style.filter = 'brightness(1.2)';

          // ì¦‰ì‹œ í´ë¦­ ì‹¤í–‰
          setTimeout(() => {
            btn.style.transform = '';
            btn.style.filter = '';
            btn.click(); // ê¸°ì¡´ click ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
          }, 100);

          e.preventDefault(); // 300ms ì§€ì—° ë°©ì§€
          return;
        }

        // ì´ë¯¸ ëˆŒë¦° ìƒíƒœë©´ ë¬´ì‹œ (ë¬¼ë¦¬ì  ëˆ„ë¦„ ìƒíƒœë§Œ ì²´í¬)
        if (buttonPressState.get(btn)) return;

        // ì¦‰ì‹œ ì²˜ë¦¬ ì‹œì‘
        buttonPressState.set(btn, true);

        // ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°±
        btn.style.transform = 'scale(0.95)';
        btn.style.filter = 'brightness(1.2)';

        // í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ ì¦‰ì‹œ ì²˜ë¦¬
        if(btn.classList.contains('keypad-btn')) {
          processKeypadInputImmediate(btn);
          // í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ preventDefault ì ìš©
          e.preventDefault();
        }
      }

      function handleKeypadUp(e) {
        const btn = e.target.closest('button');
        if(!btn) return;

        // ëˆ„ë¦„ ìƒíƒœ í•´ì œ
        buttonPressState.set(btn, false);

        // ì‹œê°ì  ë³µêµ¬
        btn.style.transform = '';
        btn.style.filter = '';
      }

      // ì¦‰ì‹œ ì…ë ¥ ì²˜ë¦¬ í•¨ìˆ˜
      function processKeypadInputImmediate(btn) {
        const display = el.keypadModal.querySelector('#keypad-display');
        const key = btn.textContent;

        if(key==='C'){
          display.textContent='0';
        }else if(key==='â†'){
          const current = unformatNumber(display.textContent);
          const newValue = current.slice(0,-1) || '0';
          display.textContent = formatNumber(newValue);
        }else if(btn.dataset.action === 'max') {
          const { purpose } = window.state.modalState.keypadOptions;
          if(purpose === 'bet') {
            const playerName = window.state.modalState.keypadOptions.playerName ||
                              window.state.modalState.actionPadPlayer;
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              display.textContent = player.chips;
              const warning = el.keypadModal.querySelector('#keypad-warning');
              if(warning) {
                warning.classList.remove('hidden');
                warning.textContent = `ğŸ’° ìµœëŒ€ ë² íŒ… - ë³´ìœ  ì¹© ì „ì²´(${formatNumber(player.chips)})`;
                warning.className = 'text-xs text-blue-400 text-center mb-2';
              }
            }
          }
        }else{
          // ìˆ«ì ì…ë ¥ ì²˜ë¦¬
          const current = unformatNumber(display.textContent);
          let newValue;
          if(current === '0') {
            newValue = key;
          } else {
            newValue = current + key;
          }
          display.textContent = formatNumber(newValue);
        }

        // DOM ê°•ì œ ë Œë”ë§ìœ¼ë¡œ ì¦‰ì‹œ ë°˜ì˜
        display.offsetHeight;
      }

      // í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì€ ê¸°ì¡´ click ì´ë²¤íŠ¸ ìœ ì§€
      el.keypadModal.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;

        // í‚¤íŒ¨ë“œ ë²„íŠ¼ì€ ì´ë¯¸ down ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬ë¨
        if(btn.classList.contains('keypad-btn')) return;

        const display = el.keypadModal.querySelector('#keypad-display');

        // MAX ë²„íŠ¼ ì²˜ë¦¬
        if(btn.dataset.action === 'max') {
          const { purpose } = window.state.modalState.keypadOptions;
          if(purpose === 'bet') {
            const playerName = window.state.modalState.keypadOptions.playerName ||
                              window.state.modalState.actionPadPlayer;
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              display.textContent = player.chips; // ëª¨ë“  ì¹©ì„ ë² íŒ…
              const warning = el.keypadModal.querySelector('#keypad-warning');
              if(warning) {
                warning.classList.remove('hidden');
                warning.textContent = `ğŸ’° ìµœëŒ€ ë² íŒ… - ë³´ìœ  ì¹© ì „ì²´(${formatNumber(player.chips)})`;
                warning.className = 'text-xs text-blue-400 text-center mb-2';
              }
            }
          }
          return;
        }

        if(btn.id==='keypad-confirm'){
          const finalAmt = unformatNumber(display.textContent);
          const { purpose, currentPot } = window.state.modalState.keypadOptions;
          if(purpose==='cam'){
            const which = window.state.modalState.keypadOptions.cam; // 'cam1'|'cam2'
            const padded = pad4(finalAmt);
            const numValue = String(finalAmt); // ìˆ«ìë§Œ ì €ì¥ (0007 â†’ 7)
            if (which==='cam1'){
              window.state.camNumbers.cam1no = numValue; // ìˆ«ìë¡œ ì €ì¥
              window.state.lastCamNo = numValue;
              el.cam1.textContent = `${window.state.camPreset.cam1}${padded}`; // í‘œì‹œëŠ” íŒ¨ë”©ëœ í˜•íƒœë¡œ
              localStorage.setItem('pokerHandLogger_lastCam1', numValue); // localStorageì— ìˆ«ìë¡œ ì €ì¥
              showFeedback(`${window.state.camPreset.cam1 || 'Cam1'}${padded} ì…ë ¥ë¨`);
              console.log(`ğŸ“· cam1 ì €ì¥: ${window.state.camPreset.cam1}=${numValue}`);
            }else if (which==='cam2'){
              window.state.camNumbers.cam2no = numValue; // ìˆ«ìë¡œ ì €ì¥
              window.state.lastCamNo = numValue;
              el.cam2.textContent = `${window.state.camPreset.cam2}${padded}`; // í‘œì‹œëŠ” íŒ¨ë”©ëœ í˜•íƒœë¡œ
              localStorage.setItem('pokerHandLogger_lastCam2', numValue); // localStorageì— ìˆ«ìë¡œ ì €ì¥
              console.log(`ğŸ“· cam2 ì €ì¥: ${window.state.camPreset.cam2}=${numValue}`);
              showFeedback(`${window.state.camPreset.cam2 || 'Cam2'}${padded} ì…ë ¥ë¨`);
            }
          }else if(purpose==='bet'){
            const { playerName } = window.state.modalState.keypadOptions;
            if(finalAmt) {
              // ì¹© ì´ˆê³¼ ê²€ì¦ ì¶”ê°€
              const actualPlayerName = playerName || window.state.modalState.actionPadPlayer;
              const player = window.state.playersInHand.find(p => p.name === actualPlayerName);
              if(player) {
                const playerChips = parseInt(unformatNumber(player.chips), 10);
                const betAmount = parseInt(finalAmt, 10);

                // ë² íŒ… ê¸ˆì•¡ì´ ë³´ìœ  ì¹©ì„ ì´ˆê³¼í•˜ëŠ” ê²½ìš° ê²½ê³ ë§Œ í‘œì‹œ (ì§„í–‰ì€ í—ˆìš©)
                if(betAmount > playerChips) {
                  showFeedback(`âš ï¸ ì£¼ì˜: ì¹© ì´ˆê³¼ ë² íŒ… (ë³´ìœ : ${formatNumber(playerChips)}, ë² íŒ…: ${formatNumber(betAmount)})`, true);
                  const resultingChips = playerChips - betAmount;
                  showFeedback(`ğŸ’° ì¹©ì´ ${formatNumber(resultingChips)}ê°€ ë©ë‹ˆë‹¤`, false);
                  // ê²½ê³ ë§Œ í•˜ê³  ì§„í–‰ì€ ê³„ì†í•¨
                }
              }

              addActionToLog(window.state.modalState.actionPadCurrentAction, finalAmt, actualPlayerName);

              // ìë™ ëª¨ë“œì—ì„œ ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ì´ë™
              if(window.actionManager && window.actionManager.actionMode === 'auto') {
                const nextPlayer = window.actionManager.moveToNextPlayer();
                showFeedback(`${playerName} ${window.state.modalState.actionPadCurrentAction} ${formatNumber(finalAmt)}`, false);

                if(nextPlayer) {
                  openActionPad(window.actionManager.currentStreet);
                } else {
                  setTimeout(() => {
                    showFeedback(`${window.actionManager.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ ì™„ë£Œ`, false);
                  }, 500);
                }
              }
            }
          }else if(purpose==='pot'){
            // Pot correction: ì…ë ¥í•œ ê°’ ê·¸ëŒ€ë¡œ ì €ì¥ (ì´ì „ íŒŸ í¬ê¸°ë¥¼ ë¹¼ì§€ ì•ŠìŒ)
            const potSize = finalAmt; // í¬ë§·ëœ ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            if(potSize){
              const st = window.state.modalState.actionPadStreet;
              // Pot Correctionì€ player ì—†ì´ ì €ì¥ (ì‹œìŠ¤í…œ ì•¡ì…˜)
              window.state.actionState[st].push({ 
                action:'Pot Correction', 
                amount:potSize,  // í¬ë§·ëœ ê°’ ê·¸ëŒ€ë¡œ ì €ì¥
                timestamp:new Date().toISOString() 
              });
              saveActionState(); renderAll();
            }
          }else if(purpose==='input'){
            if(window.state.modalState.keypadTarget){
              window.state.modalState.keypadTarget.value = display.textContent;
              window.state.modalState.keypadTarget.dispatchEvent(new Event('input',{bubbles:true}));
            }
          }else if(purpose==='chip'){
            // openChipInputì—ì„œ í˜¸ì¶œëœ ê²½ìš°
            const { playerName } = window.state.modalState.keypadOptions;
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              const value = unformatNumber(display.textContent) || '0';
              player.chips = value;
              player.initialChips = value;
              player.chipsUpdatedAt = new Date().toISOString();
              renderPlayerDetails();
            }
          }else if(purpose==='smallBlind'){
            // SB ë²„íŠ¼ì—ì„œ í˜¸ì¶œëœ ê²½ìš°
            const value = unformatNumber(display.textContent) || '0';
            window.state.actionState.smallBlind = value;
            const smallBlindBtn = document.getElementById('small-blind-btn');
            if(smallBlindBtn) {
              smallBlindBtn.textContent = formatNumber(value);
            }
            saveActionState();
          }else if(purpose==='bigBlind'){
            // BB ë²„íŠ¼ì—ì„œ í˜¸ì¶œëœ ê²½ìš°
            const value = unformatNumber(display.textContent) || '0';
            window.state.actionState.bigBlind = value;
            const bigBlindBtn = document.getElementById('big-blind-btn');
            if(bigBlindBtn) {
              bigBlindBtn.textContent = formatNumber(value);
            }
            saveActionState();
          }else if(purpose==='quickBet'){
            // í€µ ë²³/ë ˆì´ì¦ˆ ì²˜ë¦¬
            const { player, street } = window.state.modalState.keypadOptions;
            const amount = unformatNumber(display.textContent);
            if(amount && player && street) {
              // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ…ì´ ìˆëŠ”ì§€ í™•ì¸
              const hasBet = window.state.actionState[street].some(a => 
                /BET|RAISE/i.test(a.action || '')
              );
              const action = hasBet ? 'Raises' : 'Bets';
              
              // ì•¡ì…˜ ì¶”ê°€
              window.state.actionState[street].push({
                player: player,
                action: action,
                amount: amount,
                timestamp: new Date().toISOString()
              });
              
              // ë‹¤ìŒ í”Œë ˆì´ì–´ ê³„ì‚°
              window.state.nextActionPlayer = calculateNextActionPlayer(street);
              
              saveActionState();
              renderAll();
              showFeedback(`${player} ${action} ${formatNumber(amount)}`);
            }
          }
          closeModal(el.keypadModal);
        }else if(btn.id==='keypad-cancel'){
          closeModal(el.keypadModal);
        }
        // ë‚˜ë¨¸ì§€ ë²„íŠ¼ë“¤ì€ ê¸°ì¡´ ë¡œì§ ìœ ì§€ (í‚¤íŒ¨ë“œ ë²„íŠ¼ì€ down ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬ë¨)
      });

      // SB/BB/Ante ì²´í¬
      document.querySelectorAll('.number-input').forEach(inp=>{
        inp.addEventListener('input', (e)=>{
          const raw = unformatNumber(e.target.value);
          const fmt = formatNumber(raw);
          if(e.target.value!==fmt) e.target.value=fmt;
          const k = toCamelCase(e.target.id.replace('-input','')); // small-blind-input -> smallBlind
          if(k in window.state.actionState) window.state.actionState[k]=raw;
          saveActionState();
        });
      });
      el.bbAnteCheckbox.onchange = (e)=>{ window.state.actionState.hasBBAnte = e.target.checked; saveActionState(); renderAll(); };

      // Load Hand ëª¨ë‹¬ ë‚´ë¶€ í´ë¦­
      el.loadHandModal.addEventListener('click', (e)=>{
        // í•¸ë“œ í•­ëª© í´ë¦­ ìš°ì„  ì²˜ë¦¬
        const itemBtn = e.target.closest('.load-hand-item-btn');
        if(itemBtn){
          const no = itemBtn.dataset.no;
          const dt = itemBtn.dataset.date || null;
          loadHandData(no, dt);
          return;
        }
        
        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­
        const closeBtn = e.target.closest('#close-load-hand-modal');
        if(closeBtn) {
          closeModal(el.loadHandModal);
          return;
        }
        
        // ëª¨ë‹¬ ì»¨í…ì¸  ì˜ì—­ í´ë¦­ì€ ë¬´ì‹œ
        const content = e.target.closest('.bg-gray-800');
        if(content) return;
        
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if (e.target === el.loadHandModal) {
          closeModal(el.loadHandModal);
        }
      });
    }

    // ====== ê´€ë¦¬ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ======
    function openRegistrationModal() {
      const modal = el.registrationModal;
      if (modal) {
        modal.classList.remove('hidden');
        modal.classList.remove('opacity-0');
      }
    }
    
    function closeRegistrationModal() {
      const modal = el.registrationModal;
      if (modal) {
        modal.classList.add('opacity-0');
        modal.classList.add('hidden');
      }
    }
    
    
    // ê´€ë¦¬ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    if (el.managePlayersBtn) {
      el.managePlayersBtn.addEventListener('click', () => {
        openRegistrationModal();
        // ì´ˆê¸°í™”: ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
        document.getElementById('management-menu').classList.remove('hidden');
        document.getElementById('player-management-content').classList.add('hidden');

        // Apps Script URL í‘œì‹œ
        const currentUrlSpan = document.getElementById('management-current-url');
        const urlInput = document.getElementById('management-apps-url-input');
        const urlStatus = document.getElementById('url-save-status');

        if (currentUrlSpan) {
          currentUrlSpan.textContent = APPS_SCRIPT_URL || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';
          // URLì´ ê¸°ë³¸ê°’ì¸ì§€ ì‚¬ìš©ì ì„¤ì •ê°’ì¸ì§€ í‘œì‹œ
          const isCustomUrl = APPS_SCRIPT_URL !== DEFAULT_APPS_SCRIPT_URL;
          currentUrlSpan.className = isCustomUrl ?
            'text-xs text-green-400 break-all font-mono' :
            'text-xs text-amber-400 break-all font-mono';
        }

        if (urlInput) {
          urlInput.value = '';
          urlInput.placeholder = 'ìƒˆ URLì„ ì…ë ¥í•˜ì„¸ìš” (í˜„ì¬ì™€ ë‹¤ë¥¸ URLë§Œ ì €ì¥ ê°€ëŠ¥)';
        }

        if (urlStatus) {
          urlStatus.classList.add('hidden');
        }
      });
    }

    // Apps Script URL ì €ì¥ ë²„íŠ¼ - ì§€ì—° ì‹¤í–‰ìœ¼ë¡œ DOM ë¡œë“œ ë³´ì¥
    setTimeout(() => {
      const saveUrlBtn = document.getElementById('save-apps-url-btn');
      console.log('[v3.3.1] Apps Script URL ì €ì¥ ë²„íŠ¼:', saveUrlBtn);

      if (saveUrlBtn) {
        saveUrlBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          console.log('[ì„œë²„ë™ê¸°í™”] URL ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨');

          const urlInput = document.getElementById('management-apps-url-input');
          const urlStatus = document.getElementById('url-save-status');
          const currentUrlSpan = document.getElementById('management-current-url');
          const newUrl = urlInput?.value.trim();

          console.log('[v3.3.1] ì…ë ¥ëœ URL:', newUrl);
          console.log('[v3.3.1] í˜„ì¬ URL:', APPS_SCRIPT_URL);

          // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
          function showUrlStatus(message, isSuccess) {
            if (urlStatus) {
              urlStatus.textContent = message;
              urlStatus.className = isSuccess ?
                'text-xs p-2 rounded bg-green-600 text-white' :
                'text-xs p-2 rounded bg-red-600 text-white';
              urlStatus.classList.remove('hidden');

              // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
              setTimeout(() => {
                urlStatus.classList.add('hidden');
              }, 3000);
            }
          }

          if (newUrl && newUrl !== APPS_SCRIPT_URL) {
            // ğŸŒ ì„œë²„ ë™ê¸°í™”ë¡œ URL ì €ì¥
            console.log('[ì„œë²„ë™ê¸°í™”] ì„œë²„ì— URL ì €ì¥ ì‹œì‘:', newUrl);

            // ì €ì¥ ë²„íŠ¼ ë¡œë”© ìƒíƒœë¡œ ë³€ê²½
            saveUrlBtn.disabled = true;
            saveUrlBtn.textContent = 'ğŸŒ ì„œë²„ì— ì €ì¥ ì¤‘...';
            saveUrlBtn.className = 'w-full bg-blue-600 py-1.5 rounded text-sm font-medium';

            try {
              const success = await saveAppsScriptUrlToServer(newUrl);

              if (success) {
                // ì„œë²„ ì €ì¥ ì„±ê³µ ì‹œ UI ì—…ë°ì´íŠ¸
                if (currentUrlSpan) {
                  currentUrlSpan.textContent = newUrl;
                  currentUrlSpan.className = 'text-xs text-green-400 break-all font-mono';
                }
                showUrlStatus('âœ… ëª¨ë“  ê¸°ê¸°ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', true);

                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                urlInput.value = '';
                urlInput.placeholder = 'ì €ì¥ ì™„ë£Œ! ëª¨ë“  ê¸°ê¸°ì—ì„œ ìë™ ì ìš©ë©ë‹ˆë‹¤';

                // ì„±ê³µ ìƒíƒœ í‘œì‹œ
                saveUrlBtn.textContent = 'âœ… ëª¨ë“  ê¸°ê¸° ì ìš© ì™„ë£Œ';
                saveUrlBtn.className = 'w-full bg-green-600 py-1.5 rounded text-sm font-medium';
              } else {
                // ì„œë²„ ì €ì¥ ì‹¤íŒ¨ (ë¡œì»¬ì—ë§Œ ì €ì¥ë¨)
                showUrlStatus('âš ï¸ ì„œë²„ ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ì—ë§Œ ì €ì¥ë¨', false);
                saveUrlBtn.textContent = 'âš ï¸ ë¡œì»¬ì—ë§Œ ì €ì¥ë¨';
                saveUrlBtn.className = 'w-full bg-yellow-600 py-1.5 rounded text-sm font-medium';
              }

              // 2ì´ˆ í›„ ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
              setTimeout(() => {
                saveUrlBtn.disabled = false;
                saveUrlBtn.textContent = 'ğŸ’¾ ìƒˆ URL ì €ì¥';
                saveUrlBtn.className = 'w-full bg-amber-600 hover:bg-amber-700 py-1.5 rounded text-sm font-medium';
              }, 2000);

            } catch (error) {
              console.error('[ì„œë²„ë™ê¸°í™”] URL ì €ì¥ ì˜¤ë¥˜:', error);
              showUrlStatus('âŒ ì €ì¥ ì‹¤íŒ¨: ' + error.message, false);
              showFeedback('âŒ URL ì €ì¥ ì‹¤íŒ¨', true);

              // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
              saveUrlBtn.disabled = false;
              saveUrlBtn.textContent = 'âŒ ì €ì¥ ì‹¤íŒ¨';
              saveUrlBtn.className = 'w-full bg-red-600 py-1.5 rounded text-sm font-medium';

              setTimeout(() => {
                saveUrlBtn.textContent = 'ğŸ’¾ ìƒˆ URL ì €ì¥';
                saveUrlBtn.className = 'w-full bg-amber-600 hover:bg-amber-700 py-1.5 rounded text-sm font-medium';
              }, 2000);
            }
          } else if (!newUrl) {
            showUrlStatus('âš ï¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', false);
            showFeedback('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
          } else if (newUrl === APPS_SCRIPT_URL) {
            showUrlStatus('â„¹ï¸ í˜„ì¬ ì €ì¥ëœ URLê³¼ ë™ì¼í•©ë‹ˆë‹¤', false);
            showFeedback('ë™ì¼í•œ URLì…ë‹ˆë‹¤', true);
          }
        });
        console.log('[v3.3.1] URL ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
      } else {
        console.error('[v3.3.1] save-apps-url-btn ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    }, 100);

    // í…Œì´ë¸” ê´€ë¦¬ ë²„íŠ¼ í´ë¦­ - ë°”ë¡œ í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
    document.getElementById('open-table-management-btn')?.addEventListener('click', () => {
      // í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œ í™œì„±í™” í”Œë˜ê·¸ ì„¤ì •
      window.isTableManagementMode = true;

      // ë°”ë¡œ í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
      openTableSelectorModal();
    });

    // í”Œë ˆì´ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ ìƒíƒœ - ì „ì—­ ìŠ¤ì½”í”„ë¡œ ë…¸ì¶œ
    window.managementState = {
      selectedTable: '',
      originalPlayers: [],
      currentPlayers: [],
      changes: {
        added: [],
        modified: [],
        deleted: []
      }
    };

    // í”Œë ˆì´ì–´ ê´€ë¦¬ ì´ˆê¸°í™”
    function initPlayerManagement() {
      // ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹
      window.managementState = {
        selectedTable: '',
        originalPlayers: [],
        currentPlayers: [],
        changes: { added: [], modified: [], deleted: [] }
      };

      // UI ì´ˆê¸°í™” - ì¦‰ì‹œ ì„ íƒ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
      document.getElementById('selected-table-info').classList.add('hidden');
      document.getElementById('player-add-section').classList.add('hidden');
      document.getElementById('player-list-section').classList.add('hidden');
      document.getElementById('batch-actions').classList.add('hidden');
      document.getElementById('sync-status').textContent = '';
    }

    // ê´€ë¦¬ ëª¨ë‹¬ì—ì„œ í…Œì´ë¸” ì„ íƒ ì²˜ë¦¬ - selectTableì—ì„œ í˜¸ì¶œë¨
    function onManagementTableSelected(tableName) {
      console.log('[DEBUG] onManagementTableSelected í˜¸ì¶œë¨, tableName:', tableName);
      if (!tableName) return;

      window.managementState.selectedTable = tableName;
      window.managementState.originalPlayers = JSON.parse(JSON.stringify(
        window.state.playerDataByTable[tableName] || []
      ));
      window.managementState.currentPlayers = JSON.parse(JSON.stringify(
        window.managementState.originalPlayers
      ));
      window.managementState.changes = { added: [], modified: [], deleted: [] };

      console.log('[DEBUG] managementState ì„¤ì •ë¨:', window.managementState);

      // UI ì—…ë°ì´íŠ¸ - í…Œì´ë¸” ì •ë³´ëŠ” í•­ìƒ í‘œì‹œ
      document.getElementById('selected-table-name').textContent = tableName;
      document.getElementById('player-add-section').classList.remove('hidden');
      document.getElementById('player-list-section').classList.remove('hidden');
      document.getElementById('batch-actions').classList.remove('hidden');

      // í”Œë ˆì´ì–´ ëª©ë¡ ë Œë”ë§
      renderManagementPlayersList();
      updateChangesSummary();
    }


    // ë¡œì»¬ í”Œë ˆì´ì–´ ëª©ë¡ ë Œë”ë§ - 10ê°œ ì‹œíŠ¸ ê³ ì • ë°©ì‹
    function renderManagementPlayersList() {
      console.log('[DEBUG] renderManagementPlayersList í˜¸ì¶œë¨');
      const listContainer = document.getElementById('current-players-list');
      const countDisplay = document.getElementById('player-count');

      if (!listContainer) {
        console.log('[DEBUG] listContainerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        return;
      }

      const players = window.managementState.currentPlayers;
      console.log('[DEBUG] ë Œë”ë§í•  í”Œë ˆì´ì–´:', players);
      countDisplay.textContent = `${players.length}/10ëª…`;

      // 10ê°œ ì‹œíŠ¸ ë°°ì—´ ìƒì„± (1ë²ˆë¶€í„° 10ë²ˆê¹Œì§€)
      const seats = [];
      for (let i = 1; i <= 10; i++) {
        seats.push({
          seatNumber: i,
          player: players.find(p => parseInt(p.seat) === i) || null
        });
      }

      // 2ì—´ 5ê°œì”© ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (ì»´íŒ©íŠ¸)
      listContainer.innerHTML = `
        <div class="grid grid-cols-2 gap-1">
          ${seats.map(({ seatNumber, player }) => {
            const index = player ? players.indexOf(player) : -1;
            const isModified = player && window.managementState.changes.modified.includes(player.name);
            const isAdded = player && window.managementState.changes.added.includes(player.name);
            const isEmpty = !player;

            return `
            <div class="seat-slot bg-gray-700 p-1 rounded ${
              isEmpty ? 'opacity-40' : ''
            } ${
              isAdded ? 'border border-green-500' : isModified ? 'border border-yellow-500' : 'border border-gray-600'
            }" data-seat="${seatNumber}">
              <div class="flex items-center justify-between h-9">
                <div class="flex items-center gap-1 flex-1">
                  <span class="text-sm font-bold text-gray-400 w-6 text-center">
                    ${seatNumber}
                  </span>
                  ${player ? `
                    <div class="flex-1">
                      <input type="text" class="bg-gray-800 px-1 py-0.5 rounded text-xs w-full player-name-input"
                             value="${player.name}"
                             data-index="${index}"
                             data-seat="${seatNumber}">
                    </div>
                  ` : `
                    <div class="flex-1">
                      <input type="text" class="bg-gray-800 px-1 py-0.5 rounded text-xs w-full empty-seat-input"
                             placeholder="ì´ë¦„ ì…ë ¥"
                             data-seat="${seatNumber}">
                    </div>
                  `}
                </div>
                <div class="flex items-center gap-1">
                  ${player ? `
                    <input type="text" class="bg-gray-800 px-1 py-0.5 rounded text-xs w-16 local-chips-input"
                           value="${formatNumber(player.chips || '0')}"
                           placeholder="ì¹©"
                           data-index="${index}">
                    <button class="text-red-400 hover:text-red-300 text-xs local-delete-btn px-1"
                            data-index="${index}"
                            onclick="deleteLocalPlayer(${index})">âœ•</button>
                  ` : `
                    <span class="text-gray-500 text-xs w-16 text-center">-</span>
                  `}
                </div>
              </div>
              ${player && (isAdded || isModified) ? `
                <div class="text-xs px-6">
                  ${isAdded ? '<span class="text-green-400 text-xs">âœ“</span>' : ''}
                  ${isModified ? '<span class="text-yellow-400 text-xs">âœ“</span>' : ''}
                </div>
              ` : ''}
            </div>
          `;
          }).join('')}
        </div>
      `;

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€

      // ë¹ˆ ìë¦¬ ì…ë ¥ ì²˜ë¦¬
      listContainer.querySelectorAll('.empty-seat-input').forEach(input => {
        input.addEventListener('change', (e) => {
          const seatNumber = parseInt(e.target.dataset.seat);
          const playerName = e.target.value.trim();

          if (playerName) {
            addPlayerToSeat(playerName, seatNumber);
            e.target.value = '';
          }
        });
      });

      // í”Œë ˆì´ì–´ ì´ë¦„ ìˆ˜ì •
      listContainer.querySelectorAll('.player-name-input').forEach(input => {
        input.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.index);
          const newName = e.target.value.trim();

          if (index >= 0 && newName) {
            const player = window.managementState.currentPlayers[index];
            if (player && player.name !== newName) {
              player.name = newName;

              if (!window.managementState.changes.added.includes(player.name)) {
                if (!window.managementState.changes.modified.includes(player.name)) {
                  window.managementState.changes.modified.push(player.name);
                }
              }
              updateChangesSummary();
            }
          }
        });
      });

      // ì¹© ì…ë ¥ ì²˜ë¦¬
      listContainer.querySelectorAll('.local-chips-input').forEach(input => {
        input.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.index);
          const newChips = unformatNumber(e.target.value);
          e.target.value = formatNumber(newChips);
          updateLocalPlayerChips(index, newChips);
        });
      });

      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì¸ë¼ì¸ onclickìœ¼ë¡œ ì²˜ë¦¬ë¨
      console.log('[DEBUG] ì‚­ì œ ë²„íŠ¼ ê°œìˆ˜:', listContainer.querySelectorAll('.local-delete-btn').length);
    }

    // íŠ¹ì • ì‹œíŠ¸ì— í”Œë ˆì´ì–´ ì¶”ê°€
    function addPlayerToSeat(name, seatNumber) {
      if (!name) return;

      // ì¤‘ë³µ ì²´í¬
      if (window.managementState.currentPlayers.some(p => p.name === name)) {
        showFeedback(`${name}ì€(ëŠ”) ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤`, true);
        return;
      }

      // ì¢Œì„ ì¤‘ë³µ ì²´í¬
      if (window.managementState.currentPlayers.some(p => parseInt(p.seat) === seatNumber)) {
        showFeedback(`ì¢Œì„ ${seatNumber}ë²ˆì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤`, true);
        return;
      }

      // í”Œë ˆì´ì–´ ìˆ˜ ì œí•œ (10ëª…)
      if (window.managementState.currentPlayers.length >= 10) {
        showFeedback('ìµœëŒ€ 10ëª…ê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤', true);
        return;
      }

      // ì¶”ê°€
      const newPlayer = {
        name: name,
        seat: String(seatNumber),
        chips: '100000', // ê¸°ë³¸ ì¹©
        table: window.managementState.selectedTable,
        notable: false,
        status: 'IN'
      };

      window.managementState.currentPlayers.push(newPlayer);
      window.managementState.changes.added.push(name);

      renderManagementPlayersList();
      updateChangesSummary();
      showFeedback(`${name} ì¢Œì„ ${seatNumber}ë²ˆì— ì¶”ê°€ë¨`);
    }

    // ê¸°ì¡´ í”Œë ˆì´ì–´ ì¶”ê°€ UI ìˆ¨ê¸°ê¸° (10ê°œ ì‹œíŠ¸ì—ì„œ ì§ì ‘ ì…ë ¥í•˜ë¯€ë¡œ)
    const addPlayerBtn = document.getElementById('add-player-local-btn');
    if (addPlayerBtn) {
      addPlayerBtn.style.display = 'none';
    }
    const addSection = document.getElementById('player-add-section');
    if (addSection) {
      addSection.style.display = 'none';
    }

    // ë¡œì»¬ í”Œë ˆì´ì–´ ì¢Œì„ ì—…ë°ì´íŠ¸
    function updateLocalPlayerSeat(index, newSeat) {
      const player = window.managementState.currentPlayers[index];
      if (!player) return;

      // ì¢Œì„ ì¤‘ë³µ ì²´í¬
      if (newSeat && window.managementState.currentPlayers.some((p, i) => i !== index && p.seat === newSeat)) {
        showFeedback(`ì¢Œì„ ${newSeat}ë²ˆì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤`, true);
        renderManagementPlayersList();
        return;
      }

      player.seat = newSeat;

      // ë³€ê²½ ì‚¬í•­ ì¶”ì 
      if (!window.managementState.changes.added.includes(player.name)) {
        if (!window.managementState.changes.modified.includes(player.name)) {
          window.managementState.changes.modified.push(player.name);
        }
      }

      updateChangesSummary();
    }

    // ë¡œì»¬ í”Œë ˆì´ì–´ ì¹© ì—…ë°ì´íŠ¸
    function updateLocalPlayerChips(index, newChips) {
      const player = window.managementState.currentPlayers[index];
      if (!player) return;

      player.chips = newChips;

      // ë³€ê²½ ì‚¬í•­ ì¶”ì 
      if (!window.managementState.changes.added.includes(player.name)) {
        if (!window.managementState.changes.modified.includes(player.name)) {
          window.managementState.changes.modified.push(player.name);
        }
      }

      updateChangesSummary();
    }

    // ë¡œì»¬ í”Œë ˆì´ì–´ ì‚­ì œ - ì „ì—­ ìŠ¤ì½”í”„ë¡œ ë…¸ì¶œ (ì„œë²„ í†µì‹  ì—†ìŒ)
    window.deleteLocalPlayer = function(index) {
      const player = window.managementState.currentPlayers[index];
      if (!player) {
        console.log('[v3.3.1] ì‚­ì œí•  í”Œë ˆì´ì–´ ì—†ìŒ:', index);
        return;
      }

      console.log('[v3.3.1] í”Œë ˆì´ì–´ ì‚­ì œ:', player.name, 'index:', index);

      // ActionHistoryë¥¼ ì‚¬ìš©í•œ ì¦‰ì‹œ ì‚­ì œ
      const originalIndex = index;
      const originalPlayer = { ...player };
      const originalName = player.name;  // ì´ë¦„ ë³„ë„ ì €ì¥

      // ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸
      window.managementState.currentPlayers.splice(index, 1);

      // ë³€ê²½ ì‚¬í•­ ì¶”ì 
      if (window.managementState.changes.added.includes(originalName)) {
        // ìƒˆë¡œ ì¶”ê°€í•œ í•­ëª©ì´ë©´ addedì—ì„œ ì œê±°
        window.managementState.changes.added = window.managementState.changes.added.filter(n => n !== originalName);
      } else {
        // ê¸°ì¡´ í•­ëª©ì´ë©´ deletedì— ì¶”ê°€
        if (!window.managementState.changes.deleted.includes(originalName)) {
          window.managementState.changes.deleted.push(originalName);
        }
        // modifiedì—ì„œ ì œê±°
        window.managementState.changes.modified = window.managementState.changes.modified.filter(n => n !== originalName);
      }

      console.log('[v3.3.1] ì‚­ì œ í›„ changes:', window.managementState.changes);

      renderManagementPlayersList();
      updateChangesSummary();

      // ìŠ¤ë‚µë°” í‘œì‹œ (ì‹¤í–‰ì·¨ì†Œ ê°€ëŠ¥)
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(`${player.name} ì‚­ì œë¨ (ë¡œì»¬)`, () => {
          // ì‹¤í–‰ ì·¨ì†Œ ë¡œì§
          window.managementState.currentPlayers.splice(originalIndex, 0, originalPlayer);

          // ë³€ê²½ ì‚¬í•­ ë³µêµ¬
          if (window.managementState.changes.deleted.includes(originalPlayer.name)) {
            window.managementState.changes.deleted = window.managementState.changes.deleted.filter(n => n !== originalPlayer.name);
          }

          renderManagementPlayersList();
          updateChangesSummary();
        });
      } else {
        showFeedback(`${player.name} ì‚­ì œë¨ (ë¯¸ë“±ë¡)`);
      }
    }

    // ë³€ê²½ ì‚¬í•­ ìš”ì•½ ì—…ë°ì´íŠ¸
    function updateChangesSummary() {
      const summary = document.getElementById('changes-summary');
      const { added, modified, deleted } = window.managementState.changes;

      const parts = [];
      if (added.length > 0) parts.push(`ì¶”ê°€: ${added.length}ëª…`);
      if (modified.length > 0) parts.push(`ìˆ˜ì •: ${modified.length}ëª…`);
      if (deleted.length > 0) parts.push(`ì‚­ì œ: ${deleted.length}ëª…`);

      if (parts.length > 0) {
        summary.innerHTML = `<span class="text-yellow-400">âš ï¸ ë¯¸ë“±ë¡ ë³€ê²½ì‚¬í•­:</span> ${parts.join(', ')}<br>
        <span class="text-xs text-gray-500">ì¼ê´„ ë“±ë¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„œë²„ì— ì €ì¥í•˜ì„¸ìš”</span>`;
        summary.classList.remove('text-gray-400');
        summary.classList.add('text-amber-300');
      } else {
        summary.textContent = 'ë³€ê²½ ì‚¬í•­ ì—†ìŒ';
        summary.classList.remove('text-amber-300');
        summary.classList.add('text-gray-400');
      }
    }

    // ë³€ê²½ ì‚¬í•­ ì´ˆê¸°í™”
    document.getElementById('reset-changes-btn')?.addEventListener('click', () => {
      // ë°±ì—… ë°ì´í„° ìƒì„± (ì‹¤í–‰ì·¨ì†Œìš©)
      const backup = {
        players: JSON.parse(JSON.stringify(window.managementState.currentPlayers)),
        changes: JSON.parse(JSON.stringify(window.managementState.changes))
      };

      // ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
      window.managementState.currentPlayers = JSON.parse(JSON.stringify(
        window.managementState.originalPlayers
      ));
      window.managementState.changes = { added: [], modified: [], deleted: [] };

      renderManagementPlayersList();
      updateChangesSummary();

      // ìŠ¤ë‚µë°” í‘œì‹œ (ì‹¤í–‰ì·¨ì†Œ ê°€ëŠ¥)
      if (window.actionHistory) {
        window.actionHistory.showSnackbar('ë³€ê²½ ì‚¬í•­ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', () => {
          // ì‹¤í–‰ ì·¨ì†Œ - ì´ì „ ìƒíƒœë¡œ ë³µêµ¬
          window.managementState.currentPlayers = backup.players;
          window.managementState.changes = backup.changes;
          renderManagementPlayersList();
          updateChangesSummary();
        });
      } else {
        showFeedback('ë³€ê²½ ì‚¬í•­ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
      }
    });

    // ì¼ê´„ ë“±ë¡
    document.getElementById('batch-register-btn')?.addEventListener('click', async () => {
      const { added, modified, deleted } = window.managementState.changes;

      if (added.length === 0 && modified.length === 0 && deleted.length === 0) {
        if (window.actionHistory) {
          window.actionHistory.showSnackbar('ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤', null, 'warning');
        } else {
          showFeedback('ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤', true);
        }
        return;
      }

      // ë³€ê²½ì‚¬í•­ ë©”ì‹œì§€ í‘œì‹œ
      const changeMessage = `ì¶”ê°€: ${added.length}ëª…, ìˆ˜ì •: ${modified.length}ëª…, ì‚­ì œ: ${deleted.length}ëª…`;
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(`ë“±ë¡ ì¤‘... ${changeMessage}`, null, 'info');
      }

      const syncStatus = document.getElementById('sync-status');
      syncStatus.textContent = 'ë™ê¸°í™” ì¤‘...';
      syncStatus.className = 'text-xs text-yellow-400';

      await executeWithLock(async () => {

      try {
        console.log('[v3.3.1] === ì¼ê´„ ë“±ë¡ ì‹œì‘ ===');
        console.log('[v3.3.1] ì„ íƒëœ í…Œì´ë¸”:', window.managementState.selectedTable);
        console.log('[v3.3.1] í˜„ì¬ í”Œë ˆì´ì–´ ìˆ˜:', window.managementState.currentPlayers.length);
        console.log('[v3.3.1] ì¶”ê°€ë  í”Œë ˆì´ì–´:', added);
        console.log('[v3.3.1] ìˆ˜ì •ë  í”Œë ˆì´ì–´:', modified);
        console.log('[v3.3.1] ì‚­ì œë  í”Œë ˆì´ì–´:', deleted);
        console.log('[v3.3.1] Apps Script URL:', APPS_SCRIPT_URL);

        // ì‚­ì œ ëŒ€ìƒ í”Œë ˆì´ì–´ ìƒì„¸ ì •ë³´ í™•ì¸
        console.log('[v3.3.1] === ì‚­ì œ ëŒ€ìƒ ìƒì„¸ ì •ë³´ ===');
        deleted.forEach((playerName, index) => {
          console.log(`[v3.3.1] ì‚­ì œ[${index}]: "${playerName}" (ê¸¸ì´: ${playerName.length})`);
        });

        // ì¼ê´„ ì²˜ë¦¬ ìš”ì²­
        const formData = new FormData();
        formData.append('action', 'batchUpdate');
        formData.append('table', window.managementState.selectedTable);
        formData.append('players', JSON.stringify(window.managementState.currentPlayers));
        formData.append('deleted', JSON.stringify(deleted));

        console.log('[v3.3.1] FormData ìƒì„± ì™„ë£Œ');
        console.log('[v3.3.1] ì „ì†¡í•  í”Œë ˆì´ì–´ ë°ì´í„°:', JSON.stringify(window.managementState.currentPlayers, null, 2));
        console.log('[v3.3.1] ì‚­ì œí•  í”Œë ˆì´ì–´ ì´ë¦„ë“¤:', JSON.stringify(deleted, null, 2));

        // FormData ë‚´ìš© í™•ì¸
        console.log('[v3.3.1] === FormData ë‚´ìš© í™•ì¸ ===');
        for (let [key, value] of formData.entries()) {
          console.log(`[v3.3.1] FormData[${key}]:`, typeof value === 'string' ? value.substring(0, 200) + '...' : value);
        }

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        console.log('[v3.3.1] ì‘ë‹µ ìˆ˜ì‹ :', response.status, response.statusText);

        if (!response.ok) {
          console.log(`HTTP ${response.status}: ${response.statusText}`);
          showFeedback('ì„œë²„ í†µì‹  ì˜¤ë¥˜', true);
          return;
        }

        const result = await response.json();
        console.log('[v3.3.1] ì‘ë‹µ ë°ì´í„°:', result);

        if (result.success) {
          console.log('[v3.3.1] ì¼ê´„ ë“±ë¡ ì„±ê³µ:', result);
          syncStatus.textContent = 'âœ… ë™ê¸°í™” ì™„ë£Œ';
          syncStatus.className = 'text-xs text-green-400';

          // ìŠ¤ë‚µë°”ë¡œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (ì •ë ¬ í¬í•¨)
          if (window.actionHistory) {
            window.actionHistory.showSnackbar('âœ… ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ë“±ë¡ë˜ê³  ì‹œíŠ¸ê°€ ì •ë ¬ë˜ì—ˆìŠµë‹ˆë‹¤', null, 'success');
          } else {
            showFeedback('âœ… ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ë“±ë¡ë˜ê³  ì‹œíŠ¸ê°€ ì •ë ¬ë˜ì—ˆìŠµë‹ˆë‹¤');
          }

          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ - CSV ë°©ì‹ ì‚¬ìš©
          try {
            console.log('[v3.3.1] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘...');
            console.log('[v3.3.1] CSV_TYPE_URL:', CSV_TYPE_URL);

            const csv = await fetch(CSV_TYPE_URL).then(r => {
              console.log('[v3.3.1] CSV ì‘ë‹µ ìƒíƒœ:', r.status, r.statusText);
              return r.text();
            });

            console.log('[v3.3.1] CSV ë°ì´í„° ê¸¸ì´:', csv.length);
            console.log('[v3.3.1] CSV ì²« 100ì:', csv.substring(0, 100));

            const rows = parseCSV(csv);
            console.log('[v3.3.1] íŒŒì‹±ëœ í–‰ ìˆ˜:', rows.length);

            buildTypeFromCsv(rows);
            console.log('[v3.3.1] Type ë°ì´í„° ë¹Œë“œ ì™„ë£Œ');
            console.log('[v3.3.1] ì—…ë°ì´íŠ¸ëœ í…Œì´ë¸”:', Object.keys(window.state.playerDataByTable));
          } catch (refreshError) {
            console.error('[v3.3.1] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', refreshError);
            showFeedback('âš ï¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨, í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”', true);
          }

          // ìƒíƒœ ë¦¬ì…‹
          try {
            console.log('[v3.3.1] ìƒíƒœ ë¦¬ì…‹ ì‹œì‘...');
            console.log('[v3.3.1] ì„ íƒëœ í…Œì´ë¸”:', window.managementState.selectedTable);

            const refreshedPlayers = window.state.playerDataByTable[window.managementState.selectedTable] || [];
            console.log('[v3.3.1] ìƒˆë¡œê³ ì¹¨ëœ í”Œë ˆì´ì–´ ìˆ˜:', refreshedPlayers.length);

            window.managementState.originalPlayers = JSON.parse(JSON.stringify(refreshedPlayers));
            window.managementState.currentPlayers = JSON.parse(JSON.stringify(refreshedPlayers));
            window.managementState.changes = { added: [], modified: [], deleted: [] };

            console.log('[v3.3.1] ìƒíƒœ ë¦¬ì…‹ ì™„ë£Œ');
          } catch (resetError) {
            console.error('[v3.3.1] ìƒíƒœ ë¦¬ì…‹ ì‹¤íŒ¨:', resetError);
          }

          try {
            console.log('[v3.3.1] UI ì—…ë°ì´íŠ¸ ì‹œì‘...');
            renderManagementPlayersList();
            updateChangesSummary();
            renderPlayerSelection(); // ë©”ì¸ í™”ë©´ ì—…ë°ì´íŠ¸

            // ì „ì²´ UI ìƒˆë¡œê³ ì¹¨ (ì¦‰ì‹œ ë°˜ì˜ì„ ìœ„í•´)
            if (typeof renderAll === 'function') {
              renderAll();
              console.log('[v3.3.1] ì „ì²´ UI ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
            }

            // í”Œë ˆì´ì–´ ë°ì´í„° ë‹¤ì‹œ ë Œë”ë§
            if (typeof updatePlayersDisplay === 'function') {
              updatePlayersDisplay();
              console.log('[v3.3.1] í”Œë ˆì´ì–´ ë””ìŠ¤í”Œë ˆì´ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
            }

            console.log('[v3.3.1] UI ì—…ë°ì´íŠ¸ ì™„ë£Œ - ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì¦‰ì‹œ ì ìš©ë¨');
          } catch (uiError) {
            console.error('[v3.3.1] UI ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', uiError);
          }

          // ëª¨ë‹¬ ìë™ ë‹«ê¸° ë° ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸
          if (typeof autoCloseManagementModal === 'function') {
            console.log('[v3.3.1] ëª¨ë‹¬ ìë™ ë‹«ê¸° ì‹¤í–‰...');
            autoCloseManagementModal();
          } else {
            // í´ë°±: ìˆ˜ë™ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            setTimeout(() => {
              const modal = document.getElementById('management-modal');
              if (modal) {
                modal.classList.add('hidden', 'opacity-0');
                console.log('[v3.3.1] ëª¨ë‹¬ ìˆ˜ë™ ë‹«ê¸° ì™„ë£Œ');
              }
            }, 2000);
          }
        } else {
          // ì˜¤ë¥˜ ì²˜ë¦¬
          syncStatus.textContent = 'âŒ ë™ê¸°í™” ì‹¤íŒ¨';
          syncStatus.className = 'text-xs text-red-400';

          const errorMessage = result.message && result.message.includes('Unknown action')
            ? 'Apps Script ì¬ë°°í¬ê°€ í•„ìš”í•©ë‹ˆë‹¤'
            : result.message || 'ë“±ë¡ ì‹¤íŒ¨';

          // ìŠ¤ë‚µë°”ë¡œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
          if (window.actionHistory) {
            window.actionHistory.showSnackbar(errorMessage, null, 'error');
          } else {
            showFeedback(errorMessage, true);
          }

          // UI í™œì„±í™”
          if (typeof enableModalUI === 'function') {
            enableModalUI();
          }
        }
      } catch(err) {
        console.error('[v3.3.1] === ì¼ê´„ ë“±ë¡ ì˜¤ë¥˜ ===');
        console.error('[v3.3.1] ì˜¤ë¥˜ íƒ€ì…:', err.constructor.name);
        console.error('[v3.3.1] ì˜¤ë¥˜ ë©”ì‹œì§€:', err.message);
        console.error('[v3.3.1] ì˜¤ë¥˜ ìŠ¤íƒ:', err.stack);
        console.error('[v3.3.1] ì „ì²´ ì˜¤ë¥˜ ê°ì²´:', err);

        syncStatus.textContent = 'âŒ ë™ê¸°í™” ì‹¤íŒ¨';
        syncStatus.className = 'text-xs text-red-400';

        // ìƒì„¸í•œ ì—ëŸ¬ ë¶„ì„
        let errorMessage = err.message;
        let debugInfo = '';

        if (err.message.includes('loadTypeSheet is not defined')) {
          errorMessage = 'ë°ì´í„° ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ ì˜¤ë¥˜ (ì´ë¯¸ ìˆ˜ì •ë¨)';
          debugInfo = 'í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”';
        } else if (err.message.includes('Apps Script ì¬ë°°í¬')) {
          errorMessage = 'âš ï¸ Apps Script ì¬ë°°í¬ í•„ìš” (ê´€ë¦¬ ë©”ë‰´ ì°¸ì¡°)';
        } else if (err.message.includes('NetworkError') || err.message.includes('fetch')) {
          errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜';
          debugInfo = 'Apps Script URLì„ í™•ì¸í•˜ê³  ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”';
        } else if (err.message.includes('JSON')) {
          errorMessage = 'Apps Script ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜';
          debugInfo = 'Apps Scriptê°€ ì˜¬ë°”ë¥¸ JSONì„ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
        }

        console.error('[v3.3.1] ë¶„ì„ëœ ì˜¤ë¥˜:', errorMessage);
        console.error('[v3.3.1] ë””ë²„ê·¸ ì •ë³´:', debugInfo);

        showFeedback(`âŒ ${errorMessage}${debugInfo ? ` (${debugInfo})` : ''}`, true);

        // UI í™œì„±í™”
        if (typeof enableModalUI === 'function') {
          enableModalUI();
        }
      } finally {
        console.log('[v3.3.1] === ì¼ê´„ ë“±ë¡ ì¢…ë£Œ ===');
      }
    }, 'í”Œë ˆì´ì–´ ë“±ë¡', 'í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ì„œë²„ì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
    });

    // ê¸°ì¡´ í”Œë ˆì´ì–´ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜ (êµ¬ë²„ì „ í˜¸í™˜ìš©)
    function loadPlayersList() {
      const listContainer = document.getElementById('current-players-list');
      if (!listContainer) return;

      const table = window.state.selectedTable;
      if (!table) {
        listContainer.innerHTML = '<p class="text-gray-400 text-xs">í…Œì´ë¸”ì„ ì„ íƒí•˜ë©´ í”Œë ˆì´ì–´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
        return;
      }

      const players = window.state.playerDataByTable[table] || [];
      if (players.length === 0) {
        listContainer.innerHTML = '<p class="text-gray-400 text-xs">í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      listContainer.innerHTML = players.map(player => `
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded player-list-item" data-player="${player.name}">
          <div class="flex-1">
            <span class="font-medium">${player.name}</span>
            ${player.seat ? `<span class="text-xs text-gray-400 ml-2">ì¢Œì„ ${player.seat}</span>` : ''}
          </div>
          <div class="flex items-center gap-2">
            <input type="number" class="bg-gray-700 px-2 py-1 rounded text-sm w-16 seat-input"
                   value="${player.seat || ''}" placeholder="ì¢Œì„" min="1" max="10"
                   data-player="${player.name}">
            <input type="text" class="bg-gray-700 px-2 py-1 rounded text-sm w-20 chips-input"
                   value="${formatNumber(player.chips || '0')}" placeholder="ì¹©"
                   data-player="${player.name}">
            <button class="text-red-500 hover:text-red-400 delete-player-btn" data-player="${player.name}">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join('');

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      listContainer.querySelectorAll('.seat-input').forEach(input => {
        input.addEventListener('change', (e) => {
          const playerName = e.target.dataset.player;
          const newSeat = e.target.value;
          updatePlayerSeat(playerName, newSeat);
        });
      });

      listContainer.querySelectorAll('.chips-input').forEach(input => {
        input.addEventListener('input', (e) => {
          const playerName = e.target.dataset.player;
          const newChips = unformatNumber(e.target.value);
          e.target.value = formatNumber(newChips);
          updatePlayerChips(playerName, newChips);
        });
      });

      // êµ¬ë²„ì „ ì‚­ì œ ë²„íŠ¼ - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
      /*
      listContainer.querySelectorAll('.delete-player-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const playerName = e.target.dataset.player;
          // confirm ì œê±°, ì¦‰ì‹œ ì‚­ì œ ì‹¤í–‰
          deletePlayer(playerName);
        });
      });
      */
    }

    // í”Œë ˆì´ì–´ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('add-player-btn')?.addEventListener('click', () => {
      const nameInput = document.getElementById('new-player-name');
      const seatInput = document.getElementById('new-player-seat');
      const chipsInput = document.getElementById('new-player-chips');

      const name = nameInput.value.trim();
      const seat = seatInput.value;
      const chips = unformatNumber(chipsInput.value) || '0';

      if (!name) {
        showFeedback('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', true);
        return;
      }

      if (!window.state.selectedTable) {
        showFeedback('ë¨¼ì € í…Œì´ë¸”ì„ ì„ íƒí•˜ì„¸ìš”', true);
        return;
      }

      addNewPlayer(name, seat, chips);

      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      nameInput.value = '';
      seatInput.value = '';
      chipsInput.value = '';
    });


    // í”Œë ˆì´ì–´ ì¶”ê°€ í•¨ìˆ˜ - ì¤‘ë³µ ì²´í¬ ê°•í™”
    async function addNewPlayer(name, seat, chips) {
      try {
        // í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¨¼ì € ì¤‘ë³µ ì²´í¬
        const existingPlayer = window.state.playersByTable[window.state.selectedTable]?.find(p =>
          p.name === name && p.status === 'IN'
        );

        if (existingPlayer) {
          showFeedback(`âŒ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”Œë ˆì´ì–´ì…ë‹ˆë‹¤: ${name}`, true);
          return;
        }

        const formData = new FormData();
        formData.append('action', 'addPlayer');
        formData.append('table', window.state.selectedTable);
        formData.append('player', name);
        formData.append('seat', seat || '');
        formData.append('chips', chips);
        formData.append('status', 'IN');

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          console.log('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ ì„±ê³µ:', result);
          showFeedback(`âœ… ${name} ì¶”ê°€ë¨`);

          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ - CSV ë°©ì‹ ì‚¬ìš©
          try {
            console.log('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ í›„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨...');
            const csv = await fetch(CSV_TYPE_URL).then(r => r.text());
            const rows = parseCSV(csv);
            buildTypeFromCsv(rows);
            console.log('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ í›„ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
          } catch (refreshError) {
            console.error('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ í›„ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', refreshError);
          }

          loadPlayersList();
          renderPlayerSelection();
        } else {
          console.error('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ ì‹¤íŒ¨:', result);
          showFeedback(`âŒ ì¶”ê°€ ì‹¤íŒ¨: ${result.error}`, true);
        }
      } catch(err) {
        console.error('í”Œë ˆì´ì–´ ì¶”ê°€ ì˜¤ë¥˜:', err);
        showFeedback('í”Œë ˆì´ì–´ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', true);
      }
    }

    // í”Œë ˆì´ì–´ ì¢Œì„ ì—…ë°ì´íŠ¸
    async function updatePlayerSeat(playerName, newSeat) {
      try {
        const formData = new FormData();
        formData.append('action', 'updateSeat');
        formData.append('table', window.state.selectedTable);
        formData.append('player', playerName);
        formData.append('seat', newSeat || '');

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          showFeedback(`âœ… ${playerName} ì¢Œì„ ${newSeat}ìœ¼ë¡œ ë³€ê²½`);
          // ë©”ëª¨ë¦¬ ì—…ë°ì´íŠ¸
          const player = window.state.playerDataByTable[window.state.selectedTable]?.find(p => p.name === playerName);
          if (player) player.seat = newSeat;
          renderPlayerSelection();
        } else {
          showFeedback(`âŒ ì¢Œì„ ë³€ê²½ ì‹¤íŒ¨: ${result.error}`, true);
        }
      } catch(err) {
        console.error('ì¢Œì„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', err);
        showFeedback('ì¢Œì„ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', true);
      }
    }

    // í”Œë ˆì´ì–´ ì¹© ì—…ë°ì´íŠ¸
    async function updatePlayerChips(playerName, newChips) {
      try {
        const formData = new FormData();
        formData.append('action', 'updateChips');
        formData.append('table', window.state.selectedTable);
        formData.append('player', playerName);
        formData.append('chips', newChips);

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          // ë©”ëª¨ë¦¬ ì—…ë°ì´íŠ¸
          const player = window.state.playerDataByTable[window.state.selectedTable]?.find(p => p.name === playerName);
          if (player) player.chips = newChips;
        }
      } catch(err) {
        console.error('ì¹© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', err);
      }
    }

    // í”Œë ˆì´ì–´ ì‚­ì œ (êµ¬ë²„ì „ - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
    // ìƒˆë¡œìš´ ê´€ë¦¬ ì‹œìŠ¤í…œì—ì„œëŠ” deleteLocalPlayerë¥¼ ì‚¬ìš©í•˜ê³ 
    // ì„œë²„ ë™ê¸°í™”ëŠ” ì¼ê´„ ë“±ë¡ ì‹œì—ë§Œ ì²˜ë¦¬
    /*
    async function deletePlayer(playerName) {
      try {
        const formData = new FormData();
        formData.append('action', 'deletePlayer');
        formData.append('table', window.state.selectedTable);
        formData.append('player', playerName);

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          showFeedback(`âœ… ${playerName} ì‚­ì œë¨`);
          // ë©”ëª¨ë¦¬ì—ì„œ ì œê±°
          const players = window.state.playerDataByTable[window.state.selectedTable];
          if (players) {
            const index = players.findIndex(p => p.name === playerName);
            if (index !== -1) players.splice(index, 1);
          }
          loadPlayersList();
          renderPlayerSelection();
        } else {
          showFeedback(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`, true);
        }
      } catch(err) {
        console.error('í”Œë ˆì´ì–´ ì‚­ì œ ì˜¤ë¥˜:', err);
        showFeedback('í”Œë ˆì´ì–´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', true);
      }
    }
    */
    
    // ========================================
    // ì„¤ì • ëª¨ë‹¬ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    // ========================================
    
    // ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
    if (el.settingsBtn) {
      el.settingsBtn.addEventListener('click', () => {
        // í˜„ì¬ URL í‘œì‹œ
        el.currentAppsUrl.textContent = APPS_SCRIPT_URL;
        el.appsScriptUrlInput.value = APPS_SCRIPT_URL;
        
        // ì¹© ê²€ì¦ ì„¤ì • ë¡œë“œ
        const chipValidation = localStorage.getItem('chipValidation') !== 'false';
        el.chipValidationToggle.checked = chipValidation;
        
        // ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ ì„¤ì • ë¡œë“œ
        const actionInputMode = localStorage.getItem('actionInputMode') === 'auto';
        const actionInputToggle = document.getElementById('action-input-mode-toggle');
        if (actionInputToggle) {
          actionInputToggle.checked = actionInputMode;
        }
        
        // í´ë¼ìš°ë“œ ë™ê¸°í™” UI ì—…ë°ì´íŠ¸
        updateCloudSyncUI();

        // ë²„ì „ ì •ë³´ ì—…ë°ì´íŠ¸
        const versionInfo = el.settingsModal.querySelector('.text-gray-400');
        if (versionInfo) {
          el.settingsModal.querySelectorAll('.text-gray-400').forEach((elem, idx) => {
            if (idx === 0) elem.textContent = APP_VERSION;
            if (idx === 1) elem.textContent = VERSION_DATE;
          });
        }
        
        // ëª¨ë‹¬ ì—´ê¸°
        el.settingsModal.classList.remove('hidden');
      });
    }
    
    // ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
    const closeSettings = () => {
      el.settingsModal.classList.add('hidden');
    };
    
    if (el.closeSettingsBtn) {
      el.closeSettingsBtn.addEventListener('click', closeSettings);
    }
    
    if (el.cancelSettingsBtn) {
      el.cancelSettingsBtn.addEventListener('click', closeSettings);
    }
    
    // ì„¤ì • ì €ì¥
    if (el.saveSettingsBtn) {
      el.saveSettingsBtn.addEventListener('click', () => {
        // Apps Script URL ì €ì¥
        const newUrl = el.appsScriptUrlInput.value.trim();
        if (newUrl && newUrl !== APPS_SCRIPT_URL) {
          if (updateAppsScriptUrl(newUrl)) {
            console.log('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ì™„ë£Œ');
          }
        }
        
        // ì¹© ê²€ì¦ ì„¤ì • ì €ì¥
        const chipValidation = el.chipValidationToggle.checked;
        localStorage.setItem('chipValidation', chipValidation.toString());
        window.state.chipValidation = chipValidation;
        console.log(`âœ… ì¹© ê²€ì¦ ì„¤ì •: ${chipValidation ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
        
        // ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ ì„¤ì • ì €ì¥
        const actionInputToggle = document.getElementById('action-input-mode-toggle');
        if (actionInputToggle) {
          const actionInputMode = actionInputToggle.checked ? 'auto' : 'manual';
          localStorage.setItem('actionInputMode', actionInputMode);
          window.state.actionInputMode = actionInputMode;
          console.log(`âœ… ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ: ${actionInputMode === 'auto' ? 'ìë™ ë§¤í•‘' : 'ìˆ˜ë™ ì„ íƒ'}`);
          
          // UI ì—…ë°ì´íŠ¸
          renderAll();
        }
        
        showFeedback('âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        closeSettings();
      });
    }

    // í´ë¼ìš°ë“œ ë™ê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    if (el.syncNowBtn) {
      el.syncNowBtn.addEventListener('click', syncCloudNow);
    }

    if (el.resetCloudBtn) {
      el.resetCloudBtn.addEventListener('click', resetCloudConfig);
    }

    // ESC í‚¤ë¡œ ë‹«ê¸°
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !el.settingsModal.classList.contains('hidden')) {
        closeSettings();
      }
    });
    
    const closeBtn = document.getElementById('close-registration-modal');
    if (closeBtn) {
      closeBtn.addEventListener('click', closeRegistrationModal);
    }
    
    
    
    // ë²„íŠ¼ ìœ„ì¹˜ ì„ íƒ ì´ë²¤íŠ¸ - renderPlayerSelectionì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì œê±°
    // (renderPlayerSelection í•¨ìˆ˜ ë‚´ì—ì„œ ì´ë¯¸ ì²˜ë¦¬ì¤‘)

    // ====== INIT ======
    async function initializeApp(){
      await executeWithLock(async () => {
        el.logDisplay.innerHTML='';
        openLogModal();
        logMessage(`ğŸ¯ ${VERSION_INFO}`);
        logMessage(`ğŸ“… ì´ˆê¸°í™” ì‹œì‘: ${new Date().toLocaleString('ko-KR')}`);

        // ğŸŒ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ë™ê¸°í™” (ìµœìš°ì„  ì‹¤í–‰)
        logMessage('ğŸŒ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ë™ê¸°í™” ì¤‘...');
        try {
          const syncedUrl = await loadAppsScriptUrlFromServer();
          APPS_SCRIPT_URL = syncedUrl; // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
          logMessage(`ğŸ“¡ ë™ê¸°í™” ì™„ë£Œ: ${syncedUrl.substring(0, 50)}...`);
        } catch (syncError) {
          logMessage(`âš ï¸ URL ë™ê¸°í™” ì‹¤íŒ¨: ${syncError.message}`, true);
        }

        populateTimezones(); loadActionState();
        try{
          await loadInitial();
          renderTableSelection();
          initializeSeatGrid();  // ì¢Œì„ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
          if(timeUpdater) clearInterval(timeUpdater);
          timeUpdater = setInterval(updateTimeDisplay, 1000);
          updateTimeDisplay();
          logMessage(`âœ… ${APP_VERSION} ì¤€ë¹„ ì™„ë£Œ!`);

          // ì¤‘ë³µ ê²€ì‚¬ ì‹¤í–‰ (ì§ì ‘ í˜¸ì¶œë¡œ ì´ì¤‘ ì‹¤í–‰ ë°©ì§€)
          logMessage(`ğŸ” ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì‚¬ ì‹œì‘...`);
          if (window.removeDuplicatePlayers && typeof window.removeDuplicatePlayers === 'function') {
            try {
              // skipModalOpen=trueë¡œ ëª¨ë‹¬ ì¤‘ë³µ ì—´ê¸° ë°©ì§€
              const result = await window.removeDuplicatePlayers(true);
              if (result.success) {
                if (result.removedCount > 0) {
                  logMessage(`âœ… ì¤‘ë³µ ì œê±° ì™„ë£Œ: ${result.removedCount}ëª… ì œê±°`);
                } else {
                  logMessage(`âœ… ì¤‘ë³µ ì—†ìŒ - ì‹œíŠ¸ê°€ ê¹¨ë—í•©ë‹ˆë‹¤`);
                }
              }
            } catch (duplicateError) {
              console.error('ì¤‘ë³µ ê²€ì‚¬ ì˜¤ë¥˜:', duplicateError);
              logMessage(`âš ï¸ ì¤‘ë³µ ê²€ì‚¬ ì‹¤íŒ¨: ${duplicateError.message}`, true);
            }
          }
        }catch(err){
          console.error(err); logMessage(`ì´ˆê¸°í™” ì‹¤íŒ¨: ${err.message}`, true);
        }finally{
          setTimeout(closeLogModal, 3000); // ì¤‘ë³µ ê²€ì‚¬ ì™„ë£Œ í›„ ë‹«ê¸° ìœ„í•´ ì‹œê°„ ì—°ì¥
        }
      }, 'ì•± ì´ˆê¸°í™”', 'ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...');
    }

    // ====== ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ë™ê¸°í™” ì‹œìŠ¤í…œ ======

    // ì„œë²„ì— ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì €ì¥
    async function saveAppsScriptUrlToServer(url) {
      try {
        console.log(`[Config] ì•±ìŠ¤í¬ë¦½íŠ¸ URL ì„œë²„ ì €ì¥ ì‹œì‘: ${url}`);

        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'saveConfig',
            configType: 'appsScriptUrl',
            value: url
          })
        });

        const result = await response.json();

        if (result.success) {
          // ì„œë²„ ì €ì¥ ì„±ê³µ ì‹œ ë¡œì»¬ì—ë„ ì €ì¥
          localStorage.setItem('appsScriptUrl', url);
          APPS_SCRIPT_URL = url; // ì „ì—­ ë³€ìˆ˜ë„ ì—…ë°ì´íŠ¸

          console.log(`[Config] ì„œë²„ ì €ì¥ ì„±ê³µ: ${url}`);
          showFeedback('âœ… ëª¨ë“  ê¸°ê¸°ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤', false);
          return true;
        } else {
          console.warn(`[Config] ì„œë²„ ì €ì¥ ì‹¤íŒ¨:`, result.error);
          showFeedback('âš ï¸ ì„œë²„ ì €ì¥ ì‹¤íŒ¨, ë¡œì»¬ì—ë§Œ ì €ì¥ë¨', true);
          localStorage.setItem('appsScriptUrl', url);
          return false;
        }
      } catch (error) {
        console.error(`[Config] ì„œë²„ ì €ì¥ ì˜¤ë¥˜:`, error);
        showFeedback('âš ï¸ ì„œë²„ ì—°ê²° ì‹¤íŒ¨, ë¡œì»¬ì—ë§Œ ì €ì¥ë¨', true);
        localStorage.setItem('appsScriptUrl', url);
        return false;
      }
    }

    // ì„œë²„ì—ì„œ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ë¡œë“œ
    async function loadAppsScriptUrlFromServer() {
      const defaultUrl = 'https://script.google.com/macros/s/AKfycbwEcsF1F_RLLW_qkQIFkrwmut-zN0fHOqsAKs5B8PgHZAz2_O5sA8o2W5zZ3nD-5tjY/exec';
      const localUrl = localStorage.getItem('appsScriptUrl') || defaultUrl;

      try {
        console.log(`[Config] ì„œë²„ì—ì„œ ì•±ìŠ¤í¬ë¦½íŠ¸ URL ë¡œë“œ ì‹œë„`);

        const response = await fetch(localUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            action: 'getConfig',
            configType: 'appsScriptUrl'
          })
        });

        const result = await response.json();

        if (result.success && result.data && result.data.appsScriptUrl) {
          const serverUrl = result.data.appsScriptUrl;
          console.log(`[Config] ì„œë²„ì—ì„œ URL ë¡œë“œ ì„±ê³µ: ${serverUrl}`);

          // ì„œë²„ URLê³¼ ë¡œì»¬ URLì´ ë‹¤ë¥´ë©´ ì—…ë°ì´íŠ¸
          if (serverUrl !== localUrl) {
            localStorage.setItem('appsScriptUrl', serverUrl);
            console.log(`[Config] ë¡œì»¬ URL ì—…ë°ì´íŠ¸: ${localUrl} â†’ ${serverUrl}`);
          }

          return serverUrl;
        } else {
          console.log(`[Config] ì„œë²„ì— ì„¤ì • ì—†ìŒ, ë¡œì»¬/ê¸°ë³¸ê°’ ì‚¬ìš©`);
          return localUrl;
        }
      } catch (error) {
        console.warn(`[Config] ì„œë²„ì—ì„œ URL ë¡œë“œ ì‹¤íŒ¨, ë¡œì»¬ ì„¤ì • ì‚¬ìš©:`, error);
        return localUrl;
      }
    }

    // ì•±ìŠ¤í¬ë¦½íŠ¸ URL ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
    function updateSyncStatus(status, message) {
      const statusElement = document.getElementById('url-sync-status');
      if (statusElement) {
        statusElement.textContent = message;
        statusElement.className = status === 'success' ? 'text-green-400 text-xs' :
                                   status === 'warning' ? 'text-yellow-400 text-xs' :
                                   'text-red-400 text-xs';
      }
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
    window.saveAppsScriptUrlToServer = saveAppsScriptUrlToServer;
    window.loadAppsScriptUrlFromServer = loadAppsScriptUrlFromServer;

    setupEventListeners();
    initializeApp();
  });
  </script>

  <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-75 z-60 hidden flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-sm w-full mx-4">
      <div class="flex items-center space-x-3">
        <div class="animate-spin h-5 w-5 border-2 border-amber-500 border-t-transparent rounded-full"></div>
        <div>
          <div id="loading-title" class="text-white font-medium">ì²˜ë¦¬ ì¤‘...</div>
          <div id="loading-message" class="text-gray-400 text-sm mt-1">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì§€ ë§ˆì„¸ìš”
      </div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” ì»´í¬ë„ŒíŠ¸ -->
  <div id="snackbar" class="snackbar"></div>

  <!-- ì¤‘ë³µ í”Œë ˆì´ì–´ ì œê±° ëª¨ë“ˆ (ë§¤ ìƒˆë¡œê³ ì¹¨ë§ˆë‹¤ ìë™ ì‹¤í–‰) -->
  <script src="src/js/duplicate-remover.js?v=3.4.16"></script>
</body>
</html>
</file>

<file path="README.md">
# ğŸ° Virtual Data - Poker Hand Logger

> ì‹¤ì‹œê°„ í¬ì»¤ í•¸ë“œ ê¸°ë¡ ë° ë¶„ì„ ì‹œìŠ¤í…œ v3.5.12

## ğŸŒ ì ‘ì† ë§í¬
- **GitHub ì €ì¥ì†Œ**: https://github.com/garimto81/virtual_data
- **ë¼ì´ë¸Œ ë°ëª¨**: https://garimto81.github.io/virtual_data/

## ğŸ“‹ ê°œìš”

Google Sheetsì™€ ì—°ë™ë˜ëŠ” ì›¹ ê¸°ë°˜ í¬ì»¤ í•¸ë“œ ë¡œê±°ì…ë‹ˆë‹¤. ì‹¤ì‹œê°„ìœ¼ë¡œ í”Œë ˆì´ì–´ì˜ ì•¡ì…˜, ì¹© ë³€ë™, í•¸ë“œ ê²°ê³¼ë¥¼ ê¸°ë¡í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤.

### âœ¨ ì£¼ìš” ê¸°ëŠ¥
- ğŸ“Š Google Sheets ì‹¤ì‹œê°„ ì—°ë™
- ğŸ‘¥ í”Œë ˆì´ì–´ IN/OUT ìƒíƒœ ê´€ë¦¬
- ğŸ’° ìë™ íŒŸ ê³„ì‚° ë° ì¹© ì¶”ì 
- ğŸ¯ ìŠ¤íŠ¸ë¦¿ë³„ ì•¡ì…˜ ê¸°ë¡
- ğŸ“¸ ì¹´ë©”ë¼ ë²ˆí˜¸ ìë™ ê´€ë¦¬
- ğŸ† ìŠ¹ì ì„ íƒ ë° ì¹© ë¶„ë°°
- ğŸŒ êµ­ê°€ ì •ë³´ ë§¤í•‘ ì‹œìŠ¤í…œ
- ğŸš€ ìë™ ì•¡ì…˜ ë§¤í•‘ ì‹œìŠ¤í…œ (v2.13.0 ì‹ ê¸°ëŠ¥)
- âš¡ ëª¨ë°”ì¼ ìµœì í™” - í„°ì¹˜/ì œìŠ¤ì²˜/ì˜¤í”„ë¼ì¸ ì§€ì› (v3.2.0 ì‹ ê¸°ëŠ¥)

## ğŸ“ ìµœê·¼ ì—…ë°ì´íŠ¸

### v3.5.11 (2025-09-22) - í”Œë ˆì´ì–´ ì¢Œì„ ë§¤ì¹­ ë²„ê·¸ ìˆ˜ì •
- ğŸ”§ **í•µì‹¬ ë²„ê·¸ ìˆ˜ì •**: seatNo ë°ì´í„° íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²° ("#1" ë¬¸ìì—´ â†’ 1 ìˆ«ì ë³€í™˜)
- âœ… **ì •ìƒ í‘œì‹œ**: ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì˜¬ë°”ë¥¸ ì¢Œì„ì— í‘œì‹œë˜ë„ë¡ ê°œì„ 
- ğŸ¯ **ë§¤ì¹­ ë¡œì§**: `p.seatNo.replace('#', '')` ë¡œì§ìœ¼ë¡œ ë¬¸ìì—´ ì¢Œì„ë²ˆí˜¸ ì²˜ë¦¬

### v3.5.10 (2025-09-22) - í”Œë ˆì´ì–´ í‘œì‹œ ë²„ê·¸ ìˆ˜ì • ë° ë””ë²„ê¹… ê°•í™”
- ğŸš« **ë¶ˆí•„ìš” ê¸°ëŠ¥ ì œê±°**: ë¹ˆ ì¢Œì„ í´ë¦­ ê¸°ëŠ¥ ì œê±°ë¡œ ì•ˆì •ì„± í–¥ìƒ
- ğŸ› **ë””ë²„ê¹… ê°•í™”**: í”Œë ˆì´ì–´ ë°ì´í„° ë¡œë”© ë¬¸ì œ ì¶”ì ì„ ìœ„í•œ ìƒì„¸ ë¡œê·¸ ì¶”ê°€
- ğŸ” **ì¢Œì„ ë§¤ì¹­ ê²€ì¦**: seatNo í•„ë“œ íƒ€ì… ë° ê°’ ê²€ì¦ ë¡œì§ ì¶”ê°€
- âš™ï¸ **ìƒíƒœ ê²€ì‚¬**: í…Œì´ë¸” ë°ì´í„° ë° í”Œë ˆì´ì–´ ë§¤ì¹­ ìƒíƒœ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

### v3.5.9 (2025-09-22) - ì¢Œì„ ë²ˆí˜¸ í‘œì‹œ ê°œì„  (#ê¸°í˜¸ ì¶”ê°€)
- ğŸ”¢ **ì¢Œì„ í‘œì‹œ ê°œì„ **: ëª¨ë“  ì¢Œì„ ë²ˆí˜¸ì— # ê¸°í˜¸ ì¶”ê°€ (#1, #2, #3...)
- ğŸ¯ **ì¼ê´€ëœ UI**: íˆ´íŒ, í”¼ë“œë°± ë©”ì‹œì§€, ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ëª¨ë‘ í†µì¼
- ğŸ“ **ì…ë ¥ í•„ë“œ**: placeholder í…ìŠ¤íŠ¸ë„ #ì¢Œì„ìœ¼ë¡œ ë³€ê²½
- ğŸ› **ë¡œê·¸ ë©”ì‹œì§€**: ì½˜ì†” ë¡œê·¸ì—ì„œë„ #ì¢Œì„ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ

### v3.5.8 (2025-09-22) - í”Œë ˆì´ì–´ ì¢Œì„ í•„ë“œ í†µì¼ ë° í‘œì‹œ ìˆ˜ì •
- ğŸ”§ **í•„ë“œëª… í†µì¼**: ëª¨ë“  seat ì°¸ì¡°ë¥¼ seatNoë¡œ ìˆ˜ì •í•˜ì—¬ ì¼ê´€ì„± í™•ë³´
- ğŸ“ **í”Œë ˆì´ì–´ í‘œì‹œ ìˆ˜ì •**: ì¢Œì„ í•„í„°ë§ ë° í‘œì‹œ ë¡œì§ ì •ìƒí™”
- ğŸ“ **í…Œì´ë¸” ê´€ë¦¬ UI**: ì¢Œì„ ë²ˆí˜¸ ì…ë ¥ ë° í‘œì‹œ ê¸°ëŠ¥ ì •ìƒí™”
- ğŸ› **ë””ë²„ê¹… ì™„ë£Œ**: í”Œë ˆì´ì–´ ë¡œë”© ë¬¸ì œ ê·¼ë³¸ ì›ì¸ í•´ê²°

### v3.5.7 (2025-09-22) - í…Œì´ë¸” í”Œë ˆì´ì–´ ë¡œë”© ë²„ê·¸ ìˆ˜ì •
- ğŸ”§ **í…Œì´ë¸” í‚¤ ë§¤ì¹­ ìˆ˜ì •**: Table No.ë¥¼ í‚¤ë¡œ ì‚¬ìš©í•˜ì—¬ í”Œë ˆì´ì–´ ë°ì´í„° ì •ìƒ ë¡œë“©
- ğŸ¯ **í•„ë“œ í˜¸í™˜ì„±**: notable/keyplayer í•„ë“œ ëª¨ë‘ ì§€ì›
- ğŸš« **Table Name ì œê±°**: Table No.ë§Œ ì‚¬ìš©í•˜ì—¬ UI ë‹¨ìˆœí™”
- ğŸ› **ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€**: í…Œì´ë¸” ì„ íƒ ë° í”Œë ˆì´ì–´ ë°ì´í„° íë¦„ ì¶”ì 

### v3.4.15 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ ì´ì¤‘ ì‹¤í–‰ ë¬¸ì œ ì™„ì „ í•´ê²°
- ğŸ¯ **ì§ì ‘ í˜¸ì¶œ ë°©ì‹**: ë©”ì¸ ì•±ì—ì„œ removeDuplicatePlayers(true) ì§ì ‘ í˜¸ì¶œ
- ğŸš« **ì´ì¤‘ ì‹¤í–‰ ì°¨ë‹¨**: runDuplicateCheck ì¤‘ê°„ í•¨ìˆ˜ ì œê±°ë¡œ ì™„ì „ í•´ê²°
- ğŸ“Š **í†µí•© ë¡œê·¸**: í•˜ë‚˜ì˜ ëª¨ë‹¬ì—ì„œ ì•± ì´ˆê¸°í™”ì™€ ì¤‘ë³µ ê²€ì‚¬ ìˆœì°¨ ì§„í–‰
- âœ… **UX ê°œì„ **: ì½˜ì†” ì •ë¦¬ ë° ì‚¬ìš©ì ê²½í—˜ ìµœì í™”

### v3.4.14 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ í†µí•© ì‹œë„ (ì‹¤íŒ¨)
- âŒ **ì‹¤íŒ¨**: runDuplicateCheck â†’ removeDuplicatePlayers ì´ì¤‘ í˜¸ì¶œ êµ¬ì¡° ìœ ì§€
- ğŸ” **ì›ì¸**: í˜¸ì¶œ ì²´ì¸ ë‹¨ìˆœí™” ì‹¤íŒ¨ë¡œ ê·¼ë³¸ ë¬¸ì œ ë¯¸í•´ê²°

### v3.4.13 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ ë¡œê·¸ ëª¨ë‹¬ ìŠ¤ì½”í”„ ë¬¸ì œ í•´ê²°
- ğŸ”§ **ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ**: window.openLogModal, closeLogModal, logMessage
- ğŸ“Š **ì‹¤ì‹œê°„ í‘œì‹œ**: ì¤‘ë³µ ê²€ì‚¬ ê³¼ì •ì´ ë¡œê·¸ ëª¨ë‹¬ì— í‘œì‹œë¨
- â° **ìë™ ì™„ë£Œ**: ê²€ì‚¬ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ ìë™ ë‹«ê¸°

### v3.4.12 (2025-09-18) - ì¤‘ë³µ ê²€ì‚¬ ê³¼ì • ì‹œê°í™” ë° UX ê°œì„ 
- ğŸ“Š **ë¡œê·¸ ëª¨ë‹¬ ì—°ë™**: ì¤‘ë³µ ê²€ì‚¬ ê³¼ì •ì„ ë¡œê·¸ ëª¨ë‹¬ì— ì‹¤ì‹œê°„ í‘œì‹œ
- â° **ì§„í–‰ ìƒí™© í‘œì‹œ**: DuplicateRemoverì˜ ëª¨ë“  ë‹¨ê³„ê°€ íŒì—…ì— í‘œì‹œë¨
- ğŸ”„ **ìë™ ì™„ë£Œ**: ê²€ì‚¬ ì™„ë£Œ í›„ 3ì´ˆ ë’¤ ëª¨ë‹¬ ìë™ ë‹«ê¸°
- ğŸ‘ï¸ **ê°€ì‹œì„± í–¥ìƒ**: ì‚¬ìš©ìê°€ ì¤‘ë³µ ê²€ì‚¬ ì§„í–‰ ìƒí™©ì„ ëª…í™•íˆ í™•ì¸ ê°€ëŠ¥

### v3.4.11 (2025-09-18) - ì¤‘ì•™ ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ ë²„ê·¸ ìˆ˜ì •
- ğŸ› **ì¤‘ìš” ìˆ˜ì •**: APP_VERSION ìƒìˆ˜ë¥¼ v3.4.4ì—ì„œ v3.4.11ë¡œ ì—…ë°ì´íŠ¸
- ğŸ”§ **ê·¼ë³¸ ì›ì¸**: index.html 734ë²ˆì§¸ ì¤„ì˜ í•˜ë“œì½”ë”©ëœ ë²„ì „ ë²ˆí˜¸ ë¬¸ì œ í•´ê²°
- ğŸŒ **GitHub Pages**: ì´ì œ ì˜¬ë°”ë¥¸ ë²„ì „ì´ ì›¹ì—ì„œ í‘œì‹œë¨
- ğŸ“Š **ë²„ì „ ì¼ê´€ì„±**: ëª¨ë“  ë²„ì „ ì°¸ì¡°ê°€ ë™ì¼í•˜ê²Œ í†µì¼ë¨

### v3.4.10 (2025-09-18) - GitHub ì €ì¥ì†Œ êµ¬ì¡° í†µí•© ë° ê°„ì†Œí™”
- ğŸ“ **êµ¬ì¡° ê°„ì†Œí™”**: íŒŒì¼ë“¤ì„ ë£¨íŠ¸ ë ˆë²¨ë¡œ ì´ë™ (virtual_data ì„œë¸Œí´ë” ì œê±°)
- ğŸŒ **ë‹¨ìˆœí•œ URL**: GitHub Pages ê²½ë¡œ ë‹¨ìˆœí™”
- âœ… **ê´€ë¦¬ í†µí•©**: í•˜ë‚˜ì˜ ì €ì¥ì†Œì—ì„œ ì „ì²´ ê´€ë¦¬
- ğŸš€ **ì ‘ì† í¸ì˜**: garimto81.github.io/virtual_data ë‹¨ìˆœ ê²½ë¡œ

### v3.4.9 (2025-09-18) - openCardSelector í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
- ğŸ”§ **í•¨ìˆ˜ ì ‘ê·¼ì„±**: openCardSelectorë¥¼ window ê°ì²´ì— ë“±ë¡
- âœ… **ë²„ê·¸ ìˆ˜ì •**: ReferenceError: openCardSelector is not defined í•´ê²°
- ğŸ´ **ì¹´ë“œ ì„ íƒ**: ActionOrderManagerì—ì„œ ì¹´ë“œ ì„ íƒ UI ì •ìƒ í˜¸ì¶œ

### v3.4.8 (2025-09-18) - JavaScript íŒŒì¼ ê²½ë¡œ ë²„ê·¸ ìˆ˜ì •
- ğŸ”§ **ê²½ë¡œ ìˆ˜ì •**: archive í´ë”ì˜ JavaScript íŒŒì¼ ê²½ë¡œ ìˆ˜ì •
- âœ… **404 ì—ëŸ¬ í•´ê²°**: ëª¨ë“  ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ì •ìƒ ë¡œë“œ
- ğŸ“ **íŒŒì¼ êµ¬ì¡°**: chip-analysis, table-management ë“± archive í´ë” ê²½ë¡œ ë°˜ì˜

### v3.4.7 (2025-09-18) - í…ìŠ¤íŠ¸ ì¹´ë“œ ì…ë ¥ UI ì™„ì „ ì œê±°
- ğŸ´ **ì¹´ë“œ ì…ë ¥ í†µí•©**: í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì™„ì „ ì œê±°, ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒê¸°ë¡œ ì¼ì›í™”
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**: showFeedback í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
- â™ ï¸ **ì¼ê´€ëœ UX**: ëª¨ë“  ì¹´ë“œ ì…ë ¥ì´ ë™ì¼í•œ ë¹„ì£¼ì–¼ ì„ íƒ UI ì‚¬ìš©
- ğŸš« **ë ˆê±°ì‹œ ì œê±°**: promptForBoardCardsê°€ openCardSelector í˜¸ì¶œí•˜ë„ë¡ ë³€ê²½
- âœ… **ì½”ë“œ ì •ë¦¬**: saveBoardCards, skipBoardCards í•¨ìˆ˜ ê°„ì†Œí™”

### v3.4.6 (2025-09-18) - ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì‚¬ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
- ğŸš€ **ë°±ê·¸ë¼ìš´ë“œ ê²€ì‚¬**: UI ì°¨ë‹¨ ì—†ì´ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¡°ìš©íˆ ì‹¤í–‰
- ğŸ“ **ë©”ì‹œì§€ ê°„ì†Œí™”**: ì½˜ì†” ë¡œê·¸ ìœ„ì£¼ë¡œ ë³€ê²½, ì‚¬ìš©ì ë°©í•´ ìµœì†Œí™”
- âš¡ **ë¹ ë¥¸ ì‹¤í–‰**: í˜ì´ì§€ ë¡œë“œ í›„ ì¦‰ì‹œ ì‘ë™, ê²°ê³¼ë§Œ ì§§ê²Œ ì•Œë¦¼
- âœ… **ìŠ¤ë§ˆíŠ¸ ì•Œë¦¼**: ì¤‘ìš”í•œ ê²°ê³¼(ì‚­ì œ/ì˜¤ë¥˜)ë§Œ 2ì´ˆ ìŠ¤ë‚µë°”ë¡œ í‘œì‹œ
- ğŸ”‡ **ì¡°ìš©í•œ ì´ˆê¸°í™”**: "ì¤‘ë³µ ê²€ì‚¬ ì¤‘" ë©”ì‹œì§€ ì œê±°ë¡œ ì‚¬ìš©ì í¸ì˜ì„± ì¦ëŒ€

### v3.4.5 (2025-09-18) - ì¹´ë“œ ì…ë ¥ ì‹œìŠ¤í…œ í†µí•© ë° ê°œì„ 
- ğŸ¯ **ì¹´ë“œ ì…ë ¥ í†µì¼**: í…ìŠ¤íŠ¸ ì…ë ¥ ì œê±°, ë¹„ì£¼ì–¼ ì„ íƒ UIë¡œ ì™„ì „ í†µì¼
- â© **ìŠ¤ë§ˆíŠ¸ ìŠ¤í‚µ**: ì´ë¯¸ ì…ë ¥ëœ ì¹´ë“œê°€ ìˆìœ¼ë©´ í•´ë‹¹ ìŠ¤íŠ¸ë¦¿ ìë™ ìŠ¤í‚µ
- âœï¸ **ì¹´ë“œ ìˆ˜ì •**: ì…ë ¥ëœ ì¹´ë“œ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€
- âœ“ **ìƒíƒœ í‘œì‹œ**: ìŠ¤íŠ¸ë¦¿ ë²„íŠ¼ì— ì¹´ë“œ ì…ë ¥ ì™„ë£Œ ìƒíƒœ ì‹œê°í™”

### v3.5.5 (2025-09-22) - Type ì‹œíŠ¸ êµ¬ì¡° ë³€ê²½
- ğŸ“Š **Type ì‹œíŠ¸ ìƒˆ êµ¬ì¡°**: Poker Room, Table Name, Table No., Seat No., Players, Nationality, Chips, Keyplayer
- ğŸ¯ **í…Œì´ë¸” ì‹ë³„ì ë³€ê²½**: Table â†’ Table No.ë¡œ ë‹¨ìˆœí™”
- ğŸ—‘ï¸ **Camera Preset ì œê±°**: ì¹´ë©”ë¼ í”„ë¦¬ì…‹ ì„¤ì • ì‚­ì œ, ê³ ì •ê°’ ì‚¬ìš© (Cam1, Cam2)
- âœ¨ **ìƒˆ í•„ë“œ ì¶”ê°€**: Poker Room, Nationality ì •ë³´ ì¶”ê°€
- ğŸ”„ **í•„ë“œëª… ë³€ê²½**: notableâ†’keyplayer, seatâ†’seatNo

### v3.5.4 (2025-09-22) - ì¹´ë©”ë¼ ë²ˆí˜¸ êµ¬ê¸€ ì‹œíŠ¸ ê¸°ì¤€ ìˆ˜ì •
- ğŸ”§ **ì¹´ë©”ë¼ ë²ˆí˜¸ ê¸°ì¤€ ë³€ê²½**: í•­ìƒ êµ¬ê¸€ ì‹œíŠ¸ì˜ ë§ˆì§€ë§‰ ë²ˆí˜¸ ê¸°ì¤€ìœ¼ë¡œ +1
- ğŸ› **ë°˜ë³µ í´ë¦­ ë¬¸ì œ í•´ê²°**: ìƒˆ í•¸ë“œ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•´ë„ ë™ì¼í•œ ë²ˆí˜¸ ìœ ì§€

### v3.5.3 (2025-09-22) - ì¹´ë©”ë¼ ë²ˆí˜¸ ì´ˆê¸°í™” ìˆ˜ì •
- ğŸ“Š **êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™**: ìƒˆ í•¸ë“œ ì‹œì‘ ì‹œ êµ¬ê¸€ ì‹œíŠ¸ì˜ ë§ˆì§€ë§‰ ì¹´ë©”ë¼ ë²ˆí˜¸ ì‚¬ìš©
- ğŸ”¢ **ì´ˆê¸°í™” ë¬¸ì œ í•´ê²°**: 0001 ëŒ€ì‹  ì •í™•í•œ ë²ˆí˜¸ í‘œì‹œ

### v3.5.2 (2025-09-22) - ì¹´ë©”ë¼ ë²ˆí˜¸ ë¡œì§ ë‹¨ìˆœí™”
- ğŸ“¹ **ì¹´ë©”ë¼ ë²ˆí˜¸ ë‹¨ìˆœí™”**: ë³µì¡í•œ ìë™ ê³„ì‚° ì œê±°, ë‹¨ìˆœíˆ ì´ì „ í•¸ë“œ +1 ë¡œì§ìœ¼ë¡œ ë³€ê²½
- ğŸ”¢ **ë¹„ì •ìƒ ë²ˆí˜¸ ìˆ˜ì •**: 16ìë¦¬ ì¹´ë©”ë¼ ë²ˆí˜¸ ë¬¸ì œ í•´ê²°
- ğŸ—‘ï¸ **ë¶ˆí•„ìš” ì½”ë“œ ì œê±°**: lastCamNo ë³€ìˆ˜, localStorage ì‚¬ìš© ì œê±°
- âœ¨ **ë¡œì§ ê°œì„ **: cam1ê³¼ cam2 ë…ë¦½ì  ê´€ë¦¬, ëª…í™•í•œ ì¦ê°€ ë¡œì§

### v3.5.1 (2025-09-22) - ëª¨ë°”ì¼ ìµœì í™” ë²„ê·¸ ìˆ˜ì •
- ğŸ”¤ **ê¸€ê¼´ í¬ê¸° ì •ìƒí™”**: mobile-enhancer.js ë¹„í™œì„±í™”ë¡œ ê°€ë…ì„± ë³µêµ¬
- ğŸ“œ **ìŠ¤í¬ë¡¤ ë¬¸ì œ í•´ê²°**: í„°ì¹˜ ì´ë²¤íŠ¸ ì„ íƒì  ë°©ì§€ë¡œ ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ ë³µì›
- ğŸƒ **í„´ ì•¡ì…˜ ë²„ê·¸ ìˆ˜ì •**: í„´ì—ì„œ ë¦¬ë²„ ì¹´ë“œ ìš”ì²­ ë¬¸ì œ í•´ê²°
- â™ ï¸ **ì¹´ë“œ í‘œì‹œ ìˆ˜ì •**: A, K, 2, 3 ì¹´ë“œ ë Œë”ë§ ì˜¤ë¥˜ ìˆ˜ì •

### v3.5.0 (2025-09-22) - ëª¨ë°”ì¼ ì„±ëŠ¥ ìµœì í™” ë° ë°˜ì‘ì„± ê°œì„ 
- âš¡ **í„°ì¹˜ ìµœì í™”**: 300ms ì§€ì—° ì œê±°, ì¦‰ì‹œ ë°˜ì‘
- ğŸ“± **ëª¨ë°”ì¼ ê°œì„ **: ê¸€ê¼´ í¬ê¸° ë° í„°ì¹˜ ì˜ì—­ ìµœì í™”
- ğŸš€ **ì„±ëŠ¥ í–¥ìƒ**: ë Œë”ë§ ìµœì í™”, ë©”ëª¨ë¦¬ ê´€ë¦¬
- ğŸ¯ **FastClick êµ¬í˜„**: ë„¤ì´í‹°ë¸Œ ì•± ìˆ˜ì¤€ì˜ ë°˜ì‘ì„±

### v3.4.4 (2025-09-18) - ì¤‘ë³µ í•„í„°ë§ ì™„ì „ ì œê±°ë¡œ ê·¼ë³¸ í•´ê²°
- ğŸ¯ **í•µì‹¬ í•´ê²°**: CSV ë¡œë”© ì‹œ ì¤‘ë³µ í•„í„°ë§ì„ ì™„ì „íˆ ì œê±°í•˜ì—¬ ëª¨ë“  ì¤‘ë³µ ë°ì´í„°ë¥¼ ë¡œì»¬ì— ìœ ì§€
- ğŸ”§ **buildTypeFromCsv ìˆ˜ì •**: ì¤‘ë³µ ê²€ì‚¬ ë¡œì§ ì œê±°, ëª¨ë“  í”Œë ˆì´ì–´ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€
- ğŸ“Š **ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œ ë…ë¦½**: ë°ì´í„° ë¡œë”©ê³¼ ì¤‘ë³µ ì œê±°ë¥¼ ì™„ì „íˆ ë¶„ë¦¬
- ğŸ” **ì •í™•í•œ ì¤‘ë³µ ê²€ì¶œ**: ì´ì œ ì‹¤ì œ ì¤‘ë³µ ë°ì´í„°ê°€ ë¡œì»¬ì— ìœ ì§€ë˜ì–´ ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™
- âš¡ **ê·¼ë³¸ ì›ì¸ í•´ê²°**: ë°ì´í„° ë¡œë”© ì‹œì ê³¼ ì¤‘ë³µ ì œê±° ì‹œì ì˜ ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²°

### v3.4.3 (2025-09-18) - ë¡œì»¬ ì¤‘ë³µ ê²€ì¶œ ì‹œ ì‹¤ì œ ì‚­ì œ ì²˜ë¦¬ (ì‹¤íŒ¨)
- âŒ **ì‹¤íŒ¨**: ë¡œì»¬ ë°ì´í„°ì— ì´ë¯¸ ì¤‘ë³µì´ ì—†ì–´ì„œ ê²€ì¶œ ë¶ˆê°€
- ğŸ”§ **ì‹œë„**: buildTypeFromCsvì—ì„œ ì˜ëª»ëœ ì¤‘ë³µ í•„í„°ë§ ìˆ˜ì •
- ğŸ“Š **ë¬¸ì œ**: table+name+seat ê¸°ì¤€ ì²´í¬ë¡œë„ ì—¬ì „íˆ ë¡œë”© ì‹œì ì—ì„œ í•„í„°ë§ ë°œìƒ
- ğŸ” **ì§„ë‹¨**: ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œ ì‹¤í–‰ ì‹œì ì—ëŠ” ì´ë¯¸ ì¤‘ë³µì´ ì œê±°ëœ ìƒíƒœ

### v3.3.7 (2025-09-18) - Google Sheets ì›ë³¸ ë°ì´í„° ì§ì ‘ ì ‘ê·¼
- ğŸ¯ **ì›ë³¸ ë°ì´í„° ì ‘ê·¼**: ê°€ê³µëœ ë¡œì»¬ ë°ì´í„°ê°€ ì•„ë‹Œ Google Sheets ì›ë³¸ ë°ì´í„° ì§ì ‘ ê°€ì ¸ì˜¤ê¸°
- ğŸ” **ì§„ì§œ ì¤‘ë³µ ê²€ì¶œ**: santa, Villain02, wolfking ë“± ì‹¤ì œ ì¤‘ë³µ í”Œë ˆì´ì–´ ì •í™•íˆ ì°¾ê¸°
- âš¡ **getAllPlayers API**: Apps Scriptë¥¼ í†µí•´ ì‹œíŠ¸ì˜ ëª¨ë“  í”Œë ˆì´ì–´ ë°ì´í„° ìš”ì²­
- ğŸ› **ê·¼ë³¸ ë¬¸ì œ í•´ê²°**: ë¡œì»¬ ë°ì´í„°ëŠ” ì´ë¯¸ ì¤‘ë³µ ì œê±°ëœ ìƒíƒœë¼ì„œ ê²€ì¶œ ë¶ˆê°€ëŠ¥í–ˆìŒ

### v3.3.6 (2025-09-18) - ì¢Œì„ ì—†ëŠ” ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì¶œ ë¡œì§ ê°œì„ 
- ğŸ¯ **ì§„ì§œ ì¤‘ë³µ ë°œê²¬**: ì¢Œì„ì´ ìë™ í• ë‹¹ëœ ì¤‘ë³µ í”Œë ˆì´ì–´ ì •í™•íˆ ê²€ì¶œ
- ğŸ” **ì´ì¤‘ ê²€ì‚¬ ë°©ì‹**: ì¢Œì„ ìœ ë¬´ì— ë”°ë¥¸ ì°¨ë³„í™”ëœ ì¤‘ë³µ ê²€ì‚¬
- âš¡ **ì‹¤ì œ ë°ì´í„° ë¶„ì„**: ì›ë³¸ ë°ì´í„°ì™€ ê°€ê³µëœ ë°ì´í„° êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬
- ğŸ› **123ëª… vs 144ëª… ë¬¸ì œ í•´ê²°**: ì‹¤ì œ ì¤‘ë³µ ì œê±°ë¡œ ì •í™•í•œ ë°ì´í„° í™•ë³´

### v3.3.5 (2025-09-18) - ì¤‘ë³µ í”Œë ˆì´ì–´ ë°ì´í„° ë¡œë”© ë¡œì§ ê°œì„ 
- ğŸ” **ë°ì´í„° ì†ŒìŠ¤ ë¶„ì„**: ëª¨ë“  ê°€ëŠ¥í•œ í”Œë ˆì´ì–´ ë°ì´í„° ì†ŒìŠ¤ í™•ì¸
- ğŸ“Š **ì™„ì „í•œ ë°ì´í„° ìˆ˜ì§‘**: ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ëˆ„ë½ëœ í”Œë ˆì´ì–´ ë°ì´í„° ì·¨í•©
- ğŸ› **123ëª… vs 144ëª… ë¶ˆì¼ì¹˜ í•´ê²°**: ì „ì²´ í”Œë ˆì´ì–´ ë°ì´í„° ì •í™•íˆ ë¡œë“œ
- ğŸ“ **ìƒì„¸ ë””ë²„ê¹…**: ê° ë°ì´í„° ì†ŒìŠ¤ë³„ í”Œë ˆì´ì–´ ìˆ˜ ì¶œë ¥

### v3.3.4 (2025-09-18) - ì¤‘ë³µ í”Œë ˆì´ì–´ ì œê±° ëª¨ë“ˆ êµ¬ë¬¸ ì˜¤ë¥˜ ìˆ˜ì •
- ğŸ› **êµ¬ë¬¸ ì˜¤ë¥˜ ìˆ˜ì •**: duplicate-remover.js 101ë²ˆì§¸ ì¤„ êµ¬ë¬¸ ì˜¤ë¥˜ í•´ê²°
- ğŸ”§ **ëª¨ë“ˆ ì•ˆì •ì„±**: ì¤‘ë³µ ì œê±° ë¡œì§ ì •ìƒ ì‹¤í–‰ ë³´ì¥
- ğŸ§¹ **ìë™ ì‹¤í–‰**: í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì‹œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìë™ ì œê±°
- ğŸ“ **í…ŒìŠ¤íŠ¸ ê°•í™”**: quick_test.jsì— ì¤‘ë³µ ì œê±° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ì¶”ê°€

### v3.3.3 (2025-09-17) - ìœ ì—°í•œ ì¹© ì²˜ë¦¬ ì‹œìŠ¤í…œ
- ğŸ’° **ì¹© ì´ˆê³¼ í—ˆìš©**: ë³´ìœ  ì¹©ë³´ë‹¤ ë§ì€ ë² íŒ…ë„ ê°€ëŠ¥ (ê²½ê³ ë§Œ í‘œì‹œ)
- ğŸ”´ **ë§ˆì´ë„ˆìŠ¤ ì¹©**: ìŒìˆ˜ ì¹© ìƒíƒœ í—ˆìš© ë° ì‹œê°ì  í‘œì‹œ (ë¹¨ê°„ìƒ‰)
- ğŸ¯ **ìˆ˜ë™ ì¡°ì • ê°€ëŠ¥**: ì¹© ìˆ˜ì • ê¸°ëŠ¥ìœ¼ë¡œ ì–¸ì œë“  ì¡°ì • ê°€ëŠ¥
- âš ï¸ **ê²½ê³  ì‹œìŠ¤í…œ**: ì¹© ì´ˆê³¼/ë§ˆì´ë„ˆìŠ¤ ì‹œ ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ì§„í–‰

### v3.3.2 (2025-09-17) - ì¹© ì´ˆê³¼ ë² íŒ… ë°©ì§€ ì‹œìŠ¤í…œ (deprecated)
- ~~ë² íŒ… ì°¨ë‹¨~~: v3.3.3ì—ì„œ ì œê±°ë¨

### v3.3.1 (2025-09-17) - ì¹© ì´ˆê³¼ ë² íŒ… ìë™ ì˜¬ì¸ ì²˜ë¦¬ (deprecated)
- ~~ìë™ ì˜¬ì¸ ë³€í™˜~~: v3.3.2ì—ì„œ ì œê±°ë¨

### v3.3.0 (2025-09-17) - ì¹© ìˆ˜ì • ì‹œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìƒì„± ë¬¸ì œ í•´ê²°
- ğŸ”§ **updatePlayerChips ê°œì„ **: ê¸°ì¡´ í”Œë ˆì´ì–´ ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€í•˜ëŠ” ë¡œì§ êµ¬í˜„
- ğŸ§¹ **ìë™ ì¤‘ë³µ ì œê±°**: ì¹© ìˆ˜ì • ì‹œì—ë„ ì¤‘ë³µ ì œê±° ë¡œì§ ìë™ ì‹¤í–‰
- ğŸ“¦ **Apps Script v65**: ì¹© ìˆ˜ì • ê´€ë ¨ ëª¨ë“  ì¤‘ë³µ ë¬¸ì œ í•´ê²°
- âœ… **ë¬¸ì œ í•´ê²°**: ì¹© ìˆ˜ì •ìœ¼ë¡œ ì¸í•œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìƒì„± ì™„ì „ ë°©ì§€

### v3.2.9 (2025-09-17) - ì¤‘ë³µ ì œê±° ì•„í‚¤í…ì²˜ ê°œì„ 
- ğŸ—‘ï¸ **ë³„ë„ ë²„íŠ¼ ì œê±°**: ì¤‘ë³µ ì œê±° ë²„íŠ¼ì„ ì‚­ì œí•˜ê³  ìë™ ì²˜ë¦¬ë¡œ ë³€ê²½
- âš¡ **ì¼ê´„ ë“±ë¡ í†µí•©**: ì¼ê´„ ë“±ë¡ ì‹œ ë§ˆì§€ë§‰ì— ì¤‘ë³µ ì œê±° ìë™ ì‹¤í–‰
- ğŸ“¦ **Apps Script v64**: ì¤‘ë³µ ì œê±° ë¡œì§ì„ batchUpdatePlayers ëì—ì„œ ì‹¤í–‰
- ğŸ”„ **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **: ë³„ë„ ì•¡ì…˜ ì—†ì´ ìë™ìœ¼ë¡œ ì¤‘ë³µ ì²˜ë¦¬

### v3.5.1 (2025-09-22) - ê¸´ê¸‰ ë²„ê·¸ ìˆ˜ì •
- ğŸ› **ëª¨ë°”ì¼ UI ìˆ˜ì •**: ê³¼ë„í•œ í°íŠ¸ í¬ê¸° ë¬¸ì œ í•´ê²°
- ğŸ“œ **ìŠ¤í¬ë¡¤ ë³µêµ¬**: í„°ì¹˜ ì´ë²¤íŠ¸ê°€ ìŠ¤í¬ë¡¤ì„ ë§‰ëŠ” ë¬¸ì œ ìˆ˜ì •
- ğŸ¯ **ë¦¬ë²„ ì¹´ë“œ ë²„ê·¸**: í„´ì—ì„œ ë¦¬ë²„ ì¹´ë“œ ì¤‘ë³µ ìš”ì²­ ë¬¸ì œ í•´ê²°
- ğŸƒ **ì¹´ë“œ ë Œë”ë§**: A, K, 2, 3 ë“± ì¹´ë“œ í‘œì‹œ ì˜¤ë¥˜ ìˆ˜ì •

### v3.5.0 (2025-09-22) - ëŒ€ê·œëª¨ ì„±ëŠ¥ ìµœì í™” ë° ëª¨ë°”ì¼ ê°œì„ 
- ğŸ”’ **ë³´ì•ˆ ê°•í™”**: Google Apps Script í”„ë¡ì‹œë¡œ API í‚¤ ì„œë²„ì‚¬ì´ë“œ ë³´í˜¸
- âš¡ **í„°ì¹˜ ìµœì í™”**: 300ms ì§€ì—° ì œê±°, ì¦‰ì‹œ ë°˜ì‘ FastClick êµ¬í˜„
- ğŸ§¹ **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ìë™ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜, WeakMap ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ê´€ë¦¬
- ğŸ“± **ëª¨ë°”ì¼ ì œìŠ¤ì²˜**: ìŠ¤ì™€ì´í”„, í•€ì¹˜ì¤Œ, ë¡±í”„ë ˆìŠ¤ ì œìŠ¤ì²˜ ì¸ì‹
- ğŸ”Š **í–…í‹± í”¼ë“œë°±**: ëª¨ë“  í„°ì¹˜ ì¸í„°ë™ì…˜ì— ì§„ë™ í”¼ë“œë°± ì¶”ê°€
- ğŸš€ **ë Œë”ë§ ìµœì í™”**: requestAnimationFrame ê¸°ë°˜ ë°°ì¹˜ ë Œë”ë§
- ğŸ“Š **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**: ì‹¤ì‹œê°„ ë©”ëª¨ë¦¬/FPS ì¶”ì  ë° ìë™ ìµœì í™”
- ğŸ”„ **ê°€ìƒ ìŠ¤í¬ë¡¤**: ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ë¥¼ ìœ„í•œ ê°€ìƒ DOM êµ¬í˜„
- ğŸ’¾ **ë°ì´í„° ì •ë¦¬**: ì•¡ì…˜ ë¡œê·¸ 100ê°œ ì œí•œ, ìë™ ì˜¤ë˜ëœ ë°ì´í„° ì‚­ì œ
- âš™ï¸ **ë””ë°”ìš´ì‹±/ìŠ¤ë¡œí‹€ë§**: ì…ë ¥ ì´ë²¤íŠ¸ ìµœì í™”ë¡œ CPU ë¶€í•˜ ê°ì†Œ

### v3.2.8 (2025-09-17) - ì¤‘ë³µ í”Œë ˆì´ì–´ ê°ì§€ ë° ì œê±° ì‹œìŠ¤í…œ
- ğŸ§¹ **ì¤‘ë³µ ì œê±° ì‹œìŠ¤í…œ**: Apps Script v63ì— removeDuplicatePlayers() í•¨ìˆ˜ ì¶”ê°€
- ğŸ”„ **ìë™ ì¤‘ë³µ ì œê±°**: í”Œë ˆì´ì–´ ì¶”ê°€/ìˆ˜ì • ì‹œ ìë™ìœ¼ë¡œ ì¤‘ë³µ ê°ì§€ ë° ì œê±°
- ğŸ› ï¸ **í”„ë¡ íŠ¸ì—”ë“œ ì¤‘ë³µ ì œê±°**: ê´€ë¦¬ ëª¨ë‹¬ì— ì¤‘ë³µ ì œê±° ë²„íŠ¼ ì¶”ê°€
- ğŸš« **ìë™ ë“±ë¡ ì œê±°**: ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•´ ìë™ í”Œë ˆì´ì–´ ë“±ë¡ ë¡œì§ ë¹„í™œì„±í™”
- ğŸ” **ê°•í™”ëœ ê²€ì¦**: í…Œì´ë¸”_í”Œë ˆì´ì–´ ì¡°í•©ìœ¼ë¡œ ì •í™•í•œ ì¤‘ë³µ ê°ì§€

### v3.2.7 (2025-09-17) - Apps Script ì‚­ì œ ë¡œì§ ê°•í™”
- ğŸ” **ì‚­ì œ ë””ë²„ê¹… ê°•í™”**: Apps Scriptì— ìƒì„¸ ë¡œê·¸ ë° ë””ë²„ê¹… ì •ë³´ ì¶”ê°€
- ğŸ› ï¸ **ì‚­ì œ ì¡°ê±´ ì™„í™”**: STATUS ì¡°ê±´ ì œê±°ë¡œ ì‚­ì œ ì²˜ë¦¬ ê°œì„ 
- ğŸ› **ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ **: ìƒì„¸í•œ ì˜¤ë¥˜ ì •ë³´ì™€ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ ì œê³µ
- ğŸ“Š **FormData ë¡œê¹…**: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì „ì†¡ë˜ëŠ” ë°ì´í„° ìƒì„¸ í™•ì¸

### v3.2.6 (2025-09-17) - ì‹œíŠ¸ ì •ë ¬ ë° ì‚­ì œ ë¡œì§ ê°œì„ 
- ğŸ”„ **ì‹œíŠ¸ ì •ë ¬ ë²„íŠ¼ ì œê±°**: ì¼ê´„ ë“±ë¡ ì‹œì—ë§Œ ìë™ ì •ë ¬
- ğŸš® **ì‚­ì œ ë¡œì§ ê°œì„ **: í”Œë ˆì´ì–´ ì‚­ì œ ì²˜ë¦¬ ë²„ê·¸ ìˆ˜ì •
- ğŸ› ï¸ **Apps Script ìµœì í™”**: sortSheet ì´ì¤‘ í˜¸ì¶œ ë²„ê·¸ ìˆ˜ì •
- ğŸ” **ë””ë²„ê·¸ ë¡œê·¸ í†µì¼**: ëª¨ë“  ì½˜ì†” ë¡œê·¸ v3.2.6ìœ¼ë¡œ í†µì¼

### v3.2.5 (2025-09-17) - ì •ë ¬ ê¸°ì¤€ ìµœì í™”
- ğŸ¯ **ì •ë ¬ ê¸°ì¤€ ë‹¨ìˆœí™”**: Table(í…Œì´ë¸”ëª…) > Seat(ì¢Œì„ë²ˆí˜¸) ìˆœ
- ğŸ“¦ **í…Œì´ë¸”ë³„ ê·¸ë£¹í•‘**: ê°™ì€ í…Œì´ë¸” í”Œë ˆì´ì–´ë“¤ì´ í•¨ê»˜ í‘œì‹œ
- ğŸ”¢ **ì¢Œì„ ìˆœì„œ ë³´ì¥**: ì¢Œì„ ë²ˆí˜¸ìˆœìœ¼ë¡œ ì •ë ¬

### v3.2.4 (2025-09-17) - Google Sheets ìë™ ì •ë ¬
- ğŸ”„ **ì‹œíŠ¸ ìë™ ì •ë ¬**: ì¼ê´„ ë“±ë¡ ì‹œ ìë™ìœ¼ë¡œ ì‹œíŠ¸ ì •ë ¬
- ğŸ†• **ì •ë ¬ ë²„íŠ¼ ì¶”ê°€**: ë³„ë„ë¡œ ì‹œíŠ¸ë§Œ ì •ë ¬ ê°€ëŠ¥
- ğŸ“Š **Apps Script ì—…ë°ì´íŠ¸**: sortTypeSheet í•¨ìˆ˜ ì¶”ê°€

### v3.2.3 (2025-09-17) - ë””ë²„ê·µ ë° ì•ˆì •ì„± ê°œì„ 
- ğŸ” **ë””ë²„ê·µ ë¡œê·¸ ê°œì„ **: ëª¨ë“  ë¡œê·¸ë¥¼ v3.2.3ìœ¼ë¡œ í†µì¼
- ğŸ”„ **ìºì‹œ ë²„ìŠ¤íŒ… ê°•í™”**: ëª¨ë“  JS íŒŒì¼ ë²„ì „ í†µì¼
- ğŸ¤ **BatchProcessor ì œê±°**: ì¼ê´„ ë“±ë¡ ì‹œ ì§ì ‘ ì„œë²„ í†µì‹ 
- ğŸ“Š **Google Sheets ë™ê¸°í™” ë¬¸ì œ ë¶„ì„**

### v3.2.2 (2025-09-17) - ì„±ëŠ¥ ìµœì í™”
- ğŸš€ **ì‚­ì œ ë¡œì§ ìµœì í™”**: ë¡œì»¬ ì „ìš© ì‚­ì œë¡œ ì¦‰ì‹œ ì²˜ë¦¬
- ğŸ”„ **ì„œë²„ ë™ê¸°í™” ê°œì„ **: ì¼ê´„ ë“±ë¡ ì‹œì—ë§Œ ì„œë²„ í†µì‹ 
- ğŸ’¡ **UI í”¼ë“œë°± ê°•í™”**: ë¯¸ë“±ë¡ ë³€ê²½ì‚¬í•­ ëª…í™•í•œ í‘œì‹œ
- âš¡ **ì—°ì† ì‚­ì œ ì„±ëŠ¥**: ë‹¤ìˆ˜ ì‚­ì œ ì‘ì—… ì‹œ ì§€ì—° ì—†ì´ ì²˜ë¦¬

### v3.2.1 (2025-09-17) - ë²„ê·¸ ìˆ˜ì •
- ğŸ› **í”Œë ˆì´ì–´ ì‚­ì œ ë¡œì§ ìˆ˜ì •**: ê´€ë¦¬ ì„¤ì •ì—ì„œ í”Œë ˆì´ì–´ ì‚­ì œ ê¸°ëŠ¥ ë³µêµ¬
- ğŸ”§ **í•¨ìˆ˜ í˜¸ì¶œ ìˆœì„œ ê°œì„ **: onManagementTableSelected ìš°ì„  í˜¸ì¶œ
- âš¡ **ì´ë²¤íŠ¸ ì²˜ë¦¬ ìµœì í™”**: ì¸ë¼ì¸ onclickìœ¼ë¡œ ì‚­ì œ ë²„íŠ¼ ì§ì ‘ ì²˜ë¦¬

### v3.2.0 (2025-09-17) - Phase 3: ëª¨ë°”ì¼ ìµœì í™” ì™„ì„±
- âœ… **í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤**: 44x44px ìµœì†Œ í¬ê¸°, í„°ì¹˜ ì‘ë‹µ ì‹œê°„ < 50ms
- âœ… **ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜**: ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„ë¡œ ì‹¤í–‰ì·¨ì†Œ
- âœ… **ë¡±í”„ë ˆìŠ¤ ë©”ë‰´**: ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì‹œìŠ¤í…œ (500ms ì§€ì—°)
- âœ… **í–…í‹± í”¼ë“œë°±**: ì§„ë™ APIë¡œ í„°ì¹˜ í”¼ë“œë°± ì œê³µ
- âœ… **ê°€ìƒ ìŠ¤í¬ë¡¤**: 1000ê°œ+ ë¦¬ìŠ¤íŠ¸ ì„±ëŠ¥ ìµœì í™”
- âœ… **ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ**: IndexedDB ê¸°ë°˜ ë¡œì»¬ ì €ì¥
- âœ… **ìë™ ë™ê¸°í™”**: ì˜¨ë¼ì¸ ë³µêµ¬ ì‹œ ìë™ ë°ì´í„° ë™ê¸°í™”
- âœ… **ë©”ëª¨ë¦¬ ê´€ë¦¬**: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ë° ìë™ ì •ë¦¬

### v3.1.0 (2025-01-17) - Phase 2: ê¸°ëŠ¥ë³„ ì¦‰ì‹œ ì‹¤í–‰
- âœ… **ë”ë¸”íƒ­ ì‹œìŠ¤í…œ**: ìœ„í—˜í•œ ì‘ì—… ë³´í˜¸ (2ì´ˆ íƒ€ì´ë¨¸)
- âœ… **íŠ¸ëœì­ì…˜ ë°°ì¹˜**: ì¼ê´„ ì‘ì—… ì›ìì„± ë³´ì¥
- âœ… **ìë™ ë¡¤ë°±**: ì‹¤íŒ¨ ì‹œ ëª¨ë“  ì‘ì—… ìë™ ë³µì›
- âœ… **API ìµœì í™”**: ë°°ì¹˜ í˜¸ì¶œë¡œ ì„±ëŠ¥ í–¥ìƒ
- âœ… **íƒ€ì´ë¨¸ ê´€ë¦¬**: ì¶©ëŒ ë°©ì§€ ì‹œìŠ¤í…œ

### v3.0.0 (2025-01-17) - ëª¨ë°”ì¼ ìµœì í™” Phase 1
- âœ… **confirm íŒì—… ì œê±°**: ëª¨ë“  ì‘ì—… ì¦‰ì‹œ ì‹¤í–‰
- âœ… **ActionHistory ì‹œìŠ¤í…œ**: ì‘ì—… ì´ë ¥ ê´€ë¦¬ ë° ì‹¤í–‰ì·¨ì†Œ
- âœ… **ìŠ¤ë‚µë°” UI**: ëª¨ë°”ì¼ ì¹œí™”ì  í”¼ë“œë°± ì‹œìŠ¤í…œ
- âœ… **ë©”ëª¨ë¦¬ ìµœì í™”**: íˆìŠ¤í† ë¦¬ 20ê°œ ì œí•œ, WeakMap ì‚¬ìš©
- âœ… **ë¹ ë¥¸ ì‘ë‹µ**: ëª¨ë“  ì‘ì—… 200ms ì´ë‚´ ì™„ë£Œ

### v2.29.0 (2025-09-16)
- 10ê°œ ì‹œíŠ¸ ê³ ì • í”Œë ˆì´ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ
- ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°
- í¬ì»¤ í¬ì§€ì…˜ ìˆœì„œëŒ€ë¡œ ìë™ í”Œë ˆì´ì–´ ì§„í–‰

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. Google Sheets ì„¤ì •
```bash
1. í…œí”Œë¦¿ ì‹œíŠ¸ ë³µì‚¬
2. Apps Script ì—´ê¸° (í™•ì¥ í”„ë¡œê·¸ë¨ â†’ Apps Script)
3. Code_v63_InOut.gs ë¶™ì—¬ë„£ê¸°
4. ì›¹ ì•±ìœ¼ë¡œ ë°°í¬
```

### 2. í”„ë¡ íŠ¸ì—”ë“œ ì„¤ì •
```javascript
// ì„¤ì •(âš™ï¸) ë©”ë‰´ì—ì„œ Apps Script URL ì…ë ¥
// ë˜ëŠ” index.htmlì—ì„œ ì§ì ‘ ì„¤ì •
const APPS_SCRIPT_URL = 'YOUR_DEPLOYMENT_URL';
```

### 3. ì‹¤í–‰
```bash
# Live Server ë˜ëŠ”
python -m http.server 8000
```

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

- **Frontend**: Vanilla JavaScript, Tailwind CSS
- **Backend**: Google Apps Script v63
- **Database**: Google Sheets
- **API**: Gemini Vision API (ì¹© ë¶„ì„)

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
virtual_data/
â”œâ”€â”€ index.html                    # ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ (v3.2.5)
â”œâ”€â”€ action-history.js             # ActionHistory ì‹œìŠ¤í…œ (Phase 1)
â”œâ”€â”€ double-tap-handler.js         # ë”ë¸”íƒ­ í•¸ë“¤ëŸ¬ (Phase 2)
â”œâ”€â”€ batch-processor.js            # ë°°ì¹˜ ì²˜ë¦¬ ì‹œìŠ¤í…œ (Phase 2)
â”œâ”€â”€ mobile-optimizer.js           # ëª¨ë°”ì¼ ìµœì í™” (Phase 3)
â”œâ”€â”€ virtual-scroll.js             # ê°€ìƒ ìŠ¤í¬ë¡¤ ì‹œìŠ¤í…œ (Phase 3)
â”œâ”€â”€ offline-storage.js            # ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ (Phase 3)
â”œâ”€â”€ chip-analysis-module.js       # ì¹© ë¶„ì„ ëª¨ë“ˆ
â”œâ”€â”€ table-management-v59.js       # í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“ˆ
â”œâ”€â”€ apps-script/
â”‚   â””â”€â”€ Code_v63_InOut.gs        # Google Apps Script ë°±ì—”ë“œ
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ DEVELOPMENT.md           # ê°œë°œ ê³„íš
â”‚   â”œâ”€â”€ MOBILE_POPUP_REMOVAL_PLAN.md  # ëª¨ë°”ì¼ ìµœì í™” ê³„íš
â”‚   â””â”€â”€ fix.md                   # ì•Œë ¤ì§„ ì´ìŠˆ ëª©ë¡
â””â”€â”€ README.md                     # í”„ë¡œì íŠ¸ ë¬¸ì„œ
```

## ğŸ“Š Google Sheets êµ¬ì¡°

### Type ì‹œíŠ¸ (í”Œë ˆì´ì–´ ê´€ë¦¬)
| ì—´ | í•„ë“œ | ì„¤ëª… |
|---|---|---|
| A | Camera Preset | ì¹´ë©”ë¼ í”„ë¦¬ì…‹ |
| B | Player | í”Œë ˆì´ì–´ ì´ë¦„ |
| C | Table | í…Œì´ë¸” ì´ë¦„ |
| D | Notable | ì£¼ëª©í•  í”Œë ˆì´ì–´ |
| E | Chips | í˜„ì¬ ì¹© |
| F | UpdatedAt | ì—…ë°ì´íŠ¸ ì‹œê°„ |
| G | Seat | ì¢Œì„ ë²ˆí˜¸ |
| H | Status | IN/OUT ìƒíƒœ |
| I | pic | í”„ë¡œí•„ ì‚¬ì§„ |
| J | Country | êµ­ê°€ |
| K | CountryVerified | êµ­ê°€ í™•ì¸ ì—¬ë¶€ |

### Index ì‹œíŠ¸ (í•¸ë“œ ë©”íƒ€ë°ì´í„°)
| ì—´ | í•„ë“œ | ì„¤ëª… |
|---|---|---|
| A | handNumber | í•¸ë“œ ë²ˆí˜¸ |
| B | startRow | Hand ì‹œíŠ¸ ì‹œì‘ í–‰ |
| C | endRow | Hand ì‹œíŠ¸ ì¢…ë£Œ í–‰ |
| D | handUpdatedAt | í•¸ë“œ ì—…ë°ì´íŠ¸ ì‹œê°„ |
| E-F | handEdit | í¸ì§‘ ì •ë³´ |
| G | label | ê²Œì„ ë ˆì´ë¸” |
| H | table | í…Œì´ë¸” ì´ë¦„ |
| I | tableUpdatedAt | í…Œì´ë¸” ì—…ë°ì´íŠ¸ ì‹œê°„ |
| J-N | Camera | ì¹´ë©”ë¼ ì •ë³´ |
| O-Q | Street/Action | ë§ˆì§€ë§‰ ìŠ¤íŠ¸ë¦¬íŠ¸/ì•¡ì…˜ |
| R | winners | ìŠ¹ì ì •ë³´ |

### Hand ì‹œíŠ¸ (ìƒì„¸ ê¸°ë¡)
| ì—´ | í•„ë“œ | ì„¤ëª… |
|---|---|---|
| A | í–‰ë²ˆí˜¸ | ìˆœë²ˆ |
| B | íƒ€ì… | HAND/PLAYER/EVENT |
| C | ë°ì´í„° | í”Œë ˆì´ì–´ëª…/ì•¡ì…˜ |
| D | ì¢Œì„ | ì¢Œì„ ë²ˆí˜¸ |
| E | 0 | ê³ ì •ê°’ |
| F | ì‹œì‘ì¹© | ì‹œì‘ ì¹© |
| G | ì¢…ë£Œì¹© | ì¢…ë£Œ ì¹© |
| H | ì¹´ë“œ | í•¸ë“œ ì¹´ë“œ |
| I | í¬ì§€ì…˜ | BTN/SB/BB |

## ğŸ”„ ìµœê·¼ ì—…ë°ì´íŠ¸

### v3.5.12 (2025-09-22) - Hand ì‹œíŠ¸ í”Œë ˆì´ì–´ ë©”íƒ€ë°ì´í„° ì¶”ê°€
- ğŸ”§ **í•µì‹¬ ê¸°ëŠ¥ ì¶”ê°€**: Hand ì‹œíŠ¸ ë°ì´í„° ë¡œê¹… ì‹œ í”Œë ˆì´ì–´ ìƒì„¸ ì •ë³´ ì¶”ê°€
  - Jì—´: Keyplayer ì •ë³´ (Type ì‹œíŠ¸ì˜ keyplayer ë˜ëŠ” notable í•„ë“œ)
  - Kì—´: êµ­ê°€ ì •ë³´ (Type ì‹œíŠ¸ì˜ nationality í•„ë“œ)
  - Type ì‹œíŠ¸ í”Œë ˆì´ì–´ ë°ì´í„°ì™€ Hand ì‹œíŠ¸ í”Œë ˆì´ì–´ ìë™ ë§¤ì¹­
  - í”Œë ˆì´ì–´ ë©”íƒ€ë°ì´í„° ëˆ„ë½ ì‹œ ë¹ˆ ê°’ìœ¼ë¡œ ì²˜ë¦¬
  - ë””ë²„ê¹… ë¡œê·¸ ì—…ë°ì´íŠ¸ë¡œ J, Kì—´ ê°’ í™•ì¸ ê°€ëŠ¥

### v3.5.11 (2025-09-22) - í”Œë ˆì´ì–´ ì¢Œì„ ë§¤ì¹­ ë²„ê·¸ ìˆ˜ì •
- ğŸ”§ **í•µì‹¬ ë²„ê·¸ ìˆ˜ì •**: seatNo ë°ì´í„° íƒ€ì… ë¶ˆì¼ì¹˜ ë¬¸ì œ í•´ê²° ("#1" ë¬¸ìì—´ â†’ 1 ìˆ«ì ë³€í™˜)
- ğŸš« **ë¹ˆ ì¢Œì„ í´ë¦­ ê¸°ëŠ¥ ì œê±°**: ì‚¬ìš©ì ìš”ì²­ì— ë”°ë¼ ë¹ˆ ì¢Œì„ ë¹ ë¥¸ ì¶”ê°€ ê¸°ëŠ¥ ì™„ì „ ì‚­ì œ
- ğŸ› **í”Œë ˆì´ì–´ ë¡œë”© ë¬¸ì œ í•´ê²°**: ì¢Œì„ ë§¤ì¹­ ë¡œì§ ìˆ˜ì •ìœ¼ë¡œ í”Œë ˆì´ì–´ ì •ìƒ í‘œì‹œ
- ğŸ” **ë””ë²„ê¹… ê°•í™”**: ìƒì„¸í•œ console.logë¡œ ë°ì´í„° íë¦„ ì¶”ì  ê°€ëŠ¥

### v2.26.2 (2025-09-16)
- âš¡ **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **
  - ìˆ«ì ì…ë ¥(í‚¤íŒ¨ë“œ) ì˜¤ë¥˜ ìˆ˜ì •: ë² íŒ…/ë ˆì´ì¦ˆ ì‹œ í‚¤íŒ¨ë“œ ì •ìƒ ì‘ë™
  - ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ë°”ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°: ì•¡ì…˜ ë²„íŠ¼ í´ë¦­ ì—†ì´ ìŠ¤íŠ¸ë¦¿ë§Œ ì„ íƒí•˜ë©´ ì¦‰ì‹œ ì•¡ì…˜ ì…ë ¥ ê°€ëŠ¥
  - actionPadCurrentAction ì„¤ì • ë¡œì§ ì¶”ê°€ë¡œ ë² íŒ…/ë ˆì´ì¦ˆ êµ¬ë¶„ ì •ìƒ ì‘ë™

### v2.26.1 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - updateSmartCheckCallButton í•¨ìˆ˜ ì •ì˜ ì˜¤ë¥˜ ìˆ˜ì •
  - addActionToLog í•¨ìˆ˜ null ì²´í¬ ì˜¤ë¥˜ ìˆ˜ì •
  - ì•¡ì…˜ íŒ¨ë“œ ì‹œìŠ¤í…œ ì•ˆì •ì„± ê°œì„ 

### v2.26.0 (2025-09-16)
- ğŸš€ **í¬ì§€ì…˜ ê¸°ë°˜ ì•¡ì…˜ ìˆœì„œ ì‹œìŠ¤í…œ êµ¬í˜„**
  - í¬ì»¤ ê·œì¹™ì— ë”°ë¥¸ ìë™ ì•¡ì…˜ ìˆœì„œ ê³„ì‚° (í”„ë¦¬í”Œë: UTGâ†’BTNâ†’SBâ†’BB, í¬ìŠ¤íŠ¸í”Œë: SBâ†’BBâ†’UTGâ†’BTN)
  - ğŸ¤– ìë™ ëª¨ë“œ: ì•¡ì…˜ ìˆœì„œì— ë”°ë¼ ìë™ìœ¼ë¡œ ë‹¤ìŒ í”Œë ˆì´ì–´ í™œì„±í™”
  - ğŸ‘† ìˆ˜ë™ ëª¨ë“œ: ì‚¬ìš©ìê°€ ì§ì ‘ í”Œë ˆì´ì–´ ì„ íƒí•˜ì—¬ ì•¡ì…˜ ì…ë ¥
  - ì•¡ì…˜ í ì‹œê°í™”: í˜„ì¬ ì°¨ë¡€(ğŸ¯), ì™„ë£Œ(âœ…), ëŒ€ê¸°(â³) ìƒíƒœ í‘œì‹œ
  - ìŠ¤ë§ˆíŠ¸ ìŠ¤íŠ¸ë¦¿ ì§„í–‰: ë² íŒ… ë¼ìš´ë“œ ì™„ë£Œ ì‹œ ìë™ìœ¼ë¡œ ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ í™œì„±í™”
  - í”Œë ˆì´ì–´ ìŠ¤í‚µ ê¸°ëŠ¥: íŠ¹ì • í”Œë ˆì´ì–´ ê±´ë„ˆë›°ê¸° ê°€ëŠ¥
  - ì•¡ì…˜ ëª¨ë“œ ì‹¤ì‹œê°„ ì „í™˜: ì–¸ì œë“ ì§€ ìë™/ìˆ˜ë™ ëª¨ë“œ ë³€ê²½ ê°€ëŠ¥

### v2.25.3 (2025-09-16)
- ğŸ¯ **í…Œì´ë¸” ì„ íƒ ì›Œí¬í”Œë¡œìš° ìµœì í™”**
  - ê´€ë¦¬ ë²„íŠ¼ì—ì„œ "ğŸ“‹ í…Œì´ë¸” ê´€ë¦¬" â†’ "ğŸ¯ í…Œì´ë¸” ì„ íƒ"ìœ¼ë¡œ ë³€ê²½
  - ì¤‘ê°„ í…Œì´ë¸” ì„ íƒ ë‹¨ê³„ ì œê±°ë¡œ ì§ê´€ì ì¸ ì‚¬ìš©ì ê²½í—˜ ì œê³µ
  - í…Œì´ë¸” ì„ íƒ í›„ ë°”ë¡œ í”Œë ˆì´ì–´ ê´€ë¦¬ í™”ë©´ í‘œì‹œ
  - ì„ íƒëœ í…Œì´ë¸” ì •ë³´ í•­ìƒ í‘œì‹œ + "ë³€ê²½" ë²„íŠ¼ìœ¼ë¡œ ì¬ì„ íƒ ê°€ëŠ¥
  - ë©”ì¸ ëŒ€ì‹œë³´ë“œì™€ ë™ì¼í•œ í…Œì´ë¸” ì„ íƒ ë¡œì§ ì‚¬ìš©

### v2.25.2 (2025-09-16)
- ğŸ”§ **SB/BB í‘œì‹œ ë²„ê·¸ ìˆ˜ì •**
  - SB/BB ë²„íŠ¼ì—ì„œ "SB:", "BB:" í…ìŠ¤íŠ¸ ë¼ë²¨ ì œê±°
  - ì‹¤ì œ ìˆ˜ì¹˜ë§Œ í‘œì‹œí•˜ë„ë¡ ê°œì„  (ì˜ˆ: "100" ëŒ€ì‹  "SB: 100")
  - data-purpose ì†ì„± ì¶”ê°€ë¡œ ë²„íŠ¼ ì—…ë°ì´íŠ¸ ë¡œì§ ìˆ˜ì •
  - ì´ˆê¸°í™” ì‹œ ì €ì¥ëœ SB/BB ê°’ ì •ìƒ í‘œì‹œ
  - updateBlindButtons() í•¨ìˆ˜ë¡œ ë²„íŠ¼ ìƒíƒœ ê´€ë¦¬ í†µí•©

### v2.25.1 (2025-09-16)
- ğŸš€ **í…Œì´ë¸” ê´€ë¦¬ ì›Œí¬í”Œë¡œìš° ë‹¨ì¶•**
  - í…Œì´ë¸” ê´€ë¦¬ ë²„íŠ¼ í´ë¦­ ì‹œ ë°”ë¡œ í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ ì‹¤í–‰
  - ì¤‘ê°„ ë‹¨ê³„ ì œê±°ë¡œ ë”ìš± ì§ê´€ì ì¸ ì‚¬ìš©ì ê²½í—˜
  - í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œ í”Œë˜ê·¸ë¡œ ëª¨ë“œ êµ¬ë¶„ ì²˜ë¦¬
  - ì„ íƒ í›„ ìë™ìœ¼ë¡œ í”Œë ˆì´ì–´ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ì „í™˜

### v2.25.0 (2025-09-16)
- ğŸ”§ **í…Œì´ë¸” ì„ íƒ ì‹œìŠ¤í…œ í†µí•©**
  - ê´€ë¦¬ ëª¨ë‹¬ê³¼ ë©”ì¸ ëŒ€ì‹œë³´ë“œ í…Œì´ë¸” ì„ íƒ ë¡œì§ í†µí•©
  - ê´€ë¦¬ ëª¨ë‹¬ì—ì„œë„ ì¦‰ì‹œ í…Œì´ë¸” ì„ íƒ ê°€ëŠ¥ (ë¡œë”© ê³¼ì • ì œê±°)
  - í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ì„ ê³µìœ í•˜ì—¬ ì¼ê´€ëœ ì‚¬ìš©ì ê²½í—˜ ì œê³µ
  - ê¸°ì¡´ "ğŸ“‹ í…Œì´ë¸” í˜¸ì¶œ" ë²„íŠ¼ì„ "ğŸ¯ í…Œì´ë¸” ì„ íƒ" ë²„íŠ¼ìœ¼ë¡œ êµì²´
  - ë©”ì¸ ëŒ€ì‹œë³´ë“œì˜ í…Œì´ë¸” ì„ íƒ ì‹œ ê´€ë¦¬ ëª¨ë‹¬ ìë™ ì—°ë™

### v2.24.0 (2025-09-16)
- ğŸ”§ **ì¤‘ìš” ë²„ê·¸ ìˆ˜ì •**
  - í”„ë¡ íŠ¸ì—”ë“œ IN/OUT ìƒíƒœ í•„í„°ë§ ì¶”ê°€
  - ì‚­ì œëœ í”Œë ˆì´ì–´(OUT ìƒíƒœ) í‘œì‹œ ë°©ì§€
  - Hì—´(Status) ê°’ì´ ë¹„ì–´ìˆìœ¼ë©´ INìœ¼ë¡œ ê¸°ë³¸ ì²˜ë¦¬
  - buildTypeFromCsv í•¨ìˆ˜ì— ìƒì„¸ ë¡œê¹… ì¶”ê°€
  - Apps Scriptì™€ í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ì¼ê´€ì„± í™•ë³´

### v2.23.0 (2025-09-16)
- ğŸ” **ë””ë²„ê¹… ë° ì˜¤ë¥˜ ì¶”ì  ê°•í™”**
  - loadTypeSheet ë¯¸ì •ì˜ í•¨ìˆ˜ ì˜¤ë¥˜ ì™„ì „ ìˆ˜ì •
  - ì¼ê´„ ë“±ë¡ ê³¼ì • ìƒì„¸ ë¡œê¹… ì¶”ê°€
  - ë‹¨ê³„ë³„ ì˜¤ë¥˜ ì¶”ì  ë° ë¶„ì„ ì‹œìŠ¤í…œ
  - ë„¤íŠ¸ì›Œí¬, JSON íŒŒì‹±, Apps Script ì˜¤ë¥˜ ë³„ë„ ì²˜ë¦¬
  - CSV ë°ì´í„° ë¡œë“œ ê³¼ì • ëª¨ë‹ˆí„°ë§

### v2.22.0 (2025-09-16)
- ğŸ“– **ì‚¬ìš©ì ê°€ì´ë“œ**
  - Apps Script ì¬ë°°í¬ ì•ˆë‚´ ë©”ì‹œì§€ ì¶”ê°€
  - "Unknown action: batchUpdate" ì˜¤ë¥˜ í•´ê²° ë°©ë²• ì œê³µ
  - ë‹¨ê³„ë³„ ì¬ë°°í¬ ìˆœì„œ ì•ˆë‚´
  - ì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ë¡œ ì‚¬ìš©ì í˜¼ë€ ìµœì†Œí™”

### v2.21.0 (2025-09-16)
- ğŸ¨ **UI/UX ê°œì„ **
  - Apps Script URL ì €ì¥ ì‹œ ì‹œê°ì  í”¼ë“œë°± ê°•í™”
  - í˜„ì¬ ì €ì¥ëœ URL ëª…í™•í•˜ê²Œ í‘œì‹œ (ë…¸ë€ìƒ‰/ë…¹ìƒ‰ êµ¬ë¶„)
  - ì €ì¥ ì„±ê³µ ì‹œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½ ë° ë©”ì‹œì§€ í‘œì‹œ
  - ì…ë ¥ í•„ë“œ í”Œë ˆì´ìŠ¤í™€ë” ë™ì  ì—…ë°ì´íŠ¸
  - ì¤‘ë³µ URL ì…ë ¥ ë°©ì§€ ë° ì•ˆë‚´ ë©”ì‹œì§€

### v2.20.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - Apps Script URL ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¬¸ì œ í•´ê²°
  - setTimeoutìœ¼ë¡œ DOM ë¡œë“œ ë³´ì¥
  - ë””ë²„ê¹… ì½˜ì†” ë¡œê·¸ ì¶”ê°€
  - í…ŒìŠ¤íŠ¸ íŒŒì¼ ì œê³µ (test-url-save.html)

### v2.19.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - Apps Script FormData íŒŒì‹± ë¬¸ì œ í•´ê²°
  - batchUpdate ì•¡ì…˜ "Unknown action" ì˜¤ë¥˜ ìˆ˜ì •
  - e.parameter ì§ì ‘ ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
  - êµ¬ë²„ì „ payload ë°©ì‹ê³¼ í˜¸í™˜ì„± ìœ ì§€

### v2.18.0 (2025-09-16)
- ğŸ¨ **UI ê°œì„ **
  - ê´€ë¦¬ ëª¨ë‹¬ì— Apps Script URL ì„¤ì • ì¶”ê°€
  - ì¬ë°°í¬ ì‹œ Apps Script URLì„ ì§ì ‘ ê´€ë¦¬ ëª¨ë‹¬ì—ì„œ ë³€ê²½ ê°€ëŠ¥
  - ì„¤ì • ëª¨ë‹¬ê³¼ ë³„ë„ë¡œ ê´€ë¦¬ ëª¨ë‹¬ì—ì„œë„ URL ì„¤ì • ê°€ëŠ¥
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - batchUpdate ì•¡ì…˜ì´ ì´ë¯¸ Apps Scriptì— êµ¬í˜„ë˜ì–´ ìˆìŒì„ í™•ì¸
  - ì¼ê´„ ë“±ë¡ ê¸°ëŠ¥ ì •ìƒ ì‘ë™

### v2.17.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - parseTypeData í•¨ìˆ˜ ë¯¸ì •ì˜ ì˜¤ë¥˜ ìˆ˜ì •
  - buildTypeFromCsv í•¨ìˆ˜ë¡œ ì˜¬ë°”ë¥´ê²Œ ë³€ê²½
  - í…Œì´ë¸” ë¡œë“œ ê¸°ëŠ¥ ì •ìƒ ì‘ë™

### v2.16.0 (2025-09-16)
- ğŸ”§ **ë²„ê·¸ ìˆ˜ì •**
  - loadTypeSheet í•¨ìˆ˜ ë¯¸ì •ì˜ ì˜¤ë¥˜ ìˆ˜ì •
  - ì§ì ‘ CSV í˜ì¹­ ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ ì•ˆì •ì„± ê°œì„ 
- ğŸ¨ **UI ê°œì„ **
  - "ê´€ë¦¬" ë²„íŠ¼ ìœ ì§€ ë° ê´€ë¦¬ ë©”ë‰´ êµ¬ì¡° ê°œì„ 
  - í…Œì´ë¸” ê´€ë¦¬ë¥¼ ìœ„í•œ ë³„ë„ ë²„íŠ¼ ì„¤ê³„
  - í–¥í›„ ì¹©/í”Œë ˆì´ì–´ ìˆ˜ì • ê¸°ëŠ¥ ì¶”ê°€ë¥¼ ìœ„í•œ ê¸°ë°˜ ë§ˆë ¨

### v2.15.0 (2025-09-16)
- ğŸ“‹ **í…Œì´ë¸” ê´€ë¦¬ UI ë‹¨ìˆœí™”**
  - ê´€ë¦¬ ë²„íŠ¼ì„ "í…Œì´ë¸”" ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
  - í”Œë ˆì´ì–´/ì¹© íƒ­ ì œê±°, í…Œì´ë¸” ê´€ë¦¬ì—ë§Œ ì§‘ì¤‘
  - í…Œì´ë¸” í˜¸ì¶œ â†’ ì„ íƒ â†’ í”Œë ˆì´ì–´ ê´€ë¦¬ ì›Œí¬í”Œë¡œìš°
  - ì¼ê´„ ë“±ë¡ ì‹œìŠ¤í…œìœ¼ë¡œ íš¨ìœ¨ì„± ê°œì„ 

### v2.14.0 (2025-09-16)
- ğŸ® **í”Œë ˆì´ì–´ ê´€ë¦¬ ê¸°ëŠ¥ ê°•í™”**
  - ê´€ë¦¬ ë²„íŠ¼ì—ì„œ í”Œë ˆì´ì–´ ì¶”ê°€/ì‚­ì œ ê°€ëŠ¥
  - ì‹¤ì‹œê°„ ì¢Œì„ ë²ˆí˜¸ ë³€ê²½ ê¸°ëŠ¥
  - ì¹© ìˆ˜ëŸ‰ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥
  - Google Sheetsì™€ ì‹¤ì‹œê°„ ë™ê¸°í™”
  - í…Œì´ë¸”ë³„ í”Œë ˆì´ì–´ ê´€ë¦¬ UI ê°œì„ 

### v2.13.0 (2025-09-15)
- ğŸš€ **ìë™ ì•¡ì…˜ ë§¤í•‘ ì‹œìŠ¤í…œ êµ¬í˜„**
  - í”Œë ˆì´ì–´ ì„ íƒ ì—†ì´ ì•¡ì…˜ë§Œ ìˆœì„œëŒ€ë¡œ ì…ë ¥ ê°€ëŠ¥
  - í¬ì»¤ ê·œì¹™ì— ë”°ë¥¸ ìë™ í”Œë ˆì´ì–´ ë§¤í•‘
  - í”„ë¦¬í”Œë/í¬ìŠ¤íŠ¸í”Œë ì•¡ì…˜ ìˆœì„œ ìë™ ê³„ì‚°
  - ì„¤ì •ì—ì„œ ìë™/ìˆ˜ë™ ëª¨ë“œ ì „í™˜ ê°€ëŠ¥
  - í˜„ì¬ ì°¨ë¡€ í”Œë ˆì´ì–´ ì‹¤ì‹œê°„ í‘œì‹œ
  - í€µ ì•¡ì…˜ ë²„íŠ¼ ì¶”ê°€ (ìŠ¤ë§ˆíŠ¸ ì½œ, ì˜¬ì¸, ë²³/ë ˆì´ì¦ˆ)

### v2.12.0 (2025-09-15)
- âš™ï¸ **ì„¤ì • ê¸°ëŠ¥ ì¶”ê°€**
  - Apps Script URLì„ ëŒ€ì‹œë³´ë“œì—ì„œ ì§ì ‘ ë³€ê²½ ê°€ëŠ¥
  - localStorageì— ìë™ ì €ì¥ë˜ì–´ ì¬ë°°í¬ ì‹œ í¸ë¦¬
  - ì¹© ìŠ¤íƒ ê²€ì¦ ON/OFF ì„¤ì • ê°€ëŠ¥
  - ì„¤ì • ëª¨ë‹¬ì—ì„œ ë²„ì „ ì •ë³´ í™•ì¸ ê°€ëŠ¥

### v2.11.0 (2025-09-15)
- ğŸ¯ **í¬ì§€ì…˜ ì •ë³´ Google Sheets ê¸°ë¡ ì¶”ê°€**
  - PLAYER í–‰ì˜ Iì—´ì— í¬ì§€ì…˜ ì •ë³´(BTN/SB/BB) ì¶”ê°€
  - getPositionsForSeat í•¨ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ ìë™ ê³„ì‚°
  - ì—¬ëŸ¬ í¬ì§€ì…˜ì„ ê°€ì§„ ê²½ìš° ì‰¼í‘œë¡œ êµ¬ë¶„í•˜ì—¬ ì €ì¥

## ğŸ’¡ ì‚¬ìš© íŒ

### ìë™ ì•¡ì…˜ ë§¤í•‘ ëª¨ë“œ ì‚¬ìš©ë²•
1. ì„¤ì •(âš™ï¸) â†’ "ìë™ ì•¡ì…˜ ë§¤í•‘ ëª¨ë“œ" í™œì„±í™”
2. ë²„íŠ¼ ìœ„ì¹˜ ì„¤ì •
3. í”Œë ˆì´ì–´ ì„ íƒ ì—†ì´ ì•¡ì…˜ë§Œ ìˆœì„œëŒ€ë¡œ ì…ë ¥
4. ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ì˜¬ë°”ë¥¸ í”Œë ˆì´ì–´ì—ê²Œ ë§¤í•‘

### ì¹© ë¶„ì„ ê¸°ëŠ¥
1. ê´€ë¦¬ ë²„íŠ¼ â†’ ì¹© ì»¬ëŸ¬ íƒ­
2. ì¹© ì»¬ëŸ¬ ë“±ë¡ (ìµœëŒ€ 5ê°œ)
3. ì¹´ë©”ë¼ë¡œ ì¹© ìŠ¤íƒ ì´¬ì˜
4. AIê°€ ìë™ìœ¼ë¡œ ì¹© ê°œìˆ˜ ë¶„ì„

### íš¨ìœ¨ì ì¸ í•¸ë“œ ê¸°ë¡
- Smart ëª¨ë“œ í™œì„±í™”ë¡œ ìë™ ìŠ¤íŠ¸ë¦¬íŠ¸ ì§„í–‰
- í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ í™œìš© (ESC: ë‹«ê¸°, Enter: í™•ì¸)
- ë²„íŠ¼ ìœ„ì¹˜ ì„¤ì •ìœ¼ë¡œ ì•¡ì…˜ ìˆœì„œ ìë™ ê³„ì‚°

## ğŸ”§ ê°œë°œ ê°€ì´ë“œ

### Apps Script ë°°í¬
1. [Google Apps Script](https://script.google.com) ì ‘ì†
2. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
3. `Code_v63_InOut.gs` ë‚´ìš© ë¶™ì—¬ë„£ê¸°
4. ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ID ì„¤ì •
5. ì›¹ ì•±ìœ¼ë¡œ ë°°í¬ (ì•¡ì„¸ìŠ¤: ëª¨ë“  ì‚¬ìš©ì)

### ë¡œì»¬ ê°œë°œ
```bash
# ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/garimto81/virtual_data.git

# ë¡œì»¬ ì„œë²„ ì‹¤í–‰
python -m http.server 8000

# ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°
http://localhost:8000
```

## ğŸ“š í”„ë¡œì íŠ¸ ë¬¸ì„œ

### ë¬¸ì„œ êµ¬ì¡°
```
ğŸ“ docs/
â”œâ”€â”€ ğŸ“– README.md                    # ë¬¸ì„œ ì„¼í„° ë©”ì¸
â”œâ”€â”€ ğŸš€ development/                 # ê°œë°œ ê°€ì´ë“œ ë° ë¡œë“œë§µ
â”œâ”€â”€ ğŸ§ª testing/                     # í…ŒìŠ¤íŠ¸ ê³„íš ë° í’ˆì§ˆ ë³´ì¦
â”œâ”€â”€ ğŸŒ deployment/                  # ë°°í¬ ê°€ì´ë“œ ë° ìš´ì˜
â””â”€â”€ ğŸ“¦ archive/                     # ì™„ë£Œëœ í”„ë¡œì íŠ¸ ì•„ì¹´ì´ë¸Œ

ğŸ“ test/                            # ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½
ğŸ“ apps-script/                     # Apps Script ë°±ì—”ë“œ ì†ŒìŠ¤
ğŸ“ archive/                         # ì°¸ê³ ìš© ì•„ì¹´ì´ë¸Œ íŒŒì¼
```

### ì£¼ìš” ë¬¸ì„œ
- [ğŸ“š ë¬¸ì„œ ì„¼í„°](docs/README.md) - ëª¨ë“  ë¬¸ì„œì˜ ì¸ë±ìŠ¤
- [ğŸš€ ê°œë°œ ê°€ì´ë“œ](docs/development/DEVELOPMENT.md) - ê°œë°œ ë¡œë“œë§µ ë° ê¸°ìˆ  ì‚¬ì–‘
- [ğŸ§ª í…ŒìŠ¤íŠ¸ ê³„íš](docs/testing/TEST_PLAN.md) - ì¢…í•© í…ŒìŠ¤íŠ¸ ì „ëµ
- [ğŸŒ ë°°í¬ ê°€ì´ë“œ](docs/deployment/DEPLOYMENT_GUIDE.md) - ìš´ì˜ í™˜ê²½ ë°°í¬
- [ğŸ§ª ë¡œì»¬ í…ŒìŠ¤íŠ¸](test/README.md) - Apps Script ë¡œì»¬ í…ŒìŠ¤íŠ¸ í™˜ê²½

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ê¶Œí•œ ì„¤ì •**: ì›¹ ì•± ë°°í¬ ì‹œ "ëª¨ë“  ì‚¬ìš©ì" ì•¡ì„¸ìŠ¤ í—ˆìš©
2. **CORS**: form-urlencoded ë°©ì‹ìœ¼ë¡œ ì „ì†¡í•˜ì—¬ CORS ë¬¸ì œ íšŒí”¼
3. **ì‹œíŠ¸ ì´ë¦„**: Hand, Index, Type ì‹œíŠ¸ ì´ë¦„ ë³€ê²½ ê¸ˆì§€
4. **API ì œí•œ**: Google Apps Script ì¼ì¼ ì‹¤í–‰ ì‹œê°„ ì œí•œ ê³ ë ¤
5. **ë¸Œë¼ìš°ì € ìºì‹œ**: ì—…ë°ì´íŠ¸ í›„ Ctrl+Shift+Rë¡œ ê°•ì œ ìƒˆë¡œê³ ì¹¨

## ğŸ“§ ë¬¸ì˜

ë¬¸ì œê°€ ìˆê±°ë‚˜ ê°œì„  ì‚¬í•­ì´ ìˆìœ¼ë©´ [Issue](https://github.com/garimto81/virtual_data/issues)ë¥¼ ë“±ë¡í•´ì£¼ì„¸ìš”.

---

Â© 2025 Virtual Data - Poker Hand Logger. All rights reserved.
</file>

<file path="index.html">
<!DOCTYPE html>
<!--
  ============================================
  í¬ì»¤ í•¸ë“œ ë¡œê±° (Poker Hand Logger)
  Version: 3.5.29
  Last Modified: 2025-09-23 KST

  Change Log:
  - v3.5.29 (2025-09-23): Apps Script URL ì„¤ì • ê¸°ëŠ¥ ì¶”ê°€
    â€¢ URL ì„¤ì • ë²„íŠ¼ ë° ëª¨ë‹¬ UI ì¶”ê°€
    â€¢ URL ì„¤ì • ì•ˆë‚´ ë©”ì‹œì§€ ê°œì„ 
    â€¢ ì‹œíŠ¸ ì „ì†¡ ì‹œ URL ê²€ì¦ ê°•í™”
    â€¢ ì—°ê²° í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ ì¶”ê°€
    â€¢ localStorage ì €ì¥ ë° ë¶ˆëŸ¬ì˜¤ê¸°
  - v3.5.28 (2025-09-23): ì—°ì‡„ì ì¸ ë¬¸ì œ í•´ê²° ë° ì½”ë“œ ì•ˆì •ì„± ê°œì„ 
    â€¢ ActionOrderManager í´ë˜ìŠ¤ ì´ˆê¸°í™” ìˆœì„œ ìˆ˜ì • (í´ë˜ìŠ¤ ì •ì˜ ì§í›„ ì´ˆê¸°í™”)
    â€¢ window.showFeedback, window.openCardSelector ì „ì—­ ì°¸ì¡° ë³´ì¥
    â€¢ ëª¨ë“  í•¨ìˆ˜ í˜¸ì¶œì—ì„œ window ê°ì²´ ëª…ì‹œì  ì°¸ì¡° ì¶”ê°€
    â€¢ ë³´ë“œ ì¹´ë“œ í”„ë¡¬í”„íŠ¸ ë° ìŠ¤í‚µ í•¨ìˆ˜ì˜ showFeedback ì°¸ì¡° ìˆ˜ì •
    â€¢ ì½”ë“œ êµ¬ì¡° ê°œì„ ìœ¼ë¡œ ì—°ì‡„ì ì¸ ì˜¤ë¥˜ ë°©ì§€
  - v3.5.27 (2025-09-23): CAM ê¸°ëŠ¥ ì™„ì „ ì œê±°
    â€¢ ëª¨ë“  ì¹´ë©”ë¼ ê´€ë ¨ UI ìš”ì†Œ ì œê±° (cam-btn-1, cam-btn-2, camera-view)
    â€¢ window.state.camNumbers, camPreset ë³€ìˆ˜ ì œê±°
    â€¢ computeCamPrefill, getCamNumber í•¨ìˆ˜ ë”ë¯¸í™”
    â€¢ ìƒˆ í•¸ë“œ ì‹œì‘ ì‹œ ì¹´ë©”ë¼ ë²ˆí˜¸ ì¦ê°€ ë¡œì§ ì œê±°
    â€¢ í‚¤íŒ¨ë“œ ëª¨ë‹¬ì—ì„œ CAM ì²˜ë¦¬ ë¡œì§ ë¹„í™œì„±í™”
    â€¢ Index CSV ë¹Œë“œ ì‹œ CAM í•„ë“œ ë¹„í™œì„±í™”
    â€¢ loadIndexRow í•¨ìˆ˜ì—ì„œ ì¹´ë©”ë¼ ì •ë³´ ë¡œë“œ ë¡œì§ ì œê±°
  - v3.5.16 (2025-09-22): ë©”ëª¨ë¦¬ ê´€ë¦¬ ìµœì í™” ë° ì„±ëŠ¥ ê°œì„ 
    â€¢ ë©”ëª¨ë¦¬ ì„ê³„ê°’ 20MB â†’ 30MBë¡œ ìƒí–¥ ì¡°ì •
    â€¢ ë©”ëª¨ë¦¬ ì²´í¬ ì£¼ê¸° 5ì´ˆ â†’ 30ì´ˆë¡œ ë³€ê²½í•˜ì—¬ ì„±ëŠ¥ ê°œì„ 
    â€¢ ë©”ëª¨ë¦¬ ì •ë¦¬ ë¡œì§ ê°•í™” (ì•¡ì…˜ ë¡œê·¸, í”Œë ˆì´ì–´ ìºì‹œ, DOM ì •ë¦¬)
    â€¢ ë””ë²„ê·¸ ëª¨ë“œì—ì„œë§Œ ë©”ëª¨ë¦¬ ê²½ê³  í‘œì‹œ
    â€¢ ì¥ì‹œê°„ ì‚¬ìš© ì‹œ ì„±ëŠ¥ ì €í•˜ ë°©ì§€ë¥¼ ìœ„í•œ ìë™ ì •ë¦¬ ê¸°ëŠ¥ ì¶”ê°€
  - v3.5.15 (2025-09-22): í”Œë ˆì´ì–´ ë“±ë¡ í›„ ì‚­ì œ ë²„íŠ¼ ë¯¸ìƒì„± ë¬¸ì œ í•´ê²°
    â€¢ addPlayerToSeat() í•¨ìˆ˜ì—ì„œ seat â†’ seatNo ì†ì„± ìˆ˜ì •
    â€¢ renderManagementPlayersList() í•¨ìˆ˜ì˜ ì¸ë±ìŠ¤ ì°¾ê¸° ë¡œì§ ê°œì„ 
    â€¢ players.indexOf() â†’ players.findIndex(p => p.name === player.name)ë¡œ ìˆ˜ì •
    â€¢ ìƒˆë¡œ ë“±ë¡ëœ í”Œë ˆì´ì–´ì˜ ì‚­ì œ ë²„íŠ¼ì´ ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ë„ë¡ ìˆ˜ì •
  - v3.5.14 (2025-09-22): ActionOrderManager ìœ ì‚¬ ë¡œì§ seat ì²˜ë¦¬ ì™„ì „ ê°œì„ 
    â€¢ getPreflopOrder()ì™€ getPostflopOrder() í•¨ìˆ˜ì˜ seatMap êµ¬ì¶• ë¡œì§ ìˆ˜ì •
    â€¢ getBigBlindPlayer()ì™€ getSmallBlindPlayer() í•¨ìˆ˜ì˜ seat ì²˜ë¦¬ ê°œì„ 
    â€¢ ëª¨ë“  p.seat ì‚¬ìš© ìœ„ì¹˜ë¥¼ parseSeatNo(p.seatNo || p.seat) ë°©ì‹ìœ¼ë¡œ í†µì¼
    â€¢ #1, #2 í˜•íƒœì™€ 1, 2 í˜•íƒœ ëª¨ë‘ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ë„ë¡ ê°œì„ 
  - v3.5.13 (2025-09-22): ê´€ë¦¬ ë²„íŠ¼ í”Œë ˆì´ì–´ ì •ë³´ ë¯¸í˜¸ì¶œ ë¬¸ì œ í•´ê²°
    â€¢ renderManagementPlayersList() í•¨ìˆ˜ì—ì„œ p.seat â†’ p.seatNo ìˆ˜ì •
    â€¢ ê´€ë¦¬ ë²„íŠ¼ì—ì„œ í…Œì´ë¸” ì„ íƒ ì‹œ í”Œë ˆì´ì–´ ì •ë³´ ì •ìƒ í‘œì‹œ
    â€¢ ìƒˆë¡œìš´ Type ì‹œíŠ¸ êµ¬ì¡°ì— ë§ëŠ” ì¢Œì„ ë²ˆí˜¸ ë§¤ì¹­ ë¡œì§ ì™„ì„±
  - v3.5.12 (2025-09-22): ìƒˆë¡œìš´ Type ì‹œíŠ¸ êµ¬ì¡° ì™„ì „ ì ìš© ì™„ë£Œ
    â€¢ Type ì‹œíŠ¸ êµ¬ì¡°: A:Poker Room, B:Table Name, C:Table No, D:Seat No, E:Players, F:Nationality, G:Chips, H:Keyplayer
    â€¢ ëª¨ë“  í”Œë ˆì´ì–´ ê´€ë¦¬ ë¡œì§ ìƒˆ 8ì—´ êµ¬ì¡° ì ìš© ì™„ë£Œ
    â€¢ Apps Script ëª¨ë“  í•¨ìˆ˜ ìƒˆ êµ¬ì¡° ì ìš© ì™„ë£Œ
    â€¢ í”„ë¡ íŠ¸ì—”ë“œ buildTypeFromCsv í•¨ìˆ˜ ìµœì¢… ê²€ì¦ ì™„ë£Œ
  - v3.5.0 (2025-09-22): ëŒ€ê·œëª¨ ì„±ëŠ¥ ìµœì í™” ë° ëª¨ë°”ì¼ ê°œì„ 
    â€¢ API í‚¤ ë³´ì•ˆ ê°•í™” (ì„œë²„ì‚¬ì´ë“œ í”„ë¡ì‹œ êµ¬í˜„)
    â€¢ ëª¨ë°”ì¼ ë°˜ì‘ì„± ëŒ€í­ ê°œì„  (300ms ì§€ì—° ì™„ì „ ì œê±°)
    â€¢ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ í•´ê²° (ìë™ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜)
    â€¢ ì œìŠ¤ì²˜ ì¸ì‹ ì¶”ê°€ (ìŠ¤ì™€ì´í”„, í•€ì¹˜, ë¡±í”„ë ˆìŠ¤)
    â€¢ í–…í‹± í”¼ë“œë°± êµ¬í˜„
    â€¢ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì¶”ê°€
    â€¢ ì½”ë“œ ëª¨ë“ˆí™” ì‹œì‘ (performance-optimizer.js, mobile-enhancer.js)
  - v3.4.10 (2025-09-18): GitHub ì €ì¥ì†Œ êµ¬ì¡° í†µí•© ë° ê°„ì†Œí™”
    â€¢ íŒŒì¼ë“¤ì„ ë£¨íŠ¸ ë ˆë²¨ë¡œ ì´ë™ (virtual_data ì„œë¸Œí´ë” ì œê±°)
    â€¢ GitHub Pages ê²½ë¡œ ë‹¨ìˆœí™”: garimto81.github.io/virtual_data
    â€¢ ê´€ë¦¬ í¬ì¸íŠ¸ í†µí•©ìœ¼ë¡œ ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ
  - v3.4.9 (2025-09-18): openCardSelector í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
    â€¢ openCardSelector í•¨ìˆ˜ë¥¼ window ê°ì²´ì— ë“±ë¡
    â€¢ ActionOrderManagerì—ì„œ ì¹´ë“œ ì„ íƒ UI ì •ìƒ í˜¸ì¶œ ê°€ëŠ¥
  - v3.4.8 (2025-09-18): JavaScript íŒŒì¼ ê²½ë¡œ ë²„ê·¸ ìˆ˜ì •
    â€¢ archive í´ë”ë¡œ ìŠ¤í¬ë¦½íŠ¸ ê²½ë¡œ ìˆ˜ì • (404 ì—ëŸ¬ í•´ê²°)
    â€¢ ëª¨ë“  JavaScript íŒŒì¼ì´ ì •ìƒ ë¡œë“œë¨
  - v3.4.7 (2025-09-18): í…ìŠ¤íŠ¸ ì¹´ë“œ ì…ë ¥ UI ì™„ì „ ì œê±°
    â€¢ í…ìŠ¤íŠ¸ ì…ë ¥ í•„ë“œ ì œê±°, ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒê¸°ë¡œ í†µí•©
    â€¢ showFeedback í•¨ìˆ˜ ì „ì—­ ì ‘ê·¼ ë¬¸ì œ í•´ê²°
    â€¢ promptForBoardCardsê°€ openCardSelector ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½
    â€¢ ëª¨ë“  ì¹´ë“œ ì…ë ¥ì´ ì¼ê´€ëœ UIë¡œ í†µí•©
  - v3.4.6 (2025-09-18): ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì‚¬ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 
    â€¢ ë°±ê·¸ë¼ìš´ë“œ ê²€ì‚¬ë¡œ ë³€ê²½ (UI ì°¨ë‹¨ ì—†ìŒ)
    â€¢ ì§„í–‰ ë©”ì‹œì§€ ê°„ì†Œí™” (ì½˜ì†” ìœ„ì£¼)
    â€¢ ì¤‘ìš”í•œ ê²°ê³¼ë§Œ ì§§ê²Œ í‘œì‹œ (2ì´ˆ ìŠ¤ë‚µë°”)
    â€¢ í˜ì´ì§€ ë¡œë“œ ì‹œ ì¡°ìš©í•œ ì‹¤í–‰
  - v3.4.5 (2025-09-18): ì¹´ë“œ ì…ë ¥ ì‹œìŠ¤í…œ í†µí•©
    â€¢ ë¹„ì£¼ì–¼ ì¹´ë“œ ì„ íƒ UIë¡œ ì™„ì „ í†µì¼
    â€¢ ì´ë¯¸ ì…ë ¥ëœ ì¹´ë“œê°€ ìˆìœ¼ë©´ ìë™ ìŠ¤í‚µ
  - v3.3.3 (2025-09-17): ìœ ì—°í•œ ì¹© ì²˜ë¦¬ ì‹œìŠ¤í…œ
    â€¢ ì¹© ì´ˆê³¼ ë² íŒ… í—ˆìš© - ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ì§„í–—
    â€¢ ë§ˆì´ë„ˆìŠ¤ ì¹© í—ˆìš© ë° ì‹œê°ì  í‘œì‹œ (ë¹¨ê°„ìƒ‰)
    â€¢ ìˆ˜ë™ ì¹© ì¡°ì •ìœ¼ë¡œ ìœ ì—°í•œ ì²˜ë¦¬ ê°€ëŠ¥
    â€¢ í˜„ì‹¤ì ì¸ ìƒí™©ì— ëŒ€ì‘í•˜ëŠ” ì„¤ê³„
  - v3.3.2 (2025-09-17): ì¹© ì´ˆê³¼ ë² íŒ… ë°©ì§€ ì‹œìŠ¤í…œ (deprecated)
  - v3.3.1 (2025-09-17): ì¹© ì´ˆê³¼ ë² íŒ… ìë™ ì˜¬ì¸ ì²˜ë¦¬ (deprecated)
  - v3.3.0 (2025-09-17): ì¹© ìˆ˜ì • ì‹œ ì¤‘ë³µ í”Œë ˆì´ì–´ ìƒì„± ë¬¸ì œ í•´ê²°
    â€¢ Apps Script v65ë¡œ ì—…ê·¸ë ˆì´ë“œ
    â€¢ updatePlayerChips í•¨ìˆ˜ ê°œì„ : ê¸°ì¡´ í”Œë ˆì´ì–´ ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€
    â€¢ ì¹© ìˆ˜ì • ì‹œ ìë™ ì¤‘ë³µ ì œê±° ë¡œì§ ì¶”ê°€
  - v3.2.9 (2025-09-17): ì¤‘ë³µ ì œê±° ì•„í‚¤í…ì²˜ ê°œì„ 
    â€¢ ë³„ë„ ì¤‘ë³µ ì œê±° ë²„íŠ¼ ì œê±°
    â€¢ ì¼ê´„ ë“±ë¡ ì‹œ ìë™ ì¤‘ë³µ ì œê±° ì²˜ë¦¬
    â€¢ Apps Script v64ë¡œ ì—…ê·¸ë ˆì´ë“œ
  - v3.2.8 (2025-09-17): ì¤‘ë³µ í”Œë ˆì´ì–´ ê°ì§€ ë° ì œê±° ì‹œìŠ¤í…œ êµ¬í˜„
    â€¢ Apps Scriptì— removeDuplicatePlayers() í•¨ìˆ˜ ì¶”ê°€
    â€¢ batchUpdate ë° addPlayerì—ì„œ ìë™ ì¤‘ë³µ ì œê±°
    â€¢ í”„ë¡ íŠ¸ì—”ë“œì— ì¤‘ë³µ ì œê±° ë²„íŠ¼ ì¶”ê°€ (ê´€ë¦¬ ëª¨ë‹¬)
    â€¢ ìë™ í”Œë ˆì´ì–´ ë“±ë¡ ë¡œì§ ì œê±° (ì¤‘ë³µ ë°©ì§€)
    â€¢ ê°•í™”ëœ ì¤‘ë³µ ì²´í¬ ì‹œìŠ¤í…œ (í…Œì´ë¸”_í”Œë ˆì´ì–´ ì¡°í•©)
  - v3.2.7 (2025-09-17): Apps Script ì‚­ì œ ë¡œì§ ë””ë²„ê¹… ê°•í™” ë° ì¡°ê±´ ì™„í™”
  - v3.2.7 (2025-09-17): ì‹œíŠ¸ ì •ë ¬ ë²„íŠ¼ ì œê±°, í”Œë ˆì´ì–´ ì‚­ì œ ë¡œì§ ê°œì„ 
  - v3.2.7 (2025-09-17): ì •ë ¬ ê¸°ì¤€ ë³€ê²½ (Table > Seat)
  - v3.2.4 (2025-09-17): Google Sheets ìë™ ì •ë ¬ ê¸°ëŠ¥ ì¶”ê°€
  - v3.2.3 (2025-09-17): ë””ë²„ê·µ ë¡œê·¸ ê°œì„  ë° ìºì‹œ ë²„ìŠ¤íŒ…
  - v3.2.2 (2025-09-17): í”Œë ˆì´ì–´ ì‚­ì œ ì„±ëŠ¥ ìµœì í™”
  - v3.2.1 (2025-09-17): í”Œë ˆì´ì–´ ì‚­ì œ ë¡œì§ ë²„ê·¸ ìˆ˜ì •
  - v3.2.0 (2025-09-17): Phase 3 - ëª¨ë°”ì¼ ìµœì í™” ì™„ì„±
    â€¢ í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ ìµœì í™” (44x44px ìµœì†Œ í¬ê¸°)
    â€¢ ìŠ¤ì™€ì´í”„ ì œìŠ¤ì²˜ë¡œ ì‹¤í–‰ì·¨ì†Œ (ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„)
    â€¢ ë¡±í”„ë ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´ ì‹œìŠ¤í…œ
    â€¢ í–…í‹± í”¼ë“œë°± ë° ì§„ë™ API ì§€ì›
    â€¢ ê°€ìƒ ìŠ¤í¬ë¡¤ë¡œ ëŒ€ìš©ëŸ‰ ë¦¬ìŠ¤íŠ¸ ì„±ëŠ¥ ìµœì í™”
    â€¢ IndexedDB ê¸°ë°˜ ì˜¤í”„ë¼ì¸ ì €ì¥ì†Œ
    â€¢ ìë™ ë™ê¸°í™” í ë° ì¬ì‹œë„ ë¡œì§
    â€¢ ë©”ëª¨ë¦¬ ê´€ë¦¬ ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
  - v3.1.0 (2025-01-17): Phase 2 - ê¸°ëŠ¥ë³„ ì¦‰ì‹œ ì‹¤í–‰
    â€¢ ë”ë¸”íƒ­ìœ¼ë¡œ ìœ„í—˜ ì‘ì—… ë³´í˜¸
    â€¢ íŠ¸ëœì­ì…˜ ë°©ì‹ì˜ ì¼ê´„ ì²˜ë¦¬
    â€¢ API ë°°ì¹˜ í˜¸ì¶œ ìµœì í™”
    â€¢ ë”ë¸”íƒ­ íƒ€ì´ë¨¸ ì¶©ëŒ ë°©ì§€
  - v3.0.0 (2025-01-17): ëª¨ë°”ì¼ ìµœì í™” - Phase 1 ì™„ë£Œ
    â€¢ confirm íŒì—… ì œê±°, ì¦‰ì‹œ ì‹¤í–‰ + ì‹¤í–‰ì·¨ì†Œ ì‹œìŠ¤í…œ êµ¬í˜„
    â€¢ ActionHistory ì‹œìŠ¤í…œìœ¼ë¡œ ì‘ì—… ì´ë ¥ ê´€ë¦¬
    â€¢ ìŠ¤ë‚µë°” UIë¡œ ì‹¤ì‹œê°„ í”¼ë“œë°± ì œê³µ
    â€¢ ë©”ëª¨ë¦¬ ìµœì í™” (íˆìŠ¤í† ë¦¬ 20ê°œ ì œí•œ)
  - v2.29.0 (2025-09-16): 10ê°œ ì‹œíŠ¸ ê³ ì • í”Œë ˆì´ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ
    â€¢ ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°
    â€¢ í¬ì»¤ í¬ì§€ì…˜ ìˆœì„œëŒ€ë¡œ ìë™ í”Œë ˆì´ì–´ ì§„í–‰
    â€¢ Check/Call ë²„íŠ¼ ìƒí™©ë³„ ë™ì  ë³€ê²½ (ê¸ˆì•¡ í‘œì‹œ)
    â€¢ ë² íŒ… ì…ë ¥ ë²„ê·¸ ìˆ˜ì • ë° íŒì—… ì¦‰ì‹œ í‘œì‹œ
  - v2.15.0 (2025-09-16): í…Œì´ë¸” ê´€ë¦¬ UI ë‹¨ìˆœí™” - í…Œì´ë¸” ì „ìš© ê´€ë¦¬ ëª¨ë‹¬ë¡œ ë³€ê²½
  - v2.31.0 (2025-09-16): ë¡œë”© ì¤‘ UI ì ê¸ˆ ë° í”Œë ˆì´ì–´ ê´€ë¦¬ ì¼ê´„ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ êµ¬í˜„ - ì¶©ëŒ ë°©ì§€ ë° ì¦‰ì‹œ ë°˜ì˜
  - v2.30.0 (2025-09-16): Apps Script URL í´ë¼ìš°ë“œ ë™ê¸°í™” ì‹œìŠ¤í…œ êµ¬í˜„ - GitHub Gist API í™œìš© ê¸°ê¸°ê°„ ì„¤ì • ë™ê¸°í™”
  - v2.14.0 (2025-09-16): í”Œë ˆì´ì–´ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€ - ê´€ë¦¬ ë²„íŠ¼ì—ì„œ í”Œë ˆì´ì–´ ì¶”ê°€/ì‚­ì œ/ì¢Œì„ ë³€ê²½
  - v2.10.9 (2025-09-15): íŒŸ ê³„ì‚° ë¡œì§ ë²„ê·¸ ìˆ˜ì • - ì¤‘ê°„ ë² íŒ… ê¸ˆì•¡ ëˆ„ì  ë¬¸ì œ í•´ê²°
  - v2.10.8 (2025-09-15): í‚¤íŒ¨ë“œ ì¤‘ë³µ ì…ë ¥ ë²„ê·¸ ìˆ˜ì • - ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
  - v2.10.7 (2025-09-15): ë²„íŠ¼/SB/BB ì„ íƒ ë¡œì§ ê°œì„  - ì „ì²´ í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì„ íƒ ê°€ëŠ¥
  - v2.10.6 (2025-09-15): ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ ì‘ë™ ë²„ê·¸ ìˆ˜ì •, ë²„ì „ ì¤‘ì•™ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬í˜„
  - v2.10.5 (2025-09-15): ë²„íŠ¼ ìœ„ì¹˜ ì¤‘ë³µ ì…ë ¥ ë²„ê·¸ ìˆ˜ì •
  - v2.10.4 (2025-09-15): ë²„íŠ¼ ì„¤ì • UI ìµœì í™”
  - v2.10.3 (2025-09-15): ë²„íŠ¼ ì„¤ì • UI ê°œì„ 
  - v2.10.2 (2025-09-15): ë³´ë“œ ì¹´ë“œ í•œë²ˆì— ì…ë ¥ ê¸°ëŠ¥
  - v2.10.1 (2025-09-15): í”Œë ˆì´ì–´ ì¹© ë²„íŠ¼ ì´ë²¤íŠ¸ ë²„ê·¸ ìˆ˜ì •
  - v2.10.0 (2025-09-15): í´ë“œ ë˜ëŒë¦¬ê¸° ë²„ê·¸ ìˆ˜ì • ì™¸
  - v2.9.5 (2025-09-12): ì‹œì‘ ì¹© ì—…ë°ì´íŠ¸ ë²„ê·¸ ìˆ˜ì •
  - v2.9.4 (2025-09-12): í”Œë ˆì´ì–´ ì´ë¦„ í‘œì‹œ ë²„ê·¸ ìˆ˜ì •
  - v2.9.3 (2025-09-12): ì¢Œì„ ë²ˆí˜¸ ì œê±°, 0.5x11 ê·¸ë¦¬ë“œ, ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ ë²„ê·¸ ìˆ˜ì •
  - v2.9.2 (2025-01-11): 1x11 ê·¸ë¦¬ë“œë¡œ ì¢Œì„ ë°°ì¹˜ ê°œì„ 
  - v2.9.1 (2025-01-11): ì¢Œì„ ë°°ì¹˜ UI ê³µê°„ ìµœì í™”
  - v2.9.0 (2025-01-11): ì¢Œì„ ë°°ì¹˜ ì‹œìŠ¤í…œ ë° ì•¡ì…˜ ìˆœì„œ ë¡œì§ ì¶”ê°€
  - v2.8.3 (2025-01-11): ì¹´ë“œ ì…ë ¥ ë‹¤ì´ì–¼ë¡œê·¸ ë²„íŠ¼ ìœ„ì¹˜ ë³€ê²½ (UX ê°œì„ )
  - v2.8.2 (2025-01-10): ë¬¸ì„œ í†µí•© ë° í”„ë¡œì íŠ¸ ì •ë¦¬
  - v2.8.1 (2025-01-10): 2ë°±ë§Œ ì¹© ì´ìƒ ë¬´í•œ í‘œì‹œ ë²„ê·¸ ìˆ˜ì •
  - v2.8.0 (2025-01-09): ì˜¬ì¸ ì œí•œ ê³ ë ¤í•œ ì •í™•í•œ íŒŸ ê³„ì‚° ë¡œì§ êµ¬í˜„
  - v2.7.0 (2025-01-08): íŒŸ ê³„ì‚° ë¡œì§ ê°œì„  - ë¸”ë¼ì¸ë“œ/ì•ˆí‹°ë¥¼ í”Œë ˆì´ì–´ë³„ ê¸°ì—¬ì•¡ì— í¬í•¨
  - v2.0.0 (2025-01-02): Smart Check/Call ë²„íŠ¼ ë° ìŠ¤íŠ¸ë¦¬íŠ¸ ìë™ ì§„í–‰ ì‹œìŠ¤í…œ êµ¬í˜„
  - v1.9.0 (2024-12-30): íŒŸ ì‚¬ì´ì¦ˆ ì¡°ì • ë¡œì§ ë° ì˜¬ì¸ ì½œ ë²„ê·¸ ìˆ˜ì •
  - v1.8.0 (2024-12-28): í”Œë ˆì´ì–´ ìƒíƒœ ì¶”ì  ì‹œìŠ¤í…œ ì¶”ê°€
  ============================================
-->
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0" />
  <meta http-equiv="cache-control" content="no-cache, must-revalidate, max-age=0" />
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <title>í¬ì»¤ í•¸ë“œ ë¡œê±° v3.5.29</title>
  <script src="https://cdn-tailwindcss.vercel.app/"></script>
  <script src="archive/chip-analysis-module.js?v=3.5.25" defer></script>
  <!-- í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“ˆ v59 - IN/OUT ë‘ ê°€ì§€ ìƒíƒœë§Œ ì‚¬ìš© -->
  <script src="archive/table-management-v59.js?v=3.5.25" defer></script>
  <!-- ActionHistory ì‹œìŠ¤í…œ - Phase 1 -->
  <script src="archive/action-history.js?v=3.5.25" defer></script>
  <!-- Phase 2: ë”ë¸”íƒ­ & ë°°ì¹˜ ì²˜ë¦¬ -->
  <script src="archive/double-tap-handler.js?v=3.5.25" defer></script>
  <script src="archive/batch-processor.js?v=3.5.25" defer></script>
  <!-- Phase 3: ëª¨ë°”ì¼ ìµœì í™” -->
  <script src="archive/mobile-optimizer.js?v=3.5.25" defer></script>
  <script src="archive/virtual-scroll.js?v=3.5.25" defer></script>
  <script src="archive/offline-storage.js?v=3.5.25" defer></script>
  <!-- ëª¨ë‹¬ ìë™ ë‹«ê¸° ëª¨ë“ˆ -->
  <script src="src/js/modal-auto-close.js?v=3.5.25" defer></script>
  <!-- ì„±ëŠ¥ ìµœì í™” ëª¨ë“ˆ -->
  <script src="src/js/performance-optimizer.js?v=3.5.25" defer></script>
  <!-- ëª¨ë°”ì¼ í–¥ìƒ ëª¨ë“ˆ (ì¼ì‹œ ë¹„í™œì„±í™” - í°íŠ¸ ë° ìŠ¤í¬ë¡¤ ë¬¸ì œ) -->
  <!-- <script src="src/js/mobile-enhancer.js?v=1.0.0" defer></script> -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@700&family=Noto+Sans+KR:wght@400;500;700&display=swap');
    html, body { height: 100vh; overflow: hidden; font-family: 'Noto Sans KR', sans-serif; touch-action: manipulation; -webkit-tap-highlight-color: transparent; }
    #app-container { display: flex; flex-direction: column; height: 100%; }
    main { flex-grow: 1; overflow-y: auto; }
    .btn { /* transition removed for instant response */ }
    .btn:active { transform: scale(0.95); }
    .btn-selected { background-color: #FBBF24 !important; color: #111827 !important; font-weight: bold; }
    .card-placeholder { border: 2px dashed #4B5563; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 1px; background-color: rgba(255,255,255,0.05); flex-shrink: 0; }
    .card-display { font-family: 'Roboto', sans-serif; background-color: white; border-radius: 4px; padding: 1px; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 0.8rem; }
    .card-display .rank { font-weight: bold; font-size: 1rem; }
    .modal { /* transition removed for instant popup */ backdrop-filter: blur(4px); }
    .card-selector-btn { font-family: 'Roboto', sans-serif; font-size: 1rem; font-weight: bold; }
    .card-selector-btn.card-red { color: #DC2626; }
    .card-selector-btn.card-black { color: #111827; }
    .card-selector-btn.selected { border: 3px solid #FBBF24; transform: scale(0.95); }
    .player-card.is-winner { background-color: rgba(251, 191, 36, 0.1); }
    select, input[type="text"] { font-size: 0.875rem; }
    .chip-color-sample { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #4B5563; cursor: pointer; }
    .chip-analysis-btn { font-size: 0.75rem; padding: 0.25rem 0.5rem; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .pulse-animation { animation: pulse 2s infinite; }

    /* ìŠ¤ë‚µë°” ìŠ¤íƒ€ì¼ (ëª¨ë°”ì¼ ìµœì í™”) */
    .snackbar {
      position: fixed;
      bottom: -60px;
      left: 10px;
      right: 10px;
      background: #333;
      color: white;
      padding: 12px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: bottom 0.2s ease-out;
      z-index: 10000;
      font-size: 14px;
      max-width: 500px;
      margin: 0 auto;
    }

    .snackbar.show {
      bottom: 10px;
    }

    .snackbar-undo-btn {
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 4px 12px;
      border-radius: 3px;
      font-size: 12px;
      margin-left: 10px;
      cursor: pointer;
      min-width: 44px;
      min-height: 30px;
    }

    .snackbar-undo-btn:active {
      transform: scale(0.95);
    }

    .snackbar-info {
      background: #2563eb;
    }

    .snackbar-error {
      background: #dc2626;
    }

    .snackbar-success {
      background: #16a34a;
    }

    .snackbar-warning {
      background: #f59e0b;
    }

    /* ë”ë¸”íƒ­ ìŠ¤íƒ€ì¼ (Phase 2) */
    .double-tap-required {
      position: relative;
    }

    .double-tap-warning {
      animation: pulse 0.5s ease-in-out infinite;
      background: #f59e0b !important;
      color: white !important;
    }

    .danger-critical {
      background: #dc2626 !important;
      color: white !important;
    }

    .danger-warning {
      background: #f59e0b !important;
      color: white !important;
    }

    .executing {
      opacity: 0.6;
      pointer-events: none;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }
  </style>
</head>
<body class="bg-gray-900 text-white antialiased">
  <div id="app-container">
    <!-- ë²„ì „ í‘œì‹œ í—¤ë” -->
    <div class="bg-gray-900 border-b border-gray-700 px-3 py-1">
      <div class="flex justify-between items-center text-xs">
        <span class="font-bold text-amber-400">í¬ì»¤ í•¸ë“œ ë¡œê±°</span>
        <div class="flex items-center gap-2">
          <button id="settings-btn" class="text-gray-400 hover:text-amber-400" title="ì„¤ì •">
            âš™ï¸
          </button>
          <span id="version-display" class="text-gray-400">v2.26.6</span>
        </div>
      </div>
    </div>
    <main class="p-2 space-y-2">
      <div class="bg-gray-800 p-2 rounded-lg space-y-2">
        <div class="flex items-center gap-2 text-sm">
          <div class="flex-1 flex items-center gap-1 bg-gray-700 p-1 rounded-md min-w-0">
            <span id="hand-number-display" class="font-bold px-1 whitespace-nowrap">#--</span>
            <button id="load-hand-btn" class="btn bg-gray-600 px-2 py-1 rounded-md text-xs">Load</button>
            <label class="flex items-center gap-1 text-xs ml-2">
              <input type="checkbox" id="smart-mode-toggle" checked class="h-3 w-3">
              <span>Smart</span>
            </label>
          </div>
          <div class="flex-1 min-w-0">
            <button id="table-selector-btn" class="w-full bg-gray-700 border border-gray-600 rounded-md px-2 py-1 text-left flex items-center justify-between hover:bg-gray-600">
              <span id="selected-table-display">í…Œì´ë¸” ì„ íƒ</span>
              <span class="text-gray-400">â–¼</span>
            </button>
          </div>
          <div class="flex-1 flex items-center gap-1 min-w-0">
            <select id="timezone-selector" class="flex-grow bg-gray-700 border border-gray-600 rounded-md px-2 py-1 text-xs"></select>
            <span id="time-display" class="bg-gray-900/50 p-1 rounded-md font-mono text-xs"></span>
          </div>
          <div class="flex items-center gap-1">
            <button id="set-url-btn" class="btn bg-amber-600 hover:bg-amber-700 px-2 py-1 rounded-md text-xs">URL ì„¤ì •</button>
            <button id="manage-players-btn" class="btn bg-gray-600 hover:bg-gray-700 px-2 py-1 rounded-md text-xs">ê´€ë¦¬</button>
            <button id="refresh-data" class="text-lg" title="ë°ì´í„° ìƒˆë¡œê³ ì¹¨">ğŸ”„</button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <div class="text-xs text-gray-300 flex items-center gap-2">
            <!-- CAM ë²„íŠ¼ ì œê±°ë¨ (v3.5.27) -->
            <!-- <button id="cam-btn-1" class="btn bg-gray-700 px-2 py-1 rounded"></button> -->
            <!-- <button id="cam-btn-2" class="btn bg-gray-700 px-2 py-1 rounded"></button> -->
          </div>
          <div class="text-right text-xs text-gray-400">
            <span id="data-stamp"></span>
          </div>
        </div>
        <!-- ì¢Œì„ ë°°ì¹˜ ë° í”Œë ˆì´ì–´ ì„ íƒ (1x11 ê·¸ë¦¬ë“œ) -->
        <div class="bg-gray-700 p-2 rounded-lg">
          <div id="seat-buttons" class="grid grid-cols-11 gap-1">
            <!-- 10ê°œ ì¢Œì„ + ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ (11ë²ˆì§¸) -->
          </div>
          <div id="position-indicators" class="text-xs text-gray-400 mt-1 text-center">
            <!-- SB, BB í‘œì‹œ -->
          </div>
          <div id="position-display" class="mt-1 text-xs">
            <!-- ë²„íŠ¼ ìœ„ì¹˜ ìƒì„¸ í‘œì‹œ -->
          </div>
        </div>
      </div>

      <div id="player-details-section" class="bg-gray-800 p-2 rounded-lg space-y-1"></div>

      <div class="bg-gray-800 p-2 rounded-lg space-y-2">
        <div class="flex flex-wrap items-center gap-2">
          <div class="flex items-center gap-1">
            <button id="small-blind-btn" data-purpose="smallBlind" class="btn bg-gray-700 p-1 rounded-md text-sm min-w-[60px]">0</button>
            <button id="big-blind-btn" data-purpose="bigBlind" class="btn bg-gray-700 p-1 rounded-md text-sm min-w-[60px]">0</button>
            <div class="flex items-center">
              <input id="bb-ante-checkbox" type="checkbox" class="h-4 w-4 bg-gray-700 border-gray-600 rounded text-amber-500">
              <label for="bb-ante-checkbox" class="ml-1 text-xs">Ante</label>
            </div>
          </div>
          <div id="board-card-placeholders" class="flex flex-wrap gap-1 items-center flex-grow justify-end"></div>
        </div>
        <div class="space-y-1" id="street-logs-container"></div>
        
        <!-- í˜„ì¬ ì°¨ë¡€ í‘œì‹œ & ë¹ ë¥¸ ì•¡ì…˜ ë²„íŠ¼ (ìë™ ëª¨ë“œ) -->
        <div id="current-turn-indicator" class="hidden mt-2 p-2 bg-gray-700 rounded-md">
          <div class="text-center text-sm mb-2">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
          <div id="quick-action-buttons" class="grid grid-cols-5 gap-1">
            <button onclick="addAutoAction('Checks')" class="btn bg-green-600 hover:bg-green-500 text-white text-xs py-1 px-2 rounded">
              ì²´í¬
            </button>
            <button onclick="handleSmartCall()" class="btn bg-blue-600 hover:bg-blue-500 text-white text-xs py-1 px-2 rounded">
              ì½œ
            </button>
            <button onclick="openQuickBetRaise()" class="btn bg-orange-600 hover:bg-orange-500 text-white text-xs py-1 px-2 rounded">
              ë²³/ë ˆì´ì¦ˆ
            </button>
            <button onclick="addAutoAction('Folds')" class="btn bg-red-600 hover:bg-red-500 text-white text-xs py-1 px-2 rounded">
              í´ë“œ
            </button>
            <button onclick="handleAllIn()" class="btn bg-purple-600 hover:bg-purple-500 text-white text-xs py-1 px-2 rounded">
              ì˜¬ì¸
            </button>
          </div>
        </div>
      </div>


      <div class="bg-gray-800 p-2 rounded-lg space-y-2">
        <div class="flex flex-wrap gap-1 items-center">
          <span class="text-sm font-bold mr-2">ìŠ¹ì:</span>
          <div id="winner-buttons" class="flex flex-wrap gap-1 flex-grow"></div>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <button id="reset-btn" class="w-full btn bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-3 rounded-md text-sm">ìƒˆ í•¸ë“œ</button>
          <button id="send-to-sheet-btn" class="w-full btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-md text-sm">ì‹œíŠ¸ ì „ì†¡</button>
        </div>
        <p id="feedback-message" class="text-center h-4 text-xs font-semibold"></p>
      </div>

    </main>
    <footer class="flex-shrink-0 p-1 text-center">
      <button id="show-log-btn" class="text-gray-500 hover:text-gray-300 text-xs">ë¡œê·¸ ë³´ê¸°</button>
    </footer>
  </div>

  <!-- Modals -->
  <div id="card-selector-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-2 z-50 hidden opacity-0"></div>
  <div id="action-pad-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0"></div>
  <div id="keypad-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0"></div>
  <div id="load-hand-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0"></div>

  <!-- Apps Script URL ì„¤ì • ëª¨ë‹¬ (v3.5.29) -->
  <div id="url-setup-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0">
    <div class="bg-gray-800 rounded-lg p-6 max-w-lg w-full">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-amber-400">Apps Script URL ì„¤ì •</h2>
        <button id="close-url-modal" class="text-2xl hover:text-gray-400">&times;</button>
      </div>

      <div class="space-y-4">
        <div class="bg-gray-700 rounded-lg p-4">
          <h3 class="text-sm font-bold text-green-400 mb-2">ğŸ“‹ ì„¤ì • ë°©ë²•:</h3>
          <ol class="text-xs text-gray-300 space-y-1 list-decimal list-inside">
            <li>Google Apps Script í”„ë¡œì íŠ¸ ì—´ê¸°</li>
            <li>Code.gs íŒŒì¼ ë³µì‚¬í•˜ì—¬ ë¶™ì—¬ë„£ê¸°</li>
            <li>ë°°í¬ â†’ ìƒˆ ë°°í¬ í´ë¦­</li>
            <li>ìœ í˜•: "ì›¹ ì•±"ìœ¼ë¡œ ì„ íƒ</li>
            <li>ì•¡ì„¸ìŠ¤ ê¶Œí•œ: "ëª¨ë“  ì‚¬ìš©ì"ë¡œ ì„¤ì •</li>
            <li>ë°°í¬ ë²„íŠ¼ í´ë¦­</li>
            <li>ìƒì„±ëœ URL ë³µì‚¬</li>
          </ol>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">
            Apps Script ë°°í¬ URL:
          </label>
          <input
            id="apps-script-url-input"
            type="text"
            placeholder="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec"
            class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-sm text-white focus:border-amber-500 focus:outline-none"
          />
        </div>

        <div id="url-status-message" class="text-sm"></div>

        <div class="flex gap-2">
          <button id="save-url-btn" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md">
            ì €ì¥
          </button>
          <button id="test-url-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md">
            ì—°ê²° í…ŒìŠ¤íŠ¸
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ ëª¨ë‹¬ -->
  <div id="registration-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0">
    <div class="bg-gray-800 rounded-lg p-4 max-w-lg w-full max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-bold text-amber-400">ê´€ë¦¬ ì„¤ì •</h2>
        <button id="close-registration-modal" class="text-2xl hover:text-gray-400">&times;</button>
      </div>

      <!-- ë©”ì¸ ê´€ë¦¬ ë²„íŠ¼ë“¤ -->
      <div id="management-menu" class="space-y-3 mb-4">
        <!-- ë²„íŠ¼ë“¤ -->
        <div class="grid grid-cols-2 gap-3">
          <button id="open-table-management-btn" class="bg-blue-600 hover:bg-blue-700 py-3 px-4 rounded-lg text-sm font-medium flex flex-col items-center">
            <span class="text-2xl mb-1">ğŸ¯</span>
            <span>í…Œì´ë¸” ì„ íƒ</span>
          </button>
          <button class="bg-gray-700 py-3 px-4 rounded-lg text-sm font-medium flex flex-col items-center opacity-50 cursor-not-allowed" disabled>
            <span class="text-2xl mb-1">ğŸ²</span>
            <span>ì¹© ê´€ë¦¬</span>
            <span class="text-xs text-gray-400">(ì¤€ë¹„ ì¤‘)</span>
          </button>
        </div>

        <!-- Apps Script URL ì„¤ì • -->
        <div class="bg-gray-700 p-3 rounded-lg">
          <label class="block text-sm font-medium text-gray-300 mb-2">
            Apps Script URL
            <span class="text-xs text-gray-500 ml-2">(ì¬ë°°í¬ í›„ ìƒˆ URL ì…ë ¥)</span>
          </label>
          <div class="space-y-2">
            <!-- í˜„ì¬ ì €ì¥ëœ URL í‘œì‹œ -->
            <div id="current-url-display" class="bg-gray-800 p-2 rounded border border-gray-600">
              <div class="text-xs text-gray-400 mb-1">í˜„ì¬ ì €ì¥ëœ URL:</div>
              <div id="management-current-url" class="text-xs text-amber-400 break-all font-mono"></div>
            </div>

            <!-- ì¬ë°°í¬ ì•ˆë‚´ ë©”ì‹œì§€ -->
            <div class="bg-blue-900 border border-blue-700 p-2 rounded text-xs">
              <div class="text-blue-300 font-semibold mb-1">ğŸ“Œ Apps Script ì¬ë°°í¬ í•„ìš”</div>
              <div class="text-blue-200">
                "Unknown action: batchUpdate" ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´:
                <ol class="list-decimal list-inside mt-1 text-blue-100">
                  <li>apps-script/Code_v59_InOut.gs íŒŒì¼ ë³µì‚¬</li>
                  <li>Google Apps Scriptì— ë¶™ì—¬ë„£ê¸°</li>
                  <li>ë°°í¬ â†’ ìƒˆ ë°°í¬ ê´€ë¦¬ â†’ í¸ì§‘ â†’ ë²„ì „: ìƒˆ ë²„ì „</li>
                  <li>ìƒˆ URLì„ ì•„ë˜ì— ì…ë ¥í•˜ì—¬ ì €ì¥</li>
                </ol>
              </div>
            </div>

            <!-- URL ì…ë ¥ -->
            <input type="text" id="management-apps-url-input"
                   class="w-full bg-gray-600 text-white rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"
                   placeholder="ìƒˆ URLì„ ì…ë ¥í•˜ì„¸ìš”">

            <!-- ì €ì¥ ë²„íŠ¼ -->
            <button id="save-apps-url-btn" class="w-full bg-amber-600 hover:bg-amber-700 py-1.5 rounded text-sm font-medium">
              ğŸ’¾ ìƒˆ URL ì €ì¥
            </button>

            <!-- ì €ì¥ ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="url-save-status" class="hidden text-xs p-2 rounded"></div>
          </div>
        </div>
      </div>

      <!-- í…Œì´ë¸” ê´€ë¦¬ ì„¹ì…˜ (ì´ˆê¸°ì— ìˆ¨ê¹€) -->
      <div id="player-management-content" class="space-y-3 hidden">
          <!-- ì„ íƒëœ í…Œì´ë¸” ì •ë³´ -->
          <div class="bg-gray-700 p-3 rounded-lg">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-bold text-amber-400">ì„ íƒëœ í…Œì´ë¸”</h4>
              <span id="sync-status" class="text-xs text-gray-400"></span>
            </div>
            <div id="selected-table-info" class="text-sm">
              <span id="selected-table-name" class="text-amber-400 font-bold"></span>
              <button id="change-table-btn" class="ml-2 text-xs bg-gray-600 hover:bg-gray-500 px-2 py-1 rounded">ë³€ê²½</button>
            </div>
          </div>

          <!-- ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ ì„¹ì…˜ -->
          <div id="player-add-section" class="bg-gray-700 p-3 rounded-lg hidden">
            <h4 class="text-sm font-bold mb-2 text-amber-400">í”Œë ˆì´ì–´ ì¶”ê°€</h4>
            <div class="grid grid-cols-3 gap-2 mb-2">
              <input type="text" id="new-player-name" class="bg-gray-600 px-2 py-1 rounded text-sm" placeholder="ì´ë¦„">
              <input type="number" id="new-player-seat" class="bg-gray-600 px-2 py-1 rounded text-sm" placeholder="#ì¢Œì„" min="1" max="10">
              <input type="text" id="new-player-chips" class="bg-gray-600 px-2 py-1 rounded text-sm" placeholder="ì¹©">
            </div>
            <button id="add-player-local-btn" class="w-full bg-green-600 hover:bg-green-700 py-1 rounded text-sm">+ ì¶”ê°€</button>
          </div>

          <!-- í˜„ì¬ í”Œë ˆì´ì–´ ëª©ë¡ (10ê°œ ì‹œíŠ¸ ê³ ì •) -->
          <div id="player-list-section" class="bg-gray-700 p-3 rounded-lg hidden">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-sm font-bold text-amber-400">í”Œë ˆì´ì–´ ì‹œíŠ¸</h4>
              <span id="player-count" class="text-xs text-amber-300"></span>
            </div>
            <div id="current-players-list" class="h-auto">
              <!-- 10ê°œ ì‹œíŠ¸ê°€ ê³ ì •ìœ¼ë¡œ í‘œì‹œë¨ -->
            </div>
          </div>

          <!-- ì¼ê´„ ë“±ë¡ ë²„íŠ¼ -->
          <div id="batch-actions" class="hidden">
            <div class="flex gap-2 mb-2">
              <button id="reset-changes-btn" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded text-sm">
                â†©ï¸ ë³€ê²½ ì·¨ì†Œ
              </button>
              <button id="batch-register-btn" class="flex-1 bg-amber-600 hover:bg-amber-700 py-2 rounded text-sm font-bold">
                âœ… ì¼ê´„ ë“±ë¡
              </button>
            </div>
            <div id="changes-summary" class="mt-2 text-xs text-gray-400"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="log-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 hidden opacity-0">
    <div class="bg-gray-800 rounded-lg p-4 w-full max-w-lg h-2/3 flex flex-col">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-xl font-bold text-amber-400">ë¡œë”© ë¡œê·¸</h2>
        <button id="close-log-modal" class="text-2xl">&times;</button>
      </div>
      <div id="log-display" class="bg-gray-900/50 p-3 rounded-md flex-grow overflow-y-auto text-sm font-mono"></div>
    </div>
  </div>

  <!-- ì¹© ì»¬ëŸ¬ ì„ íƒ ëª¨ë‹¬ (ì¹´ë©”ë¼ ë˜ëŠ” íŒŒì¼) -->
  <div id="chip-color-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg p-4 max-w-md w-full">
        <h3 class="text-lg font-bold mb-3 text-amber-400">ì¹© ë“±ë¡</h3>
        
        <!-- ì„ íƒ ì˜µì…˜ -->
        <div id="chip-option-select" class="mb-4">
          <p class="text-sm text-gray-300 mb-3">ì¹© ì‚¬ì§„ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”:</p>
          <div class="grid grid-cols-2 gap-2">
            <!-- ì¹´ë©”ë¼ ê¸°ëŠ¥ ì œê±°ë¨ (v3.5.27) -->
            <!-- <button id="select-camera-btn" class="bg-blue-600 hover:bg-blue-700 p-3 rounded-lg flex flex-col items-center">
              <span class="text-2xl mb-1">ğŸ“·</span>
              <span class="text-sm">ì‚¬ì§„ ì´¬ì˜</span>
            </button> -->
            <button id="select-file-btn" class="bg-purple-600 hover:bg-purple-700 p-3 rounded-lg flex flex-col items-center">
              <span class="text-2xl mb-1">ğŸ“</span>
              <span class="text-sm">íŒŒì¼ ì„ íƒ</span>
            </button>
          </div>
        </div>
        
        <!-- ì¹´ë©”ë¼ ë·° ì œê±°ë¨ (v3.5.27) -->
        <!-- <div id="camera-view" class="hidden">
          <video id="chip-video" class="w-full rounded-lg mb-3" autoplay playsinline></video>
          <canvas id="chip-canvas" class="hidden"></canvas> -->
        </div>
        
        <!-- ì´ë¯¸ì§€ í”„ë¦¬ë·° (ìˆ¨ê¹€ ìƒíƒœ) -->
        <div id="image-preview" class="hidden">
          <img id="preview-img" class="w-full rounded-lg mb-3" alt="ë¯¸ë¦¬ë³´ê¸°">
        </div>
        
        <!-- íŒŒì¼ ì…ë ¥ (ìˆ¨ê¹€) -->
        <input type="file" id="file-input" class="hidden" accept="image/*">
        
        <!-- ì¹© ê°’ ì…ë ¥ -->
        <input type="text" id="chip-value-input" class="w-full bg-gray-700 px-3 py-2 rounded mb-3" placeholder="ì¹© ê°’ (ì˜ˆ: 1000)">
        
        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="flex gap-2">
          <button id="capture-chip-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium hidden">ì´¬ì˜</button>
          <button id="confirm-chip-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium hidden">í™•ì¸</button>
          <button id="retry-chip-btn" class="flex-1 bg-yellow-600 hover:bg-yellow-700 py-2 rounded-lg font-medium hidden">ë‹¤ì‹œì„ íƒ</button>
          <button id="close-chip-modal" class="flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-medium">ì·¨ì†Œ</button>
        </div>
        
        <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
        <div id="chip-info-message" class="mt-3 text-xs text-gray-400 text-center">
          ğŸ’¡ PCì—ì„œëŠ” íŒŒì¼ ì„ íƒ, ëª¨ë°”ì¼ì—ì„œëŠ” ì¹´ë©”ë¼ ì´¬ì˜ì„ ê¶Œì¥í•©ë‹ˆë‹¤
        </div>
      </div>
    </div>
  </div>

  <!-- ì¹© ìŠ¤íƒ ë¶„ì„ ëª¨ë‹¬ -->
  <div id="stack-analysis-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg p-4 max-w-lg w-full max-h-[90vh] overflow-y-auto">
        <h3 class="text-lg font-bold mb-3 text-amber-400">
          <span id="analyzing-player-name">í”Œë ˆì´ì–´</span> ì¹© ìŠ¤íƒ ë¶„ì„
        </h3>
        <div id="stack-images-container" class="grid grid-cols-2 gap-2 mb-3"></div>
        <video id="stack-video" class="w-full rounded-lg mb-3" autoplay playsinline></video>
        <canvas id="stack-canvas" class="hidden"></canvas>
        <div class="flex gap-2 mb-3">
          <button id="capture-stack-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 py-2 rounded-lg font-medium">ì‚¬ì§„ ì¶”ê°€</button>
          <button id="analyze-stack-btn" class="flex-1 bg-green-600 hover:bg-green-700 py-2 rounded-lg font-medium" disabled>AI ë¶„ì„</button>
        </div>
        <button id="close-stack-modal" class="w-full bg-gray-600 hover:bg-gray-700 py-2 rounded-lg font-medium">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- AI ë¶„ì„ ì¤‘ ì˜¤ë²„ë ˆì´ -->
  <div id="analyzing-overlay" class="fixed inset-0 bg-black bg-opacity-80 hidden z-[60]">
    <div class="flex items-center justify-center h-full">
      <div class="bg-gray-900 rounded-lg p-6 text-center">
        <div class="text-3xl mb-3 pulse-animation">ğŸ¤–</div>
        <p class="text-lg font-medium mb-2">AI ë¶„ì„ ì¤‘...</p>
        <p class="text-sm text-gray-400">ì¹© ìŠ¤íƒì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
      </div>
    </div>
  </div>

  <!-- í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ -->
  <div id="table-selector-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-2">
      <div class="bg-gray-800 rounded-lg w-full max-w-md h-full max-h-screen flex flex-col">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between p-4 border-b border-gray-700">
          <h3 class="text-lg font-bold text-amber-400">ğŸ¯ í…Œì´ë¸” ì„ íƒ</h3>
          <button id="close-table-selector" class="text-gray-400 hover:text-white text-xl">Ã—</button>
        </div>
        
        <!-- ê²€ìƒ‰ ë° í•„í„° -->
        <div class="p-4 border-b border-gray-700">
          <input type="text" id="table-search" placeholder="í…Œì´ë¸” ë²ˆí˜¸ ë˜ëŠ” í”Œë ˆì´ì–´ ê²€ìƒ‰..." 
                 class="w-full bg-gray-700 border border-gray-600 rounded-md px-3 py-2 text-sm mb-3">
          <div class="flex gap-2 flex-wrap">
            <button id="filter-all" class="filter-btn px-3 py-1 rounded-full text-xs bg-blue-600 text-white">ì „ì²´</button>
            <button id="filter-active" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-600 hover:bg-gray-500">í™œì„±</button>
            <button id="filter-empty" class="filter-btn px-3 py-1 rounded-full text-xs bg-gray-600 hover:bg-gray-500">ë¹ˆí…Œì´ë¸”</button>
          </div>
        </div>
        
        <!-- í˜ì´ì§€ í† ê¸€ -->
        <div class="px-4 py-2 border-b border-gray-700">
          <div class="flex items-center justify-between">
            <button id="prev-page" class="px-3 py-1 bg-gray-600 rounded hover:bg-gray-500 disabled:opacity-50">â—€</button>
            <span id="page-info" class="text-sm text-gray-400">1-20 / 100</span>
            <button id="next-page" class="px-3 py-1 bg-gray-600 rounded hover:bg-gray-500 disabled:opacity-50">â–¶</button>
          </div>
        </div>
        
        <!-- í…Œì´ë¸” ê·¸ë¦¬ë“œ -->
        <div class="flex-1 overflow-y-auto p-4">
          <div id="table-grid" class="grid grid-cols-4 gap-2">
            <!-- í…Œì´ë¸” ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • ëª¨ë‹¬ -->
  <div id="settings-modal" class="modal fixed inset-0 bg-black bg-opacity-75 hidden z-50">
    <div class="flex items-center justify-center h-full p-4">
      <div class="bg-gray-800 rounded-lg w-full max-w-lg">
        <!-- í—¤ë” -->
        <div class="flex items-center justify-between p-4 border-b border-gray-700">
          <h3 class="text-lg font-bold text-amber-400">âš™ï¸ ì„¤ì •</h3>
          <button id="close-settings" class="text-gray-400 hover:text-white text-xl">Ã—</button>
        </div>
        
        <!-- ì„¤ì • ë‚´ìš© -->
        <div class="p-4 space-y-4">
          <!-- Apps Script URL ì„¤ì • -->
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">
              Apps Script URL
              <span class="text-xs text-gray-500 ml-2">(ì¬ë°°í¬ í›„ ìƒˆ URL ì…ë ¥)</span>
            </label>
            <div class="space-y-2">
              <input type="text" id="apps-script-url-input"
                     class="w-full bg-gray-700 text-white rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-amber-500"
                     placeholder="https://script.google.com/macros/s/.../exec">
              <div class="text-xs text-gray-500">
                í˜„ì¬: <span id="current-apps-url" class="text-gray-400 break-all"></span>
              </div>

              <!-- í´ë¼ìš°ë“œ ë™ê¸°í™” ìƒíƒœ -->
              <div class="bg-gray-700 rounded-md p-3 space-y-2">
                <div class="flex items-center justify-between">
                  <span class="text-xs font-medium text-gray-300">â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™”</span>
                  <span id="cloud-sync-status" class="text-xs px-2 py-1 rounded-full bg-gray-600 text-gray-400">í™•ì¸ ì¤‘...</span>
                </div>
                <div class="text-xs text-gray-500 space-y-1">
                  <div>ê¸°ê¸° ID: <span id="device-id-display" class="text-gray-400 font-mono text-xs"></span></div>
                  <div id="last-sync-display" class="hidden">ë§ˆì§€ë§‰ ë™ê¸°í™”: <span class="text-gray-400"></span></div>
                </div>
                <div class="flex space-x-2">
                  <button id="sync-now-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-xs py-1.5 px-3 rounded transition-colors">
                    ğŸ”„ ì§€ê¸ˆ ë™ê¸°í™”
                  </button>
                  <button id="reset-cloud-btn" class="bg-gray-600 hover:bg-gray-500 text-white text-xs py-1.5 px-3 rounded transition-colors">
                    ğŸ—‘ï¸ ì´ˆê¸°í™”
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- ì¹© ìŠ¤íƒ ê²€ì¦ ì„¤ì • -->
          <div>
            <label class="flex items-center space-x-2">
              <input type="checkbox" id="chip-validation-toggle" class="rounded text-amber-500 focus:ring-amber-500">
              <span class="text-sm font-medium text-gray-300">ì¹© ìŠ¤íƒ ê²€ì¦ í™œì„±í™”</span>
            </label>
            <p class="text-xs text-gray-500 mt-1 ml-6">
              í™œì„±í™” ì‹œ ë³´ìœ  ì¹©ë³´ë‹¤ í° ê¸ˆì•¡ ì…ë ¥ì„ ì œí•œí•©ë‹ˆë‹¤
            </p>
          </div>
          
          <!-- ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ ì„¤ì • -->
          <div>
            <label class="flex items-center space-x-2">
              <input type="checkbox" id="action-input-mode-toggle" class="rounded text-amber-500 focus:ring-amber-500">
              <span class="text-sm font-medium text-gray-300">ìë™ ì•¡ì…˜ ë§¤í•‘ ëª¨ë“œ</span>
            </label>
            <p class="text-xs text-gray-500 mt-1 ml-6">
              í™œì„±í™” ì‹œ ì•¡ì…˜ì´ ìˆœì„œëŒ€ë¡œ ìë™ ë§¤í•‘ë©ë‹ˆë‹¤ (í”Œë ˆì´ì–´ ì„ íƒ ë¶ˆí•„ìš”)
            </p>
          </div>
          
          <!-- ë²„ì „ ì •ë³´ -->
          <div class="pt-2 border-t border-gray-700">
            <div class="text-xs text-gray-500 space-y-1">
              <div>ë²„ì „: <span class="text-gray-400">${APP_VERSION}</span></div>
              <div>ì—…ë°ì´íŠ¸: <span class="text-gray-400">${VERSION_DATE}</span></div>
              <div>Sheet ID: <span class="text-gray-400 text-xs">1J-lf8bYTLPbpdhieUNdb8ckW_uwdQ3MtSBLmyRIwH7U</span></div>
            </div>
          </div>
        </div>
        
        <!-- í‘¸í„° -->
        <div class="flex justify-end gap-2 p-4 border-t border-gray-700">
          <button id="cancel-settings" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded-md text-sm font-medium">
            ì·¨ì†Œ
          </button>
          <button id="save-settings" class="px-4 py-2 bg-amber-600 hover:bg-amber-500 rounded-md text-sm font-medium">
            ì €ì¥
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
  /**
   * ============================================
   * í¬ì»¤ í•¸ë“œ ë¡œê±° - Main JavaScript
   * ë²„ì „ ê´€ë¦¬ëŠ” APP_VERSION ìƒìˆ˜ë¥¼ í†µí•´ ì¤‘ì•™í™”ë¨
   * Author: garimto81 with Claude
   * ============================================
   */
  
  // ========================================
  // ì¤‘ì•™ ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ
  // ========================================
  const APP_VERSION = 'v3.5.29';
  const VERSION_DATE = '2025-09-22';
  const VERSION_INFO = `í¬ì»¤ í•¸ë“œ ë¡œê±° ${APP_VERSION} (${VERSION_DATE})`;

  // ========================================
  // seatNo ì•ˆì „ ì²˜ë¦¬ í—¬í¼ í•¨ìˆ˜
  // ========================================
  function parseSeatNo(seatNo) {
    if (!seatNo) return 0;
    const seatStr = String(seatNo).replace('#', '');
    const parsed = parseInt(seatStr);
    return isNaN(parsed) ? 0 : parsed;
  }

  // ========================================
  // ìŠ¤íŠ¸ë¦¿ ìë™ ì§„í–‰ ì‹œìŠ¤í…œ v2.0 - ì™„ë²½í•œ ë³´ì•ˆ êµ¬í˜„
  // ========================================

  // Layer 1: ì‹œí€€ìŠ¤ ê¸°ë°˜ íƒ€ì„ìŠ¤íƒ¬í”„ (ë¡œê¹… ì „ìš©)
  class SequentialTimekeeper {
    constructor() {
      this.sequence = 0;
      this.lastTimestamp = Date.now();
    }

    generateTimestamp() {
      const now = Date.now();
      this.sequence++;

      // ë¡œê¹…ë§Œ í•˜ê³  í•­ìƒ ìœ íš¨í•œ íƒ€ì„ìŠ¤íƒ¬í”„ ë°˜í™˜
      console.log(`ì•¡ì…˜ íƒ€ì„ìŠ¤íƒ¬í”„: #${this.sequence} at ${new Date(now).toLocaleTimeString()}`);

      return {
        sequence: this.sequence,
        timestamp: now,
        hash: this.hashTimestamp(this.sequence, now)
      };
    }

    validateAndUpdate(actionTimestamp) {
      // í•­ìƒ true ë°˜í™˜ - ëª¨ë“  ì•¡ì…˜ í—ˆìš©
      this.lastTimestamp = actionTimestamp.timestamp;
      return true;
    }

    hashTimestamp(sequence, timestamp) {
      return btoa(`${sequence}-${timestamp}-${window.location.hostname}`);
    }
  }

  // Layer 2: íŠ¸ë˜í”½ ëª¨ë‹ˆí„°ë§ (ë¡œê¹… ì „ìš©)
  class RateLimiter {
    constructor() {
      this.attempts = new Map();
      this.actionCount = 0;
    }

    check(playerId, actionType = 'action') {
      const now = Date.now();
      const window = 1000;

      // ì•¡ì…˜ ì¹´ìš´íŠ¸ ì¦ê°€
      this.actionCount++;

      // í†µê³„ ë¡œê¹…ë§Œ
      const key = `${playerId}-${Math.floor(now / window)}`;
      const attempts = this.attempts.get(key) || 0;
      this.attempts.set(key, attempts + 1);

      if (attempts >= 3) {
        console.log(`ë¹ ë¥¸ ì•¡ì…˜ ê°ì§€: ${playerId} - ${attempts + 1}íšŒ/ì´ˆ`);
      }

      // ì˜¤ë˜ëœ ê¸°ë¡ ì •ë¦¬
      if (this.attempts.size > 100) {
        const oldKeys = Array.from(this.attempts.keys()).slice(0, 50);
        oldKeys.forEach(k => this.attempts.delete(k));
      }

      // í•­ìƒ true ë°˜í™˜ - ëª¨ë“  ì•¡ì…˜ í—ˆìš©
      return true;
    }
  }

  // Layer 3: ìƒíƒœ ëª¨ë‹ˆí„°ë§ (ìë™ ì ì‘)
  class StateValidator {
    constructor() {
      this.knownPlayers = new Set();
      this.stateHash = null;
    }

    initialize(players) {
      // ì´ˆê¸° í”Œë ˆì´ì–´ ë“±ë¡
      players.forEach(p => this.knownPlayers.add(p.name));
      this.stateHash = this.calculateHash(players);
    }

    validatePlayer(playerName) {
      // ìƒˆ í”Œë ˆì´ì–´ ìë™ ì¶”ê°€
      if (!this.knownPlayers.has(playerName)) {
        console.log(`ìƒˆ í”Œë ˆì´ì–´ ìë™ ë“±ë¡: ${playerName}`);
        this.knownPlayers.add(playerName);

        // playersInHandì—ë„ ìë™ ì¶”ê°€
        if (!window.state.playersInHand.find(p => p.name === playerName)) {
          window.state.playersInHand.push({
            name: playerName,
            chips: '100000', // ê¸°ë³¸ ì¹©
            initialChips: '100000',
            hand: [],
            role: null
          });
        }
      }
      return true; // í•­ìƒ true ë°˜í™˜
    }

    validateState(state) {
      // ìƒíƒœ ë¡œê¹…ë§Œ
      console.log(`í˜„ì¬ í”Œë ˆì´ì–´ ìˆ˜: ${state.playersInHand.length}`);
      return true; // í•­ìƒ true ë°˜í™˜
    }

    updateState() {
      // ìƒíƒœ ì—…ë°ì´íŠ¸ (ë¡œê¹…ìš©)
      console.log('ìƒíƒœ ì—…ë°ì´íŠ¸');
      return true;
    }

    calculateHash(data) {
      return JSON.stringify(data).split('').reduce((a, b) => {
        a = ((a << 5) - a) + b.charCodeAt(0);
        return a & a;
      }, 0).toString(16);
    }
  }

  // ë©”ì¸ ì•¡ì…˜ ê´€ë¦¬ì (ê¸°ì¡´ + ë³´ì•ˆ ê°•í™”)
  class ActionOrderManager {
    constructor() {
      this.currentStreet = 'preflop';
      this.currentPlayerIndex = 0;
      this.actionMode = 'auto'; // 'auto' | 'manual'
      this.actionQueue = [];
      this.bettingRoundComplete = false;

      // ë³´ì•ˆ ë ˆì´ì–´ ì¶”ê°€
      this.timekeeper = new SequentialTimekeeper();
      this.rateLimiter = new RateLimiter();
      this.stateValidator = new StateValidator();

      // ì•¡ì…˜ ë®¤í…ìŠ¤ (ë™ì‹œ ì‹¤í–‰ ë°©ì§€)
      this.isProcessing = false;
    }

    // í¬ì§€ì…˜ë³„ ì•¡ì…˜ ìˆœì„œ ê³„ì‚°
    calculateActionOrder(street) {
      const playersInHand = window.state.playersInHand || [];
      if (playersInHand.length === 0) return [];

      const buttonPosition = parseInt(window.state.buttonPosition) || 1;
      const activePlayers = this.getActivePlayers(playersInHand);

      if (street === 'preflop') {
        return this.getPreflopOrder(activePlayers, buttonPosition);
      } else {
        return this.getPostflopOrder(activePlayers, buttonPosition);
      }
    }

    // í™œì„± í”Œë ˆì´ì–´ í•„í„°ë§ (í´ë“œ/ì˜¬ì¸ ì œì™¸)
    getActivePlayers(players) {
      return players.filter(p =>
        window.state.playerStatus[p.name] !== 'folded' &&
        window.state.playerStatus[p.name] !== 'allin'
      );
    }

    // í”„ë¦¬í”Œë ìˆœì„œ (UTG â†’ BTN â†’ SB â†’ BB)
    getPreflopOrder(players, buttonPosition) {
      if (players.length === 0) return [];

      const seatMap = {};
      players.forEach(p => {
        const seatNum = parseSeatNo(p.seatNo || p.seat);
        if (seatNum > 0) seatMap[seatNum] = p;
      });

      const occupiedSeats = Object.keys(seatMap).map(Number).sort((a, b) => a - b);
      const order = [];

      // UTGë¶€í„° ì‹œì‘í•˜ì—¬ BTNê¹Œì§€
      let utgSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      if (occupiedSeats.length > 2) {
        utgSeat = this.getNextOccupiedSeat(utgSeat, occupiedSeats); // SB ìŠ¤í‚µ
        utgSeat = this.getNextOccupiedSeat(utgSeat, occupiedSeats); // BB ìŠ¤í‚µ
      }

      let currentSeat = utgSeat;
      const visited = new Set();

      while (!visited.has(currentSeat) && order.length < players.length) {
        visited.add(currentSeat);
        if (seatMap[currentSeat]) {
          order.push(seatMap[currentSeat]);
        }
        currentSeat = this.getNextOccupiedSeat(currentSeat, occupiedSeats);

        // BTNê¹Œì§€ ë„ë‹¬í–ˆìœ¼ë©´ SB, BB ì¶”ê°€
        if (currentSeat === buttonPosition) {
          if (seatMap[currentSeat]) order.push(seatMap[currentSeat]);

          // SB ì¶”ê°€
          const sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
          if (seatMap[sbSeat]) order.push(seatMap[sbSeat]);

          // BB ì¶”ê°€
          const bbSeat = this.getNextOccupiedSeat(sbSeat, occupiedSeats);
          if (seatMap[bbSeat]) order.push(seatMap[bbSeat]);
          break;
        }
      }

      return order;
    }

    // í¬ìŠ¤íŠ¸í”Œë ìˆœì„œ (SB â†’ BB â†’ UTG â†’ BTN)
    getPostflopOrder(players, buttonPosition) {
      if (players.length === 0) return [];

      const seatMap = {};
      players.forEach(p => {
        const seatNum = parseSeatNo(p.seatNo || p.seat);
        if (seatNum > 0) seatMap[seatNum] = p;
      });

      const occupiedSeats = Object.keys(seatMap).map(Number).sort((a, b) => a - b);
      const order = [];

      // SBë¶€í„° ì‹œì‘
      let sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      let currentSeat = sbSeat;
      const visited = new Set();

      while (!visited.has(currentSeat) && order.length < players.length) {
        visited.add(currentSeat);
        if (seatMap[currentSeat]) {
          order.push(seatMap[currentSeat]);
        }
        currentSeat = this.getNextOccupiedSeat(currentSeat, occupiedSeats);
      }

      return order;
    }

    // ë‹¤ìŒ ì ìœ ëœ ì¢Œì„ ì°¾ê¸°
    getNextOccupiedSeat(currentSeat, occupiedSeats) {
      const maxSeat = Math.max(...occupiedSeats);
      let nextSeat = currentSeat + 1;

      while (nextSeat <= maxSeat + occupiedSeats.length) {
        const seat = ((nextSeat - 1) % maxSeat) + 1;
        if (occupiedSeats.includes(seat)) {
          return seat;
        }
        nextSeat++;
      }

      return occupiedSeats[0];
    }

    // í˜„ì¬ ì•¡ì…˜í•  í”Œë ˆì´ì–´ ë°˜í™˜
    getCurrentActionPlayer() {
      if (this.actionMode === 'manual') return null;

      const actionOrder = this.calculateActionOrder(this.currentStreet);
      if (actionOrder.length === 0) return null;

      return actionOrder[this.currentPlayerIndex % actionOrder.length];
    }

    // ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ì´ë™
    moveToNextPlayer() {
      const actionOrder = this.calculateActionOrder(this.currentStreet);
      if (actionOrder.length === 0) return null;

      this.currentPlayerIndex++;

      // ë² íŒ… ë¼ìš´ë“œ ì™„ë£Œ ì²´í¬
      if (this.currentPlayerIndex >= actionOrder.length) {
        if (this.isBettingRoundComplete()) {
          this.advanceToNextStreet();
          return null;
        } else {
          this.currentPlayerIndex = 0; // ë‹¤ì‹œ ì²˜ìŒë¶€í„°
        }
      }

      return this.getCurrentActionPlayer();
    }

    // ë² íŒ… ë¼ìš´ë“œ ì™„ë£Œ ì—¬ë¶€ ì²´í¬ (íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ í¬í•¨)
    isBettingRoundComplete() {
      const actions = window.state.actionState[this.currentStreet] || [];
      const activePlayers = this.getActivePlayers(window.state.playersInHand || []);
      const allPlayers = window.state.playersInHand || [];

      // íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ 1: 1ëª…ë§Œ ë‚¨ì€ ê²½ìš° (ë‚˜ë¨¸ì§€ í´ë“œ)
      if (activePlayers.length <= 1) {
        console.log('ğŸ† 1ëª…ë§Œ ë‚¨ìŒ - ë¼ìš´ë“œ ì™„ë£Œ');
        return true;
      }

      // íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ 2: í—¤ì¦ˆì—…ì—ì„œ BB ì²´í¬ ì˜µì…˜
      if (allPlayers.length === 2 && this.currentStreet === 'preflop') {
        const bbPlayer = this.getBigBlindPlayer();
        const sbPlayer = this.getSmallBlindPlayer();

        if (bbPlayer && sbPlayer) {
          const bbActions = actions.filter(a => a.player === bbPlayer.name);
          const sbActions = actions.filter(a => a.player === sbPlayer.name);

          // SBê°€ ì½œí–ˆê³  BBê°€ ì²´í¬í•œ ê²½ìš°
          if (sbActions.some(a => a.action === 'Calls') &&
              bbActions.some(a => a.action === 'Checks')) {
            console.log('ğŸ¯ í—¤ì¦ˆì—… BB ì²´í¬ - ë¼ìš´ë“œ ì™„ë£Œ');
            return true;
          }
        }
      }

      // íŠ¹ìˆ˜ ì¼€ì´ìŠ¤ 3: ëª¨ë“  í™œì„± í”Œë ˆì´ì–´ê°€ ì˜¬ì¸ì¸ ê²½ìš°
      const allActiveAreAllIn = activePlayers.every(p =>
        window.state.playerStatus[p.name] === 'allin'
      );
      if (allActiveAreAllIn && activePlayers.length > 0) {
        console.log('ğŸš€ ëª¨ë“  í”Œë ˆì´ì–´ ì˜¬ì¸ - ë¼ìš´ë“œ ì™„ë£Œ');
        return true;
      }

      // ì¼ë°˜ ì¼€ì´ìŠ¤: ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜í–ˆëŠ”ì§€ í™•ì¸
      const playersActed = new Set(actions.map(a => a.player));
      const allActed = activePlayers.every(p => playersActed.has(p.name));

      if (!allActed) return false;

      // ë² íŒ… ê¸ˆì•¡ì´ ë§ëŠ”ì§€ í™•ì¸
      return this.areAllBetsEqual(activePlayers, actions);
    }

    // ë¹…ë¸”ë¼ì¸ë“œ í”Œë ˆì´ì–´ ì°¾ê¸°
    getBigBlindPlayer() {
      const buttonPosition = parseInt(window.state.buttonPosition) || 1;
      const players = window.state.playersInHand || [];
      const occupiedSeats = players.map(p => parseSeatNo(p.seatNo || p.seat)).filter(s => s > 0).sort((a, b) => a - b);

      if (occupiedSeats.length < 2) return null;

      const sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      const bbSeat = this.getNextOccupiedSeat(sbSeat, occupiedSeats);

      return players.find(p => parseSeatNo(p.seatNo || p.seat) === bbSeat);
    }

    // ìŠ¤ëª°ë¸”ë¼ì¸ë“œ í”Œë ˆì´ì–´ ì°¾ê¸°
    getSmallBlindPlayer() {
      const buttonPosition = parseInt(window.state.buttonPosition) || 1;
      const players = window.state.playersInHand || [];
      const occupiedSeats = players.map(p => parseSeatNo(p.seatNo || p.seat)).filter(s => s > 0).sort((a, b) => a - b);

      if (occupiedSeats.length < 2) return null;

      const sbSeat = this.getNextOccupiedSeat(buttonPosition, occupiedSeats);
      return players.find(p => parseSeatNo(p.seatNo || p.seat) === sbSeat);
    }

    // ëª¨ë“  ë² íŒ…ì´ ê°™ì€ì§€ í™•ì¸ (ì‚¬ì´ë“œíŒŸ ê³ ë ¤)
    areAllBetsEqual(players, actions) {
      const playerBets = {};

      // ê° í”Œë ˆì´ì–´ì˜ ì´ ë² íŒ… ê³„ì‚°
      actions.forEach(action => {
        if (!playerBets[action.player]) playerBets[action.player] = 0;

        if (action.action.includes('Call') || action.action.includes('Raise') || action.action.includes('Bet')) {
          playerBets[action.player] = action.amount || 0;
        } else if (action.action === 'All In') {
          const player = window.state.playersInHand.find(p => p.name === action.player);
          playerBets[action.player] = player ? parseInt(unformatNumber(player.chips), 10) : 0;
        }
      });

      const bets = Object.values(playerBets);
      const maxBet = Math.max(...bets, 0);

      // ì‚¬ì´ë“œíŒŸ ì¼€ì´ìŠ¤: ì˜¬ì¸ í”Œë ˆì´ì–´ê°€ ìˆëŠ” ê²½ìš°
      const hasAllIn = players.some(p => window.state.playerStatus[p.name] === 'allin');

      if (hasAllIn) {
        // ì˜¬ì¸ í”Œë ˆì´ì–´ë“¤ì˜ ë² íŒ… ê¸ˆì•¡
        const allInAmounts = players
          .filter(p => window.state.playerStatus[p.name] === 'allin')
          .map(p => playerBets[p.name] || 0);

        // ì•¡í‹°ë¸Œ í”Œë ˆì´ì–´ë“¤ì´ ìµœì†Œí•œ ì˜¬ì¸ ê¸ˆì•¡ ì´ìƒ ë² íŒ…í–ˆëŠ”ì§€ í™•ì¸
        return players.every(p => {
          const playerBet = playerBets[p.name] || 0;
          const isAllIn = window.state.playerStatus[p.name] === 'allin';

          if (isAllIn) {
            return true; // ì˜¬ì¸ í”Œë ˆì´ì–´ëŠ” í•­ìƒ OK
          }

          // ì•¡í‹°ë¸Œ í”Œë ˆì´ì–´ëŠ” ìµœëŒ€ ë² íŒ…ê³¼ ê°™ì•„ì•¼ í•¨
          return playerBet === maxBet;
        });
      }

      // ì¼ë°˜ ì¼€ì´ìŠ¤: ëª¨ë“  ì•¡í‹°ë¸Œ í”Œë ˆì´ì–´ì˜ ë² íŒ…ì´ ê°™ì•„ì•¼ í•¨
      return players.every(p => {
        const playerBet = playerBets[p.name] || 0;
        return playerBet === maxBet;
      });
    }

    // ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ì§„í–‰ (ë³´ì•ˆ ë ˆì´ì–´ í¬í•¨)
    async advanceToNextStreet() {
      const streets = ['preflop', 'flop', 'turn', 'river'];
      const currentIndex = streets.indexOf(this.currentStreet);

      if (currentIndex < streets.length - 1) {
        const nextStreet = streets[currentIndex + 1];

        // Layer 4: ë³´ë“œ ì¹´ë“œ ê²€ì¦
        if (nextStreet !== 'preflop' && !this.checkBoardCards(nextStreet)) {
          // ë³´ë“œ ì¹´ë“œ ì…ë ¥ í”„ë¡¬í”„íŠ¸
          this.promptForBoardCards(nextStreet);
          return;
        }

        // Layer 5: íŠ¸ëœì­ì…˜ ë³´í˜¸
        const transaction = this.startTransaction();
        try {
          // íƒ€ì„ìŠ¤íƒ¬í”„ ê²€ì¦
          const timestamp = this.timekeeper.generateTimestamp();

          // ìƒíƒœ ë³€ê²½
          this.currentStreet = nextStreet;
          this.currentPlayerIndex = 0;
          window.state.currentStreet = this.currentStreet;

          // ìƒíƒœ í•´ì‹œ ì—…ë°ì´íŠ¸
          this.stateValidator.updateState();

          console.log(`%cğŸ¯ ìë™ ì§„í–‰: ${this.currentStreet.toUpperCase()}`, 'color: #10b981; font-weight: bold');
          this.showStreetAdvanceNotification();

          // íŠ¸ëœì­ì…˜ ì»¤ë°‹
          transaction.commit();
        } catch (error) {
          // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ìµœëŒ€í•œ ì§„í–‰
          console.log('ìŠ¤íŠ¸ë¦¿ ì§„í–‰ ì¤‘ ì˜ˆì™¸:', error.message);
          transaction.rollback();
          // ê·¸ë˜ë„ ìŠ¤íŠ¸ë¦¿ì€ ì§„í–‰
          this.currentStreet = nextStreet;
          this.currentPlayerIndex = 0;
          window.state.currentStreet = this.currentStreet;
          this.showStreetAdvanceNotification();
        }
      }
    }

    // ë³´ë“œ ì¹´ë“œ í™•ì¸
    checkBoardCards(street) {
      const boardCards = window.state.boardCards || {};

      // ì´ì „ ìŠ¤íŠ¸ë¦¿ì˜ ì¹´ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
      switch(street) {
        case 'flop':
          // í”Œëìœ¼ë¡œ ê°ˆ ë•ŒëŠ” í”„ë¦¬í”Œëì´ë¯€ë¡œ ì¹´ë“œ ë¶ˆí•„ìš”
          return true;
        case 'turn':
          // í„´ìœ¼ë¡œ ê°ˆ ë•ŒëŠ” í”Œë ì¹´ë“œ 3ì¥ì´ ìˆì–´ì•¼ í•¨
          return boardCards.flop1 && boardCards.flop2 && boardCards.flop3;
        case 'river':
          // ë¦¬ë²„ë¡œ ê°ˆ ë•ŒëŠ” í„´ ì¹´ë“œê°€ ìˆì–´ì•¼ í•¨
          return boardCards.turn;
        default:
          return true;
      }
    }

    // ë³´ë“œ ì¹´ë“œ ì…ë ¥ í”„ë¡¬í”„íŠ¸ (v3.4.7 - ì¹´ë“œ ì„ íƒ UI ì‚¬ìš©)
    promptForBoardCards(street) {
      // ì¹´ë“œ ì„ íƒ UI ì—´ê¸° (openCardSelector ì‚¬ìš©)
      window.state.modalState.cardTarget = {
        target: 'board',
        count: street === 'flop' ? 3 : 1,
        street: street,
        player: null,
        index: street === 'turn' ? 3 : street === 'river' ? 4 : 0
      };

      // ê¸°ì¡´ ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ ì‚¬ìš© - window ê°ì²´ì—ì„œ í˜¸ì¶œ
      if (typeof window.openCardSelector === 'function') {
        window.openCardSelector();
      } else {
        console.error('openCardSelector í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    }

    // ë³´ë“œ ì¹´ë“œ ì €ì¥ (v3.4.7 - ì¹´ë“œ ì„ íƒ UIì™€ ì—°ë™)
    saveBoardCards(street) {
      // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì§ì ‘ í˜¸ì¶œë˜ì§€ ì•ŠìŒ
      // openCardSelectorì˜ assignCard í•¨ìˆ˜ê°€ ì²˜ë¦¬
      console.log('[v3.4.7] saveBoardCardsëŠ” deprecated - assignCard ì‚¬ìš©');
    }

    // ë³´ë“œ ì¹´ë“œ ê±´ë„ˆë›°ê¸° (v3.4.7 - ìˆ˜ì •ë¨, v3.5.28 window ì°¸ì¡° ì¶”ê°€)
    skipBoardCards(street) {
      console.log(`ë³´ë“œ ì¹´ë“œ ì…ë ¥ ê±´ë„ˆë›°ê¸°: ${street}`);
      // ë³´ë“œ ì¹´ë“œ ì—†ì´ ì§„í–‰
      this.currentStreet = street;
      this.currentPlayerIndex = 0;
      window.state.currentStreet = this.currentStreet;

      // showFeedback í•¨ìˆ˜ í™•ì¸ - window ê°ì²´ì—ì„œ ì°¸ì¡°
      if (typeof window.showFeedback === 'function') {
        window.showFeedback(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ì§„í–‰`, false);
      } else {
        console.log(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ì§„í–‰`);
      }
    }

    // íŠ¸ëœì­ì…˜ ì‹œì‘ (Layer 5)
    startTransaction() {
      const snapshot = {
        currentStreet: this.currentStreet,
        currentPlayerIndex: this.currentPlayerIndex,
        actionState: JSON.parse(JSON.stringify(window.state.actionState || {})),
        playerStatus: {...window.state.playerStatus}
      };

      return {
        commit: () => {
          console.log('íŠ¸ëœì­ì…˜ ì»¤ë°‹');
        },
        rollback: () => {
          this.currentStreet = snapshot.currentStreet;
          this.currentPlayerIndex = snapshot.currentPlayerIndex;
          window.state.actionState = snapshot.actionState;
          window.state.playerStatus = snapshot.playerStatus;
          console.error('íŠ¸ëœì­ì…˜ ë¡¤ë°±');
        }
      };
    }

    // ìŠ¤íŠ¸ë¦¿ ì§„í–‰ ì•Œë¦¼ (v3.4.7 - showFeedback í•¨ìˆ˜ ì²´í¬ ì¶”ê°€)
    showStreetAdvanceNotification() {
      if (typeof window.showFeedback === 'function') {
        window.showFeedback(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ìë™ ì§„í–‰`, false);
      } else {
        console.log(`ğŸ¯ ${this.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ìœ¼ë¡œ ìë™ ì§„í–‰`);
      }
    }

    // ëª¨ë“œ ì „í™˜
    toggleMode() {
      this.actionMode = this.actionMode === 'auto' ? 'manual' : 'auto';
      console.log(`%cì•¡ì…˜ ëª¨ë“œ ë³€ê²½: ${this.actionMode}`, 'color: #f59e0b; font-weight: bold');
      return this.actionMode;
    }
  }

  // ì „ì—­ ì•¡ì…˜ ê´€ë¦¬ì ì¸ìŠ¤í„´ìŠ¤ - í´ë˜ìŠ¤ ì •ì˜ ì§í›„ ì´ˆê¸°í™”
  window.actionManager = new ActionOrderManager();
  console.log('ActionOrderManager ì´ˆê¸°í™” ì™„ë£Œ');

  // ëª¨ë“  ë²„ì „ í‘œì‹œë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
  function updateAllVersionDisplays() {
    // ë²„ì „ í‘œì‹œ ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
    const versionDisplay = document.getElementById('version-display');
    if (versionDisplay) {
      versionDisplay.textContent = APP_VERSION;
    }
    
    // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
    document.title = `í¬ì»¤ í•¸ë“œ ë¡œê±° ${APP_VERSION}`;
    
    // ì½˜ì†”ì— ë²„ì „ ì •ë³´ ì¶œë ¥
    console.log(`%c${VERSION_INFO}`, 'color: #10b981; font-weight: bold; font-size: 14px');
  }
  
  // Gemini API ì„¤ì • - ì¶”í›„ êµ¬í˜„ ì˜ˆì •
  // const GEMINI_API_KEY = ''; // ë³´ì•ˆì„ ìœ„í•´ ì œê±°ë¨
  // const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';
  
  // ë²„ì „ ì •ë³´ë¥¼ í•­ìƒ ì½˜ì†”ì— í‘œì‹œ
  console.log(`%c====================================`, 'color: #fbbf24');
  console.log(`%cğŸ¯ ${VERSION_INFO}`, 'color: #fbbf24; font-size: 18px; font-weight: bold');
  console.log(`%c====================================`, 'color: #fbbf24');
  // console.log('%cğŸ“± AI ì¹© ìŠ¤íƒ ë¶„ì„ ê¸°ëŠ¥ í™œì„±í™”', 'color: #10b981'); // ì¶”í›„ êµ¬í˜„ ì˜ˆì •
  // console.log('%cğŸ’¡ ê´€ë¦¬ ë²„íŠ¼ â†’ ì¹© ì»¬ëŸ¬ íƒ­ì—ì„œ ì¹© ë“±ë¡', 'color: #60a5fa'); // ì¶”í›„ êµ¬í˜„ ì˜ˆì •
  
  // ëª¨ë“  ì—ëŸ¬ë¥¼ ë¡œê·¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì˜¤ë¥˜ ë°©ì§€)
  const originalError = console.error;
  const originalWarn = console.warn;
  console.error = function(...args) {
    // console.logë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    console.log.apply(console, [`[${APP_VERSION}] INFO:`, ...args]);
  };
  console.warn = function(...args) {
    // console.logë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    console.log.apply(console, [`[${APP_VERSION}] NOTICE:`, ...args]);
  };
  
  // ====== CONFIG v71.0.6 ULTIMATE ======
  // Apps Script URL ê´€ë¦¬ - ì „ì—­ ë³€ìˆ˜ë¡œ ì„ ì–¸
  let APPS_SCRIPT_URL = null;

  // ì´ˆê¸° URL ë¡œë“œ (localStorage ìš°ì„ )
  function initializeAppsScriptUrl() {
      const cachedUrl = localStorage.getItem('appsScriptUrl');

      if (cachedUrl) {
        APPS_SCRIPT_URL = cachedUrl;
        console.log('ğŸ“‚ ì €ì¥ëœ URL ì‚¬ìš©:', cachedUrl);
        return cachedUrl;
      }

      // localStorageì— URLì´ ì—†ìœ¼ë©´ ê¸°ë³¸ URL ì‚¬ìš©
      const defaultUrl = 'https://script.google.com/macros/s/AKfycbxyqcPMr0Ba5dK0XSwaTcbl9y_02BbLdzvPybmMRmHubwlCkUAAP0rglwTNBMa2yZcG/exec';
      console.warn('âš ï¸ Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      console.warn('ğŸ“Œ ê¸°ë³¸ URLì„ ì‚¬ìš©í•©ë‹ˆë‹¤:', defaultUrl);
      console.warn('ğŸ’¡ ìì‹ ì˜ Apps Script URLë¡œ ë³€ê²½í•˜ë ¤ë©´:');
      console.warn('1. ê´€ë¦¬ ë²„íŠ¼ â†’ ì„¤ì • íƒ­ì—ì„œ URL ì…ë ¥');
      console.warn('2. ë˜ëŠ” Google Sheetsì˜ Config ì‹œíŠ¸ A1ì— URL ì…ë ¥');

      // ê¸°ë³¸ URL ì„¤ì • (v3.5.28)
      APPS_SCRIPT_URL = defaultUrl;
      return defaultUrl;
    }

  // ì¦‰ì‹œ ì´ˆê¸°í™” ì‹¤í–‰
  initializeAppsScriptUrl();

  // Config ì‹œíŠ¸ì—ì„œ URL ê°€ì ¸ì˜¤ê¸° (ì˜µì…˜ - URLì´ ìˆì„ ë•Œë§Œ ì‹œë„)
  async function loadAppsScriptUrlFromConfig() {
      // URLì´ ì—†ìœ¼ë©´ ì‹œë„í•˜ì§€ ì•ŠìŒ
      if (!APPS_SCRIPT_URL) {
        console.log('ğŸ” Config ì‹œíŠ¸ ë¡œë“œ ê±´ë„ˆëœ€ (URL ë¯¸ì„¤ì •)');
        return null;
      }

      try {
        console.log('ğŸ“¡ Config ì‹œíŠ¸ URL í™•ì¸ ì¤‘...');

        const response = await fetch(APPS_SCRIPT_URL + '?action=getConfigUrl', {
          method: 'GET',
          mode: 'cors'
        });

        if (response.ok) {
          const result = await response.json();

          if (result.success && result.url && result.url !== APPS_SCRIPT_URL) {
            // Config ì‹œíŠ¸ì— ë‹¤ë¥¸ URLì´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
            APPS_SCRIPT_URL = result.url;
            localStorage.setItem('appsScriptUrl', result.url);
            console.log('âœ… Config ì‹œíŠ¸ A1ì—ì„œ ìƒˆ URL ë°œê²¬:', result.url);
            return result.url;
          }
        }
      } catch (error) {
        // Config ì‹œíŠ¸ ì ‘ê·¼ ì‹¤íŒ¨ëŠ” ë¬´ì‹œ (ì„ íƒ ê¸°ëŠ¥)
        console.log('ğŸ“Œ Config ì‹œíŠ¸ ì ‘ê·¼ ì‹¤íŒ¨. í˜„ì¬ URL ìœ ì§€');
      }

      return APPS_SCRIPT_URL;
  }

  document.addEventListener('DOMContentLoaded', async () => {
    // Apps Script URL í™•ì¸ ë° Config ì‹œíŠ¸ ë¡œë“œ (ì„ íƒ)
    if (APPS_SCRIPT_URL) {
      console.log('ğŸ”„ í˜„ì¬ Apps Script URL:', APPS_SCRIPT_URL);
      await loadAppsScriptUrlFromConfig();
    } else {
      console.warn('âš ï¸ Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      console.warn('â†’ ê´€ë¦¬ > ì„¤ì •ì—ì„œ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
    }

    // ë²„ì „ í‘œì‹œ ì—…ë°ì´íŠ¸
    updateAllVersionDisplays();

    console.log(`%cğŸš€ ì•± ì´ˆê¸°í™” ì‹œì‘ - ${VERSION_INFO}`, 'color: #10b981; font-weight: bold');
    console.log('Initialized at', new Date().toISOString());

    // ì¹© ë¶„ì„ ëª¨ë“ˆ ì´ˆê¸°í™”ëŠ” state ê°ì²´ ìƒì„± í›„ì— ì§„í–‰

    // í™”ë©´ì— ë²„ì „ í‘œì‹œ ì—…ë°ì´íŠ¸
    const versionDisplay = document.getElementById('version-display');
    if(versionDisplay) {
      versionDisplay.textContent = `${APP_VERSION} (${VERSION_DATE})`;
    }

    // v70 êµ¬ì¡° ê°•ì œ ì ìš©ì„ ìœ„í•œ localStorage ì´ˆê¸°í™”
    const V70_MIGRATION_KEY = 'v70_migration_done';
    if (!localStorage.getItem(V70_MIGRATION_KEY)) {
      console.log('[v70 ë§ˆì´ê·¸ë ˆì´ì…˜] v65 êµ¬ì¡° ë°ì´í„° ì œê±° ì‹œì‘...');

      // v65 ê´€ë ¨ localStorage í‚¤ ì œê±°
      const v65Keys = ['playerData', 'handData', 'actionData', 'tableData'];
      v65Keys.forEach(key => {
        if (localStorage.getItem(key)) {
          console.log(`[v70 ë§ˆì´ê·¸ë ˆì´ì…˜] v65 ë°ì´í„° ì‚­ì œ: ${key}`);
          localStorage.removeItem(key);
        }
      });

      // ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í”Œë˜ê·¸ ì„¤ì •
      localStorage.setItem(V70_MIGRATION_KEY, 'true');
      console.log('[v70 ë§ˆì´ê·¸ë ˆì´ì…˜] v65 â†’ v70 êµ¬ì¡° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ');
    }
    
    // CSV URLs (ê³ ì •)
    const CSV_HAND_URL  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1906746276&single=true&output=csv"; // Hand íƒ­ CSV
    const CSV_INDEX_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=1354012271&single=true&output=csv"; // Index íƒ­ CSV (HandIndex ëŒ€ì‹  Index ì‚¬ìš©)
    const CSV_TYPE_URL  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSDY_i4330JANAjIz4sMncdJdRHsOkfUCjQusHTGQk2tykrhA4d09LeIp3XRbLd8hkN6SgSB47k_nux/pub?gid=998576925&single=true&output=csv";
    
    // ì „ì—­ ë³€ìˆ˜ë¡œë„ ì„¤ì • (í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“ˆìš©)
    window.APPS_SCRIPT_URL = APPS_SCRIPT_URL;

    // ====== v70 HTML Service iframe í†µì‹  í•¨ìˆ˜ ======
    function callAppsScriptWithIframe(action, data = {}) {
      return new Promise((resolve, reject) => {
        // ìˆ¨ê²¨ì§„ iframe ìƒì„±
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.style.width = '0';
        iframe.style.height = '0';

        // iframe ë¡œë“œ ì™„ë£Œ í›„ ì²˜ë¦¬
        iframe.onload = () => {
          try {
            // iframeì˜ ë‚´ìš©ì„ ì½ì–´ì„œ JSON íŒŒì‹±
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            const responseText = iframeDoc.body.textContent || iframeDoc.body.innerText;
            const result = JSON.parse(responseText);

            document.body.removeChild(iframe);
            resolve(result);
          } catch (error) {
            document.body.removeChild(iframe);
            reject(error);
          }
        };

        iframe.onerror = () => {
          document.body.removeChild(iframe);
          reject(new Error('iframe ë¡œë“œ ì‹¤íŒ¨'));
        };

        // íƒ€ì„ì•„ì›ƒ ì„¤ì • (10ì´ˆ)
        setTimeout(() => {
          if (iframe.parentNode) {
            document.body.removeChild(iframe);
          }
          reject(new Error('Apps Script ìš”ì²­ íƒ€ì„ì•„ì›ƒ'));
        }, 10000);

        // iframeì— GET ìš”ì²­ URL ì„¤ì •
        const params = new URLSearchParams();
        params.set('action', action);
        params.set('data', JSON.stringify(data));

        iframe.src = APPS_SCRIPT_URL + '?' + params.toString();
        document.body.appendChild(iframe);
      });
    }

    // ê¸°ì¡´ fetch í•¨ìˆ˜ë¥¼ ëŒ€ì²´í•˜ëŠ” ë˜í¼ í•¨ìˆ˜
    async function callAppsScript(action, data = {}) {
      try {
        console.log(`[v70 iframe í†µì‹ ] ${action} í˜¸ì¶œ:`, data);
        const result = await callAppsScriptWithIframe(action, data);
        console.log(`[v70 iframe í†µì‹ ] ${action} ì‘ë‹µ:`, result);
        return {
          ok: true,
          json: () => Promise.resolve(result)
        };
      } catch (error) {
        console.error(`[v70 iframe í†µì‹ ] ${action} ì˜¤ë¥˜:`, error);
        throw error;
      }
    }
    
    // Apps Script URL í´ë¼ìš°ë“œ ë™ê¸°í™” ì‹œìŠ¤í…œ
    const CLOUD_SYNC_CONFIG = {
      enabled: true,
      gistApiUrl: 'https://api.github.com/gists',
      configGistId: localStorage.getItem('configGistId') || null,
      deviceId: localStorage.getItem('deviceId') || generateDeviceId()
    };

    // ê¸°ê¸° IDë¥¼ localStorageì— ì €ì¥ (ì²˜ìŒ ìƒì„±ì‹œ)
    if (!localStorage.getItem('deviceId')) {
      localStorage.setItem('deviceId', CLOUD_SYNC_CONFIG.deviceId);
    }

    // ê³ ìœ  ê¸°ê¸° ID ìƒì„±
    function generateDeviceId() {
      const id = 'device_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
      localStorage.setItem('deviceId', id);
      return id;
    }

    // í´ë¼ìš°ë“œì—ì„œ ì„¤ì • ë¡œë“œ
    async function loadConfigFromCloud() {
      if (!CLOUD_SYNC_CONFIG.enabled || !CLOUD_SYNC_CONFIG.configGistId) {
        return null;
      }

      try {
        const response = await fetch(`${CLOUD_SYNC_CONFIG.gistApiUrl}/${CLOUD_SYNC_CONFIG.configGistId}`);
        if (response.ok) {
          const gist = await response.json();
          const configFile = gist.files['poker-config.json'];
          if (configFile) {
            const config = JSON.parse(configFile.content);
            console.log('â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ì„¤ì • ë¡œë“œ:', config);
            return config;
          }
        }
      } catch (error) {
        console.log('í´ë¼ìš°ë“œ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error.message);
      }
      return null;
    }

    // í´ë¼ìš°ë“œì— ì„¤ì • ì €ì¥
    async function saveConfigToCloud(appsScriptUrl) {
      if (!CLOUD_SYNC_CONFIG.enabled) return false;

      const config = {
        appsScriptUrl: appsScriptUrl,
        lastUpdated: new Date().toISOString(),
        deviceId: CLOUD_SYNC_CONFIG.deviceId,
        version: APP_VERSION
      };

      const gistContent = {
        description: 'Poker Hand Logger Configuration',
        public: false,
        files: {
          'poker-config.json': {
            content: JSON.stringify(config, null, 2)
          }
        }
      };

      try {
        let response;
        if (CLOUD_SYNC_CONFIG.configGistId) {
          // ê¸°ì¡´ Gist ì—…ë°ì´íŠ¸
          response = await fetch(`${CLOUD_SYNC_CONFIG.gistApiUrl}/${CLOUD_SYNC_CONFIG.configGistId}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(gistContent)
          });
        } else {
          // ìƒˆ Gist ìƒì„±
          response = await fetch(CLOUD_SYNC_CONFIG.gistApiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(gistContent)
          });
        }

        if (response.ok) {
          const gist = await response.json();
          CLOUD_SYNC_CONFIG.configGistId = gist.id;
          localStorage.setItem('configGistId', gist.id);
          console.log('â˜ï¸ ì„¤ì •ì´ í´ë¼ìš°ë“œì— ì €ì¥ë¨:', gist.id);
          return true;
        }
      } catch (error) {
        console.log('í´ë¼ìš°ë“œ ì €ì¥ ì‹¤íŒ¨:', error.message);
      }
      return false;
    }

    // Apps Script URL ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (í´ë¼ìš°ë“œ ë™ê¸°í™” í¬í•¨)
    async function updateAppsScriptUrl(newUrl, skipCloudSync = false) {
      if (newUrl && newUrl.trim()) {
        APPS_SCRIPT_URL = newUrl.trim();
        window.APPS_SCRIPT_URL = APPS_SCRIPT_URL;
        localStorage.setItem('appsScriptUrl', APPS_SCRIPT_URL);
        console.log('âœ… Apps Script URL ì—…ë°ì´íŠ¸:', APPS_SCRIPT_URL);

        // í´ë¼ìš°ë“œì— ì €ì¥ (ì˜µì…˜)
        if (!skipCloudSync && CLOUD_SYNC_CONFIG.enabled) {
          const cloudSaved = await saveConfigToCloud(APPS_SCRIPT_URL);
          if (cloudSaved) {
            showFeedback('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ë° í´ë¼ìš°ë“œ ë™ê¸°í™” ì™„ë£Œ');
          } else {
            showFeedback('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ì™„ë£Œ (ë¡œì»¬ ì €ì¥)');
          }
        } else {
          showFeedback('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }
        return true;
      }
      return false;
    }

    // ====== LOADING & UI LOCK SYSTEM ======
    let isUILocked = false;

    // UI ì „ì²´ ë¹„í™œì„±í™”
    function lockUI(title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      if (isUILocked) return; // ì´ë¯¸ ì ê¸ˆ ìƒíƒœë©´ ë¬´ì‹œ

      isUILocked = true;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
      if (el.loadingOverlay) {
        if (el.loadingTitle) el.loadingTitle.textContent = title;
        if (el.loadingMessage) el.loadingMessage.textContent = message;
        el.loadingOverlay.classList.remove('hidden');
      }

      // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
      document.querySelectorAll('button').forEach(btn => {
        btn.disabled = true;
        btn.classList.add('opacity-50', 'cursor-not-allowed');
      });

      // ëª¨ë“  ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™”
      document.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = true;
        input.classList.add('opacity-50', 'cursor-not-allowed');
      });

      console.log(`ğŸ”’ UI ì ê¸ˆ: ${title}`);
    }

    // UI ì „ì²´ í™œì„±í™”
    function unlockUI() {
      if (!isUILocked) return; // ì´ë¯¸ í•´ì œ ìƒíƒœë©´ ë¬´ì‹œ

      isUILocked = false;

      // ë¡œë”© ì˜¤ë²„ë ˆì´ ìˆ¨ê¸°ê¸°
      if (el.loadingOverlay) {
        el.loadingOverlay.classList.add('hidden');
      }

      // ëª¨ë“  ë²„íŠ¼ í™œì„±í™”
      document.querySelectorAll('button').forEach(btn => {
        btn.disabled = false;
        btn.classList.remove('opacity-50', 'cursor-not-allowed');
      });

      // ëª¨ë“  ì…ë ¥ í•„ë“œ í™œì„±í™”
      document.querySelectorAll('input, select, textarea').forEach(input => {
        input.disabled = false;
        input.classList.remove('opacity-50', 'cursor-not-allowed');
      });

      console.log('ğŸ”“ UI ì ê¸ˆ í•´ì œ');
    }

    // ì‘ì—… ì‹¤í–‰ ë˜í¼ (ìë™ UI ì ê¸ˆ/í•´ì œ)
    async function executeWithLock(asyncFunction, title = 'ì²˜ë¦¬ ì¤‘...', message = 'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”') {
      try {
        lockUI(title, message);
        await asyncFunction();
      } catch (error) {
        console.log('ì‘ì—… ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:', error);
        showFeedback('ì‘ì—… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, true);
      } finally {
        unlockUI();
      }
    }

    // í´ë¼ìš°ë“œ ë™ê¸°í™” UI ì—…ë°ì´íŠ¸
    function updateCloudSyncUI() {
      if (!el.cloudSyncStatus || !el.deviceIdDisplay) return;

      // ê¸°ê¸° ID í‘œì‹œ
      el.deviceIdDisplay.textContent = CLOUD_SYNC_CONFIG.deviceId.substring(0, 8) + '...';

      // ë™ê¸°í™” ìƒíƒœ í‘œì‹œ
      if (CLOUD_SYNC_CONFIG.enabled && CLOUD_SYNC_CONFIG.configGistId) {
        el.cloudSyncStatus.textContent = 'ì—°ê²°ë¨';
        el.cloudSyncStatus.className = 'text-xs px-2 py-1 rounded-full bg-green-600 text-white';

        // ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„ í‘œì‹œ
        const lastSync = localStorage.getItem('lastCloudSync');
        if (lastSync && el.lastSyncDisplay) {
          const syncDate = new Date(lastSync);
          el.lastSyncDisplay.querySelector('span').textContent = syncDate.toLocaleString('ko-KR');
          el.lastSyncDisplay.classList.remove('hidden');
        }
      } else {
        el.cloudSyncStatus.textContent = 'ë¯¸ì—°ê²°';
        el.cloudSyncStatus.className = 'text-xs px-2 py-1 rounded-full bg-gray-600 text-gray-400';
        if (el.lastSyncDisplay) {
          el.lastSyncDisplay.classList.add('hidden');
        }
      }
    }

    // ìˆ˜ë™ í´ë¼ìš°ë“œ ë™ê¸°í™”
    async function syncCloudNow() {
      if (!CLOUD_SYNC_CONFIG.enabled) {
        showFeedback('í´ë¼ìš°ë“œ ë™ê¸°í™”ê°€ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤', true);
        return;
      }

      await executeWithLock(async () => {
        // í˜„ì¬ ì„¤ì •ì„ í´ë¼ìš°ë“œì— ì €ì¥
        await saveConfigToCloud(APPS_SCRIPT_URL);
        localStorage.setItem('lastCloudSync', new Date().toISOString());

        // UI ì—…ë°ì´íŠ¸
        updateCloudSyncUI();
        showFeedback('â˜ï¸ í´ë¼ìš°ë“œ ë™ê¸°í™” ì™„ë£Œ');
      }, 'í´ë¼ìš°ë“œ ë™ê¸°í™”', 'Apps Script URLì„ í´ë¼ìš°ë“œì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
    }

    // í´ë¼ìš°ë“œ ì„¤ì • ì´ˆê¸°í™” (Phase 2: ë”ë¸”íƒ­ ì ìš©)
    function resetCloudConfig() {
      // ì‹¤ì œ ì´ˆê¸°í™” ë¡œì§
      const performReset = () => {
        // ë¡œì»¬ ì €ì¥ì†Œì—ì„œ í´ë¼ìš°ë“œ ê´€ë ¨ ì •ë³´ ì œê±°
        localStorage.removeItem('configGistId');
        localStorage.removeItem('lastCloudSync');
        CLOUD_SYNC_CONFIG.configGistId = null;

        // UI ì—…ë°ì´íŠ¸
        updateCloudSyncUI();

        // ìŠ¤ë‚µë°”ë¡œ í”¼ë“œë°±
        if (window.actionHistory) {
          window.actionHistory.showSnackbar('â˜ï¸ í´ë¼ìš°ë“œ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', null, 'success');
        } else {
          showFeedback('í´ë¼ìš°ë“œ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }
      };

      // ì¦‰ì‹œ ì‹¤í–‰ (ë”ë¸”íƒ­ì€ ë‚˜ì¤‘ì— ì„¤ì • ê°€ëŠ¥)
      performReset();
    }

    // ì•± ì‹œì‘ ì‹œ í´ë¼ìš°ë“œ ì„¤ì • í™•ì¸
    async function initializeAppConfig() {
      const cloudConfig = await loadConfigFromCloud();
      if (cloudConfig && cloudConfig.appsScriptUrl) {
        // í´ë¼ìš°ë“œ ì„¤ì •ì´ ë” ìµœì‹ ì¸ ê²½ìš° ì ìš©
        const localUpdated = localStorage.getItem('appsScriptUrlUpdatedAt');
        const cloudUpdated = cloudConfig.lastUpdated;

        if (!localUpdated || (cloudUpdated && new Date(cloudUpdated) > new Date(localUpdated))) {
          console.log('â˜ï¸ í´ë¼ìš°ë“œì—ì„œ ìµœì‹  ì„¤ì • ì ìš©');
          await updateAppsScriptUrl(cloudConfig.appsScriptUrl, true);
          localStorage.setItem('appsScriptUrlUpdatedAt', cloudConfig.lastUpdated);
        }
      }
    }

    // ì´ˆê¸°í™” ì‹¤í–‰ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìˆ˜í–‰)
    initializeAppConfig().catch(err => console.log('í´ë¼ìš°ë“œ ì„¤ì • ì´ˆê¸°í™” ì‹¤íŒ¨:', err.message));

    // ====== STATE ======
    let timeUpdater;
    window.state = {
      currentStreet: 'preflop',  // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ìŠ¤íŠ¸ë¦¬íŠ¸
      // CAM ê´€ë ¨ ë³€ìˆ˜ ì™„ì „ ì œê±° (v3.5.27)
      // camNumbers, camPreset ëª¨ë“  ì°¸ì¡° ì œê±°ë¨

      playerDataByTable: {},     // { [table]: [{name, chips, notable}] }
      allTables: [],
      indexRows: [],             // [{handNumber, handUpdatedAt, table, ...}]
      allHandNumbers: [],        // latest numbers (from Index)
      handCsvCache: null,        // raw rows for on-demand hand parsing
      allHandData: {},           // { [handNumber]: parsed hand block (latest) }
      selectedTable: null,
      playersInHand: [],
      board: [],
      playerStatus: {},          // { playerName: 'active' | 'folded' | 'allin' }
      buttonPosition: null,      // ë²„íŠ¼ ìœ„ì¹˜ (seat ë²ˆí˜¸)
      seatMap: {},              // { seat: playerName } 10ê°œ ì¢Œì„ ë§¤í•‘
      nextActionSeat: null,      // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´ ì¢Œì„
      
      // ì•¡ì…˜ ìë™ ë§¤í•‘ ì‹œìŠ¤í…œ
      actionInputMode: localStorage.getItem('actionInputMode') || 'auto', // 'auto' | 'manual'
      currentActionIndex: 0,     // í˜„ì¬ ì•¡ì…˜ ìˆœì„œ ì¸ë±ìŠ¤
      actionQueue: [],          // ì•¡ì…˜ ìˆœì„œ ëŒ€ê¸°ì—´
      nextActionPlayer: null,    // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´
      smartCheckCall: true,      // ìŠ¤ë§ˆíŠ¸ Check/Call ë²„íŠ¼ ì‚¬ìš©
      actionState: {
        handNumber: '',
        smallBlind: '', bigBlind: '', hasBBAnte: false,
        preflop: [], flop: [], turn: [], river: [],
      },
      modalState: {
        cardTarget: null,
        actionPadStreet: null, actionPadPlayer: null, actionPadCurrentAction: null,
        keypadTarget: null, keypadOptions: {},
      },
      selectedTimezone: 'Asia/Seoul',
      // ì¹© ë¶„ì„ ê´€ë ¨ ìƒíƒœ
      chipColors: [], // [{color: '#fff', value: 1000, image: 'base64...'}]
      maxChips: 5,
      currentChipSlot: null,
      playerStacks: {}, // {playerName: {images: [], estimatedStack: 0, analysis: ''}}
      currentAnalyzingPlayer: null,
      stackImages: [] // í˜„ì¬ ì´¬ì˜ ì¤‘ì¸ ìŠ¤íƒ ì´ë¯¸ì§€ë“¤
    };

    // ì¹© ë¶„ì„ ëª¨ë“ˆ ì´ˆê¸°í™” - ì¶”í›„ êµ¬í˜„ ì˜ˆì •
    // if (typeof initChipAnalyzer === 'function') {
    //   setTimeout(() => {
    //     initChipAnalyzer();
    //     console.log('âœ… AI ì¹© ë¶„ì„ ëª¨ë“ˆ í™œì„±í™”');
    //   }, 100);
    // }

    // ====== CONSTS ======
    const SUITS = { s:'â™ ', h:'â™¥', d:'â™¦', c:'â™£' };
    const RANKS = ['A','K','Q','J','10','9','8','7','6','5','4','3','2'];

    // ====== EL ======
    const el = {
      refreshDataBtn: document.getElementById('refresh-data'),
      tableSelectorBtn: document.getElementById('table-selector-btn'),
      selectedTableDisplay: document.getElementById('selected-table-display'),
      tableSelectorModal: document.getElementById('table-selector-modal'),
      playerSelectionButtons: document.getElementById('player-selection-buttons'),
      boardCardPlaceholders: document.getElementById('board-card-placeholders'),
      playerDetailsSection: document.getElementById('player-details-section'),
      handNumberDisplay: document.getElementById('hand-number-display'),
      loadHandBtn: document.getElementById('load-hand-btn'),
      smallBlindInput: document.getElementById('small-blind-input'),
      bigBlindInput: document.getElementById('big-blind-input'),
      bbAnteCheckbox: document.getElementById('bb-ante-checkbox'),
      streetLogsContainer: document.getElementById('street-logs-container'),
      winnerButtons: document.getElementById('winner-buttons'),
      sendToSheetBtn: document.getElementById('send-to-sheet-btn'),
      resetBtn: document.getElementById('reset-btn'),
      feedbackMessage: document.getElementById('feedback-message'),
      logDisplay: document.getElementById('log-display'),
      logModal: document.getElementById('log-modal'),
      showLogBtn: document.getElementById('show-log-btn'),
      closeLogModalBtn: document.getElementById('close-log-modal'),
      cardSelectorModal: document.getElementById('card-selector-modal'),
      actionPadModal: document.getElementById('action-pad-modal'),
      keypadModal: document.getElementById('keypad-modal'),
      loadHandModal: document.getElementById('load-hand-modal'),
      timezoneSelector: document.getElementById('timezone-selector'),
      timeDisplay: document.getElementById('time-display'),
      managePlayersBtn: document.getElementById('manage-players-btn'),
      setUrlBtn: document.getElementById('set-url-btn'),
      urlSetupModal: document.getElementById('url-setup-modal'),
      registrationModal: document.getElementById('registration-modal'),
      // CAM ë²„íŠ¼ ì™„ì „ ì œê±° (v3.5.27)
      // cam1, cam2 ìš”ì†Œ ë° ëª¨ë“  ì°¸ì¡° ì œê±°ë¨
      dataStamp: document.getElementById('data-stamp'),
      // ì„¤ì • ëª¨ë‹¬ ê´€ë ¨
      settingsBtn: document.getElementById('settings-btn'),
      settingsModal: document.getElementById('settings-modal'),
      closeSettingsBtn: document.getElementById('close-settings'),
      cancelSettingsBtn: document.getElementById('cancel-settings'),
      saveSettingsBtn: document.getElementById('save-settings'),
      appsScriptUrlInput: document.getElementById('apps-script-url-input'),
      currentAppsUrl: document.getElementById('current-apps-url'),
      chipValidationToggle: document.getElementById('chip-validation-toggle'),
      cloudSyncStatus: document.getElementById('cloud-sync-status'),
      deviceIdDisplay: document.getElementById('device-id-display'),
      lastSyncDisplay: document.getElementById('last-sync-display'),
      syncNowBtn: document.getElementById('sync-now-btn'),
      resetCloudBtn: document.getElementById('reset-cloud-btn'),
      loadingOverlay: document.getElementById('loading-overlay'),
      loadingTitle: document.getElementById('loading-title'),
      loadingMessage: document.getElementById('loading-message'),
    };

    // ====== LOG MODAL ======
    function openLogModal(){
      el.logModal.classList.remove('hidden');
      el.logModal.classList.remove('opacity-0');
    }
    function closeLogModal(){ el.logModal.classList.add('opacity-0', 'hidden'); }
    function logMessage(msg,isError=false){
      const d=document.createElement('div');
      d.textContent=`[${new Date().toLocaleTimeString()}] ${msg}`;
      d.className=isError?'text-red-400':'text-green-400';
      el.logDisplay.appendChild(d); el.logDisplay.scrollTop=el.logDisplay.scrollHeight;
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (DuplicateRemoverì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡)
    window.openLogModal = openLogModal;
    window.closeLogModal = closeLogModal;
    window.logMessage = logMessage;

    // ====== TIME/TZ ======
    function getFormattedTimeInTimezone(date, tz){
      try{
        return new Intl.DateTimeFormat('ko-KR',{timeZone:tz,hour12:false,hour:'2-digit',minute:'2-digit',second:'2-digit'}).format(date);
      }catch(_){
        const pad=n=>String(n).padStart(2,'0');
        return `${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;
      }
    }
    function populateTimezones(){
      const tzs={ "Asia/Seoul":"í•œêµ­(KST)", "Asia/Nicosia":"í‚¤í”„ë¡œìŠ¤(EET)" };
      const s=el.timezoneSelector; s.innerHTML='';
      for(const [v,t] of Object.entries(tzs)){
        const opt=document.createElement('option'); opt.value=v; opt.textContent=t; s.appendChild(opt);
      }
      s.value=window.state.selectedTimezone;
    }
    function updateTimeDisplay(){ el.timeDisplay.textContent=getFormattedTimeInTimezone(new Date(),window.state.selectedTimezone); }

    // ====== UTILS ======
    const formatNumber = (val) => val ? new Intl.NumberFormat('en-US').format(String(val).replace(/,/g,'')) : '';
    const unformatNumber = (val) => String(val || '').replace(/,/g, '');
    const toCamelCase = (s) => s.replace(/-([a-z])/g, g => g[1].toUpperCase());
    const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));
    const pad4 = n => String(Math.max(0, parseInt(String(n||'0').replace(/\D/g,''),10)||0)).padStart(4, '0');

    // Robust CSV parse (handles quotes)
    function parseCSV(text){
      const rows=[]; let i=0, field='', inQ=false, row=[];
      while(i<text.length){
        const c=text[i];
        if(inQ){
          if(c==='"'){
            if(text[i+1]==='"'){ field+='"'; i++; } else inQ=false;
          }else field+=c;
        }else{
          if(c===','){ row.push(field); field=''; }
          else if(c==='\n'){ row.push(field); rows.push(row); row=[]; field=''; }
          else if(c==='"'){ inQ=true; }
          else if(c!=='\r'){ field+=c; }
        }
        i++;
      }
      if(field!==''||row.length) { row.push(field); rows.push(row); }
      return rows;
    }

    function formatCardDisplay(cardId){
      if (!cardId) return '';

      // ì¹´ë“œ ID íŒŒì‹± ê°œì„  - ë§ˆì§€ë§‰ ë¬¸ìê°€ suit
      const suitKey = cardId.slice(-1);
      const rank = cardId.slice(0, -1);

      // suit ê²€ì¦
      if (!SUITS[suitKey]) {
        console.warn('Invalid suit:', suitKey, 'in card:', cardId);
        return cardId; // ì›ë³¸ ë°˜í™˜
      }

      const colorClass = (suitKey === 'h' || suitKey === 'd') ? 'text-red-500' : 'text-black';
      return `<div class="card-display h-full w-full ${colorClass}"><div class="rank">${rank}</div><div>${SUITS[suitKey]}</div></div>`;
    }

    // ====== RENDERERS ======
    function renderTableSelection(){
      // ë”ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì§€ë§Œ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
      updateSelectedTableDisplay();
    }

    // ====== ìƒˆë¡œìš´ í…Œì´ë¸” ì„ íƒ ì‹œìŠ¤í…œ ======
    let tableModalState = {
      currentPage: 1,
      tablesPerPage: 20,
      currentFilter: 'all',
      searchTerm: ''
    };

    function updateSelectedTableDisplay() {
      const display = el.selectedTableDisplay;
      const managementTableName = document.getElementById('selected-table-name');

      if (window.state.selectedTable) {
        const playerCount = (window.state.playerDataByTable[window.state.selectedTable] || []).length;
        const text = `${window.state.selectedTable} (${playerCount}ëª…)`;
        display.textContent = text;
        if (managementTableName) managementTableName.textContent = window.state.selectedTable;
      } else {
        display.textContent = 'í…Œì´ë¸” ì„ íƒ';
        if (managementTableName) managementTableName.textContent = 'í…Œì´ë¸”ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
      }
    }

    function getFilteredTables() {
      let tables = window.state.allTables;
      
      // ê²€ìƒ‰ í•„í„°
      if (tableModalState.searchTerm) {
        const term = tableModalState.searchTerm.toLowerCase();
        tables = tables.filter(table => {
          // í…Œì´ë¸” ì´ë¦„ ë§¤ì¹˜
          if (table.toLowerCase().includes(term)) return true;
          // í”Œë ˆì´ì–´ ì´ë¦„ ë§¤ì¹˜
          const players = window.state.playerDataByTable[table] || [];
          return players.some(p => p.name.toLowerCase().includes(term));
        });
      }
      
      // ìƒíƒœ í•„í„°
      if (tableModalState.currentFilter === 'active') {
        tables = tables.filter(table => {
          const players = window.state.playerDataByTable[table] || [];
          return players.length > 0;
        });
      } else if (tableModalState.currentFilter === 'empty') {
        tables = tables.filter(table => {
          const players = window.state.playerDataByTable[table] || [];
          return players.length === 0;
        });
      }
      
      return tables;
    }

    function renderTableGrid() {
      const filteredTables = getFilteredTables();
      const startIdx = (tableModalState.currentPage - 1) * tableModalState.tablesPerPage;
      const endIdx = startIdx + tableModalState.tablesPerPage;
      const pageTables = filteredTables.slice(startIdx, endIdx);
      
      const grid = document.getElementById('table-grid');
      grid.innerHTML = '';
      
      pageTables.forEach(table => {
        const players = window.state.playerDataByTable[table] || [];
        const playerCount = players.length;
        const isSelected = window.state.selectedTable === table;
        
        // ìƒíƒœë³„ ìƒ‰ìƒ
        let statusColor = 'bg-gray-600'; // ë¹ˆ í…Œì´ë¸”
        if (playerCount >= 7) statusColor = 'bg-green-600'; // í™œì„±
        else if (playerCount >= 4) statusColor = 'bg-yellow-600'; // ë³´í†µ
        else if (playerCount >= 1) statusColor = 'bg-blue-600'; // ì ìŒ
        
        const button = document.createElement('button');
        button.className = `table-btn ${statusColor} hover:brightness-110 p-3 rounded-lg text-white text-sm font-medium relative ${isSelected ? 'ring-2 ring-amber-400' : ''}`;
        button.innerHTML = `
          <div class="text-xs font-bold">${table}</div>
          <div class="text-xs opacity-75">${playerCount}ëª…</div>
          ${isSelected ? '<div class="absolute top-1 right-1 text-amber-400">â—</div>' : ''}
        `;
        
        button.onclick = () => {
          console.log(`ğŸ¯ [DEBUG v3.5.10] í…Œì´ë¸” ì„ íƒ: ${table}`);
          window.state.selectedTable = table;
          window.state.playersInHand = [];

          // ì„ íƒí•œ í…Œì´ë¸”ì˜ ë°ì´í„° í™•ì¸
          const tableData = window.state.playerDataByTable[table];
          console.log(`ğŸ“Š [DEBUG v3.5.10] ì„ íƒí•œ í…Œì´ë¸”ì˜ í”Œë ˆì´ì–´ ë°ì´í„°:`, tableData);
          console.log(`ğŸ‘¥ [DEBUG v3.5.10] í”Œë ˆì´ì–´ ìˆ˜: ${tableData ? tableData.length : 0}`);

          console.log(`ğŸ”„ [DEBUG v3.5.10] updateSelectedTableDisplay í˜¸ì¶œ`);
          updateSelectedTableDisplay();

          console.log(`âŒ [DEBUG v3.5.10] closeTableSelectorModal í˜¸ì¶œ`);
          closeTableSelectorModal();

          // í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œì¸ì§€ í™•ì¸
          if (window.isTableManagementMode) {
            // í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œ: ê´€ë¦¬ UIë¡œ ì „í™˜
            document.getElementById('management-menu').classList.add('hidden');
            document.getElementById('player-management-content').classList.remove('hidden');
            // ìˆœì„œ ë³€ê²½: onManagementTableSelectedë¥¼ ë¨¼ì € í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ì„¤ì •í•œ í›„ UIë¥¼ ì´ˆê¸°í™”
            onManagementTableSelected(table);

            // í”Œë˜ê·¸ ë¦¬ì…‹
            window.isTableManagementMode = false;
          } else {
            // ì¼ë°˜ ëª¨ë“œ: ê¸°ë³¸ ë Œë”ë§
            console.log(`ğŸ¨ [DEBUG v3.5.10] renderAll í˜¸ì¶œ`);
            renderAll();
          }
        };
        
        grid.appendChild(button);
      });
      
      // í˜ì´ì§€ ì •ë³´ ì—…ë°ì´íŠ¸
      const totalPages = Math.ceil(filteredTables.length / tableModalState.tablesPerPage);
      const pageInfo = document.getElementById('page-info');
      const startNum = startIdx + 1;
      const endNum = Math.min(endIdx, filteredTables.length);
      pageInfo.textContent = `${startNum}-${endNum} / ${filteredTables.length}`;
      
      // í˜ì´ì§€ ë²„íŠ¼ ìƒíƒœ
      document.getElementById('prev-page').disabled = tableModalState.currentPage === 1;
      document.getElementById('next-page').disabled = tableModalState.currentPage >= totalPages;
    }

    function openTableSelectorModal() {
      el.tableSelectorModal.classList.remove('hidden');
      renderTableGrid();
      document.getElementById('table-search').focus();
    }

    function closeTableSelectorModal() {
      el.tableSelectorModal.classList.add('hidden');
      tableModalState.searchTerm = '';
      document.getElementById('table-search').value = '';
    }
    function renderPlayerSelection(){
      console.log(`ğŸ” [DEBUG] renderPlayerSelection í•¨ìˆ˜ ì‹œì‘`);
      const seatButtons = document.getElementById('seat-buttons');
      if(!seatButtons) {
        console.log(`âŒ [DEBUG] seat-buttons ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
        return;
      }

      // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
      console.log(`ğŸ¯ [DEBUG] ì„ íƒëœ í…Œì´ë¸”: ${window.state.selectedTable}`);
      console.log(`ğŸ“Š [DEBUG] playerDataByTable ì „ì²´:`, window.state.playerDataByTable);
      console.log(`ğŸ [DEBUG] ì „ì²´ í…Œì´ë¸” ëª©ë¡:`, window.state.allTables);
      console.log(`[DEBUG] ì „ì²´ í…Œì´ë¸” ëª©ë¡:`, window.state.allTables);

      if(!window.state.selectedTable){
        seatButtons.innerHTML='<p class="text-gray-500 text-xs col-span-11">í…Œì´ë¸”ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
        return;
      }

      const tableData = window.state.playerDataByTable[window.state.selectedTable]||[];
      console.log(`[DEBUG] í˜„ì¬ í…Œì´ë¸” ë°ì´í„°:`, tableData);
      console.log(`[DEBUG] í”Œë ˆì´ì–´ ìˆ˜:`, tableData.length);

      // ê° í”Œë ˆì´ì–´ì˜ seatNo ê°’ í™•ì¸
      tableData.forEach((player, index) => {
        console.log(`[DEBUG] í”Œë ˆì´ì–´ ${index + 1}: ${player.name}, seatNo: "${player.seatNo}" (type: ${typeof player.seatNo})`);
      });
      
      // 10ê°œ ì¢Œì„ ë²„íŠ¼ + ë²„íŠ¼ ìœ„ì¹˜ ë“œë¡­ë‹¤ìš´ ìƒì„±
      let html = '';
      
      // 1-10ë²ˆ ì¢Œì„ ë²„íŠ¼ (ì¢Œì„ ë²ˆí˜¸ í‘œì‹œ ì œê±°)
      for(let seatNum = 1; seatNum <= 10; seatNum++){
        // Type ì‹œíŠ¸ì—ì„œ í•´ë‹¹ ì¢Œì„ì˜ í”Œë ˆì´ì–´ ì°¾ê¸° (#1, #2 í˜•íƒœì˜ ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜)
        const playerData = tableData.find(p => parseSeatNo(p.seatNo) === seatNum);

        // ë””ë²„ê¹…: ì¢Œì„ë³„ í”Œë ˆì´ì–´ ë°ì´í„° í™•ì¸
        if(seatNum <= 3) { // ì²˜ìŒ 3ê°œ ì¢Œì„ë§Œ ë¡œê·¸
          console.log(`[DEBUG] ì¢Œì„ #${seatNum}:`, playerData);
          if(playerData) {
            console.log(`[DEBUG] - ì´ë¦„: ${playerData.name}, seatNo: ${playerData.seatNo}, type: ${typeof playerData.seatNo}`);
          }
        }

        const isInHand = playerData && window.state.playersInHand.some(pp => pp.name === playerData.name);
        
        // í¬ì§€ì…˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const positions = getPositionsForSeat(seatNum);
        let positionBadge = '';
        let borderClass = '';
        
        if(positions.includes('BTN')) {
          positionBadge = 'ğŸ¯';
          borderClass = 'border-2 border-yellow-400';
        } else if(positions.includes('SB')) {
          positionBadge = 'SB';
          borderClass = 'border-2 border-green-400';
        } else if(positions.includes('BB')) {
          positionBadge = 'BB';
          borderClass = 'border-2 border-blue-400';
        }
        
        if(playerData){
          const notable = (playerData.notable || playerData.keyplayer) ? 'â­' : '';
          const btnClass = isInHand ? 'bg-amber-600' : 'bg-gray-600 hover:bg-gray-500';
          // í¬ì§€ì…˜ ë°°ì§€ì™€ í”Œë ˆì´ì–´ ì´ë¦„ í‘œì‹œ
          let displayText = '';
          if(positionBadge) {
            displayText = positionBadge; // í¬ì§€ì…˜ì´ ìˆìœ¼ë©´ í¬ì§€ì…˜ë§Œ í‘œì‹œ
          } else {
            // í¬ì§€ì…˜ì´ ì—†ìœ¼ë©´ ì´ë¦„ í‘œì‹œ (notable í¬í•¨)
            const shortName = playerData.name.length > 8 ? playerData.name.substring(0, 7) + 'â€¦' : playerData.name;
            displayText = notable + shortName;
          }
          
          html += `<button class="seat-player-btn btn ${btnClass} ${borderClass} px-1 py-0.5 text-[9px] rounded truncate h-7" 
                    data-seat="${seatNum}" 
                    data-player-name="${playerData.name}"
                    title="#${seatNum}: ${playerData.name}">
                    <div class="truncate">${displayText}</div>
                  </button>`;
        } else {
          // ë¹ˆ ì¢Œì„
          html += `<button class="seat-empty-btn btn bg-gray-800 ${borderClass} px-1 py-0.5 text-[9px] rounded h-7"
                    data-seat="${seatNum}"
                    title="#${seatNum}: ë¹ˆìë¦¬">
                    <div class="text-gray-600">${positionBadge || 'â€¢'}</div>
                  </button>`;
        }
      }
      
      // 11ë²ˆì§¸ ìœ„ì¹˜: ë²„íŠ¼ ë“œë¡­ë‹¤ìš´ (1x11 ê·¸ë¦¬ë“œ) - ì „ì²´ í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì„ íƒ ê°€ëŠ¥
      const currentBtnPos = window.state.buttonPosition || '';
      
      // ì „ì²´ í…Œì´ë¸” í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì¢Œì„ì´ ìˆëŠ” í”Œë ˆì´ì–´ë“¤ ê°€ì ¸ì˜¤ê¸°
      const allPlayersWithSeats = tableData.filter(player => player.seatNo).map(player => ({
        seat: parseSeatNo(player.seatNo),
        name: player.name
      })).sort((a, b) => a.seat - b.seat);
      
      html += `
        <select id="button-position-select" class="bg-gray-600 text-[9px] px-1 py-0.5 rounded h-7 cursor-pointer">
          <option value="">BTN</option>
          ${allPlayersWithSeats.map(player => {
            const selected = player.seat.toString() === currentBtnPos.toString() ? 'selected' : '';
            const isInGame = window.state.playersInHand.some(p => p.name === player.name);
            const statusIndicator = isInGame ? 'ğŸŸ¢' : 'âš«';
            return `<option value="${player.seat}" ${selected} title="#${player.seat} - ${player.name} ${isInGame ? '(ì°¸ì—¬ì¤‘)' : '(ëŒ€ê¸°ì¤‘)'}">${statusIndicator}#${player.seat}</option>`;
          }).join('')}
        </select>
      `;
      
      seatButtons.innerHTML = html;
      
      // ë²„íŠ¼ ìœ„ì¹˜ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      const btnSelect = document.getElementById('button-position-select');
      if(btnSelect) {
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
        const newBtnSelect = btnSelect.cloneNode(true);
        btnSelect.parentNode.replaceChild(newBtnSelect, btnSelect);
        
        newBtnSelect.addEventListener('change', (e) => {
          window.state.buttonPosition = e.target.value || null;
          console.log(`ğŸ¯ ë²„íŠ¼ ìœ„ì¹˜ ë³€ê²½: ${window.state.buttonPosition || 'ì—†ìŒ'}`);
          updateSeatDisplay();
          // updatePositionIndicatorsëŠ” renderPlayerSelection ë‚´ë¶€ì—ì„œ ì´ë¯¸ í˜¸ì¶œë¨
          saveActionState();
          
          // ì‹œê°ì  í”¼ë“œë°±
          showFeedback(window.state.buttonPosition ? 
            `ë²„íŠ¼ ìœ„ì¹˜: #${window.state.buttonPosition}` : 
            'ë²„íŠ¼ ìœ„ì¹˜ í•´ì œ', false);
        });
      }
    }
    function renderPlayerDetails(){
      const finalPot = calculateFinalPot();
      
      el.playerDetailsSection.innerHTML = window.state.playersInHand.map(p=>{
        const roleClass=(p.role==='winner')?'is-winner':'';
        const winnerBadge = p.role === 'winner' && finalPot > 0 ?
          `<span class="ml-2 text-amber-300 font-bold text-xs animate-pulse">ğŸ† +${formatNumber(finalPot)}</span>` : '';

        // ì¹© í‘œì‹œ ìŠ¤íƒ€ì¼ (ë§ˆì´ë„ˆìŠ¤ì¼ ë•Œ ë¹¨ê°„ìƒ‰)
        const chipValue = parseInt(unformatNumber(p.chips) || 0, 10);
        const chipClass = chipValue < 0 ? 'bg-red-900 text-red-300' : 'bg-gray-700';
        const chipWarning = chipValue < 0 ? 'âš ï¸ ' : '';

        return `<div class="player-card flex items-center gap-2 text-sm border-b border-gray-700 pb-1 ${roleClass}" data-player-name="${p.name}">
          <div class="w-1/4 truncate font-bold">${p.name}${winnerBadge}</div>
          <div class="w-1/2"><button class="player-chip-btn btn ${chipClass} w-full p-1 rounded-md text-xs text-left" data-player-name="${p.name}">${chipWarning}${formatNumber(p.chips) || '0'}</button></div>
          <div class="w-1/4 card-placeholder h-10 flex justify-center items-center gap-1" data-player-name="${p.name}" data-count="2">
            ${p.hand?.length? p.hand.map(formatCardDisplay).join('') : '<span class="text-gray-400 text-lg">+</span>'}
          </div>
        </div>`;
      }).join('');
      
      // í”Œë ˆì´ì–´ ì¹© ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
      document.querySelectorAll('.player-chip-btn').forEach(btn => {
        btn.onclick = () => {
          const playerName = btn.dataset.playerName;
          const player = window.state.playersInHand.find(p => p.name === playerName);
          if(player) {
            openChipInput(player, false);
          }
        };
      });
    }
    function renderBoard(){
      const flop=`<div class="card-placeholder h-10 w-24" data-target="board" data-index="0" data-count="3">${[0,1,2].map(i=>window.state.board[i]?formatCardDisplay(window.state.board[i]):'').join('') || '<span class="text-gray-400 text-lg">+</span>'}</div>`;
      const turn=`<div class="card-placeholder h-10 w-8" data-target="board" data-index="3" data-count="1">${window.state.board[3]?formatCardDisplay(window.state.board[3]):'<span class="text-gray-400 text-lg">+</span>'}</div>`;
      const river=`<div class="card-placeholder h-10 w-8" data-target="board" data-index="4" data-count="1">${window.state.board[4]?formatCardDisplay(window.state.board[4]):'<span class="text-gray-400 text-lg">+</span>'}</div>`;
      el.boardCardPlaceholders.innerHTML = flop+turn+river;
    }
    // ìµœì¢… íŒŸ ê³„ì‚° í•¨ìˆ˜
    function calculateFinalPot(){
      // ì‹¤ì œ íŒŸ ê³„ì‚° ì‚¬ìš© (í´ë“œí•œ í”Œë ˆì´ì–´ì˜ ë² íŒ… í¬í•¨, ì–¸ì½œ ë² íŒ… ì œì™¸)
      return calculateActualPot();
    }
    
    function renderWinnerSelection(){
      const finalPot = calculateFinalPot();
      
      el.winnerButtons.innerHTML = window.state.playersInHand.map(p=>{
        const sel=(p.role==='winner');
        const potDisplay = sel && finalPot > 0 ? ` <span class="text-amber-300 font-bold">+${formatNumber(finalPot)}</span>` : '';
        return `<button class="btn ${sel?'btn-selected bg-amber-600':'bg-gray-600 hover:bg-gray-500'} px-2 py-1 text-xs rounded-md set-winner-btn" data-player-name="${p.name}">${p.name}${potDisplay}</button>`;
      }).join('');
    }
    function renderActionStreets(){
      const streets=['preflop','flop','turn','river']; 
      let displayPot=0;  // UI í‘œì‹œìš© íŒŸ
      
      el.streetLogsContainer.innerHTML = streets.map(street=>{
        const logs=window.state.actionState[street]||[]; 
        let streetPot=0;
        
        if(street==='preflop'){
          streetPot += parseInt(unformatNumber(window.state.actionState.smallBlind)||0,10);
          streetPot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
          if(window.state.actionState.hasBBAnte) streetPot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
        }
        
        // Pot Correctionì´ ìˆëŠ”ì§€ í™•ì¸
        const potCorrection = logs.find(a => a.action === 'Pot Correction');
        if(potCorrection) {
          // Pot Correctionì´ ìˆìœ¼ë©´ ê·¸ ê°’ì„ ì§ì ‘ ì‚¬ìš©
          displayPot = parseInt(unformatNumber(potCorrection.amount),10);
        } else {
          // ì¼ë°˜ ì•¡ì…˜ë“¤ë§Œ ë”í•¨
          logs.forEach(a=>{ 
            if(a.amount && a.action !== 'Pot Correction') {
              streetPot += parseInt(unformatNumber(a.amount),10); 
            }
          });
          displayPot += streetPot;
        }
        
        // ì‹¤ì œ íŒŸ ê³„ì‚° (í´ë“œí•œ í”Œë ˆì´ì–´ì˜ ë² íŒ… í¬í•¨)
        const actualPot = calculateActualPot();
        const uncalledBet = calculateUncalledBet();
        
        // ì‹¤ì œ íŒŸê³¼ í‘œì‹œ íŒŸì´ ë‹¤ë¥¸ ê²½ìš°ë¥¼ ìœ„í•œ í‘œì‹œ
        let potDisplay = formatNumber(displayPot);
        if(displayPot !== actualPot && logs.length > 0) {
          potDisplay = `${formatNumber(displayPot)} <span class="text-xs text-amber-400">(ì‹¤ì œ: ${formatNumber(actualPot)})</span>`;
        }
        const logHTML = logs.map(log=>{
          // Pot Correctionì€ ì‹œìŠ¤í…œ ì•¡ì…˜ì´ë¯€ë¡œ playerê°€ ì—†ìŒ
          if(log.action === 'Pot Correction'){
            const amt = log.amount ? ` <span class="font-mono text-white">${formatNumber(log.amount)}</span>` : '';
            return `<span class="action-log-entry mr-2"><span class="text-blue-400">Pot</span>${amt}</span>`;
          }
          // ì¼ë°˜ í”Œë ˆì´ì–´ ì•¡ì…˜
          const player=window.state.playersInHand.find(p=>p.name===log.player);
          const cls=(player?.role==='winner')?'text-amber-400':'text-gray-300';
          const amt=log.amount?` <span class="font-mono text-white">${formatNumber(log.amount)}</span>`:'';
          return `<span class="action-log-entry mr-2"><span class="${cls}">${log.player || 'Unknown'}</span> ${log.action}${amt}</span>`;
        }).join('');
        const isActive = window.state.currentStreet === street;
        const streetBtnClass = isActive 
          ? 'bg-amber-500 text-black border-2 border-amber-300 shadow-lg' 
          : 'bg-gray-700 text-gray-300 border-2 border-gray-600 hover:bg-gray-600 hover:text-white';
        const containerClass = isActive 
          ? 'bg-gradient-to-r from-amber-900/40 to-yellow-900/30 border-2 border-amber-400 shadow-xl ring-2 ring-amber-500/30' 
          : 'bg-gray-900/50 border border-gray-700';
        
        return `<div class="street-container ${containerClass} p-2 rounded-md">
          <div class="flex justify-between items-center text-xs mb-1">
            <button class="street-select-btn ${streetBtnClass} px-3 py-1 rounded-md font-bold min-w-[70px] text-center cursor-pointer" 
                    data-street="${street}" style="${isActive ? 'box-shadow: 0 0 10px rgba(251, 191, 36, 0.5);' : ''}">${street.toUpperCase()}</button>
            <div class="flex items-center gap-1">
              <span class="font-mono">Pot: ${potDisplay}</span>
              <button class="pot-keypad-btn btn bg-gray-600 px-1 py-0 rounded" data-street="${street}" data-current-pot="${displayPot}">âŒ¨ï¸</button>
            </div>
            <div class="flex gap-1">
              <button class="add-action-btn btn bg-indigo-600 text-white font-bold py-1 px-2 rounded" data-street="${street}">ì•¡ì…˜+</button>
              <button class="undo-action-btn btn bg-gray-600 py-1 px-2 rounded" data-street="${street}">â†©</button>
            </div>
          </div>
          <div id="${street}-log" class="action-log-display text-xs whitespace-nowrap overflow-x-auto">${logHTML || '<span class="text-gray-500">No actions</span>'}</div>
        </div>`;
      }).join('');
    }
    function renderAll(){ 
      renderPlayerSelection(); 
      renderPlayerDetails(); 
      renderBoard(); 
      renderActionStreets(); 
      renderWinnerSelection();
      updateButtonPositionDisplay();
    }
    // ====== MODALS ======
    function openModal(node, html){ node.innerHTML=html; node.classList.remove('hidden', 'opacity-0'); }
    function closeModal(node){ node.classList.add('hidden', 'opacity-0'); }

    function openCardSelector(){
      const { target, player, index, count } = window.state.modalState.cardTarget;
      
      // í”Œëì—ì„œëŠ” 5ì¥ê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ìˆ˜ì •
      let maxCards = count;
      let isFlop = false;
      if(target === 'board' && count === 3) {
        maxCards = 5; // í”Œëì—ì„œëŠ” ìµœëŒ€ 5ì¥ê¹Œì§€ ì„ íƒ ê°€ëŠ¥
        isFlop = true;
      }
      
      // í˜„ì¬ ì„ íƒëœ ì¹´ë“œë“¤ì„ ì´ˆê¸°ê°’ìœ¼ë¡œ ì„¤ì •
      let selected = [];
      if(target === 'playerHand' && player) {
        const p = window.state.playersInHand.find(p => p.name === player);
        if(p && p.hand) selected = [...p.hand];
      } else if(target === 'board') {
        if(isFlop) { // flop - ëª¨ë“  ë³´ë“œ ì¹´ë“œ í¬í•¨
          selected = window.state.board.filter(Boolean);
        } else if(index === 3) { // turn
          if(window.state.board[3]) selected = [window.state.board[3]];
        } else if(index === 4) { // river
          if(window.state.board[4]) selected = [window.state.board[4]];
        }
      }
      
      const used=[...window.state.playersInHand.flatMap(p=>p.hand||[]), ...window.state.board].filter(Boolean);
      let deckHTML='';
      Object.keys(SUITS).forEach(suitKey=>{
        deckHTML+='<div class="flex justify-center gap-1 mb-1">';
        RANKS.forEach(rank=>{
          const id=`${rank}${suitKey}`;
          // ë‹¤ë¥¸ ê³³ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ì¹´ë“œ ì²´í¬ (í˜„ì¬ ëŒ€ìƒ ì œì™¸)
          let usedByOthers = false;
          const othersCards = [...window.state.playersInHand.flatMap(p => {
            if(target === 'playerHand' && p.name === player) return []; // í˜„ì¬ í”Œë ˆì´ì–´ ì œì™¸
            return p.hand || [];
          })];
          if(target !== 'board') {
            othersCards.push(...window.state.board.filter(Boolean));
          }
          usedByOthers = othersCards.includes(id) && !selected.includes(id);
          
          const isSelected = selected.includes(id);
          const color=(suitKey==='h'||suitKey==='d')?'card-red':'card-black';
          const bgClass = isSelected ? 'bg-amber-300' : (usedByOthers ? 'bg-gray-600 text-gray-500' : 'bg-white hover:bg-amber-300');
          const selectedClass = isSelected ? 'selected' : '';
          
          deckHTML+=`<button class="btn card-selector-btn rounded-md w-9 h-11 ${bgClass} ${color} ${selectedClass}" data-card-id="${id}" ${usedByOthers?'disabled':''}>${rank}${SUITS[suitKey]}</button>`;
        });
        deckHTML+='</div>';
      });
      const html=`<div class="bg-gray-800 rounded-lg p-2 w-full max-w-md">
        <h2 class="text-lg font-bold text-amber-400 mb-2 text-center">ì¹´ë“œ ì„ íƒ ${isFlop ? '(í”Œë/í„´/ë¦¬ë²„)' : `(${count}ì¥)`}</h2>
        <div id="selected-cards" class="text-center mb-2 text-sm text-gray-300">ì„ íƒëœ ì¹´ë“œ: <span id="selected-count">${selected.length}</span>/${isFlop ? '3-5' : maxCards}</div>
        <div id="card-deck">${deckHTML}</div>
        <div class="flex gap-2 mt-2">
          <button id="close-card-modal" class="btn flex-1 bg-red-600 py-2 rounded-md">ë‹«ê¸°</button>
          <button id="confirm-cards" class="btn flex-1 bg-green-600 py-2 rounded-md">í™•ì¸</button>
        </div>
      </div>`;
      openModal(el.cardSelectorModal, html);
      // ì¹´ë“œ ì„ íƒ ì´ë²¤íŠ¸
      const updateSelectedCount = () => {
        const counter = el.cardSelectorModal.querySelector('#selected-count');
        if(counter) counter.textContent = selected.length;
      };
      
      el.cardSelectorModal.querySelector('#card-deck').onclick=e=>{
        const btn=e.target.closest('.card-selector-btn'); if(!btn) return;
        const id=btn.dataset.cardId; const idx=selected.indexOf(id);
        const { target, count } = window.state.modalState.cardTarget;
        const isFlop = target === 'board' && count === 3;
        const maxAllowed = isFlop ? 5 : count; // í”Œëì—ì„œëŠ” ìµœëŒ€ 5ì¥ê¹Œì§€
        
        if(idx>-1){ 
          // ì´ë¯¸ ì„ íƒëœ ì¹´ë“œë¥¼ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì„ íƒ í•´ì œ
          selected.splice(idx,1); 
          btn.classList.remove('selected');
          btn.classList.remove('bg-amber-300');
          btn.classList.add('bg-white', 'hover:bg-amber-300');
        }
        else if(selected.length<maxAllowed){ 
          selected.push(id); 
          btn.classList.add('selected');
          btn.classList.remove('bg-white', 'hover:bg-amber-300');
          btn.classList.add('bg-amber-300');
        }
        updateSelectedCount();
      };
      
      // í™•ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸
      el.cardSelectorModal.querySelector('#confirm-cards').onclick=()=>{
        const { target, count } = window.state.modalState.cardTarget;
        const isFlop = target === 'board' && count === 3;
        
        // í”Œëì—ì„œëŠ” ìµœì†Œ 3ì¥ í•„ìˆ˜
        if(isFlop && selected.length > 0 && selected.length < 3) {
          showFeedback('í”Œëì€ ìµœì†Œ 3ì¥ì„ ì„ íƒí•´ì•¼ í•©ë‹ˆë‹¤.', true);
          return;
        }
        
        // ì¹´ë“œê°€ ì—†ìœ¼ë©´ ì œê±°, ìˆìœ¼ë©´ í• ë‹¹
        assignCard(selected.length > 0 ? selected : null);
      };
    }

    // ìƒˆë¡œìš´ ìŠ¤íŠ¸ë¦¿ ê¸°ë°˜ ì•¡ì…˜ ì‹œìŠ¤í…œ
    function openActionPad(street){
      if(window.state.playersInHand.length<1){ showFeedback('ë¨¼ì € í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', true); return; }

      // ì•¡ì…˜ ê´€ë¦¬ì ë™ê¸°í™”
      window.actionManager.currentStreet = street;
      window.state.currentStreet = street;
      window.state.modalState.actionPadStreet = street;

      const activePlayers = window.actionManager.getActivePlayers(window.state.playersInHand);
      if(activePlayers.length === 0) {
        showFeedback('ë² íŒ… ê°€ëŠ¥í•œ í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.', true);
        return;
      }

      // í˜„ì¬ ì•¡ì…˜í•  í”Œë ˆì´ì–´
      const currentPlayer = window.actionManager.getCurrentActionPlayer();
      const actionOrder = window.actionManager.calculateActionOrder(street);

      // ì•¡ì…˜ ëª¨ë“œ í† ê¸€ ë²„íŠ¼
      const modeIcon = window.actionManager.actionMode === 'auto' ? 'ğŸ¤–' : 'ğŸ‘†';
      const modeText = window.actionManager.actionMode === 'auto' ? 'ìë™ ìˆœì„œ' : 'ìˆ˜ë™ ì„ íƒ';

      // ì•¡ì…˜ í í‘œì‹œ
      const queueDisplay = actionOrder.map((p, index) => {
        const isCurrent = currentPlayer && p.name === currentPlayer.name;
        const hasActed = (window.state.actionState[street] || []).some(a => a.player === p.name);

        let statusIcon = 'â³';
        let statusClass = 'text-gray-400';

        if (hasActed) {
          statusIcon = 'âœ…';
          statusClass = 'text-green-400';
        } else if (isCurrent) {
          statusIcon = 'ğŸ¯';
          statusClass = 'text-amber-400 animate-pulse';
        }

        return `<span class="${statusClass}">${statusIcon} ${p.name}</span>`;
      }).join(' â†’ ');

      // Check/Call ì•¡ì…˜ ê²°ì • (í˜„ì¬ í”Œë ˆì´ì–´ìš©)
      let checkCallButtonHTML = '';
      if(currentPlayer) {
        const smartAction = getSmartCheckCallAction(currentPlayer.name, street);
        const btnColor = smartAction.action === 'Checks' ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700';
        const btnIcon = smartAction.action === 'Checks' ? 'âœ…' : 'ğŸ“';
        const btnText = smartAction.action === 'Checks' ? 'Check' : `Call ${formatNumber(smartAction.amount)}`;

        checkCallButtonHTML = `
          <button id="smart-check-call-btn" class="btn ${btnColor} p-3 rounded-md" data-action="SmartCheckCall" data-player="${currentPlayer.name}">
            ${btnIcon} ${btnText}
          </button>`;
      }

      const html=`<div class="bg-gray-800 rounded-lg p-4 w-full max-w-lg">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-amber-400">${street.toUpperCase()} ì•¡ì…˜</h2>
          <button id="toggle-action-mode" class="text-sm bg-gray-700 px-3 py-1 rounded">
            ${modeIcon} ${modeText}
          </button>
        </div>

        <!-- ì•¡ì…˜ í í‘œì‹œ -->
        <div class="bg-gray-900 p-3 rounded mb-4">
          <div class="text-xs text-gray-400 mb-1">ì•¡ì…˜ ìˆœì„œ:</div>
          <div class="text-sm">${queueDisplay}</div>
          ${currentPlayer ? `<div class="text-xs text-amber-400 mt-2">í˜„ì¬ ì°¨ë¡€: ${currentPlayer.name}</div>` : ''}
        </div>

        <!-- í˜„ì¬ í”Œë ˆì´ì–´ ì•¡ì…˜ ë²„íŠ¼ -->
        ${currentPlayer && window.actionManager.actionMode === 'auto' ? `
          <div class="mb-4">
            <div class="text-center text-lg font-bold text-amber-400 mb-3">${currentPlayer.name}ì˜ ì•¡ì…˜</div>
            <div id="current-player-actions" class="grid grid-cols-2 gap-2">
              <button class="btn bg-red-600 hover:bg-red-700 p-3 rounded-md" data-action="Folds" data-player="${currentPlayer.name}">
                âŒ Fold
              </button>
              ${checkCallButtonHTML}
              <button class="btn bg-blue-600 hover:bg-blue-700 p-3 rounded-md" data-action="Bet/Raises" data-player="${currentPlayer.name}">
                ğŸ’° Bet/Raise
              </button>
              <button class="btn bg-red-800 hover:bg-red-900 font-bold p-3 rounded-md" data-action="All In" data-player="${currentPlayer.name}">
                ğŸš€ ALL IN
              </button>
            </div>
          </div>
        ` : ''}

        <!-- ìˆ˜ë™ ëª¨ë“œ ë˜ëŠ” ëª¨ë“  í”Œë ˆì´ì–´ ì„ íƒ -->
        ${window.actionManager.actionMode === 'manual' || !currentPlayer ? `
          <div class="mb-4">
            <div class="text-sm text-gray-400 mb-2">í”Œë ˆì´ì–´ ì„ íƒ:</div>
            <div id="action-pad-players" class="grid grid-cols-3 gap-2 mb-3">
              ${activePlayers.map(p => {
                const hasActed = (window.state.actionState[street] || []).some(a => a.player === p.name);
                const btnClass = hasActed ? 'bg-gray-600' : 'bg-gray-700 hover:bg-gray-600';
                const indicator = hasActed ? ' âœ…' : '';
                return `<button class="btn ${btnClass} p-2 rounded-md" data-player-name="${p.name}">${p.name}${indicator}</button>`;
              }).join('')}
            </div>
            <div id="action-pad-actions" class="grid grid-cols-2 gap-2 hidden">
              <button class="btn bg-red-600 p-3 rounded-md" data-action="Folds">âŒ Fold</button>
              <button id="manual-smart-check-call-btn" class="btn bg-green-600 p-3 rounded-md" data-action="SmartCheckCall">
                <span class="action-label">âœ… Check</span>
                <span class="amount-label"></span>
              </button>
              <button class="btn bg-blue-600 p-3 rounded-md" data-action="Bet/Raises">ğŸ’° Bet/Raise</button>
              <button class="btn bg-red-800 font-bold p-3 rounded-md" data-action="All In">ğŸš€ ALL IN</button>
            </div>
          </div>
        ` : ''}

        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
        <div class="flex gap-2">
          ${window.actionManager.actionMode === 'auto' && currentPlayer ? `
            <button id="skip-current-player" class="btn bg-yellow-600 hover:bg-yellow-700 px-3 py-2 rounded text-sm">
              â­ï¸ ìŠ¤í‚µ
            </button>
          ` : ''}
          <button id="close-action-pad" class="btn flex-1 bg-gray-600 hover:bg-gray-700 py-2 rounded-md">ë‹«ê¸°</button>
        </div>
      </div>`;

      openModal(el.actionPadModal, html);
    }

    // í”Œë ˆì´ì–´ ì•¡ì…˜ ì‹¤í–‰ í•¨ìˆ˜ (ë³´ì•ˆ ë ˆì´ì–´ í¬í•¨)
    async function executePlayerAction(playerName, action, btn) {
      const modal = el.actionPadModal;
      const manager = window.actionManager;

      // Layer 6: ë®¤í…ìŠ¤ ì²´í¬ (ë™ì‹œ ì•¡ì…˜ ë°©ì§€)
      if (manager.isProcessing) {
        console.warn('ì´ë¯¸ ì•¡ì…˜ì´ ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤');
        showFeedback('âš ï¸ ì´ì „ ì•¡ì…˜ ì²˜ë¦¬ ì¤‘...', true);
        return;
      }

      manager.isProcessing = true;

      try {
        // Layer 1: íƒ€ì„ìŠ¤íƒ¬í”„ ìƒì„± (ë¡œê¹…ìš©)
        const timestamp = manager.timekeeper.generateTimestamp();
        manager.timekeeper.validateAndUpdate(timestamp);

        // Layer 2: Rate monitoring (ë¡œê¹…ìš©)
        manager.rateLimiter.check(playerName);

        // Layer 3: í”Œë ˆì´ì–´ ê²€ì¦ (ìë™ ë“±ë¡ ì œê±°)
        // manager.stateValidator.validatePlayer(playerName); // ì¤‘ë³µ ë“±ë¡ ë°©ì§€ë¥¼ ìœ„í•´ ì œê±°

        // í˜„ì¬ í”Œë ˆì´ì–´ í™•ì¸ (ìë™ ëª¨ë“œ)
        if (manager.actionMode === 'auto') {
          const currentPlayer = manager.getCurrentActionPlayer();
          if (currentPlayer && currentPlayer.name !== playerName) {
            console.log(`ìˆœì„œ ë°– ì•¡ì…˜: ${playerName} (í˜„ì¬: ${currentPlayer.name})`);
            // ê·¸ë˜ë„ í—ˆìš©
          }
        }

        // Layer 5: íŠ¸ëœì­ì…˜ ì‹œì‘
        const transaction = manager.startTransaction();

        try {
          // í˜„ì¬ í”Œë ˆì´ì–´ë¥¼ actionPadPlayerë¡œ ì„¤ì •
          window.state.modalState.actionPadPlayer = playerName;

          // ì•¡ì…˜ ì²˜ë¦¬
          if(action === 'SmartCheckCall') {
            const smartAction = getSmartCheckCallAction(playerName, manager.currentStreet);
            addActionToLog(smartAction.label, smartAction.amount, playerName);
          } else if(action === 'Folds') {
            addActionToLog('Folds', null, playerName);
            // í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸
            window.state.playerStatus[playerName] = 'folded';
          } else if(action === 'All In') {
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              addActionToLog('All In', player.chips, playerName);
              window.state.playerStatus[playerName] = 'allin';
            }
          } else if(action === 'Bet/Raises') {
            closeModal(modal);
            window.state.modalState.actionPadPlayer = playerName;

            const st = manager.currentStreet;
            const hasBet = window.state.actionState[st]?.some(a => /BET|RAISE/i.test(a.action || ''));
            window.state.modalState.actionPadCurrentAction = hasBet ? 'Raises' : 'Bets';

            openKeypad(null, { purpose: 'bet', playerName: playerName });
            manager.isProcessing = false; // í‚¤íŒ¨ë“œ ëŒ€ê¸° ì¤‘ ì²˜ë¦¬ í•´ì œ
            return;
          }

          // ìƒíƒœ í•´ì‹œ ì—…ë°ì´íŠ¸
          manager.stateValidator.updateState();

          // íŠ¸ëœì­ì…˜ ì»¤ë°‹
          transaction.commit();

          // ìë™ ëª¨ë“œì—ì„œ ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ì´ë™
          if(manager.actionMode === 'auto') {
            const nextPlayer = manager.moveToNextPlayer();

            showFeedback(`âœ… ${playerName} ${action}`, false);

            if(nextPlayer) {
              // ì ì‹œ ëŒ€ê¸° í›„ ë‹¤ìŒ í”Œë ˆì´ì–´ ì•¡ì…˜ íŒì—…
              setTimeout(() => {
                openActionPad(manager.currentStreet);
              }, 300);
            } else {
              closeModal(modal);

              // ìŠ¤íŠ¸ë¦¿ ì™„ë£Œ ì²´í¬
              if (manager.isBettingRoundComplete()) {
                showFeedback(`ğŸ¯ ${manager.currentStreet.toUpperCase()} ì™„ë£Œ! ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ ì¤€ë¹„...`, false);

                // ìë™ìœ¼ë¡œ ë‹¤ìŒ ìŠ¤íŠ¸ë¦¿ ì§„í–‰
                setTimeout(() => {
                  manager.advanceToNextStreet();
                }, 500);
              }
            }
          } else {
            closeModal(modal);
            showFeedback(`âœ… ${playerName} ${action}`, false);
          }

        } catch (innerError) {
          // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ê³„ì† ì§„í–‰
          console.warn('ì•¡ì…˜ ì²˜ë¦¬ ì¤‘ ê²½ê³ :', innerError.message);
          transaction.rollback();
        }

      } catch (error) {
        // ì—ëŸ¬ ë¡œê·¸ë§Œ ì¶œë ¥í•˜ê³  ê³„ì† ì§„í–‰
        console.log('ì•¡ì…˜ ì²˜ë¦¬ ì¤‘ ì˜ˆì™¸:', error.message);
      } finally {
        manager.isProcessing = false;
      }
    }

    // ì¹© ì…ë ¥ ê°œì„  í•¨ìˆ˜
    function openChipInput(player, isInitial = false) {
      const currentChips = player.chips || '0';
      const placeholder = isInitial ? 'ì‹œì‘ ì¹© ì…ë ¥' : `í˜„ì¬: ${formatNumber(currentChips)}`;
      
      // í‚¤íŒ¨ë“œ ì˜µì…˜ ì„¤ì •
      window.state.modalState.keypadOptions = {
        purpose: 'chip',
        playerName: player.name
      };
      
      // íŒì—… ëª¨ë‹¬ ìƒì„±
      const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-xs">
        <h3 class="text-center text-amber-400 font-bold mb-3">${player.name} ì¹© ìˆ˜ì •</h3>
        <div class="text-xs text-gray-400 text-center mb-2">í˜„ì¬: ${formatNumber(currentChips)}</div>
        <input type="text" id="chip-text-input" class="w-full bg-gray-900 text-white p-2 rounded mb-3 text-center" placeholder="0" value="0">
        <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">0</div>
        <div class="grid grid-cols-3 gap-2 text-xl font-bold">
          ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
        </div>
        <div class="grid grid-cols-2 gap-2 mt-2">
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
        </div>
        <div class="grid grid-cols-2 gap-2 mt-2">
          <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
          <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
        </div>
      </div>`;
      
      openModal(el.keypadModal, html);
      
      // í…ìŠ¤íŠ¸ ì…ë ¥ê³¼ í‚¤íŒ¨ë“œ ë””ìŠ¤í”Œë ˆì´ ë™ê¸°í™”
      setTimeout(() => {
        const textInput = document.getElementById('chip-text-input');
        const display = document.getElementById('keypad-display');
        let currentInput = '0';
        
        if(textInput && display) {
          // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸
          textInput.addEventListener('input', () => {
            currentInput = unformatNumber(textInput.value) || '0';
            display.textContent = formatNumber(currentInput);
          });
          
          // í‚¤íŒ¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
          // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
          
          // ì·¨ì†Œ/í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
          // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
          
          // í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
          // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
        }
      }, 10);
    }
    
    function openKeypad(targetInput, options={}){
      window.state.modalState.keypadTarget=targetInput;
      window.state.modalState.keypadOptions=options;
      const initial = options.prefill !== undefined ? options.prefill : (targetInput?targetInput.value:'');

      // ë² íŒ… í‚¤íŒ¨ë“œì¸ ê²½ìš° í”Œë ˆì´ì–´ ì¹© í™•ì¸
      let playerChips = 0;
      let chipWarning = '';
      if(options.purpose === 'bet' && options.playerName) {
        const player = window.state.playersInHand.find(p => p.name === options.playerName);
        if(player) {
          playerChips = parseInt(unformatNumber(player.chips), 10);
          chipWarning = `<div class="text-xs text-gray-400 text-center mb-1">ë³´ìœ  ì¹©: ${formatNumber(playerChips)}</div>`;
        }
      } else if(options.purpose === 'bet' && window.state.modalState.actionPadPlayer) {
        const player = window.state.playersInHand.find(p => p.name === window.state.modalState.actionPadPlayer);
        if(player) {
          playerChips = parseInt(unformatNumber(player.chips), 10);
          chipWarning = `<div class="text-xs text-gray-400 text-center mb-1">ë³´ìœ  ì¹©: ${formatNumber(playerChips)}</div>`;
        }
      }

      const html=`<div class="bg-gray-800 rounded-lg p-2 w-full max-w-xs">
        ${chipWarning}
        <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">${initial}</div>
        <div id="keypad-warning" class="text-xs text-amber-400 text-center mb-2 hidden">âš ï¸ ì¹© ë¶€ì¡± - ì˜¬ì¸ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤</div>
        <div class="grid grid-cols-3 gap-2 text-xl font-bold">
          ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
        </div>
        <div class="grid grid-cols-${options.purpose === 'bet' ? '3' : '2'} gap-2 mt-2">
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
          <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
          ${options.purpose === 'bet' && playerChips > 0 ?
            `<button class="keypad-btn btn bg-purple-600 text-white p-3 rounded-md font-bold" data-action="max">MAX</button>` : ''
          }
        </div>
        <div class="grid grid-cols-2 gap-2 mt-2">
          <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
          <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
        </div>
      </div>`;
      openModal(el.keypadModal, html);

      // ì‹¤ì‹œê°„ ì¹© ì²´í¬ ê¸°ëŠ¥ ì¶”ê°€
      if(options.purpose === 'bet' && playerChips > 0) {
        const display = el.keypadModal.querySelector('#keypad-display');
        const warning = el.keypadModal.querySelector('#keypad-warning');

        // ë””ìŠ¤í”Œë ˆì´ ê°’ ë³€ê²½ ê°ì§€
        const observer = new MutationObserver(() => {
          const value = parseInt(unformatNumber(display.textContent) || 0, 10);
          if(value > playerChips) {
            warning.classList.remove('hidden');
            warning.textContent = `âš ï¸ ì¹© ë¶€ì¡±! ìµœëŒ€ ë² íŒ… ê°€ëŠ¥: ${formatNumber(playerChips)}`;
            warning.className = 'text-xs text-red-400 text-center mb-2';
          } else if(value === playerChips && value > 0) {
            warning.classList.remove('hidden');
            warning.textContent = `ğŸ’° ìµœëŒ€ ë² íŒ… - ë³´ìœ  ì¹© ì „ì²´`;
            warning.className = 'text-xs text-blue-400 text-center mb-2';
          } else {
            warning.classList.add('hidden');
          }
        });

        observer.observe(display, { childList: true, characterData: true, subtree: true });
      }
    }

    // ====== SELECTORS & INPUTS ======
    function togglePlayerInHand(name){
      const i=window.state.playersInHand.findIndex(p=>p.name===name);
      if(i>-1) {
        // í”Œë ˆì´ì–´ ì œê±° (ê²Œì„ì—ì„œ ì œì™¸)
        const player = window.state.playersInHand[i];
        window.state.playersInHand.splice(i,1);
        // seatMapì—ì„œë„ ì œê±°
        if(player.seatNo) {
          delete window.state.seatMap[player.seatNo];
        }
        console.log(`â– ${name} ê²Œì„ì—ì„œ ì œì™¸ (#${player.seatNo})`);
      } else {
        // í”Œë ˆì´ì–´ ì¶”ê°€ (ê²Œì„ì— ì°¸ì—¬)
        const pool=window.state.playerDataByTable[window.state.selectedTable]||[];
        const pd=pool.find(p=>p.name===name);
        if(!pd) return;
        
        const chips=pd.chips||'';
        const notable=pd.notable||pd.keyplayer||false;
        const seat=pd.seatNo||''; // Type ì‹œíŠ¸ì˜ seatNo ì •ë³´
        
        // seatMapì— ì¶”ê°€
        if(seat) {
          window.state.seatMap[seat] = name;
        }
        
        // ìƒˆ í”Œë ˆì´ì–´ ì¶”ê°€ ì‹œ initialChipsë¥¼ í˜„ì¬ ì¹©ìœ¼ë¡œ ì„¤ì •
        console.log(`â• ${name} ê²Œì„ ì°¸ì—¬: ì‹œì‘ì¹© = ${chips}, #${seat}`);
        window.state.playersInHand.push({
          name, 
          hand:[], 
          chips, 
          initialChips:chips,  // ì‹œì‘ì¹©ì€ í˜„ì¬ ì¹© ê°’ìœ¼ë¡œ ì„¤ì •
          role:null,
          notable:notable,  // Notable ì •ë³´ ì¶”ê°€
          seat:seat,  // Seat ì •ë³´ ìœ ì§€
          chipsSetAt: new Date().toISOString()  // ì¹© ì„¤ì • ì‹œê°„ ê¸°ë¡
        });
      }
      renderPlayerSelection(); 
      renderPlayerDetails(); 
      renderWinnerSelection();
    }
    function setPlayerRole(name){
      const finalPot = calculateFinalPot();
      
      // ê¸°ì¡´ ìŠ¹ì ì°¾ê¸°
      const prevWinner = window.state.playersInHand.find(p => p.role === 'winner');
      
      // ê¸°ì¡´ ìŠ¹ìê°€ ìˆìœ¼ë©´ íŒŸ ê¸ˆì•¡ ì°¨ê°
      if(prevWinner && prevWinner.name !== name) {
        const prevChips = parseInt(unformatNumber(prevWinner.chips) || 0, 10);
        prevWinner.chips = (prevChips - finalPot).toString();
        prevWinner.role = null;
      }
      
      // ìƒˆ ìŠ¹ì ì„¤ì •
      const p = window.state.playersInHand.find(pp => pp.name === name);
      if(!p) return;
      
      if(p.role === 'winner') {
        // ìŠ¹ì í•´ì œ
        const currentChips = parseInt(unformatNumber(p.chips) || 0, 10);
        p.chips = (currentChips - finalPot).toString();
        p.role = null;
      } else {
        // ìŠ¹ì ì„¤ì •
        const currentChips = parseInt(unformatNumber(p.chips) || 0, 10);
        p.chips = (currentChips + finalPot).toString();
        p.role = 'winner';
        
        // ë‹¤ë¥¸ ëª¨ë“  í”Œë ˆì´ì–´ì˜ role í•´ì œ
        window.state.playersInHand.forEach(player => {
          if(player.name !== name) player.role = null;
        });
      }
      
      // ì¹© ë³€ê²½ íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë¡
      p.chipsUpdatedAt = new Date().toISOString();
      
      renderPlayerDetails(); 
      renderWinnerSelection();
      renderActionStreets(); // ì•¡ì…˜ ë¡œê·¸ì—ë„ ìŠ¹ì í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
    }
    function assignCard(cards){
      const {target,player,index,count} = window.state.modalState.cardTarget;
      if(target==='board'){
        if(!cards || cards.length === 0) {
          // ì¹´ë“œ ì œê±°
          if(count === 3) { // flop
            window.state.board[0] = null;
            window.state.board[1] = null;
            window.state.board[2] = null;
            window.state.board[3] = null; // í„´ë„ ì œê±°
            window.state.board[4] = null; // ë¦¬ë²„ë„ ì œê±°
          } else if(index === 3) { // turn
            window.state.board[3] = null;
          } else if(index === 4) { // river
            window.state.board[4] = null;
          }
        } else {
          // ë³´ë“œ ë°°ì—´ì´ ì¶©ë¶„í•œ í¬ê¸°ì¸ì§€ í™•ì¸
          while(window.state.board.length <= 4) {
            window.state.board.push(null);
          }
          
          // ì¹´ë“œ í• ë‹¹
          if(count === 3) { // flopì—ì„œ ì„ íƒ
            // í”Œë 3ì¥
            window.state.board[0] = cards[0] || null;
            window.state.board[1] = cards[1] || null;
            window.state.board[2] = cards[2] || null;
            
            // 4ì¥ ì´ìƒ ì„ íƒí–ˆìœ¼ë©´ í„´ì— í• ë‹¹
            if(cards.length >= 4) {
              window.state.board[3] = cards[3];
            }
            
            // 5ì¥ ì„ íƒí–ˆìœ¼ë©´ ë¦¬ë²„ì—ë„ í• ë‹¹
            if(cards.length >= 5) {
              window.state.board[4] = cards[4];
            }
          } else {
            // turn(index=3) ë˜ëŠ” river(index=4): í•´ë‹¹ ì¸ë±ìŠ¤ë§Œ ì—…ë°ì´íŠ¸
            window.state.board[index] = cards[0] || null;
          }
        }
        renderBoard();
      }
      else{
        const p=window.state.playersInHand.find(pp=>pp.name===player);
        if(p){ 
          p.hand = cards || []; // nullì´ë©´ ë¹ˆ ë°°ì—´ë¡œ
          renderPlayerDetails();
        }
      }
      closeModal(el.cardSelectorModal);
    }
    function addActionToLog(action, amount=null, player=null){
      const { actionPadStreet, actionPadPlayer } = window.state.modalState;
      const playerName = player || actionPadPlayer;

      // í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸ (null ì²´í¬ ì¶”ê°€)
      if (!action) {
        console.warn('addActionToLog: actionì´ null ë˜ëŠ” undefinedì…ë‹ˆë‹¤');
        return;
      }

      if (action === 'Folds') {
        window.state.playerStatus[playerName] = 'folded';
      } else if (action === 'All In') {
        window.state.playerStatus[playerName] = 'allin';
      } else if (action.includes('Call')) {
        window.state.playerStatus[playerName] = 'called';
      } else if (action.includes('Bet') || action.includes('Raise')) {
        window.state.playerStatus[playerName] = 'bet';
      }

      // ì•¡ì…˜ ê´€ë¦¬ìì™€ ë™ê¸°í™”
      if(window.actionManager && window.actionManager.actionMode === 'auto') {
        window.actionManager.currentStreet = actionPadStreet;
      }
      
      if (amount){
        const p = window.state.playersInHand.find(pp => pp.name === actionPadPlayer);
        if (p){
          const cur = parseInt(unformatNumber(p.chips) || 0, 10);
          const amountToDeduct = parseInt(unformatNumber(amount), 10);

          // ì¹© ì´ˆê³¼ ê²½ê³  (ì°¨ë‹¨í•˜ì§€ ì•ŠìŒ)
          // ìŒìˆ˜ ì¹©ë„ í—ˆìš©í•˜ì—¬ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬
          if(amountToDeduct > cur && action !== 'All In') {
            console.log(`[v3.3.3] ì¹© ì´ˆê³¼ ê²½ê³ : ${playerName} - ìš”ì²­: ${amountToDeduct}, ë³´ìœ : ${cur}`);

            // ê²½ê³ ë§Œ í‘œì‹œí•˜ê³  ì§„í–‰ì€ í—ˆìš©
            showFeedback(`âš ï¸ ì£¼ì˜: ì¹©ì´ ë¶€ì¡±í•©ë‹ˆë‹¤ (ë³´ìœ : ${formatNumber(cur)}, ë² íŒ…: ${formatNumber(amountToDeduct)})`, true);
            showFeedback(`ğŸ’° ì¹©ì´ ë§ˆì´ë„ˆìŠ¤ê°€ ë©ë‹ˆë‹¤: ${formatNumber(cur - amountToDeduct)}`, false);
          }

          // ì¹© ì°¨ê° ì²˜ë¦¬ (ë§ˆì´ë„ˆìŠ¤ í—ˆìš©)
          if(action === 'All In') {
            p.chips = '0';
          } else {
            // ì¹© ì°¨ê° - ë§ˆì´ë„ˆìŠ¤ë„ í—ˆìš©
            const newChips = cur - amountToDeduct;
            p.chips = newChips.toString();

            // ë§ˆì´ë„ˆìŠ¤ ì¹©ì¸ ê²½ìš° ì‹œê°ì  í‘œì‹œë¥¼ ìœ„í•œ í”Œë˜ê·¸
            if(newChips < 0) {
              p.hasNegativeChips = true;
              console.log(`[v3.3.3] ë§ˆì´ë„ˆìŠ¤ ì¹© ë°œìƒ: ${playerName} = ${newChips}`);
            } else {
              p.hasNegativeChips = false;
            }
          }
          p.chipsUpdatedAt = new Date().toISOString();
        }
      }
      window.state.actionState[actionPadStreet].push({
        player: actionPadPlayer,
        action,
        amount,
        timestamp: new Date().toISOString()
      });
      saveActionState();
      renderAll();
      closeModal(el.actionPadModal);
      
      // ìŠ¤íŠ¸ë¦¬íŠ¸ ì™„ë£Œ ì²´í¬
      checkStreetComplete(actionPadStreet);
    }

    function undoLastAction(street){
      const last=window.state.actionState[street].pop();
      if(last) {
        // í”Œë ˆì´ì–´ ìƒíƒœ ë³µì›
        if(last.action === 'Folds' || last.action === 'All In') {
          delete window.state.playerStatus[last.player];
        }
        
        // ì¹© ë³µì›
        if(last.amount){
          const p=window.state.playersInHand.find(pp=>pp.name===last.player);
          if(p){ 
            const cur=parseInt(unformatNumber(p.chips)||0,10); 
            p.chips=(cur+parseInt(unformatNumber(last.amount),10)).toString(); 
          }
        }
      }
      saveActionState(); renderAll();
    }

    // ====== SEAT ARRANGEMENT & ACTION ORDER ======
    function initializeSeatGrid() {
      const buttonSelect = document.getElementById('button-position-select');
      
      // ë²„íŠ¼ ìœ„ì¹˜ ì˜µì…˜ ìƒì„± (10ê°œ)
      if(buttonSelect) {
        buttonSelect.innerHTML = '<option value="">ì„ íƒ</option>';
        for(let i = 1; i <= 10; i++) {
          const option = document.createElement('option');
          option.value = i;
          option.textContent = `${i}ë²ˆ`;
          buttonSelect.appendChild(option);
        }
      }
      
      // ì´ˆê¸° ë Œë”ë§
      renderPlayerSelection();
    }
    
    function updateSeatDisplay() {
      // ìƒˆë¡œìš´ êµ¬ì¡°ì—ì„œëŠ” renderPlayerSelectionì´ ëª¨ë“  ê²ƒì„ ì²˜ë¦¬
      // renderPlayerSelection ë‚´ë¶€ì—ì„œ updatePositionIndicatorsë¥¼ í˜¸ì¶œí•¨
      renderPlayerSelection();
    }
    
    function getPositionsForSeat(seatNum) {
      const positions = [];
      if(!window.state.buttonPosition) return positions;
      
      const btnPos = parseInt(window.state.buttonPosition);
      const allPlayerSeats = getAllPlayerSeats();
      
      if(seatNum === btnPos) positions.push('BTN');
      
      // SB, BB ê³„ì‚° (ì „ì²´ í”Œë ˆì´ì–´ ì¤‘ ë²„íŠ¼ ë‹¤ìŒ í”Œë ˆì´ì–´ë“¤)
      const sbSeat = getNextPlayerSeat(btnPos, allPlayerSeats);
      const bbSeat = getNextPlayerSeat(sbSeat, allPlayerSeats);
      
      if(seatNum === sbSeat) positions.push('SB');
      if(seatNum === bbSeat) positions.push('BB');
      
      return positions;
    }
    
    function getOccupiedSeats() {
      return Object.keys(window.state.seatMap)
        .map(s => parseInt(s))
        .filter(s => window.state.seatMap[s])
        .sort((a, b) => a - b);
    }
    
    // ì „ì²´ í”Œë ˆì´ì–´ ì¢Œì„ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° (ê²Œì„ ì°¸ì—¬ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´)
    function getAllPlayerSeats() {
      if(!window.state.selectedTable) return [];
      const tableData = window.state.playerDataByTable[window.state.selectedTable] || [];
      return tableData
        .filter(player => player.seatNo)
        .map(player => parseSeatNo(player.seatNo))
        .sort((a, b) => a - b);
    }
    
    // ì „ì²´ í”Œë ˆì´ì–´ ì¤‘ì—ì„œ ë‹¤ìŒ ì¢Œì„ ì°¾ê¸° (SB/BB ê³„ì‚°ìš©)
    function getNextPlayerSeat(currentSeat, allSeats) {
      if(!allSeats.length) return null;
      
      // í˜„ì¬ ì¢Œì„ ë‹¤ìŒì˜ ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ ì¢Œì„ ì°¾ê¸°
      for(let i = 1; i <= 10; i++) {
        const nextSeat = ((currentSeat + i - 1) % 10) + 1;
        if(allSeats.includes(nextSeat)) {
          return nextSeat;
        }
      }
      return allSeats[0];
    }
    
    function getNextOccupiedSeat(currentSeat, occupiedSeats) {
      if(!occupiedSeats.length) return null;
      
      // í˜„ì¬ ì¢Œì„ ë‹¤ìŒì˜ ì²« ë²ˆì§¸ ì ìœ  ì¢Œì„ ì°¾ê¸°
      for(let i = 1; i <= 10; i++) {
        const nextSeat = ((currentSeat + i - 1) % 10) + 1;
        if(occupiedSeats.includes(nextSeat)) {
          return nextSeat;
        }
      }
      return occupiedSeats[0];
    }
    
    function updateButtonPositionDisplay() {
      const display = document.getElementById('position-display');
      if(!display) return;
      
      if(!window.state.buttonPosition) {
        display.innerHTML = '<span class="text-gray-400">ë²„íŠ¼ì„ ì„ íƒí•˜ë©´ SB/BBê°€ ìë™ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤</span>';
        return;
      }
      
      // ì „ì²´ í”Œë ˆì´ì–´ ì¢Œì„ ë¦¬ìŠ¤íŠ¸ì—ì„œ SB/BB ê³„ì‚°
      const allPlayerSeats = getAllPlayerSeats();
      const btnPos = parseInt(window.state.buttonPosition);
      const sbSeat = getNextPlayerSeat(btnPos, allPlayerSeats);
      const bbSeat = getNextPlayerSeat(sbSeat, allPlayerSeats);
      
      // í”Œë ˆì´ì–´ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ì „ì²´ í…Œì´ë¸” ë°ì´í„°ì—ì„œ)
      const tableData = window.state.playerDataByTable[window.state.selectedTable] || [];
      const btnPlayer = tableData.find(p => parseSeatNo(p.seatNo) === btnPos)?.name || 'ë¹ˆìë¦¬';
      const sbPlayer = tableData.find(p => parseSeatNo(p.seatNo) === sbSeat)?.name || 'ë¹ˆìë¦¬';
      const bbPlayer = tableData.find(p => parseSeatNo(p.seatNo) === bbSeat)?.name || 'ë¹ˆìë¦¬';
      
      display.innerHTML = `
        <div class="grid grid-cols-3 gap-2 text-center">
          <div class="bg-yellow-900/30 rounded p-1">
            <span class="text-yellow-400 font-bold">ğŸ¯ BTN</span>
            <div class="text-white text-xs">${btnPlayer}</div>
          </div>
          <div class="bg-green-900/30 rounded p-1">
            <span class="text-green-400 font-bold">SB</span>
            <div class="text-white text-xs">${sbPlayer}</div>
          </div>
          <div class="bg-blue-900/30 rounded p-1">
            <span class="text-blue-400 font-bold">BB</span>
            <div class="text-white text-xs">${bbPlayer}</div>
          </div>
        </div>
      `;
    }
    
    function updatePositionIndicators() {
      const indicators = document.getElementById('position-indicators');
      if(!window.state.buttonPosition) {
        indicators.textContent = '';
        return;
      }
      
      // ì „ì²´ í”Œë ˆì´ì–´ ì¢Œì„ ë¦¬ìŠ¤íŠ¸ì—ì„œ SB/BB ê³„ì‚°
      const allPlayerSeats = getAllPlayerSeats();
      const btnPos = parseInt(window.state.buttonPosition);
      const sbSeat = getNextPlayerSeat(btnPos, allPlayerSeats);
      const bbSeat = getNextPlayerSeat(sbSeat, allPlayerSeats);
      
      // í”Œë ˆì´ì–´ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ì „ì²´ í…Œì´ë¸” ë°ì´í„°ì—ì„œ)
      const tableData = window.state.playerDataByTable[window.state.selectedTable] || [];
      const btnPlayer = tableData.find(p => parseSeatNo(p.seatNo) === btnPos)?.name || 'ë¹ˆìë¦¬';
      const sbPlayer = tableData.find(p => parseSeatNo(p.seatNo) === sbSeat)?.name || 'ë¹ˆìë¦¬';
      const bbPlayer = tableData.find(p => parseSeatNo(p.seatNo) === bbSeat)?.name || 'ë¹ˆìë¦¬';
      
      indicators.innerHTML = `
        <span class="text-yellow-400">BTN: ${btnPlayer}</span>
        <span class="text-green-400">SB: ${sbPlayer}</span>
        <span class="text-blue-400">BB: ${bbPlayer}</span>
      `;
    }
    
    function getActionOrder(street) {
      const occupiedSeats = getOccupiedSeats();
      if(!occupiedSeats.length || !window.state.buttonPosition) {
        // ë²„íŠ¼ ìœ„ì¹˜ê°€ ì—†ìœ¼ë©´ ë°°ì—´ ìˆœì„œëŒ€ë¡œ
        return window.state.playersInHand.map(p => p.name);
      }
      
      const btnPos = parseInt(window.state.buttonPosition);
      const sbSeat = getNextOccupiedSeat(btnPos, occupiedSeats);
      const bbSeat = getNextOccupiedSeat(sbSeat, occupiedSeats);
      
      let actionOrder = [];
      
      if(street === 'preflop') {
        // í”„ë¦¬í”Œë: UTG(BB ë‹¤ìŒ) â†’ ... â†’ BTN â†’ SB â†’ BB
        let startSeat = getNextOccupiedSeat(bbSeat, occupiedSeats);
        let currentSeat = startSeat;
        
        // BB ì „ê¹Œì§€ ìˆœíšŒ
        while(currentSeat !== bbSeat) {
          if(window.state.seatMap[currentSeat]) {
            actionOrder.push(window.state.seatMap[currentSeat]);
          }
          currentSeat = getNextOccupiedSeat(currentSeat, occupiedSeats);
        }
        // ë§ˆì§€ë§‰ì— BB ì¶”ê°€
        if(window.state.seatMap[bbSeat]) {
          actionOrder.push(window.state.seatMap[bbSeat]);
        }
      } else {
        // í¬ìŠ¤íŠ¸í”Œë: SB â†’ BB â†’ ... â†’ BTN
        let currentSeat = sbSeat;
        let count = 0;
        
        while(count < occupiedSeats.length) {
          if(window.state.seatMap[currentSeat]) {
            actionOrder.push(window.state.seatMap[currentSeat]);
          }
          currentSeat = getNextOccupiedSeat(currentSeat, occupiedSeats);
          count++;
        }
      }
      
      return actionOrder;
    }
    
    function getNextActionPlayer(street) {
      const actionOrder = getActionOrder(street);
      const actions = window.state.actionState[street] || [];
      
      // í´ë“œ/ì˜¬ì¸ í”Œë ˆì´ì–´ ì œì™¸
      const activePlayers = actionOrder.filter(name => 
        window.state.playerStatus[name] !== 'folded' && 
        window.state.playerStatus[name] !== 'allin'
      );
      
      if(activePlayers.length === 0) return null;
      
      // ë§ˆì§€ë§‰ ì•¡ì…˜í•œ í”Œë ˆì´ì–´ ì°¾ê¸°
      for(let i = actions.length - 1; i >= 0; i--) {
        const lastPlayer = actions[i].player;
        const idx = activePlayers.indexOf(lastPlayer);
        if(idx !== -1) {
          // ë‹¤ìŒ í”Œë ˆì´ì–´ ë°˜í™˜
          return activePlayers[(idx + 1) % activePlayers.length];
        }
      }
      
      // ì•¡ì…˜ì´ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ í™œì„± í”Œë ˆì´ì–´
      return activePlayers[0];
    }

    // ====== ì•¡ì…˜ ìë™ ë§¤í•‘ ì‹œìŠ¤í…œ ======
    
    // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´ ê³„ì‚°
    function calculateNextActionPlayer(street) {
      const actionOrder = getActionOrder(street);
      const actions = window.state.actionState[street] || [];
      
      // í´ë“œ/ì˜¬ì¸ í”Œë ˆì´ì–´ ì œì™¸í•œ í™œì„± í”Œë ˆì´ì–´ë§Œ
      const activePlayers = actionOrder.filter(name => {
        const status = window.state.playerStatus[name];
        return status !== 'folded' && status !== 'allin';
      });
      
      if(activePlayers.length === 0) {
        return null; // ëª¨ë“  í”Œë ˆì´ì–´ê°€ í´ë“œ/ì˜¬ì¸
      }
      
      // ì´ë²ˆ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ì•¡ì…˜í•œ íšŸìˆ˜ ê³„ì‚°
      const actionCounts = {};
      activePlayers.forEach(name => actionCounts[name] = 0);
      
      actions.forEach(action => {
        if(actionCounts.hasOwnProperty(action.player)) {
          actionCounts[action.player]++;
        }
      });
      
      // ê°€ì¥ ì ê²Œ ì•¡ì…˜í•œ í”Œë ˆì´ì–´ ì°¾ê¸° (ìˆœì„œëŒ€ë¡œ)
      for(const player of activePlayers) {
        const minActionCount = Math.min(...Object.values(actionCounts));
        if(actionCounts[player] === minActionCount) {
          return player;
        }
      }
      
      return activePlayers[0];
    }
    
    // ë‹¤ìŒ ì•¡ì…˜ í”Œë ˆì´ì–´ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updateNextActionDisplay() {
      const street = window.state.currentStreet;
      const nextPlayer = calculateNextActionPlayer(street);
      
      window.state.nextActionPlayer = nextPlayer;
      
      // í—¤ë”ì— í˜„ì¬ ì°¨ë¡€ í‘œì‹œ
      const turnIndicator = document.getElementById('current-turn-indicator');
      if(turnIndicator && nextPlayer) {
        const playerData = window.state.playersInHand.find(p => p.name === nextPlayer);
        const positions = playerData ? getPositionsForSeat(parseInt(playerData.seat) || 0) : [];
        const positionStr = positions.length > 0 ? `(${positions.join(',')})` : '';
        
        turnIndicator.innerHTML = `
          <span class="text-amber-400">í˜„ì¬ ì°¨ë¡€:</span>
          <span class="font-bold text-white">${nextPlayer} ${positionStr}</span>
        `;
        turnIndicator.classList.remove('hidden');
      } else if(turnIndicator) {
        turnIndicator.classList.add('hidden');
      }
      
      // í”Œë ˆì´ì–´ ì¹´ë“œ í•˜ì´ë¼ì´íŠ¸
      document.querySelectorAll('.player-card').forEach(card => {
        const playerName = card.dataset.playerName;
        if(playerName === nextPlayer) {
          card.classList.add('border-2', 'border-amber-400', 'animate-pulse');
        } else {
          card.classList.remove('border-2', 'border-amber-400', 'animate-pulse');
        }
      });
    }
    
    // ì•¡ì…˜ ìë™ ì¶”ê°€ (ìë™ ëª¨ë“œ)
    function addAutoAction(actionType, amount = '') {
      if(window.state.actionInputMode !== 'auto') {
        return false;
      }
      
      const street = window.state.currentStreet;
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(street);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return false;
      }
      
      // ì•¡ì…˜ ì¶”ê°€
      addActionToState(nextPlayer, actionType, amount, street);
      
      // í”Œë ˆì´ì–´ ìƒíƒœ ì—…ë°ì´íŠ¸
      if(actionType === 'Folds') {
        window.state.playerStatus[nextPlayer] = 'folded';
      } else if(actionType === 'All-in' || actionType === 'All In') {
        window.state.playerStatus[nextPlayer] = 'allin';
      }
      
      // UI ì—…ë°ì´íŠ¸
      renderActionStreets();
      updateNextActionDisplay();
      saveActionState();
      
      return true;
    }
    
    // ìŠ¤ë§ˆíŠ¸ ì½œ ì²˜ë¦¬
    function handleSmartCall() {
      const street = window.state.currentStreet;
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(street);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return;
      }
      
      const smartAction = getSmartCheckCallAction(nextPlayer, street);
      if(smartAction.action === 'Checks') {
        addAutoAction('Checks');
      } else {
        addAutoAction(smartAction.action, smartAction.amount);
      }
    }
    
    // ì˜¬ì¸ ì²˜ë¦¬
    function handleAllIn() {
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(window.state.currentStreet);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return;
      }
      
      const playerData = window.state.playersInHand.find(p => p.name === nextPlayer);
      if(playerData) {
        addAutoAction('All-in', playerData.chips);
      }
    }
    
    // ë¹ ë¥¸ ë²³/ë ˆì´ì¦ˆ ì…ë ¥
    function openQuickBetRaise() {
      const street = window.state.currentStreet;
      const nextPlayer = window.state.nextActionPlayer || calculateNextActionPlayer(street);
      
      if(!nextPlayer) {
        showFeedback('ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì•¡ì…˜ì„ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤', true);
        return;
      }
      
      // í‚¤íŒ¨ë“œ ì—´ê¸°
      openKeypad(null, { 
        purpose: 'quickBet',
        player: nextPlayer,
        street: street
      });
    }
    
    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡
    window.addAutoAction = addAutoAction;
    window.handleSmartCall = handleSmartCall;
    window.handleAllIn = handleAllIn;
    window.openQuickBetRaise = openQuickBetRaise;
    
    // ====== PERSIST (localStorage) ======
    function saveActionState(){ localStorage.setItem('phl_v46_state', JSON.stringify(window.state.actionState)); }
    function loadActionState(){
      const s=localStorage.getItem('phl_v46_state');
      if(s) window.state.actionState={...window.state.actionState, ...JSON.parse(s)};
      updateBlindButtons();
    }

    function updateBlindButtons() {
      const smallBlindBtn = document.getElementById('small-blind-btn');
      const bigBlindBtn = document.getElementById('big-blind-btn');

      if(smallBlindBtn) {
        smallBlindBtn.textContent = formatNumber(window.state.actionState.smallBlind || '0');
      }
      if(bigBlindBtn) {
        bigBlindBtn.textContent = formatNumber(window.state.actionState.bigBlind || '0');
      }
    }

    // ====== SMART CHECK/CALL ======
    function getSmartCheckCallAction(player, street) {
      const actions = window.state.actionState[street];
      let lastBet = null;
      let requiredAmt = 0;
      
      // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œë§Œ ë§ˆì§€ë§‰ ë² íŒ… ì°¾ê¸° (ê° ìŠ¤íŠ¸ë¦¬íŠ¸ëŠ” ë…ë¦½ì )
      for(let i = actions.length - 1; i >= 0; i--) {
        const action = actions[i];
        if(['Bets', 'Raises', 'All In'].includes(action.action) && action.amount) {
          lastBet = action;
          break;
        }
      }
      
      const p = window.state.playersInHand.find(pp => pp.name === player);
      const playerChips = p ? parseInt(unformatNumber(p.chips), 10) : 0;
      
      if(!lastBet) {
        // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ… ì—†ìŒ â†’ CHECK
        if(street === 'preflop') {
          // í”„ë¦¬í”Œëì—ì„œ ë² íŒ… ì—†ìœ¼ë©´ ë¹…ë¸”ë¼ì¸ë“œ ì½œ
          requiredAmt = unformatNumber(window.state.actionState.bigBlind);
          if(playerChips <= parseInt(requiredAmt, 10)) {
            return { action: 'All In', amount: p.chips, label: `All-in ${formatNumber(p.chips)}` };
          }
          return { action: 'Calls', amount: requiredAmt, label: `Call ${formatNumber(requiredAmt)}` };
        }
        // í”Œë, í„´, ë¦¬ë²„ì—ì„œëŠ” ê° ìŠ¤íŠ¸ë¦¬íŠ¸ê°€ ìƒˆë¡œ ì‹œì‘ë˜ë¯€ë¡œ ì²´í¬ ê°€ëŠ¥
        return { action: 'Checks', amount: null, label: 'Check' };
      } else {
        // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ… ìˆìŒ â†’ CALL
        requiredAmt = lastBet.amount;
        if(playerChips <= parseInt(unformatNumber(requiredAmt), 10)) {
          // ì¹© ë¶€ì¡± â†’ ALL-IN
          return { action: 'All In', amount: p.chips, label: `All-in ${formatNumber(p.chips)}` };
        } else {
          // ì¼ë°˜ CALL
          return { action: 'Calls', amount: requiredAmt, label: `Call ${formatNumber(requiredAmt)}` };
        }
      }
    }
    
    // ====== STREET COMPLETE CHECK ======
    function checkStreetComplete(street) {
      const actions = window.state.actionState[street];
      const activePlayers = window.state.playersInHand.filter(p => 
        window.state.playerStatus[p.name] !== 'folded'
      );
      const bettingPlayers = activePlayers.filter(p =>
        window.state.playerStatus[p.name] !== 'allin'
      );
      
      // 1. í•¸ë“œ ì¢…ë£Œ ì²´í¬
      if(activePlayers.length === 1) {
        showFeedback(`${activePlayers[0].name} ìŠ¹ë¦¬!`);
        return { status: 'HAND_END', winner: activePlayers[0].name };
      }
      
      // 2. ì˜¬ì¸ ì‡¼ë‹¤ìš´ ì²´í¬
      if(bettingPlayers.length <= 1) {
        showFeedback('ì˜¬ì¸ ì‡¼ë‹¤ìš´! ë‚˜ë¨¸ì§€ ì¹´ë“œë¥¼ ì˜¤í”ˆí•˜ì„¸ìš”.');
        return { status: 'SHOWDOWN' };
      }
      
      // 3. ìŠ¤íŠ¸ë¦¬íŠ¸ ì™„ë£Œ ì²´í¬
      if(actions.length === 0) return { status: 'WAITING' };
      
      const lastAction = actions[actions.length - 1];
      if(!['Checks', 'Calls', 'Folds'].includes(lastAction.action)) {
        return { status: 'WAITING' };
      }
      
      // ê° í”Œë ˆì´ì–´ì˜ ì´ ë² íŒ…ì•¡ ê³„ì‚°
      const playerBets = {};
      actions.forEach(a => {
        if(a.amount && a.player) {
          playerBets[a.player] = (playerBets[a.player] || 0) + parseInt(unformatNumber(a.amount), 10);
        }
      });
      
      // ë² íŒ… ê°€ëŠ¥í•œ í”Œë ˆì´ì–´ë“¤ì˜ ë² íŒ…ì•¡ í™•ì¸
      const betAmounts = bettingPlayers.map(p => playerBets[p.name] || 0);
      const maxBet = Math.max(...betAmounts, 0);
      const allEqual = betAmounts.every(amt => amt === maxBet);
      
      if(allEqual) {
        const nextStreet = getNextStreet(street);
        if(nextStreet) {
          showFeedback(`${street} ì™„ë£Œ! ${nextStreet}ë¡œ ì§„í–‰`);
          // ìë™ ì§„í–‰ ì˜µì…˜ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì„œ ì²˜ë¦¬
          return { status: 'STREET_COMPLETE', nextStreet };
        }
      }
      
      return { status: 'WAITING' };
    }
    
    function getNextStreet(current) {
      const streets = ['preflop', 'flop', 'turn', 'river'];
      const idx = streets.indexOf(current);
      return idx >= 0 && idx < 3 ? streets[idx + 1] : null;
    }
    
    // ====== POT ======
    // í”Œë ˆì´ì–´ë³„ ì´ ê¸°ì—¬ì•¡ ê³„ì‚° (í´ë“œí•œ í”Œë ˆì´ì–´ í¬í•¨)
    function calculatePlayerContributions() {
      const contributions = {};
      const playersInHand = window.state.playersInHand || [];
      
      // 1. ëª¨ë“  í”Œë ˆì´ì–´ ì´ˆê¸°í™”
      playersInHand.forEach(player => {
        contributions[player.name] = 0;
      });
      
      // 2. ë¸”ë¼ì¸ë“œì™€ ì•ˆí‹° ë¨¼ì € ì¶”ê°€
      playersInHand.forEach(player => {
        const playerName = player.name;
        
        // ìŠ¤ëª° ë¸”ë¼ì¸ë“œ (ì²« ë²ˆì§¸ í”Œë ˆì´ì–´)
        if (player.role === 'SB' || playersInHand.indexOf(player) === 0) {
          const sbAmount = parseInt(unformatNumber(window.state.actionState.smallBlind) || 0, 10);
          contributions[playerName] += sbAmount;
        }
        
        // ë¹… ë¸”ë¼ì¸ë“œ (ë‘ ë²ˆì§¸ í”Œë ˆì´ì–´)  
        if (player.role === 'BB' || playersInHand.indexOf(player) === 1) {
          const bbAmount = parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
          contributions[playerName] += bbAmount;
        }
        
        // BB ì•ˆí‹° (ëª¨ë“  í”Œë ˆì´ì–´)
        if (window.state.actionState.hasBBAnte) {
          const bbAmount = parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
          contributions[playerName] += bbAmount;
        }
      });
      
      // 3. ê° ìŠ¤íŠ¸ë¦¬íŠ¸ë³„ë¡œ ìµœì¢… ë² íŒ… ê¸ˆì•¡ ê³„ì‚° (ì˜¬ë°”ë¥¸ í¬ì»¤ ë¡œì§)
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        const actions = window.state.actionState[street] || [];
        const streetBets = {}; // ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ê° í”Œë ˆì´ì–´ì˜ ë² íŒ… ê¸ˆì•¡
        
        // í•´ë‹¹ ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ ëª¨ë“  ì•¡ì…˜ì„ ìˆœíšŒí•˜ë©° ìµœì¢… ë² íŒ… ê¸ˆì•¡ ê³„ì‚°
        actions.forEach(action => {
          if(action.amount && action.player && action.action !== 'Pot Correction') {
            const player = action.player;
            const amount = parseInt(unformatNumber(action.amount), 10);
            
            // ì´ í”Œë ˆì´ì–´ì˜ ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ ë² íŒ… ê¸ˆì•¡ì„ action.amountë¡œ ì„¤ì •
            // (ì½œ/ë ˆì´ì¦ˆëŠ” ëˆ„ì ì´ ì•„ë‹ˆë¼ ìµœì¢… ë² íŒ… ê¸ˆì•¡)
            streetBets[player] = amount;
          }
        });
        
        // ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ì˜ ìµœì¢… ë² íŒ… ê¸ˆì•¡ì„ ì „ì²´ ê¸°ì—¬ì•¡ì— ì¶”ê°€
        Object.entries(streetBets).forEach(([player, amount]) => {
          const playerData = playersInHand.find(p => p.name === player);
          const maxChips = playerData ? parseInt(unformatNumber(playerData.initialChips) || 0, 10) : Infinity;
          
          // í˜„ì¬ ì´ ê¸°ì—¬ì•¡ + ì´ ìŠ¤íŠ¸ë¦¬íŠ¸ ë² íŒ…ì´ ìµœëŒ€ ì¹©ì„ ì´ˆê³¼í•˜ì§€ ì•Šë„ë¡ ì œí•œ
          const currentContribution = contributions[player] || 0;
          const allowedAmount = Math.min(amount, Math.max(0, maxChips - currentContribution));
          
          contributions[player] = currentContribution + allowedAmount;
          
          if (allowedAmount < amount) {
            console.log(`âš ï¸ ${player} (${street}): ${amount} ìš”ì²­ â†’ ${allowedAmount} ì œí•œ (ìµœëŒ€: ${maxChips}, í˜„ì¬: ${currentContribution})`);
          }
        });
      });
      
      console.log('ğŸ“Š í”Œë ˆì´ì–´ë³„ ê¸°ì—¬ì•¡ (ì˜¬ì¸ ì œí•œ ì ìš©):', contributions);
      return contributions;
    }
    
    // ì‹¤ì œ íŒŸ ê³„ì‚° (ì˜¬ì¸ ì œí•œê³¼ ì‚¬ì´ë“œíŒŸì„ ê³ ë ¤í•œ ì •í™•í•œ ê³„ì‚°)
    function calculateActualPot() {
      console.log(`%cğŸ² === ìƒˆë¡œìš´ íŒŸ ê³„ì‚° ì‹œì‘ [${APP_VERSION}] ===`, 'color: #10b981; font-weight: bold');
      
      // Pot Correctionì´ ìˆìœ¼ë©´ ê¸°ì¡´ ë¡œì§ ì‚¬ìš©
      let potCorrectionFound = false;
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        const actions = window.state.actionState[street] || [];
        if(actions.find(a => a.action === 'Pot Correction')) {
          potCorrectionFound = true;
        }
      });
      
      if(potCorrectionFound) {
        return calculatePotWithCorrection();
      }
      
      // ìƒˆë¡œìš´ ì •í™•í•œ íŒŸ ê³„ì‚°
      const result = calculateAccuratePot();
      console.log(`%cğŸ² === íŒŸ ê³„ì‚° ì¢…ë£Œ [${APP_VERSION}] ===`, 'color: #10b981; font-weight: bold');
      return result.totalPot;
    }
    
    // ì •í™•í•œ íŒŸ ê³„ì‚° (ì˜¬ì¸ ì œí•œ ê³ ë ¤)
    function calculateAccuratePot() {
      const playersInHand = window.state.playersInHand || [];
      if (playersInHand.length === 0) {
        return { totalPot: 0, mainPot: 0, sidePots: [] };
      }
      
      // 1. ê° í”Œë ˆì´ì–´ì˜ ì´ ë² íŒ… ê°€ëŠ¥ ê¸ˆì•¡ ê³„ì‚° (ì´ˆê¸° ì¹©)
      const playerMaxBets = {};
      playersInHand.forEach(player => {
        playerMaxBets[player.name] = parseInt(unformatNumber(player.initialChips) || 0, 10);
      });
      
      console.log('ğŸ’° í”Œë ˆì´ì–´ë³„ ìµœëŒ€ ë² íŒ… ê°€ëŠ¥:', playerMaxBets);
      
      // 2. ì‹¤ì œ ë² íŒ… ê¸ˆì•¡ ê³„ì‚° (ë¸”ë¼ì¸ë“œ + ì•ˆí‹° + ì•¡ì…˜)
      const playerBets = calculatePlayerContributions();
      console.log('ğŸ“Š í”Œë ˆì´ì–´ë³„ ì‹¤ì œ ë² íŒ…:', playerBets);
      
      // 3. ì˜¬ì¸ í”Œë ˆì´ì–´ë“¤ì˜ ê¸ˆì•¡ëŒ€ë³„ë¡œ íŒŸ ë¶„ë¦¬
      const allInAmounts = [];
      playersInHand.forEach(player => {
        const playerName = player.name;
        const maxBet = playerMaxBets[playerName];
        const actualBet = Math.min(playerBets[playerName] || 0, maxBet);
        
        if (actualBet > 0 && !allInAmounts.includes(actualBet)) {
          allInAmounts.push(actualBet);
        }
      });
      
      allInAmounts.sort((a, b) => a - b);
      console.log('ğŸ¯ ì˜¬ì¸ ê¸ˆì•¡ëŒ€:', allInAmounts);
      
      // 4. ê°€ì¥ ì‘ì€ ì˜¬ì¸ ê¸ˆì•¡ì´ ë©”ì¸íŒŸ ê¸°ì¤€
      const mainPotCap = Math.min(...allInAmounts);
      let totalPot = 0;
      
      // ë©”ì¸íŒŸ: ëª¨ë“  í”Œë ˆì´ì–´ê°€ mainPotCapë§Œí¼ ê¸°ì—¬
      const eligiblePlayers = playersInHand.filter(p => 
        window.state.playerStatus[p.name] !== 'folded'
      );
      
      const mainPot = mainPotCap * eligiblePlayers.length;
      totalPot = mainPot;
      
      console.log(`ğŸ² ë©”ì¸íŒŸ: ${mainPot} (${eligiblePlayers.length}ëª… Ã— ${mainPotCap})`);
      
      // ì‚¬ì´ë“œíŒŸì€ í˜„ì¬ êµ¬í˜„í•˜ì§€ ì•Šê³  ë©”ì¸íŒŸë§Œ ë°˜í™˜
      // (ëŒ€ë¶€ë¶„ì˜ ê²½ìš° 2ëª…ì´ë¯€ë¡œ ì‚¬ì´ë“œíŒŸì´ ë¶ˆí•„ìš”)
      
      return { 
        totalPot: totalPot,
        mainPot: mainPot,
        sidePots: []
      };
    }
    
    // ê¸°ì¡´ Pot Correction ë¡œì§
    function calculatePotWithCorrection() {
      let totalPot = 0;
      let potCorrectionValue = 0;
      let additionalBets = 0;
      
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        const actions = window.state.actionState[street] || [];
        
        const potCorrectionIdx = actions.findIndex(a => a.action === 'Pot Correction');
        if(potCorrectionIdx !== -1) {
          const potCorrection = actions[potCorrectionIdx];
          potCorrectionValue = parseInt(unformatNumber(potCorrection.amount), 10);
          
          for(let i = potCorrectionIdx + 1; i < actions.length; i++) {
            if(actions[i].amount && actions[i].action !== 'Pot Correction') {
              additionalBets += parseInt(unformatNumber(actions[i].amount), 10);
            }
          }
          return;
        }
        
        actions.forEach(action => {
          if(action.amount && action.action !== 'Pot Correction') {
            totalPot += parseInt(unformatNumber(action.amount), 10);
          }
        });
      });
      
      if(potCorrectionValue > 0) {
        totalPot = potCorrectionValue + additionalBets;
      } else {
        totalPot += parseInt(unformatNumber(window.state.actionState.smallBlind) || 0, 10);
        totalPot += parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
        if(window.state.actionState.hasBBAnte) {
          const bbAmount = parseInt(unformatNumber(window.state.actionState.bigBlind) || 0, 10);
          totalPot += bbAmount * (window.state.playersInHand || []).length;
        }
      }
      
      return totalPot;
    }
    
    // ì–¸ì½œ ë² íŒ… ê³„ì‚°
    function calculateUncalledBet() {
      const contributions = calculatePlayerContributions();
      const activePlayers = window.state.playersInHand.filter(p => 
        window.state.playerStatus[p.name] !== 'folded'
      );
      
      // í™œì„± í”Œë ˆì´ì–´ê°€ 1ëª…ì¼ ë•Œë§Œ ì–¸ì½œ ë² íŒ… ê³„ì‚°
      if(activePlayers.length === 1) {
        const winner = activePlayers[0];
        const winnerContribution = contributions[winner.name] || 0;
        
        // ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì˜ ìµœëŒ€ ê¸°ì—¬ì•¡
        const otherMaxContribution = Math.max(
          ...Object.entries(contributions)
            .filter(([player]) => player !== winner.name)
            .map(([_, amount]) => amount),
          0
        );
        
        // ì–¸ì½œ ë² íŒ… = ìŠ¹ì ê¸°ì—¬ì•¡ - íƒ€ í”Œë ˆì´ì–´ ìµœëŒ€ ê¸°ì—¬ì•¡
        const uncalledAmount = Math.max(0, winnerContribution - otherMaxContribution);
        
        return {
          amount: uncalledAmount,
          player: winner.name
        };
      }
      
      return { amount: 0, player: null };
    }
    
    // ê¸°ì¡´ calculatePotSize í•¨ìˆ˜ëŠ” UI í‘œì‹œìš©ìœ¼ë¡œ ìœ ì§€
    function calculatePotSize(){
      let pot=0;
      let potCorrectionFound = false;
      let potCorrectionValue = 0;
      
      // ëª¨ë“  ìŠ¤íŠ¸ë¦¬íŠ¸ ìˆœíšŒ
      ['preflop','flop','turn','river'].forEach(st=> {
        const actions = window.state.actionState[st];
        
        // Pot Correction ì°¾ê¸°
        const correctionIdx = actions.findIndex(a => a.action === 'Pot Correction');
        if(correctionIdx !== -1) {
          potCorrectionFound = true;
          potCorrectionValue = parseInt(unformatNumber(actions[correctionIdx].amount), 10);
          
          // Pot Correction ì´í›„ì˜ ì•¡ì…˜ë“¤ë§Œ ì¶”ê°€
          for(let i = correctionIdx + 1; i < actions.length; i++) {
            if(actions[i].amount && actions[i].action !== 'Pot Correction') {
              pot += parseInt(unformatNumber(actions[i].amount), 10);
            }
          }
        } else if(potCorrectionFound) {
          // Pot Correction ì´í›„ì˜ ìŠ¤íŠ¸ë¦¬íŠ¸
          actions.forEach(a => {
            if(a.amount && a.action !== 'Pot Correction') {
              pot += parseInt(unformatNumber(a.amount), 10);
            }
          });
        } else {
          // Pot Correction ì´ì „ì˜ ì•¡ì…˜ë“¤
          actions.forEach(a => {
            if(a.amount && a.action !== 'Pot Correction') {
              pot += parseInt(unformatNumber(a.amount), 10);
            }
          });
        }
      });
      
      // Pot Correctionì´ ì—†ìœ¼ë©´ ë¸”ë¼ì¸ë“œ/ì•¤í‹° ì¶”ê°€
      if(!potCorrectionFound) {
        pot += parseInt(unformatNumber(window.state.actionState.smallBlind)||0,10);
        pot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
        if(window.state.actionState.hasBBAnte) {
          pot += parseInt(unformatNumber(window.state.actionState.bigBlind)||0,10);
        }
      } else {
        // Pot Correction ê°’ì´ ê¸°ì¤€
        pot = potCorrectionValue + pot;
      }
      
      return pot;
    }

    // ====== CSV LOADERS ======
    async function fetchCsv(url){
      const res=await fetch(url);
      if(!res.ok) {
        console.log(`CSV fetch status: ${res.status}`);
        return []; // ë¹ˆ ë°°ì—´ ë°˜í™˜
      }
      const txt=await res.text();
      return parseCSV(txt);
    }

    function buildTypeFromCsv(rows){
      // v3.5.5 - ìƒˆë¡œìš´ Type ì‹œíŠ¸ êµ¬ì¡°:
      // A:Poker Room, B:Table Name, C:Table No., D:Seat No., E:Players, F:Nationality, G:Chips, H:Keyplayer
      console.log('[v3.5.5] ğŸ” buildTypeFromCsv ì‹œì‘, rows:', rows?.length || 0);
      if(!rows||rows.length<1) {
        console.warn('[v3.5.5] âš ï¸ Type ì‹œíŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤');
        return;
      }

      // CAM ê´€ë ¨ ì´ˆê¸°í™” ì½”ë“œ ì™„ì „ ì œê±° (v3.5.27)
      // console.log(`ğŸ“¹ CAM ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤`); // ì œê±°ë¨

      const byTable={};
      console.log('[v3.5.5] ğŸ“Š ì²« ë²ˆì§¸ í–‰ (í—¤ë”):', rows[0]);

      // êµ¬ì¡° íŒë³„: CAM ê´€ë ¨ ê²€ì‚¬ ì œê±° (v3.5.27)
      // const isOldFormat = rows[0] && String(rows[0][0]).includes('Camera'); // ì œê±°ë¨
      const isOldFormat = false; // CAM êµ¬ì¡° ë¹„í™œì„±í™”

      if(isOldFormat) {
        console.log('[v3.5.5] ğŸ”„ ê¸°ì¡´ Type ì‹œíŠ¸ êµ¬ì¡° ê°ì§€ - í´ë°± ëª¨ë“œ ì‚¬ìš©');

        // ê¸°ì¡´ êµ¬ì¡°ë¡œ íŒŒì‹±
        // ê¸°ì¡´ êµ¬ì¡° (CAM ê´€ë ¨ ì œê±°ë¨): A:Camera Preset, B:Player, C:Table, D:Notable, E:Chips, F:updatedAt, G:Seat, H:Status
        for(let i=1;i<rows.length;i++){
          const r=rows[i]||[];
          const player = String(r[1]||'').trim();
          const tableNo = String(r[2]||'').trim();
          const notable = String(r[3]||'').toUpperCase()==='TRUE';
          const chips = String(r[4]!=null?r[4]:'0').trim();
          const seatNo = String(r[6]||'').trim();
          const status = String(r[7]||'IN').trim().toUpperCase();

          if(player && tableNo && status === 'IN'){
            if(!byTable[tableNo]) byTable[tableNo]=[];
            byTable[tableNo].push({
              name: player,
              chips,
              keyplayer: notable,
              seatNo: seatNo,
              nationality: '',
              pokerRoom: '',
              tableName: '',
              tableNo: tableNo
            });
            console.log(`[v3.5.5] ê¸°ì¡´ í˜•ì‹: ${player} ì¶”ê°€ë¨ (Table ${tableNo}, #${seatNo})`);
          }
        }
      } else {
        // ìƒˆë¡œìš´ êµ¬ì¡°ë¡œ íŒŒì‹±
        for(let i=1;i<rows.length;i++){
          const r=rows[i]||[];
          // console.log(`[v3.5.5] í–‰ ${i} ì›ë³¸ ë°ì´í„°:`, r);  // ì„±ëŠ¥ì„ ìœ„í•´ ë¹„í™œì„±í™”

          const pokerRoom = String(r[0]||'').trim(); // Aì—´: Poker Room
          const tableName = String(r[1]||'').trim(); // Bì—´: Table Name
          const tableNo = String(r[2]||'').trim();   // Cì—´: Table No.
          const seatNo = String(r[3]||'').trim();    // Dì—´: Seat No.
          const player = String(r[4]||'').trim();    // Eì—´: Players
          const nationality = String(r[5]||'').trim(); // Fì—´: Nationality
          const chips = String(r[6]!=null?r[6]:'0').trim(); // Gì—´: Chips
          const keyplayer = String(r[7]||'').toUpperCase()==='TRUE'; // Hì—´: Keyplayer

          // console.log(`[v3.5.5] íŒŒì‹± ê²°ê³¼: Player="${player}", Table="${tableNo}", Seat="${seatNo}", Room="${pokerRoom}"`);  // ì„±ëŠ¥ ìµœì í™”

          // í”Œë ˆì´ì–´ì™€ í…Œì´ë¸” ë²ˆí˜¸ê°€ ìˆìœ¼ë©´ ì²˜ë¦¬
          if(player && tableNo){
            if(!byTable[tableNo]) byTable[tableNo]=[];

            byTable[tableNo].push({
              name: player,
              chips,
              keyplayer,       // notable -> keyplayer
              nationality,     // ìƒˆ í•„ë“œ
              seatNo,         // seat -> seatNo
              pokerRoom,      // ìƒˆ í•„ë“œ
              tableName,      // ìƒˆ í•„ë“œ
              tableNo         // ìƒˆ í•„ë“œ
            });
            console.log(`[v3.5.5] âœ… ${player} ì¶”ê°€ë¨ (Table ${tableNo}, #${seatNo}, ${nationality})`);
          } else {
            console.log(`[v3.5.5] âŒ ${player} ì œì™¸ë¨ - í•„ìˆ˜ ì •ë³´ ëˆ„ë½`);
          }
        }
      }

      // ì²˜ë¦¬ ê²°ê³¼ ìš”ì•½ ë¡œê·¸
      console.log(`ğŸ‰ [v3.5.10] === buildTypeFromCsv ì™„ë£Œ ===`);
      console.log(`ğŸ“Š [v3.5.10] ì´ í…Œì´ë¸” ìˆ˜: ${Object.keys(byTable).length}`);
      Object.keys(byTable).forEach(tableNo => {
        console.log(`ğŸ“ [v3.5.10] Table ${tableNo}: ${byTable[tableNo].length}ëª…`);
        // ê° í…Œì´ë¸”ì˜ ì²« ë²ˆì§¸ í”Œë ˆì´ì–´ ì •ë³´ ì¶œë ¥
        if(byTable[tableNo].length > 0) {
          const firstPlayer = byTable[tableNo][0];
          console.log(`   ğŸ“ ì²« ë²ˆì§¸ í”Œë ˆì´ì–´: ${firstPlayer.name}, ì¢Œì„: ${firstPlayer.seatNo} (íƒ€ì…: ${typeof firstPlayer.seatNo})`);
        }
      });

      window.state.playerDataByTable=byTable;
      window.state.allTables=Object.keys(byTable).sort();

      console.log(`ğŸ’¾ [v3.5.10] ìƒíƒœ ì €ì¥ ì™„ë£Œ:`, {
        playerDataByTable: Object.keys(window.state.playerDataByTable),
        allTables: window.state.allTables
      });

      // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
      console.log('[v3.5.5] ğŸ“‹ playerDataByTable:', window.state.playerDataByTable);
      console.log('[v3.5.5] ğŸ¯ allTables:', window.state.allTables);
    }

    function buildIndexFromCsv(rows){
      // Index CSV columns:
      // A handNumber | B startRow | C endRow | D handUpdatedAt | E handEdit | F handEditTime | G label | H table | I tableUpdatedAt | [CAM í•„ë“œ J-N ì œê±°ë¨]
      // O lastStreet | P lastAction | Q workStatus (ìƒˆë¡œìš´ ì—´ë“¤)
      const out=[]; for(let i=1;i<rows.length;i++){
        const r=rows[i]||[];
        const item={
          handNumber:String(r[0]||''), startRow:+(r[1]||0), endRow:+(r[2]||0),
          handUpdatedAt:String(r[3]||''), handEdit:r[4], handEditTime:r[5], label:r[6],
          table:String(r[7]||''), tableUpdatedAt:r[8],
          // CAM ê´€ë ¨ í•„ë“œ ì™„ì „ ì œê±° (v3.5.27)
          // cam:r[9], cam1:r[10], cam1no:r[11], cam2:r[12], cam2no:r[13], // ì œê±°ë¨
          lastStreet:String(r[14]||''), lastAction:String(r[15]||''), workStatus:String(r[16]||'')  // ìƒˆë¡œìš´ ì—´ë“¤
        };
        if(item.handNumber) out.push(item);
      }
      window.state.indexRows=out;
      // ìµœì‹  ìš°ì„  ì •ë ¬
      out.sort((a,b)=> a.handUpdatedAt<b.handUpdatedAt?1:-1);
      window.state.allHandNumbers = [...new Set(out.map(x=>x.handNumber))];
    }

    // íŒŒì‹±: Hand CSV â†’ íŠ¹ì • handNumberì˜ "ê°€ì¥ ìµœê·¼ updatedAt" ë¸”ë¡
    function parseHandBlock(rows, handNumber, preferDate){
      // HAND ì‹œì‘ ìœ„ì¹˜ ìˆ˜ì§‘
      const starts=[];
      for(let r=0;r<rows.length;r++){
        const row=rows[r]||[];
        if(row[1]==='HAND'){
          const no=String(row[2]||'');
          if(no===String(handNumber)){
            starts.push({r});
          }
        }
      }
      if(!starts.length) return null;
    
      // Indexì—ì„œ ìµœì‹  updatedAt ê¸°ì¤€ ë¸”ë¡ ë²”ìœ„ ì°¾ê¸°
      let updatedAt=preferDate||null;
      if(!updatedAt){
        const candidates=window.state.indexRows.filter(x=>x.handNumber===String(handNumber));
        candidates.sort((a,b)=> a.handUpdatedAt<b.handUpdatedAt?1:-1);
        updatedAt=candidates[0]?.handUpdatedAt||null;
      }
      let startRowIdx=-1, endRowIdx=-1;
      const idxRow=window.state.indexRows.find(x=>x.handNumber===String(handNumber) && x.handUpdatedAt===updatedAt);
      if(idxRow){ startRowIdx=idxRow.startRow-1; endRowIdx=idxRow.endRow-1; }
      else{
        const last=starts[starts.length-1].r;
        startRowIdx=last;
        let r=last+1; while(r<rows.length && rows[r][1]!=='HAND') r++;
        endRowIdx=r-1;
      }
      if(startRowIdx<0 || endRowIdx<startRowIdx) return null;
    
      const block=rows.slice(startRowIdx,endRowIdx+1);
    
      // íŒŒì‹±
      let handInfo=null, players=[], board=[], smallBlind='', bigBlind='', ante=0, table='';
      // ìŠ¤íŠ¸ë¦¬íŠ¸ ë¶„í• : ë¸”ë¡ì„ **ìˆœì„œëŒ€ë¡œ** ëŒë©´ì„œ BOARDë¥¼ ë§Œë‚  ë•Œë§ˆë‹¤ ì „í™˜í•œë‹¤
      const streets={preflop:[],flop:[],turn:[],river:[]};
      let street='preflop';
      let seenBoard=0;
    
      for(const row of block){
        if(row[1]==='HAND'){
          handInfo=row;
          ante=parseInt(row[6]||0,10)||0;
          smallBlind=row[8]||'';
          bigBlind=row[9]||'';
          table=row[17]||'';
        }else if(row[1]==='PLAYER'){
          const name=row[2];
          const seat=row[3];
          // PLAYER íŒŒì‹±: row[4]ëŠ” 0, row[5]ëŠ” ì‹œì‘ì¹©, row[6]ì€ ì¢…ë£Œì¹©, row[7]ì€ í•¸ë“œ
          const init=row[5], final=row[6];
          const cards=(row[7]||'').trim()? String(row[7]).trim().split(' ') : [];
          players.push({name, seat, initialChips:init, finalChips:final, hand:cards});
        }else if(row[1]==='EVENT'){
          const etype=String(row[2]||'').toUpperCase();
          if(etype==='BOARD'){
            // ë³´ë“œ ì „í™˜ ì§€ì 
            const card=row[4];
            if(card) board.push(card);
            seenBoard++;
            if(seenBoard===3) street='flop';
            else if(seenBoard===4) street='turn';
            else if(seenBoard===5) street='river';
          }else{
            // ì¢Œì„ â†’ ì´ë¦„
            const seat=row[3];
            const amount=row[4];
            const time=row[5];
            const p=players.find(pp=>parseSeatNo(pp.seatNo || pp.seat)===parseSeatNo(seat));
            const name=p?p.name:'';
            streets[street].push({
              player:name,
              action:etype,
              amount:amount||null,
              timestamp:time||null
            });
          }
        }
      }

  // ìŠ¹ì íŒë‹¨ ë¡œì§ ê°œì„ : ê°€ì¥ ë§ì€ ì¹© ì¦ê°€ëŸ‰ì„ ê°€ì§„ í”Œë ˆì´ì–´ í•œ ëª…ë§Œ ìŠ¹ìë¡œ ì§€ì •
  let winnerName = null;
  let maxGain = 0;
  
  players.forEach(p => {
    const initial = parseInt(p.initialChips || 0, 10);
    const final = parseInt(p.finalChips || 0, 10);
    const gain = final - initial;
    
    if(gain > maxGain) {
      maxGain = gain;
      winnerName = p.name;
    }
  });

  return {
    handInfo,
    table,
    ante,
    smallBlind,
    bigBlind,
    hasBBAnte: ante>0,
    board,
    actions: streets,
    players: players.map(p=>({
      name:p.name,
      initialChips:p.initialChips,
      finalChips:p.finalChips,
      hand:p.hand,
      role: (p.name === winnerName && maxGain > 0) ? 'winner' : null
    }))
  };
}



    // ====== LOADERS (initial) ======
    async function loadInitial(){
      openLogModal(); el.logDisplay.innerHTML='';
      logMessage(`ğŸš€ ${APP_VERSION} ì´ˆê¸° ë°ì´í„° ë¡œë”© ì‹œì‘ (Type/Index) ...`);
      try{
        const [typeRows, idxRows] = await Promise.all([
          CSV_TYPE_URL.includes('http')? fetchCsv(CSV_TYPE_URL) : Promise.resolve([]),
          CSV_INDEX_URL.includes('http')? fetchCsv(CSV_INDEX_URL) : Promise.resolve([])
        ]);
        if(typeRows.length) buildTypeFromCsv(typeRows);
        if(idxRows.length) buildIndexFromCsv(idxRows);
        window.state.actionState.handNumber = (window.state.allHandNumbers.length>0? Math.max(...window.state.allHandNumbers.map(n=>parseInt(n,10)||0)) + 1 : 1).toString();
        el.handNumberDisplay.textContent = `#${window.state.actionState.handNumber}`;
        el.dataStamp.textContent = `IDX rows: ${window.state.indexRows.length}`;
        
        // Indexì—ì„œ ë§ˆì§€ë§‰ ì¹´ë©”ë¼ ë²ˆí˜¸ ì°¾ê¸° ë° localStorage ë™ê¸°í™”
        logMessage('ğŸ“· ì¹´ë©”ë¼ ë²ˆí˜¸ ë°ì´í„° ë¶„ì„ ì‹œì‘...');
        
        if(window.state.indexRows.length > 0) {
          logMessage(`ğŸ“Š ì´ ${window.state.indexRows.length}ê°œì˜ í•¸ë“œ ë°ì´í„° ê²€ìƒ‰ ì¤‘...`);
          
          // ê°€ì¥ ìµœê·¼ í•¸ë“œ ì°¾ê¸° (í•¸ë“œ ë²ˆí˜¸ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
          const sortedRows = window.state.indexRows.slice().sort((a,b) => {
            const numA = parseInt(a.handNumber, 10) || 0;
            const numB = parseInt(b.handNumber, 10) || 0;
            return numB - numA;
          });
          
          // ì¹´ë©”ë¼ ë²ˆí˜¸ ì²˜ë¦¬ ë¡œì§ ì œê±° (v3.5.27)
          /* ì œê±°ëœ ì½”ë“œ:
          - ì¹´ë©”ë¼ ë²ˆí˜¸ ì¶”ì¶œ ë¡œì§
          - localStorageì— ì¹´ë©”ë¼ ë²ˆí˜¸ ì €ì¥
          - cam1, cam2 ë²ˆí˜¸ ì²˜ë¦¬
          - window.state.camPreset ì°¸ì¡°
          */
        } else {
          // logMessage('âš ï¸ Index ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ â†’ ì¹´ë©”ë¼ ë²ˆí˜¸ 0001ë¶€í„° ì‹œì‘'); // CAM ì œê±°ë¨ (v3.5.27)
        }
        
        renderAll();
        logMessage(`âœ… ${APP_VERSION} ì´ˆê¸° ë°ì´í„° ë¡œë”© ì™„ë£Œ`);
      }catch(err){
        console.error(err); logMessage(`ì´ˆê¸° ë¡œë”© ì‹¤íŒ¨: ${err.message}`, true);
      }finally{
        setTimeout(closeLogModal, 800);
      }
    }

    // ====== LOAD HAND MODAL ======
    function openLoadHandModal(){
      console.log('ğŸ“‚ Load Hand ëª¨ë‹¬ ì—´ê¸° ì‹œë„...');
      console.log('ğŸ“‹ Index í–‰ ê°œìˆ˜:', window.state.indexRows.length);
      
      if(!window.state.indexRows.length){
        console.error('âŒ Index ë°ì´í„° ì—†ìŒ');
        showFeedback('Index ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. CSV ê²Œì‹œì™€ URLì„ í™•ì¸í•˜ì„¸ìš”.', true);
        return;
      }
      
      // í•¸ë“œ ë²ˆí˜¸ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìµœì‹  í•¸ë“œê°€ ìœ„ë¡œ)
      const items = window.state.indexRows.slice().sort((a,b)=> {
        const numA = parseInt(a.handNumber, 10) || 0;
        const numB = parseInt(b.handNumber, 10) || 0;
        return numB - numA; // ë‚´ë¦¼ì°¨ìˆœ
      });
      
      const htmlItems = items.map(it=>{
        // ìƒíƒœ ì•„ì´ì½˜ ê²°ì •
        const statusIcon = {
          'ì™„ë£Œ': 'âœ…',
          'ì§„í–‰ì¤‘': 'ğŸ”„',
          'ê²€í† í•„ìš”': 'âš ï¸'
        }[it.workStatus] || 'ğŸ“';
        
        // ìŠ¤íŠ¸ë¦¬íŠ¸ ë°°ì§€ ìƒ‰ìƒê³¼ ìŠ¤íƒ€ì¼
        const streetColors = {
          'preflop': 'bg-green-500 text-white',
          'flop': 'bg-blue-500 text-white',
          'turn': 'bg-orange-500 text-white',
          'river': 'bg-red-500 text-white'
        };
        const streetBadge = it.lastStreet ? 
          `<span class="${streetColors[it.lastStreet] || 'bg-gray-500 text-white'} px-2 py-0.5 rounded text-xs font-bold">${it.lastStreet?.toUpperCase() || ''}</span>` : '';
        
        // ë²„íŠ¼ ë°°ê²½ìƒ‰ (ìƒíƒœë³„)
        const btnBgClass = it.workStatus === 'ì™„ë£Œ' ? 'bg-gray-800' : 
                          it.workStatus === 'ê²€í† í•„ìš”' ? 'bg-yellow-900/30' : 'bg-gray-700';
        
        return `<button class="btn ${btnBgClass} p-2 rounded-md w-full text-left load-hand-item-btn mb-2 hover:bg-gray-600" 
                data-no="${it.handNumber}" data-date="${it.handUpdatedAt}">
          <div class="flex justify-between items-center mb-1">
            <span class="font-bold text-white flex items-center gap-1">
              ${statusIcon} #${it.handNumber}
            </span>
            ${streetBadge}
            <span class="text-xs text-amber-400 truncate max-w-[100px]">${it.table||''}</span>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-xs text-gray-400">${it.lastAction || 'ì•¡ì…˜ ì—†ìŒ'}</span>
            <span class="text-xs text-gray-500">${it.handUpdatedAt||''}</span>
          </div>
        </button>`;
      }).join('');
      
      const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-md flex flex-col h-2/3">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-amber-400">í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</h2>
          <button id="close-load-hand-modal" class="text-2xl">&times;</button>
        </div>
        <div class="overflow-y-auto space-y-2 flex-grow pr-2">${htmlItems}</div>
      </div>`;
      openModal(el.loadHandModal, html);
      
      // ëª¨ë‹¬ ë°– í´ë¦­ ì‹œ ë‹«ê¸° (ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆì™€ ì¶©ëŒ ë°©ì§€)
      // onclick ëŒ€ì‹  ë³„ë„ì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì‚¬ìš©
    }
    async function ensureHandCsv(){
      if(window.state.handCsvCache) return window.state.handCsvCache;
      logMessage('Hand CSV ë‹¤ìš´ë¡œë“œ ì¤‘...');
      const rows = await fetchCsv(CSV_HAND_URL + `&cb=${Date.now()}`);
      window.state.handCsvCache = rows;
      logMessage(`Hand CSV ë¡œë“œ ì™„ë£Œ (rows=${rows.length})`);
      return rows;
    }

    async function loadHandData(handNumber, preferDate){
      console.log(`ğŸ“¥ í•¸ë“œ #${handNumber} ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘...`);
      try{
        const rows = await ensureHandCsv();
        console.log(`ğŸ“Š Hand CSV ë¡œë“œ ì™„ë£Œ: ${rows.length} í–‰`);
        
        const data = parseHandBlock(rows, handNumber, preferDate);
        console.log('ğŸ“ íŒŒì‹±ëœ ë°ì´í„°:', data);
        
        if(!data){ 
          console.error(`âŒ Hand #${handNumber} ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ`);
          showFeedback(`Hand #${handNumber} ë¸”ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`, true); 
          return; 
        }

        // ìƒíƒœ ì´ˆê¸°í™”
        window.state.playersInHand=[];
        window.state.board = data.board||[];
        window.state.playerStatus = {}; // í”Œë ˆì´ì–´ ìƒíƒœ ì´ˆê¸°í™” ì¶”ê°€
        
        window.state.actionState = {
          ...window.state.actionState,
          handNumber: String(handNumber),
          smallBlind: data.smallBlind || '',
          bigBlind: data.bigBlind || '',
          hasBBAnte: data.ante>0,
          preflop: data.actions?.preflop||[],
          flop: data.actions?.flop||[],
          turn: data.actions?.turn||[],
          river: data.actions?.river||[],
        };
        window.state.selectedTable = data.table || '';
        updateSelectedTableDisplay();

        window.state.playersInHand = (data.players||[]).map(p=>({
          name:p.name, hand:p.hand||[], chips:p.finalChips, initialChips:p.initialChips, role:p.role||null
        }));
        
        // í”Œë ˆì´ì–´ ìƒíƒœ ë³µì› (ì•¡ì…˜ì—ì„œ í´ë“œ/ì˜¬ì¸ í™•ì¸)
        ['preflop', 'flop', 'turn', 'river'].forEach(street => {
          (data.actions?.[street] || []).forEach(action => {
            if(action.player && action.action === 'Folds') {
              window.state.playerStatus[action.player] = 'folded';
            } else if(action.player && action.action === 'All In') {
              window.state.playerStatus[action.player] = 'allin';
            }
          });
        });

        el.handNumberDisplay.textContent = `#${handNumber}`;
        el.smallBlindInput.value = formatNumber(window.state.actionState.smallBlind);
        el.bigBlindInput.value = formatNumber(window.state.actionState.bigBlind);
        el.bbAnteCheckbox.checked = window.state.actionState.hasBBAnte;

        // currentStreet ê²°ì •: Indexì—ì„œ ì €ì¥ëœ ê°’ ìš°ì„ , ì—†ìœ¼ë©´ ì•¡ì…˜ìœ¼ë¡œ íŒë‹¨
        const indexRow = window.state.indexRows.find(r => r.handNumber === String(handNumber));
        console.log(`ğŸ” í•¸ë“œ #${handNumber} ë¡œë“œ ì¤‘...`);
        console.log('ğŸ“‹ Index í–‰ ë°ì´í„°:', indexRow);
        
        if(indexRow) {
          // ì¹´ë©”ë¼ ì •ë³´ ë¡œë“œ ì½”ë“œ ì œê±°ë¨ (v3.5.27)
          /* 50ì¤„ ì´ìƒì˜ ì¹´ë©”ë¼ ê´€ë ¨ ì½”ë“œ ì œê±°:
          - indexRow.cam1, cam1no ì²˜ë¦¬ ë¡œì§
          - indexRow.cam2, cam2no ì²˜ë¦¬ ë¡œì§
          - window.state.camPreset, camNumbers ì—…ë°ì´íŠ¸
          - el.cam1, el.cam2 í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
          - ì¹´ë©”ë¼ ìƒíƒœ ë¡œê¹…
          */

          if(indexRow.lastStreet) {
            window.state.currentStreet = indexRow.lastStreet;
          }
          
          // ì‘ì—… ìƒíƒœ í‘œì‹œ
          if(indexRow.workStatus) {
            const statusText = {
              'ì™„ë£Œ': 'âœ… ì™„ë£Œëœ í•¸ë“œ',
              'ì§„í–‰ì¤‘': 'ğŸ”„ ì‘ì—… ì§„í–‰ ì¤‘',
              'ê²€í† í•„ìš”': 'âš ï¸ ê²€í†  í•„ìš”'
            }[indexRow.workStatus] || indexRow.workStatus;
            showFeedback(`#${handNumber} ${statusText}`);
          }
        } else {
          // ê¸°ì¡´ ë¡œì§: ì•¡ì…˜ìœ¼ë¡œ íŒë‹¨
          if(window.state.actionState.river.length > 0) {
            window.state.currentStreet = 'river';
          } else if(window.state.actionState.turn.length > 0) {
            window.state.currentStreet = 'turn';
          } else if(window.state.actionState.flop.length > 0) {
            window.state.currentStreet = 'flop';
          } else {
            window.state.currentStreet = 'preflop';
          }
        }

        renderAll(); saveActionState();
        
        
        closeModal(el.loadHandModal);
        showFeedback(`#${handNumber} í•¸ë“œë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`);
      }catch(err){
        console.error('í•¸ë“œ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', err);
        console.error('ì˜¤ë¥˜ ìŠ¤íƒ:', err.stack);
        showFeedback(`ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ${err.message}`, true);
      }
    }

    // ====== GENERATE & SEND ======
    function formatISODateInTZ(date, tz){
      // yyyy-MM-dd
      const y = new Intl.DateTimeFormat('en-CA', { timeZone: tz, year:'numeric' }).format(date);
      const m = new Intl.DateTimeFormat('en-CA', { timeZone: tz, month:'2-digit' }).format(date);
      const d = new Intl.DateTimeFormat('en-CA', { timeZone: tz, day:'2-digit' }).format(date);
      return `${y}-${m}-${d}`;
    }

    function generateRows_v46(){
      const out=[]; let no=1;
      const push=(arr)=>{ const a=[no, ...arr]; while(a.length<18) a.push(''); out.push(a); no++; };

      const epochSec = Math.floor(Date.now()/1000);
      const sb = unformatNumber(window.state.actionState.smallBlind)||'0';
      const bb = unformatNumber(window.state.actionState.bigBlind)||'0';
      const ante = window.state.actionState.hasBBAnte ? bb : '0';
      const table = window.state.selectedTable || '';
      const currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹

      // GAME / PAYOUTS - Eì—´(ì¸ë±ìŠ¤ 4)ì— ë‚ ì§œ ì¶”ê°€
      const gameRow = ['GAME','GGProd Hand Logger','Virtual Table', currentDate];
      push(gameRow);
      push(['PAYOUTS']);

      // HAND: C no, D code, G ante, I SB, J BB, R table
      const handDate = formatISODateInTZ(new Date(), window.state.selectedTimezone); // yyyy-MM-dd
      
      // HAND: C no, D code, G ante, I SB, J BB, R table
      push(['HAND',
        String(window.state.actionState.handNumber),
        epochSec,
        'HOLDEM',
        window.state.actionState.hasBBAnte ? 'BB_ANTE':'NO_ANTE',
        ante,
        handDate, // â˜… ì—¬ê¸°(H) ì¹¸ì— ë‚ ì§œë¥¼ ë„£ë„ë¡ ì•½ì† (Apps Scriptë„ ì´ ì¹¸ì€ ë‚ ì§œë¡œ ì“°ê²Œ)
        sb,       // I
        bb,       // J
        0,1,2,3,0,0,1,
        table     // R
      ]);

      // PLAYERS
      const players = window.state.playersInHand.map((p,i)=>({
        ...p, 
        seat: p.seatNo || (i+1)  // Typeì—ì„œ ê°€ì ¸ì˜¨ seatNo ì •ë³´ê°€ ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ì¸ë±ìŠ¤+1
      }));
      
      console.log(`%c=== PLAYER í–‰ ìƒì„± [${APP_VERSION}] ===`, 'color: #3b82f6; font-weight: bold');
      console.log(`í˜„ì¬ í–‰ë²ˆí˜¸(no): ${no}`);
      console.log(`í”Œë ˆì´ì–´ ìˆ˜: ${players.length}`);
      console.log('%cí˜•ì‹: A=í–‰ë²ˆí˜¸, B=PLAYER, C=ì´ë¦„, D=ì¢Œì„, E=0(ê³ ì •), F=ì‹œì‘ì¹©, G=ì¢…ë£Œì¹©, H=í•¸ë“œ, I=í¬ì§€ì…˜', 'color: #9ca3af');
      
      players.forEach(p=>{
        console.log(`\n--- ${p.name} ì²˜ë¦¬ ì‹œì‘ ---`);
        console.log(`  ì›ë³¸ ë°ì´í„°:`, p);
        
        // ì¹© ê°’ í™•ì¸ - initialChipsê°€ ì—†ìœ¼ë©´ chips ê°’ì„ ì‚¬ìš©
        let initialChips;
        let finalChips = parseInt(unformatNumber(p.chips)||0,10);
        
        // initialChipsê°€ undefinedì´ê±°ë‚˜ ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš° ì²˜ë¦¬
        if(p.initialChips === undefined || p.initialChips === '' || p.initialChips === null) {
          console.warn(`  âš ï¸ initialChipsê°€ ì—†ìŒ. chips ê°’ ì‚¬ìš©: ${p.chips}`);
          initialChips = finalChips; // ì‹œì‘ì¹©ì´ ì—†ìœ¼ë©´ í˜„ì¬ ì¹©ì„ ì‹œì‘ì¹©ìœ¼ë¡œ ì‚¬ìš©
        } else {
          const unformattedInitial = unformatNumber(p.initialChips);
          console.log(`  unformatNumber(p.initialChips) = "${unformattedInitial}"`);
          initialChips = parseInt(unformattedInitial || '0', 10);
          if(isNaN(initialChips)) {
            console.error(`  âŒ parseIntê°€ NaN ë°˜í™˜! ì›ë³¸: "${p.initialChips}"`);
            initialChips = 0;
          }
        }
        
        // ë””ë²„ê¹…: ì‹¤ì œ ê°’ í™•ì¸
        console.log(`  ì´ˆê¸°ì¹©(raw): "${p.initialChips}" â†’ ${initialChips}`);
        console.log(`  ìµœì¢…ì¹©(raw): "${p.chips}" â†’ ${finalChips}`);
        console.log(`  í•¸ë“œ: ${p.hand?.join(' ') || '(ì—†ìŒ)'}`);
        
        // ë°°ì—´ ìƒì„± ì „ ê°’ íƒ€ì… í™•ì¸
        console.log(`  initialChips íƒ€ì…: ${typeof initialChips}, ê°’: ${initialChips}`);
        console.log(`  finalChips íƒ€ì…: ${typeof finalChips}, ê°’: ${finalChips}`);
        
        // í¬ì§€ì…˜ ì •ë³´ ê³„ì‚° (BTN/SB/BB)
        const positions = getPositionsForSeat(parseInt(p.seat) || 1);
        const positionStr = positions.length > 0 ? positions.join(',') : '';
        
        // Type ì‹œíŠ¸ì—ì„œ ê°€ì ¸ì˜¨ í”Œë ˆì´ì–´ ì •ë³´ ì¶”ê°€
        const playerFromType = window.state.playerDataByTable?.[window.state.selectedTable]?.find(tp => tp.name === p.name);
        const keyplayerInfo = playerFromType ? (playerFromType.keyplayer || playerFromType.notable || '') : '';
        const countryInfo = playerFromType ? (playerFromType.nationality || '') : '';

        // PLAYER í˜•ì‹: B=PLAYER, C=name, D=seat, E=0, F=ì‹œì‘ì¹©, G=ì¢…ë£Œì¹©, H=í•¸ë“œ, I=í¬ì§€ì…˜, J=keyplayer, K=êµ­ê°€
        // push í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ í–‰ë²ˆí˜¸ë¥¼ Aì—´ì— ì¶”ê°€í•˜ë¯€ë¡œ 10ê°œ ìš”ì†Œ í•„ìš”
        const playerRow = ['PLAYER', p.name, parseInt(p.seat) || 1, 0, initialChips, finalChips, p.hand?.length? p.hand.join(' ') : '', positionStr, keyplayerInfo, countryInfo];
        
        console.log(`  ===== PLAYER í–‰ ìƒì„± =====`);
        console.log(`  playerRow ë°°ì—´:`, playerRow);
        console.log(`  playerRow.length: ${playerRow.length}`);
        
        // ê° ìš”ì†Œ ê²€ì¦
        console.log(`  [0] = '${playerRow[0]}' (PLAYER ë¬¸ìì—´)`);
        console.log(`  [1] = '${playerRow[1]}' (ì´ë¦„: ${p.name})`);
        console.log(`  [2] = ${playerRow[2]} (#${p.seat})`);
        console.log(`  [3] = ${playerRow[3]} (0 ê³ ì •ê°’)`);
        console.log(`  [4] = ${playerRow[4]} (ì‹œì‘ì¹©: ${initialChips})`);
        console.log(`  [5] = ${playerRow[5]} (ì¢…ë£Œì¹©: ${finalChips})`);
        console.log(`  [6] = '${playerRow[6]}' (í•¸ë“œ)`);
        console.log(`  [7] = '${playerRow[7]}' (í¬ì§€ì…˜: ${positionStr})`);
        
        // push ì „ í˜„ì¬ í–‰ë²ˆí˜¸
        const currentNo = no;
        console.log(`  push ì „ í–‰ë²ˆí˜¸: ${currentNo}`);
        
        push(playerRow);
        
        // push í›„ ì‹¤ì œ ì €ì¥ëœ ë°ì´í„° í™•ì¸
        const pushedRow = out[out.length - 1];
        console.log(`  push í›„ ì €ì¥ëœ í–‰:`, pushedRow);
        console.log(`  ìµœì¢… CSV í˜•ì‹:`);
        console.log(`    A=${pushedRow[0]} (í–‰ë²ˆí˜¸), B=${pushedRow[1]} (PLAYER), C=${pushedRow[2]} (ì´ë¦„), D=${pushedRow[3]} (#ì¢Œì„),`);
        console.log(`    E=${pushedRow[4]} (0 ê³ ì •ê°’), F=${pushedRow[5]} (ì‹œì‘ì¹©), G=${pushedRow[6]} (ì¢…ë£Œì¹©), H=${pushedRow[7]} (í•¸ë“œ), I=${pushedRow[8]} (í¬ì§€ì…˜),`);
        console.log(`    J=${pushedRow[9]} (í‚¤í”Œë ˆì´ì–´), K=${pushedRow[10]} (êµ­ê°€)`);
        console.log(`--- ${p.name} ì²˜ë¦¬ ì™„ë£Œ ---\n`);
      });

      // EVENTS
      const addEv=(log)=>{
        const p=players.find(x=>x.name===log.player);
        const seat=p?p.seatNo:'';
        const amt=log.amount? unformatNumber(log.amount):'';
        let t=(log.action||'').toUpperCase().replace(/S$/,'');
        if(t==='BET/RAISES') t='RAISE TO';
        push(['EVENT', t, seat, amt, '' ]);
      };
      window.state.actionState.preflop.forEach(addEv);
      if(window.state.board.length>=3){ push(['EVENT','BOARD',1,window.state.board[0],'' ]); push(['EVENT','BOARD',1,window.state.board[1],'' ]); push(['EVENT','BOARD',1,window.state.board[2],'' ]); }
      window.state.actionState.flop.forEach(addEv);
      if(window.state.board.length>=4){ push(['EVENT','BOARD',1,window.state.board[3],'' ]); }
      window.state.actionState.turn.forEach(addEv);
      if(window.state.board.length>=5){ push(['EVENT','BOARD',1,window.state.board[4],'' ]); }
      window.state.actionState.river.forEach(addEv);

      // ë§ˆì§€ë§‰ ë²ˆí˜¸í–‰(ì„ íƒ)
      out.push([no]); 
      return { rows: out, epochSec, currentDate };
    }
    
let isSending = false;

async function sendDataToGoogleSheet(){
  if (isSending) return;     // ì¤‘ë³µ ì „ì†¡ ê°€ë“œ
  isSending = true;

  // ìŠ¹ì ì²´í¬ ì œê±° - ìŠ¹ì ì—†ì–´ë„ ì „ì†¡ ê°€ëŠ¥
  const winners = window.state.playersInHand.filter(p=>p.role==='winner');

  await executeWithLock(async () => {
    openLogModal();
    logMessage('ì‹œíŠ¸ ì „ì†¡ ì‹œì‘...');

  try{
    // APPS_SCRIPT_URLì´ ì—†ìœ¼ë©´ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ (v3.5.29)
    if (!APPS_SCRIPT_URL) {
      logMessage('âŒ Apps Script URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      logMessage('ğŸ“Œ ì„¤ì • ë°©ë²•:');
      logMessage('1. Google Apps Scriptì— Code.gs ë°°í¬');
      logMessage('2. ë°°í¬ URL ë³µì‚¬');
      logMessage('3. ì•± ìƒë‹¨ "Apps Script URL ì„¤ì •" ë²„íŠ¼ í´ë¦­');
      logMessage('4. URL ì…ë ¥ í›„ ì €ì¥');
      showFeedback('âŒ Apps Script URL ì„¤ì • í•„ìš”', true);
      return;
    }

    const { rows, epochSec } = generateRows_v46();
    const indexMeta   = buildIndexMeta();
    // ìŠ¹ì ì •ë³´ ì¶”ê°€ (ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
    indexMeta.winners = winners.map(w => w.name).join(', ') || '';
    const typeUpdates = buildTypeUpdates();
    // ë…¸íŠ¸ ê¸°ëŠ¥ ì œê±°
    const payload = { rows, indexMeta, typeUpdates };

    // x-www-form-urlencodedë¡œ ì „ì†¡ â†’ í”„ë¦¬í”Œë¼ì´íŠ¸ ì—†ìŒ (CORS ìš°íšŒ)
    const form = new URLSearchParams();
    form.append('payload', JSON.stringify(payload));

    logMessage(`ğŸ“¡ ì „ì†¡ URL: ${APPS_SCRIPT_URL}`);
    const res = await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
      body: form.toString(),
      // mode: 'cors'  // ìƒëµ ê°€ëŠ¥ (ê¸°ë³¸)
    });

    if(!res.ok){
      const text = await res.text().catch(()=> '');
      console.log(`ì„œë²„ ì‘ë‹µ: ${res.status} ${text || ''}`);
      showFeedback('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜', true);
      return;
    }

    const json = await res.json().catch(()=> ({}));

    if(json.status === 'duplicate'){
      logMessage(`âš ï¸ í•¸ë“œ #${json.handNumber}ëŠ” ì´ë¯¸ ê¸°ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤.`);
      showFeedback('âš ï¸ ì¤‘ë³µëœ í•¸ë“œì…ë‹ˆë‹¤', true);
      // ì¤‘ë³µì¸ ê²½ìš°ì—ë„ í•¸ë“œ ë²ˆí˜¸ë¥¼ ì¦ê°€ì‹œì¼œì•¼ í•¨
      const currentNo = parseInt(window.state.actionState.handNumber, 10) || 0;
      window.state.actionState.handNumber = String(currentNo + 1);
      el.handNumberDisplay.textContent = `#${window.state.actionState.handNumber}`;
      
      // ì¤‘ë³µì´ì–´ë„ ì‹œíŠ¸ì—ëŠ” ê¸°ë¡ëìœ¼ë¯€ë¡œ ìƒˆ í•¸ë“œë¡œ ì¬ì„¤ì •
      await resetApp();
      logMessage('âœ… ìƒˆ í•¸ë“œ ì¤€ë¹„ ì™„ë£Œ');
      
    } else if(json.status !== 'success'){
      logMessage('âš ï¸ Apps Scriptê°€ successë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      logMessage('âš ï¸ ì‹œíŠ¸ í™•ì¸ í›„ ìˆ˜ë™ìœ¼ë¡œ ì¬ì„¤ì • ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
      showFeedback('âš ï¸ ì‹œíŠ¸ ì „ì†¡ í™•ì¸ í•„ìš”', true);
      // ì„±ê³µ ì—¬ë¶€ê°€ ë¶ˆí™•ì‹¤í•˜ë¯€ë¡œ ìë™ ì¬ì„¤ì •í•˜ì§€ ì•ŠìŒ
      
    } else {
      logMessage(`âœ… ì €ì¥ ì™„ë£Œ: #${json.handNumber || indexMeta.handNumber} (rows=${json.rowsAdded})`);
      showFeedback('âœ… ì‹œíŠ¸ ê¸°ë¡ ì™„ë£Œ');
      
      // ì‹œíŠ¸ê°€ ì—…ë°ì´íŠ¸ë˜ë„ë¡ ì¶©ë¶„í•œ ì‹œê°„ì„ ê¸°ë‹¤ë¦¼
      logMessage('ì‹œíŠ¸ ë™ê¸°í™” ì¤‘...');
      await sleep(3000); // 3ì´ˆ ëŒ€ê¸°
      
      // Index CSV ë¦¬í”„ë ˆì‹œ
      try{
        if(CSV_INDEX_URL.includes('http')){
          const idxRows = await fetchCsv(CSV_INDEX_URL + `&cb=${Date.now()}`);
          buildIndexFromCsv(idxRows);
          el.dataStamp.textContent = `IDX rows: ${window.state.indexRows.length}`;
        }
      }catch(_){ /* noop */ }
      
      // ì„±ê³µì ìœ¼ë¡œ ì €ì¥ëœ ê²½ìš°ì—ë§Œ ìƒˆ í•¸ë“œë¡œ ì¬ì„¤ì •
      // ì‹œíŠ¸ ì „ì†¡ ì§í›„ì—ëŠ” Index ì¬ë¡œë“œ ì—†ì´ ë°”ë¡œ ë‹¤ìŒ ë²ˆí˜¸ë¡œ ì´ë™
      await resetApp(false, true);
      logMessage(`âœ… ${APP_VERSION} ìƒˆ í•¸ë“œ ì¤€ë¹„ ì™„ë£Œ`);
    }

  }catch(err){
    console.error(err);
    logMessage(`âŒ ì „ì†¡ ì‹¤íŒ¨: ${err.message}`, true);
    showFeedback(`âŒ ì „ì†¡ ì‹¤íŒ¨: ${err.message}`, true);
    // ì „ì†¡ ì‹¤íŒ¨ ì‹œì—ëŠ” ì¬ì„¤ì •í•˜ì§€ ì•ŠìŒ
    logMessage('âš ï¸ ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ì¬ì„¤ì •í•´ì£¼ì„¸ìš”.');
  }finally{
    closeLogModal(); // ë¡œê·¸ë¥¼ ì¢€ ë” ì˜¤ë˜ ë³´ì—¬ì¤Œ
  }
  }, 'ì‹œíŠ¸ ì „ì†¡', 'ë°ì´í„°ë¥¼ Google ì‹œíŠ¸ì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...');

  isSending = false;
}


    function nowIso() {
      // ì„œë²„ì—ì„œ timezone ë³€í™˜í•˜ë¯€ë¡œ UTC ISOë¡œ ë³´ëƒ„
      return new Date().toISOString();
    }
    function buildIndexMeta(){
      const handNumber = String(window.state.actionState.handNumber);
      const handUpdatedAt = new Date().toISOString().split('T')[0]; // YYYY-MM-DD í˜•ì‹
      const table = window.state.selectedTable || '';
      
      // CAM ë¡œê¹… ì œê±° (v3.5.26)
      console.log('ğŸ“¦ Index ë©”íƒ€ë°ì´í„° ë¹Œë“œ ì™„ë£Œ');
      
      // ë§ˆì§€ë§‰ ì•¡ì…˜ ì°¾ê¸°
      let lastActionDesc = '';
      const streets = ['river', 'turn', 'flop', 'preflop'];
      for(const st of streets) {
        const actions = window.state.actionState[st];
        if(actions.length > 0) {
          const last = actions[actions.length - 1];
          lastActionDesc = `${last.player} ${last.action} ${last.amount || ''}`.trim();
          break;
        }
      }
      
      // ì‘ì—… ìƒíƒœ íŒë‹¨
      function determineWorkStatus() {
        // ìŠ¹ìê°€ ì„ íƒë˜ì—ˆìœ¼ë©´ 'ì™„ë£Œ'
        if(window.state.playersInHand.some(p => p.role === 'winner')) {
          return 'ì™„ë£Œ';
        }
        // ë¦¬ë²„ê¹Œì§€ ê°”ìœ¼ë©´ 'ê²€í† í•„ìš”'
        if(window.state.currentStreet === 'river' && window.state.actionState.river.length > 0) {
          return 'ê²€í† í•„ìš”';
        }
        return 'ì§„í–‰ì¤‘';
      }
      
      // Index ì‹œíŠ¸ì˜ ì „ì²´ ì—´ êµ¬ì¡°ì— ë§ê²Œ ë°ì´í„° ì¤€ë¹„
      return {
        handNumber,                                           // Aì—´
        // startRow, endRowëŠ” ì„œë²„ì—ì„œ ê³„ì‚°                    // B,Cì—´
        handUpdatedAt,                                        // Dì—´ (YYYY-MM-DD)
        // handEditëŠ” ë¹„ì›Œë‘                                   // Eì—´
        // handEditTimeì€ ì„œë²„ì—ì„œ ì²˜ë¦¬                        // Fì—´
        label: 'HOLDEM',                                      // Gì—´
        table,                                                 // Hì—´
        tableUpdatedAt: handUpdatedAt,                        // Iì—´ (YYYY-MM-DD)
        cam: '', // Jì—´ - CAM ê¸°ëŠ¥ ì œê±°ë¨ (v3.5.26)
        camFile01name: '',            // Kì—´ - ë¹ˆ ê°’
        camFile01number: '0', // Lì—´ - ê¸°ë³¸ê°’ 0
        camFile02name: '',            // Mì—´ - ë¹ˆ ê°’
        camFile02number: '0', // Nì—´ - ê¸°ë³¸ê°’ 0
        lastStreet: window.state.currentStreet,                      // Oì—´
        lastAction: lastActionDesc,                           // Pì—´
        workStatus: determineWorkStatus()                     // Qì—´
      };
    }

    function buildTypeUpdates(){
      // ì´ë²ˆ í•¸ë“œ ë™ì•ˆ ì¹©ì´ ìˆ˜ì •ëœ í”Œë ˆì´ì–´ë§Œ ì¶”ë ¤ì„œ Typeì— updatedAt ê¸°ë¡
      const table = window.state.selectedTable || '';
      return window.state.playersInHand
        .filter(p => p.chipsUpdatedAt) // ìˆ˜ì •ëœ ì¼€ì´ìŠ¤ë§Œ
        .map((p, index) => ({
          player: p.name,
          table,
          notable: p.notable || p.keyplayer || false, // Notable/Keyplayer ì •ë³´ ì¶”ê°€
          chips: String(p.chips || ''),
          updatedAt: p.chipsUpdatedAt, // ISO. ì•± ìŠ¤í¬ë¦½íŠ¸ì—ì„œ Dateë¡œ set
          seat: String(p.seatNo || index + 1) // Seat ì •ë³´ ì¶”ê°€ (ì¢Œì„ ë²ˆí˜¸ ë˜ëŠ” ì¸ë±ìŠ¤+1)
        }));
    }



    // ====== CAM PREFILL ì œê±° (v3.5.27) ======
    // CAM ê´€ë ¨ ëª¨ë“  í•¨ìˆ˜ ë¹„í™œì„±í™”
    function computeCamPrefill(which){
      // ë”ë¯¸ í•¨ìˆ˜ - ë¹ˆ ê°’ ë°˜í™˜
      return '';
    }

    function getCamNumber(which) {
      // ë”ë¯¸ í•¨ìˆ˜ - ê¸°ë³¸ê°’ ë°˜í™˜
      return '0';
    }


    // ====== SIDEPOT CALCULATION ======
    function calculateSidePots() {
      const contributions = {};
      
      // ê° ìŠ¤íŠ¸ë¦¬íŠ¸ë³„ í”Œë ˆì´ì–´ ê¸°ì—¬ì•¡ ê³„ì‚°
      ['preflop', 'flop', 'turn', 'river'].forEach(street => {
        window.state.actionState[street].forEach(action => {
          if(action.amount && action.player) {
            contributions[action.player] = (contributions[action.player] || 0) + 
                                          parseInt(unformatNumber(action.amount), 10);
          }
        });
      });
      
      // ì˜¬ì¸ í”Œë ˆì´ì–´ ì •ë ¬ (ê¸ˆì•¡ ì˜¤ë¦„ì°¨ìˆœ)
      const allInPlayers = window.state.playersInHand
        .filter(p => window.state.playerStatus[p.name] === 'allin')
        .map(p => ({ name: p.name, amount: contributions[p.name] || 0 }))
        .sort((a, b) => a.amount - b.amount);
      
      const activePlayers = window.state.playersInHand
        .filter(p => window.state.playerStatus[p.name] !== 'folded')
        .map(p => p.name);
      
      const pots = [];
      let remainingPlayers = [...activePlayers];
      let previousCap = 0;
      
      // ê° ì˜¬ì¸ ë ˆë²¨ë³„ íŒŸ ìƒì„±
      allInPlayers.forEach(allinPlayer => {
        const cap = allinPlayer.amount;
        const potPlayers = remainingPlayers.filter(p => contributions[p] >= cap);
        const potAmount = (cap - previousCap) * potPlayers.length;
        
        if(potAmount > 0) {
          pots.push({
            amount: potAmount,
            players: [...potPlayers],
            cap: cap,
            type: pots.length === 0 ? 'main' : `side${pots.length}`
          });
        }
        
        remainingPlayers = remainingPlayers.filter(p => p !== allinPlayer.name);
        previousCap = cap;
      });
      
      // ë‚¨ì€ ë² íŒ… (ìµœê³  ë² íŒ…ìë“¤ë¼ë¦¬)
      if(remainingPlayers.length > 0) {
        const maxBet = Math.max(...remainingPlayers.map(p => contributions[p] || 0));
        const finalPot = (maxBet - previousCap) * remainingPlayers.length;
        
        if(finalPot > 0) {
          pots.push({
            amount: finalPot,
            players: remainingPlayers,
            cap: maxBet,
            type: pots.length === 0 ? 'main' : `side${pots.length}`
          });
        }
      }
      
      return { pots, contributions };
    }
    
    // ====== RESET & FEEDBACK ======
    async function resetApp(reloadIndex = true, autoIncrement = false){
      let lastNo;
      
      if(autoIncrement) {
        // ì‹œíŠ¸ ì „ì†¡ ì§í›„: í˜„ì¬ í•¸ë“œ ë²ˆí˜¸ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì´ë¯¸ ì „ì†¡ëœ ë²ˆí˜¸)
        lastNo = parseInt(window.state.actionState.handNumber, 10) || 0;
        console.log('ğŸ”„ ì‹œíŠ¸ ì „ì†¡ ì™„ë£Œ - ë‹¤ìŒ í•¸ë“œë¡œ ìë™ ì¦ê°€:', lastNo, 'â†’', lastNo + 1);
      } else if(reloadIndex) {
        // ìƒˆë¡œê³ ì¹¨ì´ë‚˜ ìˆ˜ë™ ì¬ì„¤ì •: Indexë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ì—¬ ìµœì‹  í•¸ë“œ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸°
        try {
          if(CSV_INDEX_URL.includes('http')){
            const idxRows = await fetchCsv(CSV_INDEX_URL + `&cb=${Date.now()}`);
            buildIndexFromCsv(idxRows);
          }
        } catch(err) {
          console.error('Index ì¬ë¡œë“œ ì‹¤íŒ¨:', err);
        }
        
        lastNo = window.state.indexRows.length
          ? Math.max(...window.state.indexRows.map(r=>parseInt(r.handNumber,10)||0))
          : 0;
        console.log('ğŸ”„ Index ì¬ë¡œë“œ - ë§ˆì§€ë§‰ í•¸ë“œ:', lastNo, 'â†’ ë‹¤ìŒ:', lastNo + 1);
      } else {
        // Index ì¬ë¡œë“œ ì—†ì´ í˜„ì¬ ìƒíƒœ ìœ ì§€
        lastNo = window.state.indexRows.length
          ? Math.max(...window.state.indexRows.map(r=>parseInt(r.handNumber,10)||0))
          : 0;
      }
      
      // ì¹´ë©”ë¼ ë²ˆí˜¸ ì €ì¥ ë¡œì§ ì œê±° (v3.5.27)
      // let lastCam1 = null;
      // let lastCam2 = null;
      // Index ë°ì´í„°ì—ì„œ ë§ˆì§€ë§‰ í•¸ë“œì˜ ì¹´ë©”ë¼ ë²ˆí˜¸ í™•ì¸ ë¡œì§ ì œê±°ë¨
      if (window.state.indexRows && window.state.indexRows.length > 0) {
        // ê°€ì¥ ìµœê·¼ í•¸ë“œ ì°¾ê¸° (handNumber ê¸°ì¤€ ì •ë ¬)
        const sortedRows = [...window.state.indexRows].sort((a, b) =>
          parseInt(b.handNumber, 10) - parseInt(a.handNumber, 10)
        );
        const lastHandData = sortedRows[0];

        if (lastHandData) {
          // ì¹´ë©”ë¼ ë²ˆí˜¸ ì²˜ë¦¬ ë¡œì§ ì œê±° (v3.5.27)
          // lastCam1 = lastHandData.cam1no;
          // lastCam2 = lastHandData.cam2no;
          // console.log(`ğŸ“Š êµ¬ê¸€ ì‹œíŠ¸ ë§ˆì§€ë§‰ í•¸ë“œ #${lastHandData.handNumber}: cam1=${lastCam1}, cam2=${lastCam2}`);
        }
      }

      // ì¹´ë©”ë¼ ë²ˆí˜¸ ì²˜ë¦¬ ë¡œì§ ì œê±° (v3.5.27)
      // if (!lastCam1 && !lastCam2) {
      //   console.warn('âš ï¸ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì¹´ë©”ë¼ ë²ˆí˜¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ. ê¸°ë³¸ê°’ 0 ì‚¬ìš©');
      //   lastCam1 = '0';
      //   lastCam2 = '0';
      // }
      
      // í”Œë ˆì´ì–´ ìœ ì§€í•˜ë©´ì„œ ìƒˆ í•¸ë“œ ì‹œì‘
      console.log('ğŸ”„ ìƒˆ í•¸ë“œ ì‹œì‘ - í”Œë ˆì´ì–´ ì´ˆê¸°í™”');
      
      // ê¸°ì¡´ í”Œë ˆì´ì–´ë“¤ì˜ í˜„ì¬ ì¹©ì„ ë‹¤ìŒ í•¸ë“œì˜ ì‹œì‘ì¹©ìœ¼ë¡œ ì„¤ì •
      window.state.playersInHand.forEach(p => {
        // í˜„ì¬ ì¹©ì„ ì‹œì‘ì¹©ìœ¼ë¡œ ì¬ì„¤ì •
        p.initialChips = p.chips;
        p.hand = [];  // í•¸ë“œ ì¹´ë“œ ì´ˆê¸°í™”
        p.role = null;  // ì—­í•  ì´ˆê¸°í™”
        console.log(`  ${p.name}: ì‹œì‘ì¹© = ${p.initialChips} (í˜„ì¬ì¹© ìœ ì§€)`);
      });
      
      window.state.board = [];
      window.state.playerStatus = {}; // í”Œë ˆì´ì–´ ìƒíƒœ ì´ˆê¸°í™”
      window.state.currentStreet = 'preflop'; // ìŠ¤íŠ¸ë¦¬íŠ¸ ì´ˆê¸°í™”
      window.state.actionState = {
        handNumber: String(lastNo + 1),
        smallBlind: window.state.actionState.smallBlind,
        bigBlind: window.state.actionState.bigBlind,
        hasBBAnte: window.state.actionState.hasBBAnte,
        preflop: [], flop: [], turn: [], river: [],
      };
      
      // v3.5.27 - ì¹´ë©”ë¼ ë²ˆí˜¸ ì¦ê°€ ë¡œì§ ì™„ì „ ì œê±°
      // console.log('ğŸ“· ìƒˆ í•¸ë“œ - ì¹´ë©”ë¼ ë²ˆí˜¸ ìë™ ì¦ê°€ (ì´ì „ + 1):');
      // ëª¨ë“  ì¹´ë©”ë¼ ê´€ë ¨ ë¡œì§ ë¹„í™œì„±í™”ë¨
      
      renderAll(); saveActionState();
      el.handNumberDisplay.textContent = `#${window.state.actionState.handNumber}`;
    }
    function showFeedback(msg,isErr=false){
      el.feedbackMessage.textContent = msg;
      el.feedbackMessage.className = `text-center h-4 text-xs font-semibold ${isErr?'text-red-400':'text-green-400'}`;
    }

    // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì • (v3.4.9, v3.5.28 ìˆ˜ì •)
    window.showFeedback = showFeedback;
    window.openCardSelector = openCardSelector;

    // URL ì„¤ì • ëª¨ë‹¬ ì—´ê¸° (v3.5.29)
    function openUrlSetupModal() {
      const modal = el.urlSetupModal;
      const input = document.getElementById('apps-script-url-input');
      const statusMsg = document.getElementById('url-status-message');

      // í˜„ì¬ URL í‘œì‹œ
      input.value = APPS_SCRIPT_URL || '';
      statusMsg.textContent = '';

      openModal(modal);

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      document.getElementById('close-url-modal').onclick = () => closeModal(modal);

      document.getElementById('save-url-btn').onclick = async () => {
        const url = input.value.trim();
        if (!url) {
          statusMsg.className = 'text-sm text-red-400';
          statusMsg.textContent = 'âŒ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.';
          return;
        }

        if (!url.includes('script.google.com/macros/s/') || !url.endsWith('/exec')) {
          statusMsg.className = 'text-sm text-amber-400';
          statusMsg.textContent = 'âš ï¸ ì˜¬ë°”ë¥¸ Apps Script URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.';
          return;
        }

        // URL ì €ì¥
        APPS_SCRIPT_URL = url;
        window.APPS_SCRIPT_URL = url;
        localStorage.setItem('appsScriptUrl', url);

        statusMsg.className = 'text-sm text-green-400';
        statusMsg.textContent = 'âœ… URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.';

        setTimeout(() => {
          closeModal(modal);
          showFeedback('Apps Script URLì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤', false);
        }, 1000);
      };

      document.getElementById('test-url-btn').onclick = async () => {
        const url = input.value.trim() || APPS_SCRIPT_URL;
        if (!url) {
          statusMsg.className = 'text-sm text-red-400';
          statusMsg.textContent = 'âŒ í…ŒìŠ¤íŠ¸í•  URLì´ ì—†ìŠµë‹ˆë‹¤.';
          return;
        }

        statusMsg.className = 'text-sm text-blue-400';
        statusMsg.textContent = 'ğŸ”„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';

        try {
          const response = await fetch(url + '?action=test', {
            method: 'GET',
            mode: 'cors'
          });

          if (response.ok) {
            statusMsg.className = 'text-sm text-green-400';
            statusMsg.textContent = 'âœ… ì—°ê²° ì„±ê³µ! Apps Scriptê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.';
          } else {
            statusMsg.className = 'text-sm text-amber-400';
            statusMsg.textContent = `âš ï¸ ì—°ê²°ë¨ (ìƒíƒœ: ${response.status})`;
          }
        } catch (error) {
          statusMsg.className = 'text-sm text-red-400';
          statusMsg.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨ - CORS ì˜¤ë¥˜ ë˜ëŠ” URLì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.';
        }
      };
    }

    // ====== EVENT LISTENERS ======
    function setupEventListeners(){
      el.loadHandBtn.onclick = openLoadHandModal;
      el.refreshDataBtn.onclick = () => executeWithLock(loadInitial, 'ë°ì´í„° ìƒˆë¡œê³ ì¹¨', 'ìµœì‹  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...');
      el.resetBtn.onclick = () => executeWithLock(resetApp, 'ì•± ë¦¬ì…‹', 'ì•±ì„ ì´ˆê¸°í™”í•˜ê³  ìˆìŠµë‹ˆë‹¤...');

      // URL ì„¤ì • ë²„íŠ¼ (v3.5.29)
      el.setUrlBtn.onclick = () => openUrlSetupModal();

      // CAM ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì™„ì „ ì œê±° (v3.5.27)
      // ëª¨ë“  ì¹´ë©”ë¼ ê´€ë ¨ ì´ë²¤íŠ¸ ë° ìš”ì†Œ ì œê±°ë¨
      // "ì‹œíŠ¸ ì „ì†¡" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ â†’ ë°”ë¡œ ì „ì†¡ (ë…¸íŠ¸ ê¸°ëŠ¥ ì œê±°)
      el.sendToSheetBtn.onclick = () => { sendDataToGoogleSheet(); };
      
      // SB/BB ë²„íŠ¼ ì´ë²¤íŠ¸ ì¶”ê°€
      const smallBlindBtn = document.getElementById('small-blind-btn');
      const bigBlindBtn = document.getElementById('big-blind-btn');
      
      if(smallBlindBtn) {
        smallBlindBtn.onclick = () => {
          const currentValue = window.state.actionState.smallBlind || '0';
          const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-xs">
            <h3 class="text-center text-amber-400 font-bold mb-3">Small Blind ì„¤ì •</h3>
            <div class="text-xs text-gray-400 text-center mb-2">í˜„ì¬: ${formatNumber(currentValue)}</div>
            <input type="text" id="blind-text-input" class="w-full bg-gray-900 text-white p-2 rounded mb-3 text-center" placeholder="0" value="0">
            <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">0</div>
            <div class="grid grid-cols-3 gap-2 text-xl font-bold">
              ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
              <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
            </div>
          </div>`;
          
          // í‚¤íŒ¨ë“œ ì˜µì…˜ ì„¤ì •
          window.state.modalState.keypadOptions = {
            purpose: 'smallBlind'
          };
          
          openModal(el.keypadModal, html);
          
          setTimeout(() => {
            const textInput = document.getElementById('blind-text-input');
            const display = document.getElementById('keypad-display');
            let currentInput = '0';
            
            if(textInput && display) {
              // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸
              textInput.addEventListener('input', () => {
                currentInput = unformatNumber(textInput.value) || '0';
                display.textContent = formatNumber(currentInput);
              });
              
              // í‚¤íŒ¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
              
              // ì·¨ì†Œ ë²„íŠ¼
              document.getElementById('keypad-cancel').onclick = () => {
                closeModal(el.keypadModal);
              };
              
              // í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
            }
          }, 10);
        };
      }
      
      if(bigBlindBtn) {
        bigBlindBtn.onclick = () => {
          const currentValue = window.state.actionState.bigBlind || '0';
          const html = `<div class="bg-gray-800 rounded-lg p-4 w-full max-w-xs">
            <h3 class="text-center text-amber-400 font-bold mb-3">Big Blind ì„¤ì •</h3>
            <div class="text-xs text-gray-400 text-center mb-2">í˜„ì¬: ${formatNumber(currentValue)}</div>
            <input type="text" id="blind-text-input" class="w-full bg-gray-900 text-white p-2 rounded mb-3 text-center" placeholder="0" value="0">
            <div id="keypad-display" class="bg-gray-900 text-right text-2xl font-mono p-2 rounded mb-2 h-12">0</div>
            <div class="grid grid-cols-3 gap-2 text-xl font-bold">
              ${['7','8','9','4','5','6','1','2','3','0','00','000'].map(k=>`<button class="keypad-btn btn bg-gray-700 p-3 rounded-md">${k}</button>`).join('')}
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">C</button>
              <button class="keypad-btn btn bg-gray-600 text-amber-400 p-3 rounded-md">â†</button>
            </div>
            <div class="grid grid-cols-2 gap-2 mt-2">
              <button id="keypad-cancel" class="btn bg-red-600 p-3 rounded-md">ì·¨ì†Œ</button>
              <button id="keypad-confirm" class="btn bg-green-600 p-3 rounded-md">í™•ì¸</button>
            </div>
          </div>`;
          
          // í‚¤íŒ¨ë“œ ì˜µì…˜ ì„¤ì •
          window.state.modalState.keypadOptions = {
            purpose: 'bigBlind'
          };
          
          openModal(el.keypadModal, html);
          
          setTimeout(() => {
            const textInput = document.getElementById('blind-text-input');
            const display = document.getElementById('keypad-display');
            let currentInput = '0';
            
            if(textInput && display) {
              // í…ìŠ¤íŠ¸ ì…ë ¥ ì´ë²¤íŠ¸
              textInput.addEventListener('input', () => {
                currentInput = unformatNumber(textInput.value) || '0';
                display.textContent = formatNumber(currentInput);
              });
              
              // í‚¤íŒ¨ë“œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
              
              // ì·¨ì†Œ ë²„íŠ¼
              document.getElementById('keypad-cancel').onclick = () => {
                closeModal(el.keypadModal);
              };
              
              // í™•ì¸ ë²„íŠ¼ì€ ì „ì—­ í‚¤íŒ¨ë“œ ëª¨ë‹¬ ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬
              // (ì¤‘ë³µ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°)
            }
          }, 10);
        };
      }
      
      // ë…¸íŠ¸ ëª¨ë‹¬ ê´€ë ¨ ì´ë²¤íŠ¸ ì œê±° (ë…¸íŠ¸ ê¸°ëŠ¥ ì‚­ì œ)
      
      el.showLogBtn.onclick = openLogModal;
      el.closeLogModalBtn.onclick = closeLogModal;
      
      // ë¡œê·¸ ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
      el.logModal.addEventListener('click', (e)=>{
        if(e.target === el.logModal) {
          closeLogModal();
        }
      });

      // í…Œì´ë¸” ì„ íƒ ë²„íŠ¼ ë° ëª¨ë‹¬ ì´ë²¤íŠ¸
      el.tableSelectorBtn.onclick = openTableSelectorModal;
      document.getElementById('close-table-selector').onclick = closeTableSelectorModal;

      // ê´€ë¦¬ ëª¨ë‹¬ì˜ í…Œì´ë¸” ë³€ê²½ ë²„íŠ¼
      document.getElementById('change-table-btn')?.addEventListener('click', () => {
        window.isTableManagementMode = true;
        openTableSelectorModal();
      });
      
      // í…Œì´ë¸” ëª¨ë‹¬ ê²€ìƒ‰ ë° í•„í„°
      document.getElementById('table-search').oninput = (e) => {
        tableModalState.searchTerm = e.target.value;
        tableModalState.currentPage = 1;
        renderTableGrid();
      };
      
      // í•„í„° ë²„íŠ¼ë“¤
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.onclick = () => {
          // ëª¨ë“  í•„í„° ë²„íŠ¼ ë¹„í™œì„±í™”
          document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.remove('bg-blue-600', 'text-white');
            b.classList.add('bg-gray-600', 'hover:bg-gray-500');
          });
          // í´ë¦­ëœ ë²„íŠ¼ í™œì„±í™”
          btn.classList.remove('bg-gray-600', 'hover:bg-gray-500');
          btn.classList.add('bg-blue-600', 'text-white');
          
          tableModalState.currentFilter = btn.id.replace('filter-', '');
          tableModalState.currentPage = 1;
          renderTableGrid();
        };
      });
      
      // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
      document.getElementById('prev-page').onclick = () => {
        if (tableModalState.currentPage > 1) {
          tableModalState.currentPage--;
          renderTableGrid();
        }
      };
      
      document.getElementById('next-page').onclick = () => {
        const filteredTables = getFilteredTables();
        const totalPages = Math.ceil(filteredTables.length / tableModalState.tablesPerPage);
        if (tableModalState.currentPage < totalPages) {
          tableModalState.currentPage++;
          renderTableGrid();
        }
      };
      
      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
      el.tableSelectorModal.onclick = (e) => {
        if (e.target === el.tableSelectorModal) {
          closeTableSelectorModal();
        }
      };
      el.timezoneSelector.onchange = (e)=>{ window.state.selectedTimezone=e.target.value; updateTimeDisplay(); renderAll(); };
      
      // Smart Mode í† ê¸€
      document.getElementById('smart-mode-toggle').onchange = (e) => {
        window.state.smartCheckCall = e.target.checked;
        showFeedback(window.state.smartCheckCall ? 'Smart Mode í™œì„±í™”' : 'Smart Mode ë¹„í™œì„±í™”');
      };

      // ì¢Œì„ í”Œë ˆì´ì–´ ì„ íƒ/í•´ì œ (ìƒˆë¡œìš´ 10ê°œ ì¢Œì„ êµ¬ì¡°)
      document.getElementById('seat-buttons')?.addEventListener('click', (e)=>{
        const btn = e.target.closest('button'); 
        if(!btn) return;
        
        const playerName = btn.dataset.playerName;
        const seatNum = btn.dataset.seat;
        
        if(playerName) {
          // í”Œë ˆì´ì–´ê°€ ìˆëŠ” ì¢Œì„ í´ë¦­ - ê²Œì„ ì°¸ì—¬ í† ê¸€
          togglePlayerInHand(playerName);
        } else {
          // ë¹ˆ ì¢Œì„ í´ë¦­ - ì•„ë¬´ ë™ì‘ ì•ˆí•¨
          console.log(`ë¹ˆ #${seatNum} í´ë¦­`);
        }
      });

      // í”Œë ˆì´ì–´ ì¹´ë“œ/ì¹© ì…ë ¥
      el.playerDetailsSection.addEventListener('click', (e)=>{
        const cardPlaceholder = e.target.closest('.card-placeholder');
        const keypadBtn = e.target.closest('.keypad-icon-btn');
        const playerCard = e.target.closest('.player-card');
        if(!playerCard) return;
        if(cardPlaceholder){
          window.state.modalState.cardTarget = { target:'playerHand', player:cardPlaceholder.dataset.playerName, count:parseInt(cardPlaceholder.dataset.count) };
          openCardSelector();
        }else if(keypadBtn){
          const pn = playerCard.dataset.playerName;
          const p = window.state.playersInHand.find(pp=>pp.name===pn);
          if(p) {
            // ê°œì„ ëœ ì¹© ì…ë ¥ í•¨ìˆ˜ ì‚¬ìš©
            openChipInput(p, false);
          }
        }
      });

      // ìŠ¹ì í† ê¸€
      el.winnerButtons.addEventListener('click', (e)=>{
        const btn=e.target.closest('.set-winner-btn'); if(!btn) return;
        setPlayerRole(btn.dataset.playerName);
      });

      // ì¹© ì…ë ¥ í¬ë§·íŒ…
      el.playerDetailsSection.addEventListener('input', (e)=>{
        if(!e.target.classList.contains('player-chip-input')) return;
        const parent = e.target.closest('.player-card');
        const player = window.state.playersInHand.find(p=>p.name===parent.dataset.playerName);
        const raw = unformatNumber(e.target.value);
        e.target.value = formatNumber(raw);
        
        if (player){
          const oldChips = player.chips;
          player.chips = raw;
          player.chipsUpdatedAt = new Date().toISOString();
          
          // í•­ìƒ í˜„ì¬ ì…ë ¥ëœ ì¹© ê°’ì„ ì‹œì‘ì¹©ìœ¼ë¡œ ì—…ë°ì´íŠ¸
          // (ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì¹©ì„ ë³€ê²½í•˜ë©´ ê·¸ê²ƒì´ ìƒˆë¡œìš´ ì‹œì‘ì¹©ì´ ë¨)
          player.initialChips = raw;
          console.log(`ğŸ° ${player.name}ì˜ ì‹œì‘ì¹© ì—…ë°ì´íŠ¸: ${oldChips} â†’ ${raw}`);
        }
      });

      // ë³´ë“œ ì¹´ë“œ ì„ íƒ
      el.boardCardPlaceholders.addEventListener('click', (e)=>{
        const ph = e.target.closest('.card-placeholder'); if(!ph) return;
        window.state.modalState.cardTarget = { target:'board', index:parseInt(ph.dataset.index), count:parseInt(ph.dataset.count) };
        openCardSelector();
      });

      // ì¹´ë“œ ì„ íƒ ëª¨ë‹¬ ì´ë²¤íŠ¸
      el.cardSelectorModal.addEventListener('click', (e)=>{
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if(e.target === el.cardSelectorModal) {
          closeModal(el.cardSelectorModal);
          return;
        }
        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­
        if(e.target.id==='close-card-modal') closeModal(el.cardSelectorModal);
      });

      // ìŠ¤íŠ¸ë¦¬íŠ¸ ë²„íŠ¼(ì¶”ê°€/ë˜ëŒë¦¬ê¸°/Pot êµì •/ìŠ¤íŠ¸ë¦¬íŠ¸ ì„ íƒ)
      el.streetLogsContainer.addEventListener('click', (e)=>{
        const streetBtn = e.target.closest('.street-select-btn');
        const addBtn = e.target.closest('.add-action-btn');
        const undoBtn = e.target.closest('.undo-action-btn');
        const potBtn = e.target.closest('.pot-keypad-btn');
        
        if(streetBtn) {
          const selectedStreet = streetBtn.dataset.street;
          window.state.currentStreet = selectedStreet;
          renderActionStreets(); // í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸

          // ìŠ¤íŠ¸ë¦¿ ì„ íƒ ì‹œ ë°”ë¡œ ì•¡ì…˜ íŒ¨ë“œ ì—´ê¸°
          openActionPad(selectedStreet);
        }
        if(addBtn) openActionPad(addBtn.dataset.street);
        if(undoBtn) undoLastAction(undoBtn.dataset.street);
        if(potBtn){
          window.state.modalState.actionPadStreet = potBtn.dataset.street;
          openKeypad(null, { purpose:'pot', currentPot: potBtn.dataset.currentPot });
        }
      });

      // ìƒˆë¡œìš´ ì•¡ì…˜ íŒ¨ë“œ ë‚´ë¶€ ë²„íŠ¼ ì´ë²¤íŠ¸
      el.actionPadModal.addEventListener('click', (e)=>{
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if(e.target === el.actionPadModal) {
          closeModal(el.actionPadModal);
          return;
        }

        const btn = e.target.closest('button'); if(!btn) return;

        // ë‹«ê¸° ë²„íŠ¼
        if(btn.id==='close-action-pad'){
          closeModal(el.actionPadModal);
          return;
        }

        // ì•¡ì…˜ ëª¨ë“œ í† ê¸€
        if(btn.id==='toggle-action-mode') {
          const newMode = window.actionManager.toggleMode();
          showFeedback(`ì•¡ì…˜ ëª¨ë“œ: ${newMode === 'auto' ? 'ğŸ¤– ìë™ ìˆœì„œ' : 'ğŸ‘† ìˆ˜ë™ ì„ íƒ'}`, false);
          // ëª¨ë‹¬ ë‹¤ì‹œ ì—´ê¸° (UI ì—…ë°ì´íŠ¸)
          openActionPad(window.actionManager.currentStreet);
          return;
        }

        // í˜„ì¬ í”Œë ˆì´ì–´ ìŠ¤í‚µ
        if(btn.id==='skip-current-player') {
          const nextPlayer = window.actionManager.moveToNextPlayer();
          showFeedback(`í”Œë ˆì´ì–´ ìŠ¤í‚µë¨. ${nextPlayer ? `ë‹¤ìŒ: ${nextPlayer.name}` : 'ìŠ¤íŠ¸ë¦¿ ì™„ë£Œ'}`, false);
          openActionPad(window.actionManager.currentStreet);
          return;
        }

        // ìë™ ëª¨ë“œì—ì„œ í˜„ì¬ í”Œë ˆì´ì–´ ì•¡ì…˜
        if(btn.dataset.player && window.actionManager.actionMode === 'auto') {
          const playerName = btn.dataset.player;
          const action = btn.dataset.action;

          // ì•¡ì…˜ ì‹¤í–‰
          executePlayerAction(playerName, action, btn);
          return;
        }

        // ìˆ˜ë™ ëª¨ë“œ í”Œë ˆì´ì–´ ì„ íƒ
        const modal = el.actionPadModal;
        if(btn.parentElement?.id==='action-pad-players'){
          window.state.modalState.actionPadPlayer = btn.dataset.playerName;
          const actionSection = modal.querySelector('#action-pad-actions');
          if(actionSection) {
            modal.querySelector('#action-pad-players').classList.add('hidden');
            actionSection.classList.remove('hidden');

            // ìˆ˜ë™ ëª¨ë“œ Check/Call ë²„íŠ¼ ì—…ë°ì´íŠ¸
            const smartBtn = modal.querySelector('#manual-smart-check-call-btn');
            if(smartBtn) {
              const playerName = btn.dataset.playerName;
              const street = window.state.modalState.actionPadStreet;
              const smartAction = getSmartCheckCallAction(playerName, street);

              // ë²„íŠ¼ ìƒ‰ìƒê³¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
              if(smartAction.action === 'Checks') {
                smartBtn.className = 'btn bg-green-600 hover:bg-green-700 p-3 rounded-md';
                smartBtn.innerHTML = 'âœ… Check';
              } else {
                smartBtn.className = 'btn bg-blue-600 hover:bg-blue-700 p-3 rounded-md';
                smartBtn.innerHTML = `ğŸ“ Call ${formatNumber(smartAction.amount)}`;
              }
              smartBtn.dataset.smartAction = JSON.stringify(smartAction);
            }
          }
          return;
        }

        // ìˆ˜ë™ ëª¨ë“œ ì•¡ì…˜ ì²˜ë¦¬
        if(btn.parentElement?.id==='action-pad-actions'){
          const action = btn.dataset.action;
          const playerName = window.state.modalState.actionPadPlayer;

          if(!playerName) {
            showFeedback('í”Œë ˆì´ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', true);
            return;
          }

          // ìˆ˜ë™ ëª¨ë“œì—ì„œ ì•¡ì…˜ ì‹¤í–‰
          executePlayerAction(playerName, action, btn);
          return;
        }

        // ê¸°ì¡´ í˜¸í™˜ì„±ì„ ìœ„í•œ ì²˜ë¦¬ (ì‚­ì œ ì˜ˆì •)
        if(btn.parentElement?.id==='action-pad-actions-legacy'){
          const action = btn.dataset.action;
          if(action==='Bet/Raises'){
            const st = window.state.modalState.actionPadStreet;
            const hasBet = window.state.actionState[st].some(a=>/BET|RAISE/i.test(a.action||''));
            window.state.modalState.actionPadCurrentAction = hasBet ? 'Raises' : 'Bets';
            closeModal(el.actionPadModal); openKeypad(null, { purpose:'bet' });
          }else if(action==='SmartCheckCall'){
            // ìŠ¤ë§ˆíŠ¸ Check/Call ì²˜ë¦¬
            const smartBtn = btn;
            const smartAction = JSON.parse(smartBtn.dataset.smartAction || '{}');
            if(smartAction.action) {
              addActionToLog(smartAction.action, smartAction.amount);
            }
          }else if(action==='All In'){
            const p = window.state.playersInHand.find(pp=>pp.name===window.state.modalState.actionPadPlayer);
            if(p) addActionToLog('All In', p.chips);
          }else if(action==='Calls'){
            const st = window.state.modalState.actionPadStreet;
            const p = window.state.playersInHand.find(pp=>pp.name===window.state.modalState.actionPadPlayer);
            
            // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì™€ ì´ì „ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ë§ˆì§€ë§‰ ë² íŒ…/ë ˆì´ì¦ˆ ì°¾ê¸°
            let lastBet = null;
            let requiredAmt = 0;
            
            // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì—ì„œ ì°¾ê¸°
            lastBet = [...window.state.actionState[st]].reverse().find(a=>/BET|RAISE|All In/i.test(a.action||''));
            
            if(!lastBet && st !== 'preflop') {
              // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ…ì´ ì—†ìœ¼ë©´ ì´ì „ ìŠ¤íŠ¸ë¦¬íŠ¸ í™•ì¸
              const streetOrder = ['preflop', 'flop', 'turn', 'river'];
              const currentIdx = streetOrder.indexOf(st);
              for(let i = currentIdx - 1; i >= 0; i--) {
                lastBet = [...window.state.actionState[streetOrder[i]]].reverse().find(a=>/BET|RAISE|All In/i.test(a.action||''));
                if(lastBet) break;
              }
            }
            
            // ì½œ ê¸ˆì•¡ ê²°ì •
            if(lastBet) {
              requiredAmt = lastBet.amount;
            } else if(st === 'preflop') {
              // í”„ë¦¬í”Œëì—ì„œ ì•„ë¬´ë„ ë² íŒ…í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¹…ë¸”ë¼ì¸ë“œ ì½œ
              requiredAmt = unformatNumber(window.state.actionState.bigBlind);
            } else {
              // í¬ìŠ¤íŠ¸í”Œëì—ì„œ ë² íŒ…ì´ ì—†ìœ¼ë©´ ì²´í¬í•´ì•¼ í•¨
              showFeedback('ë² íŒ…ì´ ì—†ì–´ ì²´í¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', true);
              return;
            }
            
            // í”Œë ˆì´ì–´ í˜„ì¬ ì¹©
            const playerChips = p ? parseInt(unformatNumber(p.chips), 10) : 0;
            
            // ì˜¬ì¸ ì½œ ì²´í¬: í•„ìš” ê¸ˆì•¡ì´ í”Œë ˆì´ì–´ ì¹©ë³´ë‹¤ í¬ë©´ ì˜¬ì¸
            if(playerChips > 0 && playerChips <= parseInt(unformatNumber(requiredAmt), 10)){
              // ì˜¬ì¸ ì½œ (í”Œë ˆì´ì–´ì˜ ëª¨ë“  ì¹©)
              addActionToLog('All In', p.chips);
            } else {
              // ì¼ë°˜ ì½œ
              addActionToLog('Calls', requiredAmt);
            }
          }else{
            addActionToLog(action);
          }
        }
      });

      // ë°”ê¹¥ìª½ í‚¤íŒ¨ë“œ ë²„íŠ¼(SB/BB ë“±)
      document.body.addEventListener('click', (e)=>{
        const kb = e.target.closest('.keypad-icon-btn');
        if(kb && !kb.closest('.player-card')) openKeypad(kb.previousElementSibling, { purpose:'input' });
      });

      // ğŸš€ ìŠ¤ë§ˆíŠ¸í° í‚¤ë³´ë“œ ìˆ˜ì¤€ í‚¤íŒ¨ë“œ ì…ë ¥ (v3.4.17 ì„±ëŠ¥ ìµœì í™”)
      // ë²„íŠ¼ë³„ ëˆ„ë¦„ ìƒíƒœ ì¶”ì 
      const buttonPressState = new Map();

      // ê¸°ì¡´ click ì´ë²¤íŠ¸ ëŒ€ì‹  down/up ì´ë²¤íŠ¸ë¡œ ì¦‰ì‹œ ë°˜ì‘
      el.keypadModal.addEventListener('mousedown', handleKeypadDown, { passive: false });
      el.keypadModal.addEventListener('touchstart', handleKeypadDown, { passive: false });
      el.keypadModal.addEventListener('mouseup', handleKeypadUp);
      el.keypadModal.addEventListener('touchend', handleKeypadUp);
      el.keypadModal.addEventListener('mouseleave', handleKeypadUp);

      function handleKeypadDown(e) {
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if(e.target === el.keypadModal) {
          closeModal(el.keypadModal);
          return;
        }

        const btn = e.target.closest('button');
        if(!btn) return;

        // ğŸ”§ ëª¨ë°”ì¼ í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ ì¦‰ì‹œ ë°˜ì‘ ì²˜ë¦¬
        if(btn.id === 'keypad-confirm' || btn.id === 'keypad-cancel') {
          // í„°ì¹˜ ì¦‰ì‹œ ë°˜ì‘ (300ms ì§€ì—° ì œê±°)
          btn.style.transform = 'scale(0.95)';
          btn.style.filter = 'brightness(1.2)';

          // ì¦‰ì‹œ í´ë¦­ ì‹¤í–‰
          setTimeout(() => {
            btn.style.transform = '';
            btn.style.filter = '';
            btn.click(); // ê¸°ì¡´ click ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
          }, 100);

          e.preventDefault(); // 300ms ì§€ì—° ë°©ì§€
          return;
        }

        // ì´ë¯¸ ëˆŒë¦° ìƒíƒœë©´ ë¬´ì‹œ (ë¬¼ë¦¬ì  ëˆ„ë¦„ ìƒíƒœë§Œ ì²´í¬)
        if (buttonPressState.get(btn)) return;

        // ì¦‰ì‹œ ì²˜ë¦¬ ì‹œì‘
        buttonPressState.set(btn, true);

        // ì¦‰ì‹œ ì‹œê°ì  í”¼ë“œë°±
        btn.style.transform = 'scale(0.95)';
        btn.style.filter = 'brightness(1.2)';

        // í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ ì¦‰ì‹œ ì²˜ë¦¬
        if(btn.classList.contains('keypad-btn')) {
          processKeypadInputImmediate(btn);
          // í‚¤íŒ¨ë“œ ë²„íŠ¼ë§Œ preventDefault ì ìš©
          e.preventDefault();
        }
      }

      function handleKeypadUp(e) {
        const btn = e.target.closest('button');
        if(!btn) return;

        // ëˆ„ë¦„ ìƒíƒœ í•´ì œ
        buttonPressState.set(btn, false);

        // ì‹œê°ì  ë³µêµ¬
        btn.style.transform = '';
        btn.style.filter = '';
      }

      // ì¦‰ì‹œ ì…ë ¥ ì²˜ë¦¬ í•¨ìˆ˜
      function processKeypadInputImmediate(btn) {
        const display = el.keypadModal.querySelector('#keypad-display');
        const key = btn.textContent;

        if(key==='C'){
          display.textContent='0';
        }else if(key==='â†'){
          const current = unformatNumber(display.textContent);
          const newValue = current.slice(0,-1) || '0';
          display.textContent = formatNumber(newValue);
        }else if(btn.dataset.action === 'max') {
          const { purpose } = window.state.modalState.keypadOptions;
          if(purpose === 'bet') {
            const playerName = window.state.modalState.keypadOptions.playerName ||
                              window.state.modalState.actionPadPlayer;
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              display.textContent = player.chips;
              const warning = el.keypadModal.querySelector('#keypad-warning');
              if(warning) {
                warning.classList.remove('hidden');
                warning.textContent = `ğŸ’° ìµœëŒ€ ë² íŒ… - ë³´ìœ  ì¹© ì „ì²´(${formatNumber(player.chips)})`;
                warning.className = 'text-xs text-blue-400 text-center mb-2';
              }
            }
          }
        }else{
          // ìˆ«ì ì…ë ¥ ì²˜ë¦¬
          const current = unformatNumber(display.textContent);
          let newValue;
          if(current === '0') {
            newValue = key;
          } else {
            newValue = current + key;
          }
          display.textContent = formatNumber(newValue);
        }

        // DOM ê°•ì œ ë Œë”ë§ìœ¼ë¡œ ì¦‰ì‹œ ë°˜ì˜
        display.offsetHeight;
      }

      // í™•ì¸/ì·¨ì†Œ ë²„íŠ¼ì€ ê¸°ì¡´ click ì´ë²¤íŠ¸ ìœ ì§€
      el.keypadModal.addEventListener('click', (e)=>{
        const btn = e.target.closest('button');
        if(!btn) return;

        // í‚¤íŒ¨ë“œ ë²„íŠ¼ì€ ì´ë¯¸ down ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬ë¨
        if(btn.classList.contains('keypad-btn')) return;

        const display = el.keypadModal.querySelector('#keypad-display');

        // MAX ë²„íŠ¼ ì²˜ë¦¬
        if(btn.dataset.action === 'max') {
          const { purpose } = window.state.modalState.keypadOptions;
          if(purpose === 'bet') {
            const playerName = window.state.modalState.keypadOptions.playerName ||
                              window.state.modalState.actionPadPlayer;
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              display.textContent = player.chips; // ëª¨ë“  ì¹©ì„ ë² íŒ…
              const warning = el.keypadModal.querySelector('#keypad-warning');
              if(warning) {
                warning.classList.remove('hidden');
                warning.textContent = `ğŸ’° ìµœëŒ€ ë² íŒ… - ë³´ìœ  ì¹© ì „ì²´(${formatNumber(player.chips)})`;
                warning.className = 'text-xs text-blue-400 text-center mb-2';
              }
            }
          }
          return;
        }

        if(btn.id==='keypad-confirm'){
          const finalAmt = unformatNumber(display.textContent);
          const { purpose, currentPot } = window.state.modalState.keypadOptions;
          // CAM ì²˜ë¦¬ ë¡œì§ ì œê±° (v3.5.27)
          // if(purpose==='cam'){
          //   ëª¨ë“  ì¹´ë©”ë¼ ê´€ë ¨ ë¡œì§ ë¹„í™œì„±í™”
          // }
          if(purpose==='bet'){
            const { playerName } = window.state.modalState.keypadOptions;
            if(finalAmt) {
              // ì¹© ì´ˆê³¼ ê²€ì¦ ì¶”ê°€
              const actualPlayerName = playerName || window.state.modalState.actionPadPlayer;
              const player = window.state.playersInHand.find(p => p.name === actualPlayerName);
              if(player) {
                const playerChips = parseInt(unformatNumber(player.chips), 10);
                const betAmount = parseInt(finalAmt, 10);

                // ë² íŒ… ê¸ˆì•¡ì´ ë³´ìœ  ì¹©ì„ ì´ˆê³¼í•˜ëŠ” ê²½ìš° ê²½ê³ ë§Œ í‘œì‹œ (ì§„í–‰ì€ í—ˆìš©)
                if(betAmount > playerChips) {
                  showFeedback(`âš ï¸ ì£¼ì˜: ì¹© ì´ˆê³¼ ë² íŒ… (ë³´ìœ : ${formatNumber(playerChips)}, ë² íŒ…: ${formatNumber(betAmount)})`, true);
                  const resultingChips = playerChips - betAmount;
                  showFeedback(`ğŸ’° ì¹©ì´ ${formatNumber(resultingChips)}ê°€ ë©ë‹ˆë‹¤`, false);
                  // ê²½ê³ ë§Œ í•˜ê³  ì§„í–‰ì€ ê³„ì†í•¨
                }
              }

              addActionToLog(window.state.modalState.actionPadCurrentAction, finalAmt, actualPlayerName);

              // ìë™ ëª¨ë“œì—ì„œ ë‹¤ìŒ í”Œë ˆì´ì–´ë¡œ ì´ë™
              if(window.actionManager && window.actionManager.actionMode === 'auto') {
                const nextPlayer = window.actionManager.moveToNextPlayer();
                showFeedback(`${playerName} ${window.state.modalState.actionPadCurrentAction} ${formatNumber(finalAmt)}`, false);

                if(nextPlayer) {
                  openActionPad(window.actionManager.currentStreet);
                } else {
                  setTimeout(() => {
                    showFeedback(`${window.actionManager.currentStreet.toUpperCase()} ìŠ¤íŠ¸ë¦¿ ì™„ë£Œ`, false);
                  }, 500);
                }
              }
            }
          }else if(purpose==='pot'){
            // Pot correction: ì…ë ¥í•œ ê°’ ê·¸ëŒ€ë¡œ ì €ì¥ (ì´ì „ íŒŸ í¬ê¸°ë¥¼ ë¹¼ì§€ ì•ŠìŒ)
            const potSize = finalAmt; // í¬ë§·ëœ ê°’ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            if(potSize){
              const st = window.state.modalState.actionPadStreet;
              // Pot Correctionì€ player ì—†ì´ ì €ì¥ (ì‹œìŠ¤í…œ ì•¡ì…˜)
              window.state.actionState[st].push({ 
                action:'Pot Correction', 
                amount:potSize,  // í¬ë§·ëœ ê°’ ê·¸ëŒ€ë¡œ ì €ì¥
                timestamp:new Date().toISOString() 
              });
              saveActionState(); renderAll();
            }
          }else if(purpose==='input'){
            if(window.state.modalState.keypadTarget){
              window.state.modalState.keypadTarget.value = display.textContent;
              window.state.modalState.keypadTarget.dispatchEvent(new Event('input',{bubbles:true}));
            }
          }else if(purpose==='chip'){
            // openChipInputì—ì„œ í˜¸ì¶œëœ ê²½ìš°
            const { playerName } = window.state.modalState.keypadOptions;
            const player = window.state.playersInHand.find(p => p.name === playerName);
            if(player) {
              const value = unformatNumber(display.textContent) || '0';
              player.chips = value;
              player.initialChips = value;
              player.chipsUpdatedAt = new Date().toISOString();
              renderPlayerDetails();
            }
          }else if(purpose==='smallBlind'){
            // SB ë²„íŠ¼ì—ì„œ í˜¸ì¶œëœ ê²½ìš°
            const value = unformatNumber(display.textContent) || '0';
            window.state.actionState.smallBlind = value;
            const smallBlindBtn = document.getElementById('small-blind-btn');
            if(smallBlindBtn) {
              smallBlindBtn.textContent = formatNumber(value);
            }
            saveActionState();
          }else if(purpose==='bigBlind'){
            // BB ë²„íŠ¼ì—ì„œ í˜¸ì¶œëœ ê²½ìš°
            const value = unformatNumber(display.textContent) || '0';
            window.state.actionState.bigBlind = value;
            const bigBlindBtn = document.getElementById('big-blind-btn');
            if(bigBlindBtn) {
              bigBlindBtn.textContent = formatNumber(value);
            }
            saveActionState();
          }else if(purpose==='quickBet'){
            // í€µ ë²³/ë ˆì´ì¦ˆ ì²˜ë¦¬
            const { player, street } = window.state.modalState.keypadOptions;
            const amount = unformatNumber(display.textContent);
            if(amount && player && street) {
              // í˜„ì¬ ìŠ¤íŠ¸ë¦¬íŠ¸ì— ë² íŒ…ì´ ìˆëŠ”ì§€ í™•ì¸
              const hasBet = window.state.actionState[street].some(a => 
                /BET|RAISE/i.test(a.action || '')
              );
              const action = hasBet ? 'Raises' : 'Bets';
              
              // ì•¡ì…˜ ì¶”ê°€
              window.state.actionState[street].push({
                player: player,
                action: action,
                amount: amount,
                timestamp: new Date().toISOString()
              });
              
              // ë‹¤ìŒ í”Œë ˆì´ì–´ ê³„ì‚°
              window.state.nextActionPlayer = calculateNextActionPlayer(street);
              
              saveActionState();
              renderAll();
              showFeedback(`${player} ${action} ${formatNumber(amount)}`);
            }
          }
          closeModal(el.keypadModal);
        }else if(btn.id==='keypad-cancel'){
          closeModal(el.keypadModal);
        }
        // ë‚˜ë¨¸ì§€ ë²„íŠ¼ë“¤ì€ ê¸°ì¡´ ë¡œì§ ìœ ì§€ (í‚¤íŒ¨ë“œ ë²„íŠ¼ì€ down ì´ë²¤íŠ¸ì—ì„œ ì²˜ë¦¬ë¨)
      });

      // SB/BB/Ante ì²´í¬
      document.querySelectorAll('.number-input').forEach(inp=>{
        inp.addEventListener('input', (e)=>{
          const raw = unformatNumber(e.target.value);
          const fmt = formatNumber(raw);
          if(e.target.value!==fmt) e.target.value=fmt;
          const k = toCamelCase(e.target.id.replace('-input','')); // small-blind-input -> smallBlind
          if(k in window.state.actionState) window.state.actionState[k]=raw;
          saveActionState();
        });
      });
      el.bbAnteCheckbox.onchange = (e)=>{ window.state.actionState.hasBBAnte = e.target.checked; saveActionState(); renderAll(); };

      // Load Hand ëª¨ë‹¬ ë‚´ë¶€ í´ë¦­
      el.loadHandModal.addEventListener('click', (e)=>{
        // í•¸ë“œ í•­ëª© í´ë¦­ ìš°ì„  ì²˜ë¦¬
        const itemBtn = e.target.closest('.load-hand-item-btn');
        if(itemBtn){
          const no = itemBtn.dataset.no;
          const dt = itemBtn.dataset.date || null;
          loadHandData(no, dt);
          return;
        }
        
        // ë‹«ê¸° ë²„íŠ¼ í´ë¦­
        const closeBtn = e.target.closest('#close-load-hand-modal');
        if(closeBtn) {
          closeModal(el.loadHandModal);
          return;
        }
        
        // ëª¨ë‹¬ ì»¨í…ì¸  ì˜ì—­ í´ë¦­ì€ ë¬´ì‹œ
        const content = e.target.closest('.bg-gray-800');
        if(content) return;
        
        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        if (e.target === el.loadHandModal) {
          closeModal(el.loadHandModal);
        }
      });
    }

    // ====== ê´€ë¦¬ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ ======
    function openRegistrationModal() {
      const modal = el.registrationModal;
      if (modal) {
        modal.classList.remove('hidden');
        modal.classList.remove('opacity-0');
      }
    }
    
    function closeRegistrationModal() {
      const modal = el.registrationModal;
      if (modal) {
        modal.classList.add('opacity-0');
        modal.classList.add('hidden');
      }
    }
    
    
    // ê´€ë¦¬ ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    if (el.managePlayersBtn) {
      el.managePlayersBtn.addEventListener('click', () => {
        openRegistrationModal();
        // ì´ˆê¸°í™”: ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
        document.getElementById('management-menu').classList.remove('hidden');
        document.getElementById('player-management-content').classList.add('hidden');

        // Apps Script URL í‘œì‹œ
        const currentUrlSpan = document.getElementById('management-current-url');
        const urlInput = document.getElementById('management-apps-url-input');
        const urlStatus = document.getElementById('url-save-status');

        if (currentUrlSpan) {
          currentUrlSpan.textContent = APPS_SCRIPT_URL || 'ì„¤ì •ë˜ì§€ ì•ŠìŒ';
          // URL ìƒíƒœì— ë”°ë¼ ìŠ¤íƒ€ì¼ ì„¤ì •
          currentUrlSpan.className = APPS_SCRIPT_URL ?
            'text-xs text-green-400 break-all font-mono' :
            'text-xs text-amber-400 break-all font-mono';
        }

        if (urlInput) {
          urlInput.value = '';
          urlInput.placeholder = 'ìƒˆ URLì„ ì…ë ¥í•˜ì„¸ìš” (í˜„ì¬ì™€ ë‹¤ë¥¸ URLë§Œ ì €ì¥ ê°€ëŠ¥)';
        }

        if (urlStatus) {
          urlStatus.classList.add('hidden');
        }
      });
    }

    // Apps Script URL ì €ì¥ ë²„íŠ¼ - ì§€ì—° ì‹¤í–‰ìœ¼ë¡œ DOM ë¡œë“œ ë³´ì¥
    setTimeout(() => {
      const saveUrlBtn = document.getElementById('save-apps-url-btn');
      console.log('[v3.3.1] Apps Script URL ì €ì¥ ë²„íŠ¼:', saveUrlBtn);

      if (saveUrlBtn) {
        saveUrlBtn.addEventListener('click', (e) => {
          e.preventDefault();
          console.log('[v3.3.1] URL ì €ì¥ ë²„íŠ¼ í´ë¦­ë¨');

          const urlInput = document.getElementById('management-apps-url-input');
          const urlStatus = document.getElementById('url-save-status');
          const currentUrlSpan = document.getElementById('management-current-url');
          const newUrl = urlInput?.value.trim();

          console.log('[v3.3.1] ì…ë ¥ëœ URL:', newUrl);
          console.log('[v3.3.1] í˜„ì¬ URL:', APPS_SCRIPT_URL);

          // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
          function showUrlStatus(message, isSuccess) {
            if (urlStatus) {
              urlStatus.textContent = message;
              urlStatus.className = isSuccess ?
                'text-xs p-2 rounded bg-green-600 text-white' :
                'text-xs p-2 rounded bg-red-600 text-white';
              urlStatus.classList.remove('hidden');

              // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
              setTimeout(() => {
                urlStatus.classList.add('hidden');
              }, 3000);
            }
          }

          if (newUrl && newUrl !== APPS_SCRIPT_URL) {
            updateAppsScriptUrl(newUrl).then(success => {
              if (success) {
                // ì„±ê³µ ì‹œ UI ì—…ë°ì´íŠ¸
                if (currentUrlSpan) {
                  currentUrlSpan.textContent = newUrl;
                  currentUrlSpan.className = 'text-xs text-green-400 break-all font-mono';
                }

                showUrlStatus('âœ… URLì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', true);
                showFeedback('âœ… Apps Script URLì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');

                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” ë° í”Œë ˆì´ìŠ¤í™€ë” ì—…ë°ì´íŠ¸
                urlInput.value = '';
                urlInput.placeholder = 'ì €ì¥ ì™„ë£Œ! ë‹¤ë¥¸ URLì„ ì…ë ¥í•˜ë ¤ë©´ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”';

                // ì €ì¥ ë²„íŠ¼ ì„ì‹œ ë¹„í™œì„±í™” ë° í…ìŠ¤íŠ¸ ë³€ê²½
                saveUrlBtn.disabled = true;
                saveUrlBtn.textContent = 'âœ… ì €ì¥ ì™„ë£Œ';
                saveUrlBtn.className = 'w-full bg-green-600 py-1.5 rounded text-sm font-medium';

                setTimeout(() => {
                  saveUrlBtn.disabled = false;
                  saveUrlBtn.textContent = 'ğŸ’¾ ìƒˆ URL ì €ì¥';
                  saveUrlBtn.className = 'w-full bg-amber-600 hover:bg-amber-700 py-1.5 rounded text-sm font-medium';
                }, 2000);
              } else {
                showUrlStatus('âŒ ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤', false);
                showFeedback('âŒ ì˜¬ë°”ë¥¸ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤', true);
              }
            });
          } else if (!newUrl) {
            showUrlStatus('âš ï¸ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', false);
            showFeedback('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
          } else if (newUrl === APPS_SCRIPT_URL) {
            showUrlStatus('â„¹ï¸ í˜„ì¬ ì €ì¥ëœ URLê³¼ ë™ì¼í•©ë‹ˆë‹¤', false);
            showFeedback('ë™ì¼í•œ URLì…ë‹ˆë‹¤', true);
          }
        });
        console.log('[v3.3.1] URL ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì™„ë£Œ');
      } else {
        console.error('[v3.3.1] save-apps-url-btn ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }
    }, 100);

    // í…Œì´ë¸” ê´€ë¦¬ ë²„íŠ¼ í´ë¦­ - ë°”ë¡œ í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
    document.getElementById('open-table-management-btn')?.addEventListener('click', () => {
      // í…Œì´ë¸” ê´€ë¦¬ ëª¨ë“œ í™œì„±í™” í”Œë˜ê·¸ ì„¤ì •
      window.isTableManagementMode = true;

      // ë°”ë¡œ í…Œì´ë¸” ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
      openTableSelectorModal();
    });

    // í”Œë ˆì´ì–´ ê´€ë¦¬ ì‹œìŠ¤í…œ ìƒíƒœ - ì „ì—­ ìŠ¤ì½”í”„ë¡œ ë…¸ì¶œ
    window.managementState = {
      selectedTable: '',
      originalPlayers: [],
      currentPlayers: [],
      changes: {
        added: [],
        modified: [],
        deleted: []
      }
    };

    // í”Œë ˆì´ì–´ ê´€ë¦¬ ì´ˆê¸°í™”
    function initPlayerManagement() {
      // ì´ˆê¸° ìƒíƒœë¡œ ë¦¬ì…‹
      window.managementState = {
        selectedTable: '',
        originalPlayers: [],
        currentPlayers: [],
        changes: { added: [], modified: [], deleted: [] }
      };

      // UI ì´ˆê¸°í™” - ì¦‰ì‹œ ì„ íƒ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
      document.getElementById('selected-table-info').classList.add('hidden');
      document.getElementById('player-add-section').classList.add('hidden');
      document.getElementById('player-list-section').classList.add('hidden');
      document.getElementById('batch-actions').classList.add('hidden');
      document.getElementById('sync-status').textContent = '';
    }

    // ê´€ë¦¬ ëª¨ë‹¬ì—ì„œ í…Œì´ë¸” ì„ íƒ ì²˜ë¦¬ - selectTableì—ì„œ í˜¸ì¶œë¨
    function onManagementTableSelected(tableName) {
      console.log('[DEBUG] onManagementTableSelected í˜¸ì¶œë¨, tableName:', tableName);
      if (!tableName) return;

      window.managementState.selectedTable = tableName;
      window.managementState.originalPlayers = JSON.parse(JSON.stringify(
        window.state.playerDataByTable[tableName] || []
      ));
      window.managementState.currentPlayers = JSON.parse(JSON.stringify(
        window.managementState.originalPlayers
      ));
      window.managementState.changes = { added: [], modified: [], deleted: [] };

      console.log('[DEBUG] managementState ì„¤ì •ë¨:', window.managementState);

      // UI ì—…ë°ì´íŠ¸ - í…Œì´ë¸” ì •ë³´ëŠ” í•­ìƒ í‘œì‹œ
      document.getElementById('selected-table-name').textContent = tableName;
      document.getElementById('player-add-section').classList.remove('hidden');
      document.getElementById('player-list-section').classList.remove('hidden');
      document.getElementById('batch-actions').classList.remove('hidden');

      // í”Œë ˆì´ì–´ ëª©ë¡ ë Œë”ë§
      renderManagementPlayersList();
      updateChangesSummary();
    }


    // ë¡œì»¬ í”Œë ˆì´ì–´ ëª©ë¡ ë Œë”ë§ - 10ê°œ ì‹œíŠ¸ ê³ ì • ë°©ì‹
    function renderManagementPlayersList() {
      console.log('[DEBUG] renderManagementPlayersList í˜¸ì¶œë¨');
      const listContainer = document.getElementById('current-players-list');
      const countDisplay = document.getElementById('player-count');

      if (!listContainer) {
        console.log('[DEBUG] listContainerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        return;
      }

      const players = window.managementState.currentPlayers;
      console.log('[DEBUG] ë Œë”ë§í•  í”Œë ˆì´ì–´:', players);
      countDisplay.textContent = `${players.length}/10ëª…`;

      // 10ê°œ ì‹œíŠ¸ ë°°ì—´ ìƒì„± (1ë²ˆë¶€í„° 10ë²ˆê¹Œì§€)
      const seats = [];
      for (let i = 1; i <= 10; i++) {
        seats.push({
          seatNumber: i,
          player: players.find(p => parseSeatNo(p.seatNo) === i) || null
        });
      }

      // 2ì—´ 5ê°œì”© ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (ì»´íŒ©íŠ¸)
      listContainer.innerHTML = `
        <div class="grid grid-cols-2 gap-1">
          ${seats.map(({ seatNumber, player }) => {
            const index = player ? players.findIndex(p => p.name === player.name) : -1;
            const isModified = player && window.managementState.changes.modified.includes(player.name);
            const isAdded = player && window.managementState.changes.added.includes(player.name);
            const isEmpty = !player;

            return `
            <div class="seat-slot bg-gray-700 p-1 rounded ${
              isEmpty ? 'opacity-40' : ''
            } ${
              isAdded ? 'border border-green-500' : isModified ? 'border border-yellow-500' : 'border border-gray-600'
            }" data-seat="${seatNumber}">
              <div class="flex items-center justify-between h-9">
                <div class="flex items-center gap-1 flex-1">
                  <span class="text-sm font-bold text-gray-400 w-6 text-center">
                    ${seatNumber}
                  </span>
                  ${player ? `
                    <div class="flex-1">
                      <input type="text" class="bg-gray-800 px-1 py-0.5 rounded text-xs w-full player-name-input"
                             value="${player.name}"
                             data-index="${index}"
                             data-seat="${seatNumber}">
                    </div>
                  ` : `
                    <div class="flex-1">
                      <input type="text" class="bg-gray-800 px-1 py-0.5 rounded text-xs w-full empty-seat-input"
                             placeholder="ì´ë¦„ ì…ë ¥"
                             data-seat="${seatNumber}">
                    </div>
                  `}
                </div>
                <div class="flex items-center gap-1">
                  ${player ? `
                    <input type="text" class="bg-gray-800 px-1 py-0.5 rounded text-xs w-16 local-chips-input"
                           value="${formatNumber(player.chips || '0')}"
                           placeholder="ì¹©"
                           data-index="${index}">
                    <button class="text-red-400 hover:text-red-300 text-xs local-delete-btn px-1"
                            data-index="${index}"
                            onclick="deleteLocalPlayer(${index})">âœ•</button>
                  ` : `
                    <span class="text-gray-500 text-xs w-16 text-center">-</span>
                  `}
                </div>
              </div>
              ${player && (isAdded || isModified) ? `
                <div class="text-xs px-6">
                  ${isAdded ? '<span class="text-green-400 text-xs">âœ“</span>' : ''}
                  ${isModified ? '<span class="text-yellow-400 text-xs">âœ“</span>' : ''}
                </div>
              ` : ''}
            </div>
          `;
          }).join('')}
        </div>
      `;

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€

      // ë¹ˆ ìë¦¬ ì…ë ¥ ì²˜ë¦¬
      listContainer.querySelectorAll('.empty-seat-input').forEach(input => {
        input.addEventListener('change', (e) => {
          const seatNumber = parseInt(e.target.dataset.seat);
          const playerName = e.target.value.trim();

          if (playerName) {
            addPlayerToSeat(playerName, seatNumber);
            e.target.value = '';
          }
        });
      });

      // í”Œë ˆì´ì–´ ì´ë¦„ ìˆ˜ì •
      listContainer.querySelectorAll('.player-name-input').forEach(input => {
        input.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.index);
          const newName = e.target.value.trim();

          if (index >= 0 && newName) {
            const player = window.managementState.currentPlayers[index];
            if (player && player.name !== newName) {
              player.name = newName;

              if (!window.managementState.changes.added.includes(player.name)) {
                if (!window.managementState.changes.modified.includes(player.name)) {
                  window.managementState.changes.modified.push(player.name);
                }
              }
              updateChangesSummary();
            }
          }
        });
      });

      // ì¹© ì…ë ¥ ì²˜ë¦¬
      listContainer.querySelectorAll('.local-chips-input').forEach(input => {
        input.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.index);
          const newChips = unformatNumber(e.target.value);
          e.target.value = formatNumber(newChips);
          updateLocalPlayerChips(index, newChips);
        });
      });

      // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ëŠ” ì¸ë¼ì¸ onclickìœ¼ë¡œ ì²˜ë¦¬ë¨
      console.log('[DEBUG] ì‚­ì œ ë²„íŠ¼ ê°œìˆ˜:', listContainer.querySelectorAll('.local-delete-btn').length);
    }

    // íŠ¹ì • ì‹œíŠ¸ì— í”Œë ˆì´ì–´ ì¶”ê°€
    function addPlayerToSeat(name, seatNumber) {
      if (!name) return;

      // ì¤‘ë³µ ì²´í¬
      if (window.managementState.currentPlayers.some(p => p.name === name)) {
        showFeedback(`${name}ì€(ëŠ”) ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤`, true);
        return;
      }

      // ì¢Œì„ ì¤‘ë³µ ì²´í¬
      if (window.managementState.currentPlayers.some(p => parseSeatNo(p.seatNo) === seatNumber)) {
        showFeedback(`#${seatNumber}ì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤`, true);
        return;
      }

      // í”Œë ˆì´ì–´ ìˆ˜ ì œí•œ (10ëª…)
      if (window.managementState.currentPlayers.length >= 10) {
        showFeedback('ìµœëŒ€ 10ëª…ê¹Œì§€ë§Œ ë“±ë¡ ê°€ëŠ¥í•©ë‹ˆë‹¤', true);
        return;
      }

      // ì¶”ê°€ - v71 ë°ì´í„° êµ¬ì¡°ì— ë§ì¶¤ (ì •í™•í•œ ìˆœì„œ)
      const newPlayer = {
        name: name,
        chips: '100000',
        keyplayer: false,  // notable â†’ keyplayer
        nationality: '',   // ëˆ„ë½ëœ í•„ë“œ ì¶”ê°€
        seatNo: `#${seatNumber}`,  // seat â†’ seatNo
        pokerRoom: 'Merit Hall',  // ê¸°ë³¸ê°’
        tableName: 'Ocean Blue',  // ê¸°ë³¸ê°’
        tableNo: String(window.managementState.selectedTable),  // table â†’ tableNo
        status: 'IN'
      };

      window.managementState.currentPlayers.push(newPlayer);
      window.managementState.changes.added.push(name);

      renderManagementPlayersList();
      updateChangesSummary();
      showFeedback(`${name} #${seatNumber}ì— ì¶”ê°€ë¨`);
    }


    // ê¸°ì¡´ í”Œë ˆì´ì–´ ì¶”ê°€ UI ìˆ¨ê¸°ê¸° (10ê°œ ì‹œíŠ¸ì—ì„œ ì§ì ‘ ì…ë ¥í•˜ë¯€ë¡œ)
    const addPlayerBtn = document.getElementById('add-player-local-btn');
    if (addPlayerBtn) {
      addPlayerBtn.style.display = 'none';
    }
    const addSection = document.getElementById('player-add-section');
    if (addSection) {
      addSection.style.display = 'none';
    }

    // ë¡œì»¬ í”Œë ˆì´ì–´ ì¢Œì„ ì—…ë°ì´íŠ¸
    function updateLocalPlayerSeat(index, newSeat) {
      const player = window.managementState.currentPlayers[index];
      if (!player) return;

      // ì¢Œì„ ì¤‘ë³µ ì²´í¬
      if (newSeat && window.managementState.currentPlayers.some((p, i) => i !== index && parseSeatNo(p.seatNo) === newSeat)) {
        showFeedback(`#${newSeat}ì€ ì´ë¯¸ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤`, true);
        renderManagementPlayersList();
        return;
      }

      player.seatNo = newSeat;

      // ë³€ê²½ ì‚¬í•­ ì¶”ì 
      if (!window.managementState.changes.added.includes(player.name)) {
        if (!window.managementState.changes.modified.includes(player.name)) {
          window.managementState.changes.modified.push(player.name);
        }
      }

      updateChangesSummary();
    }

    // ë¡œì»¬ í”Œë ˆì´ì–´ ì¹© ì—…ë°ì´íŠ¸
    function updateLocalPlayerChips(index, newChips) {
      const player = window.managementState.currentPlayers[index];
      if (!player) return;

      player.chips = newChips;

      // ë³€ê²½ ì‚¬í•­ ì¶”ì 
      if (!window.managementState.changes.added.includes(player.name)) {
        if (!window.managementState.changes.modified.includes(player.name)) {
          window.managementState.changes.modified.push(player.name);
        }
      }

      updateChangesSummary();
    }

    // ë¡œì»¬ í”Œë ˆì´ì–´ ì‚­ì œ - ì „ì—­ ìŠ¤ì½”í”„ë¡œ ë…¸ì¶œ (ì„œë²„ í†µì‹  ì—†ìŒ)
    window.deleteLocalPlayer = function(index) {
      const player = window.managementState.currentPlayers[index];
      if (!player) {
        console.log('[v3.3.1] ì‚­ì œí•  í”Œë ˆì´ì–´ ì—†ìŒ:', index);
        return;
      }

      console.log('[v3.3.1] í”Œë ˆì´ì–´ ì‚­ì œ:', player.name, 'index:', index);

      // ActionHistoryë¥¼ ì‚¬ìš©í•œ ì¦‰ì‹œ ì‚­ì œ
      const originalIndex = index;
      const originalPlayer = { ...player };
      const originalName = player.name;  // ì´ë¦„ ë³„ë„ ì €ì¥

      // ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸
      window.managementState.currentPlayers.splice(index, 1);

      // ë³€ê²½ ì‚¬í•­ ì¶”ì 
      if (window.managementState.changes.added.includes(originalName)) {
        // ìƒˆë¡œ ì¶”ê°€í•œ í•­ëª©ì´ë©´ addedì—ì„œ ì œê±°
        window.managementState.changes.added = window.managementState.changes.added.filter(n => n !== originalName);
      } else {
        // ê¸°ì¡´ í•­ëª©ì´ë©´ deletedì— ì¶”ê°€
        if (!window.managementState.changes.deleted.includes(originalName)) {
          window.managementState.changes.deleted.push(originalName);
        }
        // modifiedì—ì„œ ì œê±°
        window.managementState.changes.modified = window.managementState.changes.modified.filter(n => n !== originalName);
      }

      console.log('[v3.3.1] ì‚­ì œ í›„ changes:', window.managementState.changes);

      renderManagementPlayersList();
      updateChangesSummary();

      // ìŠ¤ë‚µë°” í‘œì‹œ (ì‹¤í–‰ì·¨ì†Œ ê°€ëŠ¥)
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(`${player.name} ì‚­ì œë¨ (ë¡œì»¬)`, () => {
          // ì‹¤í–‰ ì·¨ì†Œ ë¡œì§
          window.managementState.currentPlayers.splice(originalIndex, 0, originalPlayer);

          // ë³€ê²½ ì‚¬í•­ ë³µêµ¬
          if (window.managementState.changes.deleted.includes(originalPlayer.name)) {
            window.managementState.changes.deleted = window.managementState.changes.deleted.filter(n => n !== originalPlayer.name);
          }

          renderManagementPlayersList();
          updateChangesSummary();
        });
      } else {
        showFeedback(`${player.name} ì‚­ì œë¨ (ë¯¸ë“±ë¡)`);
      }
    }

    // ë³€ê²½ ì‚¬í•­ ìš”ì•½ ì—…ë°ì´íŠ¸
    function updateChangesSummary() {
      const summary = document.getElementById('changes-summary');
      const { added, modified, deleted } = window.managementState.changes;

      const parts = [];
      if (added.length > 0) parts.push(`ì¶”ê°€: ${added.length}ëª…`);
      if (modified.length > 0) parts.push(`ìˆ˜ì •: ${modified.length}ëª…`);
      if (deleted.length > 0) parts.push(`ì‚­ì œ: ${deleted.length}ëª…`);

      if (parts.length > 0) {
        summary.innerHTML = `<span class="text-yellow-400">âš ï¸ ë¯¸ë“±ë¡ ë³€ê²½ì‚¬í•­:</span> ${parts.join(', ')}<br>
        <span class="text-xs text-gray-500">ì¼ê´„ ë“±ë¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„œë²„ì— ì €ì¥í•˜ì„¸ìš”</span>`;
        summary.classList.remove('text-gray-400');
        summary.classList.add('text-amber-300');
      } else {
        summary.textContent = 'ë³€ê²½ ì‚¬í•­ ì—†ìŒ';
        summary.classList.remove('text-amber-300');
        summary.classList.add('text-gray-400');
      }
    }

    // ë³€ê²½ ì‚¬í•­ ì´ˆê¸°í™”
    document.getElementById('reset-changes-btn')?.addEventListener('click', () => {
      // ë°±ì—… ë°ì´í„° ìƒì„± (ì‹¤í–‰ì·¨ì†Œìš©)
      const backup = {
        players: JSON.parse(JSON.stringify(window.managementState.currentPlayers)),
        changes: JSON.parse(JSON.stringify(window.managementState.changes))
      };

      // ì›ë³¸ ë°ì´í„°ë¡œ ë³µì›
      window.managementState.currentPlayers = JSON.parse(JSON.stringify(
        window.managementState.originalPlayers
      ));
      window.managementState.changes = { added: [], modified: [], deleted: [] };

      renderManagementPlayersList();
      updateChangesSummary();

      // ìŠ¤ë‚µë°” í‘œì‹œ (ì‹¤í–‰ì·¨ì†Œ ê°€ëŠ¥)
      if (window.actionHistory) {
        window.actionHistory.showSnackbar('ë³€ê²½ ì‚¬í•­ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', () => {
          // ì‹¤í–‰ ì·¨ì†Œ - ì´ì „ ìƒíƒœë¡œ ë³µêµ¬
          window.managementState.currentPlayers = backup.players;
          window.managementState.changes = backup.changes;
          renderManagementPlayersList();
          updateChangesSummary();
        });
      } else {
        showFeedback('ë³€ê²½ ì‚¬í•­ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
      }
    });

    // ì¼ê´„ ë“±ë¡
    document.getElementById('batch-register-btn')?.addEventListener('click', async () => {
      const { added, modified, deleted } = window.managementState.changes;

      if (added.length === 0 && modified.length === 0 && deleted.length === 0) {
        if (window.actionHistory) {
          window.actionHistory.showSnackbar('ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤', null, 'warning');
        } else {
          showFeedback('ë³€ê²½ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤', true);
        }
        return;
      }

      // ë³€ê²½ì‚¬í•­ ë©”ì‹œì§€ í‘œì‹œ
      const changeMessage = `ì¶”ê°€: ${added.length}ëª…, ìˆ˜ì •: ${modified.length}ëª…, ì‚­ì œ: ${deleted.length}ëª…`;
      if (window.actionHistory) {
        window.actionHistory.showSnackbar(`ë“±ë¡ ì¤‘... ${changeMessage}`, null, 'info');
      }

      const syncStatus = document.getElementById('sync-status');
      syncStatus.textContent = 'ë™ê¸°í™” ì¤‘...';
      syncStatus.className = 'text-xs text-yellow-400';

      await executeWithLock(async () => {

      try {
        console.log('[v3.3.1] === ì¼ê´„ ë“±ë¡ ì‹œì‘ ===');
        console.log('[v3.3.1] ì„ íƒëœ í…Œì´ë¸”:', window.managementState.selectedTable);
        console.log('[v3.3.1] í˜„ì¬ í”Œë ˆì´ì–´ ìˆ˜:', window.managementState.currentPlayers.length);
        console.log('[v3.3.1] ì¶”ê°€ë  í”Œë ˆì´ì–´:', added);
        console.log('[v3.3.1] ìˆ˜ì •ë  í”Œë ˆì´ì–´:', modified);
        console.log('[v3.3.1] ì‚­ì œë  í”Œë ˆì´ì–´:', deleted);
        console.log('[v3.3.1] Apps Script URL:', APPS_SCRIPT_URL);

        // ì‚­ì œ ëŒ€ìƒ í”Œë ˆì´ì–´ ìƒì„¸ ì •ë³´ í™•ì¸
        console.log('[v3.3.1] === ì‚­ì œ ëŒ€ìƒ ìƒì„¸ ì •ë³´ ===');
        deleted.forEach((playerName, index) => {
          console.log(`[v3.3.1] ì‚­ì œ[${index}]: "${playerName}" (ê¸¸ì´: ${playerName.length})`);
        });

        // v71 êµ¬ì¡°ë¡œ í”Œë ˆì´ì–´ ë°ì´í„° ë³€í™˜ (ì •í™•í•œ ìˆœì„œ)
        const playersToSend = window.managementState.currentPlayers.map(p => ({
          name: p.name,
          chips: String(p.chips || '100000'),
          keyplayer: p.keyplayer || p.notable || false,  // notable â†’ keyplayer
          nationality: p.nationality || '',
          seatNo: p.seatNo || p.seat || '',  // seat â†’ seatNo
          pokerRoom: p.pokerRoom || 'Merit Hall',
          tableName: p.tableName || 'Ocean Blue',
          tableNo: p.tableNo || p.table || String(window.managementState.selectedTable)  // table â†’ tableNo
        }));

        // URL ì¸ì½”ë”© ë°©ì‹ìœ¼ë¡œ ìš”ì²­ (CORS í•´ê²°)
        const urlParams = new URLSearchParams();
        urlParams.append('action', 'batchUpdate');
        urlParams.append('table', window.managementState.selectedTable);
        urlParams.append('players', JSON.stringify(playersToSend));
        urlParams.append('deleted', JSON.stringify(deleted));

        console.log('[v3.3.1] URLSearchParams ìƒì„± ì™„ë£Œ');
        console.log('[v3.3.1] ì „ì†¡í•  í”Œë ˆì´ì–´ ë°ì´í„°:', JSON.stringify(playersToSend, null, 2));
        console.log('[v3.3.1] ì‚­ì œí•  í”Œë ˆì´ì–´ ì´ë¦„ë“¤:', JSON.stringify(deleted, null, 2));

        // URLParams ë‚´ìš© í™•ì¸
        console.log('[v3.3.1] === URLSearchParams ë‚´ìš© í™•ì¸ ===');
        for (let [key, value] of urlParams.entries()) {
          console.log(`[v3.3.1] URLParams[${key}]:`, typeof value === 'string' ? value.substring(0, 200) + '...' : value);
        }

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: urlParams.toString()
        });

        console.log('[v3.3.1] ì‘ë‹µ ìˆ˜ì‹ :', response.status, response.statusText);

        if (!response.ok) {
          console.log(`HTTP ${response.status}: ${response.statusText}`);
          showFeedback('ì„œë²„ í†µì‹  ì˜¤ë¥˜', true);
          return;
        }

        const result = await response.json();
        console.log('[v3.3.1] ì‘ë‹µ ë°ì´í„°:', result);

        if (result.success) {
          console.log('[v3.3.1] ì¼ê´„ ë“±ë¡ ì„±ê³µ:', result);
          syncStatus.textContent = 'âœ… ë™ê¸°í™” ì™„ë£Œ';
          syncStatus.className = 'text-xs text-green-400';

          // ìŠ¤ë‚µë°”ë¡œ ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (ì •ë ¬ í¬í•¨)
          if (window.actionHistory) {
            window.actionHistory.showSnackbar('âœ… ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ë“±ë¡ë˜ê³  ì‹œíŠ¸ê°€ ì •ë ¬ë˜ì—ˆìŠµë‹ˆë‹¤', null, 'success');
          } else {
            showFeedback('âœ… ëª¨ë“  ë³€ê²½ ì‚¬í•­ì´ ë“±ë¡ë˜ê³  ì‹œíŠ¸ê°€ ì •ë ¬ë˜ì—ˆìŠµë‹ˆë‹¤');
          }

          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ - CSV ë°©ì‹ ì‚¬ìš©
          try {
            console.log('[v3.3.1] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹œì‘...');
            console.log('[v3.3.1] CSV_TYPE_URL:', CSV_TYPE_URL);

            const csv = await fetch(CSV_TYPE_URL).then(r => {
              console.log('[v3.3.1] CSV ì‘ë‹µ ìƒíƒœ:', r.status, r.statusText);
              return r.text();
            });

            console.log('[v3.3.1] CSV ë°ì´í„° ê¸¸ì´:', csv.length);
            console.log('[v3.3.1] CSV ì²« 100ì:', csv.substring(0, 100));

            const rows = parseCSV(csv);
            console.log('[v3.3.1] íŒŒì‹±ëœ í–‰ ìˆ˜:', rows.length);

            buildTypeFromCsv(rows);
            console.log('[v3.3.1] Type ë°ì´í„° ë¹Œë“œ ì™„ë£Œ');
            console.log('[v3.3.1] ì—…ë°ì´íŠ¸ëœ í…Œì´ë¸”:', Object.keys(window.state.playerDataByTable));
          } catch (refreshError) {
            console.error('[v3.3.1] ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', refreshError);
            showFeedback('âš ï¸ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨, í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”', true);
          }

          // ìƒíƒœ ë¦¬ì…‹
          try {
            console.log('[v3.3.1] ìƒíƒœ ë¦¬ì…‹ ì‹œì‘...');
            console.log('[v3.3.1] ì„ íƒëœ í…Œì´ë¸”:', window.managementState.selectedTable);

            const refreshedPlayers = window.state.playerDataByTable[window.managementState.selectedTable] || [];
            console.log('[v3.3.1] ìƒˆë¡œê³ ì¹¨ëœ í”Œë ˆì´ì–´ ìˆ˜:', refreshedPlayers.length);

            window.managementState.originalPlayers = JSON.parse(JSON.stringify(refreshedPlayers));
            window.managementState.currentPlayers = JSON.parse(JSON.stringify(refreshedPlayers));
            window.managementState.changes = { added: [], modified: [], deleted: [] };

            console.log('[v3.3.1] ìƒíƒœ ë¦¬ì…‹ ì™„ë£Œ');
          } catch (resetError) {
            console.error('[v3.3.1] ìƒíƒœ ë¦¬ì…‹ ì‹¤íŒ¨:', resetError);
          }

          try {
            console.log('[v3.3.1] UI ì—…ë°ì´íŠ¸ ì‹œì‘...');
            renderManagementPlayersList();
            updateChangesSummary();
            renderPlayerSelection(); // ë©”ì¸ í™”ë©´ ì—…ë°ì´íŠ¸

            // ì „ì²´ UI ìƒˆë¡œê³ ì¹¨ (ì¦‰ì‹œ ë°˜ì˜ì„ ìœ„í•´)
            if (typeof renderAll === 'function') {
              renderAll();
              console.log('[v3.3.1] ì „ì²´ UI ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
            }

            // í”Œë ˆì´ì–´ ë°ì´í„° ë‹¤ì‹œ ë Œë”ë§
            if (typeof updatePlayersDisplay === 'function') {
              updatePlayersDisplay();
              console.log('[v3.3.1] í”Œë ˆì´ì–´ ë””ìŠ¤í”Œë ˆì´ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
            }

            console.log('[v3.3.1] UI ì—…ë°ì´íŠ¸ ì™„ë£Œ - ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ì¦‰ì‹œ ì ìš©ë¨');
          } catch (uiError) {
            console.error('[v3.3.1] UI ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', uiError);
          }

          // ëª¨ë‹¬ ìë™ ë‹«ê¸° ë° ëŒ€ì‹œë³´ë“œ ë¦¬ë‹¤ì´ë ‰íŠ¸
          if (typeof autoCloseManagementModal === 'function') {
            console.log('[v3.3.1] ëª¨ë‹¬ ìë™ ë‹«ê¸° ì‹¤í–‰...');
            autoCloseManagementModal();
          } else {
            // í´ë°±: ìˆ˜ë™ìœ¼ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            setTimeout(() => {
              const modal = document.getElementById('management-modal');
              if (modal) {
                modal.classList.add('hidden', 'opacity-0');
                console.log('[v3.3.1] ëª¨ë‹¬ ìˆ˜ë™ ë‹«ê¸° ì™„ë£Œ');
              }
            }, 2000);
          }
        } else {
          // ì˜¤ë¥˜ ì²˜ë¦¬
          syncStatus.textContent = 'âŒ ë™ê¸°í™” ì‹¤íŒ¨';
          syncStatus.className = 'text-xs text-red-400';

          const errorMessage = result.message && result.message.includes('Unknown action')
            ? 'Apps Script ì¬ë°°í¬ê°€ í•„ìš”í•©ë‹ˆë‹¤'
            : result.message || 'ë“±ë¡ ì‹¤íŒ¨';

          // ìŠ¤ë‚µë°”ë¡œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
          if (window.actionHistory) {
            window.actionHistory.showSnackbar(errorMessage, null, 'error');
          } else {
            showFeedback(errorMessage, true);
          }

          // UI í™œì„±í™”
          if (typeof enableModalUI === 'function') {
            enableModalUI();
          }
        }
      } catch(err) {
        console.error('[v3.3.1] === ì¼ê´„ ë“±ë¡ ì˜¤ë¥˜ ===');
        console.error('[v3.3.1] ì˜¤ë¥˜ íƒ€ì…:', err.constructor.name);
        console.error('[v3.3.1] ì˜¤ë¥˜ ë©”ì‹œì§€:', err.message);
        console.error('[v3.3.1] ì˜¤ë¥˜ ìŠ¤íƒ:', err.stack);
        console.error('[v3.3.1] ì „ì²´ ì˜¤ë¥˜ ê°ì²´:', err);

        syncStatus.textContent = 'âŒ ë™ê¸°í™” ì‹¤íŒ¨';
        syncStatus.className = 'text-xs text-red-400';

        // ìƒì„¸í•œ ì—ëŸ¬ ë¶„ì„
        let errorMessage = err.message;
        let debugInfo = '';

        if (err.message.includes('loadTypeSheet is not defined')) {
          errorMessage = 'ë°ì´í„° ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜ ì˜¤ë¥˜ (ì´ë¯¸ ìˆ˜ì •ë¨)';
          debugInfo = 'í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”';
        } else if (err.message.includes('Apps Script ì¬ë°°í¬')) {
          errorMessage = 'âš ï¸ Apps Script ì¬ë°°í¬ í•„ìš” (ê´€ë¦¬ ë©”ë‰´ ì°¸ì¡°)';
        } else if (err.message.includes('NetworkError') || err.message.includes('fetch')) {
          errorMessage = 'ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì˜¤ë¥˜';
          debugInfo = 'Apps Script URLì„ í™•ì¸í•˜ê³  ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”';
        } else if (err.message.includes('JSON')) {
          errorMessage = 'Apps Script ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜';
          debugInfo = 'Apps Scriptê°€ ì˜¬ë°”ë¥¸ JSONì„ ë°˜í™˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤';
        }

        console.error('[v3.3.1] ë¶„ì„ëœ ì˜¤ë¥˜:', errorMessage);
        console.error('[v3.3.1] ë””ë²„ê·¸ ì •ë³´:', debugInfo);

        showFeedback(`âŒ ${errorMessage}${debugInfo ? ` (${debugInfo})` : ''}`, true);

        // UI í™œì„±í™”
        if (typeof enableModalUI === 'function') {
          enableModalUI();
        }
      } finally {
        console.log('[v3.3.1] === ì¼ê´„ ë“±ë¡ ì¢…ë£Œ ===');
      }
    }, 'í”Œë ˆì´ì–´ ë“±ë¡', 'í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ì„œë²„ì— ì €ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤...');
    });

    // ê¸°ì¡´ í”Œë ˆì´ì–´ ëª©ë¡ ë¡œë“œ í•¨ìˆ˜ (êµ¬ë²„ì „ í˜¸í™˜ìš©)
    function loadPlayersList() {
      const listContainer = document.getElementById('current-players-list');
      if (!listContainer) return;

      const table = window.state.selectedTable;
      if (!table) {
        listContainer.innerHTML = '<p class="text-gray-400 text-xs">í…Œì´ë¸”ì„ ì„ íƒí•˜ë©´ í”Œë ˆì´ì–´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';
        return;
      }

      const players = window.state.playerDataByTable[table] || [];
      if (players.length === 0) {
        listContainer.innerHTML = '<p class="text-gray-400 text-xs">í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
      }

      listContainer.innerHTML = players.map(player => `
        <div class="flex items-center justify-between bg-gray-600 p-2 rounded player-list-item" data-player="${player.name}">
          <div class="flex-1">
            <span class="font-medium">${player.name}</span>
            ${player.seatNo ? `<span class="text-xs text-gray-400 ml-2">#${player.seatNo}</span>` : ''}
          </div>
          <div class="flex items-center gap-2">
            <input type="number" class="bg-gray-700 px-2 py-1 rounded text-sm w-16 seat-input"
                   value="${player.seatNo || ''}" placeholder="#ì¢Œì„" min="1" max="10"
                   data-player="${player.name}">
            <input type="text" class="bg-gray-700 px-2 py-1 rounded text-sm w-20 chips-input"
                   value="${formatNumber(player.chips || '0')}" placeholder="ì¹©"
                   data-player="${player.name}">
            <button class="text-red-500 hover:text-red-400 delete-player-btn" data-player="${player.name}">ğŸ—‘ï¸</button>
          </div>
        </div>
      `).join('');

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      listContainer.querySelectorAll('.seat-input').forEach(input => {
        input.addEventListener('change', (e) => {
          const playerName = e.target.dataset.player;
          const newSeat = e.target.value;
          updatePlayerSeat(playerName, newSeat);
        });
      });

      listContainer.querySelectorAll('.chips-input').forEach(input => {
        input.addEventListener('input', (e) => {
          const playerName = e.target.dataset.player;
          const newChips = unformatNumber(e.target.value);
          e.target.value = formatNumber(newChips);
          updatePlayerChips(playerName, newChips);
        });
      });

      // êµ¬ë²„ì „ ì‚­ì œ ë²„íŠ¼ - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
      /*
      listContainer.querySelectorAll('.delete-player-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const playerName = e.target.dataset.player;
          // confirm ì œê±°, ì¦‰ì‹œ ì‚­ì œ ì‹¤í–‰
          deletePlayer(playerName);
        });
      });
      */
    }

    // í”Œë ˆì´ì–´ ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('add-player-btn')?.addEventListener('click', () => {
      const nameInput = document.getElementById('new-player-name');
      const seatInput = document.getElementById('new-player-seat');
      const chipsInput = document.getElementById('new-player-chips');

      const name = nameInput.value.trim();
      const seat = seatInput.value;
      const chips = unformatNumber(chipsInput.value) || '0';

      if (!name) {
        showFeedback('í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', true);
        return;
      }

      if (!window.state.selectedTable) {
        showFeedback('ë¨¼ì € í…Œì´ë¸”ì„ ì„ íƒí•˜ì„¸ìš”', true);
        return;
      }

      addNewPlayer(name, seat, chips);

      // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
      nameInput.value = '';
      seatInput.value = '';
      chipsInput.value = '';
    });


    // í”Œë ˆì´ì–´ ì¶”ê°€ í•¨ìˆ˜ - ì¤‘ë³µ ì²´í¬ ê°•í™”
    async function addNewPlayer(name, seat, chips) {
      try {
        // í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¨¼ì € ì¤‘ë³µ ì²´í¬
        const existingPlayer = window.state.playersByTable[window.state.selectedTable]?.find(p =>
          p.name === name && p.status === 'IN'
        );

        if (existingPlayer) {
          showFeedback(`âŒ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”Œë ˆì´ì–´ì…ë‹ˆë‹¤: ${name}`, true);
          return;
        }

        // v70 iframe í†µì‹  ë°©ì‹ìœ¼ë¡œ ë³€ê²½
        const response = await callAppsScript('createPlayer', {
          tableNo: window.state.selectedTable,
          seatNo: seat || '',
          name: name,
          chips: chips,
          pokerRoom: 'Default Room',
          tableName: 'Default Table',
          nationality: '',
          keyplayer: false
        });

        const result = await response.json();
        if (result.success) {
          console.log('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ ì„±ê³µ:', result);
          showFeedback(`âœ… ${name} ì¶”ê°€ë¨`);

          // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ - CSV ë°©ì‹ ì‚¬ìš©
          try {
            console.log('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ í›„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨...');
            const csv = await fetch(CSV_TYPE_URL).then(r => r.text());
            const rows = parseCSV(csv);
            buildTypeFromCsv(rows);
            console.log('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ í›„ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
          } catch (refreshError) {
            console.error('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ í›„ ìƒˆë¡œê³ ì¹¨ ì‹¤íŒ¨:', refreshError);
          }

          loadPlayersList();
          renderPlayerSelection();
        } else {
          console.error('[v3.3.1] í”Œë ˆì´ì–´ ì¶”ê°€ ì‹¤íŒ¨:', result);
          showFeedback(`âŒ ì¶”ê°€ ì‹¤íŒ¨: ${result.error}`, true);
        }
      } catch(err) {
        console.error('í”Œë ˆì´ì–´ ì¶”ê°€ ì˜¤ë¥˜:', err);
        showFeedback('í”Œë ˆì´ì–´ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', true);
      }
    }

    // í”Œë ˆì´ì–´ ì¢Œì„ ì—…ë°ì´íŠ¸
    async function updatePlayerSeat(playerName, newSeat) {
      try {
        const formData = new FormData();
        formData.append('action', 'updateSeat');
        formData.append('table', window.state.selectedTable);
        formData.append('player', playerName);
        formData.append('seat', newSeat || '');

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          showFeedback(`âœ… ${playerName} #${newSeat}ìœ¼ë¡œ ë³€ê²½`);
          // ë©”ëª¨ë¦¬ ì—…ë°ì´íŠ¸
          const player = window.state.playerDataByTable[window.state.selectedTable]?.find(p => p.name === playerName);
          if (player) player.seatNo = newSeat;
          renderPlayerSelection();
        } else {
          showFeedback(`âŒ #ì¢Œì„ ë³€ê²½ ì‹¤íŒ¨: ${result.error}`, true);
        }
      } catch(err) {
        console.error('#ì¢Œì„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', err);
        showFeedback('#ì¢Œì„ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', true);
      }
    }

    // í”Œë ˆì´ì–´ ì¹© ì—…ë°ì´íŠ¸
    async function updatePlayerChips(playerName, newChips) {
      try {
        const formData = new FormData();
        formData.append('action', 'updateChips');
        formData.append('table', window.state.selectedTable);
        formData.append('player', playerName);
        formData.append('chips', newChips);

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          // ë©”ëª¨ë¦¬ ì—…ë°ì´íŠ¸
          const player = window.state.playerDataByTable[window.state.selectedTable]?.find(p => p.name === playerName);
          if (player) player.chips = newChips;
        }
      } catch(err) {
        console.error('ì¹© ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', err);
      }
    }

    // í”Œë ˆì´ì–´ ì‚­ì œ (êµ¬ë²„ì „ - ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
    // ìƒˆë¡œìš´ ê´€ë¦¬ ì‹œìŠ¤í…œì—ì„œëŠ” deleteLocalPlayerë¥¼ ì‚¬ìš©í•˜ê³ 
    // ì„œë²„ ë™ê¸°í™”ëŠ” ì¼ê´„ ë“±ë¡ ì‹œì—ë§Œ ì²˜ë¦¬
    /*
    async function deletePlayer(playerName) {
      try {
        const formData = new FormData();
        formData.append('action', 'deletePlayer');
        formData.append('table', window.state.selectedTable);
        formData.append('player', playerName);

        const response = await fetch(APPS_SCRIPT_URL, {
          method: 'POST',
          body: formData
        });

        const result = await response.json();
        if (result.success) {
          showFeedback(`âœ… ${playerName} ì‚­ì œë¨`);
          // ë©”ëª¨ë¦¬ì—ì„œ ì œê±°
          const players = window.state.playerDataByTable[window.state.selectedTable];
          if (players) {
            const index = players.findIndex(p => p.name === playerName);
            if (index !== -1) players.splice(index, 1);
          }
          loadPlayersList();
          renderPlayerSelection();
        } else {
          showFeedback(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${result.error}`, true);
        }
      } catch(err) {
        console.error('í”Œë ˆì´ì–´ ì‚­ì œ ì˜¤ë¥˜:', err);
        showFeedback('í”Œë ˆì´ì–´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ', true);
      }
    }
    */
    
    // ========================================
    // ì„¤ì • ëª¨ë‹¬ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    // ========================================
    
    // ì„¤ì • ëª¨ë‹¬ ì—´ê¸°
    if (el.settingsBtn) {
      el.settingsBtn.addEventListener('click', () => {
        // í˜„ì¬ URL í‘œì‹œ
        el.currentAppsUrl.textContent = APPS_SCRIPT_URL;
        el.appsScriptUrlInput.value = APPS_SCRIPT_URL;
        
        // ì¹© ê²€ì¦ ì„¤ì • ë¡œë“œ
        const chipValidation = localStorage.getItem('chipValidation') !== 'false';
        el.chipValidationToggle.checked = chipValidation;
        
        // ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ ì„¤ì • ë¡œë“œ
        const actionInputMode = localStorage.getItem('actionInputMode') === 'auto';
        const actionInputToggle = document.getElementById('action-input-mode-toggle');
        if (actionInputToggle) {
          actionInputToggle.checked = actionInputMode;
        }
        
        // í´ë¼ìš°ë“œ ë™ê¸°í™” UI ì—…ë°ì´íŠ¸
        updateCloudSyncUI();

        // ë²„ì „ ì •ë³´ ì—…ë°ì´íŠ¸
        const versionInfo = el.settingsModal.querySelector('.text-gray-400');
        if (versionInfo) {
          el.settingsModal.querySelectorAll('.text-gray-400').forEach((elem, idx) => {
            if (idx === 0) elem.textContent = APP_VERSION;
            if (idx === 1) elem.textContent = VERSION_DATE;
          });
        }
        
        // ëª¨ë‹¬ ì—´ê¸°
        el.settingsModal.classList.remove('hidden');
      });
    }
    
    // ì„¤ì • ëª¨ë‹¬ ë‹«ê¸°
    const closeSettings = () => {
      el.settingsModal.classList.add('hidden');
    };
    
    if (el.closeSettingsBtn) {
      el.closeSettingsBtn.addEventListener('click', closeSettings);
    }
    
    if (el.cancelSettingsBtn) {
      el.cancelSettingsBtn.addEventListener('click', closeSettings);
    }
    
    // ì„¤ì • ì €ì¥
    if (el.saveSettingsBtn) {
      el.saveSettingsBtn.addEventListener('click', () => {
        // Apps Script URL ì €ì¥
        const newUrl = el.appsScriptUrlInput.value.trim();
        if (newUrl && newUrl !== APPS_SCRIPT_URL) {
          updateAppsScriptUrl(newUrl).then(success => {
            if (success) {
              console.log('âœ… Apps Script URL ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            }
          });
        }
        
        // ì¹© ê²€ì¦ ì„¤ì • ì €ì¥
        const chipValidation = el.chipValidationToggle.checked;
        localStorage.setItem('chipValidation', chipValidation.toString());
        window.state.chipValidation = chipValidation;
        console.log(`âœ… ì¹© ê²€ì¦ ì„¤ì •: ${chipValidation ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}`);
        
        // ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ ì„¤ì • ì €ì¥
        const actionInputToggle = document.getElementById('action-input-mode-toggle');
        if (actionInputToggle) {
          const actionInputMode = actionInputToggle.checked ? 'auto' : 'manual';
          localStorage.setItem('actionInputMode', actionInputMode);
          window.state.actionInputMode = actionInputMode;
          console.log(`âœ… ì•¡ì…˜ ì…ë ¥ ëª¨ë“œ: ${actionInputMode === 'auto' ? 'ìë™ ë§¤í•‘' : 'ìˆ˜ë™ ì„ íƒ'}`);
          
          // UI ì—…ë°ì´íŠ¸
          renderAll();
        }
        
        showFeedback('âœ… ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
        closeSettings();
      });
    }

    // í´ë¼ìš°ë“œ ë™ê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
    if (el.syncNowBtn) {
      el.syncNowBtn.addEventListener('click', syncCloudNow);
    }

    if (el.resetCloudBtn) {
      el.resetCloudBtn.addEventListener('click', resetCloudConfig);
    }

    // ESC í‚¤ë¡œ ë‹«ê¸°
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !el.settingsModal.classList.contains('hidden')) {
        closeSettings();
      }
    });
    
    const closeBtn = document.getElementById('close-registration-modal');
    if (closeBtn) {
      closeBtn.addEventListener('click', closeRegistrationModal);
    }
    
    
    
    // ë²„íŠ¼ ìœ„ì¹˜ ì„ íƒ ì´ë²¤íŠ¸ - renderPlayerSelectionì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì œê±°
    // (renderPlayerSelection í•¨ìˆ˜ ë‚´ì—ì„œ ì´ë¯¸ ì²˜ë¦¬ì¤‘)

    // ====== INIT ======
    async function initializeApp(){
      await executeWithLock(async () => {
        el.logDisplay.innerHTML='';
        openLogModal();
        logMessage(`ğŸ¯ ${VERSION_INFO}`);
        logMessage(`ğŸ“… ì´ˆê¸°í™” ì‹œì‘: ${new Date().toLocaleString('ko-KR')}`);
        populateTimezones(); loadActionState();
        try{
          await loadInitial();
          renderTableSelection();
          initializeSeatGrid();  // ì¢Œì„ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
          if(timeUpdater) clearInterval(timeUpdater);
          timeUpdater = setInterval(updateTimeDisplay, 1000);
          updateTimeDisplay();
          logMessage(`âœ… ${APP_VERSION} ì¤€ë¹„ ì™„ë£Œ!`);

          // ì¤‘ë³µ ê²€ì‚¬ ì‹¤í–‰ (ì„±ëŠ¥ì„ ìœ„í•´ ì˜µì…˜ìœ¼ë¡œ ë³€ê²½)
          const skipDuplicateCheck = localStorage.getItem('skipDuplicateCheck') === 'true';
          if (!skipDuplicateCheck && window.removeDuplicatePlayers && typeof window.removeDuplicatePlayers === 'function') {
            logMessage(`ğŸ” ì¤‘ë³µ í”Œë ˆì´ì–´ ê²€ì‚¬ ì‹œì‘...`);
            try {
              // skipModalOpen=trueë¡œ ëª¨ë‹¬ ì¤‘ë³µ ì—´ê¸° ë°©ì§€
              const result = await window.removeDuplicatePlayers(true);
              if (result.success) {
                if (result.removedCount > 0) {
                  logMessage(`âœ… ì¤‘ë³µ ì œê±° ì™„ë£Œ: ${result.removedCount}ëª… ì œê±°`);
                } else {
                  logMessage(`âœ… ì¤‘ë³µ ì—†ìŒ - ì‹œíŠ¸ê°€ ê¹¨ë—í•©ë‹ˆë‹¤`);
                }
              }
            } catch (duplicateError) {
              console.error('ì¤‘ë³µ ê²€ì‚¬ ì˜¤ë¥˜:', duplicateError);
              logMessage(`âš ï¸ ì¤‘ë³µ ê²€ì‚¬ ì‹¤íŒ¨: ${duplicateError.message}`, true);
            }
          } else if (skipDuplicateCheck) {
            logMessage(`â­ï¸ ì¤‘ë³µ ê²€ì‚¬ ê±´ë„ˆëœ€ (ë¹ ë¥¸ ì‹œì‘ ëª¨ë“œ)`);
          }
        }catch(err){
          console.error(err); logMessage(`ì´ˆê¸°í™” ì‹¤íŒ¨: ${err.message}`, true);
        }finally{
          setTimeout(closeLogModal, 3000); // ì¤‘ë³µ ê²€ì‚¬ ì™„ë£Œ í›„ ë‹«ê¸° ìœ„í•´ ì‹œê°„ ì—°ì¥
        }
      }, 'ì•± ì´ˆê¸°í™”', 'ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤...');
    }

    setupEventListeners();
    initializeApp();
  });
  </script>

  <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
  <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-75 z-60 hidden flex items-center justify-center">
    <div class="bg-gray-800 rounded-lg p-6 max-w-sm w-full mx-4">
      <div class="flex items-center space-x-3">
        <div class="animate-spin h-5 w-5 border-2 border-amber-500 border-t-transparent rounded-full"></div>
        <div>
          <div id="loading-title" class="text-white font-medium">ì²˜ë¦¬ ì¤‘...</div>
          <div id="loading-message" class="text-gray-400 text-sm mt-1">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</div>
        </div>
      </div>
      <div class="mt-4 text-xs text-gray-500">
        ì‘ì—…ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ë‹¤ë¥¸ ë²„íŠ¼ì„ í´ë¦­í•˜ì§€ ë§ˆì„¸ìš”
      </div>
    </div>
  </div>

  <!-- ìŠ¤ë‚µë°” ì»´í¬ë„ŒíŠ¸ -->
  <div id="snackbar" class="snackbar"></div>

  <!-- ì¤‘ë³µ í”Œë ˆì´ì–´ ì œê±° ëª¨ë“ˆ (ë§¤ ìƒˆë¡œê³ ì¹¨ë§ˆë‹¤ ìë™ ì‹¤í–‰) -->
  <script src="src/js/duplicate-remover.js?v=3.5.25"></script>
</body>
</html>
</file>

</files>
