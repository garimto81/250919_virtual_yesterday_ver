<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLAYER 출력 테스트</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: white; padding: 20px; }
        .test-case { background: #333; border-radius: 8px; padding: 15px; margin: 20px 0; }
        h3 { color: #fbbf24; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        td, th { border: 1px solid #555; padding: 8px; text-align: left; }
        th { background-color: #444; color: #fbbf24; }
        .expected { background-color: #1a4d1a; }
        .actual { background-color: #1a1a4d; }
        .error { background-color: #4d1a1a; }
        button { background: #4b5563; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #6b7280; }
        pre { background: #222; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>🎯 PLAYER 행 출력 형식 테스트</h1>
    
    <div class="test-case">
        <h3>예상 형식 (올바른 형식)</h3>
        <table>
            <tr>
                <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th>
            </tr>
            <tr class="expected">
                <td>4</td>
                <td>PLAYER</td>
                <td>LEMMENS</td>
                <td>1</td>
                <td>0</td>
                <td>575000</td>
                <td>0</td>
                <td>7h 7d</td>
            </tr>
            <tr class="expected">
                <td>5</td>
                <td>PLAYER</td>
                <td>CALONGE</td>
                <td>2</td>
                <td>0</td>
                <td>998000</td>
                <td>358000</td>
                <td>Qh Jh</td>
            </tr>
        </table>
        <p style="color: #10b981;">✅ 형식: 행번호 | PLAYER | 이름 | 좌석 | 0 | 시작칩 | 종료칩 | 핸드</p>
    </div>
    
    <div class="test-case">
        <h3>현재 잘못된 출력 (문제 상황)</h3>
        <table>
            <tr>
                <th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th><th>I</th>
            </tr>
            <tr class="error">
                <td>4</td>
                <td>PLAYER</td>
                <td>Jaewon</td>
                <td>1</td>
                <td>0</td>
                <td style="background: red;">0</td>
                <td>134000</td>
                <td>994000</td>
                <td>3h 3d</td>
            </tr>
            <tr class="error">
                <td>5</td>
                <td>PLAYER</td>
                <td>Trey</td>
                <td>2</td>
                <td>0</td>
                <td style="background: red;">0</td>
                <td>370000</td>
                <td>374000</td>
                <td>4s 4h</td>
            </tr>
        </table>
        <p style="color: #ef4444;">❌ 칼럼이 하나 더 많음 (빨간색 부분이 추가됨)</p>
    </div>
    
    <div class="test-case">
        <h3>코드 시뮬레이션</h3>
        <button onclick="testPlayerGeneration()">PLAYER 생성 테스트</button>
        <div id="output"></div>
    </div>
    
    <script>
        function unformatNumber(str) {
            if (!str) return '';
            return String(str).replace(/,/g, '');
        }
        
        function testPlayerGeneration() {
            const output = document.getElementById('output');
            let html = '<h4>테스트 실행:</h4>';
            
            // 시뮬레이션 데이터
            const state = {
                playersInHand: [
                    { name: 'Jaewon', chips: '994,000', initialChips: '134,000', hand: ['3h', '3d'] },
                    { name: 'Trey', chips: '374,000', initialChips: '370,000', hand: ['4s', '4h'] }
                ]
            };
            
            // generateRows_v46 시뮬레이션
            const out = [];
            let no = 4; // 4번 행부터 시작
            const push = (arr) => {
                const a = [no, ...arr];
                while(a.length < 18) a.push('');
                out.push(a);
                no++;
            };
            
            // PLAYERS 생성
            const players = state.playersInHand.map((p, i) => ({...p, seat: i + 1}));
            
            html += '<h4>1. 플레이어 데이터:</h4>';
            html += '<pre>' + JSON.stringify(players, null, 2) + '</pre>';
            
            players.forEach(p => {
                // 현재 코드의 문제점 확인
                let initialChips = parseInt(unformatNumber(p.initialChips) || 0, 10);
                let finalChips = parseInt(unformatNumber(p.chips) || 0, 10);
                
                html += `<h5>${p.name}:</h5>`;
                html += `<p>initialChips: "${p.initialChips}" → ${initialChips}</p>`;
                html += `<p>finalChips (chips): "${p.chips}" → ${finalChips}</p>`;
                
                // 문제: initialChips와 finalChips의 순서가 바뀌어 있을 가능성
                // 원래: 시작칩이 먼저, 종료칩이 나중
                // 현재: 둘의 순서가 바뀌었을 수 있음
                
                const playerRow = ['PLAYER', p.name, p.seat, 0, initialChips, finalChips, p.hand?.length ? p.hand.join(' ') : ''];
                html += `<p>생성된 배열: [${playerRow.join(', ')}]</p>`;
                push(playerRow);
            });
            
            html += '<h4>2. 최종 출력:</h4>';
            html += '<table>';
            html += '<tr><th>A</th><th>B</th><th>C</th><th>D</th><th>E</th><th>F</th><th>G</th><th>H</th></tr>';
            
            out.forEach(row => {
                html += '<tr class="actual">';
                row.slice(0, 8).forEach((cell, idx) => {
                    // E열(인덱스 4)과 F열(인덱스 5)이 칩 값
                    const highlight = (idx === 5 || idx === 6) ? 'style="background: #444;"' : '';
                    html += `<td ${highlight}>${cell}</td>`;
                });
                html += '</tr>';
            });
            html += '</table>';
            
            // 분석
            html += '<h4>3. 문제 분석:</h4>';
            if(out[0] && out[0].length > 8) {
                html += '<p style="color: #ef4444;">❌ 칼럼이 8개보다 많음: ' + out[0].length + '개</p>';
            }
            
            // 올바른 값 확인
            const firstRow = out[0];
            if(firstRow) {
                const actualInitial = firstRow[5];  // F열
                const actualFinal = firstRow[6];     // G열
                
                html += '<p>F열 (시작칩이어야 함): ' + actualInitial + '</p>';
                html += '<p>G열 (종료칩이어야 함): ' + actualFinal + '</p>';
                
                if(actualInitial === 134000 && actualFinal === 994000) {
                    html += '<p style="color: #10b981;">✅ 값은 올바르게 설정됨</p>';
                } else if(actualInitial === 994000 && actualFinal === 134000) {
                    html += '<p style="color: #ef4444;">❌ 시작칩과 종료칩이 바뀌어 있음!</p>';
                } else {
                    html += '<p style="color: #ef4444;">❌ 값이 예상과 다름</p>';
                }
            }
            
            output.innerHTML = html;
        }
        
        // 페이지 로드 시 자동 실행
        window.onload = testPlayerGeneration;
    </script>
</body>
</html>