<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실제 생성 테스트</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: white; padding: 20px; }
        .test-case { background: #333; border-radius: 8px; padding: 15px; margin: 20px 0; }
        h3 { color: #fbbf24; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        td, th { border: 1px solid #555; padding: 8px; text-align: left; }
        th { background-color: #444; color: #fbbf24; }
        .column-header { background-color: #2d3748; font-weight: bold; }
        button { background: #4b5563; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #6b7280; }
        pre { background: #222; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>🎯 실제 generateRows_v46 테스트</h1>
    
    <div class="test-case">
        <h3>실제 생성 테스트</h3>
        <button onclick="testActualGeneration()">실제 생성 테스트 실행</button>
        <div id="output"></div>
    </div>
    
    <button onclick="location.href='index.html'">메인으로 돌아가기</button>
    
    <script>
        function unformatNumber(str) {
            if (!str) return '';
            return String(str).replace(/,/g, '');
        }
        
        function testActualGeneration() {
            const output = document.getElementById('output');
            
            // generateRows_v46 일부를 시뮬레이션
            const out = []; 
            let no = 1;
            const push = (arr) => { 
                const a = [no, ...arr]; 
                while(a.length < 18) a.push(''); 
                out.push(a); 
                no++; 
            };
            
            // 헤더와 핸드 정보 추가 (실제로는 3행까지 차지)
            push(['HEADER', 'INFO', 'HERE']);
            push(['MORE', 'HEADER', 'DATA']);
            push(['HAND', 'DATA', 'HERE']);
            
            // 이제 no는 4가 됨
            console.log('현재 행 번호:', no); // 4
            
            // 테스트 플레이어 데이터
            const testPlayers = [
                { name: 'LEMMENS', seat: 1, initialChips: '575,000', chips: '0', hand: ['7h', '7d'] },
                { name: 'CALONGE', seat: 2, initialChips: '998,000', chips: '358,000', hand: ['Qh', 'Jh'] }
            ];
            
            // PLAYERS 생성 (실제 코드와 동일)
            const players = testPlayers.map((p, i) => ({...p, seat: i + 1}));
            
            players.forEach(p => {
                let initialChips = parseInt(unformatNumber(p.initialChips) || 0, 10);
                let finalChips = parseInt(unformatNumber(p.chips) || 0, 10);
                
                // 실제 코드와 동일한 방식으로 생성
                const playerRow = ['PLAYER', p.name, p.seat, 0, initialChips, finalChips, p.hand?.length ? p.hand.join(' ') : ''];
                
                console.log(`생성된 playerRow:`, playerRow);
                console.log(`playerRow 길이: ${playerRow.length}`);
                
                // push 실행
                const beforePushNo = no;
                push(playerRow);
                const afterPushRow = out[out.length - 1];
                
                console.log(`push 전 행번호: ${beforePushNo}`);
                console.log(`push 후 실제 행:`, afterPushRow);
            });
            
            // 결과 테이블 생성
            let html = '<h4>생성된 데이터:</h4>';
            html += '<table>';
            html += '<tr class="column-header">';
            for(let i = 0; i < 18; i++) {
                html += `<th>${String.fromCharCode(65 + i)}</th>`;
            }
            html += '</tr>';
            
            out.forEach((row, idx) => {
                if(row[1] === 'PLAYER') {
                    html += '<tr style="background: #1a4d1a;">';
                } else {
                    html += '<tr>';
                }
                row.forEach((cell, i) => {
                    html += `<td>${cell}</td>`;
                });
                html += '</tr>';
            });
            html += '</table>';
            
            // PLAYER 행 분석
            html += '<h4>PLAYER 행 분석:</h4>';
            const playerRows = out.filter(row => row[1] === 'PLAYER');
            
            playerRows.forEach(row => {
                html += '<div style="background: #222; padding: 10px; margin: 10px 0; border-radius: 4px;">';
                html += `<p><strong>${row[2]}의 데이터:</strong></p>`;
                html += `<p>A열 (행번호): ${row[0]}</p>`;
                html += `<p>B열 (PLAYER): ${row[1]}</p>`;
                html += `<p>C열 (이름): ${row[2]}</p>`;
                html += `<p>D열 (좌석): ${row[3]}</p>`;
                html += `<p>E열 (0): ${row[4]}</p>`;
                html += `<p>F열 (시작칩): ${row[5]}</p>`;
                html += `<p>G열 (종료칩): ${row[6]}</p>`;
                html += `<p>H열 (핸드): ${row[7]}</p>`;
                
                // 올바른지 확인
                if(row[2] === 'LEMMENS') {
                    if(row[5] === 575000 && row[6] === 0) {
                        html += '<p style="color: #10b981;">✅ LEMMENS 데이터 정확!</p>';
                    } else {
                        html += `<p style="color: #ef4444;">❌ LEMMENS 데이터 오류: F=${row[5]} (예상: 575000), G=${row[6]} (예상: 0)</p>`;
                    }
                }
                if(row[2] === 'CALONGE') {
                    if(row[5] === 998000 && row[6] === 358000) {
                        html += '<p style="color: #10b981;">✅ CALONGE 데이터 정확!</p>';
                    } else {
                        html += `<p style="color: #ef4444;">❌ CALONGE 데이터 오류: F=${row[5]} (예상: 998000), G=${row[6]} (예상: 358000)</p>`;
                    }
                }
                html += '</div>';
            });
            
            output.innerHTML = html;
        }
        
        // 페이지 로드 시 자동 실행
        window.onload = testActualGeneration;
    </script>
</body>
</html>